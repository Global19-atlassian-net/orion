/*

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation
 RequireJS text 2.0.5 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/requirejs/text for details

 Copyright (c) 2012, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010,2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2009, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2009, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010,2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 


 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 


 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation
  Mihai Sucan (Mozilla Foundation) - fix for Bug#334583 Bug#348471 Bug#349485 Bug#350595 Bug#360726 Bug#361180 Bug#362835 Bug#362428 Bug#362286 Bug#354270 Bug#361474 Bug#363945 Bug#366312 Bug#370584

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2009, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made
 available under the terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2012, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made
 available under the terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation 

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation 

 Copyright (c) 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made
 available under the terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors: IBM Corporation - initial API and implementation
               Alex Lakatos - fix for bug#369781

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others. All rights reserved. This
 program and the accompanying materials are made available under the terms of
 the Eclipse Public License v1.0 (http://www.eclipse.org/legal/epl-v10.html),
 and the Eclipse Distribution License v1.0
 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors: IBM Corporation - initial API and implementation
 RequireJS i18n 2.0.2 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/requirejs/i18n for details

 Copyright (c) 2011, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation
*/
var requirejs,require,define;
(function(k){function m(a,b){var g,e,p,s,c,v,l,h,f,r=b&&b.split("/"),j=n.map,d=j&&j["*"]||{};if(a&&"."===a.charAt(0))if(b){r=r.slice(0,r.length-1);a=r.concat(a.split("/"));for(h=0;h<a.length;h+=1)if(g=a[h],"."===g)a.splice(h,1),h-=1;else if(".."===g)if(1===h&&(".."===a[2]||".."===a[0]))break;else 0<h&&(a.splice(h-1,2),h-=2);a=a.join("/")}else 0===a.indexOf("./")&&(a=a.substring(2));if((r||d)&&j){g=a.split("/");for(h=g.length;0<h;h-=1){e=g.slice(0,h).join("/");if(r)for(f=r.length;0<f;f-=1)if(p=j[r.slice(0,
f).join("/")])if(p=p[e]){s=p;c=h;break}if(s)break;!v&&(d&&d[e])&&(v=d[e],l=h)}!s&&v&&(s=v,c=l);s&&(g.splice(0,c,s),a=g.join("/"))}return a}function i(a,b){return function(){return j.apply(k,w.call(arguments,0).concat([a,b]))}}function d(a){return function(b){return m(b,a)}}function c(a){return function(b){g[a]=b}}function f(a){if(r.call(l,a)){var b=l[a];delete l[a];q[a]=!0;h.apply(k,b)}if(!r.call(g,a)&&!r.call(q,a))throw Error("No "+a);return g[a]}function e(a){var b,g=a?a.indexOf("!"):-1;-1<g&&(b=
a.substring(0,g),a=a.substring(g+1,a.length));return[b,a]}var h,j,b,a,g={},l={},n={},q={},r=Object.prototype.hasOwnProperty,w=[].slice;b=function(a,b){var g,c=e(a),p=c[0],a=c[1];p&&(p=m(p,b),g=f(p));p?a=g&&g.normalize?g.normalize(a,d(b)):m(a,b):(a=m(a,b),c=e(a),p=c[0],a=c[1],p&&(g=f(p)));return{f:p?p+"!"+a:a,n:a,pr:p,p:g}};a={require:function(a){return i(a)},exports:function(a){var b=g[a];return"undefined"!==typeof b?b:g[a]={}},module:function(a){return{id:a,uri:"",exports:g[a],config:function(){return n&&
n.config&&n.config[a]||{}}}}};h=function(e,h,j,d){var p,s,A,v,n=[],w,d=d||e;if("function"===typeof j){h=!h.length&&j.length?["require","exports","module"]:h;for(v=0;v<h.length;v+=1)if(A=b(h[v],d),s=A.f,"require"===s)n[v]=a.require(e);else if("exports"===s)n[v]=a.exports(e),w=!0;else if("module"===s)p=n[v]=a.module(e);else if(r.call(g,s)||r.call(l,s)||r.call(q,s))n[v]=f(s);else if(A.p)A.p.load(A.n,i(d,!0),c(s),{}),n[v]=g[s];else throw Error(e+" missing "+s);h=j.apply(g[e],n);if(e)if(p&&p.exports!==
k&&p.exports!==g[e])g[e]=p.exports;else if(h!==k||!w)g[e]=h}else e&&(g[e]=j)};requirejs=require=j=function(g,e,c,l,p){if("string"===typeof g)return a[g]?a[g](e):f(b(g,e).f);g.splice||(n=g,e.splice?(g=e,e=c,c=null):g=k);e=e||function(){};"function"===typeof c&&(c=l,l=p);l?h(k,g,e,c):setTimeout(function(){h(k,g,e,c)},4);return j};j.config=function(a){n=a;return j};define=function(a,b,e){b.splice||(e=b,b=[]);!r.call(g,a)&&!r.call(l,a)&&(l[a]=[a,b,e])};define.amd={jQuery:!0}})();define("almond",function(){});
define("orion/util",[],function(){var k=navigator.userAgent,m=-1!==k.indexOf("MSIE")||-1!==k.indexOf("Trident")?document.documentMode:void 0,i=parseFloat(k.split("Firefox/")[1]||k.split("Minefield/")[1])||void 0,d=-1!==k.indexOf("Opera")?parseFloat(k.split("Version/")[1]):void 0,c=parseFloat(k.split("Chrome/")[1])||void 0,f=-1!==k.indexOf("Safari")&&!c,e=parseFloat(k.split("WebKit/")[1])||void 0,h=-1!==k.indexOf("Android"),j=-1!==k.indexOf("iPad"),k=-1!==k.indexOf("iPhone"),b=j||k,a=-1!==navigator.platform.indexOf("Mac"),
g=-1!==navigator.platform.indexOf("Win"),l=-1!==navigator.platform.indexOf("Linux"),n="ontouchstart"in document.createElement("input");return{formatMessage:function(a){var b=arguments;return a.replace(/\$\{([^\}]+)\}/g,function(a,g){return b[(g<<0)+1]})},createElement:function(a,b){return a.createElementNS?a.createElementNS("http://www.w3.org/1999/xhtml",b):a.createElement(b)},isIE:m,isFirefox:i,isOpera:d,isChrome:c,isSafari:f,isWebkit:e,isAndroid:h,isIPad:j,isIPhone:k,isIOS:b,isMac:a,isWindows:g,
isLinux:l,isTouch:n,platformDelimiter:g?"\r\n":"\n"}});
define("orion/webui/littlelib",["orion/util"],function(k){function m(e,b){b||(b=document);return b.querySelectorAll(e)}function i(e){var b=e.tabIndex;0===b&&k.isIE&&!{a:!0,body:!0,button:!0,frame:!0,iframe:!0,img:!0,input:!0,isindex:!0,object:!0,select:!0,textarea:!0}[e.nodeName.toLowerCase()]&&!e.attributes.tabIndex&&(b=-1);return b}function d(e){if(0<=i(e))return e;if(e.hasChildNodes())for(var b=0;b<e.childNodes.length;b++){var a=d(e.childNodes[b]);if(a)return a}return null}function c(e){if(0<=
i(e))return e;if(e.hasChildNodes())for(var b=e.childNodes.length-1;0<=b;b--){var a=c(e.childNodes[b]);if(a)return a}return null}function f(c,b){if(3===c.nodeType){var a=e.exec(c.nodeValue);a&&1<a.length&&b(c,a)}if(c.hasChildNodes())for(a=0;a<c.childNodes.length;a++)f(c.childNodes[a],b)}var e=/\$\{([^\}]+)\}/,h=null;return{$:function(e,b){b||(b=document);return b.querySelector(e)},$$:m,$$array:function(e,b){return Array.prototype.slice.call(m(e,b))},node:function(e){var b=e;"string"===typeof e&&(b=
document.getElementById(e));return b},contains:function(e,b){if(!e||!b)return!1;if(e===b)return!0;var a=e.compareDocumentPosition(b);return Boolean(a&16)},bounds:function(e){e=e.getBoundingClientRect();return{left:e.left+document.documentElement.scrollLeft,top:e.top+document.documentElement.scrollTop,width:e.width,height:e.height}},empty:function(e){for(;e.hasChildNodes();)e.removeChild(e.firstChild)},firstTabbable:d,lastTabbable:c,stop:function(e){window.document.all&&(e.keyCode=0);e.preventDefault&&
(e.preventDefault(),e.stopPropagation())},processTextNodes:function(e,b){f(e,function(a,g){a.parentNode.replaceChild(document.createTextNode(b[g[1]]||g[1]),a)})},processDOMNodes:function(e,b){f(e,function(a,g){var e=b[g[1]];if(e){var c=document.createRange(),h=g.index;c.setStart(a,h);c.setEnd(a,h+g[0].length);c.deleteContents();c.insertNode(e)}})},addAutoDismiss:function(e,b){function a(a){h.forEach(function(b){var e=!1,c=b.excludeNodes.some(function(b){return document.body.contains(b)?(e=!0,b.contains(a.target)):
!1});if(e&&!c)try{b.dismiss(a)}catch(h){"undefined"!==typeof console&&console&&console.error(h&&h.message)}});h=h.filter(function(a){return a.excludeNodes.some(function(a){return document.body.contains(a)})})}null===h&&(h=[],document.addEventListener("click",a,!0),k.isIOS&&document.addEventListener("touchend",function(a){function b(){a.target.removeEventListener("click",b)}0===a.touches.length&&a.target.addEventListener("click",b)},!1));h.push({excludeNodes:e,dismiss:b})},setFramesEnabled:function(e){for(var b=
document.getElementsByTagName("iframe"),a=0;a<b.length;a++)b[a].parentNode.style.pointerEvents=e?"":"none"},removeAutoDismiss:function(e){h=h.filter(function(b){return e!==b.dismiss})},KEY:{BKSPC:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DEL:46}}});
define("orion/EventTarget",[],function(){function k(){this._namedListeners={}}k.prototype={dispatchEvent:function(m){if(!m.type)throw Error("unspecified type");var i=this._namedListeners[m.type];i&&i.forEach(function(d){try{"function"===typeof d?d(m):d.handleEvent(m)}catch(c){"undefined"!==typeof console&&console.log(c)}});return!m.defaultPrevented},addEventListener:function(m,i){if("function"===typeof i||i.handleEvent)this._namedListeners[m]=this._namedListeners[m]||[],this._namedListeners[m].push(i)},
removeEventListener:function(m,i){var d=this._namedListeners[m];if(d)for(var c=0;c<d.length;c++)if(d[c]===i){1===d.length?delete this._namedListeners[m]:d.splice(c,1);break}}};k.prototype.constructor=k;k.attach=function(m){var i=new k;m.dispatchEvent=i.dispatchEvent.bind(i);m.addEventListener=i.addEventListener.bind(i);m.removeEventListener=i.removeEventListener.bind(i)};return k});
define("orion/webui/dropdown",["require","orion/webui/littlelib","orion/EventTarget"],function(k,m,i){function d(c){i.attach(this);this._init(c)}d.prototype={_init:function(c){this._dropdownNode=m.node(c.dropdown);if(!this._dropdownNode)throw"no dom node for dropdown found";this._populate=c.populate;this._selectionClass=c.selectionClass;this._parentDropdown=c.parentDropdown;this._positioningNode=c.positioningNode;if(!this._parentDropdown)for(var f=this._dropdownNode.parentNode;f&&document!==f;){if(f.classList&&
f.classList.contains("dropdownMenu")){this._parentDropdown=f.dropdown;break}f=f.parentNode}this._triggerNode=c.triggerNode?c.triggerNode:m.$(".dropdownTrigger",this._dropdownNode.parentNode);if(!this._triggerNode)throw"no dom node for dropdown trigger found";if(!c.skipTriggerEventListeners){var e=this;this._triggerNode.addEventListener("click",function(c){e.toggle(c)&&m.stop(c)},!1);"span"===this._triggerNode.tagName.toLowerCase()&&this._triggerNode.addEventListener("keydown",function(c){if(c.keyCode===
m.KEY.ENTER||c.keyCode===m.KEY.SPACE)e.toggle(),m.stop(c)},!1)}this._dropdownNode.addEventListener("keydown",this._dropdownKeyDown.bind(this),!1)},addTriggerNode:function(c){var f=this;c.addEventListener("click",function(e){f.toggle(e)&&m.stop(e)},!1)},toggle:function(c){return this.isVisible()?this.close():this.open(c)},isVisible:function(){return this._isVisible},open:function(c){var f=!1;if(!this.isVisible()){this.dispatchEvent({type:"triggered",dropdown:this,event:c});m.setFramesEnabled(!1);this._populate&&
(this.empty(),this._populate(this._dropdownNode));var e=this.getItems();0<e.length&&(this._hookedAutoDismiss||(this._boundAutoDismiss?m.removeAutoDismiss(this._boundAutoDismiss):this._boundAutoDismiss=this._autoDismiss.bind(this),f=m.$$array(".dropdownSubMenu",this._dropdownNode),m.addAutoDismiss([this._triggerNode].concat(f),this._boundAutoDismiss),this._hookedAutoDismiss=!0),this._triggerNode.classList.add("dropdownTriggerOpen"),this._selectionClass&&this._triggerNode.classList.add(this._selectionClass),
this._dropdownNode.classList.add("dropdownMenuOpen"),this._isVisible=!0,this._positionDropdown(c),e[0].focus(),f=!0,this._parentDropdown&&this._parentDropdown.submenuOpen(this))}return f},_autoDismiss:function(c){if(this.close(!1)&&this._dropdownNode.contains(c.target))for(c=this._parentDropdown;c;)c.close(!1),c=c._parentDropdown},_positionDropdown:function(){this._dropdownNode.style.left="";this._dropdownNode.style.top="";if(this._positioningNode)this._dropdownNode.style.left=this._positioningNode.offsetLeft+
"px";else{var c=m.bounds(this._dropdownNode),f=m.bounds(document.body);if(c.left+c.width>f.left+f.width)if(this._triggerNode.classList.contains("dropdownMenuItem"))this._dropdownNode.style.left=-c.width+"px";else{var e=m.bounds(this._boundingNode(this._triggerNode)),h=m.bounds(this._triggerNode);this._dropdownNode.style.left=h.left-e.left-c.width+h.width+"px"}c=c.top+c.height-(f.top+f.height);0<c&&(this._dropdownNode.style.top=Math.floor(this._dropdownNode.style.top-c)+"px")}},_boundingNode:function(c){var f=
window.getComputedStyle(c,null);return null===f||"absolute"===f.getPropertyValue("position")||!c.parentNode||c===document.body?c:this._boundingNode(c.parentNode)},close:function(c){var f=!1;this.isVisible()&&(this._triggerNode.classList.remove("dropdownTriggerOpen"),this._selectionClass&&this._triggerNode.classList.remove(this._selectionClass),this._dropdownNode.classList.remove("dropdownMenuOpen"),m.setFramesEnabled(!0),c&&this._triggerNode.focus(),this._isVisible=!1,f=!0);return f},getItems:function(){var c=
[],f=this;m.$$array("li:not(.dropdownSeparator) > .dropdownMenuItem",this._dropdownNode,!0).forEach(function(e){e.parentNode.parentNode===f._dropdownNode&&c.push(e)});c.forEach(function(e){e._hasDropdownMouseover||(e.addEventListener("mouseover",function(c){e.dropdown?e.dropdown.open(c):(f._closeSelectedSubmenu(),m.stop(c))}),e._hasDropdownMouseover=!0)});return c},empty:function(){var c=this;m.$$array("li",this._dropdownNode).forEach(function(f){f.parentNode===c._dropdownNode&&f.parentNode.removeChild(f)});
this._hookedAutoDismiss=!1},_dropdownKeyDown:function(c){if(c.keyCode===m.KEY.UP||c.keyCode===m.KEY.DOWN||c.keyCode===m.KEY.RIGHT||c.keyCode===m.KEY.ENTER||c.keyCode===m.KEY.LEFT){var f=this.getItems(),e=document.activeElement;if(f.length&&0<f.length&&e){var h=f.indexOf(e);0>h&&(h=f.indexOf(e.parentNode));0<=h&&(c.keyCode===m.KEY.UP&&0<h?(h--,f[h].focus()):c.keyCode===m.KEY.DOWN&&h<f.length-1?(h++,f[h].focus()):c.keyCode===m.KEY.ENTER||c.keyCode===m.KEY.RIGHT?e.classList.contains("dropdownTrigger")&&
e.dropdown&&e.dropdown.open():c.keyCode===m.KEY.LEFT&&e.parentNode.parentNode.classList.contains("dropdownMenuOpen")&&this.close(!0),m.stop(c))}}else c.keyCode===m.KEY.ESCAPE&&(this.close(!0),m.stop(c))},submenuOpen:function(c){c!==this._selectedSubmenu&&(this._closeSelectedSubmenu(),this._selectedSubmenu=c)},_closeSelectedSubmenu:function(){for(var c=this._selectedSubmenu;c;)c.close(),c=c._selectedSubmenu},destroy:function(){this.empty();this._boundAutoDismiss&&m.removeAutoDismiss(this._boundAutoDismiss)}};
d.prototype.constructor=d;return{Dropdown:d}});
define("text",["module"],function(k){var m,i,d=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],c=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,f=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,e="undefined"!==typeof location&&location.href,h=e&&location.protocol&&location.protocol.replace(/\:/,""),j=e&&location.hostname,b=e&&(location.port||void 0),a=[],g=k.config&&k.config()||{};m={version:"2.0.5",strip:function(a){if(a){var a=a.replace(c,""),b=a.match(f);b&&(a=b[1])}else a="";return a},
jsEscape:function(a){return a.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:g.createXhr||function(){var a,b,e;if("undefined"!==typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!==typeof ActiveXObject)for(b=0;3>b;b+=1){e=d[b];try{a=new ActiveXObject(e)}catch(g){}if(a){d=[e];break}}return a},parseName:function(a){var b,
e,g=!1,c=a.indexOf(".");b=0===a.indexOf("./")||0===a.indexOf("../");-1!==c&&(!b||1<c)?(b=a.substring(0,c),e=a.substring(c+1,a.length)):b=a;a=e||b;c=a.indexOf("!");-1!==c&&(g="strip"===a.substring(c+1),a=a.substring(0,c),e?e=a:b=a);return{moduleName:b,ext:e,strip:g}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(a,b,e,g){var c,h;c=m.xdRegExp.exec(a);if(!c)return!0;a=c[2];c=c[3];c=c.split(":");h=c[1];c=c[0];return(!a||a===b)&&(!c||c.toLowerCase()===e.toLowerCase())&&(!h&&!c||h===g)},finishLoad:function(b,
e,c,h){c=e?m.strip(c):c;g.isBuild&&(a[b]=c);h(c)},load:function(a,c,f,r){if(r.isBuild&&!r.inlineText)f();else{g.isBuild=r.isBuild;var d=m.parseName(a),r=d.moduleName+(d.ext?"."+d.ext:""),t=c.toUrl(r),i=g.useXhr||m.useXhr;!e||i(t,h,j,b)?m.get(t,function(b){m.finishLoad(a,d.strip,b,f)},function(a){f.error&&f.error(a)}):c([r],function(a){m.finishLoad(d.moduleName+"."+d.ext,d.strip,a,f)})}},write:function(b,e,g){if(a.hasOwnProperty(e)){var c=m.jsEscape(a[e]);g.asModule(b+"!"+e,"define(function () { return '"+
c+"';});\n")}},writeFile:function(a,b,e,g,c){var b=m.parseName(b),h=b.ext?"."+b.ext:"",f=b.moduleName+h,d=e.toUrl(b.moduleName+h)+".js";m.load(f,e,function(){var b=function(p){return g(d,p)};b.asModule=function(p,a){return g.asModule(p,d,a)};m.write(a,f,b,c)},c)}};if("node"===g.env||!g.env&&"undefined"!==typeof process&&process.versions&&process.versions.node)i=require.nodeRequire("fs"),m.get=function(a,b){var e=i.readFileSync(a,"utf8");0===e.indexOf("\ufeff")&&(e=e.substring(1));b(e)};else if("xhr"===
g.env||!g.env&&m.createXhr())m.get=function(a,b,e,c){var h=m.createXhr(),f;h.open("GET",a,!0);if(c)for(f in c)c.hasOwnProperty(f)&&h.setRequestHeader(f.toLowerCase(),c[f]);if(g.onXhr)g.onXhr(h,a);h.onreadystatechange=function(){var g;4===h.readyState&&(g=h.status,399<g&&600>g?(g=Error(a+" HTTP status: "+g),g.xhr=h,e(g)):b(h.responseText))};h.send(null)};else if("rhino"===g.env||!g.env&&"undefined"!==typeof Packages&&"undefined"!==typeof java)m.get=function(a,b){var e,g,c=new java.io.File(a),h=java.lang.System.getProperty("line.separator"),
c=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(c),"utf-8")),f="";try{e=new java.lang.StringBuffer;(g=c.readLine())&&(g.length()&&65279===g.charAt(0))&&(g=g.substring(1));for(null!==g&&e.append(g);null!==(g=c.readLine());)e.append(h),e.append(g);f=String(e.toString())}finally{c.close()}b(f)};return m});define("text!orion/webui/dropdowntriggerbutton.html",[],function(){return'<button class="dropdownTrigger">${ButtonText}<\!--span class="dropdownArrowDown core-sprite-openarrow"></span--\></button><ul class="dropdownMenu"></ul>'});
define("text!orion/webui/dropdowntriggerbuttonwitharrow.html",[],function(){return'<button class="dropdownTrigger dropdownDefaultButton">${ButtonText}<span class="dropdownArrowDown core-sprite-openarrow"></span></button><ul class="dropdownMenu"></ul>'});define("text!orion/webui/submenutriggerbutton.html",[],function(){return'<li class="dropdownSubMenu"><span class="dropdownTrigger dropdownMenuItem" role="menuitem" tabindex="0"><span class="dropdownCommandName">${ButtonText}</span><span class="dropdownArrowRight core-sprite-closedarrow"></span></span><ul class="dropdownMenu"></ul></li>'});
define("text!orion/webui/checkedmenuitem.html",[],function(){return'<li><label class="dropdownMenuItem"><input class="checkedMenuItem" role="menuitem" type="checkbox" />${ItemText}</label></li>'});
define("orion/webui/tooltip",["require","orion/webui/littlelib"],function(k,m){function i(d){this._init(d)}i.prototype={_init:function(d){this._node=m.node(d.node);if(!this._node)throw"no dom node for tooltip found";this._position=d.position||["right","above","below","left"];this._text=d.text;this._hideDelay=void 0===d.hideDelay?200:d.hideDelay;this._tailSize=d.tailSize||10;this._trigger=d.trigger||"mouseover";this._afterShowing=d.afterShowing;this._afterHiding=d.afterHiding;var c=this;if("click"===
this._trigger)this._showDelay=0,this._node.addEventListener("click",this._clickHandler=function(e){e.target===c._node&&(c.show(),m.stop(e))},!1);else if("mouseover"===this._trigger){this._showDelay=void 0===d.showDelay?500:d.showDelay;d=["mouseout","click"];this._node.addEventListener("mouseover",this._mouseoverHandler=function(e){m.contains(c._node,e.target)&&(c.show(),m.stop(e))},!1);this._leaveHandler=function(e){m.contains(c._node,e.target)&&c.hide()};for(var f=0;f<d.length;f++)this._node.addEventListener(d[f],
this._leaveHandler,!1)}},_makeTipNode:function(){if(!this._tip){this._tip=document.createElement("span");this._tip.classList.add("tooltipContainer");this._tipInner=document.createElement("div");this._tipInner.classList.add("tooltip");if(this._text){this._tipTextContent=document.createElement("div");this._tipTextContent.classList.add("textContent");this._tipInner.appendChild(this._tipTextContent);var d=document.createTextNode(this._text);this._tipTextContent.appendChild(d)}this._tip.appendChild(this._tipInner);
document.body.appendChild(this._tip);var c=this;m.addAutoDismiss([this._tip,this._node],function(){c.hide()});"mouseover"===this._trigger&&(this._tipInner.role="tooltip",this._tipInner.id="tooltip"+(new Date).getTime().toString(),this._node.setAttribute("aria-describedby",this._tipInner.id),this._tip.addEventListener("mouseover",function(){c._timeout&&(window.clearTimeout(c._timeout),c._timeout=null);c._tip.addEventListener("mouseout",function(f){m.contains(c._tip,f.target)&&(c.hide(),m.stop(f))},
!1)},!1))}return this._tip},_positionTip:function(d,c){this._makeTipNode();"left"===d?this._tipInner.classList.add("left"):this._tipInner.classList.remove("left");var f=this._node,e;for(e=m.bounds(f);f&&!e.width&&!e.height;f=f.parentNode)e=m.bounds(f);var f=m.bounds(this._tipInner),h;switch(d){case "above":h=e.top-f.height-this._tailSize-1;e=e.left-this._tailSize;break;case "below":h=e.top+e.height+this._tailSize+1;e=e.left-this._tailSize;break;case "left":h=e.top-this._tailSize/2;e=e.left-f.width-
this._tailSize-1;break;default:h=e.top-this._tailSize/2,e=e.left+e.width+this._tailSize+1}var j=m.bounds(document.documentElement);if(h+f.height>j.height)if(c)h=j.height-f.height-1;else return!1;if(e+f.width>j.width)if(c)e=j.width-f.width-1;else return!1;if(0>e)if(c)e=4;else return!1;if(0>h)if(c)h=4;else return!1;this._tail&&this._tail.previousPosition!==d&&(this._tip.removeChild(this._tail),this._tail=null);this._tail||(this._tail=document.createElement("span"),this._tail.classList.add("tooltipTailFrom"+
d),"above"===d||"left"===d?this._tip.appendChild(this._tail):this._tip.insertBefore(this._tail,this._tipInner),"left"===d&&(this._tail.style.left=f.width+"px"),this._tail.previousPosition=d);this._tip.style.top=h+"px";this._tip.style.left=e+"px";return!0},contentContainer:function(){this._makeTipNode();return this._tipInner},show:function(){if(!this._tip||!this._tip.classList.contains("tooltipShowing"))this._timeout&&(window.clearTimeout(this._timeout),this._timeout=null),this._showDelay?this._timeout=
window.setTimeout(this._showImmediately.bind(this),this._showDelay):this._showImmediately()},_showImmediately:function(){for(var d=!1,c=0;!d&&c<this._position.length;)d=this._positionTip(this._position[c]),c++;d||this._positionTip(this._position[0],!0);this._tip.classList.add("tooltipShowing");this._afterShowing&&this._afterShowing()},hide:function(d){this._timeout&&(window.clearTimeout(this._timeout),this._timeout=null);if(this._tip&&this._tip.classList.contains("tooltipShowing")){void 0===d&&(d=
this._hideDelay);var c=this;this._timeout=window.setTimeout(function(){c._tip.classList.remove("tooltipShowing");c._tip.removeAttribute("style");c._afterHiding&&c._afterHiding()},d)}},destroy:function(){this._timeout&&(window.clearTimeout(this._timeout),this._timeout=null);this._tip&&(document.body.removeChild(this._tip),this._tail=this._tipTextContent=this._tipInner=this._tip=null);if(this._node){this._node.removeEventListener("click",this._clickHandler,!1);this._node.removeEventListener("mouseover",
this._mouseoverHandler,!1);for(var d=["mouseout","click"],c=0;c<d.length;c++)this._node.removeEventListener(d[c],this._leaveHandler,!1)}}};i.prototype.constructor=i;return{Tooltip:i}});
define("orion/commands","orion/util orion/webui/littlelib orion/webui/dropdown text!orion/webui/dropdowntriggerbutton.html text!orion/webui/dropdowntriggerbuttonwitharrow.html text!orion/webui/submenutriggerbutton.html text!orion/webui/checkedmenuitem.html orion/webui/tooltip".split(" "),function(k,m,i,d,c,f,e,h){function j(a){var b=a.invocation;if(b){var p=a.command;if(p.hrefCallback)return a=p.hrefCallback.call(b.handler||window,b),a.then?a.then(function(p){window.open(p)}):window.open(a),!0;if(b.commandRegistry)return b.commandRegistry._invoke(b),
!0;if(p.onClick||p.callback)return window.setTimeout(function(){(p.onClick||p.callback).call(b.handler||window,b)},0),!0}return!1}function b(a,b){for(var p in b)if(b[p]&&(b[p].keyBinding&&b[p].command)&&b[p].keyBinding.match(a)){var s=b[p],e=s.keyBinding;if((!e.domScope||m.contains(m.node(e.domScope),a.target))&&j(s)){m.stop(a);break}}}function a(){var a={};if(t){var b,p,s;p=Object.keys(x);for(b=0;b<p.length;b++)s=p[b],a[s]=x[s];var e=t();p=Object.keys(e);for(b=0;b<p.length;b++)s=p[b],a[s]=e[s]}else a=
x;return a}function g(e){b(e,a())}function l(a,b){a=a||window.event;if(function(p){if(k.isMac){if(p.metaKey&&!p.altKey)return!p.shiftKey&&!p.ctrlKey&&(65===p.keyCode||67===p.keyCode||86===p.keyCode||88===p.keyCode||90===p.keyCode)?!0:!1;if(p.ctrlKey)return!1}else{if(p.ctrlKey&&!p.altKey)return!p.shiftKey&&(65===p.keyCode||67===p.keyCode||86===p.keyCode||88===p.keyCode||90===p.keyCode)?!0:!1;if(p.altKey&&!p.ctrlKey)return!1}if(p["char"])return 0<p["char"].length;if(p.charCode||p.keyCode)switch(p=p.charCode||
p.keyCode,p){case 8:case 9:case 13:case 46:return!0;default:return 32<=p&&112>p||123<p}return!1}(a)){if("true"===a.target.contentEditable)return;var p=a.target.nodeName.toLowerCase();if("input"===p)switch(a.target.type.toLowerCase()){case "text":case "password":case "search":case "color":case "date":case "datetime":case "datetime-local":case "email":case "month":case "number":case "range":case "tel":case "time":case "url":case "week":return}else if("textarea"===p)return}b?b(a):g(a)}function n(){this._init()}
function q(a,b,p){b.classList.add("commandImage");var e;a.imageClass?a.addImageClassToElement?b.classList.add(a.imageClass):(e=document.createElement("span"),b.appendChild(e),e.classList.add(a.spriteClass),e.classList.add(a.imageClass)):(e=new Image,e.alt=a.name,e.name=p,e.id=p,e.src=a.image,b.appendChild(e));return e}function r(a,b,p,e,g){this.commandRegistry=g;this.handler=a;this.items=b;this.userData=p;this.command=e;e.parameters&&(this.parameters=e.parameters.makeCopy());this.id=e.id}function w(a){this._init(a)}
var t=null,x={};n.prototype={setProxy:function(a){this.proxy=a},setKeyBindings:function(a){this.bindings=a},_init:function(){var a=this;document.addEventListener("keydown",function(b){return l(b,function(p){var b=a.proxy,e=a.bindings;if(e&&b)for(var g=0;g<e.length;g++)e[g].match(p)&&(b.processKey({type:p.type,keyCode:p.keyCode,altKey:p.altKey,ctrlKey:p.ctrlKey,metaKey:p.metaKey,shiftKey:p.shiftKey}),m.stop(p))})})}};window.document.addEventListener("keydown",l,!1);r.prototype={collectsParameters:function(){return this.commandRegistry&&
this.commandRegistry.collectsParameters()},makeCopy:function(a){var b=new r(this.handler,this.items,this.userData,this.command,this.commandRegistry);b.domNode=this.domNode;b.domParent=this.domParent;a?b.parameters=a.makeCopy():this.parameters&&(b.parameters=this.parameters.makeCopy());return b}};r.prototype.constructor=r;w.prototype={_init:function(a){this.id=a.id;this.name=a.name;this.tooltip=a.tooltip;this.callback=a.callback;this.hrefCallback=a.hrefCallback;this.choiceCallback=a.choiceCallback;
this.positioningNode=a.positioningNode;this.image=a.image||"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAQMAAAAlPW0iAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAAtJREFUCNdjIBEAAAAwAAFletZ8AAAAAElFTkSuQmCC";this.imageClass=a.imageClass;this.addImageClassToElement=a.addImageClassToElement;this.selectionClass=a.selectionClass;this.spriteClass=a.spriteClass||"commandSprite";this.visibleWhen=a.visibleWhen;this.parameters=a.parameters;this.isEditor=a.isEditor},populateChoicesMenu:function(a,b,p,e,
g){var p=this.getChoices(b,p,e),c=p.some(function(p){return p.checked});p.forEach(function(p){if(p.name){var e=document.createElement("li");a.appendChild(e);var s=document.createElement("span");s.tabIndex=0;s.role="menuitem";s.classList.add("dropdownMenuItem");if(c){var h=document.createElement("span");h.classList.add("check");h.appendChild(document.createTextNode(p.checked?"\u25cf":""));s.appendChild(h)}h=document.createTextNode(p.name);s.appendChild(h);e.appendChild(s);s.choice=p;s.addEventListener("click",
function(p){p.target.choice&&p.target.choice.callback.call(p.target.choice,b)},!1);s.addEventListener("keydown",function(p){(p.keyCode===m.KEY.ENTER||p.keyCode===m.KEY.SPACE)&&p.target.choice&&p.target.choice.callback.call(p.target.choice,b)},!1)}else g._generateMenuSeparator(a)})},getChoices:function(a,b,p){return this.choiceCallback?this.choiceCallback.call(b,a,p):null},makeChoiceCallback:function(a,b){return function(p){a.callback&&a.callback.call(a,b,p)}},hasImage:function(){return this.imageClass||
"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAQMAAAAlPW0iAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAAtJREFUCNdjIBEAAAAwAAFletZ8AAAAAElFTkSuQmCC"!==this.image}};w.prototype.constructor=w;return{Command:w,CommandInvocation:r,createDropdownMenu:function(a,b,p,e,g,v,h,l,f){a=m.node(a);if(!a)throw"no parent node was specified";var r=document.createRange();r.selectNode(a);r=f?r.createContextualFragment(c):r.createContextualFragment(d);m.processTextNodes(r,{ButtonText:b});a.appendChild(r);var a=
a.lastChild,n;f?(f=a.previousSibling,n=f.lastChild):f=a.previousSibling;e?f.classList.add(e):(f.classList.add("orionButton"),f.classList.add("commandButton"));g&&(v||(f.textContent="",f.setAttribute("aria-label",b)),q({spriteClass:"commandSprite",imageClass:g},f,b),f.classList.add("orionButton"));f.dropdown=new i.Dropdown({dropdown:a,populate:p,selectionClass:h,skipTriggerEventListeners:!!n,positioningNode:l});a.dropdown=f.dropdown;return{menuButton:f,menu:a,dropdown:f.dropdown,dropdownArrow:n}},
createCheckedMenuItem:function(a,b,p,g){a=m.node(a);if(!a)throw"no parent node was specified";var c=document.createRange();c.selectNode(a);c=c.createContextualFragment(e);m.processTextNodes(c,{ItemText:b});a.appendChild(c);a=m.$(".checkedMenuItem",a.lastChild);a.checked=p;a.addEventListener("change",g,!1);return a},createCommandItem:function(a,b,p,e,g,c,f){var l,c=c||!b.name&&b.hasImage();if(b.hrefCallback)l=document.createElement("a"),l.id=e,c&&b.hasImage()?q(b,l,e):(l.className="commandLink",l.appendChild(document.createTextNode(b.name))),
f=b.hrefCallback.call(p.handler,p),f.then?f.then(function(p){l.href=p}):l.href=f?f:"#";else{l=document.createElement("button");l.className="orionButton";c?b.hasImage()?(q(b,l,e),b.name&&l.setAttribute("aria-label",b.name)):(l.classList.add("commandButton"),l.classList.add("commandMissingImageButton"),l.appendChild(document.createTextNode(b.name))):(l.classList.add("commandButton"),e=document.createTextNode(b.name),l.appendChild(e));var r=f||b.callback;r&&(b.onClick=r,l.addEventListener("click",function(){r.call(p.handler,
p)},!1))}"ul"===a.nodeName.toLowerCase()?(f=document.createElement("li"),a.appendChild(f),a=f):l.classList.add("commandMargins");a.appendChild(l);b.tooltip&&(l.commandTooltip=new h.Tooltip({node:l,text:b.tooltip,position:["above","below","right","left"]}));g&&(x[b.id]={keyBinding:g,command:b,invocation:p});return l},createCommandMenuItem:function(a,b,p,e,g,c){var l,f=a.dropdown;if(b.hrefCallback){l=document.createElement("a");var r=document.createElement("span");r.appendChild(document.createTextNode(b.name));
r.classList.add("dropdownCommandName");l.appendChild(r);g=b.hrefCallback.call(p.handler,p);g.then?g.then(function(p){l.href=p}):l.href=g?g:"#";l.addEventListener("keydown",function(p){(p.keyCode===m.KEY.ENTER||p.keyCode===m.KEY.SPACE)&&l.click()},!1)}else{l=document.createElement("span");l.tabIndex=0;r=document.createElement("span");r.appendChild(document.createTextNode(b.name));r.classList.add("dropdownCommandName");l.appendChild(r);var d=g||b.callback;d&&(b.onClick=d,l.addEventListener("click",
function(){f.close(!0);d.call(p.handler,p)},!1),l.addEventListener("keydown",function(p){if(p.keyCode===m.KEY.ENTER||p.keyCode===m.KEY.SPACE)p.preventDefault(),l.click()},!1))}l.className="dropdownMenuItem";l.role="menuitem";b.tooltip&&(l.commandTooltip=new h.Tooltip({node:l,text:b.tooltip,position:["above","below","right","left"]}));c&&(g=l,r=document.createElement("span"),r.classList.add("dropdownKeyBinding"),r.appendChild(document.createTextNode(c)),g.appendChild(r));c=document.createElement("li");
a.appendChild(c);c.appendChild(l);e&&(x[b.id]={keyBinding:e,command:b,invocation:p});return l},executeBinding:j,setKeyBindingProvider:function(a){t=a},localKeyBindings:x,CommandsProxy:n,getKeyBindings:a,processKey:g,NO_IMAGE:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAQMAAAAlPW0iAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAAtJREFUCNdjIBEAAAAwAAFletZ8AAAAAElFTkSuQmCC",_testMethodProcessKey:b}});
define("orion/explorers/navigationUtils",[],function(){function k(i,d){!m&&i&&(i.push({domNode:d}),d.tabIndex=-1,d.style.outline="none")}var m=-1!==navigator.userAgent.indexOf("iPad");return{addNavGrid:function(i,d,c){i&&(i=i.getGridNavHolder(d,!0))&&k(i,c)},generateNavGrid:k,removeNavGrid:function(i,d){if(i)for(var c=0;c<i.length;c++)if(i[c].domNode===d){i.splice(c,1);break}}}});
define("orion/PageUtil",[],function(){var k=/^http[s]?/i;return{hash:function(){var m=window.location.href.split("#")[1];return m?"#"+m:""},matchResourceParameters:function(m){var m=m||window.location.toString(),i={resource:""},d=m.indexOf("#");if(-1!==d&&(m=m.substring(d+1),0!==m.length)){m=m.split(",");i.resource=decodeURIComponent(m[0]);for(d=1;d<m.length;d++){var c=/([^=]*)(=?)(.*)/.exec(m[d]),f=decodeURIComponent(c[1]||""),c=decodeURIComponent(c[3]||"");""!==f&&"resource"!==f&&(i[f]=c)}}return i},
validateURLScheme:function(m,i){var d=m;if(-1===m.indexOf("://")){var c=document.createElement("a");c.href=m;d=c.href}c=!1;if(c=i?i.some(function(c){return RegExp("^"+c+":","i").test(d)}):k.test(d))return m;console.log("Illegal URL Scheme: '"+m+"'");return""}}});
define("orion/uiUtils",["orion/webui/littlelib"],function(k){function m(d){var c="",f=-1!==navigator.platform.indexOf("Mac");f?(d.mod4&&(c+="\u2303"),d.mod3&&(c+="\u2325"),d.mod2&&(c+="\u21e7"),d.mod1&&(c+="\u2318")):(d.mod1&&(c+="Ctrl+"),d.mod2&&(c+="Shift+"),d.mod3&&(c+="Alt+"));if(d.alphaKey)return c+d.alphaKey;if("keypress"===d.type)return c+d.keyCode;for(var e in k.KEY)if(typeof("number"===k.KEY[e])&&k.KEY[e]===d.keyCode){if(f)switch(k.KEY[e]){case k.KEY.BKSPC:e="\u232b";break;case k.KEY.TAB:e=
"\u21e5";break;case k.KEY.ENTER:e="\u23ce";break;case k.KEY.ESCAPE:e="\u238b";break;case k.KEY.SPACE:e="\u2423";break;case k.KEY.PAGEUP:e="\u21de";break;case k.KEY.PAGEDOWN:e="\u21df";break;case k.KEY.END:e="\u21f2";break;case k.KEY.HOME:e="\u21f1";break;case k.KEY.DEL:e="\u2326"}switch(k.KEY[e]){case k.KEY.DOWN:e="\u2193";break;case k.KEY.UP:e="\u2191";break;case k.KEY.RIGHT:e="\u2192";break;case k.KEY.LEFT:e="\u2190"}return c+e}var h;switch(d.keyCode){case 59:h=d.mod2?":":";";break;case 61:h=d.mod2?
"+":"=";break;case 188:h=d.mod2?"<":",";break;case 190:h=d.mod2?">":".";break;case 191:h=d.mod2?"?":"/";break;case 192:h=d.mod2?"~":"`";break;case 219:h=d.mod2?"{":"[";break;case 220:h=d.mod2?"|":"\\";break;case 221:h=d.mod2?"}":"]";break;case 222:h=d.mod2?'"':"'"}return h?c+h:112<=d.keyCode&&123>=d.keyCode?c+"F"+(d.keyCode-111):c+String.fromCharCode(d.keyCode)}function i(d){var c=-1!==window.navigator.platform.indexOf("Mac");return c&&d.metaKey||!c&&d.ctrlKey}return{getUserKeyString:function(d){for(var c=
"",d=d.getKeys(),f=0;f<d.length;f++)0!==f&&(c+=" "),c+=m(d[f]);return c},getUserText:function(d){var c=d.id,f=d.refNode,e=d.hideRefNode,h=d.initialText,j=d.onComplete,b=d.onEditDestroy,a=d.selectTo,g=d.isInitialValid,d=d.insertAsChild,l=!1,n=function(a){return function(d){if(!l){var n=k.node(c),q=n.value;n&&(a&&d.keyCode===k.KEY.ESCAPE?(e&&(f.style.display="inline"),l=!0,n.parentNode.removeChild(n),b&&b()):a&&d.keyCode!==k.KEY.ENTER||(0===q.length||!g&&q===h?e&&(f.style.display="inline"):(j(q),e&&
f.parentNode&&(f.style.display="inline")),l=!0,n.parentNode&&n.parentNode.removeChild(n),b&&b()))}}},q=document.createElement("input");q.id=c;q.value=h||"";d?f.appendChild(q):f.parentNode.insertBefore(q,f.nextSibling);q.classList.add("userEditBoxPrompt");e&&(f.style.display="none");q.addEventListener("keydown",n(!0),!1);q.addEventListener("blur",n(!1),!1);window.setTimeout(function(){q.focus();if(h){var b=k.node(c),e=a?h.indexOf(a):-1;0<e?b.createTextRange?(b=b.createTextRange(),b.collapse(!0),b.moveStart("character",
0),b.moveEnd("character",e),b.select()):b.setSelectionRange?b.setSelectionRange(0,e):void 0!==b.selectionStart&&(b.selectionStart=0,b.selectionEnd=e):b.select()}},0)},openInNewWindow:i,followLink:function(d,c){c&&i(c)?window.open(d):window.location=d},createButton:function(d,c){var f=document.createElement("button");f.className="orionButton commandButton commandMargins";f.addEventListener("click",function(e){c();k.stop(e)},!1);d&&f.appendChild(document.createTextNode(d));return f},createDropdownButton:function(){},
isFormElement:function(d){switch(d.tagName.toLowerCase()){case "button":case "fieldset":case "form":case "input":case "keygen":case "label":case "legend":case "meter":case "optgroup":case "output":case "progress":case "select":case "textarea":return!0}return!1}}});
define("orion/commandRegistry","orion/commands orion/explorers/navigationUtils orion/PageUtil orion/uiUtils orion/webui/littlelib orion/webui/dropdown orion/webui/tooltip text!orion/webui/checkedmenuitem.html text!orion/webui/dropdowntriggerbutton.html text!orion/webui/submenutriggerbutton.html".split(" "),function(k,m,i,d,c,f,e,h,j,b){function a(a){this._commandList={};this._contributionsByScopeId={};this._activeBindings={};this._urlBindings={};this._pendingBindings={};this._init(a);this._parameterCollector=
null}function g(a,b){this.token=a;this.parameterName=b}function l(a,b,e){this.event=a;this.handler=b;this.capture=e||!1}function n(a,b,e,g,c,l){this.name=a;this.type=b;this.label=e;this.value=g;this.lines=c||1;this.eventListeners=Array.isArray(l)?l:l?[l]:[]}function q(a,b,e){this._storeParameters(a);this._hasOptionalParameters=b&&b.hasOptionalParameters;this._options=b;this.optionsRequested=!1;this.getParameters=e;this.clientCollect=b&&b.clientCollect}a.prototype={_init:function(a){this._selectionService=
a.selection;var b=this;k.setKeyBindingProvider(function(){return b._activeBindings})},processURL:function(a){for(var b in this._urlBindings)if(this._urlBindings[b]&&this._urlBindings[b].urlBinding&&this._urlBindings[b].command){var e=this._urlBindings[b].urlBinding.match(a);if(e){var g=this._urlBindings[b],c=g.command,l=g.invocation;if(l&&l.parameters&&c.callback){l.parameters.setValue(e.parameterName,e.parameterValue);var p=this;window.setTimeout(function(){p._invoke(l)},0);break}}}},findCommand:function(a){return this._commandList[a]},
runCommand:function(a,b,e,g){b?(a=this._commandList[a])&&(a.visibleWhen?a.visibleWhen(b):1)&&a.callback&&this._invoke(new k.CommandInvocation(e,b,null,a,this),g):(b=this._urlBindings[a])&&b.command&&b.command.callback&&this._invoke(b.invocation,g)},getSelectionService:function(){return this._selectionService},setParameterCollector:function(a){this._parameterCollector=a},openParameterCollector:function(a,b,e){this._parameterCollector&&(this._parameterCollector.close(),this._parameterCollector.open(a,
b,e))},confirm:function(a,b,e,g,c,l){var p=!1;if(this._parameterCollector&&!c){var s=this;this._parameterCollector.close();if(this._parameterCollector.open(a,function(a,c){var l=document.createElement("span");l.classList.add("parameterPrompt");l.textContent=b;a.appendChild(l);l=document.createElement("button");l.addEventListener("click",function(){p=!0;s._parameterCollector.close()},!1);c.appendChild(l);l.appendChild(document.createTextNode(e));l.className="dismissButton";var h=document.createElement("button");
h.addEventListener("click",function(){p=!1;s._parameterCollector.close()},!1);c.appendChild(h);h.appendChild(document.createTextNode(g));h.className="dismissButton";return l},function(){l(p)}))return}p=window.confirm(b);l(p)},closeParameterCollector:function(){this._parameterCollector&&this._parameterCollector.close()},collectsParameters:function(){return this._parameterCollector},_invoke:function(a,b){return this._collectAndInvoke(a.makeCopy(b),!1)},_collectAndInvoke:function(a,b){if(a)if(this._parameterCollector&&
a.parameters&&a.parameters.hasParameters()&&(b||a.parameters.shouldCollectParameters())){var g=!1;a.parameters.updateParameters(a);if(a.parameters.shouldCollectParameters()&&(g=this._parameterCollector.collectParameters(a),!g)){var c=new e.Tooltip({node:a.domNode,afterHiding:function(){this.destroy()},trigger:"click",position:["below","right","above","left"]}),g=c.contentContainer();g.classList.add("parameterPopup");var l=window.document.activeElement,h=this._parameterCollector.getFillFunction(a,
function(){l&&l.focus();c.destroy()})(g);c.show();window.setTimeout(function(){h.focus();h.select()},0);g=!0}g||a.command.callback.call(a.handler||window,a)}else a.command.callback.call(a.handler||window,a);else window.console.log("Client attempted to invoke command without an available (rendered) command invocation")},collectParameters:function(a){this._collectAndInvoke(a,!0)},showKeyBindings:function(a){function b(p){return function(){k.executeBinding(p)}}var e={},g,c,l=[],p;for(p in this._activeBindings)(c=
this._activeBindings[p])&&(c.keyBinding&&c.command&&(c.command.name||c.command.tooltip))&&l.push(c);l.sort(function(p,a){return(p.command.name||p.command.tooltip).localeCompare(a.command.name||a.command.tooltip)});for(p=0;p<l.length;p++)c=l[p],c.keyBinding.scopeName?(e[c.keyBinding.scopeName]||(e[c.keyBinding.scopeName]=[]),e[c.keyBinding.scopeName].push(c)):(g=d.getUserKeyString(c.keyBinding),a.createItem(g,c.command.name||c.command.tooltip,b(c)));for(var s in e)e[s].length&&0<e[s].length&&(a.createHeader(s),
e[s].forEach(function(p){g=d.getUserKeyString(p.keyBinding);a.createItem(g,p.command.name||p.command.tooltip,b(p))}))},addCommand:function(a){this._commandList[a.id]=a;var b=this._pendingBindings[a.id];if(b){var e=this;b.forEach(function(b){e._addBinding(a,b.type,b.binding,b.bindingOnly)});delete this._pendingBindings[a.id]}},addCommandGroup:function(a,b,e,g,c,l,p,s,h,v){this._contributionsByScopeId[a]||(this._contributionsByScopeId[a]={});a=this._contributionsByScopeId[a];c&&(a=this._createEntryForPath(a,
c));a[b]?(g&&(a[b].title=g),e&&(a[b].position=e),p&&(a[b].imageClass=p),s&&(a[b].tooltip=s),h&&(a[b].selectionClass=h),!0===v?a[b].pretendDefaultActionId=!0:a[b].defaultActionId=v,a[b].emptyGroupMessage=l):(a[b]={title:g,position:e,emptyGroupMessage:l,imageClass:p,tooltip:s,selectionClass:h,defaultActionId:!0===v?null:v,pretendDefaultActionId:!0===v,children:{}},a.sortedContributions=null)},_createEntryForPath:function(a,b){b&&b.split("/").forEach(function(b){1<b.length&&(a[b]||(a[b]={position:0,
children:{}},a.sortedContributions=null),a=a[b].children)});return a},registerSelectionService:function(a,b){this._contributionsByScopeId[a]||(this._contributionsByScopeId[a]={});this._contributionsByScopeId[a].localSelectionService=b},registerCommandContribution:function(a,b,e,g,c,l,p){this._contributionsByScopeId[a]||(this._contributionsByScopeId[a]={});a=this._contributionsByScopeId[a];g&&(a=this._createEntryForPath(a,g));a[b]={position:e};l&&((e=this._commandList[b])?this._addBinding(e,"key",
l,c):this._addPendingBinding(b,"key",l,c));p&&((e=this._commandList[b])?this._addBinding(e,"url",p,c):this._addPendingBinding(b,"url",p,c));a.sortedContributions=null},unregisterCommandContribution:function(a,b,e){if(this._contributionsByScopeId[a]){delete this._commandList[b];delete this._activeBindings[b];delete this._urlBindings[b];delete this._pendingBindings[b];var g=this._contributionsByScopeId[a];e&&e.split("/").forEach(function(a){1<a.length&&g[a]&&(g=g[a].children)});delete g[b];g.sortedContributions=
null}},_addBinding:function(a,b,e,g){if(!a.id)throw Error("No command id: "+a);"key"===b?this._activeBindings[a.id]={command:a,keyBinding:e,bindingOnly:g}:"url"===b&&(this._urlBindings[a.id]={command:a,urlBinding:e,bindingOnly:g})},_addPendingBinding:function(a,b,e,g){this._pendingBindings[a]=this._pendingBindings[a]||[];this._pendingBindings[a].push({type:b,binding:e,bindingOnly:g})},_checkForTrailingSeparator:function(a,b,e){var g;if("tool"===b||"button"===b)if((g=0<a.childNodes.length?a.childNodes[a.childNodes.length-
1]:null)&&g.classList.contains("commandSeparator"))return e?(a.removeChild(g),!1):!0;if("menu"===b&&(a=c.$$array("li > *",a),0<a.length&&a[a.length-1].classList.contains("dropdownSeparator")))if(g=a[a.length-1],e)g.parentNode.parentNode.removeChild(g.parentNode);else return!0;return!1},renderCommands:function(a,b,e,g,l,h,p){if("string"!==typeof a)throw"a scope id for rendering must be specified";b=c.node(b);if(!b)throw"no parent";var s=this._contributionsByScopeId[a];if(!e&&s){var e=s.localSelectionService||
this._selectionService,A=this;e&&e.getSelections(function(p){A.renderCommands(a,b,p,g,l,h)})}else s&&(this._render(s,b,e,g,l||"button",h,p),this._checkForTrailingSeparator(b,l,!0))},destroy:function(a){a=c.node(a);if(!a)throw"no parent";for(;a.hasChildNodes();){var b=a.firstChild;b.commandTooltip&&b.commandTooltip.destroy();b.emptyGroupTooltip&&b.emptyGroupTooltip.destroy();this.destroy(b);a.removeChild(b)}},_render:function(a,b,g,c,l,h,p){var s=a.sortedContributions;if(!s){var s=[],A=!1,v;for(v in a)if(Object.prototype.hasOwnProperty.call(a,
v)){var f=a[v];f&&"number"===typeof f.position&&(f.id=v,s.push(f),A=!0)}A&&(s.sort(function(a,p){return a.position-p.position}),a.sortedContributions=s)}var n=0,j=this;s.forEach(function(a){var s;a.imageClass||(a.imageClass=null);if(a.children&&0<Object.getOwnPropertyNames(a.children).length){var v=a.children;if("tool"===l||"button"===l)if(a.title){var A;a.defaultActionId&&((v=j._commandList[a.defaultActionId])&&(v.visibleWhen?v.visibleWhen(g):1)?(A=new k.CommandInvocation(c,g,h,v,j),A.domParent=
b):a.pretendDefaultActionId=!0);v=j._createDropdownMenu(b,a.title,null,null,a.imageClass,a.tooltip,a.selectionClass,null,A,a.pretendDefaultActionId);p&&m.generateNavGrid(p,v.menuButton);v&&(j._render(a.children,v.menu,g,c,"menu",h,p),j._checkForTrailingSeparator(v.menu,"menu",!0),0===v.menu.childNodes.length?a.emptyGroupMessage?v.menuButton.emptyGroupTooltip||(v.menuButton.emptyGroupTooltip=new e.Tooltip({node:v.menuButton,text:a.emptyGroupMessage,trigger:"click",position:["below","right","above",
"left"]})):(p&&m.removeNavGrid(p,v.menuButton),a=function(a){a&&a.parentNode&&a.parentNode.removeChild(a)},a(v.menu),a(v.menuButton),a(v.destroyButton)):v.menuButton.style.visibility="visible")}else{var f;0<b.childNodes.length&&!j._checkForTrailingSeparator(b,l)&&(f=j.generateSeparatorImage(b));j._render(v,b,g,c,l,h,p);0<b.childNodes.length&&b.childNodes[b.childNodes.length-1]!==f&&(f=j.generateSeparatorImage(b))}else if(a.title){if(a=j._createDropdownMenu(b,a.title,!0,null,null,a.imageClass))j._render(v,
a.menu,g,c,"menu",h,p),j._checkForTrailingSeparator(a.menu,"menu",!0),0===a.menu.childNodes.length&&a.destroyButton&&b.removeChild(a.destroyButton)}else 0<b.childNodes.length&&j._generateMenuSeparator(b),j._render(v,b,g,c,l,h,p),j._generateMenuSeparator(b)}else{var z=j._commandList[a.id],v=z?!0:!1;A=a=null;z&&(s=new k.CommandInvocation(c,g,h,z,j),s.domParent=b,f=v&&(z.visibleWhen?z.visibleWhen(g):!0),j._activeBindings[z.id]&&j._activeBindings[z.id].keyBinding&&(a=j._activeBindings[z.id],a.invocation=
f?s:null,a.bindingOnly&&(v=!1)),j._urlBindings[z.id]&&j._urlBindings[z.id].urlBinding&&(A=j._urlBindings[z.id],A.invocation=f?s:null,A.bindingOnly&&(v=!1)),v=v&&f);v&&(z.choiceCallback?("tool"===l||"button"===l?(a=b,v=!1,"ul"===b.nodeName.toLowerCase()&&(a=document.createElement("li"),b.appendChild(a))):(a=b,v=!0),j._createDropdownMenu(a,z.name,v,function(a){z.populateChoicesMenu(a,g,c,h,j)}.bind(z),z.imageClass,z.tooltip||z.title,z.selectionClass,z.positioningNode)):(s.handler=s.handler||this,s.domParent=
b,v=function(){j._invoke(s)},"menu"===l?(A=null,a&&a.keyBinding&&(A=d.getUserKeyString(a.keyBinding)),a=k.createCommandMenuItem(b,z,s,null,v,A)):(a=l+z.id+n,a=k.createCommandItem(b,z,s,a,null,"tool"===l,v)),m.generateNavGrid(p,a),s.domNode=a,n++))}})},_createDropdownMenu:function(a,g,l,h,d,j,p,s,A,v){a=c.node(a);if(!a||!c.contains(document.body,a))return null;var n,q,i=a;if(l)j=document.createRange(),j.selectNode(a),j=j.createContextualFragment(b),c.processTextNodes(j,{ButtonText:g}),a.appendChild(j),
q=a.lastChild,d=q.lastChild,g=d.previousSibling,g.dropdown=new f.Dropdown({dropdown:d,populate:h,parentDropdown:a.dropdown}),d.dropdown=g.dropdown;else{"ul"===a.nodeName.toLowerCase()&&(i=document.createElement("li"),a.appendChild(i),q=i);a=null;d&&(a="dropdownButtonWithIcon",j=j||g);var j=d?j||g:j,F=k.createDropdownMenu(i,g,h,a,d,!1,p,s,A||v);n=F.dropdownArrow;g=F.menuButton;if(n){A&&(A.domNode=F.menuButton);var m=this;g.onclick=function(a){var p=c.bounds(n);a.clientX>=p.left&&F.dropdown?F.dropdown.toggle(a):
m._invoke(A)};F.dropdown&&(g.onkeydown=function(a){c.KEY.DOWN===a.keyCode&&(F.dropdown.toggle(a),c.stop(a))})}var d=F.menu,J;(h=A&&A.command&&(A.command.tooltip||A.command.name))?J=A.command.tooltip||A.command.name:h&&(J=j);J&&(g.commandTooltip=new e.Tooltip({node:g,text:J,position:["above","below","right","left"]}))}return{menuButton:g,menu:d,dropdown:g.dropdown,destroyButton:q,dropdownArrow:n}},_generateMenuSeparator:function(a){if(!this._checkForTrailingSeparator(a,"menu")){var b=document.createElement("li");
b.classList.add("dropdownSeparator");var e=document.createElement("span");e.classList.add("dropdownSeparator");b.appendChild(e);a.appendChild(b)}},generateSeparatorImage:function(a){var b;b="ul"===a.nodeName.toLowerCase()?document.createElement("li"):document.createElement("span");a.appendChild(b);b.classList.add("core-sprite-sep");b.classList.add("imageSprite");b.classList.add("commandSeparator");return b}};a.prototype.constructor=a;g.prototype={match:function(a){a=i.matchResourceParameters(a);return"undefined"!==
typeof a[this.token]?(this.parameterValue=a[this.token],this):null}};g.prototype.constructor=g;l.prototype.constructor=l;n.prototype={optionsRequested:function(){return this.optionsRequested}};n.prototype.constructor=n;q.prototype={_storeParameters:function(a){this.parameterTable=null;if(a){var b=this.parameterTable={};a.forEach(function(a){b[a.name]=a})}},updateParameters:function(a){"function"===typeof this.getParameters&&this._storeParameters(this.getParameters(a))},hasParameters:function(){return null!==
this.parameterTable},shouldCollectParameters:function(){return!this.clientCollect&&this.hasParameters()},parameterNamed:function(a){return this.parameterTable[a]},valueFor:function(a){return(a=this.parameterTable[a])?a.value:null},setValue:function(a,b){var e=this.parameterTable[a];e&&(e.value=b)},forEach:function(a){for(var b in this.parameterTable)this.parameterTable[b].type&&this.parameterTable[b].name&&a(this.parameterTable[b])},makeCopy:function(){var a=[];this.forEach(function(b){b=new n(b.name,
b.type,b.label,b.value,b.lines,b.eventListeners);a.push(b)});var b=new q(a,this._options,this.getParameters);b.clientCollect=this.clientCollect;return b},hasOptionalParameters:function(){return this._hasOptionalParameters}};q.prototype.constructor=q;return{CommandRegistry:a,URLBinding:g,ParametersDescription:q,CommandParameter:n,CommandEventListener:l}});
(function(k,m){"function"===typeof define&&define.amd?define("orion/Deferred",m):"object"===typeof exports?module.exports=m():(k.orion=k.orion||{},k.orion.Deferred=m())})(this,function(){function k(){for(var e;e=c.shift();)e();f=!1}function m(h){c.push(h);f||(f=!0,e())}function i(e){return function(c){e(c)}}function d(){function e(){for(var a;a=f.shift();){var b=a.deferred,c="fulfilled"===l?"resolve":"reject";a=a[c];if("function"===typeof a)try{var h=a(g),d=h&&("object"===typeof h||"function"===typeof h)&&
h.then;if("function"===typeof d)if(h===b.promise)b.reject(new TypeError);else{var j=h.cancel;"function"===typeof j?b._parentCancel=j.bind(h):delete b._parentCancel;d.call(h,i(b.resolve),i(b.reject),i(b.progress))}else b.resolve(h)}catch(p){b.reject(p)}else b[c](g)}}function c(a){delete q._parentCancel;l="rejected";g=a;f.length&&m(e)}function b(a){function i(a){return function(p){(!l||"assumed"===l)&&a(p)}}delete q._parentCancel;try{var t=a&&("object"===typeof a||"function"===typeof a)&&a.then;if("function"===
typeof t)if(a===q)c(new TypeError);else{l="assumed";var k=a&&a.cancel;if("function"!==typeof k){var y=new d,a=y.promise;try{t(y.resolve,y.reject,y.progress)}catch(u){y.reject(u)}k=a.cancel;t=a.then}g=a;t.call(a,i(b),i(c));q._parentCancel=k.bind(a)}else l="fulfilled",g=a,f.length&&m(e)}catch(p){i(c)(p)}}function a(){var a=q._parentCancel;a?(delete q._parentCancel,a()):l||(a=Error("Cancel"),a.name="Cancel",c(a))}var g,l,f=[],q=this;this.resolve=function(a){l||b(a);return q};this.reject=function(a){l||
c(a);return q};this.progress=function(a){l||f.forEach(function(b){if(b.progress)try{b.progress(a)}catch(e){}});return q.promise};this.cancel=function(){q._parentCancel?setTimeout(a,0):a();return q};this.then=function(a,b,g){var c=new d;c._parentCancel=q.promise.cancel;f.push({resolve:a,reject:b,progress:g,deferred:c});("fulfilled"===l||"rejected"===l)&&m(e);return c.promise};this.promise={then:q.then,cancel:q.cancel}}var c=[],f=!1,e=function(){if("undefined"!==typeof process&&"function"===typeof process.nextTick){var e=
process.nextTick;return function(){e(k)}}if("function"===typeof MutationObserver){var c=document.createElement("div");(new MutationObserver(k)).observe(c,{attributes:!0});return function(){c.setAttribute("class","_tick")}}return function(){setTimeout(k,0)}}();d.all=function(e,c){function b(a,b){f||(l[a]=b,0===--g&&q.resolve(l))}function a(a,e){if(!f){if(c)try{b(a,c(e));return}catch(g){e=g}q.reject(e)}}var g=e.length,l=[],f=!1,q=new d;q.then(void 0,function(){f=!0;e.forEach(function(a){a.cancel&&a.cancel()})});
0===g?q.resolve(l):e.forEach(function(e,g){e.then(b.bind(void 0,g),a.bind(void 0,g))});return q.promise};d.when=function(e,c,b,a){var g;e&&"function"===typeof e.then||(g=new d,g.resolve(e),e=g.promise);return e.then(c,b,a)};return d});
(function(){function k(i,d,c){for(var f in d)d.hasOwnProperty(f)&&(!i.hasOwnProperty(f)||c)?i[f]=d[f]:"object"===typeof d[f]&&k(i[f],d[f],c)}var m=/(^.*(^|\/)nls(\/|$))([^\/]*)\/?([^\/]*)/;define("i18n",["module"],function(i){var d=i.config?i.config():{};return{version:"2.0.1+",load:function(c,f,e,h){h=h||{};h.locale&&(d.locale=h.locale);var j=m.exec(c),b=j[1],a=j[4],g=j[5],l=a.split("-"),n=[],q={},r,i="";j[5]?(b=j[1],c=b+g):(g=j[4],a=d.locale,a||(a=d.locale="undefined"===typeof navigator?"root":
(navigator.language||navigator.userLanguage||"root").toLowerCase()),l=a.split("-"));if(h.isBuild){n.push(c);h=b+"root/"+g;require._fileExists(f.toUrl(h+".js"))&&n.push(h);for(r=0;r<l.length;r++)h=l[r],i+=(i?"-":"")+h,h=n,j=b+i+"/"+g,require._fileExists(f.toUrl(j+".js"))&&h.push(j);f(n,function(){e()})}else f([c],function(a){var c=[],h;h=b;var d=g;a.root&&(c.push("root"),(!0===a.root||1===a.root)&&n.push(h+"root/"+d));for(r=0;r<l.length;r++){h=l[r];h=i+=(i?"-":"")+h;var d=a,p=n,s=b,A=g;d[h]&&(c.push(h),
(!0===d[h]||1===d[h])&&p.push(s+h+"/"+A))}f(n,function(){var p,s,l;for(p=c.length-1;-1<p&&c[p];p--){l=c[p];s=a[l];if(!0===s||1===s)s=f(b+l+"/"+g);k(q,s)}e(q)})})}}})})();define("orion/i18n",{load:function(k,m,i){m.specified&&m.specified("orion/bootstrap")?m(["orion/i18n!"+k],function(d){i(d)}):i({})}});
define("orion/compare/nls/root/messages",{"Copy current change from right to left":"Copy current change from right to left","Copy current change from left to right":"Copy current change from left to right","Switch to unified diff":"Switch to unified diff",Unified:"Unified","Switch to side by side diff":"Switch to side by side diff","Side by side":"Side by side","Generate link of the current diff":"Generate link of the current diff","Generate Link":"Generate Link","Next diff block":"Next diff block",
"Previous diff block":"Previous diff block","Next diff change":"Next diff change","Previous diff change":"Previous diff change","Copy the link URL:":"Copy the link URL:",Compare:"Compare","Open the compare page":"Open the compare page","fetching...":"fetching...","There are unsaved changes.":"There are unsaved changes.","ERROR: ":"ERROR: ","Compare...":"Compare...","files changed":" files changed",Location:"Location",Options:"Options","Sort by folders":"Sort by folders","Line 0 : Col 0":"Line 0 : Col 0",
"No Matching DiffService for location:":"No Matching DiffService for location:","${0} files compared. The two folders are identical.":"${0} files compared. The two folders are identical."});define("orion/compare/nls/messages",["orion/i18n!orion/compare/nls/messages","orion/compare/nls/root/messages"],function(k,m){var i={root:m};Object.keys(k).forEach(function(d){"undefined"===typeof i[d]&&(i[d]=k[d])});return i});
define("orion/compare/diffParser",[],function(){var k=k||{},m=k,i=function(c,f){this._lineDelimiter=c?c:d?"\r\n":"\n";this._diffLineDelimiter=f?f:this._lineDelimiter;this._DEBUG=!1},d=-1!==window.navigator.platform.indexOf("Win");i.prototype={_init:function(){this._oFileContents=[];this._diffContents=[];this._oBlocks=[];this._nBlocks=[];this._hunkRanges=[];this._lastToken=" ";this._deltaMap=[];this._nFileContents=[];this._nNewLineAtEnd=this._oNewLineAtEnd=!0;this._diffContentIndex=1},setLineDelim:function(c){this._diffLineDelimiter=
this._lineDelimiter=c},getDiffArray:function(){return{array:this._diffContents,index:this._diffContentIndex}},parse:function(c,f,e,h){this._init();if(""===f)return{outPutFile:c,mapper:[]};this._oFileContents=""===c?[]:c.split(this._lineDelimiter);this._diffContents=f.split(this._diffLineDelimiter);f=this._diffContents.length;this._hunkRanges=[];for(var d=0;d<f;d++){var b=this._parseHunkRange(d);b&&this._hunkRanges.push(b)}if(0===this._hunkRanges.length)return{outPutFile:c,mapper:[]};this._DEBUG&&
(console.log("***Diff contents: \n"),this._diffContents.forEach(function(a){console.log(a)}),console.log("***Hunk ranges: \n"),console.log(JSON.stringify(this._hunkRanges)));for(c=0;c<this._hunkRanges.length;c++)this._parseHunkBlock(c);this._DEBUG&&(console.log("***Original Hunk range blocks: \n"),console.log(JSON.stringify(this._oBlocks)),console.log("***New Hunk range blocks: \n"),console.log(JSON.stringify(this._nBlocks)));this._buildMap(e);this._DEBUG&&(console.log("***New Line at end of file(original): \n"),
console.log(JSON.stringify(this._oNewLineAtEnd)),console.log("***New Line at end of file(new): \n"),console.log(JSON.stringify(this._nNewLineAtEnd)),console.log("***Mapper: \n"),this._logMap(),console.log("***Total line number in original file: "+this._oFileContents.length));h||this._buildNewFile();return{outPutFile:this._nFileContents.join(this._diffLineDelimiter),mapper:this._deltaMap}},_logMap:function(){for(var c=0;c<this._deltaMap.length;c++)if(console.log(JSON.stringify(this._deltaMap[c])),
0<this._deltaMap[c][2]){console.log("    **Diff content on change/add: \n");for(var f=0;f<this._deltaMap[c][0];f++)console.log("    "+this._diffContents[this._deltaMap[c][2]+f-1])}},_logNewFile:function(){for(var c=0;c<this._nFileContents.length;c++)console.log(this._nFileContents[c])},_createBlock:function(c,f,e,h){h===e&&" "===c||(e=[e,h-e,"s"],"-"===c?e[2]="r":"+"===c?e[2]="a":"c"===c&&(e[2]="c"),f.push(e))},_createMinusBlock:function(c,f,e){var h=this._oBlocks.length;0===h||c!==this._oBlocks[h-
1][0]?(this._oBlocks.push([0===c?1:c,e]),this._nBlocks.push([f,0,-2])):this._oBlocks[h-1][1]+=e},_createPlusBlock:function(c,f,e,h){var d=this._nBlocks.length;0===d||f!==this._nBlocks[d-1][0]?(this._oBlocks.push([0===c?1:c,0]),this._nBlocks.push([f,e,h])):(this._nBlocks[d-1][1]+=e,this._nBlocks[d-1][2]=h)},_parseHunkBlock:function(c){for(var f=" ",e=this._hunkRanges[c][0]+1,h=c===this._hunkRanges.length-1?this._diffContents.length:this._hunkRanges[c+1][0],d=0,b=0,a=this._hunkRanges[c][1],g=this._hunkRanges[c][3],
l=e,n=e;n<h;n++)if(0!==this._diffContents[n].length){var q=this._diffContents[n][0];if("\\"===q&&("\\ No newline at end of file"===this._diffContents[n].substring(0,this._diffContents[n].length-1)||"\\ No newline at end of file"===this._diffContents[n]))"-"===f?this._oNewLineAtEnd=!1:" "===f?this._oNewLineAtEnd=this._nNewLineAtEnd=!1:this._nNewLineAtEnd=!1,n>e&&"\r"===this._diffContents[n-1][this._diffContents[n-1].length-1]&&(this._diffContents[n-1]=this._diffContents[n-1].substring(0,this._diffContents[n-
1].length-1));else{switch(q){case "-":case "+":case " ":break;default:continue}if(f!==q){"+"===q&&(l=n);switch(f){case " ":a=this._hunkRanges[c][1]+d;g=this._hunkRanges[c][3]+b;break;case "-":this._createMinusBlock(a,g,this._hunkRanges[c][1]+d-a);break;case "+":this._createPlusBlock(a,g,this._hunkRanges[c][3]+b-g,l)}f=q}switch(q){case "-":d++;break;case "+":b++;break;case " ":d++,b++}}}switch(f){case "-":this._createMinusBlock(a,g,this._hunkRanges[c][1]+d-a);break;case "+":this._createPlusBlock(a,
g,this._hunkRanges[c][3]+b-g,l)}},_detectConflictes:function(c,f){if(0>c)return!1;for(var e=c+f,h=c;h<e;h++){var d=this._diffContents[h];if(-1<d.indexOf("<<<<<")||-1<d.indexOf(">>>>>"))return!0}return!1},_buildMap:function(c){var f=this._oBlocks.length,e=this._oFileContents.length,h=0,d;d=1;for(var b=0;b<f;b++)d=this._oBlocks[b][0]-d,0<d&&(this._deltaMap.push([d,d,0]),h+=d),c&&this._detectConflictes(this._nBlocks[b][2],this._nBlocks[b][1])?this._deltaMap.push([this._nBlocks[b][1],this._oBlocks[b][1],
this._nBlocks[b][2]+1,1]):this._deltaMap.push([this._nBlocks[b][1],this._oBlocks[b][1],this._nBlocks[b][2]+1]),h+=this._oBlocks[b][1],d=this._oBlocks[b][0]+this._oBlocks[b][1];0<e-d&&(this._deltaMap.push([e-d+1,e-d+1,0]),h+=e-d+1);h<e&&(d=e-h,c=this._deltaMap[this._deltaMap.length-1],0===c[2]?(c[0]+=d,c[1]+=d):-1===c[2]?this._deltaMap.push([d,d,0]):this._nNewLineAtEnd===this._oNewLineAtEnd?this._deltaMap.push([d,d,0]):(this._nNewLineAtEnd&&(c[0]+=d),this._oNewLineAtEnd&&(c[1]+=d)))},_buildNewFile:function(){var c=
1,f=!1,e=this._deltaMap.length,h,d;for(h=0;h<e;h++){f=!1;if(0===this._deltaMap[h][2]){for(d=0;d<this._deltaMap[h][0];d++)this._nFileContents.push(this._oFileContents[c+d-1]);f=!0}else if(0<this._deltaMap[h][2])for(d=0;d<this._deltaMap[h][0];d++)this._nFileContents.push(this._diffContents[this._deltaMap[h][2]+d-1].substring(1));c+=this._deltaMap[h][1]}this._nNewLineAtEnd&&!f&&this._nFileContents.push("")},_converHRangeBody:function(c,f){if(c){var e=parseInt(c,10);f.push(0<=e?e:1)}else f.push(1)},_parseHunkRange:function(c){var f=
this._diffContents[c],e=/^@@\s*\+([\+|\-]*[\d]+)\s*,*\s*([\d]*)\s*-([\+|\-]*[\d]+)\s*,*\s*([\d]*)\s*@@+/,h=/^@@\s*-([\+|\-]*[\d]+)\s*,*\s*([\d]*)\s*\+([\+|\-]*[\d]+)\s*,*\s*([\d]*)\s*@@+/.exec(f),d=null;if(h&&5===h.length)d=[c],this._converHRangeBody(h[1],d),this._converHRangeBody(h[2],d),this._converHRangeBody(h[3],d),this._converHRangeBody(h[4],d);else if((h=e.exec(f))&&5===h.length)d=[c],this._converHRangeBody(h[3],d),this._converHRangeBody(h[4],d),this._converHRangeBody(h[1],d),this._converHRangeBody(h[2],
d);return d}};m.DiffParser=i;return k});
define("orion/URITemplate",[],function(){function k(a){this._text=a}function m(a){return a.replace("%25","%")}function i(a,e){if("U"===e)return encodeURIComponent(a).replace(/[!'()*]/g,function(a){return"%"+a.charCodeAt(0).toString(16).toUpperCase()});if("U+R"===e)return encodeURI(a).replace(/%5B/g,"[").replace(/%5D/g,"]").replace(b,m);if("U+R-,"===e)return encodeURI(a).replace(/%5B/g,"[").replace(/%5D/g,"]").replace(/,/g,"%2C");throw Error("Unknown allowed character set: "+e);}function d(a,b,e){for(var c=
[],h=0;h<a.length;h++)"undefined"!==typeof a[h]&&c.push(i(a[h],b));return c.join(e)}function c(a,b,e,c){for(var h=Object.keys(a),f=[],d=0;d<h.length;d++)"undefined"!==typeof a[h[d]]&&f.push(i(h[d],b)+e+i(a[h[d]],b));return f.join(c)}function f(a){if(0===a.length)throw Error("Invalid Expression: 0 length expression");(this._operator=h[a[0]])?a=a.substring(1):this._operator=h.NUL;for(var b=[],e=a.split(","),c=0;c<e.length;c++){var f=e[c].match(j);if(null===f)throw Error("Bad VarSpec: "+a);b.push({name:f[1],
explode:!!f[2],prefix:f[3]?parseInt(f[3],10):-1})}this._varSpecList=b}function e(a){for(var b=[],e=0,c=a.indexOf("{",e);-1!==c;){b.push(new k(a.substring(e,c)));e=a.indexOf("}",c+1);if(-1===e)throw Error("Invalid template: "+a);b.push(new f(a.substring(c+1,e)));e+=1;c=a.indexOf("{",e)}b.push(new k(a.substring(e)));this._templateComponents=b}var h={NUL:{first:"",sep:",",named:!1,ifemp:"",allow:"U"},"+":{first:"",sep:",",named:!1,ifemp:"",allow:"U+R"},".":{first:".",sep:",",named:!1,ifemp:"",allow:"U"},
"/":{first:"/",sep:"/",named:!1,ifemp:"",allow:"U"},";":{first:";",sep:";",named:!0,ifemp:"",allow:"U"},"?":{first:"?",sep:"&",named:!0,ifemp:"=",allow:"U"},"&":{first:"&",sep:"&",named:!0,ifemp:"=",allow:"U"},"#":{first:"#",sep:",",named:!1,ifemp:"",allow:"U+R"},",":{first:"",sep:",",named:!1,ifemp:"",allow:"U+R-,"}},j=/^((?:(?:[a-zA-Z0-9_])|(?:%[0-9A-F][0-9A-F]))(?:(?:[a-zA-Z0-9_.])|(?:%[0-9A-F][0-9A-F]))*)(?:(\*)|:([0-9]+))?$/,b=/%25[0-9A-F][0-9A-F]/g;k.prototype={expand:function(){return encodeURI(this._text)}};
f.prototype={expand:function(a){for(var b=[],e=0;e<this._varSpecList.length;e++){var h=this._varSpecList[e],f=h.name,j=a[f],w=typeof j;if("undefined"!==w&&null!==j){var t=0===b.length?this._operator.first:this._operator.sep;if("string"===w)this._operator.named&&(t+=i(f,"U+R"),t+=0===j.length?this._operator.ifemp:"="),-1!==h.prefix&&h.prefix<j.length&&(j=j.substring(0,h.prefix)),t+=i(j,this._operator.allow);else if(Array.isArray(j)){if(0===j.length)continue;h.explode?t+=d(j,this._operator.allow,this._operator.sep):
(h=d(j,this._operator.allow,","),this._operator.named&&(t+=i(f,"U+R"),t+=0===h.length?this._operator.ifemp:"="),t+=h)}else if("object"===w){if(0===Object.keys(j).length)continue;h.explode?t+=c(j,this._operator.allow,"=",this._operator.sep):(h=c(j,this._operator.allow,",",","),this._operator.named&&(t+=i(f,"U+R"),t+=0===h.length?this._operator.ifemp:"="),t+=h)}else throw Error("bad param type: "+f+" : "+w);b.push(t)}}return b.join("")}};e.prototype={expand:function(a){for(var b=[],e=0;e<this._templateComponents.length;e++)b.push(this._templateComponents[e].expand(a));
return b.join("")}};return e});
define("orion/compare/compareUtils",["orion/URITemplate"],function(k){var m=m||{};m.compareUtils=m.compareUtils||{};m.compareUtils.lookUpMapper=function(i,d,c){for(var f=0,e=0;e<i.length;e++){var h=i[e][d];0===h&&(h=1);if(c>=f&&c<f+h)return{mapperIndex:e,startFrom:f};if(e===i.length-1)break;f+=i[e][d]}return{mapperIndex:i.length-1,startFrom:f}};m.compareUtils.lookUpLineIndex=function(i,d,c){if(0===c)return 0;for(var f=0,e=0;e<c;e++)f+=i[e][d];return f};m.compareUtils.updateMapper=function(i,d,c,f,
e){if(f!==e&&(0<f||0<e)){var h=m.compareUtils.lookUpMapper(i,d,c);if(!(0>h.mapperIndex)){if(0<f)for(var j=c-h.startFrom,c=h.mapperIndex;c<i.length;c++){j=i[c][d]-j;if(f<=j){i[c][d]-=f;break}i[c][d]-=j;f-=j;j=0}0<e&&(i[h.mapperIndex][d]+=e)}}};m.compareUtils.overlapMapper=function(i,d,c,f,e){i=c+i[d]-1;i<c&&(i=c);e<f&&(e=f);return i<f||e<c?!1:!0};m.compareUtils.findFirstDiff=function(i,d,c,f){for(var e=0,h=null,j=0;j<i.length&&!(e>f)&&(!m.compareUtils.overlapMapper(i[j],d,e,c,f)||!(h={mapperIndex:j,
startFrom:e},0!==i[j][2]));j++)e+=i[j][d];return h};m.compareUtils.matchMapper=function(i,d,c,f){if(0===i.length)return c;var e=c+Math.round((f-c)/3),h=m.compareUtils.findFirstDiff(i,d,c,f),j=0===i[h.mapperIndex][d]?h.startFrom:h.startFrom+i[h.mapperIndex][d]-1,b=m.compareUtils.lookUpLineIndex(i,1-d,h.mapperIndex),a=h.startFrom-c;return 0===i[h.mapperIndex][2]?b-a:e>=h.startFrom&&e<=j?b-Math.round((f-c)/3):e<h.startFrom?b-a:(0===i[h.mapperIndex][1-d]?b:b+i[h.mapperIndex][1-d]-1)-(j-c)};m.compareUtils.getMapperLineCount=
function(i){for(var d=0,c=0;c<i.length;c++)d+=Math.max(i[c][0],i[c][1]);return d};m.compareUtils.getAnnotationIndex=function(i,d){for(var c=0;c<i.length;c++)if(i[c][0]===d)return c;return-1};m.compareUtils.getAnnotationMapperIndex=function(i,d){return i[d][1]};m.compareUtils.getAnnotationIndexByMapper=function(i,d){for(var c=0;c<i.length;c++)if(i[c][1]===d)return{current:c,prev:c-1,next:c+1};return{current:-1,prev:-1,next:-1}};m.compareUtils.isMapperConflict=function(i,d){return 0>d||!i[d][3]?!1:
1===i[d][3]};m.compareUtils.mergeDiffBlocks=function(i,d,c,f,e,h){for(var j=0;j<d.length;j++){var b=d[j][0],a=c[d[j][1]];if(0<a[0]){for(var g="",l=0;l<a[0];l++)g=g+f[a[2]-1+l].substring(e)+h;a=i.getLineCount();b>=a&&(b=i.getLineEnd(a-1),l=i.getLineEnd(a-1,!0),b===l?(i.setText(h,b,b),b=a):b=a-1);b=i.getLineStart(b);i.setText(g,b,b)}}};m.compareUtils.generateCompareHref=function(i,d){var c=require.toUrl("compare/compare.html");d.conflict||(d.conflict=void 0);d.readonly||(d.readonly=void 0);return(new k(c+
"#{,resource,params*}")).expand({resource:i,params:d})};m.compareUtils.generateCompareTreeHref=function(i,d){var c=require.toUrl("compare-tree/compare-tree.html");return(new k(c+"#{,resource,params*}")).expand({resource:i,params:d})};return m.compareUtils});
define("orion/compare/compareRulers",["orion/compare/compareUtils"],function(k){var m=m||{},i=function(c,f,e){this._location=c||"left";this._overview=f||"page";this._rulerStyle=e;this._editor=null;var h=this;this._listener={onModelChanged:function(e){h._onModelChanged(e)}}};i.prototype={setView:function(c){this._onModelChanged&&this._editor&&this._editor.removeEventListener("ModelChanged",this._listener.onModelChanged);this._editor=c;this._onModelChanged&&this._editor&&this._editor.addEventListener("ModelChanged",
this._listener.onModelChanged)},getLocation:function(){return this._location},getOverview:function(){return this._overview},getAnnotationModel:function(){return null},addAnnotationType:function(){},isAnnotationTypeVisible:function(){return!1},removeAnnotationType:function(){},setAnnotationModel:function(){},getAnnotations:function(c,f){for(var e=[],h=c;h<f;h++){var d=this.getStyle(h);d&&(e[h]={html:this.getHTML(h),style:d})}return e},getWidestAnnotation:function(){return{html:this.getHTML(-1),style:this.getStyle(-1)}},
getRulerStyle:function(){return this.getStyle(void 0)}};m.CompareRuler=i;var i=m,d=function(c,f,e,h,d,b){m.CompareRuler.call(this,e,"page",h);this._diffNavigator=c;this._oddStyle=d||{style:{backgroundColor:"white"}};this._evenStyle=b||{style:{backgroundColor:"white"}};this._numOfDigits=0;this._mapperColumnIndex=f};d.prototype=new m.CompareRuler;d.prototype.getStyle=function(c){return void 0===c?this._rulerStyle:this._evenStyle};d.prototype.getHTML=function(c){var f=this._editor.getModel(),e=this._diffNavigator.getFeeder(0===
this._mapperColumnIndex);return!e?"":-1===c?f.getLineCount():e.getLineNumber?(c=e.getLineNumber(c),-1===c?"":c+1):c+1};d.prototype._onModelChanged=function(c){var f=c.start,e=this._editor.getModel(),c=e.getLineCount(),h=(c+"").length;this._numOfDigits!==h&&(this._numOfDigits=h,f=e.getLineAtOffset(f),this._editor.redrawLines(f,c,this))};i.LineNumberCompareRuler=d;i=m;d=function(c,f,e,h){this._diffNavigator=e;this._onClick=h;m.CompareRuler.call(this,c,"document",f)};d.prototype=new m.CompareRuler;d.prototype.getStyle=
function(c){var f,e;if(void 0===c)f=this._rulerStyle||{},e=f.style||(f.style={}),e.lineHeight="1px",e.fontSize="1px",e.width="14px";else if(f=-1!==c?{styleClass:"annotationOverview breakpoint"}:{},e=f.style||(f.style={}),e.cursor="pointer",e.width="8px",e.left="2px",0<=c){var h;if(this._diffNavigator&&this._diffNavigator.getFeeder())h=this._diffNavigator.getFeeder().getDiffBlocks();else return null;c=k.getAnnotationIndex(h,c);if(-1===c)return null;h=k.getAnnotationMapperIndex(h,c);var d;d=this._diffNavigator.getMapper();
if(h=k.isMapperConflict(d,h))e.border="1px #FF0000 solid";c===this._diffNavigator.getCurrentBlockIndex()&&(e.backgroundColor=h?"red":"blue");c=this._diffNavigator.getFeeder().getDiffBlockH(c);h=this._diffNavigator.getFeeder().getOverviewLineCount();if(0>c)return null;d=this._editor.getClientArea();c=Math.floor(d.height*c/h);2>c&&(c=2);e.height=c+"px"}else return null;return f};d.prototype.setDiffNavigator=function(c){this._diffNavigator=c};d.prototype.getHTML=function(){return"&nbsp;"};d.prototype.onClick=
function(c){void 0!==c&&this._onClick(c,this)};d.prototype._onModelChanged=function(){0<this._editor.getModel().getLineCount()&&this._editor.redrawLines(0,1,this)};i.CompareOverviewRuler=d;i=function(c){this._canvasDiv=c;this._mapper=void 0};i.prototype={init:function(c,f,e,h){this._rightIniting=this._rightIniting=this._leftIniting=!0;this._mapper=c;this._leftEditor=f;this._rightEditor=e;this._leftTextView=f.getTextView();this._rightTextView=e.getTextView();this._diffNavigator=h;this.render()},matchPositionFrom:function(c){var f=
c?this._leftTextView:this._rightTextView,e=c?this._rightTextView:this._leftTextView,h=f.getTopIndex(),f=f.getBottomIndex(),c=k.matchMapper(this._mapper,c?0:1,h,f);e.setTopIndex(c)},copyTo:function(c){if(this._diffNavigator.iterator){var f=this._diffNavigator.iterator.cursor();if(f&&("word"===f.type?!f.copied&&!f.parent.copied:!f.copied)){var e=c?this._rightTextView.getText(f.oldA.start,f.oldA.end):this._leftTextView.getText(f.newA.start,f.newA.end),h=c?f.newA:f.oldA;(c?this._leftTextView:this._rightTextView).setText(e,
h.start,h.end);f.copied=!0}}},render:function(){if(this._mapper){var c=this._canvasDiv.getContext("2d");c.clearRect(0,0,this._canvasDiv.width,this._canvasDiv.height);c.strokeStyle="#AAAAAA";c.lineWidth=1;c.beginPath();var f=this._leftTextView.getTopIndex(),e=this._leftTextView.getBottomIndex(),h=this._rightTextView.getTopIndex(),d=this._rightTextView.getBottomIndex();this._leftLineH=this._leftTextView.getLineHeight();this._rightLineH=this._rightTextView.getLineHeight();for(var b=0,a=0,g=!1,l=0;l<
this._mapper.length;l++){if(0!==this._mapper[l][2])if(k.overlapMapper(this._mapper[l],0,b,f,e)||k.overlapMapper(this._mapper[l],1,a,h,d))this._renderCurve(l,b,a,this._canvasDiv,c,f,e,h,d),g=!0;else if(g)break;b+=this._mapper[l][0];a+=this._mapper[l][1]}c.stroke()}},_renderCurve:function(c,f,e,h,d){var b=this._mapper[c],f=this._leftTextView.getLinePixel(f+b[0]/2)+b[0]%2*this._leftLineH/3-this._leftTextView.getTopPixel(),e=this._rightTextView.getLinePixel(e+b[1]/2)+b[1]%2*this._rightLineH/3-this._rightTextView.getTopPixel(),
h=h.parentNode.clientWidth;c===this._diffNavigator.getCurrentMapperIndex()?(d.stroke(),d.strokeStyle="#000",d.lineWidth=1,d.beginPath(),d.moveTo(0,f),d.bezierCurveTo(h/3,f,0.666*h,e,h,e),d.stroke(),d.strokeStyle="#AAAAAA",d.lineWidth=1,d.beginPath()):(d.moveTo(0,f),d.bezierCurveTo(h/3,f,0.666*h,e,h,e),d.stroke())},onChanged:function(c,f){var e=f?this._rightIniting:this._leftIniting;if(c.removedLineCount!==c.addedLineCount){var h=f?this._rightTextView:this._leftTextView;e||k.updateMapper(this._mapper,
f?1:0,h.getModel().getLineAtOffset(c.start),c.removedLineCount,c.addedLineCount);(0<c.removedLineCount||0<c.addedLineCount)&&this.render()}f?this._rightIniting=!1:this._leftIniting=!1;return e}};m.CompareCurveRuler=i;return m});define("orion/editor/i18n",{load:function(k,m,i){m.specified&&m.specified("orion/bootstrap")?m(["orion/i18n!"+k],function(d){i(d)}):i({})}});
define("orion/editor/nls/root/messages",{multipleAnnotations:"Multiple annotations:",line:"Line: ${0}",breakpoint:"Breakpoint",bookmark:"Bookmark",task:"Task",error:"Error",warning:"Warning",matchingSearch:"Matching Search",currentSearch:"Current Search",currentLine:"Current Line",matchingBracket:"Matching Bracket",currentBracket:"Current Bracket",lineUp:"Line Up",lineDown:"Line Down",lineStart:"Line Start",lineEnd:"Line End",charPrevious:"Previous Character",charNext:"Next Character",pageUp:"Page Up",
pageDown:"Page Down",scrollPageUp:"Scroll Page Up",scrollPageDown:"Scroll Page Down",scrollLineUp:"Scroll Line Up",scrollLineDown:"Scroll Line Down",wordPrevious:"Previous Word",wordNext:"Next Word",textStart:"Document Start",textEnd:"Document End",scrollTextStart:"Scroll Document Start",scrollTextEnd:"Scroll Document End",centerLine:"Center Line",selectLineUp:"Select Line Up",selectLineDown:"Select Line Down",selectWholeLineUp:" Select Whole Line Up",selectWholeLineDown:"Select Whole Line Down",
selectLineStart:"Select Line Start",selectLineEnd:"Select Line End",selectCharPrevious:"Select Previous Character",selectCharNext:"Select Next Character",selectPageUp:"Select Page Up",selectPageDown:"Select Page Down",selectWordPrevious:"Select Previous Word",selectWordNext:"Select Next Word",selectTextStart:"Select Document Start",selectTextEnd:"Select Document End",deletePrevious:"Delete Previous Character",deleteNext:"Delete Next Character",deleteWordPrevious:"Delete Previous Word",deleteWordNext:"Delete Next Word",
deleteLineStart:"Delete Line Start",deleteLineEnd:"Delete Line End",tab:"Insert Tab",enter:"Insert Line Delimiter",enterNoCursor:"Insert Line Delimiter",selectAll:"Select All",copy:"Copy",cut:"Cut",paste:"Paste",uppercase:"To Upper Case",lowercase:"To Lower Case",capitalize:"Capitalize",reversecase:"Reverse Case",toggleWrapMode:"Toggle Wrap Mode",toggleTabMode:"Toggle Tab Mode",toggleOverwriteMode:"Toggle Overwrite Mode",committerOnTime:"${0} on ${1}",emacs:"Emacs",exchangeMarkPoint:"Exchange Mark and Point",
setMarkCommand:"Set Mark",clearMark:"Clear Mark",digitArgument:"Digit Argument ${0}",negativeArgument:"Negative Argument",Comment:"Comment","Flat outline":"Flat outline",incrementalFindStr:"Incremental find: ${0}",incrementalFindStrNotFound:"Incremental find: ${0} (not found)",incrementalFindReverseStr:"Reverse Incremental find: ${0}",incrementalFindReverseStrNotFound:"Reverse Incremental find: ${0} (not found)",find:"Find...",undo:"Undo",redo:"Redo",cancelMode:"Cancel Current Mode",findNext:"Find Next Occurrence",
findPrevious:"Find Previous Occurrence",incrementalFind:"Incremental Find",incrementalFindReverse:"Incremental Find Reverse",indentLines:"Indent Lines",unindentLines:"Unindent Lines",moveLinesUp:"Move Lines Up",moveLinesDown:"Move Lines Down",copyLinesUp:"Copy Lines Up",copyLinesDown:"Copy Lines Down",deleteLines:"Delete Lines",gotoLine:"Goto Line...",gotoLinePrompty:"Goto Line:",nextAnnotation:"Next Annotation",prevAnnotation:"Previous Annotation",expand:"Expand",collapse:"Collapse",expandAll:"Expand All",
collapseAll:"Collapse All",lastEdit:"Last Edit Location",trimTrailingWhitespaces:"Trim Trailing Whitespaces",toggleLineComment:"Toggle Line Comment",addBlockComment:"Add Block Comment",removeBlockComment:"Remove Block Comment",linkedModeEntered:"Linked Mode entered",linkedModeExited:"Linked Mode exited",syntaxError:"Syntax Error",contentAssist:"Content Assist",lineColumn:"Line ${0} : Col ${1}",vi:"vi",vimove:"(Move)",viyank:"(Yank)",videlete:"(Delete)",vichange:"(Change)",viLeft:"${0} Left",viRight:"${0} Right",
viUp:"${0} Up",viDown:"${0} Down",viw:"${0} Next Word",vib:"${0} Beginning of Word",viW:"${0} Next Word (ws stop)",viB:"${0} Beginning of Word (ws stop)",vie:"${0} End of Word",viE:"${0} End of Word (ws stop)",vi$:"${0} End of the line","vi^_":"${0} First non-blank Char Current Line","vi+":"${0} First Char Next Line","vi-":"${0} First Char Previous Line","vi|":"${0} nth Column in Line",viH:"${0} Top of Page",viM:"${0} Middle of Page",viL:"${0} Bottom of Page","vi/":"${0} Search Forward","vi?":"${0} Search Backward",
vin:"${0} Next Search",viN:"${0} Previous Search",vif:"${0} Search Char Fwd",viF:"${0} Search Char Bckwd",vit:"${0} Search Before Char Fwd",viT:"${0} Search Before Char Bckwd","vi,":"${0} Repeat Reverse Char Search","vi;":"${0} Repeat Char Search",viG:"${0} Go to Line",viycd:"${0} Current Line",via:"Append After Cursor",viA:"Append to End of Line",vii:"Insert Before Cursor",viI:"Insert at Beginning of Line",viO:"Insert Line Above",vio:"Insert Line Below",viR:"Begin Overwriting Text",vis:"Substitute a Character",
viS:"Substitute Entire Line",viC:"Change Text Until Line End",vip:"Paste After Char or Line",viP:"Paste Before Char or Line",viStar:"Search Word Under Cursor",replaceAll:"Replacing all...",replacedMatches:"Replaced ${0} matches",nothingReplaced:"Nothing replaced",notFound:"Not found"});
define("orion/editor/nls/messages",["orion/editor/i18n!orion/editor/nls/messages","orion/editor/nls/root/messages"],function(k,m){var i={root:m},d;for(d in k)k.hasOwnProperty(d)&&"undefined"===typeof i[d]&&(i[d]=k[d]);return i});
define("orion/editor/eventTarget",[],function(){function k(){}k.addMixin=function(m){var i=k.prototype,d;for(d in i)i.hasOwnProperty(d)&&(m[d]=i[d])};k.prototype={addEventListener:function(k,i,d){this._eventTypes||(this._eventTypes={});var c=this._eventTypes[k];c||(c=this._eventTypes[k]={level:0,listeners:[]});c.listeners.push({listener:i,useCapture:d})},dispatchEvent:function(k){var i=k.type;this._dispatchEvent("pre"+i,k);this._dispatchEvent(i,k);this._dispatchEvent("post"+i,k)},_dispatchEvent:function(k,
i){var d=this._eventTypes?this._eventTypes[k]:null;if(d){var c=d.listeners;try{if(d.level++,c)for(var f=0,e=c.length;f<e;f++)if(c[f]){var h=c[f].listener;"function"===typeof h?h.call(this,i):h.handleEvent&&"function"===typeof h.handleEvent&&h.handleEvent(i)}}finally{if(d.level--,d.compact&&0===d.level){for(f=c.length-1;0<=f;f--)c[f]||c.splice(f,1);0===c.length&&delete this._eventTypes[k];d.compact=!1}}}},isListening:function(k){return!this._eventTypes?!1:void 0!==this._eventTypes[k]},removeEventListener:function(k,
i,d){if(this._eventTypes){var c=this._eventTypes[k];if(c){for(var f=c.listeners,e=0,h=f.length;e<h;e++){var j=f[e];if(j&&j.listener===i&&j.useCapture===d){0!==c.level?(f[e]=null,c.compact=!0):f.splice(e,1);break}}0===f.length&&delete this._eventTypes[k]}}}};return{EventTarget:k}});define("orion/regex",[],function(){return{escape:function(k){return k.replace(/([\\$\^*\/+?\.\(\)|{}\[\]])/g,"\\$&")},parse:function(k){return(k=/^\s*\/(.+)\/([gim]{0,3})\s*$/.exec(k))?{pattern:k[1],flags:k[2]}:null}}});
define("orion/editor/textModel",["orion/editor/eventTarget","orion/regex","orion/util"],function(k,m,i){function d(c,f){this._lastLineIndex=-1;this._text=[""];this._lineOffsets=[0];this.setText(c);this.setLineDelimiter(f)}d.prototype={destroy:function(){},find:function(c){1<this._text.length&&(this._text=[this._text.join("")]);var f=c.string,e=c.regex,h=f,d="",b=c.caseInsensitive;if(h)if(e){if(f=m.parse(h))h=f.pattern,d=f.flags}else h=f.replace(/([\\$\^*\/+?\.\(\)|{}\[\]])/g,"\\$&"),b&&(h=h.replace(/[iI\u0130\u0131]/g,
"[Ii\u0130\u0131]"));var a=null,g;if(h){var f=c.reverse,l=c.wrap,e=c.wholeWord,n=c.start||0,c=c.end,q=null!==c&&void 0!==c;-1===d.indexOf("g")&&(d+="g");-1===d.indexOf("m")&&(d+="m");b&&-1===d.indexOf("i")&&(d+="i");e&&(h="\\b"+h+"\\b");var r=this._text[0],i,k,x=0;q&&(b=n<c?n:c,r=r.substring(b,n<c?c:n),x=b);var y=RegExp(h,d);f?g=function(){var a=null;for(y.lastIndex=0;;){k=y.lastIndex;i=y.exec(r);if(k===y.lastIndex)return null;if(i){if(!(i.index+x<n)){if(!l||a)break;n=r.length+x}a={start:i.index+
x,end:y.lastIndex+x}}else break}a&&(n=a.start);return a}:(q||(y.lastIndex=n),g=function(){for(;;){k=y.lastIndex;i=y.exec(r);if(k===y.lastIndex)break;if(i)return{start:i.index+x,end:y.lastIndex+x};if(!(0!==k&&l))break}return null});a=g()}return{next:function(){var b=a;b&&(a=g());return b},hasNext:function(){return null!==a}}},getCharCount:function(){for(var c=0,f=0;f<this._text.length;f++)c+=this._text[f].length;return c},getLine:function(c,f){var e=this.getLineCount();if(!(0<=c&&c<e))return null;
var h=this._lineOffsets[c];if(c+1<e){e=this.getText(h,this._lineOffsets[c+1]);if(f)return e;for(var h=e.length,d;10===(d=e.charCodeAt(h-1))||13===d;)h--;return e.substring(0,h)}return this.getText(h)},getLineAtOffset:function(c){var f=this.getCharCount();if(!(0<=c&&c<=f))return-1;var e=this.getLineCount();if(c===f)return e-1;var h,d,b=this._lastLineIndex;if(0<=b&&b<e&&(h=this._lineOffsets[b],d=b+1<e?this._lineOffsets[b+1]:f,h<=c&&c<d))return b;for(var a=e,g=-1;1<a-g;)if(b=Math.floor((a+g)/2),h=this._lineOffsets[b],
d=b+1<e?this._lineOffsets[b+1]:f,c<=h)a=b;else if(c<d){a=b;break}else g=b;return this._lastLineIndex=a},getLineCount:function(){return this._lineOffsets.length},getLineDelimiter:function(){return this._lineDelimiter},getLineEnd:function(c,d){var e=this.getLineCount();if(!(0<=c&&c<e))return-1;if(c+1<e){e=this._lineOffsets[c+1];if(d)return e;for(var h=this.getText(Math.max(this._lineOffsets[c],e-2),e),j=h.length,b;10===(b=h.charCodeAt(j-1))||13===b;)j--;return e-(h.length-j)}return this.getCharCount()},
getLineStart:function(c){return!(0<=c&&c<this.getLineCount())?-1:this._lineOffsets[c]},getText:function(c,d){void 0===c&&(c=0);void 0===d&&(d=this.getCharCount());if(c===d)return"";for(var e=0,h=0,j;h<this._text.length;){j=this._text[h].length;if(c<=e+j)break;e+=j;h++}for(var b=e,a=h;h<this._text.length;){j=this._text[h].length;if(d<=e+j)break;e+=j;h++}if(a===h)return this._text[a].substring(c-b,d-e);b=this._text[a].substring(c-b);e=this._text[h].substring(0,d-e);return b+this._text.slice(a+1,h).join("")+
e},onChanging:function(c){return this.dispatchEvent(c)},onChanged:function(c){return this.dispatchEvent(c)},setLineDelimiter:function(c,d){"auto"===c&&(c=void 0,1<this.getLineCount()&&(c=this.getText(this.getLineEnd(0),this.getLineEnd(0,!0))));this._lineDelimiter=c?c:i.platformDelimiter;if(d){var e=this.getLineCount();if(1<e){for(var h=Array(e),j=0;j<e;j++)h[j]=this.getLine(j);this.setText(h.join(this._lineDelimiter))}}},setText:function(c,d,e){void 0===c&&(c="");void 0===d&&(d=0);void 0===e&&(e=
this.getCharCount());if(!(d===e&&""===c)){for(var h=this.getLineAtOffset(d),j=this.getLineAtOffset(e),b=d,a=e-d,g=j-h,l=c.length,n=0,q=this.getLineCount(),r=0,i=0,k=0,m=[];;){-1!==r&&r<=k&&(r=c.indexOf("\r",k));-1!==i&&i<=k&&(i=c.indexOf("\n",k));if(-1===i&&-1===r)break;k=-1!==r&&-1!==i?r+1===i?i+1:(r<i?r:i)+1:-1!==r?r+1:i+1;m.push(d+k);n++}this.onChanging({type:"Changing",text:c,start:b,removedCharCount:a,addedCharCount:l,removedLineCount:g,addedLineCount:n});0===m.length&&(k=this.getLineStart(h),
j=j+1<q?this.getLineStart(j+1):this.getCharCount(),d!==k&&(c=this.getText(k,d)+c,d=k),e!==j&&(c+=this.getText(e,j),e=j));k=l-a;for(j=h+g+1;j<q;j++)this._lineOffsets[j]+=k;if(5E4>m.length)h=[h+1,g].concat(m),Array.prototype.splice.apply(this._lineOffsets,h);else{k=h+1;this._lineOffsets.splice(k,g);for(q=0;q<m.length;q+=5E4)h=[k,0].concat(m.slice(q,Math.min(m.length,q+5E4))),Array.prototype.splice.apply(this._lineOffsets,h),k+=5E4}for(k=q=0;k<this._text.length;){j=this._text[k].length;if(d<=q+j)break;
q+=j;k++}h=q;for(m=k;k<this._text.length;){j=this._text[k].length;if(e<=q+j)break;q+=j;k++}j=this._text[k];d=this._text[m].substring(0,d-h);e=j.substring(e-q);m=[m,k-m+1];d&&m.push(d);c&&m.push(c);e&&m.push(e);Array.prototype.splice.apply(this._text,m);0===this._text.length&&(this._text=[""]);this.onChanged({type:"Changed",start:b,removedCharCount:a,addedCharCount:l,removedLineCount:g,addedLineCount:n})}}};k.EventTarget.addMixin(d.prototype);return{TextModel:d}});
define("orion/keyBinding",["orion/util"],function(k){function m(d,c,f,e,h,j){this.type=j||"keydown";this.keyCode="string"===typeof d&&"keydown"===this.type?d.toUpperCase().charCodeAt(0):d;this.mod1=void 0!==c&&null!==c?c:!1;this.mod2=void 0!==f&&null!==f?f:!1;this.mod3=void 0!==e&&null!==e?e:!1;this.mod4=void 0!==h&&null!==h?h:!1}function i(d){this.keys=d}m.prototype={getKeys:function(){return[this]},match:function(d,c){if(void 0!==c){if(0!==c)return!1}else if(d instanceof Array){if(1<d.length)return!1;
d=d[0]}return d.type!==this.type?!1:this.keyCode===d.keyCode||this.keyCode===String.fromCharCode(k.isOpera?d.which:void 0!==d.charCode?d.charCode:d.keyCode)?this.mod1!==(k.isMac?d.metaKey:d.ctrlKey)||"keydown"===this.type&&this.mod2!==d.shiftKey||this.mod3!==d.altKey||k.isMac&&this.mod4!==d.ctrlKey?!1:!0:!1},equals:function(d){return!d||this.keyCode!==d.keyCode||this.mod1!==d.mod1||this.mod2!==d.mod2||this.mod3!==d.mod3||this.mod4!==d.mod4||this.type!==d.type?!1:!0}};i.prototype={getKeys:function(){return this.keys.slice(0)},
match:function(d,c){var f=this.keys;if(void 0!==c)return c>f.length?!1:f[c].match(d)?c===f.length-1?!0:c+1:!1;d instanceof Array||(d=[d]);if(d.length>f.length)return!1;var e;for(e=0;e<d.length;e++)if(!f[e].match(d[e]))return!1;return e===f.length?!0:e},equals:function(d){if(!d.keys||d.keys.length!==this.keys.length)return!1;for(var c=0;c<d.keys.length;c++)if(!d.keys[c].equals(this.keys[c]))return!1;return!0}};return{KeyBinding:m,KeyStroke:m,KeySequence:i}});
define("orion/editor/keyModes",["orion/keyBinding","orion/util"],function(k,m){function i(c){c&&(this._view=c,this._keyBindings=this.createKeyBindings(),this._keyBindingIndex=0)}function d(c){i.call(this,c)}i.prototype={createKeyBindings:function(){return[]},getKeyBindings:function(c){for(var d=[],e=this._keyBindings,h=0;h<e.length;h++)e[h].actionID===c&&d.push(e[h].keyBinding);return d},getView:function(){return this._view},isActive:function(){return-1!==this._view.getKeyModes().indexOf(this)},match:function(c){if("keydown"===
c.type)switch(c.keyCode){case 16:case 17:case 18:case 91:return}for(var d=this._keyBindingIndex,e=this._matchingKeyBindings||this._keyBindings,h=[],j=0;j<e.length;j++){var b=e[j],a=b.keyBinding.match(c,d);if(!0===a)return this._keyBindingIndex=0,this._matchingKeyBindings=null,b.actionID;"number"===typeof a&&h.push(b)}if(0===h.length)this._keyBindingIndex=0,this._matchingKeyBindings=null;else return this._keyBindingIndex++,this._matchingKeyBindings=h,"noop"},setKeyBinding:function(c,d){for(var e=this._keyBindings,
h=0;h<e.length;h++){var j=e[h];if(j.keyBinding.equals(c)){d?j.actionID=d:j.predefined?j.actionID="noop":e.splice(h,1);return}}d&&e.push({keyBinding:c,actionID:d})},setView:function(c){this._view=c}};d.prototype=new i;d.prototype.createKeyBindings=function(){var c=k.KeyBinding,d=[];d.push({actionID:"lineUp",keyBinding:new c(38),predefined:!0});d.push({actionID:"lineDown",keyBinding:new c(40),predefined:!0});d.push({actionID:"charPrevious",keyBinding:new c(37),predefined:!0});d.push({actionID:"charNext",
keyBinding:new c(39),predefined:!0});m.isMac?(d.push({actionID:"scrollPageUp",keyBinding:new c(33),predefined:!0}),d.push({actionID:"scrollPageDown",keyBinding:new c(34),predefined:!0}),d.push({actionID:"pageUp",keyBinding:new c(33,null,null,!0),predefined:!0}),d.push({actionID:"pageDown",keyBinding:new c(34,null,null,!0),predefined:!0}),d.push({actionID:"lineStart",keyBinding:new c(37,!0),predefined:!0}),d.push({actionID:"lineEnd",keyBinding:new c(39,!0),predefined:!0}),d.push({actionID:"wordPrevious",
keyBinding:new c(37,null,null,!0),predefined:!0}),d.push({actionID:"wordNext",keyBinding:new c(39,null,null,!0),predefined:!0}),d.push({actionID:"scrollTextStart",keyBinding:new c(36),predefined:!0}),d.push({actionID:"scrollTextEnd",keyBinding:new c(35),predefined:!0}),d.push({actionID:"textStart",keyBinding:new c(38,!0),predefined:!0}),d.push({actionID:"textEnd",keyBinding:new c(40,!0),predefined:!0}),d.push({actionID:"scrollPageUp",keyBinding:new c(38,null,null,null,!0),predefined:!0}),d.push({actionID:"scrollPageDown",
keyBinding:new c(40,null,null,null,!0),predefined:!0}),d.push({actionID:"lineStart",keyBinding:new c(37,null,null,null,!0),predefined:!0}),d.push({actionID:"lineEnd",keyBinding:new c(39,null,null,null,!0),predefined:!0}),d.push({actionID:"lineStart",keyBinding:new c(38,null,null,!0),predefined:!0}),d.push({actionID:"lineEnd",keyBinding:new c(40,null,null,!0),predefined:!0})):(d.push({actionID:"pageUp",keyBinding:new c(33),predefined:!0}),d.push({actionID:"pageDown",keyBinding:new c(34),predefined:!0}),
d.push({actionID:"lineStart",keyBinding:new c(36),predefined:!0}),d.push({actionID:"lineEnd",keyBinding:new c(35),predefined:!0}),d.push({actionID:"wordPrevious",keyBinding:new c(37,!0),predefined:!0}),d.push({actionID:"wordNext",keyBinding:new c(39,!0),predefined:!0}),d.push({actionID:"textStart",keyBinding:new c(36,!0),predefined:!0}),d.push({actionID:"textEnd",keyBinding:new c(35,!0),predefined:!0}));m.isFirefox&&m.isLinux&&(d.push({actionID:"lineUp",keyBinding:new c(38,!0),predefined:!0}),d.push({actionID:"lineDown",
keyBinding:new c(40,!0),predefined:!0}));m.isWindows&&(d.push({actionID:"scrollLineUp",keyBinding:new c(38,!0),predefined:!0}),d.push({actionID:"scrollLineDown",keyBinding:new c(40,!0),predefined:!0}));d.push({actionID:"selectLineUp",keyBinding:new c(38,null,!0),predefined:!0});d.push({actionID:"selectLineDown",keyBinding:new c(40,null,!0),predefined:!0});d.push({actionID:"selectCharPrevious",keyBinding:new c(37,null,!0),predefined:!0});d.push({actionID:"selectCharNext",keyBinding:new c(39,null,!0),
predefined:!0});d.push({actionID:"selectPageUp",keyBinding:new c(33,null,!0),predefined:!0});d.push({actionID:"selectPageDown",keyBinding:new c(34,null,!0),predefined:!0});m.isMac?(d.push({actionID:"selectLineStart",keyBinding:new c(37,!0,!0),predefined:!0}),d.push({actionID:"selectLineEnd",keyBinding:new c(39,!0,!0),predefined:!0}),d.push({actionID:"selectWordPrevious",keyBinding:new c(37,null,!0,!0),predefined:!0}),d.push({actionID:"selectWordNext",keyBinding:new c(39,null,!0,!0),predefined:!0}),
d.push({actionID:"selectTextStart",keyBinding:new c(36,null,!0),predefined:!0}),d.push({actionID:"selectTextEnd",keyBinding:new c(35,null,!0),predefined:!0}),d.push({actionID:"selectTextStart",keyBinding:new c(38,!0,!0),predefined:!0}),d.push({actionID:"selectTextEnd",keyBinding:new c(40,!0,!0),predefined:!0}),d.push({actionID:"selectLineStart",keyBinding:new c(37,null,!0,null,!0),predefined:!0}),d.push({actionID:"selectLineEnd",keyBinding:new c(39,null,!0,null,!0),predefined:!0}),d.push({actionID:"selectLineStart",
keyBinding:new c(38,null,!0,!0),predefined:!0}),d.push({actionID:"selectLineEnd",keyBinding:new c(40,null,!0,!0),predefined:!0})):(m.isLinux&&(d.push({actionID:"selectWholeLineUp",keyBinding:new c(38,!0,!0),predefined:!0}),d.push({actionID:"selectWholeLineDown",keyBinding:new c(40,!0,!0),predefined:!0})),d.push({actionID:"selectLineStart",keyBinding:new c(36,null,!0),predefined:!0}),d.push({actionID:"selectLineEnd",keyBinding:new c(35,null,!0),predefined:!0}),d.push({actionID:"selectWordPrevious",
keyBinding:new c(37,!0,!0),predefined:!0}),d.push({actionID:"selectWordNext",keyBinding:new c(39,!0,!0),predefined:!0}),d.push({actionID:"selectTextStart",keyBinding:new c(36,!0,!0),predefined:!0}),d.push({actionID:"selectTextEnd",keyBinding:new c(35,!0,!0),predefined:!0}));d.push({actionID:"undo",keyBinding:new k.KeyBinding("z",!0),predefined:!0});m.isMac?d.push({actionID:"redo",keyBinding:new k.KeyBinding("z",!0,!0),predefined:!0}):d.push({actionID:"redo",keyBinding:new k.KeyBinding("y",!0),predefined:!0});
d.push({actionID:"deletePrevious",keyBinding:new c(8),predefined:!0});d.push({actionID:"deletePrevious",keyBinding:new c(8,null,!0),predefined:!0});d.push({actionID:"deleteNext",keyBinding:new c(46),predefined:!0});d.push({actionID:"deleteWordPrevious",keyBinding:new c(8,!0),predefined:!0});d.push({actionID:"deleteWordPrevious",keyBinding:new c(8,!0,!0),predefined:!0});d.push({actionID:"deleteWordNext",keyBinding:new c(46,!0),predefined:!0});d.push({actionID:"tab",keyBinding:new c(9),predefined:!0});
d.push({actionID:"shiftTab",keyBinding:new c(9,null,!0),predefined:!0});d.push({actionID:"enter",keyBinding:new c(13),predefined:!0});d.push({actionID:"enter",keyBinding:new c(13,null,!0),predefined:!0});d.push({actionID:"selectAll",keyBinding:new c("a",!0),predefined:!0});d.push({actionID:"toggleTabMode",keyBinding:new c("m",!0),predefined:!0});m.isMac&&(d.push({actionID:"deleteNext",keyBinding:new c(46,null,!0),predefined:!0}),d.push({actionID:"deleteWordPrevious",keyBinding:new c(8,null,null,!0),
predefined:!0}),d.push({actionID:"deleteWordNext",keyBinding:new c(46,null,null,!0),predefined:!0}));d.push({actionID:"toggleWrapMode",keyBinding:new k.KeyBinding("w",!0,!1,!0)});d.push({actionID:"toggleOverwriteMode",keyBinding:new k.KeyBinding(45)});if(!m.isFirefox){var e=m.isMac&&m.isChrome;d.push({actionID:"noop",keyBinding:new c("u",!e,!1,!1,e),predefined:!0});d.push({actionID:"noop",keyBinding:new c("i",!e,!1,!1,e),predefined:!0});d.push({actionID:"noop",keyBinding:new c("b",!e,!1,!1,e),predefined:!0})}m.isFirefox&&
(d.push({actionID:"copy",keyBinding:new c(45,!0),predefined:!0}),d.push({actionID:"paste",keyBinding:new c(45,null,!0),predefined:!0}),d.push({actionID:"cut",keyBinding:new c(46,null,!0),predefined:!0}));m.isMac&&(d.push({actionID:"lineStart",keyBinding:new c("a",!1,!1,!1,!0),predefined:!0}),d.push({actionID:"lineEnd",keyBinding:new c("e",!1,!1,!1,!0),predefined:!0}),d.push({actionID:"lineUp",keyBinding:new c("p",!1,!1,!1,!0),predefined:!0}),d.push({actionID:"lineDown",keyBinding:new c("n",!1,!1,
!1,!0),predefined:!0}),d.push({actionID:"charPrevious",keyBinding:new c("b",!1,!1,!1,!0),predefined:!0}),d.push({actionID:"charNext",keyBinding:new c("f",!1,!1,!1,!0),predefined:!0}),d.push({actionID:"deletePrevious",keyBinding:new c("h",!1,!1,!1,!0),predefined:!0}),d.push({actionID:"deleteNext",keyBinding:new c("d",!1,!1,!1,!0),predefined:!0}),d.push({actionID:"deleteLineEnd",keyBinding:new c("k",!1,!1,!1,!0),predefined:!0}),m.isFirefox?(d.push({actionID:"scrollPageDown",keyBinding:new c("v",!1,
!1,!1,!0),predefined:!0}),d.push({actionID:"deleteLineStart",keyBinding:new c("u",!1,!1,!1,!0),predefined:!0}),d.push({actionID:"deleteWordPrevious",keyBinding:new c("w",!1,!1,!1,!0),predefined:!0})):(d.push({actionID:"pageDown",keyBinding:new c("v",!1,!1,!1,!0),predefined:!0}),d.push({actionID:"centerLine",keyBinding:new c("l",!1,!1,!1,!0),predefined:!0}),d.push({actionID:"enterNoCursor",keyBinding:new c("o",!1,!1,!1,!0),predefined:!0})));return d};return{KeyMode:i,DefaultKeyMode:d}});
define("orion/editor/textTheme",["require","orion/editor/eventTarget","orion/util"],function(k,m,i){function d(c){c=c||{};this._document=c.document||document}var c={};d.getTheme=function(f){var f=f||"default",e=c[f];e||(e=c[f]=new d);return e};d.prototype={getThemeClass:function(){return this._themeClass},setThemeClass:function(c,e){var d=this,j=d._themeClass;d._themeClass=c;this._load(c,e,function(){d.onThemeChanged({type:"ThemeChanged",oldValue:j,newValue:d.getThemeClass()})})},onThemeChanged:function(c){return this.dispatchEvent(c)},
buildStyleSheet:function(c,e){function d(b,a,e){a&&(j.push("."+c+" ."+b+" {"),j.push("\t"+(e?"background-color":"color")+": "+a+";"),j.push("}"))}var j=[];j.push("");j.push("."+c+" {");e.fontFamily&&j.push("\tfont-family: "+e.fontFamily+";");e.fontSize&&j.push("\tfont-size: "+e.fontSize+";");e.fontSize&&j.push("\tcolor: "+e.text+";");j.push("}");j.push("."+c+".textview {");e.background&&j.push("\tbackground-color: "+e.background+";");j.push("}");d("ruler.annotations",e.annotationRuler,!0);d("ruler.lines",
e.annotationRuler,!0);d("ruler.folding",e.annotationRuler,!0);d("ruler.overview",e.overviewRuler,!0);d("rulerLines",e.lineNumber,!1);d("rulerLines.even",e.lineNumberEven,!1);d("rulerLines.odd",e.lineNumberOdd,!1);d("annotationLine.currentLine",e.currentLine,!0);d("entity-name-tag",e.keyword,!1);d("entity-other-attribute-name",e.attribute,!1);d("string-quoted",e.string,!1);d("meta.annotation.currentLine",e.currentLine,!0);d("keyword",e.keyword,!1);d("string",e.string,!1);d("comment",e.comment,!1);
d("comment.block.documentation",e.comment,!1);d("keyword.other.documentation.markup",e.comment,!1);return j.join("\n")},_createStyle:function(c,e,d,j){var b=this._document,c="orion-theme-"+c,a=b.getElementById(c);if(a){if(j||a.firstChild.data===e)return;a.removeChild(a.firstChild);a.appendChild(b.createTextNode(e))}else j?(a=i.createElement(b,"link"),a.rel="stylesheet",a.type="text/css",a.href=e,a.addEventListener("load",function(){d()})):(a=i.createElement(b,"style"),a.appendChild(b.createTextNode(e))),
a.id=c,(b.getElementsByTagName("head")[0]||b.documentElement).appendChild(a);j||d()},_load:function(c,e,d){if(c)if("string"===typeof e)this._createStyle(c,e,d);else if(e=e.href,".css"!==e.substring(e.length-4)&&(e+=".css"),/^\//.test(e)||/[a-zA-Z0-9]+:\/\//i.test(e)||!k.toUrl)this._createStyle(c,e,d,!0);else{var j=this;k(["text!"+e],function(b){j._createStyle(c,b,d,!1)})}else d()}};m.EventTarget.addMixin(d.prototype);return{TextTheme:d}});
define("orion/editor/util",[],function(){return{contains:function(k,m){if(!m)return!1;if(!k.compareDocumentPosition){for(var i=m;i;){if(k===i)return!0;i=i.parentNode}return!1}return k===m||0!==(k.compareDocumentPosition(m)&16)},addEventListener:function(k,m,i,d){"function"===typeof k.addEventListener?k.addEventListener(m,i,!0===d):k.attachEvent("on"+m,i)},removeEventListener:function(k,m,i,d){"function"===typeof k.removeEventListener?k.removeEventListener(m,i,!0===d):k.detachEvent("on"+m,i)}}});
define("orion/editor/textView","i18n!orion/editor/nls/messages orion/editor/textModel orion/editor/keyModes orion/editor/eventTarget orion/editor/textTheme orion/editor/util orion/util".split(" "),function(k,m,i,d,c,f,e){function h(a,b,c){if(c){b.className="";for(var c=b.attributes,g=c.length;0<g--;)(!e.isIE||9<=e.isIE||9>e.isIE&&c[g].specified)&&b.removeAttribute(c[g].name)}if(a){a.styleClass&&(b.className=a.styleClass);if(c=a.style)for(var d in c)c.hasOwnProperty(d)&&(b.style[d]=c[d]);if(a=a.attributes)for(var l in a)a.hasOwnProperty(l)&&
b.setAttribute(l,a[l])}}function j(a){return a instanceof Array?a.slice(0):a}function b(a,b){if(!a)return b;if(!b)return a;for(var e in b)b.hasOwnProperty(e)&&(a.hasOwnProperty(e)||(a[e]=b[e]));return a}function a(p,b){if(p===b)return!0;if(p&&!b||!p&&b||p&&p.constructor===String||b&&b.constructor===String)return!1;if(p instanceof Array||b instanceof Array){if(!(p instanceof Array&&b instanceof Array)||p.length!==b.length)return!1;for(var e=0;e<p.length;e++)if(!a(p[e],b[e]))return!1;return!0}if(!(p instanceof
Object)||!(b instanceof Object))return!1;for(e in p)if(p.hasOwnProperty(e)&&(!b.hasOwnProperty(e)||!a(p[e],b[e])))return!1;for(e in b)if(!p.hasOwnProperty(e))return!1;return!0}function g(a,b,e){for(var c=0,g=0,d=0,l=a.length;d<l;){-1!==c&&c<=d&&(c=a.indexOf("\r",d));-1!==g&&g<=d&&(g=a.indexOf("\n",d));var h=d,f;if(-1===g&&-1===c){b(a.substring(d));break}-1!==c&&-1!==g?c+1===g?(f=c,d=g+1):(f=c<g?c:g,d=(c<g?c:g)+1):-1!==c?(f=c,d=c+1):(f=g,d=g+1);b(a.substring(h,f));e()}}function l(a){var b,e,c,g,d=
a.ownerDocument.defaultView||a.ownerDocument.parentWindow;d.getComputedStyle?(a=d.getComputedStyle(a,null),b=a.getPropertyValue("padding-left"),e=a.getPropertyValue("padding-top"),c=a.getPropertyValue("padding-right"),g=a.getPropertyValue("padding-bottom")):a.currentStyle&&(b=a.currentStyle.paddingLeft,e=a.currentStyle.paddingTop,c=a.currentStyle.paddingRight,g=a.currentStyle.paddingBottom);return{left:parseInt(b,10)||0,top:parseInt(e,10)||0,right:parseInt(c,10)||0,bottom:parseInt(g,10)||0}}function n(a){var b,
e,c,g,d=a._trim;if(!d){var d=l(a),h=a.ownerDocument.defaultView||a.ownerDocument.parentWindow;h.getComputedStyle?(g=h.getComputedStyle(a,null),b=g.getPropertyValue("border-left-width"),e=g.getPropertyValue("border-top-width"),c=g.getPropertyValue("border-right-width"),g=g.getPropertyValue("border-bottom-width")):a.currentStyle&&(b=a.currentStyle.borderLeftWidth,e=a.currentStyle.borderTopWidth,c=a.currentStyle.borderRightWidth,g=a.currentStyle.borderBottomWidth);b=parseInt(b,10)||0;e=parseInt(e,10)||
0;c=parseInt(c,10)||0;g=parseInt(g,10)||0;d.left+=b;d.top+=e;d.right+=c;d.bottom+=g;a._trim=d}return d}function q(a,b,e){this.start=a;this.end=b;this.caret=e}function r(a){this.left=a.left;this.top=a.top;this.right=a.right;this.bottom=a.bottom}function w(a,b,e){this.view=a;this.lineIndex=b;this._lineDiv=e}function t(a){this._init(a||{})}var x=f.addEventListener,y=f.removeEventListener,u=function(a){this.options=a};u.prototype.play=function(){var a="number"===typeof this.options.duration?this.options.duration:
350,b=this.options.easing||this.defaultEasing,e=this.options.onAnimate||function(){},c=this.options.curve[0],g=this.options.curve[1],d=g-c,l=-1,h,f=this;this.interval=this.options.window.setInterval(function(){l=-1===l?(new Date).getTime():l;var n=((new Date).getTime()-l)/a;1>n?(n=b(n),h=c+n*d,e(h)):(e(g),f.stop())},"number"===typeof this.options.rate?this.options.rate:20)};u.prototype.stop=function(){this.options.window.clearInterval(this.interval);(this.options.onEnd||function(){})()};u.prototype.defaultEasing=
function(a){return Math.sin(a*(Math.PI/2))};q.prototype={clone:function(){return new q(this.start,this.end,this.caret)},collapse:function(){this.caret?this.end=this.start:this.start=this.end},extend:function(a){this.caret?this.start=a:this.end=a;this.start>this.end&&(a=this.start,this.start=this.end,this.end=a,this.caret=!this.caret)},setCaret:function(a){this.end=this.start=a;this.caret=!1},getCaret:function(){return this.caret?this.start:this.end},toString:function(){return"start="+this.start+" end="+
this.end+(this.caret?" caret is at start":" caret is at end")},isEmpty:function(){return this.start===this.end},equals:function(a){return this.caret===a.caret&&this.start===a.start&&this.end===a.end}};r.prototype={toString:function(){return"{l="+this.left+", t="+this.top+", r="+this.right+", b="+this.bottom+"}"}};w.prototype={create:function(a,b){if(!this._lineDiv){var e=this._lineDiv=this._createLine(a,b,this.lineIndex);e._line=this;return e}},_createLine:function(b,c,g){var d=this.view,l=d._model,
f=l.getLine(g),n=l.getLineStart(g),j={type:"LineStyle",textView:d,lineIndex:g,lineText:f,lineStart:n};if(2E3>f.length)d.onLineStyle(j);l=c||e.createElement(b.ownerDocument,"div");if(!c||!a(c.viewStyle,j.style))h(j.style,l,c),c&&(c._trim=null),l.viewStyle=j.style,l.setAttribute("role","presentation");l.lineIndex=g;g=[];this._createRanges(j.ranges,f,0,f.length,n,{tabOffset:0,ranges:g});f=" ";!d._fullSelection&&9>e.isIE&&(f="\ufeff");j={text:f,style:d._metrics.largestFontStyle,ignoreChars:1};0===g.length||
!g[g.length-1].style||"div"!==g[g.length-1].style.tagName?g.push(j):g.splice(g.length-1,0,j);var q,r,i,k,m,f=d=0,w,t;if(c){if(r=c.modelChangedEvent)0===r.removedLineCount&&0===r.addedLineCount?(t=r.start-n,w=r.addedCharCount-r.removedCharCount):t=-1,c.modelChangedEvent=void 0;r=c.firstChild}for(n=0;n<g.length;n++){j=g[n];k=j.text;d+=k.length;q=j.style;if(r)if(m=r.firstChild.data,i=r.viewStyle,m===k&&a(q,i)){f+=m.length;r._rectsCache=void 0;q=r=r.nextSibling;continue}else for(;r;){if(-1!==t){i=d;i>=
t&&(i-=w);m=(m=r.firstChild.data)?m.length:0;if(f+m>i)break;f+=m}i=r.nextSibling;l.removeChild(r);r=i}q=this._createSpan(l,k,q,j.ignoreChars);r?l.insertBefore(q,r):l.appendChild(q);c&&(c.lineWidth=void 0)}if(c)for(b=q?q.nextSibling:null;b;)i=b.nextSibling,c.removeChild(b),b=i;else b.appendChild(l);return l},_createRanges:function(b,e,c,g,d,l){if(!(c>g)){if(b)for(var h=0;h<b.length;h++){var f=b[h];if(!(f.end<d+c)){var n=Math.max(d+c,f.start)-d;if(n>g)break;var j=Math.min(d+g,f.end)-d;if(n<=j){n=Math.max(c,
n);j=Math.min(g,j);c<n&&this._createRange(e,c,n,null,l);if(!f.style||!f.style.unmergeable)for(;h+1<b.length&&b[h+1].start-d===j&&a(f.style,b[h+1].style);)f=b[h+1],j=Math.min(d+g,f.end)-d,h++;this._createRange(e,n,j,f.style,l);c=j}}}c<g&&this._createRange(e,c,g,null,l)}},_createRange:function(a,b,e,c,g){if(!(b>e)){var d=this.view._customTabSize;if(d&&8!==d)for(var l=a.indexOf("\t",b);-1!==l&&l<e;){b<l&&(b={text:a.substring(b,l),style:c},g.ranges.push(b),g.tabOffset+=b.text.length);b=d-g.tabOffset%
d;if(0<b){for(var h="\u00a0",f=1;f<b;f++)h+=" ";b={text:h,style:c,ignoreChars:b-1};g.ranges.push(b);g.tabOffset+=b.text.length}b=l+1;if(b===e)return;l=a.indexOf("\t",b)}b<=e&&(b={text:a.substring(b,e),style:c},g.ranges.push(b),g.tabOffset+=b.text.length)}},_createSpan:function(a,b,g,c){var d=this.view,l="span";g&&g.tagName&&(l=g.tagName.toLowerCase());var f="a"===l;f&&(a.hasLink=!0);f&&!d._linksVisible&&(l="span");f=a.ownerDocument;a=e.createElement(a.ownerDocument,l);g&&g.html?(a.innerHTML=g.html,
a.ignore=!0):g&&g.node?(a.appendChild(g.node),a.ignore=!0):a.appendChild(f.createTextNode(g&&g.text?g.text:b));h(g,a);if("a"===l){var n=d._getWindow();x(a,"click",function(a){return d._handleLinkClick(a?a:n.event)},!1)}a.viewStyle=g;c&&(a.ignoreChars=c);return a},_ensureCreated:function(){return this._lineDiv?this._lineDiv:this._createdDiv=this.create(this.view._clientDiv,null)},getBoundingClientRect:function(a,b){var g=this._ensureCreated(),c=this.view;if(void 0===a)return this._getLineBoundingClientRect(g,
!0);var d=c._model,l=g.ownerDocument,h=this.lineIndex,f=null;if(a<d.getLineEnd(h)){h=d.getLineStart(h);for(d=g.firstChild;d;){if(!d.ignore){var n=d.firstChild,j=n.length;d.ignoreChars&&(j-=d.ignoreChars);if(h+j>a){f=a-h;if(1===n.length)f=new r(d.getBoundingClientRect());else if(c._isRangeRects)l=l.createRange(),l.setStart(n,f),l.setEnd(n,f+1),f=new r(l.getBoundingClientRect());else if(e.isIE)l=l.body.createTextRange(),l.moveToElementText(d),l.collapse(),(h=0===f&&8===e.isIE)&&(f=1),l.moveEnd("character",
f+1),l.moveStart("character",f),f=new r(l.getBoundingClientRect()),h&&(f.left=d.getClientRects()[0].left);else{var q=n.data;d.removeChild(n);d.appendChild(l.createTextNode(q.substring(0,f)));var i=e.createElement(l,"span");i.appendChild(l.createTextNode(q.substring(f,f+1)));d.appendChild(i);d.appendChild(l.createTextNode(q.substring(f+1)));f=new r(i.getBoundingClientRect());d.innerHTML="";d.appendChild(n);this._createdDiv||(l=c._getSelection(),(h<=l.start&&l.start<h+j||h<=l.end&&l.end<h+j)&&c._updateDOMSelection())}e.isIE&&
(l=g.ownerDocument.defaultView||g.ownerDocument.parentWindow,g=l.screen.logicalXDPI/l.screen.deviceXDPI,l=l.screen.logicalYDPI/l.screen.deviceYDPI,f.left*=g,f.right*=g,f.top*=l,f.bottom*=l);break}h+=j}d=d.nextSibling}}g=this.getBoundingClientRect();f||(c._wrapMode?(c=this.getClientRects(),f=c[c.length-1],f.left=f.right,f.left+=g.left,f.top+=g.top,f.right+=g.left,f.bottom+=g.top):(f=new r(g),f.left=f.right));if(b||void 0===b)f.left-=g.left,f.top-=g.top,f.right-=g.left,f.bottom-=g.top;return f},_getClientRects:function(a,
b){var e,g,c,d;if(!a._rectsCache){e=a.getClientRects();g=Array(e.length);for(d=0;d<e.length;d++)c=g[d]=new r(e[d]),c.left-=b.left,c.top-=b.top,c.right-=b.left,c.bottom-=b.top;a._rectsCache=g}e=a._rectsCache;g=[e.length];for(d=0;d<e.length;d++)g[d]=new r(e[d]);return g},getClientRects:function(a){if(!this.view._wrapMode)return[this.getBoundingClientRect()];for(var b=this._ensureCreated(),e=[],g=b.firstChild,c,d=b.getBoundingClientRect();g;){if(!g.ignore)for(var l=this._getClientRects(g,d),b=0;b<l.length;b++){var h=
l[b],f;if(h.top!==h.bottom){var n=h.top+(h.bottom-h.top)/2;for(f=0;f<e.length&&!(c=e[f],c.top<=n&&n<c.bottom);f++);f===e.length?e.push(h):(h.left<c.left&&(c.left=h.left),h.top<c.top&&(c.top=h.top),h.right>c.right&&(c.right=h.right),h.bottom>c.bottom&&(c.bottom=h.bottom))}}g=g.nextSibling}return void 0!==a?e[a]:e},_getLineBoundingClientRect:function(a,b){var e=new r(a.getBoundingClientRect());if(!this.view._wrapMode){e.right=e.left;for(var g=a.lastChild;g&&g.ignoreChars===g.firstChild.length;)g=g.previousSibling;
g&&(g=g.getBoundingClientRect(),e.right=g.right+n(a).right)}b&&(g=n(a),e.left+=g.left,e.right-=g.right);return e},getLineCount:function(){return!this.view._wrapMode?1:this.getClientRects().length},getLineIndex:function(a){if(!this.view._wrapMode)return 0;for(var b=this.getClientRects(),a=this.getBoundingClientRect(a),a=a.top+(a.bottom-a.top)/2,e=0;e<b.length;e++)if(b[e].top<=a&&a<b[e].bottom)return e;return b.length-1},getLineStart:function(a){if(!this.view._wrapMode||0===a)return this.view._model.getLineStart(a);
var b=this.getClientRects();return this.getOffset(b[a].left+1,b[a].top+1)},getOffset:function(a,b){var g=this.view,c=g._model,d=this.lineIndex,l=c.getLineStart(d),h=c.getLineEnd(d);if(l===h)return l;var f=this._ensureCreated(),n=this.getBoundingClientRect(),j,q;if(g._wrapMode){j=this.getClientRects();b<j[0].top&&(b=j[0].top);for(var r=0;r<j.length&&!(q=j[r],q.top<=b&&b<q.bottom);r++);a<q.left&&(a=q.left);a>q.right&&(a=q.right-1)}else 0>a&&(a=0),a>n.right-n.left&&(a=n.right-n.left);var i=f.ownerDocument,
r=i.defaultView||i.parentWindow,k=e.isIE?r.screen.logicalXDPI/r.screen.deviceXDPI:1,m=e.isIE?r.screen.logicalYDPI/r.screen.deviceYDPI:1,r=l,w=f.firstChild;a:for(;w;){if(!w.ignore){var t=w.firstChild,f=t.length;w.ignoreChars&&(f-=w.ignoreChars);var x,y,u;j=this._getClientRects(w,n);for(var D=0;D<j.length;D++)if(q=j[D],q.left<=a&&a<q.right&&(!g._wrapMode||q.top<=b&&b<q.bottom)){var D=q.left+n.left,C;if(e.isIE||g._isRangeRects){for(var i=g._isRangeRects?i.createRange():i.body.createTextRange(),B=f,E=
-1;1<B-E;){var K=Math.floor((B+E)/2);j=E+1;q=K===f-1&&w.ignoreChars?t.length:K+1;C=0===j&&8===e.isIE;g._isRangeRects?(i.setStart(t,j),i.setEnd(t,q)):(C&&(j=1),i.moveToElementText(w),i.move("character",j),i.moveEnd("character",q-j));j=i.getClientRects();for(var M=!1,L=0;L<j.length;L++)if(q=j[L],x=(C?D:q.left)*k-n.left,u=q.right*k-n.left,y=q.top*m-n.top,q=q.bottom*m-n.top,x<=a&&a<u&&(!g._wrapMode||y<=b&&b<q)){M=!0;break}M?B=K:E=K}r+=B;j=B;q=B===f-1&&w.ignoreChars?t.length:Math.min(B+1,t.length);g._isRangeRects?
(i.setStart(t,j),i.setEnd(t,q)):(i.moveToElementText(w),i.move("character",j),i.moveEnd("character",q-j));j=i.getClientRects();g=!1;0<j.length&&(q=j[0],x=(C?D:q.left)*k-n.left,u=q.right*k-n.left,g=a>x+(u-x)/2);n=r-l;c=c.getLine(d);d=c.charCodeAt(n);55296<=d&&56319>=d&&g?n<c.length&&(d=c.charCodeAt(n+1),56320<=d&&57343>=d&&(r+=1)):56320<=d&&(57343>=d&&!g)&&0<n&&(d=c.charCodeAt(n-1),55296<=d&&56319>=d&&(r-=1));g&&r++}else{c=[];for(d=0;d<f;d++)c.push("<span>"),d===f-1?c.push(t.data.substring(d)):c.push(t.data.substring(d,
d+1)),c.push("</span>");w.innerHTML=c.join("");for(c=w.firstChild;c;){q=c.getBoundingClientRect();x=q.left-n.left;u=q.right-n.left;if(x<=a&&a<u){a>x+(u-x)/2&&r++;break}r++;c=c.nextSibling}this._createdDiv||(w.innerHTML="",w.appendChild(t),n=g._getSelection(),(r<=n.start&&n.start<r+f||r<=n.end&&n.end<r+f)&&g._updateDOMSelection())}break a}r+=f}w=w.nextSibling}return Math.min(h,Math.max(l,r))},getNextOffset:function(a,b){if("line"===b.unit){var g=this.view._model,c=g.getLineAtOffset(a);if(0<b.count)return b.count--,
g.getLineEnd(c);b.count++;return g.getLineStart(c)}return"wordend"===b.unit||"wordWS"===b.unit||"wordendWS"===b.unit?this._getNextOffset_W3C(a,b):e.isIE?this._getNextOffset_IE(a,b):this._getNextOffset_W3C(a,b)},_getNextOffset_W3C:function(a,b){function e(a){return 33<=a&&47>=a||58<=a&&64>=a||91<=a&&94>=a||96===a||123<=a&&126>=a}function g(a){return 32===a||9===a}var c=this.view._model,d=c.getLineAtOffset(a),l=c.getLine(d),h=c.getLineStart(d),c=c.getLineEnd(d),d=l.length,f=a-h,n,j=0>b.count?-1:1;if("word"===
b.unit||"wordend"===b.unit||"wordWS"===b.unit||"wordendWS"===b.unit)for(var q,r,i;0!==b.count;){if(0<b.count){if(f===d)return c;n=l.charCodeAt(f);q=e(n);r=!q&&!g(n);for(f++;f<d;){n=l.charCodeAt(f);if("wordWS"!==b.unit&&"wordendWS"!==b.unit){i=e(n);if("wordend"===b.unit){if(!i&&q)break}else if(i&&!q)break;n=!i&&!g(n)}else n=!g(n);if("wordend"===b.unit||"wordendWS"===b.unit){if(!n&&r)break}else if(n&&!r)break;r=n;q=i;f++}}else{if(0===f)return h;f--;n=l.charCodeAt(f);q=e(n);for(r=!q&&!g(n);0<f;){n=l.charCodeAt(f-
1);if("wordWS"!==b.unit&&"wordendWS"!==b.unit){i=e(n);if("wordend"===b.unit){if(i&&!q)break}else if(!i&&q)break;n=!i&&!g(n)}else n=!g(n);if("wordend"===b.unit||"wordendWS"===b.unit){if(n&&!r)break}else if(!n&&r)break;r=n;q=i;f--}}b.count-=j}else for(;0!==b.count&&0<=f+j&&f+j<=d;)f+=j,n=l.charCodeAt(f),56320<=n&&57343>=n&&0<f&&(n=l.charCodeAt(f-1),55296<=n&&56319>=n&&(f+=j)),b.count-=j;return h+f},_getNextOffset_IE:function(a,b){var e=this._ensureCreated(),g=this.view._model,c=this.lineIndex,d=0,l;
l=g.getLineStart(c);var h=e.ownerDocument,f=0>b.count?-1:1;if(a===g.getLineEnd(c)){for(e=e.lastChild;e&&e.ignoreChars===e.firstChild.length;)e=e.previousSibling;if(!e)return l;d=h.body.createTextRange();d.moveToElementText(e);l=d.text.length;d.moveEnd(b.unit,f);d=a+d.text.length-l}else if(a===l&&0>b.count)d=l;else for(e=e.firstChild;e;){g=e.firstChild.length;e.ignoreChars&&(g-=e.ignoreChars);if(l+g>a){d=h.body.createTextRange();if(a===l&&0>b.count){for(l=e.previousSibling;l&&(!l.firstChild||!l.firstChild.length);)l=
l.previousSibling;d.moveToElementText(l?l:e.previousSibling)}else d.moveToElementText(e),d.collapse(),d.moveEnd("character",a-l);l=d.text.length;d.moveEnd(b.unit,f);d=a+d.text.length-l;break}l=g+l;e=e.nextSibling}b.count-=f;return d},destroy:function(){var a=this._createdDiv;a&&(a.parentNode.removeChild(a),this._createdDiv=null)}};t.prototype={addKeyMode:function(a,b){var e=this._keyModes;void 0!==b?e.splice(b,0,a):e.push(a);a._modeAdded&&a._modeAdded()},addRuler:function(a,b){a.setView(this);var e=
this._rulers;if(void 0!==b){var g,c;for(c=g=0;g<e.length&&c<b;g++)a.getLocation()===e[g].getLocation()&&c++;e.splice(c,0,a);b=c}else e.push(a);this._createRuler(a,b);this._update()},computeSize:function(){var a=0,b=0,g=this._model,c=this._clientDiv;if(!c)return{width:a,height:b};var d=c.style.width;e.isWebkit&&(c.style.width="0x7fffffffpx");for(var g=g.getLineCount(),l=0;l<g;l++){var h=this._getLine(l),f=h.getBoundingClientRect(),a=Math.max(a,f.right-f.left),b=b+(f.bottom-f.top);h.destroy()}e.isWebkit&&
(c.style.width=d);c=this._getViewPadding();a+=c.right+c.left+this._metrics.scrollWidth;b+=c.bottom+c.top+this._metrics.scrollWidth;return{width:a,height:b}},convert:function(a,b,e){if(this._clientDiv){var g=this._getScroll(),c=this._getViewPadding(),d=this._viewDiv.getBoundingClientRect();"document"===b&&(void 0!==a.x&&(a.x+=-g.x+d.left+c.left),void 0!==a.y&&(a.y+=-g.y+d.top+c.top));"document"===e&&(void 0!==a.x&&(a.x+=g.x-d.left-c.left),void 0!==a.y&&(a.y+=g.y-d.top-c.top));return a}},destroy:function(){for(var a=
0;a<this._rulers.length;a++)this._rulers[a].setView(null);this.rulers=null;this._destroyView();this.onDestroy({type:"Destroy"});this._parent=null;this._model&&this._model.destroy&&this._model.destroy();this._actions=this._keyModes=this._doubleClickSelection=this._selection=this._theme=this._model=null},focus:function(){this._clientDiv&&(this._updateDOMSelection(),this._clientDiv.focus(),this._updateDOMSelection())},hasFocus:function(){return this._hasFocus},getActionDescription:function(a){if(a=this._actions[a])return a.actionDescription},
getActions:function(a){var b=[],e=this._actions,g;for(g in e)e.hasOwnProperty(g)&&(a||!e[g].defaultHandler)&&b.push(g);return b},getBottomIndex:function(a){return!this._clientDiv?0:this._getBottomIndex(a)},getBottomPixel:function(){return!this._clientDiv?0:this._getScroll().y+this._getClientHeight()},getCaretOffset:function(){return this._getSelection().getCaret()},getClientArea:function(){if(!this._clientDiv)return{x:0,y:0,width:0,height:0};var a=this._getScroll();return{x:a.x,y:a.y,width:this._getClientWidth(),
height:this._getClientHeight()}},getHorizontalPixel:function(){return!this._clientDiv?0:this._getScroll().x},getKeyBindings:function(a){for(var b=[],e=this._keyModes,g=0;g<e.length;g++)b=b.concat(e[g].getKeyBindings(a));return b},getKeyModes:function(){return this._keyModes.slice(0)},getLineHeight:function(a){return!this._clientDiv?0:this._getLineHeight(a)},getLineIndex:function(a){return!this._clientDiv?0:this._getLineIndex(a)},getLinePixel:function(a){return!this._clientDiv?0:this._getLinePixel(a)},
getLocationAtOffset:function(a){if(!this._clientDiv)return{x:0,y:0};var b=this._model,a=Math.min(Math.max(0,a),b.getCharCount()),b=b.getLineAtOffset(a),e=this._getLine(b),a=e.getBoundingClientRect(a);e.destroy();e=a.left;b=this._getLinePixel(b)+a.top;return{x:e,y:b}},getNextOffset:function(a,b){var e=new q(a,a,!1);this._doMove(b,e);return e.getCaret()},getOptions:function(){var a;if(0===arguments.length)a=this._defaultOptions();else if(1===arguments.length){if(a=arguments[0],"string"===typeof a)return j(this["_"+
a])}else{a={};for(var b in arguments)arguments.hasOwnProperty(b)&&(a[arguments[b]]=void 0)}for(var e in a)a.hasOwnProperty(e)&&(a[e]=j(this["_"+e]));return a},getModel:function(){return this._model},getOffsetAtLocation:function(a,b){if(!this._clientDiv)return 0;var e=this._getLineIndex(b),g=this._getLine(e),e=g.getOffset(a,b-this._getLinePixel(e));g.destroy();return e},getLineAtOffset:function(a){this.getModel().getLineAtOffset(a)},getLineStart:function(a){this.getModel().getLineStart(a)},getRulers:function(){return this._rulers.slice(0)},
getSelection:function(){var a=this._getSelection();return{start:a.start,end:a.end}},getText:function(a,b){return this._model.getText(a,b)},getTopIndex:function(a){return!this._clientDiv?0:this._getTopIndex(a)},getTopPixel:function(){return!this._clientDiv?0:this._getScroll().y},invokeAction:function(a,b,e){if(this._clientDiv){if(a=this._actions[a]){if(!b&&a.handler&&a.handler(e))return!0;if(a.defaultHandler)return"boolean"===typeof a.defaultHandler(e)}return!1}},isDestroyed:function(){return!this._clientDiv},
onContextMenu:function(a){return this.dispatchEvent(a)},onDragStart:function(a){return this.dispatchEvent(a)},onDrag:function(a){return this.dispatchEvent(a)},onDragEnd:function(a){return this.dispatchEvent(a)},onDragEnter:function(a){return this.dispatchEvent(a)},onDragOver:function(a){return this.dispatchEvent(a)},onDragLeave:function(a){return this.dispatchEvent(a)},onDrop:function(a){return this.dispatchEvent(a)},onDestroy:function(a){return this.dispatchEvent(a)},onLineStyle:function(a){return this.dispatchEvent(a)},
onKeyDown:function(a){return this.dispatchEvent(a)},onKeyPress:function(a){return this.dispatchEvent(a)},onKeyUp:function(a){return this.dispatchEvent(a)},onModelChanged:function(a){return this.dispatchEvent(a)},onModelChanging:function(a){return this.dispatchEvent(a)},onModify:function(a){return this.dispatchEvent(a)},onMouseDown:function(a){return this.dispatchEvent(a)},onMouseUp:function(a){return this.dispatchEvent(a)},onMouseMove:function(a){return this.dispatchEvent(a)},onMouseOver:function(a){return this.dispatchEvent(a)},
onMouseOut:function(a){return this.dispatchEvent(a)},onSelection:function(a){return this.dispatchEvent(a)},onScroll:function(a){return this.dispatchEvent(a)},onVerify:function(a){return this.dispatchEvent(a)},onFocus:function(a){return this.dispatchEvent(a)},onBlur:function(a){return this.dispatchEvent(a)},redraw:function(){if(!(0<this._redrawCount)){var a=this._model.getLineCount();this.redrawRulers(0,a);this.redrawLines(0,a)}},redrawRulers:function(a,b){if(!(0<this._redrawCount))for(var e=this.getRulers(),
g=0;g<e.length;g++)this.redrawLines(a,b,e[g])},redrawLines:function(a,b,e){if(!(0<this._redrawCount)&&(void 0===a&&(a=0),void 0===b&&(b=this._model.getLineCount()),a!==b)){var g=this._clientDiv;if(g){if(e)for(g=this._getRulerParent(e).firstChild;g&&g._ruler!==e;)g=g.nextSibling;e?g.rulerChanged=!0:this._lineHeight&&this._resetLineHeight(a,b);if(!e||"page"===e.getOverview())for(g=g.firstChild;g;){var c=g.lineIndex;a<=c&&c<b&&(g.lineChanged=!0);g=g.nextSibling}!e&&(!this._wrapMode&&a<=this._maxLineIndex&&
this._maxLineIndex<b)&&(this._checkMaxLineIndex=this._maxLineIndex,this._maxLineIndex=-1,this._maxLineWidth=0);this._queueUpdate()}}},redrawRange:function(a,b){if(!(0<this._redrawCount)){var e=this._model;void 0===a&&(a=0);void 0===b&&(b=e.getCharCount());var g=e.getLineAtOffset(a),e=e.getLineAtOffset(Math.max(a,b-1))+1;this.redrawLines(g,e)}},removeKeyMode:function(a){for(var b=this._keyModes,e=0;e<b.length;e++)if(b[e]===a){b.splice(e,1);break}a._modeRemoved&&a._modeRemoved()},removeRuler:function(a){for(var b=
this._rulers,e=0;e<b.length;e++)if(b[e]===a){b.splice(e,1);a.setView(null);this._destroyRuler(a);this._update();break}},resize:function(){this._clientDiv&&this._handleResize(null)},setAction:function(a,b,e){if(a){var g=this._actions,c=g[a];c||(c=g[a]={});c.handler=b;void 0!==e&&(c.actionDescription=e)}},setKeyBinding:function(a,b){this._keyModes[0].setKeyBinding(a,b)},setCaretOffset:function(a,b,e){var g=this._model.getCharCount(),a=Math.max(0,Math.min(a,g)),a=new q(a,a,!1);this._setSelection(a,void 0===
b||b,!0,e)},setHorizontalPixel:function(a){this._clientDiv&&(a=Math.max(0,a),this._scrollView(a-this._getScroll().x,0))},setRedraw:function(a){a?0===--this._redrawCount&&this.redraw():this._redrawCount++},setModel:function(a){if(a&&a!==this._model){this._model.removeEventListener("preChanging",this._modelListener.onChanging);this._model.removeEventListener("postChanged",this._modelListener.onChanged);var b=this._model.getLineCount(),e=this._model.getCharCount(),g=a.getLineCount(),c=a.getCharCount(),
d={type:"ModelChanging",text:a.getText(),start:0,removedCharCount:e,addedCharCount:c,removedLineCount:b,addedLineCount:g};this.onModelChanging(d);this._model=a;d={type:"ModelChanged",start:0,removedCharCount:e,addedCharCount:c,removedLineCount:b,addedLineCount:g};this.onModelChanged(d);this._model.addEventListener("preChanging",this._modelListener.onChanging);this._model.addEventListener("postChanged",this._modelListener.onChanged);this._reset();this._update()}},setOptions:function(b){var e=this._defaultOptions(),
g;for(g in b)if(b.hasOwnProperty(g)){var c=b[g];if(!a(this["_"+g],c)){var d=e[g]?e[g].update:null;d?d.call(this,c):this["_"+g]=j(c)}}},setSelection:function(a,b,e,g){var c=a>b;if(c)var d=a,a=b,b=d;d=this._model.getCharCount();a=Math.max(0,Math.min(a,d));b=Math.max(0,Math.min(b,d));a=new q(a,b,c);this._setSelection(a,void 0===e||e,!0,g)},setText:function(a,b,g){var c=void 0===b&&void 0===g;void 0===b&&(b=0);void 0===g&&(g=this._model.getCharCount());c&&(this._variableLineHeight=!1);this._modifyContent({text:a,
start:b,end:g,_code:!0},!c);c&&(this._columnX=-1,this._setSelection(new q(0,0,!1),!0),e.isFirefox&&this._fixCaret())},setTopIndex:function(a){this._clientDiv&&this._scrollView(0,this._getLinePixel(Math.max(0,a))-this._getScroll().y)},setTopPixel:function(a){this._clientDiv&&this._scrollView(0,Math.max(0,a)-this._getScroll().y)},showSelection:function(){return this._showCaret(!0)},update:function(a,b){this._clientDiv&&(a&&this._updateStyle(),void 0===b||b?this._update():this._queueUpdate())},_handleRootMouseDown:function(a){if(!this._ignoreEvent(a)){e.isFirefox&&
1===a.which&&(this._clientDiv.contentEditable=!1,this._ignoreBlur=(this._overlayDiv||this._clientDiv).draggable=!0);var b=this._overlayDiv||this._clientDiv;9>e.isIE&&(b=this._viewDiv);for(var g=a.target?a.target:a.srcElement;g;){if(b===g)return;g=g.parentNode}a.preventDefault&&a.preventDefault();a.stopPropagation&&a.stopPropagation();if(!this._isW3CEvents){var c=this;this._getWindow().setTimeout(function(){c._clientDiv.focus()},0)}}},_handleRootMouseUp:function(a){!this._ignoreEvent(a)&&(e.isFirefox&&
1===a.which)&&(this._clientDiv.contentEditable=!0,(this._overlayDiv||this._clientDiv).draggable=!1,this._fixCaret(),this._ignoreBlur=!1)},_handleBlur:function(){if(!this._ignoreBlur){this._hasFocus=!1;if(9>e.isIE&&!this._getSelection().isEmpty()){var a=this._rootDiv,b=e.createElement(a.ownerDocument,"div");a.appendChild(b);a.removeChild(b)}this._cursorDiv&&(this._cursorDiv.style.display="none");if(this._selDiv1)if(this._selDiv1.style.background="lightgray",this._selDiv2.style.background="lightgray",
this._selDiv3.style.background="lightgray",a=this._getWindow(),b=this._selDiv1.ownerDocument,a.getSelection){b=a.getSelection();for(a=b.anchorNode;a;){if(a===this._clientDiv){0<b.rangeCount&&b.removeAllRanges();break}a=a.parentNode}}else if(b.selection){this._ignoreSelect=!1;for(a=b.selection.createRange().parentElement();a;){if(a===this._clientDiv){b.selection.empty();break}a=a.parentNode}this._ignoreSelect=!0}if(!this._ignoreFocus)this.onBlur({type:"Blur"})}},_handleContextMenu:function(a){if(!this._ignoreEvent(a)){e.isIE&&
3===this._lastMouseButton&&this._updateDOMSelection();var b=!1;this.isListening("ContextMenu")?(b=this._createMouseEvent("ContextMenu",a),b.screenX=a.screenX,b.screenY=a.screenY,this.onContextMenu(b),b=b.defaultPrevented):e.isMac&&(e.isFirefox&&0===a.button)&&(b=!0);if(b)return a.preventDefault&&a.preventDefault(),!1}},_handleCopy:function(a){if(!this._ignoreEvent(a)&&!this._ignoreCopy&&this._doCopy(a))return a.preventDefault&&a.preventDefault(),!1},_handleCut:function(a){if(!this._ignoreEvent(a)&&
this._doCut(a))return a.preventDefault&&a.preventDefault(),!1},_handleDataModified:function(a){this._ignoreEvent(a)||this._startIME()},_handleDblclick:function(a){this._ignoreEvent(a)||(this._lastMouseTime=a.timeStamp?a.timeStamp:(new Date).getTime(),2!==this._clickCount&&(this._clickCount=2,this._handleMouse(a)))},_handleDragStart:function(a){if(!this._ignoreEvent(a)){if(e.isFirefox){var b=this;this._getWindow().setTimeout(function(){b._clientDiv.contentEditable=!0;b._clientDiv.draggable=!1;b._ignoreBlur=
!1},0)}if(this.isListening("DragStart")&&-1!==this._dragOffset)this._isMouseDown=!1,this.onDragStart(this._createMouseEvent("DragStart",a)),this._dragOffset=-1;else return a.preventDefault&&a.preventDefault(),!1}},_handleDrag:function(a){if(!this._ignoreEvent(a)&&this.isListening("Drag"))this.onDrag(this._createMouseEvent("Drag",a))},_handleDragEnd:function(a){if(!this._ignoreEvent(a)){this._dropTarget=!1;this._dragOffset=-1;if(this.isListening("DragEnd"))this.onDragEnd(this._createMouseEvent("DragEnd",
a));e.isFirefox&&(this._fixCaret(),"none"===a.dataTransfer.dropEffect&&!a.dataTransfer.mozUserCancelled&&this._fixCaret())}},_handleDragEnter:function(a){if(!this._ignoreEvent(a)){var b=!0;this._dropTarget=!0;this.isListening("DragEnter")&&(b=!1,this.onDragEnter(this._createMouseEvent("DragEnter",a)));if(e.isWebkit||b)return a.preventDefault&&a.preventDefault(),!1}},_handleDragOver:function(a){if(!this._ignoreEvent(a)){var b=!0;this.isListening("DragOver")&&(b=!1,this.onDragOver(this._createMouseEvent("DragOver",
a)));if(e.isWebkit||b)return b&&(a.dataTransfer.dropEffect="none"),a.preventDefault&&a.preventDefault(),!1}},_handleDragLeave:function(a){if(!this._ignoreEvent(a)&&(this._dropTarget=!1,this.isListening("DragLeave")))this.onDragLeave(this._createMouseEvent("DragLeave",a))},_handleDrop:function(a){if(!this._ignoreEvent(a)){this._dropTarget=!1;if(this.isListening("Drop"))this.onDrop(this._createMouseEvent("Drop",a));a.preventDefault&&a.preventDefault();return!1}},_handleFocus:function(){this._hasFocus=
!0;e.isIOS&&void 0!==this._lastTouchOffset?(this.setCaretOffset(this._lastTouchOffset,!0),this._lastTouchOffset=void 0):this._updateDOMSelection();this._cursorDiv&&(this._cursorDiv.style.display="block");if(this._selDiv1){var a=this._highlightRGB;this._selDiv1.style.background=a;this._selDiv2.style.background=a;this._selDiv3.style.background=a}if(!this._ignoreFocus)this.onFocus({type:"Focus"})},_handleKeyDown:function(a){if(!this._ignoreEvent(a)){if(this.isListening("KeyDown")){var b=this._createKeyEvent("KeyDown",
a);this.onKeyDown(b);if(b.defaultPrevented){e.isFirefox&&(this._keyDownPrevented=!0);a.preventDefault();return}}b=!1;switch(a.keyCode){case 16:case 17:case 18:case 91:b=!0;break;default:this._setLinksVisible(!1)}if(229===a.keyCode){if(this._readonly)return a.preventDefault&&a.preventDefault(),!1;b=!0;e.isSafari&&e.isMac&&a.ctrlKey&&(b=!1,a.keyCode=129);b&&this._startIME()}else b||this._commitIME();if((e.isMac||e.isLinux)&&4>e.isFirefox||12.16>e.isOpera)return this._keyDownEvent=a,!0;if(this._doAction(a))return a.preventDefault?
(a.preventDefault(),a.stopPropagation()):(a.cancelBubble=!0,a.returnValue=!1,a.keyCode=0),!1}},_handleKeyPress:function(a){if(!this._ignoreEvent(a))if(this._keyDownPrevented)a.preventDefault&&(a.preventDefault(),a.stopPropagation()),this._keyDownPrevented=void 0;else{if(e.isMac&&e.isWebkit&&(63232<=a.keyCode&&63487>=a.keyCode||13===a.keyCode||8===a.keyCode)||((e.isMac||e.isLinux)&&4>e.isFirefox||12.16>e.isOpera)&&this._doAction(this._keyDownEvent))return a.preventDefault&&a.preventDefault(),!1;var b=
e.isMac?a.metaKey:a.ctrlKey;if(void 0!==a.charCode&&b)switch(a.charCode){case 99:case 118:case 120:return!0}if(this.isListening("KeyPress")&&(b=this._createKeyEvent("KeyPress",a),this.onKeyPress(b),b.defaultPrevented)){a.preventDefault();return}if(this._doAction(a))return a.preventDefault?(a.preventDefault(),a.stopPropagation()):(a.cancelBubble=!0,a.returnValue=!1,a.keyCode=0),!1;b=!1;if(e.isMac){if(a.ctrlKey||a.metaKey)b=!0}else if(e.isFirefox){if(a.ctrlKey||a.altKey)b=!0}else a.ctrlKey^a.altKey&&
(b=!0);if(!b&&(b=e.isOpera?a.which:void 0!==a.charCode?a.charCode:a.keyCode,31<b))return this._doContent(String.fromCharCode(b)),a.preventDefault&&a.preventDefault(),!1}},_handleDocKeyUp:function(a){(e.isMac?a.metaKey:a.ctrlKey)||this._setLinksVisible(!1)},_handleKeyUp:function(a){if(!this._ignoreEvent(a)){if(this.isListening("KeyUp")){var b=this._createKeyEvent("KeyUp",a);this.onKeyUp(b);if(b.defaultPrevented){a.preventDefault();return}}this._handleDocKeyUp(a);13===a.keyCode&&this._commitIME()}},
_handleLinkClick:function(a){if(!(e.isMac?a.metaKey:a.ctrlKey))return a.preventDefault&&a.preventDefault(),!1},_handleMouse:function(a){var b=this._getWindow(),g=!0,c=b;if(e.isIE||e.isFirefox&&!this._overlayDiv)c=this._clientDiv;if(this._overlayDiv){this._hasFocus&&(this._ignoreFocus=!0);var d=this;b.setTimeout(function(){d.focus();d._ignoreFocus=!1},0)}1===this._clickCount?(g=this._setSelectionTo(a.clientX,a.clientY,a.shiftKey,(!e.isOpera||12.16<=e.isOpera)&&this._hasFocus&&this.isListening("DragStart")))&&
this._setGrab(c):(this._isW3CEvents&&this._setGrab(c),this._doubleClickSelection=null,this._setSelectionTo(a.clientX,a.clientY,a.shiftKey),this._doubleClickSelection=this._getSelection());return g},_handleMouseDown:function(a){if(!this._ignoreEvent(a)){if(this._linksVisible)if("A"!==(a.target||a.srcElement).tagName)this._setLinksVisible(!1);else return;this._commitIME();var b=a.which;b||(4===a.button&&(b=2),2===a.button&&(b=3),1===a.button&&(b=1));var g=2!==b&&a.timeStamp?a.timeStamp:(new Date).getTime(),
c=g-this._lastMouseTime,d=Math.abs(this._lastMouseX-a.clientX),l=Math.abs(this._lastMouseY-a.clientY),h=this._lastMouseButton===b;this._lastMouseX=a.clientX;this._lastMouseY=a.clientY;this._lastMouseTime=g;this._lastMouseButton=b;1===b&&(this._isMouseDown=!0,h&&c<=this._clickTime&&d<=this._clickDist&&l<=this._clickDist?this._clickCount++:this._clickCount=1);if(this.isListening("MouseDown")&&(g=this._createMouseEvent("MouseDown",a),this.onMouseDown(g),g.defaultPrevented)){a.preventDefault();return}if(1===
b&&this._handleMouse(a)&&(9<=e.isIE||e.isOpera||e.isChrome||e.isSafari||e.isFirefox&&!this._overlayDiv))this._hasFocus||this.focus(),a.preventDefault();e.isFirefox&&3===this._lastMouseButton&&this._updateDOMSelection()}},_handleMouseOver:function(a){if(!this._ignoreEvent(a)&&!this._animation&&this.isListening("MouseOver"))this.onMouseOver(this._createMouseEvent("MouseOver",a))},_handleMouseOut:function(a){if(!this._ignoreEvent(a)&&!this._animation&&this.isListening("MouseOut"))this.onMouseOut(this._createMouseEvent("MouseOut",
a))},_handleMouseMove:function(a){if(!this._animation){var b=this._isClientDiv(a);if(this.isListening("MouseMove")&&b)this.onMouseMove(this._createMouseEvent("MouseMove",a));if(!this._dropTarget){var g=this._linksVisible||this._lastMouseMoveX!==a.clientX||this._lastMouseMoveY!==a.clientY;this._lastMouseMoveX=a.clientX;this._lastMouseMoveY=a.clientY;this._setLinksVisible(g&&!this._isMouseDown&&(e.isMac?a.metaKey:a.ctrlKey));if(!this._isW3CEvents){if(0===a.button)return this._setGrab(null),!0;if(!this._isMouseDown&&
1===a.button&&0!==(this._clickCount&1)&&b)return this._clickCount=2,this._handleMouse(a,this._clickCount)}if(this._isMouseDown&&-1===this._dragOffset){var b=a.clientX,a=a.clientY,c=this._getViewPadding(),d=this._viewDiv.getBoundingClientRect(),l=this._getClientWidth(),h=this._getClientHeight(),g=d.left+c.left,f=d.top+c.top,l=d.left+c.left+l,c=d.top+c.top+h;a<f?this._doAutoScroll("up",b,a-f):a>c?this._doAutoScroll("down",b,a-c):b<g&&!this._wrapMode?this._doAutoScroll("left",b-g,a):b>l&&!this._wrapMode?
this._doAutoScroll("right",b-l,a):(this._endAutoScroll(),this._setSelectionTo(b,a,!0))}}}},_isClientDiv:function(a){for(var b=this._overlayDiv||this._clientDiv,a=a.target?a.target:a.srcElement;a;){if(b===a)return!0;a=a.parentNode}return!1},_createKeyEvent:function(a,b){return{type:a,event:b,preventDefault:function(){this.defaultPrevented=!0}}},_createMouseEvent:function(a,b){var e=this.convert({x:b.clientX,y:b.clientY},"page","document");return{type:a,event:b,clickCount:this._clickCount,x:e.x,y:e.y,
preventDefault:function(){this.defaultPrevented=!0}}},_handleMouseUp:function(a){var b=a.which?0===a.button:1===a.button;if(this.isListening("MouseUp")&&(this._isClientDiv(a)||b&&this._isMouseDown))this.onMouseUp(this._createMouseEvent("MouseUp",a));!this._linksVisible&&(b&&this._isMouseDown)&&(-1!==this._dragOffset&&(b=this._getSelection(),b.extend(this._dragOffset),b.collapse(),this._setSelection(b,!0,!0),this._dragOffset=-1),this._isMouseDown=!1,this._endAutoScroll(),this._isW3CEvents&&this._setGrab(null),
e.isFirefox&&a.preventDefault())},_handleMouseWheel:function(a){var b=this._getLineHeight(),g=0,c=0;e.isIE||e.isOpera?c=-a.wheelDelta/40*b:e.isFirefox?"wheel"===a.type?a.deltaMode?(g=Math.max(-256,Math.min(256,a.deltaX))*b,c=Math.max(-256,Math.min(256,a.deltaY))*b):(g=a.deltaX,c=a.deltaY):(b=e.isMac?3*a.detail:Math.max(-256,Math.min(256,a.detail))*b,a.axis===a.HORIZONTAL_AXIS?g=b:c=b):e.isMac?(c=a.timeStamp-this._wheelTimeStamp,this._wheelTimeStamp=a.timeStamp,g=0!==a.wheelDeltaX%120?1:40>c?40/(40-
c):40,c=0!==a.wheelDeltaY%120?1:40>c?40/(40-c):40,g=Math.ceil(-a.wheelDeltaX/g),-1<g&&0>g&&(g=-1),0<g&&1>g&&(g=1),c=Math.ceil(-a.wheelDeltaY/c),-1<c&&0>c&&(c=-1),0<c&&1>c&&(c=1)):(g=-a.wheelDeltaX,c=8*(-a.wheelDeltaY/120)*b);if(e.isSafari||e.isChrome&&e.isMac){for(b=a.target;b&&void 0===b.lineIndex;)b=b.parentNode;this._mouseWheelLine=b}b=this._getScroll();this._scrollView(g,c);g=this._getScroll();if(b.x!==g.x||b.y!==g.y)return a.preventDefault&&a.preventDefault(),!1},_handlePaste:function(a){if(!this._ignoreEvent(a)&&
!this._ignorePaste&&this._doPaste(a)){if(e.isIE){var b=this;this._ignoreFocus=!0;this._getWindow().setTimeout(function(){b._updateDOMSelection();b._ignoreFocus=!1},0)}a.preventDefault&&a.preventDefault();return!1}},_handleResize:function(){var b=this._rootDiv.clientWidth,g=this._rootDiv.clientHeight;if(this._rootWidth!==b||this._rootHeight!==g)this._rootWidth!==b&&this._wrapMode&&this._resetLineHeight(),this._rootWidth=b,this._rootHeight=g,b=9>e.isIE,g=this._calculateMetrics(),a(g,this._metrics)||
(this._variableLineHeight&&(this._variableLineHeight=!1,this._resetLineHeight()),this._metrics=g,b=!0),b?this._queueUpdate():this._update()},_handleRulerEvent:function(a){for(var b=a.target?a.target:a.srcElement,e=b.lineIndex;b&&!b._ruler;)void 0===e&&void 0!==b.lineIndex&&(e=b.lineIndex),b=b.parentNode;var g=b?b._ruler:null;if(void 0===e&&g&&"document"===g.getOverview()){var e=this._getClientHeight(),c=this._model.getLineCount(),d=this._getViewPadding(),l=this._viewDiv.getBoundingClientRect(),e=
Math.floor((a.clientY-l.top-this._metrics.scrollWidth)*c/(e+d.top+d.bottom-2*this._metrics.scrollWidth));0<=e&&e<c||(e=void 0)}if(g)switch(a.type){case "click":if(g.onClick)g.onClick(e,a);break;case "dblclick":if(g.onDblClick)g.onDblClick(e,a);break;case "mousemove":if(g.onMouseMove)g.onMouseMove(e,a);break;case "mouseover":if(g.onMouseOver)g.onMouseOver(e,a);break;case "mouseout":if(g.onMouseOut){for(c=a.relatedTarget;c&&c!==this._rootDiv;){if(c===b)return;c=c.parentNode}g.onMouseOut(e,a)}}},_handleScroll:function(){var a=
this._getScroll(!1),b=this._hScroll,e=this._vScroll;if(b!==a.x||e!==a.y)this._hScroll=a.x,this._vScroll=a.y,this._commitIME(),this._update(e===a.y),this.onScroll({type:"Scroll",oldValue:{x:b,y:e},newValue:a})},_handleSelectStart:function(a){if(this._ignoreSelect)return a&&a.preventDefault&&a.preventDefault(),!1},_getModelOffset:function(a,b){if(a){var e;e="DIV"===a.tagName?a:a.parentNode.parentNode;var g=0,c=e.lineIndex;if("DIV"!==a.tagName)for(e=e.firstChild;e;){var d=e.firstChild;if(d===a){e.ignoreChars&&
(g-=e.ignoreChars);g+=b;break}e.ignoreChars&&(g-=e.ignoreChars);g+=d.data.length;e=e.nextSibling}return Math.max(0,g)+this._model.getLineStart(c)}},_updateSelectionFromDOM:function(){var a=this._getWindow().getSelection(),b=this._getModelOffset(a.anchorNode,a.anchorOffset),a=this._getModelOffset(a.focusNode,a.focusOffset);void 0===b||void 0===a||this._setSelection(new q(b,a),!1,!1)},_handleSelectionChange:function(){if(-1===this._imeOffset)if(e.isAndroid){var a=this._getWindow();this._selTimer&&a.clearTimeout(this._selTimer);
var b=this;this._selTimer=a.setTimeout(function(){b._clientDiv&&(b._selTimer=null,b._updateSelectionFromDOM())},250)}else this._updateSelectionFromDOM()},_handleTextInput:function(a){if(!this._ignoreEvent(a)){this._imeOffset=-1;var b=this._getWindow().getSelection();if(b.anchorNode!==this._anchorNode||b.focusNode!==this._focusNode||b.anchorOffset!==this._anchorOffset||b.focusOffset!==this._focusOffset){for(var e=b.anchorNode;e&&void 0===e.lineIndex;)e=e.parentNode;if(e){var g=this._model,c=e.lineIndex,
d=g.getLine(c),l=d,h=0,g=g.getLineStart(c);0<b.rangeCount&&(b.getRangeAt(0).deleteContents(),c=e.ownerDocument.createTextNode(a.data),b.getRangeAt(0).insertNode(c),h=this._getDOMText(e,c),l=h.text,h=h.offset,c.parentNode.removeChild(c));e.lineRemoved=!0;for(e=0;d.charCodeAt(e)===l.charCodeAt(e)&&e<h;)e++;b=d.length-1;for(c=l.length-d.length;d.charCodeAt(b)===l.charCodeAt(b+c)&&b+c>=h+a.data.length;)b--;b++;d=l.substring(e,b+c);this._modifyContent({text:d,start:e+g,end:b+g,_ignoreDOMSelection:!0},
!0)}}else this._doContent(a.data);a.preventDefault()}},_handleTouchStart:function(a){this._commitIME();var b=this._getWindow();this._touchScrollTimer&&(this._vScrollDiv.style.display="none",this._hScrollDiv.style.display="none",b.clearInterval(this._touchScrollTimer),this._touchScrollTimer=null);var g=a.touches;if(1===g.length){var g=g[0],c=g.clientX,d=g.clientY;this._touchStartX=c;this._touchStartY=d;if(e.isAndroid&&(d<g.pageY-b.pageYOffset||c<g.pageX-b.pageXOffset))c=g.pageX-b.pageXOffset,d=g.pageY-
b.pageYOffset;b=this.convert({x:c,y:d},"page","document");this._lastTouchOffset=this.getOffsetAtLocation(b.x,b.y);this._touchStartTime=a.timeStamp;this._touching=!0}},_handleTouchMove:function(a){var b=a.touches;if(1===b.length){b=b[0];this._touchCurrentX=b.clientX;this._touchCurrentY=b.clientY;if(!this._touchScrollTimer&&200>a.timeStamp-this._touchStartTime){this._vScrollDiv.style.display="block";this._wrapMode||(this._hScrollDiv.style.display="block");var e=this,g=this._getWindow();this._touchScrollTimer=
g.setInterval(function(){var a=0,b=0;if(e._touching)a=e._touchStartX-e._touchCurrentX,b=e._touchStartY-e._touchCurrentY,e._touchSpeedX=a/10,e._touchSpeedY=b/10,e._touchStartX=e._touchCurrentX,e._touchStartY=e._touchCurrentY;else{if(0.1>Math.abs(e._touchSpeedX)&&0.1>Math.abs(e._touchSpeedY)){e._vScrollDiv.style.display="none";e._hScrollDiv.style.display="none";g.clearInterval(e._touchScrollTimer);e._touchScrollTimer=null;return}a=10*e._touchSpeedX;b=10*e._touchSpeedY;e._touchSpeedX*=0.95;e._touchSpeedY*=
0.95}e._scrollView(a,b)},10)}this._touchScrollTimer&&a.preventDefault()}},_handleTouchEnd:function(a){0===a.touches.length&&(this._touching=!1)},_doAction:function(a){var b,e,g=this._keyModes;for(e=g.length-1;0<=e;e--)if(b=g[e],"function"===typeof b.match&&(b=b.match(a),void 0!==b))return this.invokeAction(b);return!1},_doMove:function(a,b){var e=this._model,g=b.getCaret(),c=e.getLineAtOffset(g);a.count||(a.count=1);for(;0!==a.count;){var d=e.getLineStart(c);if(0>a.count&&g===d)if(0<c)"character"===
a.unit&&a.count++,c--,b.extend(e.getLineEnd(c));else break;else if(0<a.count&&g===e.getLineEnd(c))if(c+1<e.getLineCount())"character"===a.unit&&a.count--,c++,b.extend(e.getLineStart(c));else break;else{var l=!1;a.expandTab&&("character"===a.unit&&0===(g-d)%this._tabSize)&&(d=e.getText(d,g),l=!/[^ ]/.test(d));l?(b.extend(g-this._tabSize),a.count+=0>a.count?1:-1):(d=this._getLine(c),b.extend(d.getNextOffset(g,a)),d.destroy())}g=b.getCaret()}return b},_doBackspace:function(a){var b=this._getSelection();
b.isEmpty()&&(a.count||(a.count=1),a.count*=-1,a.expandTab=this._expandTab,this._doMove(a,b));this._modifyContent({text:"",start:b.start,end:b.end},!0);return!0},_doCase:function(a){var b=this._getSelection();this._doMove(a,b);var e=this.getText(b.start,b.end);this._setSelection(b,!0);switch(a.type){case "lower":e=e.toLowerCase();break;case "capitalize":e=e.replace(/(?:^|\s)\S/g,function(a){return a.toUpperCase()});break;case "reverse":a="";for(b=0;b<e.length;b++)var g=e[b],c=g.toLowerCase(),g=c!==
g?c:g.toUpperCase(),a=a+g;e=a;break;default:e=e.toUpperCase()}this._doContent(e);return!0},_doContent:function(a){var b=this._getSelection();if(this._overwriteMode&&b.isEmpty()){var e=this._model,g=e.getLineAtOffset(b.end);b.end<e.getLineEnd(g)&&(e=this._getLine(g),b.extend(e.getNextOffset(b.getCaret(),{unit:"character",count:1})),e.destroy())}this._modifyContent({text:a,start:b.start,end:b.end,_ignoreDOMSelection:!0},!0)},_doCopy:function(a){var b=this._getSelection();return!b.isEmpty()?(b=this._getBaseText(b.start,
b.end),this._setClipboardText(b,a)):!0},_doCursorNext:function(a){var b=this._getSelection();!b.isEmpty()&&!a.select?b.start=b.end:this._doMove(a,b);a.select||b.collapse();this._setSelection(b,!0);return!0},_doCursorPrevious:function(a){var b=this._getSelection();!b.isEmpty()&&!a.select?b.end=b.start:(a.count||(a.count=1),a.count*=-1,this._doMove(a,b));a.select||b.collapse();this._setSelection(b,!0);return!0},_doCut:function(a){var b=this._getSelection();return!b.isEmpty()?(b=this._getBaseText(b.start,
b.end),this._doContent(""),this._setClipboardText(b,a)):!0},_doDelete:function(a){var b=this._getSelection();b.isEmpty()&&this._doMove(a,b);this._modifyContent({text:"",start:b.start,end:b.end},!0);return!0},_doEnd:function(a){var b=this._getSelection(),e=this._model,g;if(a.ctrl)b.extend(e.getCharCount()),g=function(){};else{var c=b.getCaret(),d=e.getLineAtOffset(c);if(this._wrapMode){var l=this._getLine(d),c=l.getLineIndex(c),c=c===l.getLineCount()-1?e.getLineEnd(d):l.getLineStart(c+1)-1;l.destroy()}else a.count&&
0<a.count&&(d=Math.min(d+a.count-1,e.getLineCount()-1)),c=e.getLineEnd(d);b.extend(c)}a.select||b.collapse();this._setSelection(b,!0,!0,g);return!0},_doEnter:function(a){var b=this._model,e=this._getSelection();this._doContent(b.getLineDelimiter());a&&a.noCursor&&(e.end=e.start,this._setSelection(e,!0));return!0},_doHome:function(a){var b=this._getSelection(),e=this._model,g;if(a.ctrl)b.extend(0),g=function(){};else{var c=b.getCaret(),d=e.getLineAtOffset(c);this._wrapMode?(e=this._getLine(d),c=e.getLineIndex(c),
c=e.getLineStart(c),e.destroy()):c=e.getLineStart(d);b.extend(c)}a.select||b.collapse();this._setSelection(b,!0,!0,g);return!0},_doLineDown:function(a){var b=this._model,g=this._getSelection(),c=g.getCaret(),d=b.getLineAtOffset(c),l=this._getLine(d),h=this._columnX,f=1,n=!1;if(-1===h||a.wholeLine||a.select&&e.isIE)h=a.wholeLine?b.getLineEnd(d+1):c,h=l.getBoundingClientRect(h).left;(c=l.getLineIndex(c))<l.getLineCount()-1?f=l.getClientRects(c+1).top+1:(c=b.getLineCount()-1,n=d===c,a.count&&0<a.count?
d=Math.min(d+a.count,c):d++);c=!1;if(n){if(a.select||e.isMac||e.isLinux)g.extend(b.getCharCount()),c=!0}else l.lineIndex!==d&&(l.destroy(),l=this._getLine(d)),g.extend(l.getOffset(h,f)),c=!0;c&&(a.select||g.collapse(),this._setSelection(g,!0,!0));this._columnX=h;l.destroy();return!0},_doLineUp:function(a){var b=this._model,g=this._getSelection(),c=g.getCaret(),d=b.getLineAtOffset(c),l=this._getLine(d),h=this._columnX,f=!1,n;if(-1===h||a.wholeLine||a.select&&e.isIE)h=a.wholeLine?b.getLineStart(d-1):
c,h=l.getBoundingClientRect(h).left;0<(c=l.getLineIndex(c))?n=l.getClientRects(c-1).top+1:(f=0===d,f||(a.count&&0<a.count?d=Math.max(d-a.count,0):d--,n=this._getLineHeight(d)-1));c=!1;if(f){if(a.select||e.isMac||e.isLinux)g.extend(0),c=!0}else l.lineIndex!==d&&(l.destroy(),l=this._getLine(d)),g.extend(l.getOffset(h,n)),c=!0;c&&(a.select||g.collapse(),this._setSelection(g,!0,!0));this._columnX=h;l.destroy();return!0},_doNoop:function(){return!0},_doPageDown:function(a){var b=this,g=this._model,c=this._getSelection(),
d=c.getCaret(),l=g.getLineAtOffset(d),h=g.getLineCount(),f=this._getScroll(),g=this._getClientHeight(),n,j;if(this._lineHeight){n=this._columnX;f=this._getBoundsAtOffset(d);if(-1===n||a.select&&e.isIE)n=f.left;d=this._getLineIndex(f.top+g);j=this._getLine(d);l=this._getLinePixel(d);d=j.getOffset(n,f.top+g-l);g=j.getBoundingClientRect(d);j.destroy();c.extend(d);a.select||c.collapse();this._setSelection(c,!0,!0,function(){b._columnX=n},g.top+l-f.top);return!0}if(l<h-1){var q=this._getLineHeight(),r=
Math.min(h-l-1,Math.floor(g/q)),r=Math.max(1,r);n=this._columnX;if(-1===n||a.select&&e.isIE)j=this._getLine(l),n=j.getBoundingClientRect(d).left,j.destroy();j=this._getLine(l+r);c.extend(j.getOffset(n,0));j.destroy();a.select||c.collapse();a=h*q;d=f.y+r*q;d+g>a&&(d=a-g);this._setSelection(c,!0,!0,function(){b._columnX=n},d-f.y)}return!0},_doPageUp:function(a){var b=this,g=this._model,c=this._getSelection(),d=c.getCaret(),l=g.getLineAtOffset(d),h=this._getScroll(),f=this._getClientHeight(),n;if(this._lineHeight){n=
this._columnX;h=this._getBoundsAtOffset(d);if(-1===n||a.select&&e.isIE)n=h.left;d=this._getLineIndex(h.bottom-f);g=this._getLine(d);l=this._getLinePixel(d);d=g.getOffset(n,h.bottom-f-l);f=g.getBoundingClientRect(d);g.destroy();c.extend(d);a.select||c.collapse();this._setSelection(c,!0,!0,function(){b._columnX=n},f.top+l-h.top);return!0}if(0<l){var j=this._getLineHeight(),f=Math.max(1,Math.min(l,Math.floor(f/j)));n=this._columnX;if(-1===n||a.select&&e.isIE)g=this._getLine(l),n=g.getBoundingClientRect(d).left,
g.destroy();g=this._getLine(l-f);c.extend(g.getOffset(n,this._getLineHeight(l-f)-1));g.destroy();a.select||c.collapse();a=Math.max(0,h.y-f*j);this._setSelection(c,!0,!0,function(){b._columnX=n},a-h.y)}return!0},_doPaste:function(a){var b=this;return null!==this._getClipboardText(a,function(a){a&&(e.isLinux&&2===b._lastMouseButton&&(new Date).getTime()-b._lastMouseTime<=b._clickTime&&b._setSelectionTo(b._lastMouseX,b._lastMouseY),b._doContent(a))})},_doScroll:function(a){var b=a.type,e=this._model,
g=e.getLineCount(),a=this._getClientHeight(),c=this._getLineHeight(),g=g*c,d=this._getScroll().y,l;switch(b){case "textStart":l=0;break;case "textEnd":l=g-a;break;case "pageDown":l=d+a;break;case "pageUp":l=d-a;break;case "lineDown":l=d+c;break;case "lineUp":l=d-c;break;case "centerLine":b=this._getSelection(),l=e.getLineAtOffset(b.start),e=(e.getLineAtOffset(b.end)-l+1)*c,l=l*c-a/2+e/2}void 0!==l&&(l=Math.min(Math.max(0,l),g-a),this._scrollViewAnimated(0,l-d,function(){}));return!0},_doSelectAll:function(){var a=
this._model,b=this._getSelection();b.setCaret(0);b.extend(a.getCharCount());this._setSelection(b,!1);return!0},_doTab:function(){if(this._tabMode&&!this._readonly){var a="\t";if(this._expandTab)var b=this._model,a=this._getSelection().getCaret(),e=b.getLineAtOffset(a),b=b.getLineStart(e),a=Array(this._tabSize-(a-b)%this._tabSize+1).join(" ");this._doContent(a);return!0}},_doShiftTab:function(){if(this._tabMode&&!this._readonly)return!0},_doOverwriteMode:function(){if(!this._readonly)return this.setOptions({overwriteMode:!this.getOptions("overwriteMode")}),
!0},_doTabMode:function(){this._tabMode=!this._tabMode;return!0},_doWrapMode:function(){this.setOptions({wrapMode:!this.getOptions("wrapMode")});return!0},_autoScroll:function(){var a=this._model,b=this._getSelection(),g=this.convert({x:this._autoScrollX,y:this._autoScrollY},"page","document"),c=b.getCaret(),d=a.getLineCount(),l=a.getLineAtOffset(c),h;if("up"===this._autoScrollDir||"down"===this._autoScrollDir)c=this._autoScrollY/this._getLineHeight(),c=0>c?Math.floor(c):Math.ceil(c),h=Math.max(0,
Math.min(d-1,l+c));else if("left"===this._autoScrollDir||"right"===this._autoScrollDir)h=this._getLineIndex(g.y),l=this._getLine(l),g.x+=l.getBoundingClientRect(c,!1).left,l.destroy();0===h&&(e.isMac||e.isLinux)?b.extend(0):h===d-1&&(e.isMac||e.isLinux)?b.extend(a.getCharCount()):(l=this._getLine(h),b.extend(l.getOffset(g.x,g.y-this._getLinePixel(h))),l.destroy());this._setSelection(b,!0)},_autoScrollTimer:function(){this._autoScroll();var a=this;this._autoScrollTimerID=this._getWindow().setTimeout(function(){a._autoScrollTimer()},
this._AUTO_SCROLL_RATE)},_calculateLineHeightTimer:function(a){if(this._lineHeight&&!this._calculateLHTimer){var b=this._model.getLineCount(),e=0;if(a){for(var a=0,g=(new Date).getTime(),c=0;e<b&&!(this._lineHeight[e]||(a++,c||(c=e),this._lineHeight[e]=this._calculateLineHeight(e)),e++,100<(new Date).getTime()-g););this.redrawRulers(0,b);this._queueUpdate()}a=this._getWindow();if(e!==b){var d=this;this._calculateLHTimer=a.setTimeout(function(){d._calculateLHTimer=null;d._calculateLineHeightTimer(!0)},
0)}else this._calculateLHTimer&&(a.clearTimeout(this._calculateLHTimer),this._calculateLHTimer=void 0)}},_calculateLineHeight:function(a){var a=this._getLine(a),b=a.getBoundingClientRect();a.destroy();return Math.max(1,b.bottom-b.top)},_calculateMetrics:function(){var a=this._clientDiv,b=a.ownerDocument,g=e.createElement(b,"div");g.style.lineHeight="normal";var c={type:"LineStyle",textView:this,"0":0,lineText:this._model.getLine(0),lineStart:0};this.onLineStyle(c);h(c.style,g);g.style.position="fixed";
g.style.left="-1000px";var d=e.createElement(b,"span");d.appendChild(b.createTextNode(" "));g.appendChild(d);var f=e.createElement(b,"span");f.style.fontStyle="italic";f.appendChild(b.createTextNode(" "));g.appendChild(f);var j=e.createElement(b,"span");j.style.fontWeight="bold";j.appendChild(b.createTextNode(" "));g.appendChild(j);c=e.createElement(b,"span");c.style.fontWeight="bold";c.style.fontStyle="italic";c.appendChild(b.createTextNode(" "));g.appendChild(c);a.appendChild(g);var q=g.getBoundingClientRect(),
d=d.getBoundingClientRect(),f=f.getBoundingClientRect(),j=j.getBoundingClientRect(),c=c.getBoundingClientRect(),d=d.bottom-d.top,f=f.bottom-f.top,j=j.bottom-j.top,r=c.bottom-c.top,i=0,c=0>=q.bottom-q.top,q=Math.max(1,q.bottom-q.top);f>d&&(i=1);j>f&&(i=2);r>j&&(i=3);var k;0!==i&&(k={style:{}},0!==(i&1)&&(k.style.fontStyle="italic"),0!==(i&2)&&(k.style.fontWeight="bold"));d=n(g);a.removeChild(g);r=l(this._viewDiv);g=e.createElement(b,"div");g.style.position="fixed";g.style.left="-1000px";g.style.paddingLeft=
r.left+"px";g.style.paddingTop=r.top+"px";g.style.paddingRight=r.right+"px";g.style.paddingBottom=r.bottom+"px";g.style.width="100px";g.style.height="100px";r=e.createElement(b,"div");r.style.width="100%";r.style.height="100%";g.appendChild(r);a.appendChild(g);i=g.getBoundingClientRect();f=r.getBoundingClientRect();j=0;this._singleMode||(g.style.overflow="hidden",r.style.height="200px",j=g.clientWidth,g.style.overflow="scroll",j-=g.clientWidth);a.removeChild(g);r={left:f.left-i.left,top:f.top-i.top,
right:i.right-f.right,bottom:i.bottom-f.bottom};f=i=0;if(!c&&(this._wrapOffset||this._marginOffset))g=e.createElement(b,"div"),g.style.position="fixed",g.style.left="-1000px",g.innerHTML=Array(this._wrapOffset+1+(e.isWebkit?0:1)).join(" "),a.appendChild(g),i=g.getBoundingClientRect(),i=Math.ceil(i.right-i.left),g.innerHTML=Array(this._marginOffset+1).join(" "),f=g.getBoundingClientRect(),f=Math.ceil(f.right-f.left),a.removeChild(g);return{lineHeight:q,largestFontStyle:k,lineTrim:d,viewPadding:r,scrollWidth:j,
wrapWidth:i,marginWidth:f,invalid:c}},_cancelAnimation:function(){this._animation&&(this._animation.stop(),this._animation=null)},_clearSelection:function(a){var b=this._getSelection();if(b.isEmpty())return!1;"next"===a?b.start=b.end:b.end=b.start;this._setSelection(b,!0);return!0},_commitIME:function(){if(-1!==this._imeOffset){this._scrollDiv.focus();this._clientDiv.focus();var a=this._model,b=a.getLineAtOffset(this._imeOffset),g=a.getLineStart(b),e=this._getDOMText(this._getLineNode(b)).text,a=
a.getLine(b),g=this._imeOffset-g,a=g+e.length-a.length;g!==a&&(e=e.substring(g,a),this._doContent(e));this._imeOffset=-1}},_createActions:function(){this.addKeyMode(new i.DefaultKeyMode(this));var a=this;this._actions={noop:{defaultHandler:function(){return a._doNoop()}},lineUp:{defaultHandler:function(g){return a._doLineUp(b(g,{select:!1}))},actionDescription:{name:k.lineUp}},lineDown:{defaultHandler:function(g){return a._doLineDown(b(g,{select:!1}))},actionDescription:{name:k.lineDown}},lineStart:{defaultHandler:function(g){return a._doHome(b(g,
{select:!1,ctrl:!1}))},actionDescription:{name:k.lineStart}},lineEnd:{defaultHandler:function(g){return a._doEnd(b(g,{select:!1,ctrl:!1}))},actionDescription:{name:k.lineEnd}},charPrevious:{defaultHandler:function(g){return a._doCursorPrevious(b(g,{select:!1,unit:"character"}))},actionDescription:{name:k.charPrevious}},charNext:{defaultHandler:function(g){return a._doCursorNext(b(g,{select:!1,unit:"character"}))},actionDescription:{name:k.charNext}},pageUp:{defaultHandler:function(g){return a._doPageUp(b(g,
{select:!1}))},actionDescription:{name:k.pageUp}},pageDown:{defaultHandler:function(g){return a._doPageDown(b(g,{select:!1}))},actionDescription:{name:k.pageDown}},scrollPageUp:{defaultHandler:function(g){return a._doScroll(b(g,{type:"pageUp"}))},actionDescription:{name:k.scrollPageUp}},scrollPageDown:{defaultHandler:function(g){return a._doScroll(b(g,{type:"pageDown"}))},actionDescription:{name:k.scrollPageDown}},scrollLineUp:{defaultHandler:function(g){return a._doScroll(b(g,{type:"lineUp"}))},
actionDescription:{name:k.scrollLineUp}},scrollLineDown:{defaultHandler:function(g){return a._doScroll(b(g,{type:"lineDown"}))},actionDescription:{name:k.scrollLineDown}},wordPrevious:{defaultHandler:function(g){return a._doCursorPrevious(b(g,{select:!1,unit:"word"}))},actionDescription:{name:k.wordPrevious}},wordNext:{defaultHandler:function(g){return a._doCursorNext(b(g,{select:!1,unit:"word"}))},actionDescription:{name:k.wordNext}},textStart:{defaultHandler:function(g){return a._doHome(b(g,{select:!1,
ctrl:!0}))},actionDescription:{name:k.textStart}},textEnd:{defaultHandler:function(g){return a._doEnd(b(g,{select:!1,ctrl:!0}))},actionDescription:{name:k.textEnd}},scrollTextStart:{defaultHandler:function(g){return a._doScroll(b(g,{type:"textStart"}))},actionDescription:{name:k.scrollTextStart}},scrollTextEnd:{defaultHandler:function(g){return a._doScroll(b(g,{type:"textEnd"}))},actionDescription:{name:k.scrollTextEnd}},centerLine:{defaultHandler:function(g){return a._doScroll(b(g,{type:"centerLine"}))},
actionDescription:{name:k.centerLine}},selectLineUp:{defaultHandler:function(g){return a._doLineUp(b(g,{select:!0}))},actionDescription:{name:k.selectLineUp}},selectLineDown:{defaultHandler:function(g){return a._doLineDown(b(g,{select:!0}))},actionDescription:{name:k.selectLineDown}},selectWholeLineUp:{defaultHandler:function(g){return a._doLineUp(b(g,{select:!0,wholeLine:!0}))},actionDescription:{name:k.selectWholeLineUp}},selectWholeLineDown:{defaultHandler:function(g){return a._doLineDown(b(g,
{select:!0,wholeLine:!0}))},actionDescription:{name:k.selectWholeLineDown}},selectLineStart:{defaultHandler:function(g){return a._doHome(b(g,{select:!0,ctrl:!1}))},actionDescription:{name:k.selectLineStart}},selectLineEnd:{defaultHandler:function(g){return a._doEnd(b(g,{select:!0,ctrl:!1}))},actionDescription:{name:k.selectLineEnd}},selectCharPrevious:{defaultHandler:function(g){return a._doCursorPrevious(b(g,{select:!0,unit:"character"}))},actionDescription:{name:k.selectCharPrevious}},selectCharNext:{defaultHandler:function(g){return a._doCursorNext(b(g,
{select:!0,unit:"character"}))},actionDescription:{name:k.selectCharNext}},selectPageUp:{defaultHandler:function(g){return a._doPageUp(b(g,{select:!0}))},actionDescription:{name:k.selectPageUp}},selectPageDown:{defaultHandler:function(g){return a._doPageDown(b(g,{select:!0}))},actionDescription:{name:k.selectPageDown}},selectWordPrevious:{defaultHandler:function(g){return a._doCursorPrevious(b(g,{select:!0,unit:"word"}))},actionDescription:{name:k.selectWordPrevious}},selectWordNext:{defaultHandler:function(g){return a._doCursorNext(b(g,
{select:!0,unit:"word"}))},actionDescription:{name:k.selectWordNext}},selectTextStart:{defaultHandler:function(g){return a._doHome(b(g,{select:!0,ctrl:!0}))},actionDescription:{name:k.selectTextStart}},selectTextEnd:{defaultHandler:function(g){return a._doEnd(b(g,{select:!0,ctrl:!0}))},actionDescription:{name:k.selectTextEnd}},deletePrevious:{defaultHandler:function(g){return a._doBackspace(b(g,{unit:"character"}))},actionDescription:{name:k.deletePrevious}},deleteNext:{defaultHandler:function(g){return a._doDelete(b(g,
{unit:"character"}))},actionDescription:{name:k.deleteNext}},deleteWordPrevious:{defaultHandler:function(g){return a._doBackspace(b(g,{unit:"word"}))},actionDescription:{name:k.deleteWordPrevious}},deleteWordNext:{defaultHandler:function(g){return a._doDelete(b(g,{unit:"word"}))},actionDescription:{name:k.deleteWordNext}},deleteLineStart:{defaultHandler:function(g){return a._doBackspace(b(g,{unit:"line"}))},actionDescription:{name:k.deleteLineStart}},deleteLineEnd:{defaultHandler:function(g){return a._doDelete(b(g,
{unit:"line"}))},actionDescription:{name:k.deleteLineEnd}},tab:{defaultHandler:function(){return a._doTab()},actionDescription:{name:k.tab}},shiftTab:{defaultHandler:function(){return a._doShiftTab()},actionDescription:{name:k.shiftTab}},enter:{defaultHandler:function(){return a._doEnter()},actionDescription:{name:k.enter}},enterNoCursor:{defaultHandler:function(g){return a._doEnter(b(g,{noCursor:!0}))},actionDescription:{name:k.enterNoCursor}},selectAll:{defaultHandler:function(){return a._doSelectAll()},
actionDescription:{name:k.selectAll}},copy:{defaultHandler:function(){return a._doCopy()},actionDescription:{name:k.copy}},cut:{defaultHandler:function(){return a._doCut()},actionDescription:{name:k.cut}},paste:{defaultHandler:function(){return a._doPaste()},actionDescription:{name:k.paste}},uppercase:{defaultHandler:function(g){return a._doCase(b(g,{type:"upper"}))},actionDescription:{name:k.uppercase}},lowercase:{defaultHandler:function(g){return a._doCase(b(g,{type:"lower"}))},actionDescription:{name:k.lowercase}},
capitalize:{defaultHandler:function(g){return a._doCase(b(g,{unit:"word",type:"capitalize"}))},actionDescription:{name:k.capitalize}},reversecase:{defaultHandler:function(g){return a._doCase(b(g,{type:"reverse"}))},actionDescription:{name:k.reversecase}},toggleOverwriteMode:{defaultHandler:function(){return a._doOverwriteMode()},actionDescription:{name:k.toggleOverwriteMode}},toggleTabMode:{defaultHandler:function(){return a._doTabMode()},actionDescription:{name:k.toggleTabMode}},toggleWrapMode:{defaultHandler:function(){return a._doWrapMode()},
actionDescription:{name:k.toggleWrapMode}}}},_createRulerParent:function(a){var b=e.createElement(document,"div");b.className=a;b.tabIndex=-1;b.style.overflow="hidden";b.style.MozUserSelect="none";b.style.WebkitUserSelect="none";b.style.position="absolute";b.style.top="0px";b.style.bottom="0px";b.style.cursor="default";b.style.display="none";b.setAttribute("aria-hidden","true");this._rootDiv.appendChild(b);return b},_createRuler:function(a,b){if(this._clientDiv){var g=this._getRulerParent(a);if(g){if(g!==
this._marginDiv||this._marginOffset)g.style.display="block";var c=e.createElement(g.ownerDocument,"div");c._ruler=a;c.rulerChanged=!0;c.style.position="relative";c.style.cssFloat="left";c.style.styleFloat="left";c.style.outline="none";if(void 0===b||0>b||b>=g.children.length)g.appendChild(c);else{for(var d=g.firstChild;d&&0<b--;)d=d.nextSibling;g.insertBefore(c,d)}}}},_createView:function(){if(!this._clientDiv){for(var a=this._parent;a.hasChildNodes();)a.removeChild(a.lastChild);var b=a.ownerDocument,
g=e.createElement(b,"div");this._rootDiv=g;g.tabIndex=-1;g.style.position="relative";g.style.overflow="hidden";g.style.width="100%";g.style.height="100%";g.style.overflow="hidden";g.style.WebkitTextSizeAdjust="100%";g.setAttribute("role","application");a.appendChild(g);this._leftDiv=this._createRulerParent("textviewLeftRuler");a=e.createElement(b,"div");a.className="textviewScroll";this._viewDiv=a;a.tabIndex=-1;a.style.position="absolute";a.style.top="0px";a.style.bottom="0px";a.style.borderWidth=
"0px";a.style.margin="0px";a.style.outline="none";a.style.background="transparent";e.isMac&&e.isWebkit&&(a.style.pointerEvents="none",a.style.zIndex="2");g.appendChild(a);var c=this._createRulerParent("textviewRightRuler");this._rightDiv=c;c.style.right="0px";this._scrollDiv=c=e.createElement(b,"div");c.style.margin="0px";c.style.borderWidth="0px";c.style.padding="0px";a.appendChild(c);(this._marginDiv=this._createRulerParent("textviewMarginRuler")).style.zIndex="4";!e.isIE&&!e.isIOS&&(this._clipDiv=
a=e.createElement(b,"div"),a.style.position="absolute",a.style.overflow="hidden",a.style.margin="0px",a.style.borderWidth="0px",a.style.padding="0px",a.style.background="transparent",g.appendChild(a),this._clipScrollDiv=c=e.createElement(b,"div"),c.style.position="absolute",c.style.height="1px",c.style.top="-1000px",c.style.background="transparent",a.appendChild(c));this._setFullSelection(this._fullSelection,!0);a=e.createElement(b,"div");a.className="textviewContent";this._clientDiv=a;a.tabIndex=
0;a.style.position="absolute";a.style.borderWidth="0px";a.style.margin="0px";a.style.padding="0px";a.style.outline="none";a.style.zIndex="1";a.style.WebkitUserSelect="text";a.setAttribute("spellcheck","false");if(e.isIOS||e.isAndroid)a.style.WebkitTapHighlightColor="transparent";(this._clipDiv||g).appendChild(a);if(e.isIOS||e.isAndroid)this._vScrollDiv=c=e.createElement(b,"div"),c.style.position="absolute",c.style.borderWidth="1px",c.style.borderColor="white",c.style.borderStyle="solid",c.style.borderRadius=
"4px",c.style.backgroundColor="black",c.style.opacity="0.5",c.style.margin="0px",c.style.padding="0px",c.style.outline="none",c.style.zIndex="3",c.style.width="8px",c.style.display="none",g.appendChild(c),this._hScrollDiv=c=e.createElement(b,"div"),c.style.position="absolute",c.style.borderWidth="1px",c.style.borderColor="white",c.style.borderStyle="solid",c.style.borderRadius="4px",c.style.backgroundColor="black",c.style.opacity="0.5",c.style.margin="0px",c.style.padding="0px",c.style.outline="none",
c.style.zIndex="3",c.style.height="8px",c.style.display="none",g.appendChild(c);e.isFirefox&&!a.setCapture&&(this._overlayDiv=b=e.createElement(b,"div"),b.style.position=a.style.position,b.style.borderWidth=a.style.borderWidth,b.style.margin=a.style.margin,b.style.padding=a.style.padding,b.style.cursor="text",b.style.zIndex="2",(this._clipDiv||g).appendChild(b));a.contentEditable="true";a.setAttribute("role","textbox");a.setAttribute("aria-multiline","true");this._setWrapMode(this._wrapMode,!0);this._setReadOnly(this._readonly);
this._setThemeClass(this._themeClass,!0);this._setTabSize(this._tabSize,!0);this._setMarginOffset(this._marginOffset,!0);this._hookEvents();g=this._rulers;for(b=0;b<g.length;b++)this._createRuler(g[b]);this._update()}},_defaultOptions:function(){return{parent:{value:void 0,update:null},model:{value:void 0,update:this.setModel},scrollAnimation:{value:0,update:null},readonly:{value:!1,update:this._setReadOnly},fullSelection:{value:!0,update:this._setFullSelection},tabMode:{value:!0,update:null},tabSize:{value:8,
update:this._setTabSize},expandTab:{value:!1,update:null},singleMode:{value:!1,update:this._setSingleMode},overwriteMode:{value:!1,update:this._setOverwriteMode},blockCursorVisible:{value:!1,update:this._setBlockCursor},marginOffset:{value:0,update:this._setMarginOffset},wrapOffset:{value:0,update:this._setWrapOffset},wrapMode:{value:!1,update:this._setWrapMode},wrappable:{value:!1,update:null},theme:{value:c.TextTheme.getTheme(),update:this._setTheme},themeClass:{value:void 0,update:this._setThemeClass}}},
_destroyRuler:function(a){var b=this._getRulerParent(a);if(b)for(var g=b.firstChild;g;){if(g._ruler===a){g._ruler=void 0;b.removeChild(g);if(0===b.children.length&&(b!==this._marginDiv||!this._marginOffset))b.style.display="none";break}g=g.nextSibling}},_destroyView:function(){if(this._clientDiv){this._setGrab(null);this._unhookEvents();var a=this._getWindow();this._autoScrollTimerID&&(a.clearTimeout(this._autoScrollTimerID),this._autoScrollTimerID=null);this._updateTimer&&(a.clearTimeout(this._updateTimer),
this._updateTimer=null);a=this._rootDiv;a.parentNode.removeChild(a);this._hScrollDiv=this._vScrollDiv=this._cursorDiv=this._marginDiv=this._rightDiv=this._leftDiv=this._overlayDiv=this._clientDiv=this._clipScrollDiv=this._clipDiv=this._viewDiv=this._scrollDiv=this._rootDiv=this._clipboardDiv=this._selDiv3=this._selDiv2=this._selDiv1=null}},_doAutoScroll:function(a,b,g){this._autoScrollDir=a;this._autoScrollX=b;this._autoScrollY=g;this._autoScrollTimerID||this._autoScrollTimer()},_endAutoScroll:function(){this._autoScrollTimerID&&
this._getWindow().clearTimeout(this._autoScrollTimerID);this._autoScrollTimerID=this._autoScrollDir=void 0},_fixCaret:function(){var a=this._clientDiv;if(a){var b=this._hasFocus;this._ignoreFocus=!0;b&&a.blur();a.contentEditable=!1;a.contentEditable=!0;b&&a.focus();this._ignoreFocus=!1}},_getBaseText:function(a,b){var g=this._model;g.getBaseModel&&(a=g.mapOffset(a),b=g.mapOffset(b),g=g.getBaseModel());return g.getText(a,b)},_getBottomIndex:function(a){var b=this._bottomChild;if(a&&this._getClientHeight()>
this._getLineHeight()){var a=b.getBoundingClientRect(),g=this._clientDiv.getBoundingClientRect();a.bottom>g.bottom&&(b=this._getLinePrevious(b)||b)}return b.lineIndex},_getBoundsAtOffset:function(a){var b=this._getLine(this._model.getLineAtOffset(a)),a=b.getBoundingClientRect(a),g=this._getLinePixel(b.lineIndex);a.top+=g;a.bottom+=g;b.destroy();return a},_getClientHeight:function(){var a=this._getViewPadding();return Math.max(0,this._viewDiv.clientHeight-a.top-a.bottom)},_getClientWidth:function(){var a=
this._getViewPadding();return Math.max(0,this._viewDiv.clientWidth-a.left-a.right)},_getClipboardText:function(a,b){var c=this._model.getLineDelimiter(),d,l,h=this._getWindow(),f=h.clipboardData;!f&&a&&(f=a.clipboardData);if(f)return d=[],l=f.getData(e.isIE?"Text":"text/plain"),g(l,function(a){d.push(a)},function(){d.push(c)}),l=d.join(""),b&&b(l),l;if(e.isFirefox){this._ignoreFocus=!0;var n=this._clipboardDiv,f=this._rootDiv.ownerDocument;n||(this._clipboardDiv=n=e.createElement(f,"div"),n.style.position=
"fixed",n.style.whiteSpace="pre",n.style.left="-1000px",this._rootDiv.appendChild(n));n.innerHTML="<pre contenteditable=''></pre>";n.firstChild.focus();var j=this,q=function(){var a=j._getTextFromElement(n);n.innerHTML="";d=[];g(a,function(a){d.push(a)},function(){d.push(c)});return d.join("")},r=!1;this._ignorePaste=!0;if(!e.isLinux||2!==this._lastMouseButton)try{r=f.execCommand("paste",!1,null)}catch(i){r=1<n.childNodes.length||n.firstChild&&0<n.firstChild.childNodes.length}this._ignorePaste=!1;
if(!r){if(a)return h.setTimeout(function(){j.focus();(l=q())&&b&&b(l);j._ignoreFocus=!1},0),null;this.focus();this._ignoreFocus=!1;return""}this.focus();this._ignoreFocus=!1;(l=q())&&b&&b(l);return l}return""},_getDOMText:function(a,b){for(var g=a.firstChild,e="",c=0;g;){var d;if(!g.ignore)if(g.ignoreChars){d=g.lastChild;for(var l=0,h=[],f=-1;d;){var n=d.data;if(n)for(var j=n.length-1;0<=j;j--){var q=n.substring(j,j+1);l<g.ignoreChars&&(" "===q||"\u200b"===q||"\ufeff"===q)?l++:h.push("\u00a0"===q?
"\t":q)}b===d&&(f=h.length);d=d.previousSibling}h=h.reverse().join("");-1!==f&&(c=e.length+h.length-f);e+=h}else for(d=g.firstChild;d;)b===d&&(c=e.length),e+=d.data,d=d.nextSibling;g=g.nextSibling}return{text:e,offset:c}},_getTextFromElement:function(a){var b=a.ownerDocument,g=b.defaultView;if(!g.getSelection)return a.innerText||a.textContent;b=b.createRange();b.selectNode(a);var a=g.getSelection(),g=[],e;for(e=0;e<a.rangeCount;e++)g.push(a.getRangeAt(e));this._ignoreSelect=!0;a.removeAllRanges();
a.addRange(b);b=a.toString();a.removeAllRanges();for(e=0;e<g.length;e++)a.addRange(g[e]);this._ignoreSelect=!1;return b},_getViewPadding:function(){return this._metrics.viewPadding},_getLine:function(a){var b=this._getLineNode(a);return b&&!b.lineChanged&&!b.lineRemoved?b._line:new w(this,a)},_getLineHeight:function(a,b){if(void 0!==a&&this._lineHeight){var g=this._lineHeight[a];if(g)return g;if(b||void 0===b)return this._lineHeight[a]=this._calculateLineHeight(a)}return this._metrics.lineHeight},
_getLineNode:function(a){for(var b=this._clientDiv.firstChild;b;){if(a===b.lineIndex)return b;b=b.nextSibling}},_getLineNext:function(a){for(a=a?a.nextSibling:this._clientDiv.firstChild;a&&-1===a.lineIndex;)a=a.nextSibling;return a},_getLinePrevious:function(a){for(a=a?a.previousSibling:this._clientDiv.lastChild;a&&-1===a.lineIndex;)a=a.previousSibling;return a},_getLinePixel:function(a){a=Math.min(Math.max(0,a),this._model.getLineCount());if(this._lineHeight){var b=this._getTopIndex(),g=-this._topIndexY+
this._getScroll().y;if(a>b)for(;b<a;b++)g+=this._getLineHeight(b);else for(b-=1;b>=a;b--)g-=this._getLineHeight(b);return g}return this._getLineHeight()*a},_getLineIndex:function(a){var b,g=0,e=this._model.getLineCount();if(this._lineHeight){var g=this._getTopIndex(),c=-this._topIndexY+this._getScroll().y;if(a!==c)if(a<c)for(;a<c&&0<g;)a+=this._getLineHeight(--g);else for(b=this._getLineHeight(g);a-b>=c&&g<e-1;)a-=b,b=this._getLineHeight(++g)}else b=this._getLineHeight(),g=Math.floor(a/b);return Math.max(0,
Math.min(e-1,g))},_getRulerParent:function(a){switch(a.getLocation()){case "left":return this._leftDiv;case "right":return this._rightDiv;case "margin":return this._marginDiv}return null},_getScroll:function(a){(void 0===a||a)&&this._cancelAnimation();a=this._viewDiv;return{x:a.scrollLeft,y:a.scrollTop}},_getSelection:function(){return this._selection.clone()},_getTopIndex:function(a){var b=this._topChild;if(a&&this._getClientHeight()>this._getLineHeight()){var a=b.getBoundingClientRect(),g=this._getViewPadding(),
e=this._viewDiv.getBoundingClientRect();a.top<e.top+g.top&&(b=this._getLineNext(b)||b)}return b.lineIndex},_hookEvents:function(){var a=this;this._modelListener={onChanging:function(b){a._onModelChanging(b)},onChanged:function(b){a._onModelChanged(b)}};this._model.addEventListener("preChanging",this._modelListener.onChanging);this._model.addEventListener("postChanged",this._modelListener.onChanged);this._themeListener={onChanged:function(){a._setThemeClass(a._themeClass)}};this._theme.addEventListener("ThemeChanged",
this._themeListener.onChanged);var b=this._handlers=[],g=this._clientDiv,c=this._viewDiv,d=this._rootDiv,l=this._overlayDiv||g,h=g.ownerDocument,f=this._getWindow(),n=e.isIE?h:f;b.push({target:f,type:"resize",handler:function(b){return a._handleResize(b?b:f.event)}});b.push({target:g,type:"blur",handler:function(b){return a._handleBlur(b?b:f.event)}});b.push({target:g,type:"focus",handler:function(b){return a._handleFocus(b?b:f.event)}});b.push({target:c,type:"focus",handler:function(){g.focus()}});
b.push({target:c,type:"scroll",handler:function(b){return a._handleScroll(b?b:f.event)}});b.push({target:g,type:"textInput",handler:function(b){return a._handleTextInput(b?b:f.event)}});b.push({target:g,type:"keydown",handler:function(b){return a._handleKeyDown(b?b:f.event)}});b.push({target:g,type:"keypress",handler:function(b){return a._handleKeyPress(b?b:f.event)}});b.push({target:g,type:"keyup",handler:function(b){return a._handleKeyUp(b?b:f.event)}});e.isIE&&b.push({target:h,type:"keyup",handler:function(b){return a._handleDocKeyUp(b?
b:f.event)}});b.push({target:g,type:"contextmenu",handler:function(b){return a._handleContextMenu(b?b:f.event)}});b.push({target:g,type:"copy",handler:function(b){return a._handleCopy(b?b:f.event)}});b.push({target:g,type:"cut",handler:function(b){return a._handleCut(b?b:f.event)}});b.push({target:g,type:"paste",handler:function(b){return a._handlePaste(b?b:f.event)}});if(e.isIOS||e.isAndroid)b.push({target:h,type:"selectionchange",handler:function(b){return a._handleSelectionChange(b?b:f.event)}}),
b.push({target:g,type:"touchstart",handler:function(b){return a._handleTouchStart(b?b:f.event)}}),b.push({target:g,type:"touchmove",handler:function(b){return a._handleTouchMove(b?b:f.event)}}),b.push({target:g,type:"touchend",handler:function(b){return a._handleTouchEnd(b?b:f.event)}});else{b.push({target:g,type:"selectstart",handler:function(b){return a._handleSelectStart(b?b:f.event)}});b.push({target:g,type:"mousedown",handler:function(b){return a._handleMouseDown(b?b:f.event)}});b.push({target:g,
type:"mouseover",handler:function(b){return a._handleMouseOver(b?b:f.event)}});b.push({target:g,type:"mouseout",handler:function(b){return a._handleMouseOut(b?b:f.event)}});b.push({target:n,type:"mouseup",handler:function(b){return a._handleMouseUp(b?b:f.event)}});b.push({target:n,type:"mousemove",handler:function(b){return a._handleMouseMove(b?b:f.event)}});b.push({target:d,type:"mousedown",handler:function(b){return a._handleRootMouseDown(b?b:f.event)}});b.push({target:d,type:"mouseup",handler:function(b){return a._handleRootMouseUp(b?
b:f.event)}});b.push({target:l,type:"dragstart",handler:function(b){return a._handleDragStart(b?b:f.event)}});b.push({target:l,type:"drag",handler:function(b){return a._handleDrag(b?b:f.event)}});b.push({target:l,type:"dragend",handler:function(b){return a._handleDragEnd(b?b:f.event)}});b.push({target:l,type:"dragenter",handler:function(b){return a._handleDragEnter(b?b:f.event)}});b.push({target:l,type:"dragover",handler:function(b){return a._handleDragOver(b?b:f.event)}});b.push({target:l,type:"dragleave",
handler:function(b){return a._handleDragLeave(b?b:f.event)}});b.push({target:l,type:"drop",handler:function(b){return a._handleDrop(b?b:f.event)}});b.push({target:this._clientDiv,type:26<e.isFirefox?"wheel":e.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(b){return a._handleMouseWheel(b?b:f.event)}});this._clipDiv&&b.push({target:this._clipDiv,type:26<e.isFirefox?"wheel":e.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(b){return a._handleMouseWheel(b?b:f.event)}});if(e.isFirefox&&
(!e.isWindows||15<=e.isFirefox))(c=f.MutationObserver||f.MozMutationObserver)?(this._mutationObserver=new c(function(b){a._handleDataModified(b)}),this._mutationObserver.observe(g,{subtree:!0,characterData:!0})):b.push({target:this._clientDiv,type:"DOMCharacterDataModified",handler:function(b){return a._handleDataModified(b?b:f.event)}});this._overlayDiv&&(b.push({target:this._overlayDiv,type:"mousedown",handler:function(b){return a._handleMouseDown(b?b:f.event)}}),b.push({target:this._overlayDiv,
type:"mouseover",handler:function(b){return a._handleMouseOver(b?b:f.event)}}),b.push({target:this._overlayDiv,type:"mouseout",handler:function(b){return a._handleMouseOut(b?b:f.event)}}),b.push({target:this._overlayDiv,type:"contextmenu",handler:function(b){return a._handleContextMenu(b?b:f.event)}}));this._isW3CEvents||b.push({target:this._clientDiv,type:"dblclick",handler:function(b){return a._handleDblclick(b?b:f.event)}})}this._hookRulerEvents(this._leftDiv,b);this._hookRulerEvents(this._rightDiv,
b);this._hookRulerEvents(this._marginDiv,b);for(c=0;c<b.length;c++)d=b[c],x(d.target,d.type,d.handler,d.capture)},_hookRulerEvents:function(a,b){if(a){var g=this,c=this._getWindow();e.isIE&&b.push({target:a,type:"selectstart",handler:function(){return!1}});b.push({target:a,type:26<e.isFirefox?"wheel":e.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(a){return g._handleMouseWheel(a?a:c.event)}});b.push({target:a,type:"click",handler:function(a){g._handleRulerEvent(a?a:c.event)}});b.push({target:a,
type:"dblclick",handler:function(a){g._handleRulerEvent(a?a:c.event)}});b.push({target:a,type:"mousemove",handler:function(a){g._handleRulerEvent(a?a:c.event)}});b.push({target:a,type:"mouseover",handler:function(a){g._handleRulerEvent(a?a:c.event)}});b.push({target:a,type:"mouseout",handler:function(a){g._handleRulerEvent(a?a:c.event)}})}},_getWindow:function(){return this._parent.ownerDocument.defaultView||this._parent.ownerDocument.parentWindow},_ignoreEvent:function(a){for(a=a.target;a&&a!==this._clientDiv;){if(a.ignore)return!0;
a=a.parentNode}return!1},_init:function(a){var b=a.parent;"string"===typeof b&&(b=(a.document||document).getElementById(b));if(!b)throw"no parent";a.parent=b;a.model=a.model||new m.TextModel;var g=this._defaultOptions(),c;for(c in g)g.hasOwnProperty(c)&&(this["_"+c]=void 0!==a[c]?a[c]:g[c].value);this._keyModes=[];this._rulers=[];this._selection=new q(0,0,!1);this._linksVisible=!1;this._maxLineWidth=this._redrawCount=0;this._maxLineIndex=-1;this._ignoreSelect=!0;this._hasFocus=this._ignoreFocus=!1;
this._dragOffset=this._columnX=-1;this._isRangeRects=(!e.isIE||9<=e.isIE)&&"function"===typeof b.ownerDocument.createRange().getBoundingClientRect;this._isW3CEvents=b.addEventListener;this._autoScrollTimerID=this._autoScrollY=this._autoScrollX=null;this._AUTO_SCROLL_RATE=50;this._mouseUpClosure=this._moseMoveClosure=this._grabControl=null;this._clickCount=this._lastMouseTime=this._lastMouseY=this._lastMouseX=0;this._clickTime=250;this._clickDist=5;this._isMouseDown=!1;this._doubleClickSelection=null;
this._vScroll=this._hScroll=0;this._imeOffset=-1;this._createActions();this._createView()},_modifyContent:function(a,b){if(!this._readonly||a._code)if(a.type="Verify",this.onVerify(a),!(null===a.text||void 0===a.text)){var g=this._model;try{a._ignoreDOMSelection&&(this._ignoreDOMSelection=!0),g.setText(a.text,a.start,a.end)}finally{a._ignoreDOMSelection&&(this._ignoreDOMSelection=!1)}b&&(g=this._getSelection(),g.setCaret(a.start+a.text.length),this._setSelection(g,!0));this.onModify({type:"Modify"})}},
_onModelChanged:function(a){a.type="ModelChanged";this.onModelChanged(a);a.type="Changed";var b=a.start,g=a.addedCharCount,e=a.removedCharCount,c=a.addedLineCount,d=a.removedLineCount,l=this._getSelection();l.end>b&&(l.end>b&&l.start<b+e?l.setCaret(b+g):(l.start+=g-e,l.end+=g-e),this._setSelection(l,!1,!1));b=this._model.getLineAtOffset(b);for(g=this._getLineNext();g;)e=g.lineIndex,b<=e&&e<=b+d&&(b===e&&!g.modelChangedEvent&&!g.lineRemoved?(g.modelChangedEvent=a,g.lineChanged=!0):(g.lineRemoved=!0,
g.lineChanged=!1,g.modelChangedEvent=null)),e>b+d&&(g.lineIndex=e+c-d,g._line.lineIndex=g.lineIndex),g=this._getLineNext(g);this._lineHeight&&(a=[b,d].concat(Array(c)),Array.prototype.splice.apply(this._lineHeight,a));!this._wrapMode&&(b<=this._maxLineIndex&&this._maxLineIndex<=b+d)&&(this._checkMaxLineIndex=this._maxLineIndex,this._maxLineIndex=-1,this._maxLineWidth=0);this._update()},_onModelChanging:function(a){a.type="ModelChanging";this.onModelChanging(a);a.type="Changing"},_queueUpdate:function(){if(!this._updateTimer&&
!this._ignoreQueueUpdate){var a=this;this._updateTimer=this._getWindow().setTimeout(function(){a._updateTimer=null;a._update()},0)}},_resetLineHeight:function(a,b){if(this._wrapMode||this._variableLineHeight){if(void 0!==a&&void 0!==b)for(var g=a;g<b;g++)this._lineHeight[g]=void 0;else this._lineHeight=Array(this._model.getLineCount());this._calculateLineHeightTimer()}else this._lineHeight=null},_resetLineWidth:function(){var a=this._clientDiv;if(a)for(a=a.firstChild;a;)a.lineWidth=void 0,a=a.nextSibling},
_reset:function(){this._maxLineIndex=-1;this._maxLineWidth=0;this._columnX=-1;this._bottomChild=this._topChild=null;this._topIndexY=0;this._variableLineHeight=!1;this._resetLineHeight();this._setSelection(new q(0,0,!1),!1,!1);this._viewDiv&&(this._viewDiv.scrollLeft=0,this._viewDiv.scrollTop=0);var a=this._clientDiv;if(a){for(var b=a.firstChild;b;)b.lineRemoved=!0,b=b.nextSibling;e.isFirefox&&(this._ignoreFocus=!1,(b=this._hasFocus)&&a.blur(),a.contentEditable=!1,a.contentEditable=!0,b&&a.focus(),
this._ignoreFocus=!1)}},_scrollViewAnimated:function(a,b,g){var e=this._getWindow();if(g&&this._scrollAnimation){var c=this;this._animation=new u({window:e,duration:this._scrollAnimation,curve:[b,0],onAnimate:function(a){a=b-Math.floor(a);c._scrollView(0,a);b-=a},onEnd:function(){c._animation=null;c._scrollView(a,b);g&&e.setTimeout(g,0)}});this._animation.play()}else this._scrollView(a,b),g&&e.setTimeout(g,0)},_scrollView:function(a,b){this._ensureCaretVisible=!1;var g=this._viewDiv;a&&(g.scrollLeft+=
a);b&&(g.scrollTop+=b)},_setClipboardText:function(a,b){var c,d=this._getWindow(),l=d.clipboardData;!l&&b&&(l=b.clipboardData);if(l&&(c=[],g(a,function(a){c.push(a)},function(){c.push(e.platformDelimiter)}),l.setData(e.isIE?"Text":"text/plain",c.join(""))))return!0;var h=this._parent.ownerDocument,f=e.createElement(h,"pre");f.style.position="fixed";f.style.left="-1000px";g(a,function(a){f.appendChild(h.createTextNode(a))},function(){f.appendChild(e.createElement(h,"br"))});f.appendChild(h.createTextNode(" "));
this._clientDiv.appendChild(f);l=h.createRange();l.setStart(f.firstChild,0);l.setEndBefore(f.lastChild);var n=d.getSelection();0<n.rangeCount&&n.removeAllRanges();n.addRange(l);var j=this,l=function(){f&&f.parentNode===j._clientDiv&&j._clientDiv.removeChild(f);j._updateDOMSelection()},n=!1;this._ignoreCopy=!0;try{n=h.execCommand("copy",!1,null)}catch(q){}this._ignoreCopy=!1;if(!n&&b)return d.setTimeout(l,0),!1;l();return!0},_setDOMSelection:function(a,b,g,c,d){for(var l,h,f,n,j=0,q=a.firstChild,r,
i,k=this._model.getLine(a.lineIndex).length;q;){if(!q.ignore){r=q.firstChild;i=r.length;q.ignoreChars&&(i-=q.ignoreChars);if(j+i>b||j+i>=k){l=r;h=b-j;q.ignoreChars&&(0<i&&h===i)&&(h+=q.ignoreChars);break}j+=i}q=q.nextSibling}for(var j=0,q=g.firstChild,m=this._model.getLine(g.lineIndex).length;q;){if(!q.ignore){r=q.firstChild;i=r.length;q.ignoreChars&&(i-=q.ignoreChars);if(i+j>c||j+i>=m){f=r;n=c-j;q.ignoreChars&&(0<i&&n===i)&&(n+=q.ignoreChars);break}j+=i}q=q.nextSibling}this._setDOMFullSelection(a,
b,k,g,c,m);a=this._getWindow();b=this._parent.ownerDocument;if(a.getSelection){g=a.getSelection();a=b.createRange();a.setStart(l,h);a.setEnd(f,n);if(this._hasFocus&&(g.anchorNode!==l||g.anchorOffset!==h||g.focusNode!==f||g.focusOffset!==n||g.anchorNode!==f||g.anchorOffset!==n||g.focusNode!==l||g.focusOffset!==h))this._anchorNode=l,this._anchorOffset=h,this._focusNode=f,this._focusOffset=n,this._ignoreSelect=!1,0<g.rangeCount&&g.removeAllRanges(),g.addRange(a),this._ignoreSelect=!0;this._cursorDiv&&
(a=b.createRange(),d?(a.setStart(l,h),a.setEnd(l,h)):(a.setStart(f,n),a.setEnd(f,n)),f=a.getClientRects()[0],n=this._cursorDiv.parentNode,l=n.getBoundingClientRect(),f&&l&&(this._cursorDiv.style.top=f.top-l.top+n.scrollTop+"px",this._cursorDiv.style.left=f.left-l.left+n.scrollLeft+"px"))}else b.selection&&this._hasFocus&&(d=b.body,a=e.createElement(b,"div"),d.appendChild(a),d.removeChild(a),a=d.createTextRange(),a.moveToElementText(l.parentNode),a.moveStart("character",h),l=d.createTextRange(),l.moveToElementText(f.parentNode),
l.moveStart("character",n),a.setEndPoint("EndToStart",l),this._ignoreSelect=!1,a.select(),this._ignoreSelect=!0)},_setDOMFullSelection:function(a,b,g,e,c){if(this._selDiv1&&(g=this._selDiv1,g.style.width="0px",g.style.height="0px",g=this._selDiv2,g.style.width="0px",g.style.height="0px",g=this._selDiv3,g.style.width="0px",g.style.height="0px",!(a===e&&b===c))){var d=this._model,l=this._getViewPadding(),h=this._clientDiv.getBoundingClientRect(),f=this._viewDiv.getBoundingClientRect(),g=f.left+l.left,
n=h.right,l=f.top+l.top,j=h.bottom,f=h=0;this._clipDiv?(f=this._clipDiv.getBoundingClientRect(),h=f.left-this._clipDiv.scrollLeft):(f=this._rootDiv.getBoundingClientRect(),h=f.left);f=f.top;this._ignoreDOMSelection=!0;var q=(new w(this,a.lineIndex,a)).getBoundingClientRect(d.getLineStart(a.lineIndex)+b,!1),r=q.left,b=(new w(this,e.lineIndex,e)).getBoundingClientRect(d.getLineStart(e.lineIndex)+c,!1),d=b.left;this._ignoreDOMSelection=!1;var i=this._selDiv1,r=Math.min(n,Math.max(g,r)),k=Math.min(j,
Math.max(l,q.top)),m=n,c=Math.min(j,Math.max(l,q.bottom));i.style.left=r-h+"px";i.style.top=k-f+"px";i.style.width=Math.max(0,m-r)+"px";i.style.height=Math.max(0,c-k)+"px";a.lineIndex===e.lineIndex?(m=Math.min(d,n),i.style.width=Math.max(0,m-r)+"px"):(q=Math.min(j,Math.max(l,b.top)),d=Math.min(n,Math.max(g,d)),l=Math.min(j,Math.max(l,b.bottom)),j=this._selDiv3,j.style.left=g-h+"px",j.style.top=q-f+"px",j.style.width=Math.max(0,d-g)+"px",j.style.height=Math.max(0,l-q)+"px",1<Math.abs(a.lineIndex-e.lineIndex)&&
(a=this._selDiv2,a.style.left=g-h+"px",a.style.top=c-f+"px",a.style.width=Math.max(0,n-g)+"px",a.style.height=Math.max(0,q-c)+"px"))}},_setGrab:function(a){a!==this._grabControl&&(a?(a.setCapture&&a.setCapture(),this._grabControl=a):(this._grabControl.releaseCapture&&this._grabControl.releaseCapture(),this._grabControl=null))},_setLinksVisible:function(a){if(this._linksVisible!==a){this._linksVisible=a;e.isIE&&a&&(this._hadFocus=this._hasFocus);var b=this._clientDiv;b.contentEditable=!a;this._hadFocus&&
!a&&b.focus();this._overlayDiv&&(this._overlayDiv.style.zIndex=a?"-1":"1");for(a=this._getLineNext();a;){if(a.hasLink)for(b=a.firstChild;b;)if(b.ignore)b=b.nextSibling;else{var g=b.nextSibling,c=b.viewStyle;c&&(c.tagName&&"a"===c.tagName.toLowerCase())&&a.replaceChild(a._line._createSpan(a,b.firstChild.data,c),b);b=g}a=this._getLineNext(a)}this._updateDOMSelection()}},_setSelection:function(a,b,g,e,c){if(a){this._columnX=-1;void 0===g&&(g=!0);var d=this._selection;this._selection=a;!1!==b&&this._showCaret(!1,
e,b,c);g&&this._updateDOMSelection();if(!d.equals(a))this.onSelection({type:"Selection",oldValue:{start:d.start,end:d.end},newValue:{start:a.start,end:a.end}})}},_setSelectionTo:function(a,b,g,e){var c=this._model,d=this._getSelection(),b=this.convert({x:a,y:b},"page","document"),a=this._getLineIndex(b.y);if(1===this._clickCount){c=this._getLine(a);a=c.getOffset(b.x,b.y-this._getLinePixel(a));c.destroy();if(e&&!g&&d.start<=a&&a<d.end)return this._dragOffset=a,!1;d.extend(a);g||d.collapse()}else 0===
(this._clickCount&1)?(c=this._getLine(a),a=c.getOffset(b.x,b.y-this._getLinePixel(a)),this._doubleClickSelection?a>=this._doubleClickSelection.start?(g=this._doubleClickSelection.start,e=c.getNextOffset(a,{unit:"wordend",count:1})):(g=c.getNextOffset(a,{unit:"word",count:-1}),e=this._doubleClickSelection.end):(g=c.getNextOffset(a,{unit:"word",count:-1}),e=c.getNextOffset(g,{unit:"wordend",count:1})),c.destroy()):this._doubleClickSelection?(e=c.getLineAtOffset(this._doubleClickSelection.start),a>=
e?(g=c.getLineStart(e),e=c.getLineEnd(a)):(g=c.getLineStart(a),e=c.getLineEnd(e))):(g=c.getLineStart(a),e=c.getLineEnd(a)),d.setCaret(g),d.extend(e);this._setSelection(d,!0,!0);return!0},_setFullSelection:function(a,b){this._fullSelection=a;e.isWebkit&&(this._fullSelection=!0);var g=this._clipDiv||this._rootDiv;if(g)if(this._fullSelection){if(!this._selDiv1&&this._fullSelection&&!e.isIOS){var c=g.ownerDocument;this._highlightRGB=e.isWebkit?"transparent":"Highlight";var d=e.createElement(c,"div");
this._selDiv1=d;d.style.position="absolute";d.style.borderWidth="0px";d.style.margin="0px";d.style.padding="0px";d.style.outline="none";d.style.background=this._highlightRGB;d.style.width="0px";d.style.height="0px";d.style.zIndex="0";g.appendChild(d);var l=e.createElement(c,"div");this._selDiv2=l;l.style.position="absolute";l.style.borderWidth="0px";l.style.margin="0px";l.style.padding="0px";l.style.outline="none";l.style.background=this._highlightRGB;l.style.width="0px";l.style.height="0px";l.style.zIndex=
"0";g.appendChild(l);this._selDiv3=c=e.createElement(c,"div");c.style.position="absolute";c.style.borderWidth="0px";c.style.margin="0px";c.style.padding="0px";c.style.outline="none";c.style.background=this._highlightRGB;c.style.width="0px";c.style.height="0px";c.style.zIndex="0";g.appendChild(c);if(e.isFirefox&&e.isMac){g=this._getWindow().getComputedStyle(c,null).getPropertyValue("background-color");switch(g){case "rgb(119, 141, 168)":g="rgb(199, 208, 218)";break;case "rgb(127, 127, 127)":g="rgb(198, 198, 198)";
break;case "rgb(255, 193, 31)":g="rgb(250, 236, 115)";break;case "rgb(243, 70, 72)":g="rgb(255, 176, 139)";break;case "rgb(255, 138, 34)":g="rgb(255, 209, 129)";break;case "rgb(102, 197, 71)":g="rgb(194, 249, 144)";break;case "rgb(140, 78, 184)":g="rgb(232, 184, 255)";break;default:g="rgb(180, 213, 255)"}this._highlightRGB=g;d.style.background=g;l.style.background=g;c.style.background=g}b||this._updateDOMSelection()}}else this._selDiv1&&(g.removeChild(this._selDiv1),this._selDiv1=null),this._selDiv2&&
(g.removeChild(this._selDiv2),this._selDiv2=null),this._selDiv3&&(g.removeChild(this._selDiv3),this._selDiv3=null)},_setBlockCursor:function(a){this._blockCursorVisible=a;this._updateBlockCursorVisible()},_setOverwriteMode:function(a){this._overwriteMode=a;this._updateBlockCursorVisible()},_updateBlockCursorVisible:function(){if(this._blockCursorVisible||this._overwriteMode){if(!this._cursorDiv){var a=e.createElement(document,"div");a.className="textviewBlockCursor";this._cursorDiv=a;a.tabIndex=-1;
a.style.zIndex="2";a.style.color="transparent";a.style.position="absolute";a.style.pointerEvents="none";a.innerHTML="&nbsp;";this._viewDiv.appendChild(a);this._updateDOMSelection()}}else this._cursorDiv&&(this._cursorDiv.parentNode.removeChild(this._cursorDiv),this._cursorDiv=null)},_setMarginOffset:function(a,b){this._marginOffset=a;this._marginDiv.style.display=a?"block":"none";b||(this._metrics=this._calculateMetrics(),this._queueUpdate())},_setWrapOffset:function(a,b){this._wrapOffset=a;b||(this._metrics=
this._calculateMetrics(),this._queueUpdate())},_setReadOnly:function(a){this._readonly=a;this._clientDiv.setAttribute("aria-readonly",a?"true":"false")},_setSingleMode:function(a,b){this._singleMode=a;this._updateOverflow();this._updateStyle(b)},_setTabSize:function(a,b){this._tabSize=a;this._customTabSize=void 0;var g=this._clientDiv;e.isOpera?g&&(g.style.OTabSize=this._tabSize+""):537.1<=e.isWebkit?g&&(g.style.tabSize=this._tabSize+""):4<=e.isFirefox?g&&(g.style.MozTabSize=this._tabSize+""):8!==
this._tabSize&&(this._customTabSize=this._tabSize);b||(this.redrawLines(),this._resetLineWidth())},_setTheme:function(a){this._theme&&this._theme.removeEventListener("ThemeChanged",this._themeListener.onChanged);(this._theme=a)&&this._theme.addEventListener("ThemeChanged",this._themeListener.onChanged);this._setThemeClass(this._themeClass)},_setThemeClass:function(a,b){this._themeClass=a;var g="textview",c=this._theme.getThemeClass();c&&(g+=" "+c);this._themeClass&&c!==this._themeClass&&(g+=" "+this._themeClass);
this._rootDiv.className=g;this._updateStyle(b)},_setWrapMode:function(a,b){this._wrapMode=a&&this._wrappable;var g=this._clientDiv;this._wrapMode?(g.style.whiteSpace="pre-wrap",g.style.wordWrap="break-word"):(g.style.whiteSpace="pre",g.style.wordWrap="normal");this._updateOverflow();b||(this.redraw(),this._resetLineWidth());this._resetLineHeight()},_showCaret:function(a,b,g,c){if(this._clientDiv){var e=this._model,d=this._getSelection(),l=this._getScroll(),h=d.getCaret(),f=d.start,n=d.end,j=e.getLineAtOffset(n),
q=Math.max(Math.max(f,e.getLineStart(j)),n-1),e=this._getClientWidth(),j=this._getClientHeight(),r=e/4,i=this._getBoundsAtOffset(h===f?f:q),k=i.left,m=i.right,w=i.top,t=i.bottom;a&&!d.isEmpty()&&(i=this._getBoundsAtOffset(h===n?f:q),i.top===w?h===f?m=k+Math.min(i.right-k,e):k=m-Math.min(m-i.left,e):h===f?t=w+Math.min(i.bottom-w,j):w=t-Math.min(t-i.top,j));a=0;k<l.x&&(a=Math.min(k-l.x,-r));m>l.x+e&&(a=Math.max(m-l.x-e,r));d=0;w<l.y?d=w-l.y:t>l.y+j&&(d=t-l.y-j);c&&(0<c?0<d&&(d=Math.max(d,c)):0>d&&(d=
Math.min(d,c)));if(0!==a||0!==d)return 0!==d&&"number"===typeof g&&(0>g&&(g=0),1<g&&(g=1),d+=Math.floor(0<d?g*j:-g*j)),this._scrollViewAnimated(a,d,b),j!==this._getClientHeight()||e!==this._getClientWidth()?this._showCaret():this._ensureCaretVisible=!0,!0;b&&b();return!1}},_startIME:function(){if(-1===this._imeOffset){var a=this._getSelection();a.isEmpty()||this._modifyContent({text:"",start:a.start,end:a.end},!0);this._imeOffset=a.start}},_unhookEvents:function(){this._model.removeEventListener("preChanging",
this._modelListener.onChanging);this._model.removeEventListener("postChanged",this._modelListener.onChanged);this._theme.removeEventListener("ThemeChanged",this._themeListener.onChanged);this._modelListener=null;for(var a=0;a<this._handlers.length;a++){var b=this._handlers[a];y(b.target,b.type,b.handler)}this._handlers=null;this._mutationObserver&&(this._mutationObserver.disconnect(),this._mutationObserver=null)},_updateDOMSelection:function(){if(!(0<this._redrawCount)&&!this._ignoreDOMSelection&&
this._clientDiv){var a=this._getSelection(),b=this._model,g=b.getLineAtOffset(a.start),c=b.getLineAtOffset(a.end),e=this._getLineNext();if(e){var d=this._getLinePrevious(),l;g<e.lineIndex?(l=e,g=0):g>d.lineIndex?(l=d,g=0):(l=this._getLineNode(g),g=a.start-b.getLineStart(g));c<e.lineIndex?b=0:c>d.lineIndex?(e=d,b=0):(e=this._getLineNode(c),b=a.end-b.getLineStart(c));this._setDOMSelection(l,g,e,b,a.caret)}}},_update:function(a){if(!(0<this._redrawCount)){this._updateTimer&&(this._getWindow().clearTimeout(this._updateTimer),
this._updateTimer=null,a=!1);var b=this._clientDiv,g=this._viewDiv;if(b){this._metrics.invalid&&(this._ignoreQueueUpdate=!0,this._updateStyle(),this._ignoreQueueUpdate=!1);var c=this._model,d=this._getScroll(!1),l=this._getViewPadding(),h=c.getLineCount(),f=this._getLineHeight(),n=!1,j=!1,q=!1,r=this._metrics.scrollWidth;this._wrapMode&&(b.style.width=(this._metrics.wrapWidth||this._getClientWidth())+"px");var i,k,m,t,x=0,y=0,u;if(this._lineHeight){for(;y<h;){u=this._getLineHeight(y);if(x+u>d.y)break;
x+=u;y++}i=y;k=Math.max(0,i-1);m=c=d.y-x;0<i&&(c+=this._getLineHeight(i-1))}else t=Math.max(0,d.y)/f,i=Math.floor(t),k=Math.max(0,i-1),c=Math.round((t-k)*f),m=Math.round((t-i)*f);this._topIndexY=m;t=this._rootDiv;var I=t.clientWidth,D=t.clientHeight;if(a){f=0;this._leftDiv&&(i=this._leftDiv.getBoundingClientRect(),f=i.right-i.left);i=this._getClientWidth();t=this._getClientHeight();j=i;this._wrapMode?this._metrics.wrapWidth&&(j=this._metrics.wrapWidth):j=Math.max(this._maxLineWidth,j);for(;y<h;)u=
this._getLineHeight(y,!1),x+=u,y++;h=x}else{t=this._getClientHeight();m=Math.min(i+Math.floor((t+m)/f),h-1);var d=Math.min(m+1,h-1),C;for(u=b.firstChild;u;){C=u.lineIndex;var B=u.nextSibling;if(!(k<=C&&C<=d)||u.lineRemoved||-1===u.lineIndex)this._mouseWheelLine===u?(u.style.display="none",u.lineIndex=-1):b.removeChild(u);u=B}u=this._getLineNext();var B=g.ownerDocument,E=B.createDocumentFragment();for(C=k;C<=d;C++)!u||u.lineIndex>C?(new w(this,C)).create(E,null):(E.firstChild&&(b.insertBefore(E,u),
E=B.createDocumentFragment()),u&&u.lineChanged&&(u=(new w(this,C)).create(E,u),u.lineChanged=!1),u=this._getLineNext(u));E.firstChild&&b.insertBefore(E,u);e.isWebkit&&!this._wrapMode&&(b.style.width="0x7fffffffpx");u=this._getLineNext();C=t+c;for(E=!1;u;)k=u.lineWidth,void 0===k&&(B=u._line.getBoundingClientRect(),k=u.lineWidth=Math.ceil(B.right-B.left),B=B.bottom-B.top,this._lineHeight?this._lineHeight[u.lineIndex]=B:0!==f&&(0!==B&&Math.ceil(f)!==Math.ceil(B))&&(this._variableLineHeight=!0,this._lineHeight=
[],this._lineHeight[u.lineIndex]=B)),this._lineHeight&&!E&&(C-=this._lineHeight[u.lineIndex],0>C&&(m=u.lineIndex,E=!0)),this._wrapMode||(k>=this._maxLineWidth&&(this._maxLineWidth=k,this._maxLineIndex=u.lineIndex),this._checkMaxLineIndex===u.lineIndex&&(this._checkMaxLineIndex=-1)),u.lineIndex===i&&(this._topChild=u),u.lineIndex===m&&(this._bottomChild=u),u=this._getLineNext(u);-1!==this._checkMaxLineIndex&&(C=this._checkMaxLineIndex,this._checkMaxLineIndex=-1,0<=C&&C<h&&(f=new w(this,C),B=f.getBoundingClientRect(),
k=B.right-B.left,k>=this._maxLineWidth&&(this._maxLineWidth=k,this._maxLineIndex=C),f.destroy()));for(;y<h;)u=this._getLineHeight(y,y<=m),x+=u,y++;h=x;this._updateRuler(this._leftDiv,i,d,D);this._updateRuler(this._rightDiv,i,d,D);this._updateRuler(this._marginDiv,i,d,D);f=0;this._leftDiv&&(i=this._leftDiv.getBoundingClientRect(),f=i.right-i.left);d=0;this._rightDiv&&(d=this._rightDiv.getBoundingClientRect(),d=d.right-d.left);g.style.left=f+"px";g.style.right=d+"px";d=this._scrollDiv;d.style.height=
h+"px";i=this._getClientWidth();!this._singleMode&&!this._wrapMode&&(x=n=t,(y="scroll"===g.style.overflowX)?n+=r:x-=r,u=m=i,(k="scroll"===g.style.overflowY)?m+=r:u-=r,t=n,i=m,h>t&&(q=!0,i=u),this._maxLineWidth>i&&(j=!0,t=x,h>t&&(q=!0,i=u)),y!==j&&(g.style.overflowX=j?"scroll":"hidden"),k!==q&&(g.style.overflowY=q?"scroll":"hidden"),n=y!==j||k!==q);q=i;this._wrapMode?this._metrics.wrapWidth&&(q=this._metrics.wrapWidth):q=Math.max(this._maxLineWidth,q);j=q;if((!e.isIE||9<=e.isIE)&&this._maxLineWidth>
i)q+=l.right+l.left;d.style.width=q+"px";this._clipScrollDiv&&(this._clipScrollDiv.style.width=q+"px");d=this._getScroll(!1)}this._vScrollDiv&&(q=t-8,x=Math.max(15,Math.ceil(Math.min(1,q/(h+l.top+l.bottom))*q)),this._vScrollDiv.style.left=f+i-8+"px",this._vScrollDiv.style.top=Math.floor(Math.max(0,d.y*q/h))+"px",this._vScrollDiv.style.height=x+"px");!this._wrapMode&&this._hScrollDiv&&(q=i-8,x=Math.max(15,Math.ceil(Math.min(1,q/(this._maxLineWidth+l.left+l.right))*q)),this._hScrollDiv.style.left=f+
Math.floor(Math.max(0,Math.floor(d.x*q/this._maxLineWidth)))+"px",this._hScrollDiv.style.top=t-9+"px",this._hScrollDiv.style.width=x+"px");y=d.x;x=this._clipDiv;q=this._overlayDiv;if(m=this._marginDiv)m.style.left=-y+f+this._metrics.marginWidth+l.left+"px",m.style.bottom=("scroll"===g.style.overflowX?r:0)+"px";x?(x.scrollLeft=y,x.scrollTop=0,g=f+l.left,r=l.top,a=i,f=t,y=0,m=-c,0===d.x&&(g-=l.left,a+=l.left,y=l.left),d.x+i===j&&(a+=l.right),0===d.y&&(r-=l.top,f+=l.top,m+=l.top),d.y+t===h&&(f+=l.bottom),
x.style.left=g+"px",x.style.top=r+"px",x.style.right=I-a-g+"px",x.style.bottom=D-f-r+"px",b.style.left=y+"px",b.style.top=m+"px",b.style.width=j+"px",b.style.height=t+c+"px",q&&(q.style.left=b.style.left,q.style.top=b.style.top,q.style.width=b.style.width,q.style.height=b.style.height)):(g=y,r=c,I=y+i,D=c+t,0===g&&(g-=l.left),0===r&&(r-=l.top),I===j&&(I+=l.right),d.y+t===h&&(D+=l.bottom),b.style.clip="rect("+r+"px,"+I+"px,"+D+"px,"+g+"px)",b.style.left=-y+f+l.left+"px",b.style.width=(this._wrapMode||
e.isWebkit?j:i+y)+"px",a||(b.style.top=-c+l.top+"px",b.style.height=t+c+"px"),q&&(q.style.clip=b.style.clip,q.style.left=b.style.left,q.style.width=b.style.width,a||(q.style.top=b.style.top,q.style.height=b.style.height)));this._updateDOMSelection();n&&(b=this._ensureCaretVisible,this._ensureCaretVisible=!1,b&&this._showCaret(),this._queueUpdate())}}},_updateOverflow:function(){var a=this._viewDiv;this._wrapMode?(a.style.overflowX="hidden",a.style.overflowY="scroll"):a.style.overflow="hidden"},_updateRuler:function(a,
b,g,c){if(a)for(var d=this._parent.ownerDocument,l=this._getLineHeight(),f=this._getViewPadding(),a=a.firstChild;a;){var n=a._ruler,j=l,q=n.getOverview();"page"===q&&(j+=this._topIndexY);a.style.top=-j+"px";a.style.height=c+j+"px";a.rulerChanged&&h(n.getRulerStyle(),a);var r,i=a.firstChild;i?(r=i,i=i.nextSibling):(r=e.createElement(d,"div"),r.style.visibility="hidden",a.appendChild(r));var k;if(a.rulerChanged&&r){j=-1;if(k=n.getWidestAnnotation())h(k.style,r),k.html&&(r.innerHTML=k.html);r.lineIndex=
j;r.style.height=l+f.top+"px"}var m;if("page"===q){for(n=n.getAnnotations(b,g+1);i;)j=i.lineIndex,k=i.nextSibling,(!(b<=j&&j<=g)||i.lineChanged)&&a.removeChild(i),i=k;i=a.firstChild.nextSibling;m=d.createDocumentFragment();for(j=b;j<=g;j++)if(!i||i.lineIndex>j){r=e.createElement(d,"div");if(k=n[j])h(k.style,r),k.html&&(r.innerHTML=k.html),r.annotation=k;r.lineIndex=j;r.style.height=this._getLineHeight(j)+"px";m.appendChild(r)}else m.firstChild&&(a.insertBefore(m,i),m=d.createDocumentFragment()),i&&
(i=i.nextSibling);m.firstChild&&a.insertBefore(m,i)}else{k=this._getClientHeight();j=this._model.getLineCount();i=k+f.top+f.bottom-2*this._metrics.scrollWidth;q=l*j<i?l:i/j;if(a.rulerChanged){for(k=a.childNodes.length;1<k;)a.removeChild(a.lastChild),k--;n=n.getAnnotations(0,j);m=d.createDocumentFragment();for(var t in n)j=t>>>0,0>j||(r=e.createElement(d,"div"),k=n[t],h(k.style,r),r.style.position="absolute",r.style.top=this._metrics.scrollWidth+l+Math.floor(j*q)+"px",k.html&&(r.innerHTML=k.html),
r.annotation=k,r.lineIndex=j,m.appendChild(r));a.appendChild(m)}else if(a._oldTrackHeight!==i)for(r=a.firstChild?a.firstChild.nextSibling:null;r;)r.style.top=this._metrics.scrollWidth+l+Math.floor(r.lineIndex*q)+"px",r=r.nextSibling;a._oldTrackHeight=i}a.rulerChanged=!1;a=a.nextSibling}},_updateStyleSheet:function(){var a="";e.isWebkit&&0<this._metrics.scrollWidth&&(a+="\n.textview ::-webkit-scrollbar-corner {background: #eeeeee;}");e.isFirefox&&(e.isMac&&this._highlightRGB&&"Highlight"!==this._highlightRGB)&&
(a+="\n.textview ::-moz-selection {background: "+this._highlightRGB+";}");if(a){var b=document.getElementById("_textviewStyle");if(b)b.removeChild(b.firstChild),b.appendChild(document.createTextNode(a));else{b=e.createElement(document,"style");b.id="_textviewStyle";var g=document.getElementsByTagName("head")[0]||document.documentElement;b.appendChild(document.createTextNode(a));g.insertBefore(b,g.firstChild)}}},_updateStyle:function(a){!a&&e.isIE&&(this._rootDiv.style.lineHeight="normal");var b=this._metrics=
this._calculateMetrics();this._rootDiv.style.lineHeight=e.isIE?b.lineHeight-(b.lineTrim.top+b.lineTrim.bottom)+"px":"normal";this._updateStyleSheet();a||(this.redraw(),this._resetLineWidth())}};d.EventTarget.addMixin(t.prototype);return{TextView:t}});
define("orion/editor/projectionTextModel",["orion/editor/textModel","orion/editor/eventTarget"],function(k,m){function i(d){this._model=d;this._projections=[];var c=this;this._listener={onChanged:function(d){c._onChanged(d)},onChanging:function(d){c._onChanging(d)}};d.addEventListener("postChanged",this._listener.onChanged);d.addEventListener("preChanging",this._listener.onChanging)}i.prototype={destroy:function(){this._model&&(this._model.removeEventListener("postChanged",this._listener.onChanged),
this._model.removeEventListener("preChanging",this._listener.onChanging),this._model=null)},addProjection:function(d){if(d){var c=this._model,f=this._projections;d._lineIndex=c.getLineAtOffset(d.start);d._lineCount=c.getLineAtOffset(d.end)-d._lineIndex;var e=d.text;e||(e="");d._model="string"===typeof e?new k.TextModel(e,c.getLineDelimiter()):e;var c=this.mapOffset(d.start,!0),e=d.end-d.start,h=d._lineCount,j=d._model.getCharCount(),b=d._model.getLineCount()-1,a={type:"Changing",text:d._model.getText(),
start:c,removedCharCount:e,addedCharCount:j,removedLineCount:h,addedLineCount:b};this.onChanging(a);a=this._binarySearch(f,d.start);f.splice(a,0,d);this.onChanged({type:"Changed",start:c,removedCharCount:e,addedCharCount:j,removedLineCount:h,addedLineCount:b})}},getProjections:function(){return this._projections.slice(0)},getBaseModel:function(){return this._model},mapOffset:function(d,c){var f=this._projections,e=0,h,j;if(c){for(h=0;h<f.length;h++){j=f[h];if(j.start>d)break;if(j.end>d)return-1;e+=
j._model.getCharCount()-(j.end-j.start)}return d+e}for(h=0;h<f.length;h++){j=f[h];if(j.start>d-e)break;var b=j._model.getCharCount();if(j.start+b>d-e)return-1;e+=b-(j.end-j.start)}return d-e},removeProjection:function(d){var c,f=0;for(c=0;c<this._projections.length;c++){var e=this._projections[c];if(e===d){d=e;break}f+=e._model.getCharCount()-(e.end-e.start)}if(c<this._projections.length){var e=this._model,f=d.start+f,h=d.end-d.start,j=d._lineCount,b=d._model.getCharCount(),a=d._model.getLineCount()-
1,d={type:"Changing",text:e.getText(d.start,d.end),start:f,removedCharCount:b,addedCharCount:h,removedLineCount:a,addedLineCount:j};this.onChanging(d);this._projections.splice(c,1);this.onChanged({type:"Changed",start:f,removedCharCount:b,addedCharCount:h,removedLineCount:a,addedLineCount:j})}},_binarySearch:function(d,c){for(var f=d.length,e=-1,h;1<f-e;)h=Math.floor((f+e)/2),c<=d[h].start?f=h:e=h;return f},getCharCount:function(){for(var d=this._model.getCharCount(),c=this._projections,f=0;f<c.length;f++)var e=
c[f],d=d+(e._model.getCharCount()-(e.end-e.start));return d},getLine:function(d,c){if(0>d)return null;var f=this._model,e=this._projections,h=0,j=[],b=0,a,g,l;for(a=0;a<e.length;a++){l=e[a];if(l._lineIndex>=d-h)break;g=l._model.getLineCount()-1;if(l._lineIndex+g>=d-h){b=d-(l._lineIndex+h);if(b<g)return l._model.getLine(b,c);j.push(l._model.getLine(g))}b=l.end;h+=g-l._lineCount}for(b=Math.max(b,f.getLineStart(d-h));a<e.length;a++){l=e[a];if(l._lineIndex>d-h)break;j.push(f.getText(b,l.start));g=l._model.getLineCount()-
1;if(l._lineIndex+g>d-h)return j.push(l._model.getLine(0,c)),j.join("");j.push(l._model.getText());b=l.end;h+=g-l._lineCount}e=f.getLineEnd(d-h,c);b<e&&j.push(f.getText(b,e));return j.join("")},getLineAtOffset:function(d){for(var c=this._model,f=this._projections,e=0,h=0,j=0;j<f.length;j++){var b=f[j];if(b.start>d-e)break;var a=b._model.getCharCount();if(b.start+a>d-e){f=d-(b.start+e);h+=b._model.getLineAtOffset(f);e+=f;break}h+=b._model.getLineCount()-1-b._lineCount;e+=a-(b.end-b.start)}return c.getLineAtOffset(d-
e)+h},getLineCount:function(){for(var d=this._projections,c=this._model.getLineCount(),f=0;f<d.length;f++)var e=d[f],c=c+(e._model.getLineCount()-1-e._lineCount);return c},getLineDelimiter:function(){return this._model.getLineDelimiter()},getLineEnd:function(d,c){if(0>d)return-1;for(var f=this._model,e=this._projections,h=0,j=0,b=0;b<e.length;b++){var a=e[b];if(a._lineIndex>d-h)break;var g=a._model.getLineCount()-1;if(a._lineIndex+g>d-h)return a._model.getLineEnd(d-(a._lineIndex+h),c)+a.start+j;j+=
a._model.getCharCount()-(a.end-a.start);h+=g-a._lineCount}return f.getLineEnd(d-h,c)+j},getLineStart:function(d){if(0>d)return-1;for(var c=this._model,f=this._projections,e=0,h=0,j=0;j<f.length;j++){var b=f[j];if(b._lineIndex>=d-e)break;var a=b._model.getLineCount()-1;if(b._lineIndex+a>=d-e)return b._model.getLineStart(d-(b._lineIndex+e))+b.start+h;h+=b._model.getCharCount()-(b.end-b.start);e+=a-b._lineCount}return c.getLineStart(d-e)+h},getText:function(d,c){void 0===d&&(d=0);var f=this._model,e=
this._projections,h=0,j=[],b,a,g;for(b=0;b<e.length;b++){a=e[b];if(a.start>d-h)break;g=a._model.getCharCount();if(a.start+g>d-h){if(void 0!==c&&a.start+g>c-h)return a._model.getText(d-(a.start+h),c-(a.start+h));j.push(a._model.getText(d-(a.start+h)));d=a.end+h+g-(a.end-a.start)}h+=g-(a.end-a.start)}var l=d-h;if(void 0!==c){for(;b<e.length;b++){a=e[b];if(a.start>c-h)break;j.push(f.getText(l,a.start));g=a._model.getCharCount();if(a.start+g>c-h)return j.push(a._model.getText(0,c-(a.start+h))),j.join("");
j.push(a._model.getText());l=a.end;h+=g-(a.end-a.start)}j.push(f.getText(l,c-h))}else{for(;b<e.length;b++)a=e[b],j.push(f.getText(l,a.start)),j.push(a._model.getText()),l=a.end;j.push(f.getText(l))}return j.join("")},_onChanged:function(){var d=this._change,c=d.baseStart,f=d.baseEnd,e,h,j=this._projections;for(e=0;e<j.length&&!(h=j[e],h.end>c);e++);var b=e;for(e=0;e<j.length&&!(h=j[e],h.start>=f);e++);var a=e,g=this._model,c=d.baseText.length-(f-c);for(e=a;e<j.length;e++)h=j[e],h.start+=c,h.end+=
c,h._lineIndex=g.getLineAtOffset(h.start);h=j.splice(b,a-b);for(e=0;e<h.length;e++)h[e].annotation&&h[e].annotation._expand();this.onChanged({type:"Changed",start:d.start,removedCharCount:d.removedCharCount,addedCharCount:d.addedCharCount,removedLineCount:d.removedLineCount,addedLineCount:d.addedLineCount});this._change=void 0},_onChanging:function(d){var c=!!this._change,f=this._change||{},e=d.start,h=e+d.removedCharCount;f.baseStart=e;f.baseEnd=h;f.baseText=d.text;f.addedLineCount=d.addedLineCount;
if(!c){this._change=f;f.text=d.text;var j=this._projections,b,a,g,d=function(c){for(b=a=0;a<j.length;a++){g=j[a];if(g.start>c)break;if(g.end>c)return-1;b+=g._model.getCharCount()-(g.end-g.start)}return c+b};f.start=d(e);-1===f.start&&(f.text=this._model.getText(g.start,e)+f.text,f.addedLineCount+=this._model.getLineAtOffset(e)-this._model.getLineAtOffset(g.start),f.start=g.start+b);f.end=d(h);-1===f.end&&(f.text+=this._model.getText(h,g.end),f.addedLineCount+=this._model.getLineAtOffset(g.end)-this._model.getLineAtOffset(h),
f.end=g.start+b)}f.addedCharCount=f.text.length;f.removedCharCount=f.end-f.start;f.removedLineCount=this.getLineAtOffset(f.end)-this.getLineAtOffset(f.start);this.onChanging({type:"Changing",text:f.text,start:f.start,removedCharCount:f.removedCharCount,addedCharCount:f.addedCharCount,removedLineCount:f.removedLineCount,addedLineCount:f.addedLineCount})},onChanging:function(d){return this.dispatchEvent(d)},onChanged:function(d){return this.dispatchEvent(d)},setLineDelimiter:function(d){this._model.setLineDelimiter(d)},
setText:function(d,c,f){function e(g){for(j=b=0;b<h.length;b++){a=h[b];if(a.start>g-j)break;var c=a._model.getCharCount();if(a.start+c>g-j)return-1;j+=c-(a.end-a.start)}return g-j}this._change={text:d||"",start:c||0,end:void 0===f?this.getCharCount():f};var h=this._projections,j,b,a,g,l,d=e(this._change.start);-1===d&&(g={projection:a,start:this._change.start-(a.start+j)},d=a.end);c=e(this._change.end);-1===c&&(l={projection:a,end:this._change.end-(a.start+j)},c=a.start);g&&l&&g.projection===l.projection?
a._model.setText(this._change.text,g.start,l.end):(this._model.setText(this._change.text,d,c),g&&(a=g.projection,a._model.setText("",g.start)),l&&(a=l.projection,a._model.setText("",0,l.end),a.start=a.end,a._lineCount=0));this._change=void 0}};m.EventTarget.addMixin(i.prototype);return{ProjectionTextModel:i}});
define("orion/editor/tooltip","i18n!orion/editor/nls/messages orion/editor/textView orion/editor/textModel orion/editor/projectionTextModel orion/editor/util orion/util".split(" "),function(k,m,i,d,c,f){function e(c){this._view=c;this._fadeDelay=500;this._hideDelay=200;this._showDelay=500;this._autoHideDelay=5E3;this._create(c.getOptions("parent").ownerDocument)}e.getTooltip=function(c){c._tooltip||(c._tooltip=new e(c));return c._tooltip};e.prototype={_create:function(e){if(!this._tooltipDiv){var d=
this._tooltipDiv=f.createElement(e,"div");d.tabIndex=0;d.className="textviewTooltip";d.setAttribute("aria-live","assertive");d.setAttribute("aria-atomic","true");var b=this._tooltipContents=f.createElement(e,"div");d.appendChild(b);e.body.appendChild(d);var a=this;c.addEventListener(d,"mouseover",function(){if(a._hideDelay){var b=a._getWindow();a._delayedHideTimeout&&(b.clearTimeout(a._delayedHideTimeout),a._delayedHideTimeout=null);a._hideTimeout&&(b.clearTimeout(a._hideTimeout),a._hideTimeout=null);
a._nextTarget=null}},!1);c.addEventListener(d,"mouseout",function(b){b=b.relatedTarget||b.toElement;!(b===d||a._hasFocus())&&(!b||!c.contains(d,b))&&a._hide()},!1);c.addEventListener(d,"keydown",function(b){27===b.keyCode&&a._hide()},!1);c.addEventListener(e,"mousedown",this._mouseDownHandler=function(b){a.isVisible()&&(c.contains(d,b.target||b.srcElement)||a._hide())},!0);this._view.addEventListener("Destroy",function(){a.destroy()});this._hide()}},_getWindow:function(){var c=this._tooltipDiv.ownerDocument;
return c.defaultView||c.parentWindow},destroy:function(){if(this._tooltipDiv){this._hide();var e=this._tooltipDiv.parentNode;e&&e.removeChild(this._tooltipDiv);c.removeEventListener(this._tooltipDiv.ownerDocument,"mousedown",this._mouseDownHandler,!0);this._tooltipDiv=null}},_hasFocus:function(){var e=this._tooltipDiv;return!e?!1:c.contains(e,e.ownerDocument.activeElement)},hide:function(c){void 0===c&&(c=this._hideDelay);var e=this._getWindow();this._delayedHideTimeout&&(e.clearTimeout(this._delayedHideTimeout),
this._delayedHideTimeout=null);var b=this;c?b._delayedHideTimeout=e.setTimeout(function(){b._delayedHideTimeout=null;b._hide();b.setTarget(b._nextTarget,0)},c):(b._hide(),b.setTarget(b._nextTarget,0))},_hide:function(){var c=this._tooltipDiv;c&&(this._hasFocus()&&this._view.focus(),this._contentsView&&(this._contentsView.destroy(),this._contentsView=null),this._tooltipContents&&(this._tooltipContents.innerHTML=""),c.style.visibility="hidden",c=this._getWindow(),this._showTimeout&&(c.clearTimeout(this._showTimeout),
this._showTimeout=null),this._delayedHideTimeout&&(c.clearTimeout(this._delayedHideTimeout),this._delayedHideTimeout=null),this._hideTimeout&&(c.clearTimeout(this._hideTimeout),this._hideTimeout=null),this._fadeTimeout&&(c.clearInterval(this._fadeTimeout),this._fadeTimeout=null))},isVisible:function(){return this._tooltipDiv&&"visible"===this._tooltipDiv.style.visibility},setTarget:function(c,e,b){if(this.isVisible())this._hasFocus()||(this._nextTarget=c,this.hide(b));else if(this._target=c){var a=
this,c=a._getWindow();a._showTimeout&&(c.clearTimeout(a._showTimeout),a._showTimeout=null);0===e?a.show(!0):a._showTimeout=c.setTimeout(function(){a._showTimeout=null;a.show(!0)},e?e:a._showDelay)}},show:function(c){if(this._target){var e=this._target.getTooltipInfo();if(e){var b=this._tooltipDiv,a=this._tooltipContents;b.style.left=b.style.right=b.style.width=b.style.height=a.style.width=a.style.height="auto";var g=e.contents;g instanceof Array&&(g=this._getAnnotationContents(g));if("string"===typeof g)a.innerHTML=
g;else if(this._isNode(g))a.appendChild(g);else if(g instanceof d.ProjectionTextModel){var l=this._view,f=l.getOptions();f.wrapMode=!1;f.parent=a;var q=f.themeClass;q?((q=q.replace("tooltipTheme",""))&&(q=" "+q),q="tooltipTheme"+q):q="tooltipTheme";f.themeClass=q;f=this._contentsView=new m.TextView(f);f.addEventListener("LineStyle",function(a){l.onLineStyle(a)});f.setModel(g);g=f.computeSize();a.style.width=g.width+"px";a.style.height=g.height+"px";f.resize()}else return;a=b.ownerDocument.documentElement;
"right"===e.anchor?(g=a.clientWidth-e.x,b.style.right=g+"px"):(g=parseInt(this._getNodeStyle(b,"padding-left","0"),10),g+=parseInt(this._getNodeStyle(b,"border-left-width","0"),10),g=e.x-g,b.style.left=g+"px");b.style.maxWidth=a.clientWidth-g-10+"px";g=parseInt(this._getNodeStyle(b,"padding-top","0"),10);g+=parseInt(this._getNodeStyle(b,"border-top-width","0"),10);g=e.y-g;b.style.top=g+"px";b.style.maxHeight=a.clientHeight-g-10+"px";b.style.opacity="1";b.style.visibility="visible";if(c){var r=this,
i=this._getWindow();r._hideTimeout=i.setTimeout(function(){r._hideTimeout=null;var a=parseFloat(r._getNodeStyle(b,"opacity","1"));r._fadeTimeout=i.setInterval(function(){"visible"===b.style.visibility&&0<a?(a-=0.1,b.style.opacity=a):r._hide()},r._fadeDelay/10)},r._autoHideDelay)}}}},_getAnnotationContents:function(e){function j(a){var b=a.title,g=f.createElement(n,"div");g.className="tooltipRow";a.html&&(g.innerHTML=a.html,g.lastChild&&c.addEventListener(g.lastChild,"click",function(){var b=a.start,
g=a.end;r.getBaseModel&&(b=r.mapOffset(b,!0),g=r.mapOffset(g,!0));q.setSelection(b,g,1/3,function(){l._hide()})},!1),g.appendChild(n.createTextNode("\u00a0")));if(!b)var e=a.end,b=i.getLineStart(i.getLineAtOffset(a.start)),e=i.getLineEnd(i.getLineAtOffset(e),!0),b=i.getText(b,e);"function"===typeof b&&(b=a.title());"string"===typeof b&&(e=f.createElement(n,"span"),e.appendChild(n.createTextNode(b)),b=e);g.appendChild(b);return g}for(var b,a=[],g=0;g<e.length;g++)b=e[g],""!==b.title&&!b.groupAnnotation&&
a.push(b);e=a;if(0===e.length)return null;var l=this,n=this._tooltipDiv.ownerDocument,q=this._view,r=q.getModel(),i=r.getBaseModel?r.getBaseModel():r;if(1===e.length){b=e[0];if(void 0!==b.title)return b=j(b),b.firstChild&&((e=b.firstChild.className)&&(e+=" "),b.firstChild.className=e+"single"),b;e=new d.ProjectionTextModel(i);a=i.getLineStart(i.getLineAtOffset(b.start));g=i.getCharCount();b.end!==g&&e.addProjection({start:b.end,end:g});0<a&&e.addProjection({start:0,end:a});return e}a=f.createElement(n,
"div");b=f.createElement(n,"em");b.appendChild(n.createTextNode(k.multipleAnnotations));a.appendChild(b);for(g=0;g<e.length;g++)b=e[g],(b=j(b))&&a.appendChild(b);return a},_getNodeStyle:function(c,e,b){var a;if(c&&(a=c.style[e],!a))if(c.currentStyle){for(a=0;-1!==(a=e.indexOf("-",a));)e=e.substring(0,a)+e.substring(a+1,a+2).toUpperCase()+e.substring(a+2);a=c.currentStyle[e]}else a=(c=c.ownerDocument.defaultView.getComputedStyle(c,null))?c.getPropertyValue(e):null;return a||b},_isNode:function(c){return"object"===
typeof Node?c instanceof Node:c&&"object"===typeof c&&"number"===typeof c.nodeType&&"string"===typeof c.nodeName}};return{Tooltip:e}});
define("orion/editor/annotations",["i18n!orion/editor/nls/messages","orion/editor/eventTarget"],function(k,m){function i(b,a,g){this.start=b;this.end=a;this._projectionModel=g;this.html=this._expandedHTML;this.style=this._expandedStyle;this.expanded=!0}function d(){}function c(b,a){var g=b.lastIndexOf("."),g=b.substring(g+1),c={title:k[g],style:{styleClass:"annotation "+g},html:"<div class='annotationHTML "+g+"'></div>",overviewStyle:{styleClass:"annotationOverview "+g}};a?c.lineStyle={styleClass:"annotationLine "+
g}:c.rangeStyle={styleClass:"annotationRange "+g};d.registerType(b,c)}function f(){}function e(b){this._annotations=[];var a=this;this._listener={onChanged:function(b){a._onChanged(b)}};this.setTextModel(b)}function h(b,a){this._view=b;this._annotationModel=a;var g=this;this._listener={onDestroy:function(a){g._onDestroy(a)},onLineStyle:function(a){g._onLineStyle(a)},onChanged:function(a){g._onAnnotationModelChanged(a)}};b.addEventListener("Destroy",this._listener.onDestroy);b.addEventListener("postLineStyle",
this._listener.onLineStyle);a.addEventListener("Changed",this._listener.onChanged)}i.prototype={_expandedHTML:"<div class='annotationHTML expanded'></div>",_expandedStyle:{styleClass:"annotation expanded"},_collapsedHTML:"<div class='annotationHTML collapsed'></div>",_collapsedStyle:{styleClass:"annotation collapsed"},_collapse:function(){if(!this.expanded)return!1;this.expanded=!1;this.html=this._collapsedHTML;this.style=this._collapsedStyle;this._annotationModel&&this._annotationModel.modifyAnnotation(this);
return!0},_expand:function(){if(this.expanded)return!1;this.expanded=!0;this.html=this._expandedHTML;this.style=this._expandedStyle;this._annotationModel&&this._annotationModel.modifyAnnotation(this);return!0},collapse:function(){if(this._collapse()){var b=this._projectionModel,a=b.getBaseModel();this._projection={annotation:this,start:a.getLineStart(a.getLineAtOffset(this.start)+1),end:a.getLineEnd(a.getLineAtOffset(this.end),!0)};b.addProjection(this._projection)}},expand:function(){this._expand()&&
this._projectionModel.removeProjection(this._projection)}};d.ANNOTATION_ERROR="orion.annotation.error";d.ANNOTATION_WARNING="orion.annotation.warning";d.ANNOTATION_TASK="orion.annotation.task";d.ANNOTATION_BREAKPOINT="orion.annotation.breakpoint";d.ANNOTATION_BOOKMARK="orion.annotation.bookmark";d.ANNOTATION_FOLDING="orion.annotation.folding";d.ANNOTATION_CURRENT_BRACKET="orion.annotation.currentBracket";d.ANNOTATION_MATCHING_BRACKET="orion.annotation.matchingBracket";d.ANNOTATION_CURRENT_LINE="orion.annotation.currentLine";
d.ANNOTATION_CURRENT_SEARCH="orion.annotation.currentSearch";d.ANNOTATION_MATCHING_SEARCH="orion.annotation.matchingSearch";d.ANNOTATION_READ_OCCURRENCE="orion.annotation.readOccurrence";d.ANNOTATION_WRITE_OCCURRENCE="orion.annotation.writeOccurrence";d.ANNOTATION_SELECTED_LINKED_GROUP="orion.annotation.selectedLinkedGroup";d.ANNOTATION_CURRENT_LINKED_GROUP="orion.annotation.currentLinkedGroup";d.ANNOTATION_LINKED_GROUP="orion.annotation.linkedGroup";d.ANNOTATION_BLAME="orion.annotation.blame";d.ANNOTATION_CURRENT_BLAME=
"orion.annotation.currentBlame";var j={};d.registerType=function(b,a){var g=a;"function"!==typeof g&&(g=function(a,b,g){this.start=a;this.end=b;void 0!==g&&(this.title=g)},g.prototype=a);g.prototype.type=b;j[b]=g;return b};d.createAnnotation=function(b,a,g,c){return new (this.getType(b))(a,g,c)};d.getType=function(b){return j[b]};c(d.ANNOTATION_ERROR);c(d.ANNOTATION_WARNING);c(d.ANNOTATION_TASK);c(d.ANNOTATION_BREAKPOINT);c(d.ANNOTATION_BOOKMARK);c(d.ANNOTATION_CURRENT_BRACKET);c(d.ANNOTATION_MATCHING_BRACKET);
c(d.ANNOTATION_CURRENT_SEARCH);c(d.ANNOTATION_MATCHING_SEARCH);c(d.ANNOTATION_READ_OCCURRENCE);c(d.ANNOTATION_WRITE_OCCURRENCE);c(d.ANNOTATION_SELECTED_LINKED_GROUP);c(d.ANNOTATION_CURRENT_LINKED_GROUP);c(d.ANNOTATION_LINKED_GROUP);c(d.ANNOTATION_CURRENT_LINE,!0);c(d.ANNOTATION_BLAME,!0);c(d.ANNOTATION_CURRENT_BLAME,!0);d.registerType(d.ANNOTATION_FOLDING,i);f.addMixin=function(b){var a=f.prototype,g;for(g in a)a.hasOwnProperty(g)&&(b[g]=a[g])};f.prototype={addAnnotationType:function(b){this._annotationTypes||
(this._annotationTypes=[]);this._annotationTypes.push(b)},getAnnotationTypePriority:function(b){if(this._annotationTypes)for(var a=0;a<this._annotationTypes.length;a++)if(this._annotationTypes[a]===b)return a+1;return 0},getAnnotationsByType:function(b,a,g){b=b.getAnnotations(a,g);for(g=[];b.hasNext();)a=b.next(),0!==this.getAnnotationTypePriority(a.type)&&g.push(a);var c=this;g.sort(function(a,b){return c.getAnnotationTypePriority(a.type)-c.getAnnotationTypePriority(b.type)});return g},isAnnotationTypeVisible:function(b){return 0!==
this.getAnnotationTypePriority(b)},removeAnnotationType:function(b){if(this._annotationTypes)for(var a=0;a<this._annotationTypes.length;a++)if(this._annotationTypes[a]===b){this._annotationTypes.splice(a,1);break}}};e.prototype={addAnnotation:function(b){if(b){var a=this._annotations,g=this._binarySearch(a,b.start);a.splice(g,0,b);b._annotationModel=this;this.onChanged({type:"Changed",added:[b],removed:[],changed:[]})}},getTextModel:function(){return this._model},getAnnotations:function(b,a){var g=
this._annotations,c,e=0,d;d=void 0===b&&void 0===a?function(){return e<g.length?g[e++]:null}:function(){for(;e<g.length;){var c=g[e++];if(b===c.start||(b>c.start?b<c.end:c.start<a))return c;if(c.start>=a)break}return null};c=d();return{next:function(){var a=c;a&&(c=d());return a},hasNext:function(){return null!==c}}},modifyAnnotation:function(b){if(b&&!(0>this._getAnnotationIndex(b)))this.onChanged({type:"Changed",added:[],removed:[],changed:[b]})},onChanged:function(b){return this.dispatchEvent(b)},
removeAnnotations:function(b){var a=this._annotations,g,c;if(b){g=[];for(c=a.length-1;0<=c;c--){var e=a[c];e.type===b&&(a.splice(c,1),g.splice(0,0,e),e._annotationModel=null)}}else g=a;this.onChanged({type:"Changed",removed:g,added:[],changed:[]})},removeAnnotation:function(b){if(b){var a=this._getAnnotationIndex(b);0>a||(b._annotationModel=null,b={type:"Changed",removed:this._annotations.splice(a,1),added:[],changed:[]},this.onChanged(b))}},replaceAnnotations:function(b,a){var g=this._annotations,
c,e,d,f=[];if(b)for(c=b.length-1;0<=c;c--)d=b[c],e=this._getAnnotationIndex(d),0>e||(d._annotationModel=null,g.splice(e,1),f.splice(0,0,d));a||(a=[]);for(c=0;c<a.length;c++)d=a[c],e=this._binarySearch(g,d.start),d._annotationModel=this,g.splice(e,0,d);this.onChanged({type:"Changed",removed:f,added:a,changed:[]})},setTextModel:function(b){this._model&&this._model.removeEventListener("Changed",this._listener.onChanged);(this._model=b)&&this._model.addEventListener("Changed",this._listener.onChanged)},
_binarySearch:function(b,a){for(var g=b.length,c=-1,e;1<g-c;)e=Math.floor((g+c)/2),a<=b[e].start?g=e:c=e;return g},_getAnnotationIndex:function(b){for(var a=this._annotations,g=this._binarySearch(a,b.start);g<a.length&&a[g].start===b.start;){if(a[g]===b)return g;g++}return-1},_onChanged:function(b){var a=b.start,g=b.addedCharCount,c=b.removedCharCount,e=this._annotations,d=a+c;if(0<e.length){b={type:"Changed",added:[],removed:[],changed:[],textModelChangedEvent:b};g-=c;for(c=0;c<e.length;c++){var f=
e[c];f.start>=d?(f._oldStart=f.start,f._oldEnd=f.end,f.start+=g,f.end+=g,b.changed.push(f)):f.end<=a||(f.start<a&&d<f.end?(f._oldStart=f.start,f._oldEnd=f.end,f.end+=g,b.changed.push(f)):(e.splice(c,1),b.removed.push(f),f._annotationModel=null,f.expand&&f.expand(),c--))}if(0<b.added.length||0<b.removed.length||0<b.changed.length)this.onChanged(b)}}};m.EventTarget.addMixin(e.prototype);h.prototype={destroy:function(){var b=this._view;b&&(b.removeEventListener("Destroy",this._listener.onDestroy),b.removeEventListener("LineStyle",
this._listener.onLineStyle),this.view=null);(b=this._annotationModel)&&b.removeEventListener("Changed",this._listener.onChanged)},_mergeStyle:function(b,a){if(a){b||(b={});b.styleClass=b.styleClass&&a.styleClass&&b.styleClass!==a.styleClass?b.styleClass+(" "+a.styleClass):a.styleClass;var g;a.tagName&&!b.tagName&&(b.tagName=a.tagName);if(a.style)for(g in b.style||(b.style={}),a.style)b.style[g]||(b.style[g]=a.style[g]);if(a.attributes)for(g in b.attributes||(b.attributes={}),a.attributes)b.attributes[g]||
(b.attributes[g]=a.attributes[g])}return b},_mergeStyleRanges:function(b,a){b||(b=[]);var g,c;for(c=0;c<b.length&&a;c++){var e=b[c];if(a.end<=e.start)break;if(!(a.start>=e.end)){g=this._mergeStyle({},e.style);g=this._mergeStyle(g,a.style);var d=[];d.push(c,1);a.start<e.start&&d.push({start:a.start,end:e.start,style:a.style});a.start>e.start&&d.push({start:e.start,end:a.start,style:e.style});d.push({start:Math.max(e.start,a.start),end:Math.min(e.end,a.end),style:g});a.end<e.end&&d.push({start:a.end,
end:e.end,style:e.style});a=a.end>e.end?{start:e.end,end:a.end,style:a.style}:null;Array.prototype.splice.apply(b,d)}}a&&(g=this._mergeStyle({},a.style),b.splice(c,0,{start:a.start,end:a.end,style:g}));return b},_onAnnotationModelChanged:function(b){function a(a,b){d.getBaseModel&&(a=d.mapOffset(a,!0),b=d.mapOffset(b,!0));-1!==a&&-1!==b&&c.redrawRange(a,b)}function g(b,g){for(var c=0;c<b.length;c++)if(e.isAnnotationTypeVisible(b[c].type)){var d=b[c];a(d.start,d.end);g&&(void 0!==d._oldStart&&d._oldEnd)&&
a(d._oldStart,d._oldEnd)}}var c=this._view;if(c){var e=this,d=c.getModel();g(b.added);g(b.removed);g(b.changed,!0)}},_onDestroy:function(){this.destroy()},_onLineStyle:function(b){var a=this._annotationModel,g=b.textView.getModel(),c=a.getTextModel(),e=b.lineStart,d=b.lineStart+b.lineText.length;c!==g&&(e=g.mapOffset(e),d=g.mapOffset(d));for(a=a.getAnnotations(e,d);a.hasNext();)if(e=a.next(),this.isAnnotationTypeVisible(e.type)){if(e.rangeStyle){var d=e.start,f=e.end;c!==g&&(d=g.mapOffset(d,!0),f=
g.mapOffset(f,!0));b.ranges=this._mergeStyleRanges(b.ranges,{start:d,end:f,style:e.rangeStyle})}e.lineStyle&&(b.style=this._mergeStyle({},b.style),b.style=this._mergeStyle(b.style,e.lineStyle))}}};f.addMixin(h.prototype);return{FoldingAnnotation:i,AnnotationType:d,AnnotationTypeList:f,AnnotationModel:e,AnnotationStyler:h}});
define("orion/objects",[],function(){function k(k){for(var i=1;i<arguments.length;i++){var d=arguments[i],c;for(c in d)Object.prototype.hasOwnProperty.call(d,c)&&(k[c]=d[c])}return k}return{clone:function(m){if(Array.isArray(m))return Array.prototype.slice.call(m);var i=Object.create(Object.getPrototypeOf(m));k(i,m);return i},mixin:k,toArray:function(k){return Array.isArray(k)?k:[k]}}});
define("orion/editor/editor","i18n!orion/editor/nls/messages orion/editor/eventTarget orion/editor/tooltip orion/editor/annotations orion/objects orion/util".split(" "),function(k,m,i,d,c,f){function e(b){b=b||{};this._domNode=b.domNode;this._model=b.model;this._undoStack=b.undoStack;this._statusReporter=b.statusReporter;this._title=null;var a=this;this._listener={onChanged:function(b){a.onChanged(b)}};this._model&&this._model.addEventListener("Changed",this._listener.onChanged);this.checkDirty()}
function h(b){b=b||{};e.call(this,b);this._textViewFactory=b.textViewFactory;this._undoStackFactory=b.undoStackFactory;this._textDNDFactory=b.textDNDFactory;this._annotationFactory=b.annotationFactory;this._foldingRulerFactory=b.foldingRulerFactory;this._lineNumberRulerFactory=b.lineNumberRulerFactory;this._contentAssistFactory=b.contentAssistFactory;this._keyBindingFactory=b.keyBindingFactory;this._contentAssist=this._foldingRuler=this._overviewRuler=this._lineNumberRuler=this._annotationRuler=this._annotationModel=
this._annotationStyler=null}var j=d.AnnotationType;e.prototype={destroy:function(){this.uninstall();this._statusReporter=this._domNode=null;this._model&&this._model.removeEventListener("Changed",this._listener.onChanged)},checkDirty:function(){this.setDirty(this._undoStack&&!this._undoStack.isClean())},focus:function(){},getModel:function(){return this._model},getText:function(b,a){return this.getModel().getText(b,a)},getTitle:function(){return this._title},getUndoStack:function(){return this._undoStack},
install:function(){this.installed=!0},isDirty:function(){return this._dirty},markClean:function(){this.getUndoStack().markClean();this.setDirty(!1)},onDirtyChanged:function(b){return this.dispatchEvent(b)},onInputChanged:function(b){return this.dispatchEvent(b)},onChanged:function(){this.checkDirty()},reportStatus:function(b,a,g){this._statusReporter&&this._statusReporter(b,a,g)},resize:function(){},setDirty:function(b){this._dirty!==b&&(this._dirty=b,this.onDirtyChanged({type:"DirtyChanged"}))},
_setModelText:function(b){this._model&&this._model.setText(b)},setInput:function(b,a,g,c){this._title=b;c||(a?this.reportStatus(a,"error"):null!==g&&(void 0!==g&&"string"===typeof g)&&this._setModelText(g),this._undoStack&&this._undoStack.reset());this.checkDirty();this.onInputChanged({type:"InputChanged",title:b,message:a,contents:g,contentsSaved:c})},setText:function(b,a,g){this.getModel().setText(b,a,g)},uninstall:function(){this.installed=!1}};m.EventTarget.addMixin(e.prototype);h.prototype=new e;
c.mixin(h.prototype,{destroy:function(){e.prototype.destroy.call(this);this._textViewFactory=this._undoStackFactory=this._textDNDFactory=this._annotationFactory=this._foldingRulerFactory=this._lineNumberRulerFactory=this._contentAssistFactory=this._keyBindingFactory=null},getAnnotationModel:function(){return this._annotationModel},getAnnotationRuler:function(){return this._annotationRuler},getAnnotationStyler:function(){return this._annotationStyler},getContentAssist:function(){return this._contentAssist},
getFoldingRuler:function(){return this._foldingRuler},getLineNumberRuler:function(){return this._lineNumberRuler},getModel:function(){if(!this._textView)return null;var b=this._textView.getModel();b.getBaseModel&&(b=b.getBaseModel());return b},getOverviewRuler:function(){return this._overviewRuler},getTextView:function(){return this._textView},getKeyModes:function(){return this._textView.getKeyModes()},getSourceCodeActions:function(){return this._sourceCodeActions},getLinkedMode:function(){return this._linkedMode},
getTextActions:function(){return this._textActions},focus:function(){this._textView&&this._textView.focus()},resize:function(){this._textView&&this._textView.resize()},setAnnotationRulerVisible:function(b,a){if(this._annotationRulerVisible!==b||a)if(this._annotationRulerVisible=b,this._annotationRuler){var g=this._textView;b?g.addRuler(this._annotationRuler,0):g.removeRuler(this._annotationRuler)}},setFoldingRulerVisible:function(b,a){if(this._foldingRulerVisible!==b||a)if(this._foldingRulerVisible=
b,this._foldingRuler){var g=this._textView;g.getModel().getBaseModel&&(b?g.addRuler(this._foldingRuler):g.removeRuler(this._foldingRuler))}},setLineNumberRulerVisible:function(b,a){if(this._lineNumberRulerVisible!==b||a)if(this._lineNumberRulerVisible=b,this._lineNumberRuler){var g=this._textView;b?g.addRuler(this._lineNumberRuler,!this._annotationRulerVisible?0:1):g.removeRuler(this._lineNumberRuler)}},setOverviewRulerVisible:function(b,a){if(this._overviewRulerVisible!==b||a)if(this._overviewRulerVisible=
b,this._overviewRuler){var g=this._textView;b?g.addRuler(this._overviewRuler):g.removeRuler(this._overviewRuler)}},mapOffset:function(b,a){var g=this._textView.getModel();g.getBaseModel&&(b=g.mapOffset(b,a));return b},getLineAtOffset:function(b){return this.getModel().getLineAtOffset(this.mapOffset(b))},getLineStart:function(b){return this.getModel().getLineStart(b)},getCaretOffset:function(){return this.mapOffset(this._textView.getCaretOffset())},getSelection:function(){var b=this._textView,a=b.getSelection(),
b=b.getModel();b.getBaseModel&&(a.start=b.mapOffset(a.start),a.end=b.mapOffset(a.end));return a},_expandOffset:function(b){var a=this._textView.getModel(),g=this._annotationModel;if(g&&a.getBaseModel)for(b=g.getAnnotations(b,b+1);b.hasNext();)a=b.next(),a.type===j.ANNOTATION_FOLDING&&a.expand&&a.expand()},setCaretOffset:function(b,a,g){var c=this._textView,e=c.getModel();e.getBaseModel&&(this._expandOffset(b),b=e.mapOffset(b,!0));c.setCaretOffset(b,a,g)},setText:function(b,a,g){var c=this._textView,
e=c.getModel();e.getBaseModel&&(void 0!==a&&(this._expandOffset(a),a=e.mapOffset(a,!0)),void 0!==g&&(this._expandOffset(g),g=e.mapOffset(g,!0)));c.setText(b,a,g)},setSelection:function(b,a,g,c){var e=this._textView,d=e.getModel();d.getBaseModel&&(this._expandOffset(b),this._expandOffset(a),b=d.mapOffset(b,!0),a=d.mapOffset(a,!0));e.setSelection(b,a,g,c)},moveSelection:function(b,a,g,c){var e=this._textView;this.setSelection(b,a||b,1/3,function(){(void 0===c||c)&&e.focus();g&&g()})},_getTooltipInfo:function(b,
a){var g=this._textView,c=this.getAnnotationModel();if(!c)return null;var e=this._annotationStyler;if(!e)return null;var d=g.getOffsetAtLocation(b,a);if(-1===d)return null;d=this.mapOffset(d);e=e.getAnnotationsByType(c,d,d+1);c=[];for(d=0;d<e.length;d++)e[d].rangeStyle&&c.push(e[d]);if(0===c.length)return null;g=g.convert({x:b,y:a},"document","page");return{contents:c,anchor:"left",x:g.x+10,y:g.y+20}},_highlightCurrentLine:function(b,a){var g=this._annotationModel;if(g){var c=this._textView;if(!c.getOptions("singleMode")){var e=
c.getModel(),d=a?e.getLineAtOffset(a.start):-1,f=e.getLineAtOffset(b.start),c=b.start===b.end,h=!a||a.start===a.end,i=e.getLineStart(f),k=e.getLineEnd(f);e.getBaseModel&&(i=e.mapOffset(i),k=e.mapOffset(k));e=this._currentLineAnnotation;if(!(d===f&&h&&c&&e&&e.start===i&&e.end===k)){var d=e?[e]:null,m;c&&(e=j.createAnnotation(j.ANNOTATION_CURRENT_LINE,i,k),m=[e]);this._currentLineAnnotation=e;g.replaceAnnotations(d,m)}}}},installTextView:function(){this.install()},install:function(){if(!this._textView){this._textView=
this._textViewFactory();this._undoStackFactory&&(this._undoStack=this._undoStackFactory.createUndoStack(this),this.checkDirty());this._textDNDFactory&&(this._textDND=this._textDNDFactory.createTextDND(this,this._undoStack));this._contentAssistFactory&&(this._contentAssist=this._contentAssistFactory.createContentAssistMode(this).getContentAssist());var b=this,a=this._textView,g=this;this._listener={onModelChanged:function(){g.checkDirty()},onMouseOver:function(a){g._listener.onMouseMove(a)},onMouseMove:function(b){var c=
i.Tooltip.getTooltip(a);c&&!(g._listener.lastMouseX===b.event.clientX&&g._listener.lastMouseY===b.event.clientY)&&(g._listener.lastMouseX=b.event.clientX,g._listener.lastMouseY=b.event.clientY,c.setTarget({x:b.x,y:b.y,getTooltipInfo:function(){return g._getTooltipInfo(this.x,this.y)}}))},onMouseOut:function(b){var c=i.Tooltip.getTooltip(a);c&&!(g._listener.lastMouseX===b.event.clientX&&g._listener.lastMouseY===b.event.clientY)&&(g._listener.lastMouseX=b.event.clientX,g._listener.lastMouseY=b.event.clientY,
c.setTarget(null))},onScroll:function(){var b=i.Tooltip.getTooltip(a);b&&b.setTarget(null,0,0)},onSelection:function(a){g._updateCursorStatus();g._highlightCurrentLine(a.newValue,a.oldValue)}};a.addEventListener("ModelChanged",this._listener.onModelChanged);a.addEventListener("Selection",this._listener.onSelection);a.addEventListener("MouseOver",this._listener.onMouseOver);a.addEventListener("MouseOut",this._listener.onMouseOut);a.addEventListener("MouseMove",this._listener.onMouseMove);a.addEventListener("Scroll",
this._listener.onScroll);if(this._keyBindingFactory){var c;if(c="function"===typeof this._keyBindingFactory?this._keyBindingFactory(this,this.getKeyModes(),this._undoStack,this._contentAssist):this._keyBindingFactory.createKeyBindings(b,this._undoStack,this._contentAssist))this._textActions=c.textActions,this._linkedMode=c.linkedMode,this._sourceCodeActions=c.sourceCodeActions}c=function(a){if(void 0!==a&&-1!==a){for(var g=this.getView().getModel(),c=this.getAnnotationModel(),e=b.mapOffset(g.getLineStart(a)),
a=b.mapOffset(g.getLineEnd(a)),g=c.getAnnotations(e,a),d=null;g.hasNext();){var l=g.next();if(l.type===j.ANNOTATION_BOOKMARK){d=l;break}}d?c.removeAnnotation(d):(d=j.createAnnotation(j.ANNOTATION_BOOKMARK,e,a),d.title=void 0,c.addAnnotation(d))}};if(this._annotationFactory){var d=a.getModel();d.getBaseModel&&(d=d.getBaseModel());if(this._annotationModel=this._annotationFactory.createAnnotationModel(d))if(d=this._annotationStyler=this._annotationFactory.createAnnotationStyler(a,this._annotationModel))d.addAnnotationType(j.ANNOTATION_CURRENT_SEARCH),
d.addAnnotationType(j.ANNOTATION_MATCHING_SEARCH),d.addAnnotationType(j.ANNOTATION_ERROR),d.addAnnotationType(j.ANNOTATION_WARNING),d.addAnnotationType(j.ANNOTATION_MATCHING_BRACKET),d.addAnnotationType(j.ANNOTATION_CURRENT_BRACKET),d.addAnnotationType(j.ANNOTATION_CURRENT_LINE),d.addAnnotationType(j.ANNOTATION_READ_OCCURRENCE),d.addAnnotationType(j.ANNOTATION_WRITE_OCCURRENCE),d.addAnnotationType(j.ANNOTATION_SELECTED_LINKED_GROUP),d.addAnnotationType(j.ANNOTATION_CURRENT_LINKED_GROUP),d.addAnnotationType(j.ANNOTATION_LINKED_GROUP),
d.addAnnotationType("orion.annotation.highlightError");var d=this._annotationFactory.createAnnotationRulers(this._annotationModel),f=this._annotationRuler=d.annotationRuler;f&&(f.onDblClick=c,f.setMultiAnnotationOverlay({html:"<div class='annotationHTML overlay'></div>"}),f.addAnnotationType(j.ANNOTATION_ERROR),f.addAnnotationType(j.ANNOTATION_WARNING),f.addAnnotationType(j.ANNOTATION_TASK),f.addAnnotationType(j.ANNOTATION_BOOKMARK));this.setAnnotationRulerVisible(this._annotationRulerVisible||void 0===
this._annotationRulerVisible,!0);if(f=this._overviewRuler=d.overviewRuler)f.addAnnotationType(j.ANNOTATION_CURRENT_SEARCH),f.addAnnotationType(j.ANNOTATION_MATCHING_SEARCH),f.addAnnotationType(j.ANNOTATION_READ_OCCURRENCE),f.addAnnotationType(j.ANNOTATION_WRITE_OCCURRENCE),f.addAnnotationType(j.ANNOTATION_CURRENT_BLAME),f.addAnnotationType(j.ANNOTATION_ERROR),f.addAnnotationType(j.ANNOTATION_WARNING),f.addAnnotationType(j.ANNOTATION_TASK),f.addAnnotationType(j.ANNOTATION_BOOKMARK),f.addAnnotationType(j.ANNOTATION_MATCHING_BRACKET),
f.addAnnotationType(j.ANNOTATION_CURRENT_BRACKET),f.addAnnotationType(j.ANNOTATION_CURRENT_LINE);this.setOverviewRulerVisible(this._overviewRulerVisible||void 0===this._overviewRulerVisible,!0)}this._lineNumberRulerFactory&&(this._lineNumberRuler=this._lineNumberRulerFactory.createLineNumberRuler(this._annotationModel),this._lineNumberRuler.addAnnotationType(j.ANNOTATION_CURRENT_BLAME),this._lineNumberRuler.addAnnotationType(j.ANNOTATION_BLAME),this._lineNumberRuler.onDblClick=c,this.setLineNumberRulerVisible(this._lineNumberRulerVisible||
void 0===this._lineNumberRulerVisible,!0));this._foldingRulerFactory&&(this._foldingRuler=this._foldingRulerFactory.createFoldingRuler(this._annotationModel),this._foldingRuler.addAnnotationType(j.ANNOTATION_FOLDING),this.setFoldingRulerVisible(this._foldingRulerVisible||void 0===this._foldingRulerVisible,!0));this.dispatchEvent({type:"TextViewInstalled",textView:a});e.prototype.install.call(this)}},uninstallTextView:function(){this.uninstall()},uninstall:function(){var b=this._textView;b&&(b.destroy(),
this._textView=this._undoStack=this._textDND=this._contentAssist=this._listener=this._annotationModel=this._annotationStyler=this._annotationRuler=this._overviewRuler=this._lineNumberRuler=this._foldingRuler=this._currentLineAnnotation=this._title=null,this._dirty=!1,this._foldingRulerVisible=this._overviewRulerVisible=this._lineNumberRulerVisible=this._annotationRulerVisible=void 0,this.dispatchEvent({type:"TextViewUninstalled",textView:b}),e.prototype.uninstall.call(this))},_updateCursorStatus:function(){for(var b=
this.getModel(),a=this.getCaretOffset(),g=b.getLineAtOffset(a),b=b.getLineStart(g),a=a-b,b=this.getKeyModes(),c=0;c<b.length;c++){var e=b[c];if(e.isActive()&&e.isStatusActive&&e.isStatusActive())return}this.reportStatus(f.formatMessage(k.lineColumn,g+1,a+1))},showAnnotations:function(b,a,g,c){var e=this._annotationModel;if(e){for(var d=[],f=[],h=e.getTextModel(),i=e.getAnnotations(),k;i.hasNext();)k=i.next(),-1!==a.indexOf(k.type)&&k.creatorID===this&&d.push(k);if(b)for(a=0;a<b.length;a++)if(k=b[a]){if(g)k=
g(k);else{var m;"number"===typeof k.line?(m=h.getLineStart(k.line-1),i=m+k.start-1,m=m+k.end-1):(i=k.start,m=k.end);var u=c(k);if(!u)continue;k=j.createAnnotation(u,i,m,k.description)}k.creatorID=this;f.push(k)}e.replaceAnnotations(d,f)}},showProblems:function(b){this.showAnnotations(b,[j.ANNOTATION_ERROR,j.ANNOTATION_WARNING,j.ANNOTATION_TASK],null,function(a){switch(a.severity){case "error":return j.ANNOTATION_ERROR;case "warning":return j.ANNOTATION_WARNING;case "task":return j.ANNOTATION_TASK}return null})},
showOccurrences:function(b){this.showAnnotations(b,[j.ANNOTATION_READ_OCCURRENCE,j.ANNOTATION_WRITE_OCCURRENCE],null,function(a){return a.readAccess?j.ANNOTATION_READ_OCCURRENCE:j.ANNOTATION_WRITE_OCCURRENCE})},showBlame:function(b){var a=this._blameRGB,g=this.getTextView().getOptions("parent").ownerDocument;if(!a){var e=f.createElement(g,"div");e.className="annotation blame";g.body.appendChild(e);var h=(g.defaultView||g.parentWindow).getComputedStyle(e).getPropertyValue("background-color");e.parentNode.removeChild(e);
var e=h.indexOf("("),i=h.indexOf(")"),h=h.substring(e+1,i);this._blameRGB=a=h.split(",").slice(0,3)}var r=function(){var a=d.AnnotationType.createAnnotation(this.groupType,this.start,this.end,this.title);a.style=c.mixin({},a.style);a.style.style=c.mixin({},a.style.style);a.style.style.backgroundColor="";this.groupAnnotation=a;a.blame=this.blame;a.html=this.html;a.creatorID=this.creatorID;return a},m=function(){var a=f.createElement(g,"div");a.className="tooltipTitle";var b=this.blame.Message.indexOf("\n");
-1===b&&(b=this.blame.Message.length);var c=f.createElement(g,"a");c.href=this.blame.CommitLink;c.appendChild(g.createTextNode(this.blame.Message.substring(0,b)));a.appendChild(c);a.appendChild(f.createElement(g,"br"));a.appendChild(g.createTextNode(f.formatMessage(k.committerOnTime,this.blame.AuthorName,this.blame.Time)));return a},t=this.getModel();this.showAnnotations(b,[j.ANNOTATION_BLAME,j.ANNOTATION_CURRENT_BLAME],function(b){var g=t.getLineStart(b.Start-1),e=t.getLineEnd(b.End-1,!0),g=d.AnnotationType.createAnnotation(j.ANNOTATION_BLAME,
g,e,m),e=a.slice(0);e.push(b.Shade);g.style=c.mixin({},g.style);g.style.style=c.mixin({},g.style.style);g.style.style.backgroundColor="rgba("+e.join()+")";g.groupId=b.Name;g.groupType=j.ANNOTATION_CURRENT_BLAME;g.createGroupAnnotation=r;g.html='<img class="annotationHTML blame" src="'+b.AuthorImage+'"/>';g.blame=b;return g})},showSelection:function(b,a,g,c,e){"number"===typeof b?("number"!==typeof a&&(a=b),this.moveSelection(b,a)):"number"===typeof g&&(b=this.getModel().getLineStart(g-1),"number"===
typeof c&&(b+=c),"number"!==typeof e&&(e=0),this.moveSelection(b,b+e))},_setModelText:function(b){this._textView&&(this._textView.setText(b),this._textView.getModel().setLineDelimiter("auto"),this._highlightCurrentLine(this._textView.getSelection()))},setInput:function(b,a,g,c,d){e.prototype.setInput.call(this,b,a,g,c);this._textView&&(!c&&!d)&&this._textView.focus()},onGotoLine:function(b,a,g,c){if(this._textView){var e=this.getModel(),b=Math.max(0,Math.min(b,e.getLineCount()-1)),d=e.getLineStart(b),
f=0;void 0===g&&(g=0);"string"===typeof a?(b=e.getLine(b).indexOf(a),-1!==b&&(f=b,g=f+a.length)):(f=a,a=e.getLineEnd(b)-d,f=Math.min(f,a),g=Math.min(g,a));this.moveSelection(d+f,d+g,c)}}});return{BaseEditor:e,Editor:h}});
define("orion/editor/find","i18n!orion/editor/nls/messages orion/keyBinding orion/editor/keyModes orion/editor/annotations orion/regex orion/objects orion/util".split(" "),function(k,m,i,d,c,f,e){function h(a){var b=a.getTextView();i.KeyMode.call(this,b);this.editor=a;this._active=!1;this._success=!0;this._ignoreSelection=!1;this._prefix="";b.setAction("incrementalFindCancel",function(){this.setActive(!1);return!0}.bind(this));b.setAction("incrementalFindBackspace",function(){return this._backspace()}.bind(this));
var e=this;this._listener={onVerify:function(a){var b=e.editor,g=b.getModel(),d=b.mapOffset(a.start),b=b.mapOffset(a.end),g=g.getText(d,b);if((g=e._prefix.match(RegExp("^"+c.escape(g),"i")))&&0<g.length)e._prefix+=a.text,e._success=!0,e._status(),e.find(e._forward,!0),a.text=null},onSelection:function(){e._ignoreSelection||e.setActive(!1)}}}function j(a,b,c){if(a){this._editor=a;this._undoStack=b;this._showAll=!0;this._visible=!1;this._wrap=this._caseInsensitive=!0;this._wholeWord=!1;this._incremental=
!0;this._regex=!1;this._findAfterReplace=!0;this._reverse=this._hideAfterFind=!1;this._timer=this._end=this._start=void 0;this._lastString="";var e=this;this._listeners={onEditorFocus:function(a){e._removeCurrentAnnotation(a)}};this.setOptions(c)}}var b={};h.prototype=new i.KeyMode;f.mixin(h.prototype,{createKeyBindings:function(){var a=m.KeyBinding,b=[];b.push({actionID:"incrementalFindBackspace",keyBinding:new a(8)});b.push({actionID:"incrementalFindCancel",keyBinding:new a(13)});b.push({actionID:"incrementalFindCancel",
keyBinding:new a(27)});b.push({actionID:"incrementalFindReverse",keyBinding:new a(38)});b.push({actionID:"incrementalFind",keyBinding:new a(40)});b.push({actionID:"incrementalFindReverse",keyBinding:new a("k",!0,!0)});b.push({actionID:"incrementalFind",keyBinding:new a("k",!0)});return b},find:function(a,b){this._forward=a;if(!this.isActive())return this.setActive(!0),!1;var c=this._prefix;if(0===c.length)return!1;var e=this.editor,d=e.getModel(),d=a?this._success?b?this._start:e.getCaretOffset()+
1:0:this._success?b?this._start:e.getCaretOffset():d.getCharCount()-1;(c=e.getModel().find({string:c,start:d,reverse:!a,caseInsensitive:c.toLowerCase()===c}).next())?(b||(this._start=d),this._ignoreSelection=this._success=!0,e.moveSelection(a?c.start:c.end,a?c.end:c.start),this._ignoreSelection=!1):this._success=!1;this._status();return!0},isActive:function(){return this._active},isStatusActive:function(){return this.isActive()},setActive:function(a){this._active!==a&&(this._active=a,this._prefix=
"",this._success=!0,a=this.editor.getTextView(),this._start=this.editor.getCaretOffset(),this.editor.setCaretOffset(this._start),this._active?(a.addEventListener("Verify",this._listener.onVerify),a.addEventListener("Selection",this._listener.onSelection),a.addKeyMode(this)):(a.removeEventListener("Verify",this._listener.onVerify),a.removeEventListener("Selection",this._listener.onSelection),a.removeKeyMode(this)),this._status())},_backspace:function(){var a=this._prefix,a=this._prefix=a.substring(0,
a.length-1);return 0===a.length?(this._ignoreSelection=this._success=!0,this.editor.setCaretOffset(this.editor.getSelection().start),this._ignoreSelection=!1,this._status(),!0):this.find(this._forward,!0)},_status:function(){if(this.isActive()){var a;a=this._forward?this._success?k.incrementalFindStr:k.incrementalFindStrNotFound:this._success?k.incrementalFindReverseStr:k.incrementalFindReverseStrNotFound;a=e.formatMessage(a,this._prefix);this.editor.reportStatus(a,this._success?"":"error")}else this.editor.reportStatus("")}});
b.IncrementalFind=h;j.prototype={find:function(a,b,c){this.setOptions({reverse:!a});var e=this.getFindString(),d;b&&(e=b.findString||e,d=b.count);a=this.getOptions();this.setOptions(b);b=c?this._startOffset:this.getStartOffset();if((d=this._doFind(e,b,d))&&!c)this._startOffset=d.start;this.setOptions(a);this._hideAfterFind&&this.hide();return d},getStartOffset:function(){return void 0!==this._start?this._start:this._reverse?this._editor.getSelection().start-1:this._editor.getCaretOffset()},getFindString:function(){var a=
this._editor.getSelection(),a=this._editor.getText(a.start,a.end);this._regex&&(a=c.escape(a));return a||this._lastString},getOptions:function(){return{showAll:this._showAll,caseInsensitive:this._caseInsensitive,wrap:this._wrap,wholeWord:this._wholeWord,incremental:this._incremental,regex:this._regex,findAfterReplace:this._findAfterReplace,hideAfterFind:this._hideAfterFind,reverse:this._reverse,findCallback:this._findCallback,start:this._start,end:this._end}},getReplaceString:function(){return""},
hide:function(){this._visible=!1;this._savedOptions&&(this.setOptions(this._savedOptions.pop()),0===this._savedOptions.length&&(this._savedOptions=null));this._removeAllAnnotations();var a=this._editor.getTextView();a&&(a.removeEventListener("Focus",this._listeners.onEditorFocus),a.focus())},_processReplaceString:function(a){var b=a;if(this._regex){for(var b="",c=!1,e=this._editor.getModel().getLineDelimiter(),d=0;d<a.length;d++){var f=a.substring(d,d+1);if(c){switch(f){case "R":b+=e;break;case "r":b+=
"\r";break;case "n":b+="\n";break;case "t":b+="\t";break;case "\\":b+="\\";break;default:b+="\\"+f}c=!1}else"\\"===f?c=!0:b+=f}c&&(b+="\\")}return b},isVisible:function(){return this._visible},replace:function(){var a=this.getFindString();if(a){var b=this._editor,c=this._processReplaceString(this.getReplaceString()),e=b.getSelection().start;if(b=b.getModel().find({string:a,start:e,reverse:!1,wrap:this._wrap,regex:this._regex,wholeWord:this._wholeWord,caseInsensitive:this._caseInsensitive}).next())this.startUndo(),
this._doReplace(b.start,b.end,a,c),this.endUndo()}this._findAfterReplace&&a&&this._doFind(a,this.getStartOffset())},replaceAll:function(){var a=this.getFindString();if(a){this._replacingAll=!0;var b=this._editor,c=b.getTextView();b.reportStatus(k.replaceAll);var d=this._processReplaceString(this.getReplaceString()),f=this;window.setTimeout(function(){for(var h=0,j=0;;){var i=f._doFind(a,h,null,!0);if(!i)break;j++;1===j&&(c.setRedraw(!1),f.startUndo());f._doReplace(i.start,i.end,a,d);h=f.getStartOffset()}0<
j&&(f.endUndo(),c.setRedraw(!0));0<h?b.reportStatus(e.formatMessage(k.replacedMatches,j)):b.reportStatus(k.nothingReplaced,"error");f._replacingAll=!1},100)}},setOptions:function(a){if(a){if((!0===a.showAll||!1===a.showAll)&&this._showAll!==a.showAll)if(this._showAll=a.showAll,this.isVisible())if(this._showAll)this._markAllOccurrences();else{var b=this._editor.getAnnotationModel();b&&b.removeAnnotations(d.AnnotationType.ANNOTATION_MATCHING_SEARCH)}if(!0===a.caseInsensitive||!1===a.caseInsensitive)this._caseInsensitive=
a.caseInsensitive;if(!0===a.wrap||!1===a.wrap)this._wrap=a.wrap;if(!0===a.wholeWord||!1===a.wholeWord)this._wholeWord=a.wholeWord;if(!0===a.incremental||!1===a.incremental)this._incremental=a.incremental;if(!0===a.regex||!1===a.regex)this._regex=a.regex;if(!0===a.findAfterReplace||!1===a.findAfterReplace)this._findAfterReplace=a.findAfterReplace;if(!0===a.hideAfterFind||!1===a.hideAfterFind)this._hideAfterFind=a.hideAfterFind;if(!0===a.reverse||!1===a.reverse)this._reverse=a.reverse;a.hasOwnProperty("findCallback")&&
(this._findCallback=a.findCallback);a.hasOwnProperty("start")&&(this._start=a.start);a.hasOwnProperty("end")&&(this._end=a.end)}},show:function(a){this._visible=!0;a&&(this._savedOptions||(this._savedOptions=[]),this._savedOptions.push(this.getOptions()),this.setOptions(a));this._startOffset=this._editor.getSelection().start;this._editor.getTextView().addEventListener("Focus",this._listeners.onEditorFocus);var b=this;window.setTimeout(function(){b._incremental&&b.find(!0,null,!0)},0)},startUndo:function(){this._undoStack&&
this._undoStack.startCompoundChange()},endUndo:function(){this._undoStack&&this._undoStack.endCompoundChange()},_find:function(a,b,c){return this._editor.getModel().find({string:a,start:b,end:this._end,reverse:this._reverse,wrap:c?!1:this._wrap,regex:this._regex,wholeWord:this._wholeWord,caseInsensitive:this._caseInsensitive})},_doFind:function(a,b,c,e){var c=c||1,f=this._editor;if(!a)return this._removeAllAnnotations(),null;this._lastString=a;var h,j;if(this._regex)try{j=this._find(a,b,e)}catch(i){f.reportStatus(i.message,
"error");return}else j=this._find(a,b,e);for(a=0;a<c&&j.hasNext();a++)h=j.next();if(!this._replacingAll){h?this._editor.reportStatus(""):this._editor.reportStatus(k.notFound,"error");if(this.isVisible()){c=d.AnnotationType.ANNOTATION_CURRENT_SEARCH;if(j=f.getAnnotationModel())j.removeAnnotations(c),h&&j.addAnnotation(d.AnnotationType.createAnnotation(c,h.start,h.end));if(this._showAll){this._timer&&window.clearTimeout(this._timer);var m=this;this._timer=window.setTimeout(function(){m._markAllOccurrences();
m._timer=null},500)}}this._findCallback?this._findCallback(h):h&&f.moveSelection(h.start,h.end,null,!1)}return h},_doReplace:function(a,b,c,e){var d=this._editor;if(this._regex&&(e=d.getText(a,b).replace(RegExp(c,this._caseInsensitive?"i":""),e),!e))return;d.setText(e,a,b);d.setSelection(a,a+e.length,!0)},_markAllOccurrences:function(){var a=this._editor.getAnnotationModel();if(a){for(var b=d.AnnotationType.ANNOTATION_MATCHING_SEARCH,c=a.getAnnotations(),e=[],f;c.hasNext();){var h=c.next();h.type===
b&&e.push(h)}if(this.isVisible()){c=this.getFindString();c=this._editor.getModel().find({string:c,regex:this._regex,wholeWord:this._wholeWord,caseInsensitive:this._caseInsensitive});for(f=[];c.hasNext();)h=c.next(),f.push(d.AnnotationType.createAnnotation(b,h.start,h.end))}a.replaceAnnotations(e,f)}},_removeAllAnnotations:function(){var a=this._editor.getAnnotationModel();a&&(a.removeAnnotations(d.AnnotationType.ANNOTATION_CURRENT_SEARCH),a.removeAnnotations(d.AnnotationType.ANNOTATION_MATCHING_SEARCH))},
_removeCurrentAnnotation:function(){var a=this._editor.getAnnotationModel();a&&a.removeAnnotations(d.AnnotationType.ANNOTATION_CURRENT_SEARCH)}};b.Find=j;return b});
define("orion/editor/actions","i18n!orion/editor/nls/messages orion/keyBinding orion/editor/annotations orion/editor/tooltip orion/editor/find orion/util".split(" "),function(k,m,i,d,c,f){function e(a,b,e){this.editor=a;this.undoStack=b;this._incrementalFind=new c.IncrementalFind(a);this._find=e?e:new c.Find(a,b);this._lastEditLocation=null;this.init()}function h(a,b,c,e){this.editor=a;this.undoStack=b;this.contentAssist=c;this.linkedMode=e;this.contentAssist&&this.contentAssist.addEventListener("ProposalApplied",
this.contentAssistProposalApplied.bind(this));this.init()}var j=i.AnnotationType,b={};e.prototype={init:function(){var a=this.editor.getTextView();this._lastEditListener={onModelChanged:function(a){this.editor.isDirty()&&(this._lastEditLocation=a.start+a.addedCharCount)}.bind(this)};a.addEventListener("ModelChanged",this._lastEditListener.onModelChanged);a.setAction("undo",function(a){if(this.undoStack){var b=1;a&&a.count&&(b=a.count);for(;0<b;)this.undoStack.undo(),--b;return!0}return!1}.bind(this),
{name:k.undo});a.setAction("redo",function(a){if(this.undoStack){var b=1;a&&a.count&&(b=a.count);for(;0<b;)this.undoStack.redo(),--b;return!0}return!1}.bind(this),{name:k.redo});a.setKeyBinding(new m.KeyBinding("f",!0),"find");a.setAction("find",function(){if(this._find){var a=this.editor.getSelection();(a=prompt(k.find,this.editor.getText(a.start,a.end)))&&this._find.find(!0,{findString:a})}}.bind(this),{name:k.find});a.setKeyBinding(new m.KeyBinding("k",!0),"findNext");a.setAction("findNext",function(a){return this._find?
(this._find.find(!0,a),!0):!1}.bind(this),{name:k.findNext});a.setKeyBinding(new m.KeyBinding("k",!0,!0),"findPrevious");a.setAction("findPrevious",function(a){return this._find?(this._find.find(!1,a),!0):!1}.bind(this),{name:k.findPrevious});a.setKeyBinding(new m.KeyBinding("j",!0),"incrementalFind");a.setAction("incrementalFind",function(){this._incrementalFind&&this._incrementalFind.find(!0);return!0}.bind(this),{name:k.incrementalFind});a.setKeyBinding(new m.KeyBinding("j",!0,!0),"incrementalFindReverse");
a.setAction("incrementalFindReverse",function(){this._incrementalFind&&this._incrementalFind.find(!1);return!0}.bind(this),{name:k.incrementalFindReverse});a.setAction("tab",function(){return this.indentLines()}.bind(this));a.setAction("shiftTab",function(){return this.unindentLines()}.bind(this),{name:k.unindentLines});a.setKeyBinding(new m.KeyBinding(38,!1,!1,!0),"moveLinesUp");a.setAction("moveLinesUp",function(){return this.moveLinesUp()}.bind(this),{name:k.moveLinesUp});a.setKeyBinding(new m.KeyBinding(40,
!1,!1,!0),"moveLinesDown");a.setAction("moveLinesDown",function(){return this.moveLinesDown()}.bind(this),{name:k.moveLinesDown});a.setKeyBinding(new m.KeyBinding(38,!0,!1,!0),"copyLinesUp");a.setAction("copyLinesUp",function(){return this.copyLinesUp()}.bind(this),{name:k.copyLinesUp});a.setKeyBinding(new m.KeyBinding(40,!0,!1,!0),"copyLinesDown");a.setAction("copyLinesDown",function(){return this.copyLinesDown()}.bind(this),{name:k.copyLinesDown});a.setKeyBinding(new m.KeyBinding("d",!0,!1,!1),
"deleteLines");a.setAction("deleteLines",function(a){return this.deleteLines(a)}.bind(this),{name:k.deleteLines});a.setKeyBinding(new m.KeyBinding("l",!f.isMac,!1,!1,f.isMac),"gotoLine");a.setAction("gotoLine",function(){return this.gotoLine()}.bind(this),{name:k.gotoLine});a.setKeyBinding(new m.KeyBinding(190,!0),"nextAnnotation");a.setAction("nextAnnotation",function(){return this.nextAnnotation(!0)}.bind(this),{name:k.nextAnnotation});a.setKeyBinding(new m.KeyBinding(188,!0),"previousAnnotation");
a.setAction("previousAnnotation",function(){return this.nextAnnotation(!1)}.bind(this),{name:k.prevAnnotation});a.setKeyBinding(new m.KeyBinding("e",!0,!1,!0,!1),"expand");a.setAction("expand",function(){return this.expandAnnotation(!0)}.bind(this),{name:k.expand});a.setKeyBinding(new m.KeyBinding("c",!0,!1,!0,!1),"collapse");a.setAction("collapse",function(){return this.expandAnnotation(!1)}.bind(this),{name:k.collapse});a.setKeyBinding(new m.KeyBinding("e",!0,!0,!0,!1),"expandAll");a.setAction("expandAll",
function(){return this.expandAnnotations(!0)}.bind(this),{name:k.expandAll});a.setKeyBinding(new m.KeyBinding("c",!0,!0,!0,!1),"collapseAll");a.setAction("collapseAll",function(){return this.expandAnnotations(!1)}.bind(this),{name:k.collapseAll});a.setKeyBinding(new m.KeyBinding("q",!f.isMac,!1,!1,f.isMac),"lastEdit");a.setAction("lastEdit",function(){return this.gotoLastEdit()}.bind(this),{name:k.lastEdit})},copyLinesDown:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;
var b=a.getModel(),c=a.getSelection(),e=b.getLineAtOffset(c.start),c=b.getLineAtOffset(c.end>c.start?c.end-1:c.end),d=b.getLineStart(e),e=b.getLineEnd(c,!0),f=b.getLineCount(),h="",d=b.getText(d,e);c===f-1&&(d=(h=b.getLineDelimiter())+d);a.setText(d,e,e);a.setSelection(e+h.length,e+d.length);return!0},copyLinesUp:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var b=a.getModel(),c=a.getSelection(),e=b.getLineAtOffset(c.start),c=b.getLineAtOffset(c.end>c.start?c.end-
1:c.end),e=b.getLineStart(e),d=b.getLineEnd(c,!0),f=b.getLineCount(),h="",d=b.getText(e,d);c===f-1&&(d+=h=b.getLineDelimiter());a.setText(d,e,e);a.setSelection(e,e+d.length-h.length);return!0},deleteLines:function(a){var b=this.editor;if(b.getTextView().getOptions("readonly"))return!1;var c=1;a&&a.count&&(c=a.count);var e=b.getSelection(),d=b.getModel(),f=d.getLineAtOffset(e.start),a=d.getLineStart(f),c=e.start!==e.end||1===c?d.getLineAtOffset(e.end>e.start?e.end-1:e.end):Math.min(f+c-1,d.getLineCount()-
1),c=d.getLineEnd(c,!0);b.setText("",a,c);return!0},expandAnnotation:function(a){var b=this.editor,c=b.getAnnotationModel();if(!c)return!0;var e=b.getModel(),d=b.getCaretOffset(),f=e.getLineAtOffset(d),d=e.getLineStart(f),f=e.getLineEnd(f,!0);e.getBaseModel&&(d=e.mapOffset(d),f=e.mapOffset(f),e.getBaseModel());for(var h,c=c.getAnnotations(d,f);!h&&c.hasNext();)e=c.next(),e.type===i.AnnotationType.ANNOTATION_FOLDING&&(h=e);h&&a!==h.expanded&&(a?h.expand():(b.setCaretOffset(h.start),h.collapse()));
return!0},expandAnnotations:function(a){var b=this.editor,c=b.getTextView(),e=b.getAnnotationModel();if(!e)return!0;b.getModel();e=e.getAnnotations();for(c.setRedraw(!1);e.hasNext();)b=e.next(),b.type===i.AnnotationType.ANNOTATION_FOLDING&&a!==b.expanded&&(a?b.expand():b.collapse());c.setRedraw(!0);return!0},indentLines:function(){var a=this.editor,b=a.getTextView();if(b.getOptions("readonly"))return!1;if(b.getOptions("tabMode")){var c=a.getModel(),e=a.getSelection(),d=c.getLineAtOffset(e.start),
f=c.getLineAtOffset(e.end>e.start?e.end-1:e.end);if(d!==f){var h=[];h.push("");for(var j=d;j<=f;j++)h.push(c.getLine(j,!0));j=c.getLineStart(d);c=c.getLineEnd(f,!0);b=b.getOptions("tabSize","expandTab");b=b.expandTab?Array(b.tabSize+1).join(" "):"\t";a.setText(h.join(b),j,c);a.setSelection(j===e.start?e.start:e.start+b.length,e.end+(f-d+1)*b.length);return!0}return!1}},gotoLastEdit:function(){"number"===typeof this._lastEditLocation&&this.editor.showSelection(this._lastEditLocation);return!0},gotoLine:function(){var a=
this.editor,b=a.getModel().getLineAtOffset(a.getCaretOffset());if(b=prompt(k.gotoLinePrompty,b+1))b=parseInt(b,10),a.onGotoLine(b-1,0);return!0},moveLinesDown:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var b=a.getModel(),c=a.getSelection(),e=b.getLineAtOffset(c.start),d=b.getLineAtOffset(c.end>c.start?c.end-1:c.end),f=b.getLineCount();if(d===f-1)return!0;var e=b.getLineStart(e),c=b.getLineEnd(d,!0),h=b.getLineEnd(d+1,!0)-(c-e),j=0;d!==f-2?b=b.getText(e,c):(d=b.getLineEnd(d),
b=b.getText(d,c)+b.getText(e,d),j+=c-d);this.startUndo();a.setText("",e,c);a.setText(b,h,h);a.setSelection(h+j,h+j+b.length);this.endUndo();return!0},moveLinesUp:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var b=a.getModel(),c=a.getSelection(),e=b.getLineAtOffset(c.start);if(0===e)return!0;var d=b.getLineAtOffset(c.end>c.start?c.end-1:c.end),f=b.getLineCount(),c=b.getLineStart(e-1),h=b.getLineStart(e),j=b.getLineEnd(d,!0),i=b.getText(h,j),k=0;d===f-1&&(d=b.getLineEnd(e-
1),e=b.getLineEnd(e-1,!0),i+=b.getText(d,e),h=d,k=e-d);this.startUndo();a.setText("",h,j);a.setText(i,c,c);a.setSelection(c,c+i.length-k);this.endUndo();return!0},nextAnnotation:function(a){function b(a){return!!a.lineStyle||a.type===j.ANNOTATION_MATCHING_BRACKET||a.type===j.ANNOTATION_CURRENT_BRACKET||!f.isAnnotationTypeVisible(a.type)}var c=this.editor,e=c.getAnnotationModel();if(!e)return!0;var f=c.getOverviewRuler()||c.getAnnotationStyler();if(!f)return!0;for(var h=c.getModel(),i=c.getCaretOffset(),
k=e.getAnnotations(a?i:0,a?h.getCharCount():i),m=null;k.hasNext();){var y=k.next();if(a){if(y.start<=i)continue}else if(y.start>=i)continue;if(!b(y)&&(m=y,a))break}if(m){for(var u=[m],k=e.getAnnotations(m.start,m.start);k.hasNext();)y=k.next(),y!==m&&!b(y)&&u.push(y);var p=c.getTextView(),s=h.getLineAtOffset(m.start),A=d.Tooltip.getTooltip(p);if(!A)return c.moveSelection(m.start),!0;c.moveSelection(m.start,m.start,function(){A.setTarget({getTooltipInfo:function(){var a=p.convert({x:p.getLocationAtOffset(m.start).x,
y:p.getLocationAtOffset(h.getLineStart(s)).y},"document","page");return{contents:u,x:a.x,y:a.y+Math.floor(1.33*p.getLineHeight(s))}}},0)})}return!0},unindentLines:function(){var a=this.editor,b=a.getTextView();if(b.getOptions("readonly"))return!1;if(b.getOptions("tabMode")){for(var c=a.getModel(),e=a.getSelection(),d=c.getLineAtOffset(e.start),f=c.getLineAtOffset(e.end>e.start?e.end-1:e.end),h=b.getOptions("tabSize"),j=Array(h+1).join(" "),i=[],k=b=0,m=d;m<=f;m++){var p=c.getLine(m,!0);if(c.getLineStart(m)!==
c.getLineEnd(m))if(0===p.indexOf("\t"))p=p.substring(1),b++;else if(0===p.indexOf(j))p=p.substring(h),b+=h;else return!0;m===d&&(k=b);i.push(p)}d=c.getLineStart(d);h=c.getLineEnd(f,!0);c=c.getLineStart(f);a.setText(i.join(""),d,h);f=d===e.start?e.start:e.start-k;e=Math.max(f,e.end-b+(e.end===c+1&&e.start!==e.end?1:0));a.setSelection(f,e);return!0}},startUndo:function(){this.undoStack&&this.undoStack.startCompoundChange()},endUndo:function(){this.undoStack&&this.undoStack.endCompoundChange()}};b.TextActions=
e;h.prototype={init:function(){var a=this.editor.getTextView();a.setAction("lineStart",function(){return this.lineStart()}.bind(this));a.setAction("enter",function(){return this.autoIndent()}.bind(this));a.setKeyBinding(new m.KeyBinding("t",!0,!1,!0),"trimTrailingWhitespaces");a.setAction("trimTrailingWhitespaces",function(){return this.trimTrailingWhitespaces()}.bind(this),{name:k.trimTrailingWhitespaces});a.setKeyBinding(new m.KeyBinding(191,!0),"toggleLineComment");a.setAction("toggleLineComment",
function(){return this.toggleLineComment()}.bind(this),{name:k.toggleLineComment});a.setKeyBinding(new m.KeyBinding(191,!0,!f.isMac,!1,f.isMac),"addBlockComment");a.setAction("addBlockComment",function(){return this.addBlockComment()}.bind(this),{name:k.addBlockComment});a.setKeyBinding(new m.KeyBinding(220,!0,!f.isMac,!1,f.isMac),"removeBlockComment");a.setAction("removeBlockComment",function(){return this.removeBlockComment()}.bind(this),{name:k.removeBlockComment});a.setKeyBinding(new m.KeyBinding("[",
!1,!1,!1,!1,"keypress"),"autoPairSquareBracket");a.setAction("autoPairSquareBracket",function(){return this.autoPairBrackets("[","]")}.bind(this));a.setKeyBinding(new m.KeyBinding("]",!1,!1,!1,!1,"keypress"),"skipClosingSquareBracket");a.setAction("skipClosingSquareBracket",function(){return this.skipClosingBracket("]")}.bind(this));a.setKeyBinding(new m.KeyBinding("<",!1,!1,!1,!1,"keypress"),"autoPairAngleBracket");a.setAction("autoPairAngleBracket",function(){return this.autoPairBrackets("<",">")}.bind(this));
a.setKeyBinding(new m.KeyBinding(">",!1,!1,!1,!1,"keypress"),"skipClosingAngleBracket");a.setAction("skipClosingAngleBracket",function(){return this.skipClosingBracket(">")}.bind(this));a.setKeyBinding(new m.KeyBinding("(",!1,!1,!1,!1,"keypress"),"autoPairParentheses");a.setAction("autoPairParentheses",function(){return this.autoPairBrackets("(",")")}.bind(this));a.setKeyBinding(new m.KeyBinding(")",!1,!1,!1,!1,"keypress"),"skipClosingParenthesis");a.setAction("skipClosingParenthesis",function(){return this.skipClosingBracket(")")}.bind(this));
a.setKeyBinding(new m.KeyBinding("{",!1,!1,!1,!1,"keypress"),"autoPairBraces");a.setAction("autoPairBraces",function(){return this.autoPairBrackets("{","}")}.bind(this));a.setKeyBinding(new m.KeyBinding("}",!1,!1,!1,!1,"keypress"),"skipClosingBrace");a.setAction("skipClosingBrace",function(){return this.skipClosingBracket("}")}.bind(this));a.setKeyBinding(new m.KeyBinding("'",!1,!1,!1,!1,"keypress"),"autoPairSingleQuotation");a.setAction("autoPairSingleQuotation",function(){return this.autoPairQuotations("'")}.bind(this));
a.setKeyBinding(new m.KeyBinding('"',!1,!1,!1,!1,"keypress"),"autoPairDblQuotation");a.setAction("autoPairDblQuotation",function(){return this.autoPairQuotations('"')}.bind(this));a.setAction("deletePrevious",function(){return this.deletePrevious()}.bind(this))},autoIndent:function(){var a=this.editor,b=a.getTextView();if(b.getOptions("readonly"))return!1;var c=a.getSelection();if(c.start===c.end){for(var e=a.getModel(),d=e.getLineAtOffset(c.start),f=e.getLine(d,!1),h=e.getLineStart(d),j=0,i=c.start-
h,k;j<i&&(32===(k=f.charCodeAt(j))||9===k);)j++;var h=f.substring(0,j),b=b.getOptions("tabSize","expandTab"),m=b.expandTab?Array(b.tabSize+1).join(" "):"\t",b=e.getLineDelimiter(),p=/^[\s]*\/\*[\*]*[\s]*$/,s=/^[\s]*\*/,A=/\*\/[\s]*$/,v=f.substring(0,i),z=f.substring(i),G;if(this.smartIndentation&&123===f.charCodeAt(G=v.trimRight().length-1))return e=i-G-1,z=z.length-z.trimLeft().length,f=125===f.charCodeAt(i+z)?b+h+m+b+h:b+h+m,a.setText(f,c.start-e,c.end+z),a.setCaretOffset(c.start+b.length+h.length+
m.length-e),!0;if(this.autoCompleteComments&&!A.test(v)&&(p.test(v)||s.test(v))){if(j=p.exec(v)){f=b+h+" * ";f=A.test(z)?f+z.substring(0,z.length-2).trim():f+z.trim();if(e.getLineCount()===d+1||!s.test(e.getLine(d+1)))f+=b+h+" */";a.setText(f,c.start,c.end+z.length);a.setCaretOffset(c.start+b.length+h.length+3);return!0}if(j=s.exec(v))for(d-=1;0<=d;d--){j=e.getLine(d,!1);if(p.test(j))return A.test(z)||47===f.charCodeAt(i)?(f=b+h+"*"+z,h=c.start+b.length+h.length+1):(f=b+h+"* "+z,h=c.start+b.length+
h.length+2),a.setText(f,c.start,c.end+z.length),a.setCaretOffset(h),!0;if(!s.test(j))break}}else{if(A.test(v)&&32===h.charCodeAt(h.length-1))return f=b+h.substring(0,h.length-1),a.setText(f,c.start,c.end),a.setCaretOffset(c.start+f.length),!0;if(0<j){for(j=i;j<f.length&&(32===(k=f.charCodeAt(j++))||9===k);)c.end++;a.setText(e.getLineDelimiter()+h,c.start,c.end);return!0}}}return!1},addBlockComment:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var b=a.getModel(),c=
a.getSelection(),e=this._findEnclosingComment(b,c.start,c.end);if(void 0!==e.commentStart&&void 0!==e.commentEnd)return!0;b=b.getText(c.start,c.end);if(0===b.length)return!0;var e=b.length,b=b.replace(/\/\*|\*\//g,""),d=b.length;a.setText("/*"+b+"*/",c.start,c.end);a.setSelection(c.start+2,c.end+2+(d-e));return!0},autoPairBrackets:function(a,b){if("["===a&&!this.autoPairSquareBrackets||"{"===a&&!this.autoPairBraces||"("===a&&!this.autoPairParentheses||"<"===a&&!this.autoPairAngleBrackets)return!1;
var c=this.editor;if(c.getTextView().getOptions("readonly"))return!1;var e=c.getSelection(),d=c.getModel(),f=c.getCaretOffset()===d.getCharCount()?"":d.getText(e.start,e.start+1).trim(),h=/^$|[)}\]>]/;return e.start===e.end&&h.test(f)?(c.setText(a+b,e.start,e.start),c.setCaretOffset(e.start+1),!0):e.start!==e.end?(d=d.getText(e.start,e.end),c.setText(a+d+b,e.start,e.end),c.setSelection(e.start+1,e.end+1),!0):!1},autoPairQuotations:function(a){if(!this.autoPairQuotation)return!1;var b=this.editor;
if(b.getTextView().getOptions("readonly"))return!1;var c=b.getSelection(),e=b.getModel(),d=b.getCaretOffset(),f=0===d?"":e.getText(c.start-1,c.start).trim(),h=d===e.getCharCount()?"":e.getText(c.start,c.start+1).trim(),d=/^"$|^'$/,j=/\w/,i=/^$|[)}\]>]/;if(c.start!==c.end){e=e.getText(c.start,c.end);if(d.test(e))return!1;b.setText(a+e+a,c.start,c.end);b.setSelection(c.start+1,c.end+1)}else{if(h!==a){if(f===a||d.test(h)||j.test(f)||!i.test(h))return!1;b.setText(a+a,c.start,c.start)}b.setCaretOffset(c.start+
1)}return!0},contentAssistProposalApplied:function(a){a=a.data.proposal;if(a.positions&&0<a.positions.length&&this.linkedMode){for(var b=[],c=0;c<a.positions.length;++c)b[c]={positions:[{offset:a.positions[c].offset,length:a.positions[c].length}]};this.linkedMode.enterLinkedMode({groups:b,escapePosition:a.escapePosition})}else a.groups&&0<a.groups.length&&this.linkedMode?this.linkedMode.enterLinkedMode({groups:a.groups,escapePosition:a.escapePosition}):a.escapePosition&&this.editor.getTextView().setCaretOffset(a.escapePosition);
return!0},deletePrevious:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var b=a.getSelection();if(b.start!==b.end)return!1;var c=a.getModel(),e=a.getCaretOffset(),d=0===e?"":c.getText(b.start-1,b.start),c=e===c.getCharCount()?"":c.getText(b.start,b.start+1);("("===d&&")"===c||"["===d&&"]"===c||"{"===d&&"}"===c||"<"===d&&">"===c||'"'===d&&'"'===c||"'"===d&&"'"===c)&&a.setText("",b.start,b.start+1);return!1},_findEnclosingComment:function(a,b,c){var e=a.getLineAtOffset(b),
d=a.getLineAtOffset(c),f,h,j,i,k,m;for(f=e;0<=f&&!(h=a.getLine(f),j=f===e?b-a.getLineStart(e):h.length,i=h.lastIndexOf("/*",j),h=h.lastIndexOf("*/",j),h>i);f--)if(-1!==i){k=a.getLineStart(f)+i;break}for(f=d;f<a.getLineCount()&&!(h=a.getLine(f),j=f===d?c-a.getLineStart(d):0,i=h.indexOf("/*",j),h=h.indexOf("*/",j),-1!==i&&i<h);f++)if(-1!==h){m=a.getLineStart(f)+h;break}return{commentStart:k,commentEnd:m}},lineStart:function(){for(var a=this.editor,b=a.getModel(),c=a.getCaretOffset(),e=b.getLineAtOffset(c),
d=b.getLineStart(e),b=b.getLine(e),e=0;e<b.length;e++){var f=b.charCodeAt(e);if(!(32===f||9===f))break}e+=d;return c!==e?(a.setSelection(e,e),!0):!1},removeBlockComment:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var b=a.getModel(),c=a.getSelection(),e=b.getText(c.start,c.end),d,f,h;for(h=0;h<e.length;h++)if("/*"===e.substring(h,h+2)){d=c.start+h;break}for(;h<e.length;h++)if("*/"===e.substring(h,h+2)){f=c.start+h;break}if(void 0!==d&&void 0!==f)a.setText(b.getText(d+
2,f),d,f+2),a.setSelection(d,f);else{e=this._findEnclosingComment(b,c.start,c.end);if(void 0===e.commentStart||void 0===e.commentEnd)return!0;b=b.getText(e.commentStart+2,e.commentEnd);a.setText(b,e.commentStart,e.commentEnd+2);a.setSelection(c.start-2,c.end-2)}return!0},toggleLineComment:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;for(var b=a.getModel(),c=a.getSelection(),e=b.getLineAtOffset(c.start),d=b.getLineAtOffset(c.end>c.start?c.end-1:c.end),f=!0,h=[],j,
i,k=e;k<=d;k++)if(j=b.getLine(k,!0),h.push(j),!f||-1===(i=j.indexOf("//")))f=!1;else if(0!==i){var m;for(m=0;m<i&&!(f=j.charCodeAt(m),!(32===f||9===f));m++);f=m===i}k=b.getLineStart(e);m=b.getLineEnd(d,!0);if(f){for(f=0;f<h.length;f++)j=h[f],i=j.indexOf("//"),h[f]=j.substring(0,i)+j.substring(i+2);h=h.join("");j=b.getLineStart(d);b=k===c.start?c.start:c.start-2;c=c.end-2*(d-e+1)+(c.end===j+1?2:0)}else h.splice(0,0,""),h=h.join("//"),b=k===c.start?c.start:c.start+2,c=c.end+2*(d-e+1);a.setText(h,k,
m);a.setSelection(b,c);return!0},trimTrailingWhitespaces:function(){var a=this.editor,b=a.getModel(),c=a.getSelection();a.getTextView().setRedraw(!1);a.getUndoStack().startCompoundChange();for(var e=/(\s+$)/,d=b.getLineCount(),f=0;f<d;f++){var h=b.getLine(f),j=e.exec(h);if(j){var i=b.getLineStart(f),h=j[0].length,j=i+j.index;b.setText("",j,j+h);c.start>j&&(c.start=Math.max(j,c.start-h));c.start!==c.end&&c.end>j&&(c.end=Math.max(j,c.end-h))}}a.getUndoStack().endCompoundChange();a.getTextView().setRedraw(!0);
a.setSelection(c.start,c.end,!1)},startUndo:function(){this.undoStack&&this.undoStack.startCompoundChange()},skipClosingBracket:function(a){var b=this.editor;if(b.getTextView().getOptions("readonly"))return!1;var c=b.getSelection(),e=b.getModel();return(b.getCaretOffset()===e.getCharCount()?"":e.getText(c.start,c.start+1))===a?(b.setCaretOffset(c.start+1),!0):!1},endUndo:function(){this.undoStack&&this.undoStack.endCompoundChange()},setAutoPairParentheses:function(a){this.autoPairParentheses=a},setAutoPairBraces:function(a){this.autoPairBraces=
a},setAutoPairSquareBrackets:function(a){this.autoPairSquareBrackets=a},setAutoPairAngleBrackets:function(a){this.autoPairAngleBrackets=a},setAutoPairQuotations:function(a){this.autoPairQuotation=a},setAutoCompleteComments:function(a){this.autoCompleteComments=a},setSmartIndentation:function(a){this.smartIndentation=a}};b.SourceCodeActions=h;String.prototype.trimLeft||(String.prototype.trimLeft=function(){return this.replace(/^\s+/g,"")});String.prototype.trimRight||(String.prototype.trimRight=function(){return this.replace(/\s+$/g,
"")});return b});
define("orion/editor/undoStack",[],function(){function k(d,c,f,e,h){this.model=d;this.offset=c;this.text=f;this.previousText=e;this.type=h}function m(d){this.owner=d;this.changes=[]}function i(d,c){this.size=void 0!==c?c:100;this.reset();var f=this;this._listener={onChanging:function(c){f._onChanging(c)},onDestroy:function(c){f._onDestroy(c)}};if(d.getModel){var e=d.getModel();e.getBaseModel&&(e=e.getBaseModel());this.model=e;this.setView(d)}else this.shared=!0,this.model=d;this.model.addEventListener("Changing",this._listener.onChanging)}
k.prototype={getRedoChanges:function(){return[{start:this.offset,end:this.offset+this.previousText.length,text:this.text}]},getUndoChanges:function(){return[{start:this.offset,end:this.offset+this.text.length,text:this.previousText}]},undo:function(d,c){this._doUndoRedo(this.offset,this.previousText,this.text,d,c);return!0},redo:function(d,c){this._doUndoRedo(this.offset,this.text,this.previousText,d,c);return!0},merge:function(d,c,f,e,h){if(e===this.type){if(1===e&&d===this.offset+this.text.length)return this.text+=
c,!0;if(-1===e&&h===this.offset)return this.offset=d,this.previousText=f+this.previousText,!0;if(-1===e&&d===this.offset)return this.previousText+=f,!0}return!1},_doUndoRedo:function(d,c,f,e,h){this.model.setText(c,d,d+f.length);h&&e&&(f=e.getModel(),f!==this.model&&(d=f.mapOffset(d,!0)),e.setSelection(d,d+c.length))}};m.prototype={getRedoChanges:function(){for(var d=[],c=0;c<this.changes.length;c++)d=d.concat(this.changes[c].getRedoChanges());return d},getUndoChanges:function(){for(var d=[],c=this.changes.length-
1;0<=c;c--)d=d.concat(this.changes[c].getUndoChanges());return d},add:function(d){this.changes.push(d)},end:function(d){d&&(this.endSelection=d.getSelection(),this.endCaret=d.getCaretOffset());(d=this.owner)&&d.end&&d.end()},undo:function(d,c){1<this.changes.length&&d&&d.setRedraw(!1);for(var f=this.changes.length-1;0<=f;f--)this.changes[f].undo(d,!1);1<this.changes.length&&d&&d.setRedraw(!0);if(c&&d){var f=this.startSelection.start,e=this.startSelection.end;d.setSelection(this.startCaret?f:e,this.startCaret?
e:f)}(f=this.owner)&&f.undo&&f.undo();return 0<this.changes.length},redo:function(d,c){1<this.changes.length&&d&&d.setRedraw(!1);for(var f=0;f<this.changes.length;f++)this.changes[f].redo(d,!1);(1<this.changes.length,d)&&d.setRedraw(!0);if(c&&d){var f=this.endSelection.start,e=this.endSelection.end;d.setSelection(this.endCaret?f:e,this.endCaret?e:f)}(f=this.owner)&&f.redo&&f.redo();return 0<this.changes.length},merge:function(d,c,f,e,h){var j=this.changes.length;return 0<j?this.changes[j-1].merge(d,
c,f,e,h):!1},start:function(d){d&&(this.startSelection=d.getSelection(),this.startCaret=d.getCaretOffset());(d=this.owner)&&d.start&&d.start()}};i.prototype={destroy:function(){this._onDestroy()},add:function(d){this.compoundChange?this.compoundChange.add(d):(this.stack.splice(this.index,this.stack.length-this.index,d),this.index++,this.stack.length>this.size&&(this.stack.shift(),this.index--))},markClean:function(){this._commitUndo();if(this.cleanChange=this.stack[this.index-1])this.cleanChange.type=
2},isClean:function(){return this.cleanChange===this.stack[this.index-1]},canUndo:function(){return 0<this.index},canRedo:function(){return 0<this.stack.length-this.index},endCompoundChange:function(){this.compoundChange&&this.compoundChange.end(this.view);this.compoundChange=void 0},getSize:function(){return{undo:this.index,redo:this.stack.length-this.index}},getRedoChanges:function(){this._commitUndo();for(var d=[],c=this.index;c<this.stack.length;c++)d=d.concat(this.stack[c].getRedoChanges());
return d},getUndoChanges:function(){this._commitUndo();for(var d=[],c=this.index;0<=c;c--)d=d.concat(this.stack[c].getUndoChanges());return d},undo:function(){this._commitUndo();var d;d=!1;this._ignoreUndo=!0;do{if(0>=this.index)break;d=this.stack[--this.index]}while(!(d=d.undo(this.view,!0)));this._ignoreUndo=!1;return d},redo:function(){this._commitUndo();var d;this._ignoreUndo=!0;do{if(this.index>=this.stack.length)break;d=this.stack[this.index++]}while(!d.redo(this.view,!0));this._ignoreUndo=
!1;return!0},reset:function(){this.index=0;this.cleanChange=void 0;this.stack=[];this._ignoreUndo=!1;this._compoundChange=void 0},setView:function(d){this.view!==d&&(this.view&&d.removeEventListener("Destroy",this._listener.onDestroy),(this.view=d)&&d.addEventListener("Destroy",this._listener.onDestroy))},startCompoundChange:function(d){this._commitUndo();d=new m(d);this.add(d);this.compoundChange=d;this.compoundChange.start(this.view);return this.compoundChange},_commitUndo:function(){this.endCompoundChange()},
_onDestroy:function(d){(!d||!this.shared)&&this.model.removeEventListener("Changing",this._listener.onChanging);this.view&&(this.view.removeEventListener("Destroy",this._listener.onDestroy),this.view=null)},_onChanging:function(d){if(!this._ignoreUndo){var c=d.text,f=d.start,e=d.addedCharCount,h=d.removedCharCount,d=f+h,j=0;0===e&&1===h?j=-1:1===e&&0===h&&(j=1);e=this.stack.length;h=this.model.getText(f,d);(!(0<e&&this.index===e)||!this.stack[e-1].merge(f,c,h,j,d))&&this.add(new k(this.model,f,c,
h,j))}}};return{UndoStack:i}});
define("orion/editor/rulers",["i18n!orion/editor/nls/messages","orion/editor/annotations","orion/editor/tooltip","orion/util"],function(k,m,i,d){function c(b,a,c,e){this._location=a||"left";this._overview=c||"page";this._rulerStyle=e;this._view=null;var d=this;this._listener={onTextModelChanged:function(a){d._onTextModelChanged(a)},onAnnotationModelChanged:function(a){d._onAnnotationModelChanged(a)}};this.setAnnotationModel(b)}function f(b,a,e,d,f){c.call(this,b,a,"page",e);this._oddStyle=d||{style:{backgroundColor:"white"}};
this._evenStyle=f||{style:{backgroundColor:"white"}};this._numOfDigits=0;this._firstLine=1}function e(b,a,e){c.call(this,b,a,"page",e)}function h(b,a,e){c.call(this,b,a,"document",e)}function j(b,a,c){e.call(this,b,a,c)}c.prototype={getAnnotations:function(b,a){var c=this._annotationModel;if(!c)return[];var e=this._view.getModel(),d=e.getLineStart(b),f=e.getLineEnd(a-1),h=e;e.getBaseModel&&(h=e.getBaseModel(),d=e.mapOffset(d),f=e.mapOffset(f));for(var j=[],c=this.getAnnotationsByType(c,d,f),d=0;d<
c.length;d++)for(var f=c[d],i=h.getLineAtOffset(f.start),k=h.getLineAtOffset(Math.max(f.start,f.end-1)),m=i;m<=k;m++){var u=m;if(e!==h){u=h.getLineStart(m);u=e.mapOffset(u,!0);if(-1===u)continue;u=e.getLineAtOffset(u)}if(b<=u&&u<a){var p=this._mergeAnnotation(j[u],f,m-i,k-i+1);p&&(j[u]=p)}}if(!this._multiAnnotation&&this._multiAnnotationOverlay)for(var s in j)j[s]._multiple&&(j[s].html+=this._multiAnnotationOverlay.html);return j},getAnnotationModel:function(){return this._annotationModel},getLocation:function(){return this._location},
getOverview:function(){return this._overview},getRulerStyle:function(){return this._rulerStyle},getView:function(){return this._view},getWidestAnnotation:function(){return null},setAnnotationModel:function(b){this._annotationModel&&this._annotationModel.removEventListener("Changed",this._listener.onAnnotationModelChanged);(this._annotationModel=b)&&this._annotationModel.addEventListener("Changed",this._listener.onAnnotationModelChanged)},setMultiAnnotation:function(b){this._multiAnnotation=b},setMultiAnnotationOverlay:function(b){this._multiAnnotationOverlay=
b},setView:function(b){this._onTextModelChanged&&this._view&&this._view.removeEventListener("ModelChanged",this._listener.onTextModelChanged);this._view=b;this._onTextModelChanged&&this._view&&this._view.addEventListener("ModelChanged",this._listener.onTextModelChanged)},onClick:function(b){if(void 0!==b){var a=this._view,c=a.getModel(),e=c,d=c.getLineStart(b),f=d,h=d,j=this._annotationModel;if(j){a=a.getSelection();h=c.getLineEnd(b,!0);d<=a.start&&a.start<h&&(d=a.start);c.getBaseModel&&(d=c.mapOffset(d),
h=c.mapOffset(h),e=c.getBaseModel());for(var k,h=j.getAnnotations(d,h),j=null;!k&&h.hasNext();)a=h.next(),this.isAnnotationTypeVisible(a.type)&&(j=a,a.start<=d||(k=a));j&&void 0!==j.groupId&&(this._currentClickGroup=this._currentClickGroup===j.groupId?null:j.groupId,this._setCurrentGroup(b));k&&e.getLineAtOffset(k.start)===e.getLineAtOffset(d)?(d=k.start,h=k.end):h=d=f;c.getBaseModel&&(d=c.mapOffset(d,!0),h=c.mapOffset(h,!0))}(b=i.Tooltip.getTooltip(this._view))&&b.setTarget(null);this._view.setSelection(h,
d,1/3,function(){})}},onDblClick:function(){},onMouseMove:function(b,a){var c=i.Tooltip.getTooltip(this._view);if(c&&!(c.isVisible()&&this._tooltipLineIndex===b)){this._tooltipLineIndex=b;var e=this;c.setTarget({y:a.clientY,getTooltipInfo:function(){return e._getTooltipInfo(e._tooltipLineIndex,this.y)}})}},onMouseOver:function(b,a){this.onMouseMove(b,a);this._currentClickGroup||this._setCurrentGroup(b)},onMouseOut:function(){this._currentClickGroup||this._setCurrentGroup(-1);var b=i.Tooltip.getTooltip(this._view);
b&&b.setTarget(null)},_getTooltipInfo:function(b,a){if(void 0!==b){var c=this._view,e=c.getModel(),d=this._annotationModel,f=[];if(d){var f=e.getLineStart(b),h=e.getLineEnd(b);e.getBaseModel&&(f=e.mapOffset(f),h=e.mapOffset(h));f=this.getAnnotationsByType(d,f,h)}d=this._getTooltipContents(b,f);if(!d)return null;d={contents:d,anchor:this.getLocation()};f=c.getClientArea();f.y="document"===this.getOverview()?c.convert({y:a},"view","document").y:c.getLocationAtOffset(e.getLineStart(b)).y;c.convert(f,
"document","page");d.x=f.x;d.y=f.y;"right"===d.anchor&&(d.x+=f.width);return d}},_getTooltipContents:function(b,a){return a},_onAnnotationModelChanged:function(b){function a(a){for(var b=0;b<a.length;b++)if(d.isAnnotationTypeVisible(a[b].type)){var f=a[b].start,h=a[b].end;e.getBaseModel&&(f=e.mapOffset(f,!0),h=e.mapOffset(h,!0));-1!==f&&-1!==h&&c.redrawLines(e.getLineAtOffset(f),e.getLineAtOffset(Math.max(f,h-1))+1,d)}}var c=this._view;if(c){var e=c.getModel(),d=this,f=e.getLineCount();b.textModelChangedEvent?
(b=b.textModelChangedEvent.start,e.getBaseModel&&(b=e.mapOffset(b,!0)),b=e.getLineAtOffset(b),c.redrawLines(b,f,d)):(a(b.added),a(b.removed),a(b.changed))}},_mergeAnnotation:function(b,a,c){b||(b={});0===c&&(b.html&&a.html?(a.html!==b.html&&(!b._multiple&&this._multiAnnotation)&&(b.html=this._multiAnnotation.html),b._multiple=!0):b.html=a.html);b.style=this._mergeStyle(b.style,a.style);return b},_mergeStyle:function(b,a){if(a){b||(b={});b.styleClass=b.styleClass&&a.styleClass&&b.styleClass!==a.styleClass?
b.styleClass+(" "+a.styleClass):a.styleClass;var c;if(a.style)for(c in b.style||(b.style={}),a.style)void 0===b.style[c]&&(b.style[c]=a.style[c]);if(a.attributes)for(c in b.attributes||(b.attributes={}),a.attributes)void 0===b.attributes[c]&&(b.attributes[c]=a.attributes[c])}return b},_setCurrentGroup:function(b){var a=this._annotationModel,c=null,e=a.getTextModel(),d,f=this._currentGroupAnnotation;if(-1!==b){var h=e.getLineStart(b),j=e.getLineEnd(b);e.getBaseModel&&(h=e.mapOffset(h),j=e.mapOffset(j));
for(d=a.getAnnotations(h,j);d.hasNext();)if(e=d.next(),this.isAnnotationTypeVisible(e.type)&&e.start<=h&&e.end>=j&&void 0!==e.groupId){c=e;break}if(f&&c&&f.groupId===c.groupId)return}this._currentGroupAnnotation=null;f&&a.removeAnnotations(f.groupType);if(c&&-1!==b){this._currentGroupAnnotation=c;d=a.getAnnotations();for(b=[];d.hasNext();)e=d.next(),delete e.groupAnnotation,e.groupId===c.groupId&&(e=e.createGroupAnnotation(),b.push(e));a.replaceAnnotations(null,b)}}};m.AnnotationTypeList.addMixin(c.prototype);
f.prototype=new c;f.prototype.getAnnotations=function(b,a){for(var e=c.prototype.getAnnotations.call(this,b,a),d=this._view.getModel(),f=b;f<a;f++){var h=f&1?this._oddStyle:this._evenStyle,j=f;d.getBaseModel&&(j=d.getLineStart(j),j=d.getBaseModel().getLineAtOffset(d.mapOffset(j)));e[f]||(e[f]={});e[f].html=this._firstLine+j+"";e[f].style||(e[f].style=h)}return e};f.prototype.getWidestAnnotation=function(){var b=this._view.getModel().getLineCount();return this.getAnnotations(b-1,b)[b-1]};f.prototype.setFirstLine=
function(b){this._firstLine=void 0!==b?b:1};f.prototype._onTextModelChanged=function(b){var a=b.start,b=this._view.getModel(),c=b.getBaseModel?b.getBaseModel().getLineCount():b.getLineCount(),c=(this._firstLine+c-1+"").length;this._numOfDigits!==c&&(this._numOfDigits=c,a=b.getLineAtOffset(a),this._view.redrawLines(a,b.getLineCount(),this))};e.prototype=new c;h.prototype=new c;h.prototype.getRulerStyle=function(){var b={style:{lineHeight:"1px",fontSize:"1px"}};return b=this._mergeStyle(b,this._rulerStyle)};
h.prototype._getTooltipContents=function(b,a){if(0===a.length){var e=this._view.getModel(),f=b;e.getBaseModel&&(f=e.getLineStart(f),f=e.getBaseModel().getLineAtOffset(e.mapOffset(f)));return d.formatMessage(k.line,f+1)}return c.prototype._getTooltipContents.call(this,b,a)};h.prototype._mergeAnnotation=function(b,a,c,e){if(0===c)return b||(b={html:"&nbsp;",style:{style:{height:3*e+"px"}}},b.style=this._mergeStyle(b.style,a.overviewStyle)),b};j.prototype=new e;j.prototype.onClick=function(b){if(void 0!==
b){var a=this._annotationModel;if(a){var c=this._view.getModel(),e=c.getLineStart(b),b=c.getLineEnd(b,!0);c.getBaseModel&&(e=c.mapOffset(e),b=c.mapOffset(b),c=c.getBaseModel());for(var d,a=a.getAnnotations(e,b);!d&&a.hasNext();)b=a.next(),this.isAnnotationTypeVisible(b.type)&&(d=b);d&&c.getLineAtOffset(d.start)===c.getLineAtOffset(e)&&((c=i.Tooltip.getTooltip(this._view))&&c.setTarget(null),d.expanded?d.collapse():d.expand())}}};j.prototype._getTooltipContents=function(b,a){return 1===a.length&&a[0].expanded?
null:e.prototype._getTooltipContents.call(this,b,a)};j.prototype._onAnnotationModelChanged=function(b){function a(a){for(h=0;h<a.length;h++)if(f.isAnnotationTypeVisible(a[h].type)){var b=a[h].start;d.getBaseModel&&(b=d.mapOffset(b,!0));-1!==b&&(i=Math.min(i,d.getLineAtOffset(b)))}}if(b.textModelChangedEvent)e.prototype._onAnnotationModelChanged.call(this,b);else{var c=this._view;if(c){var d=c.getModel(),f=this,h,j=d.getLineCount(),i=j;a(b.added);a(b.removed);a(b.changed);b=c.getRulers();for(h=0;h<
b.length;h++)c.redrawLines(i,j,b[h])}}};return{Ruler:c,AnnotationRuler:e,LineNumberRuler:f,OverviewRuler:h,FoldingRuler:j}});
define("orion/editor/textDND",["orion/util"],function(k){function m(i,d){this._view=i;this._undoStack=d;this._dragSelection=null;this._dropOffset=-1;this._dropText=null;var c=this;this._listener={onDragStart:function(d){c._onDragStart(d)},onDragEnd:function(d){c._onDragEnd(d)},onDragEnter:function(d){c._onDragEnter(d)},onDragOver:function(d){c._onDragOver(d)},onDrop:function(d){c._onDrop(d)},onDestroy:function(d){c._onDestroy(d)}};i.addEventListener("DragStart",this._listener.onDragStart);i.addEventListener("DragEnd",
this._listener.onDragEnd);i.addEventListener("DragEnter",this._listener.onDragEnter);i.addEventListener("DragOver",this._listener.onDragOver);i.addEventListener("Drop",this._listener.onDrop);i.addEventListener("Destroy",this._listener.onDestroy)}m.prototype={destroy:function(){var i=this._view;i&&(i.removeEventListener("DragStart",this._listener.onDragStart),i.removeEventListener("DragEnd",this._listener.onDragEnd),i.removeEventListener("DragEnter",this._listener.onDragEnter),i.removeEventListener("DragOver",
this._listener.onDragOver),i.removeEventListener("Drop",this._listener.onDrop),i.removeEventListener("Destroy",this._listener.onDestroy),this._view=null)},_onDestroy:function(){this.destroy()},_onDragStart:function(i){var d=this._view,c=d.getSelection(),d=d.getModel();d.getBaseModel&&(c.start=d.mapOffset(c.start),c.end=d.mapOffset(c.end),d=d.getBaseModel());if(d=d.getText(c.start,c.end))this._dragSelection=c,i.event.dataTransfer.effectAllowed="copyMove",i.event.dataTransfer.setData("Text",d)},_onDragEnd:function(i){if(this._dragSelection){var d=
this._view,c=i.event.dataTransfer.dropEffect;if(!k.isFirefox&&("none"!==c||this._dropText))c=i.event.dataTransfer.dropEffect=this._dropEffect;this._undoStack&&this._undoStack.startCompoundChange();(i="move"===c)&&d.setText("",this._dragSelection.start,this._dragSelection.end);if(this._dropText){var c=this._dropText,f=this._dropOffset;i&&(f>=this._dragSelection.end?f-=this._dragSelection.end-this._dragSelection.start:f>=this._dragSelection.start&&(f=this._dragSelection.start));d.setText(c,f,f);d.setSelection(f,
f+c.length);this._dropText=null;this._dropOffset=-1}this._undoStack&&this._undoStack.endCompoundChange()}this._dragSelection=null},_onDragEnter:function(i){this._onDragOver(i)},_onDragOver:function(i){var d=i.event.dataTransfer.types,c=!this._view.getOptions("readonly");c&&d&&(c=d.contains?d.contains("text/plain")||d.contains("Text"):-1!==d.indexOf("text/plain")||-1!==d.indexOf("Text"));c?k.isFirefox||(this._dropEffect=i.event.dataTransfer.dropEffect=(k.isMac?i.event.altKey:i.event.ctrlKey)?"copy":
"move"):i.event.dataTransfer.dropEffect="none"},_onDrop:function(i){var d=this._view,c=i.event.dataTransfer.getData("Text");c&&(k.isFirefox||(i.event.dataTransfer.dropEffect=this._dropEffect),i=d.getOffsetAtLocation(i.x,i.y),this._dragSelection?(this._dropOffset=i,this._dropText=c):(d.setText(c,i,i),d.setSelection(i,i+c.length)))}};return{TextDND:m}});
define("orion/editor/templates",[],function(){function k(i,d,c,f){this.prefix=i;this.description=d;this.template=c;this.name=f;this._parse()}function m(i,d){this._keywords=i||[];this._templates=[];this.addTemplates(d||[])}k.prototype={getProposal:function(i,d,c){var i=d-i.length,d={},f,e=void 0!==c.delimiter?c.delimiter:"\n";c.indentation&&(e+=c.indentation);for(var h=void 0!==c.tab?c.tab:"\t",j=0,b=this.variables,a=this.segments,c=[],g=0;g<a.length;g++){var l=a[g],k=b[l];if(void 0!==k)switch(l){case "${tab}":l=
h;break;case "${delimiter}":l=e;break;case "${cursor}":l="";f=j;break;default:var m=d[l];m||(m=d[l]={data:k.data,positions:[]});l=k.substitution;m.data&&m.data.values&&(l=m.data.values[0]);m.positions.push({offset:i+j,length:l.length})}c.push(l);j+=l.length}var e=[],r;for(r in d)d.hasOwnProperty(r)&&e.push(d[r]);c=c.join("");void 0===f&&(f=c.length);return{proposal:c,name:this.name,description:this.description,groups:e,escapePosition:i+f,style:"noemphasis"}},match:function(i){return 0===this.prefix.indexOf(i)},
_parse:function(){var i=this.template,d=[],c={},f,e=0,i=i.replace(/\n/g,"${delimiter}"),i=i.replace(/\t/g,"${tab}");i.replace(/\$\{((?:[^\\}]+|\\.))*\}/g,function(h,j,b){var a=h.substring(2,h.length-1),j=h,g=a,l=null,k=g.indexOf(":");-1!==k&&(g=g.substring(0,k),j="${"+g+"}",l=JSON.parse(a.substring(k+1).replace("\\}","}").trim()));(a=c[j])||(a=c[j]={});a.substitution=g;l&&(a.data=l);(f=i.substring(e,b))&&d.push(f);d.push(j);e=b+h.length;return g});(f=i.substring(e,i.length))&&d.push(f);this.segments=
d;this.variables=c}};m.prototype={addTemplates:function(i){for(var d=this.getTemplates(),c=0;c<i.length;c++)d.push(new k(i[c].prefix,i[c].description,i[c].template,i[c].name))},computeProposals:function(i,d,c){var f=this.getPrefix(i,d,c),e=[];this.isValid(f,i,d,c)&&(e=e.concat(this.getTemplateProposals(f,d,c)),e=e.concat(this.getKeywordProposals(f)));return e},getKeywords:function(){return this._keywords},getKeywordProposals:function(i){var d=[],c=this.getKeywords();if(c){for(var f=0;f<c.length;f++)0===
c[f].indexOf(i)&&d.push({proposal:c[f].substring(i.length),description:c[f],style:"noemphasis_keyword"});0<d.length&&d.splice(0,0,{proposal:"",description:"Keywords",style:"noemphasis_title_keywords",unselectable:!0})}return d},getPrefix:function(i,d,c){return c.prefix},getTemplates:function(){return this._templates},getTemplateProposals:function(i,d,c){for(var f=[],e=this.getTemplates(),h=0;h<e.length;h++){var j=e[h];j.match(i)&&(j=j.getProposal(i,d,c),this.removePrefix(i,j),f.push(j))}0<f.length&&
(f.sort(function(b,a){return b.name<a.name?-1:b.name>a.name?1:0}),f.splice(0,0,{proposal:"",description:"Templates",style:"noemphasis_title",unselectable:!0}));return f},removePrefix:function(i,d){if(!(d.overwrite=d.proposal.substring(0,i.length)!==i))d.proposal=d.proposal.substring(i.length)},isValid:function(){return!0}};return{Template:k,TemplateContentAssist:m}});
define("orion/editor/linkedMode","i18n!orion/editor/nls/messages orion/keyBinding orion/editor/keyModes orion/editor/annotations orion/editor/templates orion/objects orion/util".split(" "),function(k,m,i,d,c,f){function e(c,b,a){var e=c.getTextView();i.KeyMode.call(this,e);this.editor=c;this.undoStack=b;this.contentAssist=a;this.linkedModeModel=null;e.setAction("linkedModeEnter",function(){this.exitLinkedMode(!0);return!0}.bind(this));e.setAction("linkedModeCancel",function(){this.exitLinkedMode(!1);
return!0}.bind(this));e.setAction("linkedModeNextGroup",function(){var a=this.linkedModeModel;this.selectLinkedGroup((a.selectedGroupIndex+1)%a.groups.length);return!0}.bind(this));e.setAction("linkedModePreviousGroup",function(){var a=this.linkedModeModel;this.selectLinkedGroup(0<a.selectedGroupIndex?a.selectedGroupIndex-1:a.groups.length-1);return!0}.bind(this));this.linkedModeListener={onActivating:function(){this._groupContentAssistProvider&&(this.contentAssist.setProviders([this._groupContentAssistProvider]),
this.contentAssist.setProgress(null))}.bind(this),onModelChanged:function(a){if(!this.ignoreVerify){for(var b=this.editor.mapOffset(a.start),c=this.linkedModeModel,e,d;c;)if(e=this._getPositionChanged(c,b,b+a.removedCharCount),d=e.position,void 0===d||d.model!==c)this.exitLinkedMode(!1),c=this.linkedModeModel;else break;if(c){c=0;a=a.addedCharCount-a.removedCharCount;e=e.positions;for(var g,f=0;f<e.length;++f){g=e[f];d=g.position;var h=d.offset<=b&&b<=d.offset+d.length;h&&!g.ansestor?(d.offset+=c,
d.length+=a,c+=a):(d.offset+=c,g.ansestor&&h&&(d.length+=a));g.escape&&(g.model.escapePosition=d.offset)}this._updateAnnotations(e)}}}.bind(this),onVerify:function(a){if(!this.ignoreVerify){for(var b=this.editor,c=b.mapOffset(a.start),e=this.editor.mapOffset(a.end),d=this.linkedModeModel,g,f;d;)if(g=this._getPositionChanged(d,c,e),f=g.position,void 0===f||f.model!==d)this.exitLinkedMode(!1),d=this.linkedModeModel;else break;if(d){var h=this._compoundChange;h?h.owner.model===d&&h.owner.group===f.group||
(this.endUndo(),this.startUndo()):this.startUndo();d.selectedGroupIndex=f.group;var h=0,j=a.text.length-(e-c);g=g.positions;for(var i,c=c-f.position.offset,k=e-f.position.offset,m=0;m<g.length;++m)i=g[m],e=i.position,i.oldOffset=e.offset,i.model===d&&i.group===f.group?(e.offset+=h,e.length+=j,h+=j):(e.offset+=h,i.ansestor&&(e.length+=f.count*j)),i.escape&&(i.model.escapePosition=e.offset);this.ignoreVerify=!0;for(m=g.length-1;0<=m;m--)i=g[m],i.model===d&&i.group===f.group&&b.setText(a.text,i.oldOffset+
c,i.oldOffset+k);this.ignoreVerify=!1;a.text=null;this._updateAnnotations(g)}}}.bind(this)}}var h={};e.prototype=new i.KeyMode;f.mixin(e.prototype,{createKeyBindings:function(){var c=m.KeyBinding,b=[];b.push({actionID:"linkedModeEnter",keyBinding:new c(13)});b.push({actionID:"linkedModeCancel",keyBinding:new c(27)});b.push({actionID:"linkedModeNextGroup",keyBinding:new c(9)});b.push({actionID:"linkedModePreviousGroup",keyBinding:new c(9,!1,!0)});return b},enterLinkedMode:function(c){if(!this.linkedModeModel){var b=
this.editor.getTextView();b.addKeyMode(this);b.addEventListener("Verify",this.linkedModeListener.onVerify);b.addEventListener("ModelChanged",this.linkedModeListener.onModelChanged);this.contentAssist.addEventListener("Activating",this.linkedModeListener.onActivating);this.editor.reportStatus(k.linkedModeEntered,null,!0)}this._sortedPositions=null;this.linkedModeModel&&(c.previousModel=this.linkedModeModel,c.parentGroup=this.linkedModeModel.selectedGroupIndex,this.linkedModeModel.nextModel=c);this.linkedModeModel=
c;this.selectLinkedGroup(0)},exitLinkedMode:function(c){if(this.isActive()){this._compoundChange&&(this.endUndo(),this._compoundChange=null);this._sortedPositions=null;var b=this.linkedModeModel;this.linkedModeModel=b.previousModel;b.parentGroup=b.previousModel=void 0;this.linkedModeModel&&(this.linkedModeModel.nextModel=void 0);if(!this.linkedModeModel){var a=this.editor,e=a.getTextView();e.removeKeyMode(this);e.removeEventListener("Verify",this.linkedModeListener.onVerify);e.removeEventListener("ModelChanged",
this.linkedModeListener.onModelChanged);e=this.contentAssist;e.removeEventListener("Activating",this.linkedModeListener.onActivating);e.offset=void 0;this.editor.reportStatus(k.linkedModeExited,null,!0);c&&a.setCaretOffset(b.escapePosition,!1)}this.selectLinkedGroup(0)}},startUndo:function(){if(this.undoStack){var c=this,b=this.linkedModeModel;this._compoundChange=this.undoStack.startCompoundChange({model:b,group:b.selectedGroupIndex,end:function(){c._compoundChange=null}})}},endUndo:function(){this.undoStack&&
this.undoStack.endCompoundChange()},isActive:function(){return!!this.linkedModeModel},isStatusActive:function(){return!!this.linkedModeModel},selectLinkedGroup:function(e){var b=this.linkedModeModel;if(b){b.selectedGroupIndex=e;var e=b.groups[e],a=e.positions[0],d=this.editor;d.setSelection(a.offset,a.offset+a.length);if(b=this.contentAssist)b.offset=void 0,e.data&&"link"===e.data.type&&e.data.values?((this._groupContentAssistProvider=new c.TemplateContentAssist(e.data.values)).getPrefix=function(){var b=
d.getSelection();return b.start===b.end&&(b=d.getCaretOffset(),a.offset<=b&&b<=a.offset+a.length)?d.getText(a.offset,b):""},b.offset=a.offset,b.deactivate(),b.activate()):this._groupContentAssistProvider&&(this._groupContentAssistProvider=null,b.deactivate())}this._updateAnnotations()},_getModelPositions:function(c,b,a){for(var e=b.groups,d=0;d<e.length;d++)for(var f=e[d].positions,h=0;h<f.length;h++){var i=f[h];a&&(i={offset:i.offset+a,length:i.length});i={index:h,group:d,count:f.length,model:b,
position:i};c.push(i);b.nextModel&&b.nextModel.parentGroup===d&&(i.ansestor=!0,this._getModelPositions(c,b.nextModel,(a||0)+f[h].offset-f[0].offset))}},_getSortedPositions:function(c){var b=this._sortedPositions;if(!b){for(b=[];c.previousModel;)c=c.previousModel;for(this._getModelPositions(b,c);c;)void 0!==c.escapePosition&&b.push({escape:!0,model:c,position:{offset:c.escapePosition,length:0}}),c=c.nextModel;b.sort(function(a,b){return a.position.offset-b.position.offset});this._sortedPositions=b}return b},
_getPositionChanged:function(c,b,a){for(var e,c=this._getSortedPositions(c),d=c.length-1;0<=d;d--){var f=c[d].position;if(f.offset<=b&&a<=f.offset+f.length){e=c[d];break}}return{position:e,positions:c}},_updateAnnotations:function(c){var b=this.editor.getAnnotationModel();if(b){var a=[],e=[];b.getTextModel();for(var f=b.getAnnotations(),h;f.hasNext();)switch(h=f.next(),h.type){case d.AnnotationType.ANNOTATION_LINKED_GROUP:case d.AnnotationType.ANNOTATION_CURRENT_LINKED_GROUP:case d.AnnotationType.ANNOTATION_SELECTED_LINKED_GROUP:a.push(h)}if(f=
this.linkedModeModel)for(var c=c||this._getSortedPositions(f),i=0;i<c.length;i++)if(h=c[i],h.model===f){var k=d.AnnotationType.ANNOTATION_LINKED_GROUP;h.group===f.selectedGroupIndex&&(k=0===h.index?d.AnnotationType.ANNOTATION_SELECTED_LINKED_GROUP:d.AnnotationType.ANNOTATION_CURRENT_LINKED_GROUP);h=h.position;h=d.AnnotationType.createAnnotation(k,h.offset,h.offset+h.length,"");e.push(h)}b.replaceAnnotations(a,e)}}});h.LinkedMode=e;return h});
define("orion/editor/factories","orion/editor/actions orion/editor/undoStack orion/editor/rulers orion/editor/annotations orion/editor/textDND orion/editor/linkedMode".split(" "),function(k,m,i,d,c,f){function e(){}function h(){}function j(){}function b(){}function a(){}function g(){}var l={};e.prototype={createKeyBindings:function(a,b,c,e){var e=new k.TextActions(a,b,e),d=new f.LinkedMode(a,b,c),a=new k.SourceCodeActions(a,b,c,d);return{textActions:e,linkedMode:d,sourceCodeActions:a}}};l.KeyBindingsFactory=
e;h.prototype={createUndoStack:function(a){a=a.getTextView();return new m.UndoStack(a,200)}};l.UndoFactory=h;j.prototype={createLineNumberRuler:function(a){return new i.LineNumberRuler(a,"left",{styleClass:"ruler lines"},{styleClass:"rulerLines odd"},{styleClass:"rulerLines even"})}};l.LineNumberRulerFactory=j;b.prototype={createFoldingRuler:function(a){return new i.FoldingRuler(a,"left",{styleClass:"ruler folding"})}};l.FoldingRulerFactory=b;a.prototype={createAnnotationModel:function(a){return new d.AnnotationModel(a)},
createAnnotationStyler:function(a,b){return new d.AnnotationStyler(a,b)},createAnnotationRulers:function(a){var b=new i.AnnotationRuler(a,"left",{styleClass:"ruler annotations"}),a=new i.OverviewRuler(a,"right",{styleClass:"ruler overview"});return{annotationRuler:b,overviewRuler:a}}};l.AnnotationFactory=a;g.prototype={createTextDND:function(a,b){return new c.TextDND(a.getTextView(),b)}};l.TextDNDFactory=g;return l});
define("orion/editor/editorFeatures",["orion/editor/factories","orion/editor/actions","orion/editor/linkedMode","orion/objects"],function(k,m,i,d){return d.mixin({},k,m,i)});
define("orion/webui/splitter",["require","orion/EventTarget","orion/webui/littlelib"],function(k,m,i){function d(c){m.attach(this);this._init(c)}d.prototype={_init:function(c){this._tracking=null;this._animationDelay=501;this._closeReversely=c.closeReversely;this.$node=i.node(c.node);if(!this.$node)throw"no dom node for splitter found";this.$sideNode=i.node(c.sidePanel);if(!this.$sideNode)throw"no dom node for side panel found";this.$mainNode=i.node(c.mainPanel);if(!this.$mainNode)throw"no dom node for main panel found";
this._vertical=c.vertical;this._prefix="/orion/splitter/"+(this.$node.id||document.body.id||"");c.toggle&&(this._thumb=document.createElement("div"),this.$node.appendChild(this._thumb),this._thumb.classList.add("splitThumb"),this._thumb.classList.add(this._vertical?"splitVerticalThumbLayout":"splitThumbLayout"));this._closeByDefault="closed"===this.$node.getAttribute("data-initial-state");"undefined"!==typeof c.closeByDefault&&(this._closeByDefault=c.closeByDefault);this._initializeFromStoredSettings();
this._closed?(this._closed=!1,this._thumbDown(!0,!0)):this._adjustToSplitPosition();this.$node.style.visibility="visible";this.$mainNode.style.display="block";this.$sideNode.style.display="block";this.$node.addEventListener("mousedown",this._mouseDown.bind(this),!1);window.addEventListener("mouseup",this._mouseUp.bind(this),!1);window.addEventListener("resize",this._resize.bind(this),!1)},isClosed:function(){return this._closed},toggleSidePanel:function(){this._thumbDown()},openSidePanel:function(){this._closed||
this._thumbDown()},addResizeListener:function(c){this.addEventListener("resize",function(d){c(d.node)})},_initializeFromStoredSettings:function(){var c=localStorage.getItem(this._prefix+"/toggleState");this._closed="string"===typeof c?"closed"===c:this._closeByDefault;var c=i.bounds(this.$node.parentNode),d=i.bounds(this.$node),e;this._vertical?(e=localStorage.getItem(this._prefix+"/yPosition"))?(this._splitTop=parseInt(e,10),this._splitTop>c.top+c.height-d.height&&(this._splitTop=c.top+c.height/
2)):this._closeByDefault&&(this._initialSplit=this._getSplitPosition(),this._splitTop=0):(e=localStorage.getItem(this._prefix+"/xPosition"))?(this._splitLeft=parseInt(e,10),this._splitLeft>c.left+c.width-d.width&&(this._splitLeft=c.left+c.width/2)):this._closeByDefault&&(this._initialSplit=this._getSplitPosition(),this._splitLeft=0)},_getSplitPosition:function(){var c=i.bounds(this.$node),d=i.bounds(this.$node.parentNode);return this.vertical?c.top-d.top:c.left-d.left},_adjustToSplitPosition:function(c){var d=
i.bounds(this.$node),e=i.bounds(this.$node.parentNode);if(this._vertical){this._splitHeight=d.height;if(c||!this._splitTop)this._splitTop=d.top,localStorage.setItem(this._prefix+"/yPosition",this._splitTop);c=this._splitTop;"relative"===this.$node.parentNode.style.position&&(c=this._splitTop-e.top);this.$sideNode.style.height=c+"px";this.$sideNode.style.display="block";this.$node.style.top=c+"px"}else{this._splitWidth=d.width;if(c||!this._splitLeft)this._splitLeft=d.left,localStorage.setItem(this._prefix+
"/xPosition",this._splitLeft);c=this._splitLeft;"relative"===this.$node.parentNode.style.position&&(c=this._splitLeft-e.left);this.$sideNode.style.width=c+"px";this.$sideNode.style.display="block";this.$node.style.left=c+"px"}this._resize()},_resize:function(c,d,e){var c=c||0,h=i.bounds(this.$node.parentNode),j=i.bounds(this.$node);this._vertical?(void 0===e&&(e=j.top-h.top),e+=j.height,this.$mainNode.style.top=e+"px"):(void 0===d&&(d=j.left-h.left),d+=j.width,this.$mainNode.style.left=d+"px");var b=
this;window.setTimeout(function(){b._notifyResizeListeners(b.$mainNode);b._notifyResizeListeners(b.$sideNode)},c)},_notifyResizeListeners:function(c){this.dispatchEvent({type:"resize",node:c})},_notifyToggleListeners:function(){this.dispatchEvent({type:"toggle",closed:this._closed})},_thumbDown:function(c,d){c||this._addAnimation();var e=this._splitTop,h=this._splitLeft;if(this._closed)this._closed=!1,!this._splitLeft&&(!this._splitTop&&"number"===typeof this._initialSplit)&&(e=h=this._initialSplit);
else if(this._closed=!0,this._closeReversely){var j=i.bounds(this.$node.parentNode),b=i.bounds(this.$node);this._vertical?e=j.height-b.height:h=j.width-b.width}else e=h=0;this._vertical?(this.$sideNode.style.height=e+"px",this.$node.style.top=e+"px"):(this.$sideNode.style.width=h+"px",this.$node.style.left=h+"px");this._resize(this._animationDelay,h,e);c||this._removeAnimation();d||localStorage.setItem(this._prefix+"/toggleState",this._closed?"closed":null);var a=this;window.setTimeout(function(){a._notifyToggleListeners()},
this._animationDelay)},_removeAnimation:function(){var c=this;window.setTimeout(function(){c.$sideNode.classList.remove(c._vertical?"sidePanelVerticalLayoutAnimation":"sidePanelLayoutAnimation");c.$mainNode.classList.remove(c._vertical?"mainPanelVerticalLayoutAnimation":"mainPanelLayoutAnimation");c.$node.classList.remove(c._vertical?"splitVerticalLayoutAnimation":"splitLayoutAnimation")},this._animationDelay)},_addAnimation:function(){this.$sideNode.classList.add(this._vertical?"sidePanelVerticalLayoutAnimation":
"sidePanelLayoutAnimation");this.$mainNode.classList.add(this._vertical?"mainPanelVerticalLayoutAnimation":"mainPanelLayoutAnimation");this.$node.classList.add(this._vertical?"splitVerticalLayoutAnimation":"splitLayoutAnimation")},_mouseDown:function(c){if(c.target===this._thumb)return i.stop(c),this._thumbDown();this._tracking||(this.$node.classList.add("splitTracking"),this.$mainNode.classList.add("panelTracking"),this.$sideNode.classList.add("panelTracking"),this._tracking=this._mouseMove.bind(this),
window.addEventListener("mousemove",this._tracking),i.setFramesEnabled(!1),i.stop(c))},_mouseMove:function(c){if(this._tracking){var d=i.bounds(this.$node.parentNode);if(this._vertical){this._splitTop=c.clientY;this._splitTop<d.top+5?this._splitTop=d.top+5:this._splitTop>d.top+d.height-5&&(this._splitTop=d.top+d.height-5);var e=this._splitTop,e=this._splitTop-d.top;this.$node.style.top=e+"px"}else this._splitLeft=c.clientX,this._splitLeft<d.left+5?this._splitLeft=d.left+5:this._splitLeft>d.left+d.width-
5&&(this._splitLeft=d.left+d.width-5),e=this._splitLeft,e=this._splitLeft-2*d.left,this.$node.style.left=e+"px";this._adjustToSplitPosition(!0);i.stop(c)}},_mouseUp:function(c){this._tracking&&(i.setFramesEnabled(!0),window.removeEventListener("mousemove",this._tracking),this._tracking=null,this.$node.classList.remove("splitTracking"),this.$mainNode.classList.remove("panelTracking"),this.$sideNode.classList.remove("panelTracking"),i.stop(c))}};d.prototype.constructor=d;return{Splitter:d}});
define("text!orion/compare/sideBySideTemplate.html",[],function(){return'<div id="topWidget_id" style="height:100%;width:100%;position:relative">\r\n\t<div class="leftPanelLayout ">\r\n\t\t<div class="titleActionContainer">\r\n\t\t\t<div class="compareActionContainer" id="left_action_id"></div>\r\n\t\t\t<div class="titleContainer" id="left_title_id"></div>\r\n\t\t</div>\r\n\t\t<div class="compareEditorParent" id="left_editor_id"></div>\r\n\t\t<div class="statusContainer" id="left_status_id"></div>\r\n\t</div>\r\n\t<div class="split compareSplitLayout"></div>\r\n\t<div class="rightPanelLayout">\r\n\t\t<div class="titleActionContainer">\r\n\t\t\t<div class="compareActionContainer" id="right_action_id"></div>\r\n\t\t\t<div class="titleContainer" id="right_title_id"></div>\r\n\t\t</div>\r\n\t\t<div class="compareEditorParent"  id="right_editor_wrapper_id">\r\n\t\t\t<div class="canvasContainer">\r\n\t\t\t\t<canvas id="diff_canvas_id" class="compareCanvas" width="46" height="3000"></canvas>\r\n\t\t\t</div>\r\n\t\t\t<div class="compareEditorParentWithCanvas" id="right_editor_id"></div>\r\n\t\t</div>\r\n\t\t<div class="statusContainer" id="right_status_id"></div>\r\n\t</div>\r\n</div>'});
define("orion/compare/compareUIFactory",["orion/webui/littlelib","orion/webui/splitter","text!orion/compare/sideBySideTemplate.html"],function(k,m,i){var d=d||{},c=function(c){this._parentDivID=c.parentDivID;this._commandSpanId=c.commandSpanId;this._showTitle=c.showTitle;this._leftTitle=c.leftTitle;this._rightTitle=c.rightTitle;this._showLineStatus=c.showLineStatus};c.prototype={_init:function(){var c=this._parentDivID+"_";this._topWidgetDiv=k.node("topWidget_id");this._topWidgetDiv.id=c+"topWidget_id";
this._leftEditorParentDiv=k.node("left_editor_id");this._leftEditorParentDiv.id=c+"left_editor_id";this._rightEditorParentDiv=k.node("right_editor_id");this._rightEditorParentDiv.id=c+"right_editor_id";this._rightEditorWrapperDiv=k.node("right_editor_wrapper_id");this._rightEditorWrapperDiv.id=c+"right_editor_wrapper_id";this._leftActionDiv=k.node("left_action_id");this._leftActionDiv.id=c+"left_action_id";this._rightActionDiv=k.node("right_action_id");this._rightActionDiv.id=c+"right_action_id";
this._leftTitleDiv=k.node("left_title_id");this._leftTitleDiv.id=c+"left_title_id";this._rightTitleDiv=k.node("right_title_id");this._rightTitleDiv.id=c+"right_title_id";this._leftStatusDiv=k.node("left_status_id");this._leftStatusDiv.id=c+"left_status_id";this._rightStatusDiv=k.node("right_status_id");this._rightStatusDiv.id=c+"right_status_id";this._diffCanvasDiv=k.node("diff_canvas_id");this._diffCanvasDiv.id=c+"diff_canvas_id";this._splitterId=c+"orion_splitter";this._showTitle||this.disableTitle();
this._showLineStatus||this.disableLineStatus()},_createSplitter:function(){var c=k.$(".split",this._topWidgetDiv);c.id=this._splitterId;var e=k.$(".leftPanelLayout",this._topWidgetDiv),d=k.$(".rightPanelLayout",this._topWidgetDiv);c&&(e&&d)&&(this._splitter=new m.Splitter({node:c,sidePanel:e,mainPanel:d}))},buildUI:function(){k.node(this._parentDivID).innerHTML=i;this._init();this._createSplitter()},destroy:function(){},getSplitter:function(){return this._splitter},isLeftPane:function(c){return k.$(".leftPanelLayout",
this._topWidgetDiv)===c},getEditorParentDiv:function(c){return c?this._leftEditorParentDiv:this._rightEditorParentDiv},getTitleDiv:function(c){return c?this._leftTitleDiv:this._rightTitleDiv},getActionDivId:function(c){return c?this._leftActionDiv.id:this._rightActionDiv.id},getStatusDiv:function(c){return c?this._leftStatusDiv:this._rightStatusDiv},getCommandSpanId:function(){return this._commandSpanId},getDiffCanvasDiv:function(){return this._diffCanvasDiv},disableTitle:function(){this._leftEditorParentDiv.style.top=
"0px";this._rightEditorWrapperDiv.style.top="0px";this._leftTitleDiv.style.height="0px";this._rightTitleDiv.style.height="0px"},disableLineStatus:function(){this._leftEditorParentDiv.style.marginBottom="0px";this._rightEditorWrapperDiv.style.marginBottom="0px";this._leftStatusDiv.style.height="0px";this._rightStatusDiv.style.height="0px"}};d.TwoWayCompareUIFactory=c;return d});
var JsDiff=function(){function k(c){for(var e=[],b=0;b<c.length;b++)c[b]&&e.push(c[b]);return e}function m(c){c=c.replace(/&/g,"&amp;");c=c.replace(/</g,"&lt;");c=c.replace(/>/g,"&gt;");return c=c.replace(/"/g,"&quot;")}var i=function(c){this.ignoreWhitespace=c};i.prototype={diff:function(c,e){if(e==c)return[{value:e}];if(!e)return[{value:c,removed:!0}];if(!c)return[{value:e,added:!0}];var e=this.tokenize(e),c=this.tokenize(c),b=e.length,a=c.length,d=b+a,f=[{newPos:-1,components:[]}],i=this.extractCommon(f[0],
e,c,0);if(f[0].newPos+1>=b&&i+1>=a)return f[0].components;for(var k=1;k<=d;k++)for(var m=-1*k;m<=k;m+=2){var w;w=f[m-1];var t=f[m+1],i=(t?t.newPos:0)-m;w&&(f[m-1]=void 0);var x=w&&w.newPos+1<b,y=t&&0<=i&&i<a;if(!x&&!y)f[m]=void 0;else{!x||y&&w.newPos<t.newPos?(w={newPos:t.newPos,components:t.components.slice(0)},this.pushComponent(w.components,c[i],void 0,!0)):(w={newPos:w.newPos,components:w.components.slice(0)},w.newPos++,this.pushComponent(w.components,e[w.newPos],!0,void 0));i=this.extractCommon(w,
e,c,m);if(w.newPos+1>=b&&i+1>=a)return w.components;f[m]=w}}},pushComponent:function(c,e,b,a){var d=c[c.length-1];d&&d.added===b&&d.removed===a?c[c.length-1]={value:this.join(d.value,e),added:b,removed:a}:c.push({value:e,added:b,removed:a})},extractCommon:function(c,e,b,a){for(var d=e.length,f=b.length,i=c.newPos,a=i-a;i+1<d&&a+1<f&&this.equals(e[i+1],b[a+1]);)i++,a++,this.pushComponent(c.components,e[i],void 0,void 0);c.newPos=i;return a},equals:function(c,e){var b=/\S/;return this.ignoreWhitespace&&
!b.test(c)&&!b.test(e)?!0:c==e},join:function(c,e){return c+e},tokenize:function(c){return c}};var d=new i,c=new i(!1);c.tokenize=function(c){return k(c.split(/(\s+|\b)/))};var f=new i(!0);f.tokenize=function(c){return k(c.split(/([{}:;,]|\s+)/))};var e=new i;e.tokenize=function(c){return c.split(/^/m)};return{diffChars:function(c,e){return d.diff(c,e)},diffWords:function(e,d){return c.diff(e,d)},diffLines:function(c,d){return e.diff(c,d)},diffCss:function(c,e){return f.diff(c,e)},createPatch:function(c,
d,b,a,g){var f=[];f.push("Index: "+c);f.push("===================================================================");f.push("--- "+c+"\t"+a);f.push("+++ "+c+"\t"+g);c=e.diff(d,b);c.push({value:"",lines:[]});for(var b=d=0,a=[],i=g=1,k=0;k<c.length;k++){var m=c[k],w=m.lines||m.value.replace(/\n$/,"").split("\n");m.lines=w;if(m.added||m.removed){if(!d){var t=c[k-1],d=g,b=i;t&&(a.push.apply(a,t.lines.slice(-4).map(function(a){return" "+a})),d-=4,b-=4)}a.push.apply(a,w.map(function(a){return(m.added?"+":
"-")+a}));m.added?i+=w.length:g+=w.length}else d&&(8>=w.length&&k<c.length-1?a.push.apply(a,w.map(function(a){return" "+a})):(t=Math.min(w.length,4),f.push("@@ -"+d+","+(g-d+t)+" +"+b+","+(i-b+t)+" @@"),f.push.apply(f,a),f.push.apply(f,w.slice(0,t).map(function(a){return" "+a})),b=d=0,a=[])),g+=w.length,i+=w.length}1<c.length&&!/\n$/.test(c[c.length-2].value)&&f.push("\\ No newline at end of file\n");return f.join("\n")},convertChangesToXML:function(c){for(var e=[],b=0;b<c.length;b++){var a=c[b];
a.added?e.push("<ins>"):a.removed&&e.push("<del>");e.push(m(a.value));a.added?e.push("</ins>"):a.removed&&e.push("</del>")}return e.join("")}}}();"undefined"!==typeof module&&(module.exports=JsDiff);"function"===typeof define&&define.amd&&define("jsdiff/diff",[],function(){return JsDiff});
define("orion/compare/jsdiffAdapter",["jsdiff/diff"],function(k){var m=m||{},i=function(){};i.prototype={_specialLine:function(d,c,f){return c.value===d&&f!==d},adapt:function(d,c,f){f||(f="\n");for(var e=d.split(f),h=c.split(f),j=""===e[e.length-1],h=""===h[h.length-1],b=k.diffLines(d,c),d=[],c=[],a=0,g=0,i=-1,m=0,q=!0,r=f,w=0;w<b.length;w++){var t=b[w],x=t.lines||t.value.split(f),y=x.length,u=0;1<x.length&&""===x[x.length-1]&&y--;1<y&&!q&&""===x[0]&&(y--,u++);t.lines=x;if(!t.added&&!t.removed){if(!this._specialLine(f,
t,r)){if(a||g)d.push([a,g,i]),g=a=0,i=-1,m+=g;d.push([y,y,0]);m+=y}}else if(t.added){-1===i&&(i=c.length+1);a+=y;for(q=u;q<y+u;q++)c.push(t.lines[q])}else g+=y;q=!1;1<x.length&&""===x[x.length-1]&&(q=!0);r=t.value?t.value[t.value.length-1]:f}if(a||g)d.push([a,g,i]),m+=g;m<e.length&&1<e.length&&(f=d[d.length-1],0===f[2]?(f[0]+=1,f[1]+=1):-1===f[2]?d.push([1,1,0]):j===h?d.push([1,1,0]):(h&&(f[0]+=1),j&&(f[1]+=1)));return{mapper:d,changContents:{array:c,index:0}}},adaptCharDiff:function(d,c,f){for(var d=
f?k.diffWords(d,c):k.diffChars(d,c),c=[],e=f=0,h=0,i=0,b=0;b<d.length;b++){var a=d[b];if(!a.added&&!a.removed){if(0<h||0<i)c.push([e,e+h,f,f+i]),e+=h,f+=i,i=h=0;e+=a.value.length;f+=a.value.length}else a.added?h+=a.value.length:i+=a.value.length}(0<h||0<i)&&c.push([e,e+h,f,f+i]);return c}};m.JSDiffAdapter=i;return m});
define("orion/treeModelIterator",[],function(){var k={},m=function(i,d){this.firstLevelChildren=i;this.reset();this._init(d)};m.prototype={_init:function(i){i&&(this.isExpanded=i.isExpanded,this.isExpandable=i.isExpandable,this.forceExpandFunc=i.forceExpandFunc,this.getChildrenFunc=i.getChildrenFunc)},topLevel:function(i){return i.parent?i.parent===this.root:!0},_getChildren:function(i){return"function"===typeof this.getChildrenFunc?this.getChildrenFunc(i):i?i.children:null},_expanded:function(i){if(!i)return!0;
var d=this._getChildren(i),d=d&&0<d.length;this.isExpanded&&d&&(d=this.isExpanded(i));return d},_expandable:function(i){return!i?!0:this.isExpandable?this.isExpandable(i):!1},_diveIn:function(i){return this._expanded(i)?(i=this._getChildren(i),this.setCursor(i[0]),this.cursor()):null},_drillToLast:function(i){return this._expanded(i)?(i=this._getChildren(i),this._drillToLast(i[i.length-1])):i},_forward:function(i){if(!this._cursor)return null;var d=this._diveIn(this._cursor);if(!d){if(i&&this._expandable(this._cursor)&&
this.forceExpandFunc){var c=this;return this.forceExpandFunc(this._cursor,"first",function(d){d&&c.setCursor(d)})}(d=this._findSibling(this._cursor,!0))&&this.setCursor(d)}return d},_backward:function(i){if(!this._cursor)return null;var d=this._findSibling(this._cursor,!1);d&&d!==this._cursor.parent&&(d=this._drillToLast(d));if(i&&d&&this._expandable(d)&&this.forceExpandFunc&&d!==this._cursor.parent){var c=this;return this.forceExpandFunc(d,"last",function(d){d&&c.setCursor(d)})}d&&this.setCursor(d);
return d},_findSibling:function(i,d){for(var c=this.topLevel(i),f=this._getChildren(i.parent),f=c?this.firstLevelChildren:f,e=0;e<f.length;e++)if(f[e]===i)return 0===e&&!d?c?null:i.parent:e===f.length-1&&d?c?null:this._findSibling(i.parent,d):d?f[e+1]:f[e-1];return null},_inParentChain:function(i,d){for(var c=i.parent;c;){if(c===d)return!0;c=c.parent}return!1},_getTopLevelParent:function(i){if(this.topLevel(i))return i;for(i=i.parent;i;){if(this.topLevel(i))return i;i=i.parent}return null},_onCollapse:function(i){return this._expanded(i.parent)?
i:this._onCollapse(i.parent)},_scan:function(i,d,c){this.setCursor(d);var f=[];for(f.push(d);;){if(this.iterate(i))f.push(this.cursor());else break;if(c===this.cursor())return f}return null},setCursor:function(i){this._prevCursor=this._cursor;this._cursor=i},setTree:function(i){this.firstLevelChildren=i;0<this.firstLevelChildren.length&&(this.root=this.firstLevelChildren[0].parent)},scan:function(i,d){var c=this.cursor(),f=this._scan(!0,i,d);f||(f=this._scan(!1,i,d));this.setCursor(c);return f},iterate:function(i,
d){return i?this._forward(d):this._backward(d)},iterateOnTop:function(i,d){var c=this._findSibling(this._getTopLevelParent(this.cursor()),i);c?this.setCursor(c):d&&0<this.firstLevelChildren.length&&this.setCursor(i?this.firstLevelChildren[0]:this.firstLevelChildren[this.firstLevelChildren.length-1])},collapse:function(i){return!this._cursor?null:this._inParentChain(this._cursor,i)?(this.setCursor(i),this._cursor):null},reset:function(){this.root=this._prevCursor=this._cursor=null;0<this.firstLevelChildren.length&&
(this._cursor=this.firstLevelChildren[0],this.root=this.firstLevelChildren[0].parent)},cursorMoved:function(){return this._cursor!==this._prevCursor},cursor:function(){return this._cursor},prevCursor:function(){return this._prevCursor}};k.TreeModelIterator=m;return k});
define("orion/compare/diffTreeNavigator",["orion/treeModelIterator","orion/compare/compareUtils","orion/editor/annotations","orion/compare/jsdiffAdapter"],function(k,m,i,d){var c={},f=function(c,d,f,b,a,g){this._root={type:"root",children:[]};this._initialized=!1;this.initAll(c,d,f,b,a,g)};i.AnnotationType.registerType("orion.annotation.diff.addedBlock",{title:"",html:"",lineStyle:{styleClass:"annotationLine addedBlockDiff"}});i.AnnotationType.registerType("orion.annotation.diff.currentAddedBlock",
{title:"",html:"",lineStyle:{styleClass:"annotationLine currentAddedBlockDiff"}});i.AnnotationType.registerType("orion.annotation.diff.deletedBlock",{title:"",html:"",lineStyle:{styleClass:"annotationLine deletedBlockDiff"}});i.AnnotationType.registerType("orion.annotation.diff.currentDeletedBlock",{title:"",html:"",lineStyle:{styleClass:"annotationLine currentDeletedBlockDiff"}});i.AnnotationType.registerType("orion.annotation.diff.blockTop",{title:"",html:"",lineStyle:{styleClass:"annotationLine blockDiffTopOnly"}});
i.AnnotationType.registerType("orion.annotation.diff.currentBlockTop",{title:"",html:"",lineStyle:{styleClass:"annotationLine currentBlockDiffTopOnly"}});i.AnnotationType.registerType("orion.annotation.diff.blockConflict",{title:"",html:"",lineStyle:{styleClass:"annotationLine blockDiffConflict"}});i.AnnotationType.registerType("orion.annotation.diff.currentBlockConflict",{title:"",html:"",lineStyle:{styleClass:"annotationLine currentBlockDiffConflict"}});i.AnnotationType.registerType("orion.annotation.diff.addedWord",
{title:"word added",html:"",rangeStyle:{styleClass:"annotationRange addedWordDiff"}});i.AnnotationType.registerType("orion.annotation.diff.currentAddedWord",{title:"",html:"",rangeStyle:{styleClass:"annotationRange currentAddedWordDiff"}});i.AnnotationType.registerType("orion.annotation.diff.deletedWord",{title:"word deleted",html:"",rangeStyle:{styleClass:"annotationRange deletedWordDiff"}});i.AnnotationType.registerType("orion.annotation.diff.currentDeletedWord",{title:"",html:"",rangeStyle:{styleClass:"annotationRange currentDeletedWordDiff"}});
i.AnnotationType.registerType("orion.annotation.diff.emptyDeletedWordLeft",{title:"",html:"",rangeStyle:{styleClass:"annotationRange emptyDeletedWordDiffLeft"}});i.AnnotationType.registerType("orion.annotation.diff.emptyDeletedWordRight",{title:"",html:"",rangeStyle:{styleClass:"annotationRange emptyDeletedWordDiffRight"}});i.AnnotationType.registerType("orion.annotation.diff.emptyAddedWordLeft",{title:"",html:"",rangeStyle:{styleClass:"annotationRange emptyAddedWordDiffLeft"}});i.AnnotationType.registerType("orion.annotation.diff.emptyAddedWordRight",
{title:"",html:"",rangeStyle:{styleClass:"annotationRange emptyAddedWordDiffRight"}});f.prototype={initAll:function(c,d,f,b,a,g,i){this._charOrWordDiff=c?c:"word";d&&(this._initialized=!0);this.editorWrapper=[{editor:d,diffFeeder:b},{editor:f,diffFeeder:a}];this._curveRuler=i;(this._overviewRuler=g)&&this._overviewRuler.setDiffNavigator(this)},initMapper:function(c){if(c)for(var d=0;d<this.editorWrapper.length;d++)this.editorWrapper[d].diffFeeder.init(this.editorWrapper[d].editor.getTextView().getModel(),
c)},destroy:function(){this.initAll(this._charOrWordDiff)},renderAnnotations:function(){var c;for(c=0;c<this.editorWrapper.length;c++){this.editorWrapper[c].annoTypes=[];this.editorWrapper[c].diffFeeder.getBlockAnnoTypes(this.editorWrapper[c].annoTypes);this.editorWrapper[c].diffFeeder.getWordAnnoTypes(this.editorWrapper[c].annoTypes);for(var f=0;f<this.editorWrapper[c].annoTypes.length;f++)this.editorWrapper[c].annoTypes[f].current&&this.editorWrapper[c].editor.getAnnotationStyler().addAnnotationType(this.editorWrapper[c].annoTypes[f].current),
this.editorWrapper[c].annoTypes[f].normal&&this.editorWrapper[c].editor.getAnnotationStyler().addAnnotationType(this.editorWrapper[c].annoTypes[f].normal)}this._root.children=[];f=this.editorWrapper[0].diffFeeder.getDiffBlocks();if(!f||0===f.length)this.replaceAllAnnotations(!0,0,"block",!1,[]),this.replaceAllAnnotations(!0,1,"block",!1,[]),this.replaceAllAnnotations(!0,0,"word",!1,[]),this.replaceAllAnnotations(!0,1,"word",!1,[]),this.replaceAllAnnotations(!0,0,"block",!0,[]),this.replaceAllAnnotations(!0,
1,"block",!0,[]),this.replaceAllAnnotations(!0,0,"word",!0,[]),this.replaceAllAnnotations(!0,1,"word",!0,[]);else{var i=new d.JSDiffAdapter;for(c=0;c<f.length;c++){var b=this.generatePairBlockAnnotations(this._root,c);this._root.children.push(b);var a=this.generatePairWordAnnotations(b,c,i);a&&(b.children=a)}this.replaceAllAnnotations(!1,0,"block",!0);this.replaceAllAnnotations(!1,1,"block",!0);this.replaceAllAnnotations(!1,0,"word",!0);this.replaceAllAnnotations(!1,1,"word",!0);this.iterator=new k.TreeModelIterator(this._root.children)}},
replaceAllAnnotations:function(c,d,f,b,a){if(this.editorWrapper[d].annoTypes)for(var g=0;g<this.editorWrapper[d].annoTypes.length;g++)this.editorWrapper[d].annoTypes[g].type===f&&this.replaceDiffAnnotations(this.editorWrapper[d].editor,a?a:this.editorWrapper[d].annoTypes[g].list,b?this.editorWrapper[d].annoTypes[g].normal:this.editorWrapper[d].annoTypes[g].current,c)},getMapper:function(){return this.editorWrapper[0].diffFeeder.getMapper()},getFeeder:function(c){return c?this.editorWrapper[1].diffFeeder:
this.editorWrapper[0].diffFeeder},iterateOnBlock:function(c,d){this.iterator&&(this.iterator.iterateOnTop(c,d),this.updateCurrentAnnotation(!0))},iterateOnChange:function(c){if(!this.iterator)return null;var d=this.iterator.iterate(c);if(d){var f=this.iterator.cursor();"block"===f.type&&(f.children&&0<f.children.length)&&this.iterator.iterate(c);this.updateCurrentAnnotation(!0)}return d},gotoBlock:function(c,d){if(this.iterator){if(0>c||c>=this._root.children.length||0===this._root.children.length)c=
0;void 0!==d&&0<=d&&this._root.children[c].children&&d<this._root.children[c].children.length?this.iterator.setCursor(this._root.children[c].children[d]):this.iterator.setCursor(this._root.children[c]);this.updateCurrentAnnotation(!1);this._positionDiffBlock()}},_hitDiffAnnotation:function(c,d,f){if(f===this.editorWrapper[c].editor.getTextView()){for(var b=0;b<this._root.children.length;b++){var f=this._root.children[b],a=0===c?f.oldA:f.newA;if(d>=a.start&&d<=a.end){b=f;if(f.children&&0<f.children.length)for(a=
0;a<f.children.length;a++){var g=f.children[a],i=0===c?g.oldA:g.newA;if(d>=i.start&&d<=i.end){b=g;break}}return b}}return null}},gotoChange:function(c,d){for(var f=0;f<this.editorWrapper.length;f++){var b=this._hitDiffAnnotation(f,c,d);if(b)return this.iterator.setCursor(b),this.updateCurrentAnnotation(!1,d),!0}return!1},getCurrentBlockIndex:function(){if(!this.iterator)return-1;var c=this.iterator.cursor();return!c?-1:"block"===c.type?c.index:c.parent.index},getCurrentPosition:function(){if(!this.iterator)return{};
var c=this.iterator.cursor();return"block"===c.type?{block:c.index+1}:{block:c.parent.index+1,change:c.index+1}},getCurrentMapperIndex:function(){var c=this.getCurrentBlockIndex();0>c&&(c=0);var d=this.getFeeder().getDiffBlocks();if(!d||0===d.length)return-1;c>d.length-1&&(c=0);return d[c][1]},replaceDiffAnnotations:function(c,d,f,b){if(d&&f&&(c=c.getAnnotationModel())){for(var a=c.getAnnotations(),g=[];b&&a.hasNext();){var i=a.next();i.type===f&&g.push(i)}c.replaceAnnotations(g,d)}},updateCurrentAnnotation:function(c,
d){this.replaceAllAnnotations(!0,0,"block",!1,[]);this.replaceAllAnnotations(!0,1,"block",!1,[]);this.replaceAllAnnotations(!0,0,"word",!1,[]);this.replaceAllAnnotations(!0,1,"word",!1,[]);if(this.iterator){var f=this.iterator.cursor();if(f){var b,a,g={start:f.oldA.start,end:f.oldA.end},l={start:f.newA.start,end:f.newA.end};"word"===f.type?(b=this.editorWrapper[0].diffFeeder.getCurrentWordAnnoType(g,this.editorWrapper[0].editor.getTextView().getModel()),a=this.editorWrapper[1].diffFeeder.getCurrentWordAnnoType(l,
this.editorWrapper[1].editor.getTextView().getModel())):(b=this.editorWrapper[0].diffFeeder.getCurrentBlockAnnoType(f.index),a=this.editorWrapper[1].diffFeeder.getCurrentBlockAnnoType(f.index));b&&this.replaceDiffAnnotations(this.editorWrapper[0].editor,[new (i.AnnotationType.getType(b.current))(g.start,g.end)],b,!0);a&&this.replaceDiffAnnotations(this.editorWrapper[1].editor,[new (i.AnnotationType.getType(a.current))(l.start,l.end)],a,!0);c?(this.autoSelecting=!0,this.editorWrapper[0].editor.setSelection(f.oldA.start,
f.oldA.end,!0),this.editorWrapper[1].editor.setSelection(f.newA.start,f.newA.end,!0),this.autoSelecting=!1):d&&(this.autoSelecting=!0,d!==this.editorWrapper[0].editor.getTextView()&&this.editorWrapper[0].editor.setSelection(f.oldA.start,f.oldA.end,!0),d!==this.editorWrapper[1].editor.getTextView()&&this.editorWrapper[1].editor.setSelection(f.newA.start,f.newA.end,!0),this.autoSelecting=!1)}}},generatePairBlockAnnotations:function(c,d){var f=this.generateBlockDiffAnnotations(0,d),b=this.generateBlockDiffAnnotations(1,
d);return{parent:c,index:d,type:"block",oldA:f,newA:b}},generatePairWordAnnotations:function(c,d,f){var b=this.editorWrapper[0].diffFeeder.getTextOnBlock(d),a=this.editorWrapper[1].diffFeeder.getTextOnBlock(d),d=null,g=0,i=0;if(b&&a&&b.text&&a.text&&5E3>=b.text.length&&5E3>=a.text.length)d=f.adaptCharDiff(b.text,a.text,"word"===this._charOrWordDiff),i=a.start,g=b.start;else return null;f=[];b=[];this.generateWordDiffAnnotations(0,f,g,d,2,3);this.generateWordDiffAnnotations(1,b,i,d,0,1);d=[];for(g=
0;g<f.length;g++)d.push({parent:c,index:g,type:"word",oldA:f[g],newA:b[g]});return d},getAnnoModelList:function(c,d,f){for(var b=0;b<this.editorWrapper[c].annoTypes.length;b++)if(this.editorWrapper[c].annoTypes[b].type===d&&this.editorWrapper[c].annoTypes[b].normal===f)return this.editorWrapper[c].annoTypes[b].list;return null},generateBlockDiffAnnotations:function(c,d){var f=this.editorWrapper[c].diffFeeder.getCurrentBlockAnnoType(d),b=this.getAnnoModelList(c,"block",f.normal),a=this.editorWrapper[c].diffFeeder.getCharRange(d),
f=i.AnnotationType.createAnnotation(f.normal,a.start,a.end);b&&b.push(f);return f},generateWordDiffAnnotations:function(c,d,f,b,a,g){if(b)for(var l=this.editorWrapper[c].diffFeeder.getCurrentWordAnnoType({start:-1,end:-1}),c=this.getAnnoModelList(c,"word",l.normal),k=0;k<b.length;k++){var m=i.AnnotationType.createAnnotation(l.normal,b[k][a]+f,b[k][g]+f);c.push(m);d.push(m)}},_updateOverviewRuler:function(){if(this._overviewRuler){var c=this.editorWrapper[0].editor.getTextView().getTopIndex();this.editorWrapper[0].editor.getTextView().redrawLines(c,
c+1,this._overviewRuler)}},_updateCurveRuler:function(){this._curveRuler&&this._curveRuler.render()},_setTextViewPosition:function(c,d){var f=c.getLineHeight(),b=c.getClientArea(),f=Math.floor(b.height/f/3);c.setTopIndex(0<d-f?d-f:0)},_positionDiffBlock:function(){var c=this.getCurrentBlockIndex();0>c&&(c=0);var d=this.getFeeder().getDiffBlocks();0!==d.length&&(this._setTextViewPosition(this.editorWrapper[0].editor.getTextView(),d[c][0]),this.editorWrapper[0].editor!==this.editorWrapper[1].editor&&
(c=m.lookUpLineIndex(this.getMapper(),0,d[c][1]),this._setTextViewPosition(this.editorWrapper[1].editor.getTextView(),c)),this._updateOverviewRuler(),this._updateCurveRuler())},matchPositionFromOverview:function(c){this._initialized&&(c=0>c?0:m.getAnnotationIndex(this.getFeeder().getDiffBlocks(),c),this.gotoBlock(c))},gotoDiff:function(c,d){this.gotoChange(c,d)&&(this._updateOverviewRuler(),this._updateCurveRuler())},nextDiff:function(){this.iterateOnBlock(!0,!0);this._positionDiffBlock()},prevDiff:function(){this.iterateOnBlock(!1,
!0);this._positionDiffBlock()},nextChange:function(){var c=this.iterateOnChange(!0);this._positionDiffBlock();return c},prevChange:function(){this.iterateOnChange(!1);this._positionDiffBlock()}};c.DiffTreeNavigator=f;f=function(){};f.prototype={_isAddedSide:function(){return 0===this._mapperColumnIndex},getWordAnnoTypes:function(c){this._isAddedSide()?c.push({type:"word",current:"orion.annotation.diff.currentAddedWord",normal:"orion.annotation.diff.addedWord",list:[]}):c.push({type:"word",current:"orion.annotation.diff.currentDeletedWord",
normal:"orion.annotation.diff.deletedWord",list:[]});c.push({type:"word",current:"orion.annotation.diff.emptyDeletedWordLeft"});c.push({type:"word",current:"orion.annotation.diff.emptyDeletedWordRight"});c.push({type:"word",current:"orion.annotation.diff.emptyAddedWordLeft"});c.push({type:"word",current:"orion.annotation.diff.emptyAddedWordRight"})},getCurrentWordAnnoType:function(c,d){return c.start===c.end&&d?this._isAddedSide()?{current:this._repositionEmptyWord(c,d),normal:"orion.annotation.diff.addedWord"}:
{current:this._repositionEmptyWord(c,d),normal:"orion.annotation.diff.deletedWord"}:this._isAddedSide()?{current:"orion.annotation.diff.currentAddedWord",normal:"orion.annotation.diff.addedWord"}:{current:"orion.annotation.diff.currentDeletedWord",normal:"orion.annotation.diff.deletedWord"}},_repositionEmptyWord:function(c,d){var f=d.getLineAtOffset(c.start),b=d.getLineStart(f),a=d.getLineEnd(f);if(b!==a){if(c.start===a)return c.start--,this._isAddedSide()?"orion.annotation.diff.emptyAddedWordRight":
"orion.annotation.diff.emptyDeletedWordRight";c.end++}else if(0<f&&(f--,b=d.getLineStart(f),a=d.getLineEnd(f),b!==a))return c.start=a-1,c.end=a,this._isAddedSide()?"orion.annotation.diff.emptyAddedWordRight":"orion.annotation.diff.emptyDeletedWordRight";return this._isAddedSide()?"orion.annotation.diff.emptyAddedWordLeft":"orion.annotation.diff.emptyDeletedWordLeft"},getMapper:function(){return this._mapper},getDiffBlocks:function(){return this._diffBlocks},getDiffBlockH:function(c){if(!this._diffBlocks||
0===this._diffBlocks.length)return-1;c=this._diffBlocks[c][1];return-1===c?0:this._mapper[c][this._mapperColumnIndex]},getOverviewLineCount:function(){return this._textModel.getLineCount()},getLineNumber:function(c){return c},getCharRange:function(c){if(!this._diffBlocks||0===this._diffBlocks.length)return null;var d=this._diffBlocks[c][0],f=d+this._mapper[this._diffBlocks[c][1]][this._mapperColumnIndex]-1,c=this._textModel.getLineStart(d);if(f<d)return{start:c,end:c};d=this._textModel.getLineEnd(f,
!0);return{start:c,end:d}},getTextOnBlock:function(c){if(!this._diffBlocks||0===this._diffBlocks.length)return null;c=this.getCharRange(c);return{start:c.start,text:this._textModel.getText(c.start,c.end)}},isMapperEmpty:function(){return 0===this._mapper.length}};c.DiffBlockFeeder=f;f=function(c,d,f,b){this._mapperColumnIndex=f;this._reverseAnnotation=b;this.init(c,d)};f.prototype=new c.DiffBlockFeeder;f.prototype._isAddedSide=function(){return this._reverseAnnotation?0!==this._mapperColumnIndex:
0===this._mapperColumnIndex};f.prototype.init=function(c,d){this._textModel=c;this._diffBlocks=void 0;if(d){this._mapper=d;this._diffBlocks=[];for(var f=0,b=0;b<this._mapper.length;b++)0!==this._mapper[b][2]&&this._diffBlocks.push([f,b]),f+=this._mapper[b][this._mapperColumnIndex]}};f.prototype.getBlockAnnoTypes=function(c){this._isAddedSide()?c.push({type:"block",normal:"orion.annotation.diff.addedBlock",current:"orion.annotation.diff.currentAddedBlock",list:[]}):c.push({type:"block",normal:"orion.annotation.diff.deletedBlock",
current:"orion.annotation.diff.currentDeletedBlock",list:[]});c.push({type:"block",normal:"orion.annotation.diff.blockTop",current:"orion.annotation.diff.currentBlockTop",list:[]});c.push({type:"block",normal:"orion.annotation.diff.blockConflict",current:"orion.annotation.diff.currentBlockConflict",list:[]})};f.prototype.getCurrentBlockAnnoType=function(c){if(!this._diffBlocks||0===this._diffBlocks.length||this._diffBlocks.length<=c)return null;c=this._diffBlocks[c][1];return 0===this._mapper[c][this._mapperColumnIndex]?
{normal:"orion.annotation.diff.blockTop",current:"orion.annotation.diff.currentBlockTop"}:m.isMapperConflict(this.getMapper(),c)?{normal:"orion.annotation.diff.blockConflict",current:"orion.annotation.diff.currentBlockConflict"}:this._isAddedSide()?{type:"block",normal:"orion.annotation.diff.addedBlock",current:"orion.annotation.diff.currentAddedBlock",list:[]}:{type:"block",normal:"orion.annotation.diff.deletedBlock",current:"orion.annotation.diff.currentDeletedBlock",list:[]}};c.TwoWayDiffBlockFeeder=
f;f=function(c,d){this._mapperColumnIndex=d;this.init(c)};f.prototype=new c.DiffBlockFeeder;f.prototype.setModel=function(c){this._textModel=c};f.prototype.init=function(c){this._diffBlocks=void 0;if(c){this._mapper=c;this._diffBlocks=[];this._gapBlocks=[];for(var d=c=0,f=0;f<this._mapper.length;f++){if(0!==this._mapper[f][2]){if(this._isAddedSide()){var b=c+this._mapper[f][1];this._diffBlocks.push([b,f]);this._gapBlocks.push([b,b+this._mapper[f][0],d])}else this._diffBlocks.push([c,f]),this._gapBlocks.push([c,
c+this._mapper[f][1],d]);c+=this._mapper[f][0]+this._mapper[f][1]}else this._gapBlocks.push([c,c+this._mapper[f][this._mapperColumnIndex],d]),c+=this._mapper[f][this._mapperColumnIndex];d+=this._mapper[f][this._mapperColumnIndex]}}};f.prototype.getBlockAnnoTypes=function(c){this._isAddedSide()?c.push({type:"block",normal:"orion.annotation.diff.addedBlock",current:"orion.annotation.diff.currentAddedBlock",list:[]}):c.push({type:"block",normal:"orion.annotation.diff.deletedBlock",current:"orion.annotation.diff.currentDeletedBlock",
list:[]});c.push({type:"block",normal:"orion.annotation.diff.blockConflict",current:"orion.annotation.diff.currentBlockConflict",list:[]})};f.prototype.getCurrentBlockAnnoType=function(c){if(!this._diffBlocks||0===this._diffBlocks.length)return null;c=this._diffBlocks[c][1];return 0===this._mapper[c][this._mapperColumnIndex]?{current:"orion.annotation.diff.currentAddedWord",normal:"orion.annotation.diff.addedWord"}:m.isMapperConflict(this.getMapper(),c)?{normal:"orion.annotation.diff.blockConflict",
current:"orion.annotation.diff.currentBlockConflict"}:this._isAddedSide()?{type:"block",normal:"orion.annotation.diff.addedBlock",current:"orion.annotation.diff.currentAddedBlock",list:[]}:{type:"block",normal:"orion.annotation.diff.deletedBlock",current:"orion.annotation.diff.currentDeletedBlock",list:[]}};f.prototype.getDiffBlockH=function(c){if(!this._diffBlocks||0===this._diffBlocks.length)return-1;c=this._diffBlocks[c][1];return this._mapper[c][0]+this._mapper[c][1]};f.prototype.getLineNumber=
function(c){for(var d=0;d<this._gapBlocks.length;d++)if(this._gapBlocks[d][0]!==this._gapBlocks[d][1]&&c>=this._gapBlocks[d][0]&&c<this._gapBlocks[d][1])return c-this._gapBlocks[d][0]+this._gapBlocks[d][2];return-1};c.inlineDiffBlockFeeder=f;return c});
define("orion/compare/compareView","i18n!orion/compare/nls/messages orion/Deferred orion/webui/littlelib orion/compare/diffParser orion/compare/compareRulers orion/editor/editor orion/editor/editorFeatures orion/keyBinding orion/editor/textView orion/compare/compareUIFactory orion/compare/compareUtils orion/compare/jsdiffAdapter orion/compare/diffTreeNavigator".split(" "),function(k,m,i,d,c,f,e,h,j,b,a,g,l){var n={},h=function(){this._diffParser=new d.DiffParser};h.prototype={_clearOptions:function(){this.options=
{};this.options.blockNumber=1;this.options.changeNumber=0},_getLineDelim:function(){return"\n"},_generateMapper:function(a,b,c,e,d){var f=this._getLineDelim(a,c);this._diffParser.setLineDelim(f);if(this.options.mapper&&this.options.toggler)return{delim:f,mapper:this.options.mapper,output:this.options.newFile.Content,diffArray:this.options.diffArray};if("string"===typeof b&&"string"===typeof a)return a=(new g.JSDiffAdapter).adapt(a,b,f),this.options.toggler&&(this.options.mapper=a.mapper,this.options.newFile.Content=
b,this.options.diffArray=a.changContents),{delim:f,mapper:a.mapper,output:b,diffArray:a.changContents};b=this._diffParser.parse(a,c,e,d);a=this._diffParser.getDiffArray();this.options.toggler&&(this.options.mapper=b.mapper,this.options.newFile.Content=b.outPutFile,this.options.diffArray=a);return{delim:f,mapper:b.mapper,output:b.outPutFile,diffArray:a}},_loadImageFile:function(a,b,c){var e=document.createElement("img");e.src=a;var d=new m;e.onload=function(){b.appendChild(e);if(c){var a=document.createElement("hr");
b.appendChild(a)}d.resolve(e.height)};e.onerror=function(){d.resolve(0)};return d},_initSyntaxHighlighter:function(a){this._syntaxHighlighters=null;if(this.options.highlighters&&0<this.options.highlighters.length&&!(1>a.length||2<a.length))this._syntaxHighlighters=[{highlighter:this.options.highlighters[0],target:a[0]}],2===a.length&&2===this.options.highlighters.length&&this._syntaxHighlighters.push({highlighter:this.options.highlighters[1],target:a[1]})},_highlightSyntax:function(){if(this._syntaxHighlighters){var a=
[];this._syntaxHighlighters.forEach(function(b){a.push(b.highlighter.highlight(b.target.fileName,b.target.contentType,b.target.editor))}.bind(this));m.all(a,function(a){return{_error:a}}).then(function(){this._diffNavigator.renderAnnotations();this._diffNavigator.gotoBlock(this.options.blockNumber-1,this.options.changeNumber-1)}.bind(this))}else window.setTimeout(function(){this._diffNavigator.renderAnnotations();this._diffNavigator.gotoBlock(this.options.blockNumber-1,this.options.changeNumber-1)}.bind(this),
50)},setOptions:function(a,b){b&&this._clearOptions();this.options||(this.options={});a&&Object.keys(a).forEach(function(b){this.options[b]=a[b]}.bind(this));if(a.newFileOnRight){var c=this.options.newFile;this.options.newFile=this.options.oldFile;this.options.oldFile=c}},getOptions:function(){return this.options},getCurrentDiffPos:function(){return this._diffNavigator.getCurrentPosition()},initDiffNav:function(){this._diffNavigator.gotoBlock(0,0)},nextDiff:function(){this._diffNavigator.nextDiff()},
prevDiff:function(){this._diffNavigator.prevDiff()},nextChange:function(){return this._diffNavigator.nextChange()},prevChange:function(){this._diffNavigator.prevChange()},getWidget:function(){return this},startup:function(){this.initEditors();this.refresh(!0)},initEditors:function(){},initImageMode:function(){}};n.CompareView=h;h=function(a){this.setOptions(a,!0);this._diffNavigator=new l.DiffTreeNavigator("word");this.type="twoWay";this._uiFactory=this.options.uiFactory;this._uiFactory||(this._uiFactory=
new b.TwoWayCompareUIFactory({parentDivID:this.options.parentDivId,showTitle:this.options.showTitle?this.options.showTitle:!1,showLineStatus:this.options.showLineStatus?this.options.showLineStatus:!1}),this._uiFactory.buildUI());this._viewLoadedCounter=0;this.options.commandProvider&&this.options.commandProvider.initCommands(this);this._curveRuler=new c.CompareCurveRuler(this._uiFactory.getDiffCanvasDiv())};h.prototype=new n.CompareView;h.prototype.initEditors=function(a){this._editors=[];this._editors.push(this._createEditor(a,
this._uiFactory.getEditorParentDiv(!1),this._uiFactory.getStatusDiv(!1),this.options.oldFile));this._editors.push(this._createEditor(a,this._uiFactory.getEditorParentDiv(!0),this._uiFactory.getStatusDiv(!0),this.options.newFile,!0));this._overviewRuler=new c.CompareOverviewRuler("right",{styleClass:"ruler overview"},null,function(a){this._diffNavigator.matchPositionFromOverview(a)}.bind(this));window.onbeforeunload=function(){if(this._editors&&this._editors.some(function(a){return a.isDirty()}))return k["There are unsaved changes."]}.bind(this)};
h.prototype.initImageMode=function(){this._editors&&(this._editors.forEach(function(a){a.destroy()}),this._editors=null);this._uiFactory.getEditorParentDiv(!0).classList.add("compareEditorParentImageMode");this._uiFactory.getEditorParentDiv().classList.add("compareEditorParentImageMode");this._uiFactory.disableTitle();this._uiFactory.disableLineStatus();this._imageMode=!0};h.prototype.getImageMode=function(){return this._imageMode};h.prototype.getEditors=function(){return this._editors};h.prototype.gotoDiff=
function(a,b,c){c=c?this._editors[1].getTextView():this._editors[0].getTextView();a=c.getModel().getLineStart(a)+b;this._diffNavigator.gotoDiff(a,c)};h.prototype.copyToLeft=function(){this._curveRuler.copyTo(!0)};h.prototype.copyToRight=function(){this._curveRuler.copyTo(!1)};h.prototype.resizeEditors=function(){this._editors.forEach(function(a){a.getTextView().resize()})};h.prototype.getSplitter=function(){return this._uiFactory.getSplitter()};h.prototype._createEditor=function(a,b,c,d,g){var h=
"undefined"===typeof d.readonly?!0:d.readonly,i=function(){var a=new j.TextView({parent:b,readonly:h,tabSize:4});this._viewLoadedCounter++;2===this._viewLoadedCounter&&this._diffNavigator.matchPositionFromOverview(-1);if(this.onLoad)this.onLoad();var c=this.getSplitter();c&&c.addResizeListener(function(b){if(b){var c=!1;(c=this._uiFactory.isLeftPane(b)?g:!g)&&a.resize()}}.bind(this));return a}.bind(this),l=d.keyBindingFactory;l||(l=new e.KeyBindingsFactory);var m=null;if(c)var n="",m=function(a,b){c&&
(n=b?k["ERROR: "]+a:a,c.textContent=""+n)};i=new f.Editor({textViewFactory:i,undoStackFactory:new e.UndoFactory,annotationFactory:new e.AnnotationFactory,keyBindingFactory:l,statusReporter:m,domNode:b});i.installTextView();i.setInput(null,null,d.Content?d.Content:a);i.setOverviewRulerVisible(!1);var v=i.getTextView();v.addEventListener("Selection",function(a){!(a.newValue&&a.newValue.start!==a.newValue.end)&&(!this._diffNavigator.autoSelecting&&this._diffNavigator.editorWrapper[0].diffFeeder)&&(a=
v.getCaretOffset(),this._diffNavigator.gotoDiff(a,v))}.bind(this));v.getModel().addEventListener("Changed",function(a){this._curveRuler.onChanged(a,!g)||(this.options.mapper=null)}.bind(this));g?v.addEventListener("Scroll",function(){this._curveRuler&&(this._curveRuler.matchPositionFrom(!0),this._curveRuler.render());if(this.onScroll)this.onScroll()}.bind(this)):v.addEventListener("Scroll",function(){this._curveRuler&&this._curveRuler.render()}.bind(this));return i};h.prototype.destroy=function(){this._editors&&
(this._diffNavigator.destroy(),this._editors.forEach(function(a){a.destroy()}),this._uiFactory.destroy())};h.prototype.addRulers=function(){if(this._editors&&!this._hasRuler){var a=new c.LineNumberCompareRuler(this._diffNavigator,0,"left",{styleClass:"ruler lines"},{styleClass:"rulerLines odd"},{styleClass:"rulerLines even"}),b=new c.LineNumberCompareRuler(this._diffNavigator,0,"left",{styleClass:"ruler lines"},{styleClass:"rulerLines odd"},{styleClass:"rulerLines even"});this._editors[1].getTextView().addRuler(a);
this._editors[0].getTextView().addRuler(b);this._editors[0].getTextView().addRuler(this._overviewRuler);this._hasRuler=!0}};h.prototype.refresh=function(a){if(this._imageMode){this.options.commandProvider&&this.options.commandProvider.renderCommands(this);var b=this;return this._loadImageFile(this.options.newFile.URL,this._uiFactory.getEditorParentDiv(!0)).then(function(a){return b._loadImageFile(b.options.oldFile.URL,b._uiFactory.getEditorParentDiv()).then(function(b){return(new m).resolve(a>b?a:
b)})})}var c=this.options.oldFile.Content,e=this.options.newFile.Content,d=this.options.diffContent;"string"===typeof e?d=this._generateMapper(c,e,d,this.options.hasConflicts):(d=this._generateMapper(c,e,d,this.options.hasConflicts),e=d.output);var g=new l.TwoWayDiffBlockFeeder(this._editors[0].getTextView().getModel(),d.mapper,1,this.options.newFileOnRight),f=new l.TwoWayDiffBlockFeeder(this._editors[1].getTextView().getModel(),d.mapper,0,this.options.newFileOnRight);this._diffNavigator.initAll(this.options.charDiff?
"char":"word",this._editors[0],this._editors[1],g,f,this._overviewRuler,this._curveRuler);this._curveRuler.init(d.mapper,this._editors[1],this._editors[0],this._diffNavigator);a&&(this._editors[1].setInput(this.options.newFile.Name,null,e),this._editors[0].setInput(this.options.oldFile.Name,null,c));this._initSyntaxHighlighter([{fileName:this.options.newFile.Name,contentType:this.options.newFile.Type,editor:this._editors[1]},{fileName:this.options.oldFile.Name,contentType:this.options.oldFile.Type,
editor:this._editors[0]}]);this._highlightSyntax();this.options.commandProvider&&this.options.commandProvider.renderCommands(this);this.addRulers();2===this._viewLoadedCounter&&this._diffNavigator.gotoBlock(this.options.blockNumber-1,this.options.changeNumber-1);this.refreshTitle(0);this.refreshTitle(1);a=this._editors[1].getTextView().getModel().getLineCount()*this._editors[1].getTextView().getLineHeight()+5;c=this._editors[0].getTextView().getModel().getLineCount()*this._editors[0].getTextView().getLineHeight()+
5;return a>c?a:c};h.prototype.refreshTitle=function(a,b){if(1===a){var c=this._uiFactory.getTitleDiv(!0);c&&(i.empty(c),c.appendChild(document.createTextNode(b||this._editors[a].isDirty()?this.options.newFile.Name+"*":this.options.newFile.Name)))}else if(c=this._uiFactory.getTitleDiv(!1))i.empty(c),c.appendChild(document.createTextNode(b||this._editors[a].isDirty()?this.options.oldFile.Name+"*":this.options.oldFile.Name))};n.TwoWayCompareView=h;h=function(a){this.setOptions(a,!0);this._diffNavigator=
new l.DiffTreeNavigator("word");this.type="inline";this.options.commandProvider&&this.options.commandProvider.initCommands(this);this._editorDiv=this.options.parentDivId};h.prototype=new n.CompareView;h.prototype.addRulers=function(){this._textView&&!this._hasRuler&&(this._textView.addRuler(this._rulerOrigin),this._textView.addRuler(this._rulerNew),this._textView.addRuler(this._overviewRuler),this._hasRuler=!0)};h.prototype.removeRulers=function(){this._textView&&this._hasRuler&&(this._textView.removeRuler(this._rulerOrigin),
this._textView.removeRuler(this._rulerNew),this._textView.removeRuler(this._overviewRuler),this._hasRuler=!1)};h.prototype.destroyEditor=function(){this._textView&&(this._diffNavigator.destroy(),this._textView.setText(""),this.removeRulers())};h.prototype.destroy=function(){this._textView&&(this._diffNavigator.destroy(),this._textView.destroy())};h.prototype.initEditors=function(a){var b=i.node(this._editorDiv),d=function(){return new j.TextView({parent:b,readonly:!0,tabSize:4})}.bind(this);this._editor=
new f.Editor({textViewFactory:d,undoStackFactory:new e.UndoFactory,annotationFactory:new e.AnnotationFactory,domNode:b});this._editor.installTextView();this._editor.setInput(null,null,a);this._editor.setOverviewRulerVisible(!1);this._editor.setAnnotationRulerVisible(!1);this._textView=this._editor.getTextView();this._rulerOrigin=new c.LineNumberCompareRuler(this._diffNavigator,1,"left",{styleClass:"ruler lines inlineRulerLeft"},{styleClass:"rulerLines odd"},{styleClass:"rulerLines even"});this._rulerNew=
new c.LineNumberCompareRuler(this._diffNavigator,0,"left",{styleClass:"ruler lines"},{styleClass:"rulerLines odd"},{styleClass:"rulerLines even"});this._overviewRuler=new c.CompareOverviewRuler("right",{styleClass:"ruler overview"},null,function(a){this._diffNavigator.matchPositionFromOverview(a)}.bind(this));this._textView.addEventListener("Selection",function(a){!(a.newValue&&a.newValue.start!==a.newValue.end)&&(!this._diffNavigator.autoSelecting&&this._diffNavigator.editorWrapper[0].diffFeeder)&&
(a=this._textView.getCaretOffset(),this._diffNavigator.gotoDiff(a,this._textView))}.bind(this))};h.prototype.initImageMode=function(){this._editor&&(this._editor.destroy(),this._editor=null);i.node(this._editorDiv).classList.add("compareEditorParentImageMode");this._imageMode=!0};h.prototype.getImageMode=function(){return this._imageMode};h.prototype._initDiffPosition=function(a){var b=a.getModel();if(b&&b.getAnnotations&&(b=b.getAnnotations(),0<b.length)){var b=b[0][0],c=a.getLineHeight(),e=a.getClientArea(),
c=Math.floor(e.height/c/3);a.setTopIndex(0<b-c?b-c:0)}};h.prototype.refresh=function(){if(this._imageMode){this.options.commandProvider&&this.options.commandProvider.renderCommands(this);var b=this;return this._loadImageFile(this.options.newFile.URL,i.node(this._editorDiv),!0).then(function(a){return b._loadImageFile(b.options.oldFile.URL,i.node(b._editorDiv)).then(function(b){return(new m).resolve(a+b+20)})})}var c=this.options.oldFile.Content,e=this.options.newFile.Content,d=this._generateMapper(c,
e,this.options.diffContent,this.options.hasConflicts,!this.options.toggler);"string"!==typeof e&&(e=d.output);this._textView.getModel().setText(c);c=new l.inlineDiffBlockFeeder(d.mapper,1);e=new l.inlineDiffBlockFeeder(d.mapper,0);a.mergeDiffBlocks(this._textView.getModel(),e.getDiffBlocks(),d.mapper,d.diffArray.array,d.diffArray.index,this._diffParser._lineDelimiter);c.setModel(this._textView.getModel());e.setModel(this._textView.getModel());this._diffNavigator.initAll(this.options.charDiff?"char":
"word",this._editor,this._editor,c,e,this._overviewRuler);this._initSyntaxHighlighter([{fileName:this.options.oldFile.Name,contentType:this.options.oldFile.Type,editor:this._editor}]);this._highlightSyntax();this.options.commandProvider&&this.options.commandProvider.renderCommands(this);this.addRulers();d=this._textView.getTopIndex();this._textView.redrawLines(d,d+1,this._overviewRuler);this._textView.redrawLines(d,d+1,this._rulerOrigin);this._textView.redrawLines(d,d+1,this._rulerNew);this._diffNavigator.gotoBlock(this.options.blockNumber-
1,this.options.changeNumber-1);return this._textView.getLineHeight()*this._textView.getModel().getLineCount()+5};h.prototype.setConflicting=function(a){this._conflcit=a};n.InlineCompareView=h;h=function(a,b){b&&(b.toggler=this);this._widget="inline"===a?new n.InlineCompareView(b):new n.TwoWayCompareView(b)};h.prototype={startup:function(){this._widget.startup()},initImageMode:function(){this._imageMode=!0;this._widget.initImageMode()},toggle:function(){var a=this._widget.options;if(!this._imageMode){var b=
this._widget.getCurrentDiffPos();a.blockNumber=b.block;a.changeNumber=b.change}this._widget.destroy();i.empty(i.node(a.parentDivId));this._widget="inline"===this._widget.type?new n.TwoWayCompareView(a):new n.InlineCompareView(a);this._imageMode?this._widget.initImageMode():this._widget.initEditors();this._widget.refresh(!0)},getWidget:function(){return this._widget}};n.toggleableCompareView=h;return n});
define("orion/compare/compareCommands",["i18n!orion/compare/nls/messages","orion/commands","orion/keyBinding","orion/webui/littlelib"],function(k,m,i,d){var c={},f=function(c){this.setOptions(c,!0)};f.prototype={setOptions:function(c,d){d&&(this.options={});this.options||(this.options={});c&&Object.keys(c).forEach(function(d){this.options[d]=c[d]}.bind(this))},getOptions:function(){return this.options},initCommands:function(c){var d=this.options.commandSpanId,f=this.options.commandService;if(f&&d){var b=
new m.Command({name:k["Copy current change from right to left"],tooltip:k["Copy current change from right to left"],imageClass:"core-sprite-leftarrow",id:"orion.compare.copyToLeft",groupId:"orion.compareGroup",visibleWhen:function(){return"twoWay"===c.type&&!c.getImageMode()&&c.options.newFile&&!c.options.newFile.readonly}.bind(this),callback:function(a){a.items.copyToLeft()}}),a=new m.Command({name:k["Copy current change from left to right"],tooltip:k["Copy current change from left to right"],imageClass:"core-sprite-rightarrow",
id:"orion.compare.copyToRight",groupId:"orion.compareGroup",visibleWhen:function(){return"twoWay"===c.type&&!c.getImageMode()&&c.options.oldFile&&!c.options.oldFile.readonly}.bind(this),callback:function(a){a.items.copyToRight()}}),g=new m.Command({tooltip:k["Switch to unified diff"],name:k.Unified,id:"orion.compare.toggle2Inline",groupId:"orion.compareGroup",visibleWhen:function(a){return a.options.toggler&&"twoWay"===a.options.toggler.getWidget().type},callback:function(a){a.items.options.toggler.toggle()}}),
l=new m.Command({tooltip:k["Switch to side by side diff"],name:k["Side by side"],id:"orion.compare.toggle2TwoWay",groupId:"orion.compareGroup",visibleWhen:function(a){return a.options.toggler&&"inline"===a.options.toggler.getWidget().type},callback:function(a){a.items.options.toggler.toggle()}}),n=new m.Command({name:k["Next diff block"],tooltip:k["Next diff block"],imageClass:"core-sprite-move-down",id:"orion.compare.nextDiff",groupId:"orion.compareGroup",visibleWhen:function(){return!c.getImageMode()},
callback:function(a){a.items.nextDiff()}}),q=new m.Command({name:k["Previous diff block"],tooltip:k["Previous diff block"],imageClass:"core-sprite-move-up",id:"orion.compare.prevDiff",groupId:"orion.compareGroup",visibleWhen:function(){return!c.getImageMode()},callback:function(a){a.items.prevDiff()}}),r=new m.Command({name:k["Next diff change"],tooltip:k["Next diff change"],imageClass:"core-sprite-move-down",id:"orion.compare.nextChange",groupId:"orion.compareGroup",visibleWhen:function(){return!c.getImageMode()},
callback:function(a){a.items.nextChange()}}),w=new m.Command({name:k["Previous diff change"],tooltip:k["Previous diff change"],imageClass:"core-sprite-move-up",id:"orion.compare.prevChange",groupId:"orion.compareGroup",visibleWhen:function(){return!c.getImageMode()},callback:function(a){a.items.prevChange(a)}});f.addCommand(b);f.addCommand(a);f.addCommand(l);f.addCommand(g);f.addCommand(n);f.addCommand(q);f.addCommand(r);f.addCommand(w);f.registerCommandContribution(d,"orion.compare.toggle2Inline",
108);f.registerCommandContribution(d,"orion.compare.toggle2TwoWay",109);f.registerCommandContribution(d,"orion.compare.copyToLeft",110,null,!1,new i.KeyBinding(37,!0,!1,!0));f.registerCommandContribution(d,"orion.compare.copyToRight",111,null,!1,new i.KeyBinding(39,!0,!1,!0));f.registerCommandContribution(d,"orion.compare.nextDiff",112,null,!1,new i.KeyBinding(40,!0));f.registerCommandContribution(d,"orion.compare.prevDiff",113,null,!1,new i.KeyBinding(38,!0));c.options.wordLevelNav?(f.registerCommandContribution(d,
"orion.compare.nextChange",114,null,!1,new i.KeyBinding(40,!0,!0)),f.registerCommandContribution(d,"orion.compare.prevChange",115,null,!1,new i.KeyBinding(38,!0,!0))):(f.registerCommandContribution(d,"orion.compare.nextChange",114,null,!0,new i.KeyBinding(40,!0,!0)),f.registerCommandContribution(d,"orion.compare.prevChange",115,null,!0,new i.KeyBinding(38,!0,!0)))}},renderCommands:function(c){var f=this.options.commandSpanId,i=this.options.commandService;i&&f&&(d.empty(d.node(f)),this.options.gridRenderer&&
this.options.gridRenderer.navGridHolder?(this.options.gridRenderer.navGridHolder.splice(0,this.options.gridRenderer.navGridHolder.length),this.options.gridRenderer.additionalCmdRender?this.options.gridRenderer.before?(this.options.gridRenderer.additionalCmdRender(this.options.gridRenderer.navGridHolder),i.renderCommands(f,f,c,c,"tool",null,this.options.gridRenderer.navGridHolder)):(i.renderCommands(f,f,c,c,"tool",null,this.options.gridRenderer.navGridHolder),this.options.gridRenderer.additionalCmdRender(this.options.gridRenderer.navGridHolder)):
i.renderCommands(f,f,c,c,"tool",null,this.options.gridRenderer.navGridHolder)):i.renderCommands(f,f,c,c,"tool",null))}};c.CompareCommandFactory=f;return c});
define("orion/editor/textMateStyler",["orion/regex"],function(k){function m(b){var a;if(b instanceof Array){a=Array(b.length);for(var c=0;c<b.length;c++)a[c]=m(b[c])}else for(c in a={},b)if(Object.prototype.hasOwnProperty.call(b,c)){var d=b[c];a[c]="object"===typeof d&&null!==d?m(d):d}return a}function i(b,a,c){this.initialize(b);this.grammar=m(a);this.externalGrammars=c?m(c):[];this._styles={};this._tree=null;this._allGrammars={};this.preprocess(this.grammar)}var d={unsupported:[{regex:/\(\?[ims\-]:/,
func:function(){return"option on/off for subexp"}},{regex:/\(\?<([=!])/,func:function(b){return"="===b[1]?"lookbehind":"negative lookbehind"}},{regex:/\(\?>/,func:function(){return"atomic group"}}],toRegExp:function(b){var a="",c,b=d.processGlobalFlag("x",b,function(a){for(var b="",c=!1,d=a.length,e=0;e<d;){var g=a.charAt(e);if(!c&&"#"===g)for(;e<d&&"\r"!==g&&"\n"!==g;)g=a.charAt(++e);else if(!c&&/\s/.test(g))for(;e<d&&/\s/.test(g);)g=a.charAt(++e);else"\\"===g?(b+=g,/\s/.test(a.charAt(e+1))||(b+=
a.charAt(e+1),e+=1)):("["===g?c=!0:"]"===g&&(c=!1),b+=g),e+=1}return b}),b=d.processGlobalFlag("i",b,function(b){a+="i";return b});for(c=0;c<this.unsupported.length;c++){var e;if(e=this.unsupported[c].regex.exec(b))throw b=this.unsupported[c].func(e),Error('Unsupported regex feature "'+b+'": "'+e[0]+'" at index: '+e.index+" in "+e.input);}return RegExp(b,a)},processGlobalFlag:function(b,a,c){var d="(?"+b+")",b="(?"+b+":";if(a.substring(0,d.length)===d)return c(a.substring(d.length));if(a.substring(0,
b.length)===b){for(var d=0,e=a.length,f=-1,h=0;h<e&&-1===f;h++)switch(a.charAt(h)){case "\\":h++;break;case "(":d++;break;case ")":d--,0===d&&(f=h)}d=f;if(d<a.length-1)throw Error("Only a "+b+") group that encloses the entire regex is supported in: "+a);return c(a.substring(b.length,d))}return a},hasBackReference:function(b){return/\\\d+/.test(b.source)},getSubstitutedRegex:function(b,a,c){for(var c="undefined"===typeof c?!0:!1,b=b.source.split(/(\\\d+)/g),d=[],e=0;e<b.length;e++){var f=b[e],h=/\\(\d+)/.exec(f);
h?(f=a[h[1]]||"",d.push(c?k.escape(f):f)):d.push(f)}return RegExp(d.join(""))},groupify:function(b,a){for(var c=b.source,d=c.length,e=[],f=0,h=[],i=1,j=1,k=[],m={},u={},p=0;p<d;p++){var s=e[e.length-1],A=c.charAt(p);switch(A){case "(":4===s&&(e.pop(),k.push(")"),h[h.length-1].end=p);var v=p+2<d?c.charAt(p+1)+""+c.charAt(p+2):null;if("?:"===v||"?="===v||"?!"===v){var z;"?:"===v?z=1:(z=3,f++);e.push(z);h.push({start:p,end:-1,type:z});k.push(A);k.push(v);p+=v.length}else e.push(2),h.push({start:p,end:-1,
type:2,oldNum:i,num:j}),k.push(A),0===f&&(u[j]=null),m[i]=j,i++,j++;break;case ")":s=e.pop();3===s&&f--;h[h.length-1].end=p;k.push(A);break;case "*":case "+":case "?":case "}":var G=A,H=c.charAt(p-1),v=p-1;if("}"===A){for(z=p-1;"{"!==c.charAt(z)&&0<=z;z--);H=c.charAt(z-1);v=z-1;G=c.substring(z,p+1)}z=h[h.length-1];if(")"===H&&(2===z.type||4===z.type)){k.splice(z.start,0,"(");k.push(G);k.push(")");A={start:z.start,end:k.length-1,type:4,num:z.num};for(H=0;H<h.length;H++)if(s=h[H],(2===s.type||4===s.type)&&
s.start>=z.start&&s.end<=v)s.start+=1,s.end+=1,s.num+=1,2===s.type&&(m[s.oldNum]=s.num);h.push(A);j++;break}default:"|"!==A&&(2!==s&&4!==s)&&0===f&&(e.push(4),h.push({start:p,end:-1,type:4,num:j}),k.push("("),u[j]=null,j++),k.push(A),"\\"===A&&(A=c.charAt(p+1),k.push(A),p+=1)}}for(;e.length;)e.pop(),k.push(")");var c=RegExp(k.join("")),d={},a=a||m,F;for(F in a)a.hasOwnProperty(F)&&(d[F]="\\"+a[F]);c=this.getSubstitutedRegex(c,d,!1);return[c,m,u]},complexCaptures:function(b){if(!b)return!1;for(var a in b)if(b.hasOwnProperty(a)&&
"0"!==a)return!0;return!1}},c=function(b){this.rule=b;this.subrules=b.patterns};c.prototype.valueOf=function(){return"aa"};var f=function(b){this.rule=b;this.beginRegex=d.toRegExp(b.begin);this.endRegex=d.toRegExp(b.end);this.subrules=b.patterns||[];this.endRegexHasBackRef=d.hasBackReference(this.endRegex);var a=d.complexCaptures(b.captures),b=d.complexCaptures(b.beginCaptures)||d.complexCaptures(b.endCaptures);if(this.isComplex=a||b)a=d.groupify(this.beginRegex),this.beginRegex=a[0],this.beginOld2New=
a[1],this.beginConsuming=a[2],a=d.groupify(this.endRegex,this.beginOld2New),this.endRegex=a[0],this.endOld2New=a[1],this.endConsuming=a[2]};f.prototype.valueOf=function(){return this.beginRegex};var e=function(b){this.rule=b;this.matchRegex=d.toRegExp(b.match);if(this.isComplex=d.complexCaptures(b.captures))b=d.groupify(this.matchRegex),this.matchRegex=b[0],this.matchOld2New=b[1],this.matchConsuming=b[2]};e.prototype.valueOf=function(){return this.matchRegex};var h=function(b,a){this.parent=b;this.rule=
a;this.children=[];this.end=this.start=null};h.prototype.addChild=function(b){this.children.push(b)};h.prototype.valueOf=function(){var b=this.rule;return"ContainerNode { "+(b.include||"")+" "+(b.name||"")+(b.comment||"")+"}"};var j=function(b,a,c){this.parent=b;this.rule=a;this.children=[];this.setStart(c);this.endMatch=this.end=null;this.endRegexSubstituted=a.endRegexHasBackRef?d.getSubstitutedRegex(a.endRegex,c):null};j.prototype.addChild=function(b){this.children.push(b)};j.prototype.getIndexInParent=
function(){return this.parent?this.parent.children.indexOf(this):-1};j.prototype.setStart=function(b){this.start=b.index;this.beginMatch=b};j.prototype.setEnd=function(b){b&&"object"===typeof b?(this.endMatch=b,this.end=b.index+b[0].length):(this.endMatch=null,this.end=b)};j.prototype.shiftStart=function(b){this.start+=b;this.beginMatch.index+=b};j.prototype.shiftEnd=function(b){this.end+=b;this.endMatch&&(this.endMatch.index+=b)};j.prototype.valueOf=function(){return"{"+this.rule.beginRegex+" range="+
this.start+".."+this.end+"}"};i.prototype={initialize:function(b){this.textView=b;this.textView.stylerOptions=this;var a=this;this._listener={onModelChanged:function(b){a.onModelChanged(b)},onDestroy:function(b){a.onDestroy(b)},onLineStyle:function(b){a.onLineStyle(b)},onStorage:function(b){a.onStorage(b)}};b.addEventListener("ModelChanged",this._listener.onModelChanged);b.addEventListener("Destroy",this._listener.onDestroy);b.addEventListener("LineStyle",this._listener.onLineStyle);b.redrawLines()},
onDestroy:function(){this.destroy()},destroy:function(){this.textView&&(this.textView.removeEventListener("ModelChanged",this._listener.onModelChanged),this.textView.removeEventListener("Destroy",this._listener.onDestroy),this.textView.removeEventListener("LineStyle",this._listener.onLineStyle),this.textView=null);this._listener=this._tree=this._styles=this.grammar=null},preprocess:function(b){for(b=[b];0!==b.length;){var a=b.pop();if(!a._resolvedRule||!a._typedRule)if(a._resolvedRule=this._resolve(a),
a._typedRule=this._createTypedRule(a),this.addStyles(a.name),this.addStyles(a.contentName),this.addStylesForCaptures(a.captures),this.addStylesForCaptures(a.beginCaptures),this.addStylesForCaptures(a.endCaptures),a._resolvedRule!==a&&b.push(a._resolvedRule),a.patterns)for(var c=0;c<a.patterns.length;c++)b.push(a.patterns[c])}},addStyles:function(b){if(b&&!this._styles[b]){this._styles[b]=[];for(var a=b.split("."),c=0;c<a.length;c++)this._styles[b].push(a.slice(0,c+1).join("-"))}},addStylesForCaptures:function(b){for(var a in b)b.hasOwnProperty(a)&&
this.addStyles(b[a].name)},ContainerRule:c,BeginEndRule:f,MatchRule:e,_createTypedRule:function(b){return b.match?new this.MatchRule(b):b.begin?new this.BeginEndRule(b):new this.ContainerRule(b)},_resolve:function(b){var a=b;if(b.include){if(b.begin||b.end||b.match)throw Error('Unexpected regex pattern in "include" rule '+b.include);b=b.include;if("#"===b.charAt(0)){if(a=this.grammar.repository&&this.grammar.repository[b.substring(1)],!a)throw Error("Couldn't find included rule "+b+" in grammar repository");
}else if("$self"===b)a=this.grammar;else{if("$base"===b)throw Error('Include "$base" is not supported');a=this._allGrammars[b];if(!a)for(var c=0;c<this.externalGrammars.length;c++){var d=this.externalGrammars[c];if(d.scopeName===b){this.preprocess(d);a=this._allGrammars[b]=d;break}}}}return a},ContainerNode:h,BeginEndNode:j,push:function(b,a){if(a)for(var c=a.length;0<c;)b.push(a[--c])},exec:function(b,a,c){if(a=b.exec(a))a.index+=c;b.lastIndex=0;return a},afterMatch:function(b){return b.index+b[0].length},
getEndMatch:function(b,a,c){if(b instanceof this.BeginEndNode){var d=b.rule,b=b.endRegexSubstituted||d.endRegex;return!b?null:this.exec(b,a,c)}return null},initialParse:function(){this.textView.getModel().getCharCount();this._tree=new this.ContainerNode(null,this.grammar._typedRule);this.parse(this._tree,!1,0)},onModelChanged:function(b){var a=b.addedCharCount,c=b.removedCharCount,b=b.start;if(this._tree){var d=this.textView.getModel(),e=d.getCharCount(),d=d.getLineEnd(d.getLineAtOffset(b)-1),f=this.getFirstDamaged(d,
d),d=-1===d?0:d,a=f?this.parse(f,!0,d,b,a,c):e;this.textView.redrawRange(d,a)}else this.initialParse()},getFirstDamaged:function(b,a){if(0>b)return this._tree;for(var c=[this._tree],d=null;c.length;){var e=c.pop();if(!e.parent||this.isDamaged(e,b,a)){e instanceof this.BeginEndNode&&(d=e);for(var f=0;f<e.children.length;f++)c.push(e.children[f])}}return d||this._tree},isDamaged:function(b,a,c){return b.start<=c&&b.end>a},parse:function(b,a,c,d,e,f){var h=this.textView.getModel(),i=h.getLineStart(h.getLineCount()-
1),j=h.getCharCount(),k=this.getInitialExpected(b,c),m=-1;a&&(b.repaired=!0,b.endNeedsUpdate=!0,m=(m=b.children[b.children.length-1])?h.getLineEnd(h.getLineAtOffset(m.end+(e-f))):-1,d=h.getLineEnd(h.getLineAtOffset(d+f)),m=Math.max(m,d));for(var m=-1===m?j:m,d=k,u=b,p=!1,s=c,A=-1;u&&(!a||s<m);){var v=this.getNextMatch(h,u,s);v||(s=s>=i?j:h.getLineStart(h.getLineAtOffset(s)+1));var z=v&&v.match,G=v&&v.rule,H=v&&v.isEnd;if(v&&v.isSub)s=this.afterMatch(z),G instanceof this.BeginEndRule&&(p=!0,a&&G===
d.rule&&u===d.parent?(u=d,u.setStart(z),u.repaired=!0,u.endNeedsUpdate=!0,d=this.getNextExpected(d,"begin")):(a&&(this.prune(u,d),a=!1),z=new this.BeginEndNode(u,G,z),u.addChild(z),u=z));else if(H||s===j)u instanceof this.BeginEndNode&&(z?(p=!0,A=Math.max(A,u.end),u.setEnd(z),s=this.afterMatch(z),a&&u===d&&u.parent===d.parent?(u.repaired=!0,delete u.endNeedsUpdate,d=this.getNextExpected(d,"end")):a&&(this.prune(u,d),a=!1)):(u.setEnd(j),delete u.endNeedsUpdate)),u=u.parent;a&&(s>=m&&!p)&&(this.prune(b,
k),a=!1)}this.removeUnrepairedChildren(b,a,c);this.cleanup(a,b,c,m,j,e,f);return a?Math.max(A,s):s},removeUnrepairedChildren:function(b,a,c){if(a){for(var a=b.children,d=-1,e=0;e<a.length;e++){var f=a[e];if(!f.repaired&&this.isDamaged(f,c,Number.MAX_VALUE)){d=e;break}}-1!==d&&(b.children.length=d)}},cleanup:function(b,a,c,d,e,f,h){if(b){b=f-h;e=this.getIntersecting(d-b+1,e);a=this.getIntersecting(c,d);for(c=0;c<e.length;c++)d=e[c],!d.repaired&&d instanceof this.BeginEndNode&&(d.shiftEnd(b),d.shiftStart(b));
for(c=0;c<a.length;c++)d=a[c],d.repaired&&d.endNeedsUpdate&&d.shiftEnd(b),delete d.endNeedsUpdate,delete d.repaired}else{a=this.getIntersecting(c,d);for(c=0;c<a.length;c++)delete a[c].repaired}},getNextMatch:function(b,a,c,d){var e=b.getLineAtOffset(c),e=b.getLineEnd(e),f=b.getText(c,e),h=[],i=[],b=[],e=[];for(this.push(h,a.rule.subrules);h.length;){var j=h.length?h.pop():null,j=j&&j._resolvedRule._typedRule;if(j instanceof this.ContainerRule&&-1===i.indexOf(j))i.push(j),this.push(h,j.subrules);else if(!j||
!d||j.matchRegex){var k=j&&this.exec(j.matchRegex||j.beginRegex,f,c);k&&(b.push(k),e.push(j))}}h=Number.MAX_VALUE;i=-1;for(j=0;j<b.length;j++)k=b[j],k.index<h&&(h=k.index,i=j);if(!d&&(c=this.getEndMatch(a,f,c)))if(d=a.rule.applyEndPatternLast,-1===i||c.index<h||!d&&c.index===h)return{isEnd:!0,rule:a.rule,match:c};return-1===i?null:{isSub:!0,rule:e[i],match:b[i]}},getInitialExpected:function(b,a){var c,d;if(b===this._tree)for(c=0;c<b.children.length;c++){if(d=b.children[c],d.start>=a)return d}else if(b instanceof
this.BeginEndNode&&b.endMatch){var e=b.endMatch.index;for(c=0;c<b.children.length&&!(d=b.children[c],d.start>=a);c++);if(d&&d.start<e)return d}return b},getNextExpected:function(b,a){if("begin"===a){var c=b.children[0];return c?c:b}if("end"===a&&(c=b.parent)){var d=c.children[c.children.indexOf(b)+1];return d?d:c}return null},prune:function(b,a){a.parent===b?b.children.length=a.getIndexInParent():b instanceof this.BeginEndNode&&(b.endMatch=null,b.end=null);b.parent&&(b.parent.children.length=b.getIndexInParent()+
1)},onLineStyle:function(b){this._tree||this.initialParse();var a=b.lineStart,c=this.textView.getModel(),d=c.getLineEnd(b.lineIndex),e=c.getLineEnd(c.getLineAtOffset(a)-1),e=this.getFirstDamaged(e,e),a=this.getLineScope(c,e,a,d);b.ranges=this.toStyleRanges(a);b.ranges.sort(function(a,b){return a.start-b.start})},getLineScope:function(b,a,c,d){for(var e=c,f=this.getInitialExpected(a,c),h=[],i=[];a&&e<d;){var j=this.getNextMatch(b,a,e);if(!j)break;var k=j&&j.match,m=j&&j.rule,u=j&&j.isSub,j=j&&j.isEnd;
k.index!==e&&i.push({start:e,end:k.index,node:a});u?(e=this.afterMatch(k),m instanceof this.BeginEndRule?(this.addBeginScope(h,k,m),a=f,f=this.getNextExpected(f,"begin")):this.addMatchScope(h,k,m)):j&&(e=this.afterMatch(k),this.addEndScope(h,k,m),f=this.getNextExpected(f,"end"),a=a.parent)}e<d&&i.push({start:e,end:d,node:a});b=this.getInheritedLineScope(i,c,d);return h.concat(b)},getInheritedLineScope:function(b){for(var a=[],c=0;c<b.length;c++)for(var d=b[c],e=d.node;e;){var f=e.rule.rule,h=f.name;
if(f=f.contentName||h){this.addScopeRange(a,d.start,d.end,f);break}e=e.parent}return a},addBeginScope:function(b,a,c){var d=c.rule;this.addCapturesScope(b,a,d.beginCaptures||d.captures,c.isComplex,c.beginOld2New,c.beginConsuming)},addEndScope:function(b,a,c){var d=c.rule;this.addCapturesScope(b,a,d.endCaptures||d.captures,c.isComplex,c.endOld2New,c.endConsuming)},addMatchScope:function(b,a,c){var d=c.rule,e=d.name;(d=d.captures)?this.addCapturesScope(b,a,d,c.isComplex,c.matchOld2New,c.matchConsuming):
this.addScope(b,a,e)},addScope:function(b,a,c){c&&b.push({start:a.index,end:this.afterMatch(a),scope:c})},addScopeRange:function(b,a,c,d){d&&b.push({start:a,end:c,scope:d})},addCapturesScope:function(b,a,c,d,e,f){if(c)if(d){for(var d={1:0},h=0,i=1;void 0!==a[i];i++)void 0!==f[i]&&(h+=a[i].length),void 0!==a[i+1]&&(d[i+1]=h);f=a.index;for(h=1;c[h];h++){var i=c[h].name,j=e[h],k=f+d[j];"undefined"!==typeof a[j]&&this.addScopeRange(b,k,k+a[j].length,i)}}else this.addScope(b,a,c[0]&&c[0].name)},getIntersecting:function(b,
a){for(var c=[],d=this._tree?[this._tree]:[];d.length;){var e=d.pop(),f=!1;e instanceof this.ContainerNode?f=!0:this.isDamaged(e,b,a)&&(f=!0,c.push(e));if(f)for(var f=e.children.length,h=0;h<f;h++)d.push(e.children[h])}return c.reverse()},toStyleRanges:function(b){for(var a=[],c=0;c<b.length;c++){var d=b[c],e=this._styles[d.scope];if(!e)throw Error("styles not found for "+d.scope);e=e.join(" ");a.push({start:d.start,end:d.end,style:{styleClass:e}})}return a}};return{RegexUtil:d,TextMateStyler:i}});
define("orion/editor/htmlGrammar",[],function(){return{HtmlGrammar:function(){return{scopeName:"source.html",uuid:"3B5C76FB-EBB5-D930-F40C-047D082CE99B",patterns:[{begin:"<!(doctype|DOCTYPE)",end:">",contentName:"entity.name.tag.doctype.html",beginCaptures:{"0":{name:"entity.name.tag.doctype.html"}},endCaptures:{"0":{name:"entity.name.tag.doctype.html"}}},{begin:"<\!--",end:"--\>",beginCaptures:{"0":{name:"punctuation.definition.comment.html"}},endCaptures:{"0":{name:"punctuation.definition.comment.html"}},
patterns:[{match:"--",name:"invalid.illegal.badcomment.html"}],contentName:"comment.block.html"},{match:"<[A-Za-z0-9_\\-:]+(?= ?)",name:"entity.name.tag.html"},{include:"#attrName"},{include:"#qString"},{include:"#qqString"},{include:"#entity"},{match:"</[A-Za-z0-9_\\-:]+>",name:"entity.name.tag.html"},{match:">",name:"entity.name.tag.html"}],repository:{attrName:{match:"[A-Za-z\\-:]+(?=\\s*=\\s*['\"])",name:"entity.other.attribute.name.html"},qqString:{match:'(")[^"]+(")',name:"string.quoted.double.html"},
qString:{match:"(')[^']+(')",name:"string.quoted.single.html"},entity:{match:"&[A-Za-z0-9]+;",name:"constant.character.entity.html"}}}}}});
define("orion/editor/stylers/lib/syntax",[],function(){return{id:"orion.lib",grammars:[{id:"orion.lib",patterns:[{include:"#brace_open"},{include:"#brace_close"},{include:"#bracket_open"},{include:"#bracket_close"},{include:"#parenthesis_open"},{include:"#parenthesis_close"},{include:"#number_decimal"},{include:"#number_hex"},{include:"#string_doubleQuote"},{include:"#string_singleQuote"}],repository:{brace_open:{match:"{",name:"punctuation.section.block.begin"},brace_close:{match:"}",name:"punctuation.section.block.end"},
bracket_open:{match:"\\[",name:"punctuation.section.bracket.begin"},bracket_close:{match:"\\]",name:"punctuation.section.bracket.end"},parenthesis_open:{match:"\\(",name:"punctuation.section.parens.begin"},parenthesis_close:{match:"\\)",name:"punctuation.section.parens.end"},doc_block:{begin:"/\\*\\*",end:"\\*/",name:"comment.block.documentation",patterns:[{match:"@(?:(?!\\*/)\\S)*",name:"keyword.other.documentation.tag"},{match:"\\<\\S*\\>",name:"keyword.other.documentation.markup"},{match:"(\\b)(TODO)(\\b)(((?!\\*/).)*)",
name:"meta.annotation.task.todo",captures:{2:{name:"keyword.other.documentation.task"},4:{name:"comment.block"}}}]},number_decimal:{match:"\\b-?(?:\\.\\d+|\\d+\\.?\\d*)(?:[eE][+-]?\\d+)?\\b",name:"constant.numeric.number"},number_hex:{match:"\\b0[xX][0-9A-Fa-f]+\\b",name:"constant.numeric.hex"},string_doubleQuote:{match:'"(?:\\\\.|[^"])*"?',name:"string.quoted.double"},string_singleQuote:{match:"'(?:\\\\.|[^'])*'?",name:"string.quoted.single"},todo_comment_singleLine:{match:"(\\b)(TODO)(\\b)(.*)",
name:"meta.annotation.task.todo",captures:{2:{name:"keyword.other.documentation.task"},4:{name:"comment.line"}}}}},{id:"orion.c-like",patterns:[{include:"orion.lib"},{include:"#comment_singleLine"},{include:"#comment_block"}],repository:{comment_singleLine:{match:"//.*",name:"comment.line.double-slash",patterns:[{include:"orion.lib#todo_comment_singleLine"}]},comment_block:{begin:"/\\*",end:"\\*/",name:"comment.block",patterns:[{match:"(\\b)(TODO)(\\b)(((?!\\*/).)*)",name:"meta.annotation.task.todo",
captures:{2:{name:"keyword.other.documentation.task"},4:{name:"comment.block"}}}]}}}],keywords:[]}});
define("orion/editor/stylers/application_javascript/syntax",["orion/editor/stylers/lib/syntax"],function(k){var m="break case class catch continue const debugger default delete do else enum export extends false finally for function if implements import in instanceof interface let new null package private protected public return static super switch this throw true try typeof undefined var void while with yield".split(" "),k=k.grammars;k.push({id:"orion.js",contentTypes:["application/javascript"],patterns:[{include:"orion.lib#doc_block"},
{include:"orion.c-like"},{match:"\\b(?:"+m.join("|")+")\\b",name:"keyword.control.js"},{match:"/(?![\\s])(?:\\\\.|[^/])+/(?:[gim]{0,3})",name:"string.regexp.js"},{begin:"'(?:\\\\.|[^\\\\'])*\\\\$",end:"^(?:$|(?:\\\\.|[^\\\\'])*('|[^\\\\]$))",name:"string.quoted.single.js"},{begin:'"(?:\\\\.|[^\\\\"])*\\\\$',end:'^(?:$|(?:\\\\.|[^\\\\"])*("|[^\\\\]$))',name:"string.quoted.double.js"}]});return{id:k[k.length-1].id,grammars:k,keywords:m}});
define("orion/editor/stylers/text_x-java-source/syntax",["orion/editor/stylers/lib/syntax"],function(k){var m="abstract boolean break byte case catch char class continue default do double else extends false final finally float for if implements import instanceof int interface long native new null package private protected public return short static super switch synchronized this throw throws transient true try void volatile while".split(" "),k=k.grammars;k.push({id:"orion.java",contentTypes:["text/x-java-source"],
patterns:[{include:"orion.lib#doc_block"},{include:"orion.c-like"},{include:"#string_singleQuote"},{match:"\\b(?:"+m.join("|")+")\\b",name:"keyword.control.java"}],repository:{string_singleQuote:{}}});return{id:k[k.length-1].id,grammars:k,keywords:m}});
define("orion/editor/stylers/text_css/syntax",["orion/editor/stylers/lib/syntax"],function(k){var m="alignment-adjust alignment-baseline animation-delay animation-direction animation-duration animation-iteration-count animation-name animation-play-state animation-timing-function animation appearance azimuth backface-visibility background-attachment background-clip background-color background-image background-origin background-position background-repeat background-size background baseline-shift binding bleed bookmark-label bookmark-level bookmark-state bookmark-target border-bottom-color border-bottom-left-radius border-bottom-right-radius border-bottom-style border-bottom-width border-bottom border-collapse border-color border-image-outset border-image-repeat border-image-slice border-image-source border-image-width border-image border-left-color border-left-style border-left-width border-left border-radius border-right-color border-right-style border-right-width border-right border-spacing border-style border-top-color border-top-left-radius border-top-right-radius border-top-style border-top-width border-top border-width border bottom box-align box-decoration-break box-direction box-flex-group box-flex box-lines box-ordinal-group box-orient box-pack box-shadow box-sizing break-after break-before break-inside caption-side clear clip color-profile color column-count column-fill column-gap column-rule-color column-rule-style column-rule-width column-rule column-span column-width columns content counter-increment counter-reset crop cue-after cue-before cue cursor direction display dominant-baseline drop-initial-after-adjust drop-initial-after-align drop-initial-before-adjust drop-initial-before-align drop-initial-size drop-initial-value elevation empty-cells fit-position fit flex-align flex-flow flex-inline-pack flex-order flex-pack float-offset float font-family font-size font-size-adjust font-stretch font-style font-variant font-weight font grid-columns grid-rows hanging-punctuation height hyphenate-after hyphenate-before hyphenate-character hyphenate-lines hyphenate-resource hyphens icon image-orientation image-rendering image-resolution inline-box-align left letter-spacing line-height line-stacking-ruby line-stacking-shift line-stacking-strategy line-stacking list-style-image list-style-position list-style-type list-style margin-bottom margin-left margin-right margin-top margin mark-after mark-before mark marker-offset marks marquee-direction marquee-loop marquee-play-count marquee-speed marquee-style max-height max-width min-height min-width move-to nav-down nav-index nav-left nav-right nav-up opacity orphans outline-color outline-offset outline-style outline-width outline overflow-style overflow-x overflow-y overflow padding-bottom padding-left padding-right padding-top padding page-break-after page-break-before page-break-inside page-policy page pause-after pause-before pause perspective-origin perspective phonemes pitch-range pitch play-during position presentation-level punctuation-trim quotes rendering-intent resize rest-after rest-before rest richness right rotation-point rotation ruby-align ruby-overhang ruby-position ruby-span size speak-header speak-numeral speak-punctuation speak speech-rate stress string-set table-layout target-name target-new target-position target text-align-last text-align text-decoration text-emphasis text-height text-indent text-justify text-outline text-shadow text-transform text-wrap top transform-origin transform-style transform transition-delay transition-duration transition-property transition-timing-function transition unicode-bidi vertical-align visibility voice-balance voice-duration voice-family voice-pitch-range voice-pitch voice-rate voice-stress voice-volume volume white-space-collapse white-space widows width word-break word-spacing word-wrap z-index".split(" "),k=
k.grammars;k.push({id:"orion.css",contentTypes:["text/css"],patterns:[{include:"orion.lib"},{include:"orion.c-like#comment_block"},{include:"#number_hex"},{match:"(?:-webkit-|-moz-|-ms-|\\b)(?:"+m.join("|")+")\\b",name:"keyword.control.css"},{match:"(?i)\\b-?(?:\\.\\d+|\\d+\\.?\\d*)(?:%|em|ex|ch|rem|vw|vh|vmin|vmax|in|cm|mm|pt|pc|px|deg|grad|rad|turn|s|ms|Hz|kHz|dpi|dpcm|dppx)?\\b",name:"constant.numeric.value.css"},{begin:"(['\"])(?:\\\\.|[^\\\\\\1])*\\\\$",end:"^(?:$|(?:\\\\.|[^\\\\\\1])*(\\1|[^\\\\]$))",
name:"string.quoted.multiline.css"}],repository:{number_hex:{match:"#[0-9A-Fa-f]+\\b",name:"constant.numeric.hex.css"}}});return{id:k[k.length-1].id,grammars:k,keywords:m}});
define("examples/editor/textStyler",["orion/editor/annotations","orion/editor/stylers/application_javascript/syntax","orion/editor/stylers/text_x-java-source/syntax","orion/editor/stylers/text_css/syntax"],function(k,m,i,d){function c(a,b){this.keywords=a;this.whitespacesVisible=b;this.setText("")}function f(){c.call(this,null,!0)}function e(a){c.call(this,null,a)}function h(){c.call(this,null,!1)}function j(d,i,j){this.commentStart="/*";this.commentEnd="*/";var k=[];switch(i){case "java":k=a;break;
case "js":k=b;break;case "css":k=g}this.whitespacesVisible=this.spacesVisible=this.tabsVisible=!1;this.detectHyperlinks=!0;this.highlightCaretLine=!1;this.detectTasks=this.foldingEnabled=!0;this._scanner=new c(k,this.whitespacesVisible);this._firstScanner=new h;this._commentScanner=new e(this.whitespacesVisible);this._whitespaceScanner=new f;"css"===i&&(this._scanner.isCSS=!0,this._firstScanner.isCSS=!0);this.view=d;this.annotationModel=j;this._bracketAnnotations=void 0;var l=this;this._listener=
{onChanged:function(a){l._onModelChanged(a)},onDestroy:function(a){l._onDestroy(a)},onLineStyle:function(a){l._onLineStyle(a)},onMouseDown:function(a){l._onMouseDown(a)},onSelection:function(a){l._onSelection(a)}};i=d.getModel();i.getBaseModel&&(i=i.getBaseModel());i.addEventListener("Changed",this._listener.onChanged);d.addEventListener("MouseDown",this._listener.onMouseDown);d.addEventListener("Selection",this._listener.onSelection);d.addEventListener("Destroy",this._listener.onDestroy);d.addEventListener("LineStyle",
this._listener.onLineStyle);this._computeComments();this._computeFolding();d.redrawLines()}var b=m.keywords,a=i.keywords,g=d.keywords,l={styleClass:"comment"},n={styleClass:"comment"},q={styleClass:"comment block documentation"},r={styleClass:"keyword other documentation markup"},w={styleClass:"keyword other documentation task"},t={styleClass:"keyword other documentation tag"},x={styleClass:"string"},y={styleClass:"constant numeric"},u={styleClass:"keyword"},p={styleClass:"punctuation separator space",
unmergeable:!0},s={styleClass:"punctuation separator tab",unmergeable:!0},A={styleClass:"meta annotation currentLine"};c.prototype={getOffset:function(){return this.offset},getStartOffset:function(){return this.startOffset},getData:function(){return this.text.substring(this.startOffset,this.offset)},getDataLength:function(){return this.offset-this.startOffset},_default:function(a){switch(a){case 32:case 9:if(this.whitespacesVisible)return 32===a?11:10;do a=this._read();while(32===a||9===a);this._unread(a);
return 9;case 123:case 125:case 40:case 41:case 91:case 93:case 60:case 62:return a;default:var b=this.isCSS,c=this.offset-1;if(!b&&48<=a&&57>=a){var d=b=!1,e=!1,f=a;do if(a=this._read(),46===a&&!b)b=!0;else if(101===a&&!d)b=d=!0,a=this._read(),45!==a&&this._unread(a);else if(120===a&&48===f&&2===this.offset-c)b=d=e=!0;else if(!(48<=a&&57>=a||e&&(65<=a&&70>=a||97<=a&&102>=a)))break;while(1);this._unread(a);return 3}if(97<=a&&122>=a||65<=a&&90>=a||95===a||45===a&&b){do a=this._read();while(97<=a&&
122>=a||65<=a&&90>=a||95===a||48<=a&&57>=a||45===a&&b);this._unread(a);a=this.keywords;if(0<a.length){c=this.text.substring(c,this.offset);for(b=0;b<a.length;b++)if(this.keywords[b]===c)return 2}}return 1}},_read:function(){return this.offset<this.text.length?this.text.charCodeAt(this.offset++):-1},_unread:function(a){-1!==a&&this.offset--},nextToken:function(){for(this.startOffset=this.offset;;){var a=this._read(),b;switch(a){case -1:return null;case 47:a=this._read();if(!this.isCSS&&47===a)for(;;)if(a=
this._read(),-1===a||10===a||13===a)return this._unread(a),6;if(42===a){a=this._read();b=7;for(42===a&&(b=8);;){for(;42===a;)if(a=this._read(),47===a)return b;if(-1===a)return this._unread(a),b;a=this._read()}}this._unread(a);return 1;case 39:for(b=4;;)switch(a=this._read(),a){case 39:return b;case 13:case 10:case -1:return this._unread(a),b;case 92:switch(a=this._read(),a){case 10:b=5;break;case 13:b=5,a=this._read(),10!==a&&this._unread(a)}}break;case 34:for(b=4;;)switch(a=this._read(),a){case 34:return b;
case 13:case 10:case -1:return this._unread(a),b;case 92:switch(a=this._read(),a){case 10:b=5;break;case 13:b=5,a=this._read(),10!==a&&this._unread(a)}}break;default:return this._default(a)}}},setText:function(a){this.text=a;this.startOffset=this.offset=0}};f.prototype=new c(null);f.prototype.nextToken=function(){for(this.startOffset=this.offset;;){var a=this._read();switch(a){case -1:return null;case 32:return 11;case 9:return 10;default:do a=this._read();while(!(32===a||9===a||-1===a));this._unread(a);
return 1}}};e.prototype=new c(null);e.prototype.setType=function(a){this._type=a};e.prototype.nextToken=function(){for(this.startOffset=this.offset;;){var a=this._read();switch(a){case -1:return null;case 32:case 9:if(this.whitespacesVisible)return 32===a?11:10;do a=this._read();while(32===a||9===a);this._unread(a);return 9;case 60:if(8===this._type){do a=this._read();while(!(62===a||-1===a));if(62===a)return 12}return 1;case 64:if(8===this._type){do a=this._read();while(97<=a&&122>=a||65<=a&&90>=
a||95===a||48<=a&&57>=a);this._unread(a);return 13}return 1;case 84:if(79===(a=this._read()))if(68===(a=this._read()))if(79===(a=this._read()))if(a=this._read(),!(97<=a&&122>=a||65<=a&&90>=a||95===a||48<=a&&57>=a))return this._unread(a),14;this._unread(a);default:do a=this._read();while(!(32===a||9===a||-1===a||60===a||64===a||84===a));this._unread(a);return 1}}};h.prototype=new c(null);h.prototype._default=function(a){for(;;)switch(a=this._read(),a){case 47:case 34:case 39:case -1:return this._unread(a),
1}};j.prototype={destroy:function(){var a=this.view;if(a){var b=a.getModel();b.getBaseModel&&(b=b.getBaseModel());b.removeEventListener("Changed",this._listener.onChanged);a.removeEventListener("MouseDown",this._listener.onMouseDown);a.removeEventListener("Selection",this._listener.onSelection);a.removeEventListener("Destroy",this._listener.onDestroy);a.removeEventListener("LineStyle",this._listener.onLineStyle);this.view=null}},setHighlightCaretLine:function(a){this.highlightCaretLine=a},setWhitespacesVisible:function(a,
b){this.whitespacesVisible!==a&&(this.whitespacesVisible=a,this._scanner.whitespacesVisible=a,this._commentScanner.whitespacesVisible=a,b&&this.view.redraw())},setTabsVisible:function(a){this.tabsVisible!==a&&(this.tabsVisible=a,this.setWhitespacesVisible(this.tabsVisible||this.spacesVisible,!1),this.view.redraw())},setSpacesVisible:function(a){this.spacesVisible!==a&&(this.spacesVisible=a,this.setWhitespacesVisible(this.tabsVisible||this.spacesVisible,!1),this.view.redraw())},setDetectHyperlinks:function(a){this.detectHyperlinks=
a},setFoldingEnabled:function(a){this.foldingEnabled=a},setDetectTasks:function(a){this.detectTasks=a},_binarySearch:function(a,b,c,d,e){var f;void 0===d&&(d=-1);void 0===e&&(e=a.length);for(;1<e-d;)if(f=Math.floor((e+d)/2),b<=a[f].start)e=f;else if(c&&b<a[f].end){e=f;break}else d=f;return e},_computeComments:function(){var a=this.view.getModel();a.getBaseModel&&(a=a.getBaseModel());this.comments=this._findComments(a.getText())},_computeFolding:function(){if(this.foldingEnabled){var a=this.view.getModel();
if(a.getBaseModel){var b=this.annotationModel;if(b){b.removeAnnotations(k.AnnotationType.ANNOTATION_FOLDING);for(var c=[],d=a.getBaseModel(),e=this.comments,f=0;f<e.length;f++){var g=e[f];(g=this._createFoldingAnnotation(a,d,g.start,g.end))&&c.push(g)}b.replaceAnnotations(null,c)}}}},_createFoldingAnnotation:function(a,b,c,d){var e=b.getLineAtOffset(c),b=b.getLineAtOffset(d);return e===b?null:new (k.AnnotationType.getType(k.AnnotationType.ANNOTATION_FOLDING))(c,d,a)},_computeTasks:function(a,b,c){if(this.detectTasks){var d=
this.annotationModel;if(d){var e=this.view.getModel(),f=e;e.getBaseModel&&(f=e.getBaseModel());for(var g=d.getAnnotations(b,c),e=[],h=k.AnnotationType.ANNOTATION_TASK;g.hasNext();){var i=g.next();i.type===h&&e.push(i)}g=[];i=this._commentScanner;i.setText(f.getText(b,c));for(var j;j=i.nextToken();){var l=i.getStartOffset()+b;14===j&&(j=f.getLineEnd(f.getLineAtOffset(l)),6!==a&&(j=Math.min(j,c-this.commentEnd.length)),g.push(k.AnnotationType.createAnnotation(h,l,j,f.getText(l,j))))}d.replaceAnnotations(e,
g)}}},_getLineStyle:function(a){if(this.highlightCaretLine){var b=this.view,c=b.getModel(),b=b.getSelection();if(b.start===b.end&&c.getLineAtOffset(b.start)===a)return A}return null},_getStyles:function(a,b,c){a.getBaseModel&&(c=a.mapOffset(c));for(var d=c+b.length,e=[],f=c,g=this.comments,h=this._binarySearch(g,c,!0);h<g.length&&!(g[h].start>=d);h++){var i=g[h].start,j=g[h].end;f<i&&this._parse(b.substring(f-c,i-c),f,e);var k=g[h].type,l;switch(k){case 8:l=q;break;case 7:l=n;break;case 5:l=x}f=Math.max(f,
i);i=Math.min(d,j);(8===k||7===k)&&(this.whitespacesVisible||this.detectHyperlinks)?this._parseComment(b.substring(f-c,i-c),f,e,l,k):5===k&&this.whitespacesVisible?this._parseString(b.substring(f-c,i-c),f,e,x):e.push({start:f,end:i,style:l});f=j}f<d&&this._parse(b.substring(f-c,d-c),f,e);if(a.getBaseModel)for(b=0;b<e.length;b++)c=e[b].end-e[b].start,e[b].start=a.mapOffset(e[b].start,!0),e[b].end=e[b].start+c;return e},_parse:function(a,b,c){var d=this._scanner;for(d.setText(a);a=d.nextToken();){var e=
d.getStartOffset()+b,f=null;switch(a){case 2:f=u;break;case 3:f=y;break;case 5:case 4:if(this.whitespacesVisible){this._parseString(d.getData(),e,c,x);continue}else f=x;break;case 8:this._parseComment(d.getData(),e,c,q,a);continue;case 6:this._parseComment(d.getData(),e,c,l,a);continue;case 7:this._parseComment(d.getData(),e,c,n,a);continue;case 10:this.whitespacesVisible&&this.tabsVisible&&(f=s);break;case 11:this.whitespacesVisible&&this.spacesVisible&&(f=p)}c.push({start:e,end:d.getOffset()+b,
style:f})}},_parseComment:function(a,b,c,d,e){var f=this._commentScanner;f.setText(a);for(f.setType(e);a=f.nextToken();){var e=f.getStartOffset()+b,g=d;switch(a){case 10:this.whitespacesVisible&&this.tabsVisible&&(g=s);break;case 11:this.whitespacesVisible&&this.spacesVisible&&(g=p);break;case 12:g=r;break;case 13:g=t;break;case 14:g=w;break;default:this.detectHyperlinks&&(g=this._detectHyperlinks(f.getData(),e,c,g))}g&&c.push({start:e,end:f.getOffset()+b,style:g})}},_parseString:function(a,b,c,d){var e=
this._whitespaceScanner;for(e.setText(a);a=e.nextToken();){var f=e.getStartOffset()+b,g=d;switch(a){case 10:this.whitespacesVisible&&this.tabsVisible&&(g=s);break;case 11:this.whitespacesVisible&&this.spacesVisible&&(g=p)}g&&c.push({start:f,end:e.getOffset()+b,style:g})}},_detectHyperlinks:function(a,b,c,d){var e=null,f;if(0<(f=a.indexOf("://"))){for(var e=a,g=f;0<g;){f=e.charCodeAt(g-1);if(!(97<=f&&122>=f||65<=f&&90>=f||45===f||48<=f&&57>=f))break;g--}if(0<g&&(f="\"\"''(){}[]<>".indexOf(e.substring(g-
1,g)),-1!==f&&0===(f&1)&&-1!==(f=e.lastIndexOf("\"\"''(){}[]<>".substring(f+1,f+2))))){var h=f;f=this._clone(d);f.tagName="a";f.attributes={href:e.substring(g,h)};c.push({start:b,end:b+g,style:d});c.push({start:b+g,end:b+h,style:f});c.push({start:b+h,end:b+a.length,style:d});return null}}else 0===a.toLowerCase().indexOf("bug#")&&(e="https://bugs.eclipse.org/bugs/show_bug.cgi?id="+parseInt(a.substring(4),10));return e?(f=this._clone(d),f.tagName="a",f.attributes={href:e},f):d},_clone:function(a){if(!a)return a;
var b={},c;for(c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},_findComments:function(a,b){var b=b||0,c=this._firstScanner,d;c.setText(a);for(var e=[];d=c.nextToken();)(7===d||8===d||5===d)&&e.push({start:c.getStartOffset()+b,end:c.getOffset()+b,type:d}),(6===d||7===d||8===d)&&this._computeTasks(d,c.getStartOffset()+b,c.getOffset()+b);return e},_findMatchingBracket:function(a,b){var c="{}()[]<>",d=a.getText(b,b+1),e=c.indexOf(d,0);if(-1===e)return-1;var f;f=e&1?c.substring(e-1,e):c.substring(e+
1,e+2);for(var g=a.getLineAtOffset(b),c=a.getLine(g),h=a.getLineStart(g),i=a.getLineEnd(g),c=this._findBrackets(d,f,c,h,h,i),i=0;i<c.length;i++)if(h=0<=c[i]?1:-1,c[i]*h-1===b){var j=1;if(e&1){for(i--;0<=i;i--)if(h=0<=c[i]?1:-1,j+=h,0===j)return c[i]*h-1;for(g-=1;0<=g;){c=a.getLine(g);h=a.getLineStart(g);i=a.getLineEnd(g);c=this._findBrackets(d,f,c,h,h,i);for(e=c.length-1;0<=e;e--)if(h=0<=c[e]?1:-1,j+=h,0===j)return c[e]*h-1;g--}}else{for(i++;i<c.length;i++)if(h=0<=c[i]?1:-1,j+=h,0===j)return c[i]*
h-1;g+=1;for(e=a.getLineCount();g<e;){c=a.getLine(g);h=a.getLineStart(g);i=a.getLineEnd(g);c=this._findBrackets(d,f,c,h,h,i);for(i=0;i<c.length;i++)if(h=0<=c[i]?1:-1,j+=h,0===j)return c[i]*h-1;g++}}break}return-1},_findBrackets:function(a,b,c,d,e,f){for(var g=[],a=a.charCodeAt(0),b=b.charCodeAt(0),h=e,i=this._scanner,j,k=this.comments,l=this._binarySearch(k,e,!0);l<k.length&&!(k[l].start>=f);l++){j=k[l].start;var m=k[l].end;if(h<j)for(i.setText(c.substring(h-e,j-e));j=i.nextToken();)j===a?g.push(i.getStartOffset()+
h-e+d+1):j===b&&g.push(-(i.getStartOffset()+h-e+d+1));h=m}if(h<f)for(i.setText(c.substring(h-e,f-e));j=i.nextToken();)j===a?g.push(i.getStartOffset()+h-e+d+1):j===b&&g.push(-(i.getStartOffset()+h-e+d+1));return g},_onDestroy:function(){this.destroy()},_onLineStyle:function(a){a.textView===this.view&&(a.style=this._getLineStyle(a.lineIndex));a.ranges=this._getStyles(a.textView.getModel(),a.lineText,a.lineStart)},_onSelection:function(a){var b=a.oldValue,c=a.newValue,d=this.view,a=d.getModel(),e;if(this.highlightCaretLine){var f=
a.getLineAtOffset(b.start);e=a.getLineAtOffset(c.start);var g=c.start===c.end,b=b.start===b.end;f===e&&b&&g||(b&&d.redrawLines(f,f+1),(f!==e||!b)&&g&&d.redrawLines(e,e+1))}if(this.annotationModel){var b=this._bracketAnnotations,h,i;if(c.start===c.end&&0<(i=d.getCaretOffset()))i-=1,a.getBaseModel&&(i=a.mapOffset(i),a=a.getBaseModel()),a=this._findMatchingBracket(a,i),-1!==a&&(h=[k.AnnotationType.createAnnotation(k.AnnotationType.ANNOTATION_MATCHING_BRACKET,a,a+1),k.AnnotationType.createAnnotation(k.AnnotationType.ANNOTATION_CURRENT_BRACKET,
i,i+1)]);this._bracketAnnotations=h;this.annotationModel.replaceAnnotations(b,h)}},_onMouseDown:function(a){if(2===a.clickCount){var b=this.view,c=b.getModel(),d=b.getOffsetAtLocation(a.x,a.y);if(0<d){var e=d-1,f=c;c.getBaseModel&&(e=c.mapOffset(e),f=c.getBaseModel());e=this._findMatchingBracket(f,e);-1!==e&&(a.preventDefault(),a=e,c.getBaseModel&&(a=c.mapOffset(a,!0)),d>a&&(d--,a++),b.setSelection(a,d))}}},_onModelChanged:function(a){var b=a.start,c=a.removedCharCount,d=a.addedCharCount-c,e=this.view,
a=e.getModel(),f=a.getBaseModel?a.getBaseModel():a,c=b+c,g=f.getCharCount(),h=this.comments.length,i=f.getLineStart(f.getLineAtOffset(b)),j=this._binarySearch(this.comments,i,!0),l=this._binarySearch(this.comments,c,!1,j-1,h);j<h&&this.comments[j].start<=i&&i<this.comments[j].end?(i=this.comments[j].start,i>b&&(i+=d)):i=j===h&&0<h&&g-d===this.comments[h-1].end?this.comments[h-1].start:i;var m;l<h?(m=this.comments[l].end,m>b&&(m+=d),l+=1):(l=h,m=g);for(var g=f.getText(i,m),n,g=this._findComments(g,
i),h=j;h<this.comments.length;h++)n=this.comments[h],n.start>b&&(n.start+=d),n.start>b&&(n.end+=d);var p=l-j!==g.length;if(!p)for(h=0;h<g.length;h++){n=this.comments[j+h];var q=g[h];if(n.start!==q.start||n.end!==q.end||n.type!==q.type){p=!0;break}}h=[j,l-j].concat(g);Array.prototype.splice.apply(this.comments,h);p&&(h=i,n=m,a!==f&&(h=a.mapOffset(h,!0),n=a.mapOffset(n,!0)),e.redrawRange(h,n));if(this.foldingEnabled&&f!==a&&this.annotationModel){e=this.annotationModel;j=e.getAnnotations(i,m);i=[];for(m=
[];j.hasNext();)if(n=j.next(),n.type===k.AnnotationType.ANNOTATION_FOLDING){m.push(n);for(h=0;h<g.length&&!(n.start===g[h].start&&n.end===g[h].end);h++);h===g.length?(i.push(n),n.expand()):(h=n.start,l=n.end,h>b&&(h-=d),l>b&&(l-=d),h<=b&&(b<l&&h<=c&&c<l)&&(h=f.getLineAtOffset(n.start),l=f.getLineAtOffset(n.end),h!==l?n.expanded||n.expand():e.removeAnnotation(n)))}b=[];for(h=0;h<g.length;h++){n=g[h];for(d=0;d<m.length&&!(m[d].start===n.start&&m[d].end===n.end);d++);d===m.length&&(n=this._createFoldingAnnotation(a,
f,n.start,n.end))&&b.push(n)}e.replaceAnnotations(i,b)}}};return{TextStyler:j}});
define("orion/compare/compareHighlighter",["orion/Deferred","orion/editor/textMateStyler","orion/editor/htmlGrammar","examples/editor/textStyler"],function(k,m,i,d){var c={},f=function(){this.styler=null};f.prototype={highlight:function(c,f,j){this.styler&&(this.styler.destroy(),this.styler=null);c=c.split(".");f="js";1<c.length&&(f=c[c.length-1]);if(c=f){var f=j.getTextView(),b=j.getAnnotationModel();switch(c){case "js":case "java":case "css":this.styler=new d.TextStyler(f,c,b);break;case "html":this.styler=
new m.TextMateStyler(f,new i.HtmlGrammar)}return(new k).resolve(j)}return null}};c.DefaultHighlighter=f;return c});
define("compare/builder/compare",["orion/commandRegistry","orion/Deferred","orion/compare/compareView","orion/compare/compareCommands","orion/compare/compareHighlighter"],function(k,m,i,d,c){function f(b){var a=b.split("."),b="js";1<a.length&&(b=a[a.length-1]);a={id:"application/javascript"};switch(b){case "java":a.id="text/x-java-source";break;case "css":a.id="text/css"}return a}function e(b){var a=new m,c=new XMLHttpRequest;c.open("GET",b,!0);c.onreadystatechange=function(){if(4===c.readyState){var b=
"undefined"!==typeof c.response?c.response:c.responseText,b="string"===typeof b?b:null,d=c.status;200<=d&&400>d?a.resolve(b):a.reject(b)}};c.send();return a}function h(b,a,e,h){!b.highlighters&&(b.oldFile&&b.oldFile.Name&&b.newFile&&b.newFile.Name)&&(b.highlighters=[new c.DefaultHighlighter,new c.DefaultHighlighter]);b.oldFile&&b.oldFile.Name&&(b.oldFile.Type=f(b.oldFile.Name));b.newFile&&b.newFile.Name&&(b.newFile.Type=f(b.newFile.Name));a&&(a=new d.CompareCommandFactory({commandService:j,commandSpanId:a}),
b.commandProvider=a);e="inline"===e?"inline":"twoWay";this.compareView=h?new i.toggleableCompareView(e,b):"inline"===e?new i.inlineCompareView(b):new i.TwoWayCompareView(b);this.compareView.startup()}var j=new k.CommandRegistry({});h.prototype={getCompareView:function(){return this.compareView},refresh:function(){var b=this.getCompareView().getWidget().options;if(b.oldFile.URL&&b.newFile.URL){var a=[];a.push(e(b.oldFile.URL));a.push(e(b.newFile.URL));m.all(a,function(a){return{_error:a}}).then(function(a){this.getCompareView().getWidget().options.oldFile.Content=
a[0];this.getCompareView().getWidget().options.newFile.Content=a[1];this.getCompareView().getWidget().refresh(!0)}.bind(this))}else this.getCompareView().getWidget().refresh(!0)}};return h});orion=this.orion||(this.orion={});var compare=orion.compare||(orion.compare={});compare.comparer=require("compare/builder/compare");