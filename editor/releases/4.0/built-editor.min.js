/*

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
 Felipe Heidrich (IBM Corporation) - initial API and implementation
 Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
 Felipe Heidrich (IBM Corporation) - initial API and implementation
 Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
 Felipe Heidrich (IBM Corporation) - initial API and implementation
 Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
 Felipe Heidrich (IBM Corporation) - initial API and implementation
 Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
 Felipe Heidrich (IBM Corporation) - initial API and implementation
 Silenio Quarti (IBM Corporation) - initial API and implementation
 Mihai Sucan (Mozilla Foundation) - fix for Bug#334583 Bug#348471 Bug#349485 Bug#350595 Bug#360726 Bug#361180 Bug#362835 Bug#362428 Bug#362286 Bug#354270 Bug#361474 Bug#363945 Bug#366312 Bug#370584

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
 Felipe Heidrich (IBM Corporation) - initial API and implementation
 Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
 Felipe Heidrich (IBM Corporation) - initial API and implementation
 Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
 Felipe Heidrich (IBM Corporation) - initial API and implementation
 Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2009, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made
 available under the terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors:
 IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 Copyright (c) 2012 VMware, Inc.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation
 Andrew Eisenberg - rename to jsTemplateContentAssist.js

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation 

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation 

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation 

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made
 available under the terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors: IBM Corporation - initial API and implementation
 Alex Lakatos - fix for bug#369781

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation
 RequireJS i18n 2.0.2 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/requirejs/i18n for details

 Copyright (c) 2011 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation
*/
var requirejs,require,define;
(function(j){function o(a,c){var d,l,t,x,e,b,k,h,f,m=c&&c.split("/"),i=p.map,g=i&&i["*"]||{};if(a&&a.charAt(0)===".")if(c){m=m.slice(0,m.length-1);a=m.concat(a.split("/"));for(h=0;h<a.length;h+=1)if(d=a[h],d===".")a.splice(h,1),h-=1;else if(d==="..")if(h===1&&(a[2]===".."||a[0]===".."))break;else h>0&&(a.splice(h-1,2),h-=2);a=a.join("/")}else a.indexOf("./")===0&&(a=a.substring(2));if((m||g)&&i){d=a.split("/");for(h=d.length;h>0;h-=1){l=d.slice(0,h).join("/");if(m)for(f=m.length;f>0;f-=1)if(t=i[m.slice(0,
f).join("/")])if(t=t[l]){x=t;e=h;break}if(x)break;!b&&g&&g[l]&&(b=g[l],k=h)}!x&&b&&(x=b,e=k);x&&(d.splice(0,e,x),a=d.join("/"))}return a}function n(c,d){return function(){return a.apply(j,s.call(arguments,0).concat([c,d]))}}function g(a){return function(c){return o(c,a)}}function b(a){return function(c){k[a]=c}}function f(a){if(r.call(m,a)){var c=m[a];delete m[a];q[a]=!0;h.apply(j,c)}if(!r.call(k,a)&&!r.call(q,a))throw Error("No "+a);return k[a]}function e(a){var c,d=a?a.indexOf("!"):-1;d>-1&&(c=
a.substring(0,d),a=a.substring(d+1,a.length));return[c,a]}function i(a){return function(){return p&&p.config&&p.config[a]||{}}}var h,a,c,d,k={},m={},p={},q={},r=Object.prototype.hasOwnProperty,s=[].slice;c=function(a,c){var d,l=e(a),t=l[0],a=l[1];t&&(t=o(t,c),d=f(t));t?a=d&&d.normalize?d.normalize(a,g(c)):o(a,c):(a=o(a,c),l=e(a),t=l[0],a=l[1],t&&(d=f(t)));return{f:t?t+"!"+a:a,n:a,pr:t,p:d}};d={require:function(a){return n(a)},exports:function(a){var c=k[a];return typeof c!=="undefined"?c:k[a]={}},
module:function(a){return{id:a,uri:"",exports:k[a],config:i(a)}}};h=function(a,e,h,l){var t,x,y,i,g=[],p,l=l||a;if(typeof h==="function"){e=!e.length&&h.length?["require","exports","module"]:e;for(i=0;i<e.length;i+=1)if(y=c(e[i],l),x=y.f,x==="require")g[i]=d.require(a);else if(x==="exports")g[i]=d.exports(a),p=!0;else if(x==="module")t=g[i]=d.module(a);else if(r.call(k,x)||r.call(m,x)||r.call(q,x))g[i]=f(x);else if(y.p)y.p.load(y.n,n(l,!0),b(x),{}),g[i]=k[x];else throw Error(a+" missing "+x);e=h.apply(k[a],
g);if(a)if(t&&t.exports!==j&&t.exports!==k[a])k[a]=t.exports;else if(e!==j||!p)k[a]=e}else a&&(k[a]=h)};requirejs=require=a=function(e,b,k,l,t){if(typeof e==="string")return d[e]?d[e](b):f(c(e,b).f);else e.splice||(p=e,b.splice?(e=b,b=k,k=null):e=j);b=b||function(){};typeof k==="function"&&(k=l,l=t);l?h(j,e,b,k):setTimeout(function(){h(j,e,b,k)},4);return a};a.config=function(c){p=c;return a};define=function(a,c,d){c.splice||(d=c,c=[]);!r.call(k,a)&&!r.call(m,a)&&(m[a]=[a,c,d])};define.amd={jQuery:!0}})();
define("almond",function(){});
define("orion/editor/shim",[],function(){if(!Object.create)Object.create=function(j,o){function n(){}n.prototype=j;var g=new n;if(o)for(var b in o)o.hasOwnProperty(b)&&(g[b]=o[b].hasOwnProperty("value")?o[b].value:function(){if(arguments.length>0)return o[b].get();else o[b].set(arguments)});return g};if(!Object.keys)Object.keys=function(j){var o=[],n;for(n in j)j.hasOwnProperty(n)&&o.push(n);return o};if(!Function.prototype.bind)Function.prototype.bind=function(j){var o=this,n=Array.prototype.slice.call(arguments,
1);return n.length?function(){return arguments.length?o.apply(j,n.concat(Array.prototype.slice.call(arguments))):o.apply(j,n)}:function(){return arguments.length?o.apply(j,arguments):o.call(j)}};if(!Array.prototype.indexOf)Array.prototype.indexOf=function(j){for(var o=0;o<this.length;o++)if(this[o]===j)return o;return-1};if(!Array.prototype.forEach)Array.prototype.forEach=function(j){for(var o=0;o<this.length;o++)j(this[o],o)};if(!Array.prototype.map)Array.prototype.map=function(j){for(var o=Array(this.length),
n=0;n<this.length;n++)o[n]=j(this[n]);return o};if(!Array.prototype.reduce)Array.prototype.reduce=function(j,o){var n,g=!1;1<arguments.length&&(n=o,g=!0);for(var b=0;this.length>b;++b)g?n=j(n,this[b],b,this):(n=this[b],g=!0);return n};if(!String.prototype.trim)String.prototype.trim=function(){return this.replace(/^\s+/,"")};if(!String.prototype.trimLeft)String.prototype.trimLeft=function(){return this.replace(/\s+$/,"")};if(!String.prototype.trimRight)String.prototype.trimRight=function(){return this.replace(/^\s+|\s+$/g,
"")};return{}});
(function(){function j(b,f,e,i,h,a){f[b]&&(e.push(b),(f[b]===!0||f[b]===1)&&i.push(h+b+"/"+a))}function o(b,f,e,i,h){f=i+f+"/"+h;require._fileExists(b.toUrl(f+".js"))&&e.push(f)}function n(b,f,e){for(var i in f)f.hasOwnProperty(i)&&(!b.hasOwnProperty(i)||e)?b[i]=f[i]:typeof f[i]==="object"&&n(b[i],f[i],e)}var g=/(^.*(^|\/)nls(\/|$))([^\/]*)\/?([^\/]*)/;define("i18n",["module"],function(b){var f=b.config?b.config():{};return{version:"2.0.1+",load:function(e,b,h,a){a=a||{};if(a.locale)f.locale=a.locale;
var c=g.exec(e),d=c[1],k=c[4],m=c[5],p=k.split("-"),q=[],r={},s,w="";if(c[5])d=c[1],e=d+m;else{m=c[4];k=f.locale;if(!k)k=f.locale=typeof navigator==="undefined"?"root":(navigator.language||navigator.userLanguage||"root").toLowerCase();p=k.split("-")}if(a.isBuild){q.push(e);o(b,"root",q,d,m);for(s=0;s<p.length;s++)a=p[s],w+=(w?"-":"")+a,o(b,w,q,d,m);b(q,function(){h()})}else b([e],function(a){var c=[],l;j("root",a,c,q,d,m);for(s=0;s<p.length;s++)l=p[s],w+=(w?"-":"")+l,j(w,a,c,q,d,m);b(q,function(){var l,
x,e;for(l=c.length-1;l>-1&&c[l];l--){e=c[l];x=a[e];if(x===!0||x===1)x=b(d+e+"/"+m);n(r,x)}h(r)})})}}})})();define("orion/editor/i18n",{load:function(j,o,n){o.specified&&o.specified("orion/bootstrap")?o(["orion/i18n!"+j],function(g){n(g)}):n({})}});
define("orion/editor/nls/root/messages",{multipleAnnotations:"Multiple annotations:",line:"Line: ${0}",breakpoint:"Breakpoint",bookmark:"Bookmark",task:"Task",error:"Error",warning:"Warning",matchingSearch:"Matching Search",currentSearch:"Current Search",currentLine:"Current Line",matchingBracket:"Matching Bracket",currentBracket:"Current Bracket",lineUp:"Line Up",lineDown:"Line Down",lineStart:"Line Start",lineEnd:"Line End",charPrevious:"Previous Character",charNext:"Next Character",pageUp:"Page Up",
pageDown:"Page Down",scrollPageUp:"Scroll Page Up",scrollPageDown:"Scroll Page Down",scrollLineUp:"Scroll Line Up",scrollLineDown:"Scroll Line Down",wordPrevious:"Previous Word",wordNext:"Next Word",textStart:"Document Start",textEnd:"Document End",scrollTextStart:"Scroll Document Start",scrollTextEnd:"Scroll Document End",centerLine:"Center Line",selectLineUp:"Select Line Up",selectLineDown:"Select Line Down",selectWholeLineUp:" Select Whole Line Up",selectWholeLineDown:"Select Whole Line Down",
selectLineStart:"Select Line Start",selectLineEnd:"Select Line End",selectCharPrevious:"Select Previous Character",selectCharNext:"Select Next Character",selectPageUp:"Select Page Up",selectPageDown:"Select Page Down",selectWordPrevious:"Select Previous Word",selectWordNext:"Select Next Word",selectTextStart:"Select Document Start",selectTextEnd:"Select Document End",deletePrevious:"Delete Previous Character",deleteNext:"Delete Next Character",deleteWordPrevious:"Delete Previous Word",deleteWordNext:"Delete Next Word",
deleteLineStart:"Delete Line Start",deleteLineEnd:"Delete Line End",tab:"Insert Tab",enter:"Insert Line Delimiter",enterNoCursor:"Insert Line Delimiter",selectAll:"Select All",copy:"Copy",cut:"Cut",paste:"Paste",uppercase:"To Upper Case",lowercase:"To Lower Case",capitalize:"Capitalize",reversecase:"Reverse Case",toggleWrapMode:"Toggle Wrap Mode",toggleTabMode:"Toggle Tab Mode",toggleOverwriteMode:"Toggle Overwrite Mode",committerOnTime:"${0} on ${1}",emacs:"Emacs",exchangeMarkPoint:"Exchange Mark and Point",
setMarkCommand:"Set Mark",clearMark:"Clear Mark",digitArgument:"Digit Argument ${0}",negativeArgument:"Negative Argument",Comment:"Comment","Flat outline":"Flat outline",incrementalFindStr:"Incremental find: ${0}",incrementalFindStrNotFound:"Incremental find: ${0} (not found)",incrementalFindReverseStr:"Reverse Incremental find: ${0}",incrementalFindReverseStrNotFound:"Reverse Incremental find: ${0} (not found)",find:"Find...",undo:"Undo",redo:"Redo",cancelMode:"Cancel Current Mode",findNext:"Find Next Occurrence",
findPrevious:"Find Previous Occurrence",incrementalFind:"Incremental Find",incrementalFindReverse:"Incremental Find Reverse",indentLines:"Indent Lines",unindentLines:"Unindent Lines",moveLinesUp:"Move Lines Up",moveLinesDown:"Move Lines Down",copyLinesUp:"Copy Lines Up",copyLinesDown:"Copy Lines Down",deleteLines:"Delete Lines",gotoLine:"Goto Line...",gotoLinePrompty:"Goto Line:",nextAnnotation:"Next Annotation",prevAnnotation:"Previous Annotation",expand:"Expand",collapse:"Collapse",expandAll:"Expand All",
collapseAll:"Collapse All",lastEdit:"Last Edit Location",trimTrailingWhitespaces:"Trim Trailing Whitespaces",toggleLineComment:"Toggle Line Comment",addBlockComment:"Add Block Comment",removeBlockComment:"Remove Block Comment",linkedModeEntered:"Linked Mode entered",linkedModeExited:"Linked Mode exited",syntaxError:"Syntax Error",contentAssist:"Content Assist",lineColumn:"Line ${0} : Col ${1}",vi:"vi",vimove:"(Move)",viyank:"(Yank)",videlete:"(Delete)",vichange:"(Change)",viLeft:"${0} Left",viRight:"${0} Right",
viUp:"${0} Up",viDown:"${0} Down",viw:"${0} Next Word",vib:"${0} Beginning of Word",viW:"${0} Next Word (ws stop)",viB:"${0} Beginning of Word (ws stop)",vie:"${0} End of Word",viE:"${0} End of Word (ws stop)",vi$:"${0} End of the line","vi^_":"${0} First non-blank Char Current Line","vi+":"${0} First Char Next Line","vi-":"${0} First Char Previous Line","vi|":"${0} nth Column in Line",viH:"${0} Top of Page",viM:"${0} Middle of Page",viL:"${0} Bottom of Page","vi/":"${0} Search Forward","vi?":"${0} Search Backward",
vin:"${0} Next Search",viN:"${0} Previous Search",vif:"${0} Search Char Fwd",viF:"${0} Search Char Bckwd",vit:"${0} Search Before Char Fwd",viT:"${0} Search Before Char Bckwd","vi,":"${0} Repeat Reverse Char Search","vi;":"${0} Repeat Char Search",viG:"${0} Go to Line",viycd:"${0} Current Line",via:"Append After Cursor",viA:"Append to End of Line",vii:"Insert Before Cursor",viI:"Insert at Beginning of Line",viO:"Insert Line Above",vio:"Insert Line Below",viR:"Begin Overwriting Text",vis:"Substitute a Character",
viS:"Substitute Entire Line",viC:"Change Text Until Line End",vip:"Paste After Char or Line",viP:"Paste Before Char or Line",replaceAll:"Replacing all...",replacedMatches:"Replaced ${0} matches",nothingReplaced:"Nothing replaced",notFound:"Not found"});define("orion/editor/nls/messages",["orion/editor/i18n!orion/editor/nls/messages","orion/editor/nls/root/messages"],function(j,o){var n={root:o},g;for(g in j)j.hasOwnProperty(g)&&typeof n[g]==="undefined"&&(n[g]=j[g]);return n});
define("orion/editor/eventTarget",[],function(){function j(){}j.addMixin=function(o){var n=j.prototype,g;for(g in n)n.hasOwnProperty(g)&&(o[g]=n[g])};j.prototype={addEventListener:function(j,n,g){if(!this._eventTypes)this._eventTypes={};var b=this._eventTypes[j];b||(b=this._eventTypes[j]={level:0,listeners:[]});b.listeners.push({listener:n,useCapture:g})},dispatchEvent:function(j){var n=j.type;this._dispatchEvent("pre"+n,j);this._dispatchEvent(n,j);this._dispatchEvent("post"+n,j)},_dispatchEvent:function(j,
n){var g=this._eventTypes?this._eventTypes[j]:null;if(g){var b=g.listeners;try{if(g.level++,b)for(var f=0,e=b.length;f<e;f++)if(b[f]){var i=b[f].listener;typeof i==="function"?i.call(this,n):i.handleEvent&&typeof i.handleEvent==="function"&&i.handleEvent(n)}}finally{if(g.level--,g.compact&&g.level===0){for(f=b.length-1;f>=0;f--)b[f]||b.splice(f,1);b.length===0&&delete this._eventTypes[j];g.compact=!1}}}},isListening:function(j){return!this._eventTypes?!1:this._eventTypes[j]!==void 0},removeEventListener:function(j,
n,g){if(this._eventTypes){var b=this._eventTypes[j];if(b){for(var f=b.listeners,e=0,i=f.length;e<i;e++){var h=f[e];if(h&&h.listener===n&&h.useCapture===g){b.level!==0?(f[e]=null,b.compact=!0):f.splice(e,1);break}}f.length===0&&delete this._eventTypes[j]}}}};return{EventTarget:j}});
define("orion/util",[],function(){var j=navigator.userAgent,o=parseFloat(j.split("MSIE")[1])||void 0,n=parseFloat(j.split("Firefox/")[1]||j.split("Minefield/")[1])||void 0,g=j.indexOf("Opera")!==-1,b=parseFloat(j.split("Chrome/")[1])||void 0,f=j.indexOf("Safari")!==-1&&!b,e=parseFloat(j.split("WebKit/")[1])||void 0,i=j.indexOf("Android")!==-1,h=j.indexOf("iPad")!==-1,j=j.indexOf("iPhone")!==-1,a=h||j,c=navigator.platform.indexOf("Mac")!==-1,d=navigator.platform.indexOf("Win")!==-1,k=navigator.platform.indexOf("Linux")!==
-1;return{formatMessage:function(a){var c=arguments;return a.replace(/\$\{([^\}]+)\}/g,function(a,d){return c[(d<<0)+1]})},createElement:function(a,c){return a.createElementNS?a.createElementNS("http://www.w3.org/1999/xhtml",c):a.createElement(c)},isIE:o,isFirefox:n,isOpera:g,isChrome:b,isSafari:f,isWebkit:e,isAndroid:i,isIPad:h,isIPhone:j,isIOS:a,isMac:c,isWindows:d,isLinux:k,platformDelimiter:d?"\r\n":"\n"}});
define("orion/editor/textModel",["orion/editor/eventTarget","orion/util"],function(j,o){function n(g,b){this._lastLineIndex=-1;this._text=[""];this._lineOffsets=[0];this.setText(g);this.setLineDelimiter(b)}n.prototype={find:function(g){if(this._text.length>1)this._text=[this._text.join("")];var b=g.string,f=b,e=g.caseInsensitive;!g.regex&&b&&(f=b.replace(/([\\$\^*\/+?\.\(\)|{}\[\]])/g,"\\$&"),e&&(f=f.replace(/[iI\u0130\u0131]/g,"[Ii\u0130\u0131]")));var i=null,h;if(f){var b=g.reverse,a=g.wrap,c=g.wholeWord,
d=g.start||0,g=g.end,k=g!==null&&g!==void 0,m="";m.indexOf("g")===-1&&(m+="g");e&&m.indexOf("i")===-1&&(m+="i");c&&(f="\\b"+f+"\\b");var p=this._text[0],q,r,s=0;k&&(e=d<g?d:g,p=p.substring(e,d<g?g:d),s=e);var j=RegExp(f,m);if(b)h=function(){var c=null;for(j.lastIndex=0;;){r=j.lastIndex;q=j.exec(p);if(r===j.lastIndex)return null;if(q){if(!(q.index+s<d)){if(!a||c)break;d=p.length+s}c={start:q.index+s,end:j.lastIndex+s}}else break}if(c)d=c.start;return c};else{if(!k)j.lastIndex=d;h=function(){for(;;){r=
j.lastIndex;q=j.exec(p);if(r===j.lastIndex)break;if(q)return{start:q.index+s,end:j.lastIndex+s};if(!(r!==0&&a))break}return null}}i=h()}return{next:function(){var a=i;a&&(i=h());return a},hasNext:function(){return i!==null}}},getCharCount:function(){for(var g=0,b=0;b<this._text.length;b++)g+=this._text[b].length;return g},getLine:function(g,b){var f=this.getLineCount();if(!(0<=g&&g<f))return null;var e=this._lineOffsets[g];if(g+1<f){f=this.getText(e,this._lineOffsets[g+1]);if(b)return f;for(var e=
f.length,i;(i=f.charCodeAt(e-1))===10||i===13;)e--;return f.substring(0,e)}else return this.getText(e)},getLineAtOffset:function(g){var b=this.getCharCount();if(!(0<=g&&g<=b))return-1;var f=this.getLineCount();if(g===b)return f-1;var e,i,h=this._lastLineIndex;if(0<=h&&h<f&&(e=this._lineOffsets[h],i=h+1<f?this._lineOffsets[h+1]:b,e<=g&&g<i))return h;for(var a=f,c=-1;a-c>1;)if(h=Math.floor((a+c)/2),e=this._lineOffsets[h],i=h+1<f?this._lineOffsets[h+1]:b,g<=e)a=h;else if(g<i){a=h;break}else c=h;return this._lastLineIndex=
a},getLineCount:function(){return this._lineOffsets.length},getLineDelimiter:function(){return this._lineDelimiter},getLineEnd:function(g,b){var f=this.getLineCount();if(!(0<=g&&g<f))return-1;if(g+1<f){f=this._lineOffsets[g+1];if(b)return f;for(var e=this.getText(Math.max(this._lineOffsets[g],f-2),f),i=e.length,h;(h=e.charCodeAt(i-1))===10||h===13;)i--;return f-(e.length-i)}else return this.getCharCount()},getLineStart:function(g){return!(0<=g&&g<this.getLineCount())?-1:this._lineOffsets[g]},getText:function(g,
b){g===void 0&&(g=0);b===void 0&&(b=this.getCharCount());if(g===b)return"";for(var f=0,e=0,i;e<this._text.length;){i=this._text[e].length;if(g<=f+i)break;f+=i;e++}for(var h=f,a=e;e<this._text.length;){i=this._text[e].length;if(b<=f+i)break;f+=i;e++}if(a===e)return this._text[a].substring(g-h,b-f);h=this._text[a].substring(g-h);f=this._text[e].substring(0,b-f);return h+this._text.slice(a+1,e).join("")+f},onChanging:function(g){return this.dispatchEvent(g)},onChanged:function(g){return this.dispatchEvent(g)},
setLineDelimiter:function(g,b){g==="auto"&&(g=void 0,this.getLineCount()>1&&(g=this.getText(this.getLineEnd(0),this.getLineEnd(0,!0))));this._lineDelimiter=g?g:o.platformDelimiter;if(b){var f=this.getLineCount();if(f>1){for(var e=Array(f),i=0;i<f;i++)e[i]=this.getLine(i);this.setText(e.join(this._lineDelimiter))}}},setText:function(g,b,f){g===void 0&&(g="");b===void 0&&(b=0);f===void 0&&(f=this.getCharCount());if(!(b===f&&g==="")){for(var e=this.getLineAtOffset(b),i=this.getLineAtOffset(f),h=b,a=
f-b,c=i-e,d=g.length,k=0,m=this.getLineCount(),p=0,q=0,r=0,s=[];;){p!==-1&&p<=r&&(p=g.indexOf("\r",r));q!==-1&&q<=r&&(q=g.indexOf("\n",r));if(q===-1&&p===-1)break;r=p!==-1&&q!==-1?p+1===q?q+1:(p<q?p:q)+1:p!==-1?p+1:q+1;s.push(b+r);k++}this.onChanging({type:"Changing",text:g,start:h,removedCharCount:a,addedCharCount:d,removedLineCount:c,addedLineCount:k});s.length===0&&(r=this.getLineStart(e),i=i+1<m?this.getLineStart(i+1):this.getCharCount(),b!==r&&(g=this.getText(r,b)+g,b=r),f!==i&&(g+=this.getText(f,
i),f=i));r=d-a;for(i=e+c+1;i<m;i++)this._lineOffsets[i]+=r;if(s.length<5E4)e=[e+1,c].concat(s),Array.prototype.splice.apply(this._lineOffsets,e);else{r=e+1;this._lineOffsets.splice(r,c);for(m=0;m<s.length;m+=5E4)e=[r,0].concat(s.slice(m,Math.min(s.length,m+5E4))),Array.prototype.splice.apply(this._lineOffsets,e),r+=5E4}for(r=m=0;r<this._text.length;){i=this._text[r].length;if(b<=m+i)break;m+=i;r++}e=m;for(s=r;r<this._text.length;){i=this._text[r].length;if(f<=m+i)break;m+=i;r++}i=this._text[r];b=
this._text[s].substring(0,b-e);f=i.substring(f-m);s=[s,r-s+1];b&&s.push(b);g&&s.push(g);f&&s.push(f);Array.prototype.splice.apply(this._text,s);if(this._text.length===0)this._text=[""];this.onChanged({type:"Changed",start:h,removedCharCount:a,addedCharCount:d,removedLineCount:c,addedLineCount:k})}}};j.EventTarget.addMixin(n.prototype);return{TextModel:n}});
define("orion/keyBinding",["orion/util"],function(j){function o(g,b,f,e,i,h){this.type=h||"keydown";this.keyCode=typeof g==="string"&&this.type==="keydown"?g.toUpperCase().charCodeAt(0):g;this.mod1=b!==void 0&&b!==null?b:!1;this.mod2=f!==void 0&&f!==null?f:!1;this.mod3=e!==void 0&&e!==null?e:!1;this.mod4=i!==void 0&&i!==null?i:!1}function n(g){this.keys=g}o.prototype={getKeys:function(){return[this]},match:function(g,b){if(b!==void 0){if(b!==0)return!1}else if(g instanceof Array){if(g.length>1)return!1;
g=g[0]}return g.type!==this.type?!1:this.keyCode===g.keyCode||this.keyCode===String.fromCharCode(j.isOpera?g.which:g.charCode!==void 0?g.charCode:g.keyCode)?this.mod1!==(j.isMac?g.metaKey:g.ctrlKey)?!1:this.type==="keydown"&&this.mod2!==g.shiftKey?!1:this.mod3!==g.altKey?!1:j.isMac&&this.mod4!==g.ctrlKey?!1:!0:!1},equals:function(g){return!g?!1:this.keyCode!==g.keyCode?!1:this.mod1!==g.mod1?!1:this.mod2!==g.mod2?!1:this.mod3!==g.mod3?!1:this.mod4!==g.mod4?!1:this.type!==g.type?!1:!0}};n.prototype=
{getKeys:function(){return this.keys.slice(0)},match:function(g,b){var f=this.keys;if(b!==void 0)return b>f.length?!1:f[b].match(g)?b===f.length-1?!0:b+1:!1;else{g instanceof Array||(g=[g]);if(g.length>f.length)return!1;var e;for(e=0;e<g.length;e++)if(!f[e].match(g[e]))return!1;return e===f.length?!0:e}},equals:function(g){if(!g.keys)return!1;if(g.keys.length!==this.keys.length)return!1;for(var b=0;b<g.keys.length;b++)if(!g.keys[b].equals(this.keys[b]))return!1;return!0}};return{KeyBinding:o,KeyStroke:o,
KeySequence:n}});
define("orion/editor/keyModes",["orion/keyBinding","orion/util"],function(j,o){function n(b){if(b)this._view=b,this._keyBindings=this.createKeyBindings(),this._keyBindingIndex=0}function g(b){n.call(this,b)}n.prototype={createKeyBindings:function(){return[]},getKeyBindings:function(b){for(var f=[],e=this._keyBindings,i=0;i<e.length;i++)e[i].actionID===b&&f.push(e[i].keyBinding);return f},getView:function(){return this._view},isActive:function(){return this._view.getKeyModes().indexOf(this)!==-1},
match:function(b){if(b.type==="keydown")switch(b.keyCode){case 16:case 17:case 18:case 91:return}for(var f=this._keyBindingIndex,e=this._matchingKeyBindings||this._keyBindings,i=[],h=0;h<e.length;h++){var a=e[h],c=a.keyBinding.match(b,f);if(c===!0)return this._keyBindingIndex=0,this._matchingKeyBindings=null,a.actionID;else typeof c==="number"&&i.push(a)}if(i.length===0)this._keyBindingIndex=0,this._matchingKeyBindings=null;else return this._keyBindingIndex++,this._matchingKeyBindings=i,"noop"},setKeyBinding:function(b,
f){for(var e=this._keyBindings,i=0;i<e.length;i++){var h=e[i];if(h.keyBinding.equals(b)){f?h.actionID=f:h.predefined?h.actionID="noop":e.splice(i,1);return}}f&&e.push({keyBinding:b,actionID:f})},setView:function(b){this._view=b}};g.prototype=new n;g.prototype.createKeyBindings=function(){var b=j.KeyBinding,f=[];f.push({actionID:"lineUp",keyBinding:new b(38),predefined:!0});f.push({actionID:"lineDown",keyBinding:new b(40),predefined:!0});f.push({actionID:"charPrevious",keyBinding:new b(37),predefined:!0});
f.push({actionID:"charNext",keyBinding:new b(39),predefined:!0});o.isMac?(f.push({actionID:"scrollPageUp",keyBinding:new b(33),predefined:!0}),f.push({actionID:"scrollPageDown",keyBinding:new b(34),predefined:!0}),f.push({actionID:"pageUp",keyBinding:new b(33,null,null,!0),predefined:!0}),f.push({actionID:"pageDown",keyBinding:new b(34,null,null,!0),predefined:!0}),f.push({actionID:"lineStart",keyBinding:new b(37,!0),predefined:!0}),f.push({actionID:"lineEnd",keyBinding:new b(39,!0),predefined:!0}),
f.push({actionID:"wordPrevious",keyBinding:new b(37,null,null,!0),predefined:!0}),f.push({actionID:"wordNext",keyBinding:new b(39,null,null,!0),predefined:!0}),f.push({actionID:"scrollTextStart",keyBinding:new b(36),predefined:!0}),f.push({actionID:"scrollTextEnd",keyBinding:new b(35),predefined:!0}),f.push({actionID:"textStart",keyBinding:new b(38,!0),predefined:!0}),f.push({actionID:"textEnd",keyBinding:new b(40,!0),predefined:!0}),f.push({actionID:"scrollPageUp",keyBinding:new b(38,null,null,null,
!0),predefined:!0}),f.push({actionID:"scrollPageDown",keyBinding:new b(40,null,null,null,!0),predefined:!0}),f.push({actionID:"lineStart",keyBinding:new b(37,null,null,null,!0),predefined:!0}),f.push({actionID:"lineEnd",keyBinding:new b(39,null,null,null,!0),predefined:!0}),f.push({actionID:"lineStart",keyBinding:new b(38,null,null,!0),predefined:!0}),f.push({actionID:"lineEnd",keyBinding:new b(40,null,null,!0),predefined:!0})):(f.push({actionID:"pageUp",keyBinding:new b(33),predefined:!0}),f.push({actionID:"pageDown",
keyBinding:new b(34),predefined:!0}),f.push({actionID:"lineStart",keyBinding:new b(36),predefined:!0}),f.push({actionID:"lineEnd",keyBinding:new b(35),predefined:!0}),f.push({actionID:"wordPrevious",keyBinding:new b(37,!0),predefined:!0}),f.push({actionID:"wordNext",keyBinding:new b(39,!0),predefined:!0}),f.push({actionID:"textStart",keyBinding:new b(36,!0),predefined:!0}),f.push({actionID:"textEnd",keyBinding:new b(35,!0),predefined:!0}));o.isFirefox&&o.isLinux&&(f.push({actionID:"lineUp",keyBinding:new b(38,
!0),predefined:!0}),f.push({actionID:"lineDown",keyBinding:new b(40,!0),predefined:!0}));o.isWindows&&(f.push({actionID:"scrollLineUp",keyBinding:new b(38,!0),predefined:!0}),f.push({actionID:"scrollLineDown",keyBinding:new b(40,!0),predefined:!0}));f.push({actionID:"selectLineUp",keyBinding:new b(38,null,!0),predefined:!0});f.push({actionID:"selectLineDown",keyBinding:new b(40,null,!0),predefined:!0});f.push({actionID:"selectCharPrevious",keyBinding:new b(37,null,!0),predefined:!0});f.push({actionID:"selectCharNext",
keyBinding:new b(39,null,!0),predefined:!0});f.push({actionID:"selectPageUp",keyBinding:new b(33,null,!0),predefined:!0});f.push({actionID:"selectPageDown",keyBinding:new b(34,null,!0),predefined:!0});o.isMac?(f.push({actionID:"selectLineStart",keyBinding:new b(37,!0,!0),predefined:!0}),f.push({actionID:"selectLineEnd",keyBinding:new b(39,!0,!0),predefined:!0}),f.push({actionID:"selectWordPrevious",keyBinding:new b(37,null,!0,!0),predefined:!0}),f.push({actionID:"selectWordNext",keyBinding:new b(39,
null,!0,!0),predefined:!0}),f.push({actionID:"selectTextStart",keyBinding:new b(36,null,!0),predefined:!0}),f.push({actionID:"selectTextEnd",keyBinding:new b(35,null,!0),predefined:!0}),f.push({actionID:"selectTextStart",keyBinding:new b(38,!0,!0),predefined:!0}),f.push({actionID:"selectTextEnd",keyBinding:new b(40,!0,!0),predefined:!0}),f.push({actionID:"selectLineStart",keyBinding:new b(37,null,!0,null,!0),predefined:!0}),f.push({actionID:"selectLineEnd",keyBinding:new b(39,null,!0,null,!0),predefined:!0}),
f.push({actionID:"selectLineStart",keyBinding:new b(38,null,!0,!0),predefined:!0}),f.push({actionID:"selectLineEnd",keyBinding:new b(40,null,!0,!0),predefined:!0})):(o.isLinux&&(f.push({actionID:"selectWholeLineUp",keyBinding:new b(38,!0,!0),predefined:!0}),f.push({actionID:"selectWholeLineDown",keyBinding:new b(40,!0,!0),predefined:!0})),f.push({actionID:"selectLineStart",keyBinding:new b(36,null,!0),predefined:!0}),f.push({actionID:"selectLineEnd",keyBinding:new b(35,null,!0),predefined:!0}),f.push({actionID:"selectWordPrevious",
keyBinding:new b(37,!0,!0),predefined:!0}),f.push({actionID:"selectWordNext",keyBinding:new b(39,!0,!0),predefined:!0}),f.push({actionID:"selectTextStart",keyBinding:new b(36,!0,!0),predefined:!0}),f.push({actionID:"selectTextEnd",keyBinding:new b(35,!0,!0),predefined:!0}));f.push({actionID:"undo",keyBinding:new j.KeyBinding("z",!0),predefined:!0});o.isMac?f.push({actionID:"redo",keyBinding:new j.KeyBinding("z",!0,!0),predefined:!0}):f.push({actionID:"redo",keyBinding:new j.KeyBinding("y",!0),predefined:!0});
f.push({actionID:"deletePrevious",keyBinding:new b(8),predefined:!0});f.push({actionID:"deletePrevious",keyBinding:new b(8,null,!0),predefined:!0});f.push({actionID:"deleteNext",keyBinding:new b(46),predefined:!0});f.push({actionID:"deleteWordPrevious",keyBinding:new b(8,!0),predefined:!0});f.push({actionID:"deleteWordPrevious",keyBinding:new b(8,!0,!0),predefined:!0});f.push({actionID:"deleteWordNext",keyBinding:new b(46,!0),predefined:!0});f.push({actionID:"tab",keyBinding:new b(9),predefined:!0});
f.push({actionID:"shiftTab",keyBinding:new b(9,null,!0),predefined:!0});f.push({actionID:"enter",keyBinding:new b(13),predefined:!0});f.push({actionID:"enter",keyBinding:new b(13,null,!0),predefined:!0});f.push({actionID:"selectAll",keyBinding:new b("a",!0),predefined:!0});f.push({actionID:"toggleTabMode",keyBinding:new b("m",!0),predefined:!0});o.isMac&&(f.push({actionID:"deleteNext",keyBinding:new b(46,null,!0),predefined:!0}),f.push({actionID:"deleteWordPrevious",keyBinding:new b(8,null,null,!0),
predefined:!0}),f.push({actionID:"deleteWordNext",keyBinding:new b(46,null,null,!0),predefined:!0}));f.push({actionID:"toggleWrapMode",keyBinding:new j.KeyBinding("w",!0,!1,!0)});f.push({actionID:"toggleOverwriteMode",keyBinding:new j.KeyBinding(45)});if(!o.isFirefox){var e=o.isMac&&o.isChrome;f.push({actionID:"noop",keyBinding:new b("u",!e,!1,!1,e),predefined:!0});f.push({actionID:"noop",keyBinding:new b("i",!e,!1,!1,e),predefined:!0});f.push({actionID:"noop",keyBinding:new b("b",!e,!1,!1,e),predefined:!0})}o.isFirefox&&
(f.push({actionID:"copy",keyBinding:new b(45,!0),predefined:!0}),f.push({actionID:"paste",keyBinding:new b(45,null,!0),predefined:!0}),f.push({actionID:"cut",keyBinding:new b(46,null,!0),predefined:!0}));o.isMac&&(f.push({actionID:"lineStart",keyBinding:new b("a",!1,!1,!1,!0),predefined:!0}),f.push({actionID:"lineEnd",keyBinding:new b("e",!1,!1,!1,!0),predefined:!0}),f.push({actionID:"lineUp",keyBinding:new b("p",!1,!1,!1,!0),predefined:!0}),f.push({actionID:"lineDown",keyBinding:new b("n",!1,!1,
!1,!0),predefined:!0}),f.push({actionID:"charPrevious",keyBinding:new b("b",!1,!1,!1,!0),predefined:!0}),f.push({actionID:"charNext",keyBinding:new b("f",!1,!1,!1,!0),predefined:!0}),f.push({actionID:"deletePrevious",keyBinding:new b("h",!1,!1,!1,!0),predefined:!0}),f.push({actionID:"deleteNext",keyBinding:new b("d",!1,!1,!1,!0),predefined:!0}),f.push({actionID:"deleteLineEnd",keyBinding:new b("k",!1,!1,!1,!0),predefined:!0}),o.isFirefox?(f.push({actionID:"scrollPageDown",keyBinding:new b("v",!1,
!1,!1,!0),predefined:!0}),f.push({actionID:"deleteLineStart",keyBinding:new b("u",!1,!1,!1,!0),predefined:!0}),f.push({actionID:"deleteWordPrevious",keyBinding:new b("w",!1,!1,!1,!0),predefined:!0})):(f.push({actionID:"pageDown",keyBinding:new b("v",!1,!1,!1,!0),predefined:!0}),f.push({actionID:"centerLine",keyBinding:new b("l",!1,!1,!1,!0),predefined:!0}),f.push({actionID:"enterNoCursor",keyBinding:new b("o",!1,!1,!1,!0),predefined:!0})));return f};return{KeyMode:n,DefaultKeyMode:g}});
define("orion/editor/textTheme",["require","orion/editor/eventTarget","orion/util"],function(j,o,n){function g(b){b=b||{};this._document=b.document||document}var b={};g.getTheme=function(f){var f=f||"default",e=b[f];e||(e=b[f]=new g);return e};g.prototype={getThemeClass:function(){return this._themeClass},setThemeClass:function(b,e){var i=this,h=i._themeClass;i._themeClass=b;this._load(b,e,function(){i.onThemeChanged({type:"ThemeChanged",oldValue:h,newValue:i.getThemeClass()})})},onThemeChanged:function(b){return this.dispatchEvent(b)},
buildStyleSheet:function(b,e){function i(a,c,d){c&&(h.push("."+b+" ."+a+" {"),h.push("\t"+(d?"background-color":"color")+": "+c+";"),h.push("}"))}var h=[];h.push("");h.push("."+b+" {");e.fontFamily&&h.push("\tfont-family: "+e.fontFamily+";");e.fontSize&&h.push("\tfont-size: "+e.fontSize+";");e.fontSize&&h.push("\tcolor: "+e.text+";");h.push("}");h.push("."+b+".textview {");e.background&&h.push("\tbackground-color: "+e.background+";");h.push("}");i("ruler.annotations",e.annotationRuler,!0);i("ruler.lines",
e.annotationRuler,!0);i("ruler.folding",e.annotationRuler,!0);i("ruler.overview",e.overviewRuler,!0);i("rulerLines",e.lineNumber,!1);i("rulerLines.even",e.lineNumberEven,!1);i("rulerLines.odd",e.lineNumberOdd,!1);i("annotationLine.currentLine",e.currentLine,!0);i("entity-name-tag",e.keyword,!1);i("entity-other-attribute-name",e.attribute,!1);i("string-quoted",e.string,!1);i("line_caret",e.currentLine,!0);i("token_keyword",e.keyword,!1);i("token_string",e.string,!1);i("token_singleline_comment",e.comment,
!1);i("token_multiline_comment",e.comment,!1);i("token_doc_comment",e.comment,!1);i("token_doc_html_markup",e.comment,!1);return h.join("\n")},_createStyle:function(b,e,i,h){var a=this._document,b="orion-theme-"+b,c=a.getElementById(b);if(c){if(h||c.firstChild.data===e)return;c.removeChild(c.firstChild);c.appendChild(a.createTextNode(e))}else h?(c=n.createElement(a,"link"),c.rel="stylesheet",c.type="text/css",c.href=e,c.addEventListener("load",function(){i()})):(c=n.createElement(a,"style"),c.appendChild(a.createTextNode(e))),
c.id=b,(a.getElementsByTagName("head")[0]||a.documentElement).appendChild(c);h||i()},_load:function(b,e,i){if(b)if(typeof e==="string")this._createStyle(b,e,i);else if(e=e.href,e.substring(e.length-4)!==".css"&&(e+=".css"),/^\//.test(e)||/[a-zA-Z0-9]+:\/\//i.test(e)||!j.toUrl)this._createStyle(b,e,i,!0);else{var h=this;j(["text!"+e],function(a){h._createStyle(b,a,i,!1)})}else i()}};o.EventTarget.addMixin(g.prototype);return{TextTheme:g}});
define("orion/editor/util",[],function(){return{contains:function(j,o){if(!o)return!1;if(!j.compareDocumentPosition){for(var n=o;n;){if(j===n)return!0;n=n.parentNode}return!1}return j===o||(j.compareDocumentPosition(o)&16)!==0},addEventListener:function(j,o,n,g){typeof j.addEventListener==="function"?j.addEventListener(o,n,g===!0):j.attachEvent("on"+o,n)},removeEventListener:function(j,o,n,g){typeof j.removeEventListener==="function"?j.removeEventListener(o,n,g===!0):j.detachEvent("on"+o,n)}}});
define("orion/editor/textView","i18n!orion/editor/nls/messages,orion/editor/textModel,orion/editor/keyModes,orion/editor/eventTarget,orion/editor/textTheme,orion/editor/util,orion/util".split(","),function(j,o,n,g,b,f,e){function i(l,t,a){if(a){t.className="";for(var a=t.attributes,c=a.length;c-- >0;)(!e.isIE||e.isIE>=9||e.isIE<9&&a[c].specified)&&t.removeAttribute(a[c].name)}if(l){if(l.styleClass)t.className=l.styleClass;if(a=l.style)for(var d in a)a.hasOwnProperty(d)&&(t.style[d]=a[d]);if(l=l.attributes)for(var b in l)l.hasOwnProperty(b)&&
t.setAttribute(b,l[b])}}function h(l){return l instanceof Array?l.slice(0):l}function a(l,t){if(!l)return t;if(!t)return l;for(var a in t)t.hasOwnProperty(a)&&(l.hasOwnProperty(a)||(l[a]=t[a]));return l}function c(l,t){if(l===t)return!0;if(l&&!t||!l&&t)return!1;if(l&&l.constructor===String||t&&t.constructor===String)return!1;if(l instanceof Array||t instanceof Array){if(!(l instanceof Array&&t instanceof Array))return!1;if(l.length!==t.length)return!1;for(var a=0;a<l.length;a++)if(!c(l[a],t[a]))return!1;
return!0}if(!(l instanceof Object)||!(t instanceof Object))return!1;for(a in l)if(l.hasOwnProperty(a)){if(!t.hasOwnProperty(a))return!1;if(!c(l[a],t[a]))return!1}for(a in t)if(!l.hasOwnProperty(a))return!1;return!0}function d(l,t,a){for(var c=0,d=0,b=0,e=l.length;b<e;){c!==-1&&c<=b&&(c=l.indexOf("\r",b));d!==-1&&d<=b&&(d=l.indexOf("\n",b));var k=b,h;if(d===-1&&c===-1){t(l.substring(b));break}c!==-1&&d!==-1?c+1===d?(h=c,b=d+1):(h=c<d?c:d,b=(c<d?c:d)+1):c!==-1?(h=c,b=c+1):(h=d,b=d+1);t(l.substring(k,
h));a()}}function k(l){var t,a,c,d,b=l.ownerDocument.defaultView||l.ownerDocument.parentWindow;if(b.getComputedStyle)l=b.getComputedStyle(l,null),t=l.getPropertyValue("padding-left"),a=l.getPropertyValue("padding-top"),c=l.getPropertyValue("padding-right"),d=l.getPropertyValue("padding-bottom");else if(l.currentStyle)t=l.currentStyle.paddingLeft,a=l.currentStyle.paddingTop,c=l.currentStyle.paddingRight,d=l.currentStyle.paddingBottom;return{left:parseInt(t,10)||0,top:parseInt(a,10)||0,right:parseInt(c,
10)||0,bottom:parseInt(d,10)||0}}function m(l){var t,a,c,d,b=l._trim;if(!b){var b=k(l),e=l.ownerDocument.defaultView||l.ownerDocument.parentWindow;if(e.getComputedStyle)d=e.getComputedStyle(l,null),t=d.getPropertyValue("border-left-width"),a=d.getPropertyValue("border-top-width"),c=d.getPropertyValue("border-right-width"),d=d.getPropertyValue("border-bottom-width");else if(l.currentStyle)t=l.currentStyle.borderLeftWidth,a=l.currentStyle.borderTopWidth,c=l.currentStyle.borderRightWidth,d=l.currentStyle.borderBottomWidth;
t=parseInt(t,10)||0;a=parseInt(a,10)||0;c=parseInt(c,10)||0;d=parseInt(d,10)||0;b.left+=t;b.top+=a;b.right+=c;b.bottom+=d;l._trim=b}return b}function p(l,t,a){this.start=l;this.end=t;this.caret=a}function q(l){this.left=l.left;this.top=l.top;this.right=l.right;this.bottom=l.bottom}function r(l,t,a){this.view=l;this.lineIndex=t;this._lineDiv=a}function s(l){this._init(l||{})}var w=f.addEventListener,u=f.removeEventListener,v=function(){function l(l){this.options=l}l.prototype.play=function(){var l=
typeof this.options.duration==="number"?this.options.duration:350,a=this.options.easing||this.defaultEasing,c=this.options.onAnimate||function(){},d=this.options.curve[0],b=this.options.curve[1],e=b-d,h=-1,k,f=this;this.interval=this.options.window.setInterval(function(){h=h===-1?(new Date).getTime():h;var m=((new Date).getTime()-h)/l;m<1?(m=a(m),k=d+m*e,c(k)):(c(b),f.stop())},typeof this.options.rate==="number"?this.options.rate:20)};l.prototype.stop=function(){this.options.window.clearInterval(this.interval);
(this.options.onEnd||function(){})()};l.prototype.defaultEasing=function(l){return Math.sin(l*(Math.PI/2))};return l}();p.prototype={clone:function(){return new p(this.start,this.end,this.caret)},collapse:function(){this.caret?this.end=this.start:this.start=this.end},extend:function(l){this.caret?this.start=l:this.end=l;if(this.start>this.end)l=this.start,this.start=this.end,this.end=l,this.caret=!this.caret},setCaret:function(l){this.end=this.start=l;this.caret=!1},getCaret:function(){return this.caret?
this.start:this.end},toString:function(){return"start="+this.start+" end="+this.end+(this.caret?" caret is at start":" caret is at end")},isEmpty:function(){return this.start===this.end},equals:function(l){return this.caret===l.caret&&this.start===l.start&&this.end===l.end}};q.prototype={toString:function(){return"{l="+this.left+", t="+this.top+", r="+this.right+", b="+this.bottom+"}"}};r.prototype={create:function(l,t){if(!this._lineDiv){var a=this._lineDiv=this._createLine(l,t,this.lineIndex);a._line=
this;return a}},_createLine:function(l,t,a){var d=this.view,b=d._model,h=b.getLine(a),k=b.getLineStart(a),f={type:"LineStyle",textView:d,lineIndex:a,lineText:h,lineStart:k};if(h.length<2E3)d.onLineStyle(f);b=t||e.createElement(l.ownerDocument,"div");if(!t||!c(t.viewStyle,f.style)){i(f.style,b,t);if(t)t._trim=null;b.viewStyle=f.style;b.setAttribute("role","presentation")}b.lineIndex=a;a=[];this._createRanges(f.ranges,h,0,h.length,k,{tabOffset:0,ranges:a});h=" ";!d._fullSelection&&e.isIE<9&&(h="\ufeff");
e.isWebkit&&(h="\u200c");f={text:h,style:d._metrics.largestFontStyle,ignoreChars:1};a.length===0||!a[a.length-1].style||a[a.length-1].style.tagName!=="div"?a.push(f):a.splice(a.length-1,0,f);var m,g,q,p,r,h=d=0,s,j;if(t){if(g=t.modelChangedEvent)g.removedLineCount===0&&g.addedLineCount===0?(j=g.start-k,s=g.addedCharCount-g.removedCharCount):j=-1,t.modelChangedEvent=void 0;g=t.firstChild}for(k=0;k<a.length;k++){f=a[k];p=f.text;d+=p.length;m=f.style;if(g)if(r=g.firstChild.data,q=g.viewStyle,r===p&&
c(m,q)){h+=r.length;g._rectsCache=void 0;m=g=g.nextSibling;continue}else for(;g;){if(j!==-1){q=d;q>=j&&(q-=s);r=(r=g.firstChild.data)?r.length:0;if(h+r>q)break;h+=r}q=g.nextSibling;b.removeChild(g);g=q}m=this._createSpan(b,p,m,f.ignoreChars);g?b.insertBefore(m,g):b.appendChild(m);if(t)t.lineWidth=void 0}if(t)for(l=m?m.nextSibling:null;l;)q=l.nextSibling,t.removeChild(l),l=q;else l.appendChild(b);return b},_createRanges:function(l,t,a,d,b,e){if(!(a>d)){if(l)for(var h=0;h<l.length;h++){var k=l[h];if(!(k.end<
b+a)){var f=Math.max(b+a,k.start)-b;if(f>d)break;var m=Math.min(b+d,k.end)-b;if(f<=m){f=Math.max(a,f);m=Math.min(d,m);a<f&&this._createRange(t,a,f,null,e);if(!k.style||!k.style.unmergeable)for(;h+1<l.length&&l[h+1].start-b===m&&c(k.style,l[h+1].style);)k=l[h+1],m=Math.min(b+d,k.end)-b,h++;this._createRange(t,f,m,k.style,e);a=m}}}a<d&&this._createRange(t,a,d,null,e)}},_createRange:function(l,t,a,c,d){if(!(t>a)){var b=this.view._customTabSize;if(b&&b!==8)for(var e=l.indexOf("\t",t);e!==-1&&e<a;){t<
e&&(t={text:l.substring(t,e),style:c},d.ranges.push(t),d.tabOffset+=t.text.length);t=b-d.tabOffset%b;if(t>0){for(var h="\u00a0",k=1;k<t;k++)h+=" ";t={text:h,style:c,ignoreChars:t-1};d.ranges.push(t);d.tabOffset+=t.text.length}t=e+1;if(t===a)return;e=l.indexOf("\t",t)}t<=a&&(t={text:l.substring(t,a),style:c},d.ranges.push(t),d.tabOffset+=t.text.length)}},_createSpan:function(l,t,a,c){var d=this.view,b="span";a&&a.tagName&&(b=a.tagName.toLowerCase());var h=b==="a";if(h)l.hasLink=!0;h&&!d._linksVisible&&
(b="span");h=l.ownerDocument;l=e.createElement(l.ownerDocument,b);a&&a.html?(l.innerHTML=a.html,l.ignore=!0):a&&a.node?(l.appendChild(a.node),l.ignore=!0):l.appendChild(h.createTextNode(a&&a.text?a.text:t));i(a,l);if(b==="a"){var k=d._getWindow();w(l,"click",function(l){return d._handleLinkClick(l?l:k.event)},!1)}l.viewStyle=a;if(c)l.ignoreChars=c;return l},_ensureCreated:function(){return this._lineDiv?this._lineDiv:this._createdDiv=this.create(this.view._clientDiv,null)},getBoundingClientRect:function(l,
t){var a=this._ensureCreated(),c=this.view;if(l===void 0)return this._getLineBoundingClientRect(a,!0);var d=c._model,b=a.ownerDocument,h=this.lineIndex,k=null;if(l<d.getLineEnd(h)){h=d.getLineStart(h);for(d=a.firstChild;d;){if(!d.ignore){var f=d.firstChild,m=f.length;d.ignoreChars&&(m-=d.ignoreChars);if(h+m>l){k=l-h;if(f.length===1)k=new q(d.getBoundingClientRect());else if(c._isRangeRects)b=b.createRange(),b.setStart(f,k),b.setEnd(f,k+1),k=new q(b.getBoundingClientRect());else if(e.isIE){if(b=b.body.createTextRange(),
b.moveToElementText(d),b.collapse(),(h=k===0&&e.isIE===8)&&(k=1),b.moveEnd("character",k+1),b.moveStart("character",k),k=new q(b.getBoundingClientRect()),h)k.left=d.getClientRects()[0].left}else{var i=f.data;d.removeChild(f);d.appendChild(b.createTextNode(i.substring(0,k)));var g=e.createElement(b,"span");g.appendChild(b.createTextNode(i.substring(k,k+1)));d.appendChild(g);d.appendChild(b.createTextNode(i.substring(k+1)));k=new q(g.getBoundingClientRect());d.innerHTML="";d.appendChild(f);this._createdDiv||
(b=c._getSelection(),(h<=b.start&&b.start<h+m||h<=b.end&&b.end<h+m)&&c._updateDOMSelection())}e.isIE&&(b=a.ownerDocument.defaultView||a.ownerDocument.parentWindow,a=b.screen.logicalXDPI/b.screen.deviceXDPI,b=b.screen.logicalYDPI/b.screen.deviceYDPI,k.left*=a,k.right*=a,k.top*=b,k.bottom*=b);break}h+=m}d=d.nextSibling}}a=this.getBoundingClientRect();if(!k)c._wrapMode?(c=this.getClientRects(),k=c[c.length-1],k.left=k.right,k.left+=a.left,k.top+=a.top,k.right+=a.left,k.bottom+=a.top):(k=new q(a),k.left=
k.right);if(t||t===void 0)k.left-=a.left,k.top-=a.top,k.right-=a.left,k.bottom-=a.top;return k},_getClientRects:function(l,t){var a,c,d,b;if(!l._rectsCache){a=l.getClientRects();c=Array(a.length);for(b=0;b<a.length;b++)d=c[b]=new q(a[b]),d.left-=t.left,d.top-=t.top,d.right-=t.left,d.bottom-=t.top;l._rectsCache=c}a=l._rectsCache;c=[a.length];for(b=0;b<a.length;b++)c[b]=new q(a[b]);return c},getClientRects:function(l){if(!this.view._wrapMode)return[this.getBoundingClientRect()];for(var t=this._ensureCreated(),
a=[],c=t.firstChild,d,b=t.getBoundingClientRect();c;){if(!c.ignore)for(var k=this._getClientRects(c,b),t=0;t<k.length;t++){var e=k[t],h;if(e.top!==e.bottom){var f=e.top+(e.bottom-e.top)/2;for(h=0;h<a.length;h++)if(d=a[h],d.top<=f&&f<d.bottom)break;if(h===a.length)a.push(e);else{if(e.left<d.left)d.left=e.left;if(e.top<d.top)d.top=e.top;if(e.right>d.right)d.right=e.right;if(e.bottom>d.bottom)d.bottom=e.bottom}}}c=c.nextSibling}return l!==void 0?a[l]:a},_getLineBoundingClientRect:function(l,t){var a=
new q(l.getBoundingClientRect());if(!this.view._wrapMode){a.right=a.left;for(var c=l.lastChild;c&&c.ignoreChars===c.firstChild.length;)c=c.previousSibling;if(c)c=c.getBoundingClientRect(),a.right=c.right+m(l).right}t&&(c=m(l),a.left+=c.left,a.right-=c.right);return a},getLineCount:function(){return!this.view._wrapMode?1:this.getClientRects().length},getLineIndex:function(l){if(!this.view._wrapMode)return 0;for(var t=this.getClientRects(),l=this.getBoundingClientRect(l),l=l.top+(l.bottom-l.top)/2,
a=0;a<t.length;a++)if(t[a].top<=l&&l<t[a].bottom)return a;return t.length-1},getLineStart:function(l){if(!this.view._wrapMode||l===0)return this.view._model.getLineStart(l);var a=this.getClientRects();return this.getOffset(a[l].left+1,a[l].top+1)},getOffset:function(l,a){var c=this.view,d=c._model,b=this.lineIndex,k=d.getLineStart(b),h=d.getLineEnd(b);if(k===h)return k;var f=this._ensureCreated(),m=this.getBoundingClientRect(),i,g;if(c._wrapMode){i=this.getClientRects();if(a<i[0].top)a=i[0].top;for(var q=
0;q<i.length;q++)if(g=i[q],g.top<=a&&a<g.bottom)break;if(l<g.left)l=g.left;l>g.right&&(l=g.right-1)}else l<0&&(l=0),l>m.right-m.left&&(l=m.right-m.left);var p=f.ownerDocument,q=p.defaultView||p.parentWindow,r=e.isIE?q.screen.logicalXDPI/q.screen.deviceXDPI:1,s=e.isIE?q.screen.logicalYDPI/q.screen.deviceYDPI:1,q=k,j=f.firstChild;a:for(;j;){if(!j.ignore){var n=j.firstChild,f=n.length;j.ignoreChars&&(f-=j.ignoreChars);var o,w,u;i=this._getClientRects(j,m);for(var v=0;v<i.length;v++)if(g=i[v],g.left<=
l&&l<g.right&&(!c._wrapMode||g.top<=a&&a<g.bottom)){var v=g.left,C;if(e.isIE||c._isRangeRects){for(var p=c._isRangeRects?p.createRange():p.body.createTextRange(),A=f,D=-1;A-D>1;){var E=Math.floor((A+D)/2);i=D+1;g=E===f-1&&j.ignoreChars?n.length:E+1;C=i===0&&e.isIE===8;c._isRangeRects?(p.setStart(n,i),p.setEnd(n,g)):(C&&(i=1),p.moveToElementText(j),p.move("character",i),p.moveEnd("character",g-i));i=p.getClientRects();for(var J=!1,G=0;G<i.length;G++)if(g=i[G],o=(C?v:g.left)*r-m.left,u=g.right*r-m.left,
w=g.top*s-m.top,g=g.bottom*s-m.top,o<=l&&l<u&&(!c._wrapMode||w<=a&&a<g)){J=!0;break}J?A=E:D=E}q+=A;i=A;g=A===f-1&&j.ignoreChars?n.length:Math.min(A+1,n.length);c._isRangeRects?(p.setStart(n,i),p.setEnd(n,g)):(p.moveToElementText(j),p.move("character",i),p.moveEnd("character",g-i));i=p.getClientRects();c=!1;i.length>0&&(g=i[0],o=(C?v:g.left)*r-m.left,u=g.right*r-m.left,c=l>o+(u-o)/2);m=q-k;d=d.getLine(b);b=d.charCodeAt(m);55296<=b&&b<=56319&&c?m<d.length&&(b=d.charCodeAt(m+1),56320<=b&&b<=57343&&(q+=
1)):56320<=b&&b<=57343&&!c&&m>0&&(b=d.charCodeAt(m-1),55296<=b&&b<=56319&&(q-=1));c&&q++}else{d=[];for(b=0;b<f;b++)d.push("<span>"),b===f-1?d.push(n.data.substring(b)):d.push(n.data.substring(b,b+1)),d.push("</span>");j.innerHTML=d.join("");for(d=j.firstChild;d;){g=d.getBoundingClientRect();o=g.left-m.left;u=g.right-m.left;if(o<=l&&l<u){l>o+(u-o)/2&&q++;break}q++;d=d.nextSibling}if(!this._createdDiv)j.innerHTML="",j.appendChild(n),m=c._getSelection(),(q<=m.start&&m.start<q+f||q<=m.end&&m.end<q+f)&&
c._updateDOMSelection()}break a}q+=f}j=j.nextSibling}return Math.min(h,Math.max(k,q))},getNextOffset:function(l,a){if(a.unit==="line"){var c=this.view._model,d=c.getLineAtOffset(l);if(a.count>0)return a.count--,c.getLineEnd(d);a.count++;return c.getLineStart(d)}return a.unit==="wordend"||a.unit==="wordWS"||a.unit==="wordendWS"?this._getNextOffset_W3C(l,a):e.isIE?this._getNextOffset_IE(l,a):this._getNextOffset_W3C(l,a)},_getNextOffset_W3C:function(l,a){function c(l){return 33<=l&&l<=47||58<=l&&l<=
64||91<=l&&l<=94||l===96||123<=l&&l<=126}function d(l){return l===32||l===9}var b=this.view._model,e=b.getLineAtOffset(l),k=b.getLine(e),h=b.getLineStart(e),b=b.getLineEnd(e),e=k.length,m=l-h,f,i=a.count<0?-1:1;if(a.unit==="word"||a.unit==="wordend"||a.unit==="wordWS"||a.unit==="wordendWS")for(var g,q,p;a.count!==0;){if(a.count>0){if(m===e)return b;f=k.charCodeAt(m);g=c(f);q=!g&&!d(f);for(m++;m<e;){f=k.charCodeAt(m);if(a.unit!=="wordWS"&&a.unit!=="wordendWS"){p=c(f);if(a.unit==="wordend"){if(!p&&
g)break}else if(p&&!g)break;f=!p&&!d(f)}else f=!d(f);if(a.unit==="wordend"||a.unit==="wordendWS"){if(!f&&q)break}else if(f&&!q)break;q=f;g=p;m++}}else{if(m===0)return h;m--;f=k.charCodeAt(m);g=c(f);for(q=!g&&!d(f);0<m;){f=k.charCodeAt(m-1);if(a.unit!=="wordWS"&&a.unit!=="wordendWS"){p=c(f);if(a.unit==="wordend"){if(p&&!g)break}else if(!p&&g)break;f=!p&&!d(f)}else f=!d(f);if(a.unit==="wordend"||a.unit==="wordendWS"){if(f&&!q)break}else if(!f&&q)break;q=f;g=p;m--}}a.count-=i}else for(;a.count!==0&&
0<=m+i&&m+i<=e;)m+=i,f=k.charCodeAt(m),56320<=f&&f<=57343&&m>0&&(f=k.charCodeAt(m-1),55296<=f&&f<=56319&&(m+=i)),a.count-=i;return h+m},_getNextOffset_IE:function(l,a){var c=this._ensureCreated(),d=this.view._model,b=this.lineIndex,e=0,k;k=d.getLineStart(b);var h=c.ownerDocument,f=a.count<0?-1:1;if(l===d.getLineEnd(b)){for(c=c.lastChild;c&&c.ignoreChars;)c=c.previousSibling;if(!c)return k;e=h.body.createTextRange();e.moveToElementText(c);k=e.text.length;e.moveEnd(a.unit,f);e=l+e.text.length-k}else if(l===
k&&a.count<0)e=k;else for(c=c.firstChild;c;){d=c.firstChild.length;c.ignoreChars&&(d-=c.ignoreChars);if(k+d>l){e=h.body.createTextRange();l===k&&a.count<0?e.moveToElementText(c.previousSibling):(e.moveToElementText(c),e.collapse(),e.moveEnd("character",l-k));k=e.text.length;e.moveEnd(a.unit,f);e=l+e.text.length-k;break}k=d+k;c=c.nextSibling}a.count-=f;return e},destroy:function(){var l=this._createdDiv;if(l)l.parentNode.removeChild(l),this._createdDiv=null}};s.prototype={addKeyMode:function(l,a){var c=
this._keyModes;a!==void 0?c.splice(a,0,l):c.push(l);l._modeAdded&&l._modeAdded()},addRuler:function(l,a){l.setView(this);var c=this._rulers;if(a!==void 0){var d,b;for(d=0,b=0;d<c.length&&b<a;d++)l.getLocation()===c[d].getLocation()&&b++;c.splice(b,0,l);a=b}else c.push(l);this._createRuler(l,a);this._update()},computeSize:function(){var l=0,a=0,c=this._model,d=this._clientDiv;if(!d)return{width:l,height:a};var b=d.style.width;if(e.isWebkit)d.style.width="0x7fffffffpx";for(var c=c.getLineCount(),k=
0;k<c;k++){var h=this._getLine(k),f=h.getBoundingClientRect(),l=Math.max(l,f.right-f.left);a+=f.bottom-f.top;h.destroy()}if(e.isWebkit)d.style.width=b;d=this._getViewPadding();l+=d.right+d.left+this._metrics.scrollWidth;a+=d.bottom+d.top+this._metrics.scrollWidth;return{width:l,height:a}},convert:function(l,a,c){if(this._clientDiv){var d=this._getScroll(),b=this._getViewPadding(),e=this._viewDiv.getBoundingClientRect();a==="document"&&(l.x!==void 0&&(l.x+=-d.x+e.left+b.left),l.y!==void 0&&(l.y+=-d.y+
e.top+b.top));c==="document"&&(l.x!==void 0&&(l.x+=d.x-e.left-b.left),l.y!==void 0&&(l.y+=d.y-e.top-b.top));return l}},destroy:function(){for(var l=0;l<this._rulers.length;l++)this._rulers[l].setView(null);this.rulers=null;this._destroyView();this.onDestroy({type:"Destroy"});this._actions=this._keyModes=this._doubleClickSelection=this._selection=this._theme=this._model=this._parent=null},focus:function(){this._clientDiv&&(this._updateDOMSelection(),this._clientDiv.focus(),this._updateDOMSelection())},
hasFocus:function(){return this._hasFocus},getActionDescription:function(l){if(l=this._actions[l])return l.actionDescription},getActions:function(l){var a=[],c=this._actions,d;for(d in c)c.hasOwnProperty(d)&&(l||!c[d].defaultHandler)&&a.push(d);return a},getBottomIndex:function(l){return!this._clientDiv?0:this._getBottomIndex(l)},getBottomPixel:function(){return!this._clientDiv?0:this._getScroll().y+this._getClientHeight()},getCaretOffset:function(){return this._getSelection().getCaret()},getClientArea:function(){if(!this._clientDiv)return{x:0,
y:0,width:0,height:0};var l=this._getScroll();return{x:l.x,y:l.y,width:this._getClientWidth(),height:this._getClientHeight()}},getHorizontalPixel:function(){return!this._clientDiv?0:this._getScroll().x},getKeyBindings:function(l){for(var a=[],c=this._keyModes,d=0;d<c.length;d++)a=a.concat(c[d].getKeyBindings(l));return a},getKeyModes:function(){return this._keyModes.slice(0)},getLineHeight:function(l){return!this._clientDiv?0:this._getLineHeight(l)},getLineIndex:function(l){return!this._clientDiv?
0:this._getLineIndex(l)},getLinePixel:function(l){return!this._clientDiv?0:this._getLinePixel(l)},getLocationAtOffset:function(l){if(!this._clientDiv)return{x:0,y:0};var a=this._model,l=Math.min(Math.max(0,l),a.getCharCount()),a=a.getLineAtOffset(l),c=this._getLine(a),l=c.getBoundingClientRect(l);c.destroy();c=l.left;a=this._getLinePixel(a)+l.top;return{x:c,y:a}},getOptions:function(){var l;if(arguments.length===0)l=this._defaultOptions();else if(arguments.length===1){if(l=arguments[0],typeof l===
"string")return h(this["_"+l])}else{l={};for(var a in arguments)arguments.hasOwnProperty(a)&&(l[arguments[a]]=void 0)}for(var c in l)l.hasOwnProperty(c)&&(l[c]=h(this["_"+c]));return l},getModel:function(){return this._model},getOffsetAtLocation:function(l,a){if(!this._clientDiv)return 0;var c=this._getLineIndex(a),d=this._getLine(c),c=d.getOffset(l,a-this._getLinePixel(c));d.destroy();return c},getRulers:function(){return this._rulers.slice(0)},getSelection:function(){var l=this._getSelection();
return{start:l.start,end:l.end}},getText:function(l,a){return this._model.getText(l,a)},getTopIndex:function(l){return!this._clientDiv?0:this._getTopIndex(l)},getTopPixel:function(){return!this._clientDiv?0:this._getScroll().y},invokeAction:function(l,a,c){if(this._clientDiv){if(l=this._actions[l]){if(!a&&l.handler&&l.handler(c))return!0;if(l.defaultHandler)return typeof l.defaultHandler(c)==="boolean"}return!1}},isDestroyed:function(){return!this._clientDiv},onContextMenu:function(l){return this.dispatchEvent(l)},
onDragStart:function(l){return this.dispatchEvent(l)},onDrag:function(l){return this.dispatchEvent(l)},onDragEnd:function(l){return this.dispatchEvent(l)},onDragEnter:function(l){return this.dispatchEvent(l)},onDragOver:function(l){return this.dispatchEvent(l)},onDragLeave:function(l){return this.dispatchEvent(l)},onDrop:function(l){return this.dispatchEvent(l)},onDestroy:function(l){return this.dispatchEvent(l)},onLineStyle:function(l){return this.dispatchEvent(l)},onKeyDown:function(l){return this.dispatchEvent(l)},
onKeyPress:function(l){return this.dispatchEvent(l)},onKeyUp:function(l){return this.dispatchEvent(l)},onModelChanged:function(l){return this.dispatchEvent(l)},onModelChanging:function(l){return this.dispatchEvent(l)},onModify:function(l){return this.dispatchEvent(l)},onMouseDown:function(l){return this.dispatchEvent(l)},onMouseUp:function(l){return this.dispatchEvent(l)},onMouseMove:function(l){return this.dispatchEvent(l)},onMouseOver:function(l){return this.dispatchEvent(l)},onMouseOut:function(l){return this.dispatchEvent(l)},
onSelection:function(l){return this.dispatchEvent(l)},onScroll:function(l){return this.dispatchEvent(l)},onVerify:function(l){return this.dispatchEvent(l)},onFocus:function(l){return this.dispatchEvent(l)},onBlur:function(l){return this.dispatchEvent(l)},redraw:function(){if(!(this._redrawCount>0)){var l=this._model.getLineCount();this.redrawRulers(0,l);this.redrawLines(0,l)}},redrawRulers:function(l,a){if(!(this._redrawCount>0))for(var c=this.getRulers(),d=0;d<c.length;d++)this.redrawLines(l,a,c[d])},
redrawLines:function(l,a,c){if(!(this._redrawCount>0)&&(l===void 0&&(l=0),a===void 0&&(a=this._model.getLineCount()),l!==a)){var d=this._clientDiv;if(d){if(c)for(d=(c.getLocation()==="left"?this._leftDiv:this._rightDiv).firstChild;d;){if(d._ruler===c)break;d=d.nextSibling}c?d.rulerChanged=!0:this._lineHeight&&this._resetLineHeight(l,a);if(!c||c.getOverview()==="page")for(d=d.firstChild;d;){var b=d.lineIndex;if(l<=b&&b<a)d.lineChanged=!0;d=d.nextSibling}if(!c&&!this._wrapMode&&l<=this._maxLineIndex&&
this._maxLineIndex<a)this._checkMaxLineIndex=this._maxLineIndex,this._maxLineIndex=-1,this._maxLineWidth=0;this._queueUpdate()}}},redrawRange:function(l,a){if(!(this._redrawCount>0)){var c=this._model;l===void 0&&(l=0);a===void 0&&(a=c.getCharCount());var d=c.getLineAtOffset(l),c=c.getLineAtOffset(Math.max(l,a-1))+1;this.redrawLines(d,c)}},removeKeyMode:function(l){for(var a=this._keyModes,c=0;c<a.length;c++)if(a[c]===l){a.splice(c,1);break}l._modeRemoved&&l._modeRemoved()},removeRuler:function(l){for(var a=
this._rulers,c=0;c<a.length;c++)if(a[c]===l){a.splice(c,1);l.setView(null);this._destroyRuler(l);this._update();break}},resize:function(){this._clientDiv&&this._handleResize(null)},setAction:function(l,a,c){if(l){var d=this._actions,b=d[l];b||(b=d[l]={});b.handler=a;if(c!==void 0)b.actionDescription=c}},setKeyBinding:function(l,a){this._keyModes[0].setKeyBinding(l,a)},setCaretOffset:function(l,a,c){var d=this._model.getCharCount(),l=Math.max(0,Math.min(l,d));this._setSelection(new p(l,l,!1),a===void 0||
a,!0,c)},setHorizontalPixel:function(l){this._clientDiv&&(l=Math.max(0,l),this._scrollView(l-this._getScroll().x,0))},setRedraw:function(l){l?--this._redrawCount===0&&this.redraw():this._redrawCount++},setModel:function(l){if(l&&l!==this._model){this._model.removeEventListener("preChanging",this._modelListener.onChanging);this._model.removeEventListener("postChanged",this._modelListener.onChanged);var a=this._model.getLineCount(),c=this._model.getCharCount(),d=l.getLineCount(),b=l.getCharCount(),
e={type:"ModelChanging",text:l.getText(),start:0,removedCharCount:c,addedCharCount:b,removedLineCount:a,addedLineCount:d};this.onModelChanging(e);this._model=l;e={type:"ModelChanged",start:0,removedCharCount:c,addedCharCount:b,removedLineCount:a,addedLineCount:d};this.onModelChanged(e);this._model.addEventListener("preChanging",this._modelListener.onChanging);this._model.addEventListener("postChanged",this._modelListener.onChanged);this._reset();this._update()}},setOptions:function(l){var a=this._defaultOptions(),
d;for(d in l)if(l.hasOwnProperty(d)){var b=l[d];if(!c(this["_"+d],b)){var e=a[d]?a[d].update:null;e?e.call(this,b):this["_"+d]=h(b)}}},setSelection:function(l,a,c,d){var b=l>a;if(b)var e=l,l=a,a=e;e=this._model.getCharCount();l=Math.max(0,Math.min(l,e));a=Math.max(0,Math.min(a,e));this._setSelection(new p(l,a,b),c===void 0||c,!0,d)},setText:function(l,a,c){var d=a===void 0&&c===void 0;a===void 0&&(a=0);c===void 0&&(c=this._model.getCharCount());if(d)this._variableLineHeight=!1;this._modifyContent({text:l,
start:a,end:c,_code:!0},!d);if(d)this._columnX=-1,this._setSelection(new p(0,0,!1),!0),e.isFirefox&&this._fixCaret()},setTopIndex:function(l){this._clientDiv&&this._scrollView(0,this._getLinePixel(Math.max(0,l))-this._getScroll().y)},setTopPixel:function(l){this._clientDiv&&this._scrollView(0,Math.max(0,l)-this._getScroll().y)},showSelection:function(){return this._showCaret(!0)},update:function(l,a){this._clientDiv&&(l&&this._updateStyle(),a===void 0||a?this._update():this._queueUpdate())},_handleRootMouseDown:function(l){if(!this._ignoreEvent(l)){if(e.isFirefox&&
l.which===1)this._clientDiv.contentEditable=!1,this._ignoreBlur=(this._overlayDiv||this._clientDiv).draggable=!0;var a=this._overlayDiv||this._clientDiv;if(e.isIE<9)a=this._viewDiv;for(var c=l.target?l.target:l.srcElement;c;){if(a===c)return;c=c.parentNode}l.preventDefault&&l.preventDefault();l.stopPropagation&&l.stopPropagation();if(!this._isW3CEvents){var d=this;this._getWindow().setTimeout(function(){d._clientDiv.focus()},0)}}},_handleRootMouseUp:function(l){if(!this._ignoreEvent(l)&&e.isFirefox&&
l.which===1)this._clientDiv.contentEditable=!0,(this._overlayDiv||this._clientDiv).draggable=!1,this._fixCaret(),this._ignoreBlur=!1},_handleBlur:function(){if(!this._ignoreBlur){this._hasFocus=!1;if(e.isIE<9&&!this._getSelection().isEmpty()){var l=this._rootDiv,a=e.createElement(l.ownerDocument,"div");l.appendChild(a);l.removeChild(a)}if(this._cursorDiv)this._cursorDiv.style.display="none";if(this._selDiv1)if(this._selDiv1.style.background="lightgray",this._selDiv2.style.background="lightgray",this._selDiv3.style.background=
"lightgray",l=this._getWindow(),a=this._selDiv1.ownerDocument,l.getSelection){a=l.getSelection();for(l=a.anchorNode;l;){if(l===this._clientDiv){a.rangeCount>0&&a.removeAllRanges();break}l=l.parentNode}}else if(a.selection){this._ignoreSelect=!1;for(l=a.selection.createRange().parentElement();l;){if(l===this._clientDiv){a.selection.empty();break}l=l.parentNode}this._ignoreSelect=!0}if(!this._ignoreFocus)this.onBlur({type:"Blur"})}},_handleContextMenu:function(l){if(!this._ignoreEvent(l)){e.isIE&&this._lastMouseButton===
3&&this._updateDOMSelection();var a=!1;this.isListening("ContextMenu")?(a=this._createMouseEvent("ContextMenu",l),a.screenX=l.screenX,a.screenY=l.screenY,this.onContextMenu(a),a=a.defaultPrevented):e.isMac&&e.isFirefox&&l.button===0&&(a=!0);if(a)return l.preventDefault&&l.preventDefault(),!1}},_handleCopy:function(a){if(!this._ignoreEvent(a)&&!this._ignoreCopy&&this._doCopy(a))return a.preventDefault&&a.preventDefault(),!1},_handleCut:function(a){if(!this._ignoreEvent(a)&&this._doCut(a))return a.preventDefault&&
a.preventDefault(),!1},_handleDataModified:function(a){this._ignoreEvent(a)||this._startIME()},_handleDblclick:function(a){if(!this._ignoreEvent(a)&&(this._lastMouseTime=a.timeStamp?a.timeStamp:(new Date).getTime(),this._clickCount!==2))this._clickCount=2,this._handleMouse(a)},_handleDragStart:function(a){if(!this._ignoreEvent(a)){if(e.isFirefox){var c=this;this._getWindow().setTimeout(function(){c._clientDiv.contentEditable=!0;c._clientDiv.draggable=!1;c._ignoreBlur=!1},0)}if(this.isListening("DragStart")&&
this._dragOffset!==-1)this._isMouseDown=!1,this.onDragStart(this._createMouseEvent("DragStart",a)),this._dragOffset=-1;else return a.preventDefault&&a.preventDefault(),!1}},_handleDrag:function(a){if(!this._ignoreEvent(a)&&this.isListening("Drag"))this.onDrag(this._createMouseEvent("Drag",a))},_handleDragEnd:function(a){if(!this._ignoreEvent(a)){this._dropTarget=!1;this._dragOffset=-1;if(this.isListening("DragEnd"))this.onDragEnd(this._createMouseEvent("DragEnd",a));e.isFirefox&&(this._fixCaret(),
a.dataTransfer.dropEffect==="none"&&!a.dataTransfer.mozUserCancelled&&this._fixCaret())}},_handleDragEnter:function(a){if(!this._ignoreEvent(a)){var c=!0;this._dropTarget=!0;this.isListening("DragEnter")&&(c=!1,this.onDragEnter(this._createMouseEvent("DragEnter",a)));if(e.isWebkit||c)return a.preventDefault&&a.preventDefault(),!1}},_handleDragOver:function(a){if(!this._ignoreEvent(a)){var c=!0;this.isListening("DragOver")&&(c=!1,this.onDragOver(this._createMouseEvent("DragOver",a)));if(e.isWebkit||
c){if(c)a.dataTransfer.dropEffect="none";a.preventDefault&&a.preventDefault();return!1}}},_handleDragLeave:function(a){if(!this._ignoreEvent(a)&&(this._dropTarget=!1,this.isListening("DragLeave")))this.onDragLeave(this._createMouseEvent("DragLeave",a))},_handleDrop:function(a){if(!this._ignoreEvent(a)){this._dropTarget=!1;if(this.isListening("Drop"))this.onDrop(this._createMouseEvent("Drop",a));a.preventDefault&&a.preventDefault();return!1}},_handleFocus:function(){this._hasFocus=!0;e.isIOS&&this._lastTouchOffset!==
void 0?(this.setCaretOffset(this._lastTouchOffset,!0),this._lastTouchOffset=void 0):this._updateDOMSelection();if(this._cursorDiv)this._cursorDiv.style.display="block";if(this._selDiv1){var a=this._highlightRGB;this._selDiv1.style.background=a;this._selDiv2.style.background=a;this._selDiv3.style.background=a}if(!this._ignoreFocus)this.onFocus({type:"Focus"})},_handleKeyDown:function(a){if(!this._ignoreEvent(a)){if(this.isListening("KeyDown")){var c=this._createKeyEvent("KeyDown",a);this.onKeyDown(c);
if(c.defaultPrevented){if(e.isFirefox)this._keyDownPrevented=!0;a.preventDefault();return}}c=!1;switch(a.keyCode){case 16:case 17:case 18:case 91:c=!0;break;default:this._setLinksVisible(!1)}if(a.keyCode===229){if(this._readonly)return a.preventDefault&&a.preventDefault(),!1;c=!0;if(e.isSafari&&e.isMac&&a.ctrlKey)c=!1,a.keyCode=129;c&&this._startIME()}else c||this._commitIME();if((e.isMac||e.isLinux)&&e.isFirefox<4||e.isOpera)return this._keyDownEvent=a,!0;if(this._doAction(a))return a.preventDefault?
(a.preventDefault(),a.stopPropagation()):(a.cancelBubble=!0,a.returnValue=!1,a.keyCode=0),!1}},_handleKeyPress:function(a){if(!this._ignoreEvent(a))if(this._keyDownPrevented)a.preventDefault&&(a.preventDefault(),a.stopPropagation()),this._keyDownPrevented=void 0;else{if(e.isMac&&e.isWebkit&&(63232<=a.keyCode&&a.keyCode<=63487||a.keyCode===13||a.keyCode===8))return a.preventDefault&&a.preventDefault(),!1;if(((e.isMac||e.isLinux)&&e.isFirefox<4||e.isOpera)&&this._doAction(this._keyDownEvent))return a.preventDefault&&
a.preventDefault(),!1;var c=e.isMac?a.metaKey:a.ctrlKey;if(a.charCode!==void 0&&c)switch(a.charCode){case 99:case 118:case 120:return!0}if(this.isListening("KeyPress")&&(c=this._createKeyEvent("KeyPress",a),this.onKeyPress(c),c.defaultPrevented)){a.preventDefault();return}if(this._doAction(a))return a.preventDefault?(a.preventDefault(),a.stopPropagation()):(a.cancelBubble=!0,a.returnValue=!1,a.keyCode=0),!1;c=!1;if(e.isMac){if(a.ctrlKey||a.metaKey)c=!0}else if(e.isFirefox){if(a.ctrlKey||a.altKey)c=
!0}else a.ctrlKey^a.altKey&&(c=!0);if(!c&&(c=e.isOpera?a.which:a.charCode!==void 0?a.charCode:a.keyCode,c>31))return this._doContent(String.fromCharCode(c)),a.preventDefault&&a.preventDefault(),!1}},_handleDocKeyUp:function(a){(e.isMac?a.metaKey:a.ctrlKey)||this._setLinksVisible(!1)},_handleKeyUp:function(a){if(!this._ignoreEvent(a)){if(this.isListening("KeyUp")){var c=this._createKeyEvent("KeyUp",a);this.onKeyUp(c);if(c.defaultPrevented){a.preventDefault();return}}this._handleDocKeyUp(a);a.keyCode===
13&&this._commitIME()}},_handleLinkClick:function(a){if(!(e.isMac?a.metaKey:a.ctrlKey))return a.preventDefault&&a.preventDefault(),!1},_handleMouse:function(a){var c=this._getWindow(),d=!0,b=c;if(e.isIE||e.isFirefox&&!this._overlayDiv)b=this._clientDiv;if(this._overlayDiv){if(this._hasFocus)this._ignoreFocus=!0;var k=this;c.setTimeout(function(){k.focus();k._ignoreFocus=!1},0)}this._clickCount===1?(d=this._setSelectionTo(a.clientX,a.clientY,a.shiftKey,!e.isOpera&&this._hasFocus&&this.isListening("DragStart")))&&
this._setGrab(b):(this._isW3CEvents&&this._setGrab(b),this._doubleClickSelection=null,this._setSelectionTo(a.clientX,a.clientY,a.shiftKey),this._doubleClickSelection=this._getSelection());return d},_handleMouseDown:function(a){if(!this._ignoreEvent(a)){if(this._linksVisible)if((a.target||a.srcElement).tagName!=="A")this._setLinksVisible(!1);else return;this._commitIME();var c=a.which;c||(a.button===4&&(c=2),a.button===2&&(c=3),a.button===1&&(c=1));var d=c!==2&&a.timeStamp?a.timeStamp:(new Date).getTime(),
b=d-this._lastMouseTime,k=Math.abs(this._lastMouseX-a.clientX),h=Math.abs(this._lastMouseY-a.clientY),f=this._lastMouseButton===c;this._lastMouseX=a.clientX;this._lastMouseY=a.clientY;this._lastMouseTime=d;this._lastMouseButton=c;if(c===1)this._isMouseDown=!0,f&&b<=this._clickTime&&k<=this._clickDist&&h<=this._clickDist?this._clickCount++:this._clickCount=1;if(this.isListening("MouseDown")&&(d=this._createMouseEvent("MouseDown",a),this.onMouseDown(d),d.defaultPrevented)){a.preventDefault();return}if(c===
1&&this._handleMouse(a)&&(e.isIE>=9||e.isOpera||e.isChrome||e.isSafari||e.isFirefox&&!this._overlayDiv))this._hasFocus||this.focus(),a.preventDefault();e.isFirefox&&this._lastMouseButton===3&&this._updateDOMSelection()}},_handleMouseOver:function(a){if(!this._ignoreEvent(a)&&!this._animation&&this.isListening("MouseOver"))this.onMouseOver(this._createMouseEvent("MouseOver",a))},_handleMouseOut:function(a){if(!this._ignoreEvent(a)&&!this._animation&&this.isListening("MouseOut"))this.onMouseOut(this._createMouseEvent("MouseOut",
a))},_handleMouseMove:function(a){if(!this._animation){var c=this._isClientDiv(a);if(this.isListening("MouseMove")&&c)this.onMouseMove(this._createMouseEvent("MouseMove",a));if(!this._dropTarget){var d=this._linksVisible||this._lastMouseMoveX!==a.clientX||this._lastMouseMoveY!==a.clientY;this._lastMouseMoveX=a.clientX;this._lastMouseMoveY=a.clientY;this._setLinksVisible(d&&!this._isMouseDown&&(e.isMac?a.metaKey:a.ctrlKey));if(!this._isW3CEvents){if(a.button===0)return this._setGrab(null),!0;if(!this._isMouseDown&&
a.button===1&&(this._clickCount&1)!==0&&c)return this._clickCount=2,this._handleMouse(a,this._clickCount)}if(this._isMouseDown&&this._dragOffset===-1){var c=a.clientX,a=a.clientY,b=this._getViewPadding(),k=this._viewDiv.getBoundingClientRect(),h=this._getClientWidth(),f=this._getClientHeight(),d=k.left+b.left,m=k.top+b.top,h=k.left+b.left+h,b=k.top+b.top+f;a<m?this._doAutoScroll("up",c,a-m):a>b?this._doAutoScroll("down",c,a-b):c<d&&!this._wrapMode?this._doAutoScroll("left",c-d,a):c>h&&!this._wrapMode?
this._doAutoScroll("right",c-h,a):(this._endAutoScroll(),this._setSelectionTo(c,a,!0))}}}},_isClientDiv:function(a){for(var c=this._overlayDiv||this._clientDiv,a=a.target?a.target:a.srcElement;a;){if(c===a)return!0;a=a.parentNode}return!1},_createKeyEvent:function(a,c){return{type:a,event:c,preventDefault:function(){this.defaultPrevented=!0}}},_createMouseEvent:function(a,c){var d=this.convert({x:c.clientX,y:c.clientY},"page","document");return{type:a,event:c,clickCount:this._clickCount,x:d.x,y:d.y,
preventDefault:function(){this.defaultPrevented=!0}}},_handleMouseUp:function(a){var c=a.which?a.button===0:a.button===1;if(this.isListening("MouseUp")&&(this._isClientDiv(a)||c&&this._isMouseDown))this.onMouseUp(this._createMouseEvent("MouseUp",a));if(!this._linksVisible&&c&&this._isMouseDown){if(this._dragOffset!==-1)c=this._getSelection(),c.extend(this._dragOffset),c.collapse(),this._setSelection(c,!0,!0),this._dragOffset=-1;this._isMouseDown=!1;this._endAutoScroll();this._isW3CEvents&&this._setGrab(null);
e.isFirefox&&a.preventDefault()}},_handleMouseWheel:function(a){var c=this._getLineHeight(),d=0,b=0;e.isIE||e.isOpera?b=-a.wheelDelta/40*c:e.isFirefox?(c=e.isMac?a.detail*3:Math.max(-256,Math.min(256,a.detail))*c,a.axis===a.HORIZONTAL_AXIS?d=c:b=c):e.isMac?(b=a.timeStamp-this._wheelTimeStamp,this._wheelTimeStamp=a.timeStamp,d=a.wheelDeltaX%120!==0?1:b<40?40/(40-b):40,b=a.wheelDeltaY%120!==0?1:b<40?40/(40-b):40,d=Math.ceil(-a.wheelDeltaX/d),-1<d&&d<0&&(d=-1),0<d&&d<1&&(d=1),b=Math.ceil(-a.wheelDeltaY/
b),-1<b&&b<0&&(b=-1),0<b&&b<1&&(b=1)):(d=-a.wheelDeltaX,b=-a.wheelDeltaY/120*8*c);if(e.isSafari){for(c=a.target;c&&c.lineIndex===void 0;)c=c.parentNode;this._mouseWheelLine=c}c=this._getScroll();this._scrollView(d,b);d=this._getScroll();if(c.x!==d.x||c.y!==d.y)return a.preventDefault&&a.preventDefault(),!1},_handlePaste:function(a){if(!this._ignoreEvent(a)&&!this._ignorePaste&&this._doPaste(a)){if(e.isIE){var c=this;this._ignoreFocus=!0;this._getWindow().setTimeout(function(){c._updateDOMSelection();
c._ignoreFocus=!1},0)}a.preventDefault&&a.preventDefault();return!1}},_handleResize:function(){var a=this._parent.clientWidth,d=this._parent.clientHeight;if(this._parentWidth!==a||this._parentHeight!==d){this._parentWidth!==a&&this._wrapMode&&this._resetLineHeight();this._parentWidth=a;this._parentHeight=d;a=e.isIE<9;d=this._calculateMetrics();if(!c(d,this._metrics)){if(this._variableLineHeight)this._variableLineHeight=!1,this._resetLineHeight();this._metrics=d;a=!0}a?this._queueUpdate():this._update()}},
_handleRulerEvent:function(a){for(var c=a.target?a.target:a.srcElement,d=c.lineIndex;c&&!c._ruler;){if(d===void 0&&c.lineIndex!==void 0)d=c.lineIndex;c=c.parentNode}var b=c?c._ruler:null;if(d===void 0&&b&&b.getOverview()==="document"){var d=this._getClientHeight(),e=this._model.getLineCount(),k=this._getViewPadding(),h=this._viewDiv.getBoundingClientRect(),d=Math.floor((a.clientY-h.top-this._metrics.scrollWidth)*e/(d+k.top+k.bottom-2*this._metrics.scrollWidth));0<=d&&d<e||(d=void 0)}if(b)switch(a.type){case "click":if(b.onClick)b.onClick(d,
a);break;case "dblclick":if(b.onDblClick)b.onDblClick(d,a);break;case "mousemove":if(b.onMouseMove)b.onMouseMove(d,a);break;case "mouseover":if(b.onMouseOver)b.onMouseOver(d,a);break;case "mouseout":if(b.onMouseOut){for(e=a.relatedTarget;e&&e!==this._rootDiv;){if(e===c)return;e=e.parentNode}b.onMouseOut(d,a)}}},_handleScroll:function(){var a=this._getScroll(!1),c=this._hScroll,d=this._vScroll;if(c!==a.x||d!==a.y)this._hScroll=a.x,this._vScroll=a.y,this._commitIME(),this._update(d===a.y),this.onScroll({type:"Scroll",
oldValue:{x:c,y:d},newValue:a})},_handleSelectStart:function(a){if(this._ignoreSelect)return a&&a.preventDefault&&a.preventDefault(),!1},_getModelOffset:function(a,c){if(a){var d;d=a.tagName==="DIV"?a:a.parentNode.parentNode;var b=0,e=d.lineIndex;if(a.tagName!=="DIV")for(d=d.firstChild;d;){var k=d.firstChild;if(k===a){d.ignoreChars&&(b-=d.ignoreChars);b+=c;break}d.ignoreChars&&(b-=d.ignoreChars);b+=k.data.length;d=d.nextSibling}return Math.max(0,b)+this._model.getLineStart(e)}},_updateSelectionFromDOM:function(){var a=
this._getWindow().getSelection(),c=this._getModelOffset(a.anchorNode,a.anchorOffset),a=this._getModelOffset(a.focusNode,a.focusOffset);c===void 0||a===void 0||this._setSelection(new p(c,a),!1,!1)},_handleSelectionChange:function(){if(this._imeOffset===-1)if(e.isAndroid){var a=this._getWindow();this._selTimer&&a.clearTimeout(this._selTimer);var c=this;this._selTimer=a.setTimeout(function(){if(c._clientDiv)c._selTimer=null,c._updateSelectionFromDOM()},250)}else this._updateSelectionFromDOM()},_handleTextInput:function(a){if(!this._ignoreEvent(a)){this._imeOffset=
-1;if(e.isAndroid){for(var c=this._getWindow().getSelection(),d=c.anchorNode;d;){if(d.lineIndex!==void 0)break;d=d.parentNode}if(d){var b=this._model,k=d.lineIndex,h=b.getLine(k),f=h,m=0,b=b.getLineStart(k);if(c.rangeCount>0)c.getRangeAt(0).deleteContents(),k=d.ownerDocument.createTextNode(a.data),c.getRangeAt(0).insertNode(k),m=this._getDOMText(d,k),f=m.text,m=m.offset,k.parentNode.removeChild(k);d.lineRemoved=!0;for(d=0;h.charCodeAt(d)===f.charCodeAt(d)&&d<m;)d++;c=h.length-1;for(k=f.length-h.length;h.charCodeAt(c)===
f.charCodeAt(c+k)&&c+k>=m+a.data.length;)c--;c++;h=f.substring(d,c+k);d+=b;c+=b;this._modifyContent({text:h,start:d,end:c,_ignoreDOMSelection:!0},!0)}}else this._doContent(a.data);a.preventDefault()}},_handleTouchStart:function(a){this._commitIME();var c=this._getWindow();if(this._touchScrollTimer)this._vScrollDiv.style.display="none",this._hScrollDiv.style.display="none",c.clearInterval(this._touchScrollTimer),this._touchScrollTimer=null;var d=a.touches;if(d.length===1){var d=d[0],b=d.clientX,k=
d.clientY;this._touchStartX=b;this._touchStartY=k;if(e.isAndroid&&(k<d.pageY-c.pageYOffset||b<d.pageX-c.pageXOffset))b=d.pageX-c.pageXOffset,k=d.pageY-c.pageYOffset;c=this.convert({x:b,y:k},"page","document");this._lastTouchOffset=this.getOffsetAtLocation(c.x,c.y);this._touchStartTime=a.timeStamp;this._touching=!0}},_handleTouchMove:function(a){var c=a.touches;if(c.length===1){c=c[0];this._touchCurrentX=c.clientX;this._touchCurrentY=c.clientY;if(!this._touchScrollTimer&&a.timeStamp-this._touchStartTime<
200){this._vScrollDiv.style.display="block";if(!this._wrapMode)this._hScrollDiv.style.display="block";var d=this,b=this._getWindow();this._touchScrollTimer=b.setInterval(function(){var a=0,c=0;if(d._touching)a=d._touchStartX-d._touchCurrentX,c=d._touchStartY-d._touchCurrentY,d._touchSpeedX=a/10,d._touchSpeedY=c/10,d._touchStartX=d._touchCurrentX,d._touchStartY=d._touchCurrentY;else if(Math.abs(d._touchSpeedX)<0.1&&Math.abs(d._touchSpeedY)<0.1){d._vScrollDiv.style.display="none";d._hScrollDiv.style.display=
"none";b.clearInterval(d._touchScrollTimer);d._touchScrollTimer=null;return}else a=d._touchSpeedX*10,c=d._touchSpeedY*10,d._touchSpeedX*=0.95,d._touchSpeedY*=0.95;d._scrollView(a,c)},10)}this._touchScrollTimer&&a.preventDefault()}},_handleTouchEnd:function(a){if(a.touches.length===0)this._touching=!1},_doAction:function(a){var c,d,b=this._keyModes;for(d=b.length-1;d>=0;d--)if(c=b[d],typeof c.match==="function"&&(c=c.match(a),c!==void 0))return this.invokeAction(c);return!1},_doMove:function(a,c){var d=
this._model,b=c.getCaret(),k=d.getLineAtOffset(b);if(!a.count)a.count=1;for(;a.count!==0;){var e=d.getLineStart(k);if(a.count<0&&b===e)if(k>0)a.unit==="character"&&a.count++,k--,c.extend(d.getLineEnd(k));else break;else if(a.count>0&&b===d.getLineEnd(k))if(k+1<d.getLineCount())a.unit==="character"&&a.count--,k++,c.extend(d.getLineStart(k));else break;else{var h=!1;a.expandTab&&a.unit==="character"&&(b-e)%this._tabSize===0&&(h=!/[^ ]/.test(d.getText(e,b)));h?(c.extend(b-this._tabSize),a.count+=a.count<
0?1:-1):(e=this._getLine(k),c.extend(e.getNextOffset(b,a)),e.destroy())}b=c.getCaret()}return c},_doBackspace:function(a){var c=this._getSelection();if(c.isEmpty()){if(!a.count)a.count=1;a.count*=-1;a.expandTab=this._expandTab;this._doMove(a,c)}this._modifyContent({text:"",start:c.start,end:c.end},!0);return!0},_doCase:function(a){var c=this._getSelection();this._doMove(a,c);var d=this.getText(c.start,c.end);this._setSelection(c,!0);switch(a.type){case "lower":d=d.toLowerCase();break;case "capitalize":d=
d.replace(/(?:^|\s)\S/g,function(a){return a.toUpperCase()});break;case "reverse":a="";for(c=0;c<d.length;c++){var b=d[c],k=b.toLowerCase(),b=k!==b?k:b.toUpperCase();a+=b}d=a;break;default:d=d.toUpperCase()}this._doContent(d);return!0},_doContent:function(a){var c=this._getSelection();if(this._overwriteMode&&c.isEmpty()){var d=this._model,b=d.getLineAtOffset(c.end);c.end<d.getLineEnd(b)&&(d=this._getLine(b),c.extend(d.getNextOffset(c.getCaret(),{unit:"character",count:1})),d.destroy())}this._modifyContent({text:a,
start:c.start,end:c.end,_ignoreDOMSelection:!0},!0)},_doCopy:function(a){var c=this._getSelection();return!c.isEmpty()?this._setClipboardText(this._getBaseText(c.start,c.end),a):!0},_doCursorNext:function(a){var c=this._getSelection();!c.isEmpty()&&!a.select?c.start=c.end:this._doMove(a,c);a.select||c.collapse();this._setSelection(c,!0);return!0},_doCursorPrevious:function(a){var c=this._getSelection();if(!c.isEmpty()&&!a.select)c.end=c.start;else{if(!a.count)a.count=1;a.count*=-1;this._doMove(a,
c)}a.select||c.collapse();this._setSelection(c,!0);return!0},_doCut:function(a){var c=this._getSelection();return!c.isEmpty()?(c=this._getBaseText(c.start,c.end),this._doContent(""),this._setClipboardText(c,a)):!0},_doDelete:function(a){var c=this._getSelection();c.isEmpty()&&this._doMove(a,c);this._modifyContent({text:"",start:c.start,end:c.end},!0);return!0},_doEnd:function(a){var c=this._getSelection(),d=this._model,b;if(a.ctrl)c.extend(d.getCharCount()),b=function(){};else{var k=c.getCaret(),
e=d.getLineAtOffset(k);if(this._wrapMode){var h=this._getLine(e),k=h.getLineIndex(k),k=k===h.getLineCount()-1?d.getLineEnd(e):h.getLineStart(k+1)-1;h.destroy()}else a.count&&a.count>0&&(e=Math.min(e+a.count-1,d.getLineCount()-1)),k=d.getLineEnd(e);c.extend(k)}a.select||c.collapse();this._setSelection(c,!0,!0,b);return!0},_doEnter:function(a){var c=this._model,d=this._getSelection();this._doContent(c.getLineDelimiter());if(a&&a.noCursor)d.end=d.start,this._setSelection(d,!0);return!0},_doHome:function(a){var c=
this._getSelection(),d=this._model,b;if(a.ctrl)c.extend(0),b=function(){};else{var k=c.getCaret(),e=d.getLineAtOffset(k);this._wrapMode?(d=this._getLine(e),k=d.getLineIndex(k),k=d.getLineStart(k),d.destroy()):k=d.getLineStart(e);c.extend(k)}a.select||c.collapse();this._setSelection(c,!0,!0,b);return!0},_doLineDown:function(a){var c=this._model,d=this._getSelection(),b=d.getCaret(),k=c.getLineAtOffset(b),h=this._getLine(k),f=this._columnX,m=1,g=!1;if(f===-1||a.wholeLine||a.select&&e.isIE)f=a.wholeLine?
c.getLineEnd(k+1):b,f=h.getBoundingClientRect(f).left;(b=h.getLineIndex(b))<h.getLineCount()-1?m=h.getClientRects(b+1).top+1:(b=c.getLineCount()-1,g=k===b,a.count&&a.count>0?k=Math.min(k+a.count,b):k++);b=!1;if(g){if(a.select||e.isMac||e.isLinux)d.extend(c.getCharCount()),b=!0}else h.lineIndex!==k&&(h.destroy(),h=this._getLine(k)),d.extend(h.getOffset(f,m)),b=!0;b&&(a.select||d.collapse(),this._setSelection(d,!0,!0));this._columnX=f;h.destroy();return!0},_doLineUp:function(a){var c=this._model,d=
this._getSelection(),b=d.getCaret(),k=c.getLineAtOffset(b),h=this._getLine(k),f=this._columnX,m=!1,g;if(f===-1||a.wholeLine||a.select&&e.isIE)f=a.wholeLine?c.getLineStart(k-1):b,f=h.getBoundingClientRect(f).left;(b=h.getLineIndex(b))>0?g=h.getClientRects(b-1).top+1:(m=k===0,m||(a.count&&a.count>0?k=Math.max(k-a.count,0):k--,g=this._getLineHeight(k)-1));b=!1;if(m){if(a.select||e.isMac||e.isLinux)d.extend(0),b=!0}else h.lineIndex!==k&&(h.destroy(),h=this._getLine(k)),d.extend(h.getOffset(f,g)),b=!0;
b&&(a.select||d.collapse(),this._setSelection(d,!0,!0));this._columnX=f;h.destroy();return!0},_doNoop:function(){return!0},_doPageDown:function(a){var c=this,d=this._model,b=this._getSelection(),k=b.getCaret(),h=d.getLineAtOffset(k),f=d.getLineCount(),m=this._getScroll(),d=this._getClientHeight(),g,i;if(this._lineHeight){g=this._columnX;m=this._getBoundsAtOffset(k);if(g===-1||a.select&&e.isIE)g=m.left;k=this._getLineIndex(m.top+d);i=this._getLine(k);h=this._getLinePixel(k);k=i.getOffset(g,m.top+d-
h);d=i.getBoundingClientRect(k);i.destroy();b.extend(k);a.select||b.collapse();this._setSelection(b,!0,!0,function(){c._columnX=g},d.top+h-m.top);return!0}if(h<f-1){var q=this._getLineHeight(),p=Math.min(f-h-1,Math.floor(d/q)),p=Math.max(1,p);g=this._columnX;if(g===-1||a.select&&e.isIE)i=this._getLine(h),g=i.getBoundingClientRect(k).left,i.destroy();i=this._getLine(h+p);b.extend(i.getOffset(g,0));i.destroy();a.select||b.collapse();a=f*q;k=m.y+p*q;k+d>a&&(k=a-d);this._setSelection(b,!0,!0,function(){c._columnX=
g},k-m.y)}return!0},_doPageUp:function(a){var c=this,d=this._model,b=this._getSelection(),k=b.getCaret(),h=d.getLineAtOffset(k),f=this._getScroll(),m=this._getClientHeight(),g;if(this._lineHeight){g=this._columnX;f=this._getBoundsAtOffset(k);if(g===-1||a.select&&e.isIE)g=f.left;k=this._getLineIndex(f.bottom-m);d=this._getLine(k);h=this._getLinePixel(k);k=d.getOffset(g,f.bottom-m-h);m=d.getBoundingClientRect(k);d.destroy();b.extend(k);a.select||b.collapse();this._setSelection(b,!0,!0,function(){c._columnX=
g},m.top+h-f.top);return!0}if(h>0){var i=this._getLineHeight(),m=Math.max(1,Math.min(h,Math.floor(m/i)));g=this._columnX;if(g===-1||a.select&&e.isIE)d=this._getLine(h),g=d.getBoundingClientRect(k).left,d.destroy();d=this._getLine(h-m);b.extend(d.getOffset(g,this._getLineHeight(h-m)-1));d.destroy();a.select||b.collapse();a=Math.max(0,f.y-m*i);this._setSelection(b,!0,!0,function(){c._columnX=g},a-f.y)}return!0},_doPaste:function(a){var c=this;return this._getClipboardText(a,function(a){a&&(e.isLinux&&
c._lastMouseButton===2&&(new Date).getTime()-c._lastMouseTime<=c._clickTime&&c._setSelectionTo(c._lastMouseX,c._lastMouseY),c._doContent(a))})!==null},_doScroll:function(a){var c=a.type,d=this._model,b=d.getLineCount(),a=this._getClientHeight(),k=this._getLineHeight();b*=k;var e=this._getScroll().y,h;switch(c){case "textStart":h=0;break;case "textEnd":h=b-a;break;case "pageDown":h=e+a;break;case "pageUp":h=e-a;break;case "lineDown":h=e+k;break;case "lineUp":h=e-k;break;case "centerLine":c=this._getSelection(),
h=d.getLineAtOffset(c.start),d=(d.getLineAtOffset(c.end)-h+1)*k,h=h*k-a/2+d/2}h!==void 0&&(h=Math.min(Math.max(0,h),b-a),this._scrollViewAnimated(0,h-e,function(){}));return!0},_doSelectAll:function(){var a=this._model,c=this._getSelection();c.setCaret(0);c.extend(a.getCharCount());this._setSelection(c,!1);return!0},_doTab:function(){if(this._tabMode&&!this._readonly){var a="\t";if(this._expandTab)var c=this._model,a=this._getSelection().getCaret(),d=c.getLineAtOffset(a),c=c.getLineStart(d),a=Array(this._tabSize-
(a-c)%this._tabSize+1).join(" ");this._doContent(a);return!0}},_doShiftTab:function(){return!this._tabMode||this._readonly?void 0:!0},_doOverwriteMode:function(){if(!this._readonly)return this.setOptions({overwriteMode:!this.getOptions("overwriteMode")}),!0},_doTabMode:function(){this._tabMode=!this._tabMode;return!0},_doWrapMode:function(){this.setOptions({wrapMode:!this.getOptions("wrapMode")});return!0},_autoScroll:function(){var a=this._model,c=this._getSelection(),d=this.convert({x:this._autoScrollX,
y:this._autoScrollY},"page","document"),b=c.getCaret(),k=a.getLineCount(),h=a.getLineAtOffset(b),f;if(this._autoScrollDir==="up"||this._autoScrollDir==="down")b=this._autoScrollY/this._getLineHeight(),b=b<0?Math.floor(b):Math.ceil(b),f=Math.max(0,Math.min(k-1,h+b));else if(this._autoScrollDir==="left"||this._autoScrollDir==="right")f=this._getLineIndex(d.y),h=this._getLine(h),d.x+=h.getBoundingClientRect(b,!1).left,h.destroy();f===0&&(e.isMac||e.isLinux)?c.extend(0):f===k-1&&(e.isMac||e.isLinux)?
c.extend(a.getCharCount()):(h=this._getLine(f),c.extend(h.getOffset(d.x,d.y-this._getLinePixel(f))),h.destroy());this._setSelection(c,!0)},_autoScrollTimer:function(){this._autoScroll();var a=this;this._autoScrollTimerID=this._getWindow().setTimeout(function(){a._autoScrollTimer()},this._AUTO_SCROLL_RATE)},_calculateLineHeightTimer:function(a){if(this._lineHeight&&!this._calculateLHTimer){var c=this._model.getLineCount(),d=0;if(a){for(var a=0,b=(new Date).getTime(),k=0;d<c;)if(this._lineHeight[d]||
(a++,k||(k=d),this._lineHeight[d]=this._calculateLineHeight(d)),d++,(new Date).getTime()-b>100)break;this.redrawRulers(0,c);this._queueUpdate()}a=this._getWindow();if(d!==c){var h=this;this._calculateLHTimer=a.setTimeout(function(){h._calculateLHTimer=null;h._calculateLineHeightTimer(!0)},0)}else if(this._calculateLHTimer)a.clearTimeout(this._calculateLHTimer),this._calculateLHTimer=void 0}},_calculateLineHeight:function(a){var a=this._getLine(a),c=a.getBoundingClientRect();a.destroy();return Math.max(1,
c.bottom-c.top)},_calculateMetrics:function(){var a=this._clientDiv,c=a.ownerDocument,d=e.createElement(c,"div");d.style.lineHeight="normal";var b={type:"LineStyle",textView:this,0:0,lineText:this._model.getLine(0),lineStart:0};this.onLineStyle(b);i(b.style,d);d.style.position="fixed";d.style.left="-1000px";var h=e.createElement(c,"span");h.appendChild(c.createTextNode(" "));d.appendChild(h);var f=e.createElement(c,"span");f.style.fontStyle="italic";f.appendChild(c.createTextNode(" "));d.appendChild(f);
var g=e.createElement(c,"span");g.style.fontWeight="bold";g.appendChild(c.createTextNode(" "));d.appendChild(g);b=e.createElement(c,"span");b.style.fontWeight="bold";b.style.fontStyle="italic";b.appendChild(c.createTextNode(" "));d.appendChild(b);a.appendChild(d);var q=d.getBoundingClientRect(),h=h.getBoundingClientRect(),f=f.getBoundingClientRect(),g=g.getBoundingClientRect(),b=b.getBoundingClientRect(),h=h.bottom-h.top,f=f.bottom-f.top,g=g.bottom-g.top,p=b.bottom-b.top,r=0,b=q.bottom-q.top<=0,q=
Math.max(1,q.bottom-q.top);f>h&&(r=1);g>f&&(r=2);p>g&&(r=3);var s;if(r!==0){s={style:{}};if((r&1)!==0)s.style.fontStyle="italic";if((r&2)!==0)s.style.fontWeight="bold"}h=m(d);a.removeChild(d);f=k(this._viewDiv);d=e.createElement(c,"div");d.style.position="fixed";d.style.left="-1000px";d.style.paddingLeft=f.left+"px";d.style.paddingTop=f.top+"px";d.style.paddingRight=f.right+"px";d.style.paddingBottom=f.bottom+"px";d.style.width="100px";d.style.height="100px";p=e.createElement(c,"div");p.style.width=
"100%";p.style.height="100%";d.appendChild(p);a.appendChild(d);c=d.getBoundingClientRect();f=p.getBoundingClientRect();g=0;if(!this._singleMode)d.style.overflow="hidden",p.style.height="200px",g=d.clientWidth,d.style.overflow="scroll",p=d.clientWidth,a.removeChild(d),g-=p;f={left:f.left-c.left,top:f.top-c.top,right:c.right-f.right,bottom:c.bottom-f.bottom};return{lineHeight:q,largestFontStyle:s,lineTrim:h,viewPadding:f,scrollWidth:g,invalid:b}},_cancelAnimation:function(){if(this._animation)this._animation.stop(),
this._animation=null},_clearSelection:function(a){var c=this._getSelection();if(c.isEmpty())return!1;a==="next"?c.start=c.end:c.end=c.start;this._setSelection(c,!0);return!0},_commitIME:function(){if(this._imeOffset!==-1){this._scrollDiv.focus();this._clientDiv.focus();var a=this._model,c=a.getLineAtOffset(this._imeOffset),d=a.getLineStart(c),b=this._getDOMText(this._getLineNode(c)).text,a=a.getLine(c),d=this._imeOffset-d,a=d+b.length-a.length;d!==a&&this._doContent(b.substring(d,a));this._imeOffset=
-1}},_createActions:function(){this.addKeyMode(new n.DefaultKeyMode(this));var c=this;this._actions={noop:{defaultHandler:function(){return c._doNoop()}},lineUp:{defaultHandler:function(d){return c._doLineUp(a(d,{select:!1}))},actionDescription:{name:j.lineUp}},lineDown:{defaultHandler:function(d){return c._doLineDown(a(d,{select:!1}))},actionDescription:{name:j.lineDown}},lineStart:{defaultHandler:function(d){return c._doHome(a(d,{select:!1,ctrl:!1}))},actionDescription:{name:j.lineStart}},lineEnd:{defaultHandler:function(d){return c._doEnd(a(d,
{select:!1,ctrl:!1}))},actionDescription:{name:j.lineEnd}},charPrevious:{defaultHandler:function(d){return c._doCursorPrevious(a(d,{select:!1,unit:"character"}))},actionDescription:{name:j.charPrevious}},charNext:{defaultHandler:function(d){return c._doCursorNext(a(d,{select:!1,unit:"character"}))},actionDescription:{name:j.charNext}},pageUp:{defaultHandler:function(d){return c._doPageUp(a(d,{select:!1}))},actionDescription:{name:j.pageUp}},pageDown:{defaultHandler:function(d){return c._doPageDown(a(d,
{select:!1}))},actionDescription:{name:j.pageDown}},scrollPageUp:{defaultHandler:function(d){return c._doScroll(a(d,{type:"pageUp"}))},actionDescription:{name:j.scrollPageUp}},scrollPageDown:{defaultHandler:function(d){return c._doScroll(a(d,{type:"pageDown"}))},actionDescription:{name:j.scrollPageDown}},scrollLineUp:{defaultHandler:function(d){return c._doScroll(a(d,{type:"lineUp"}))},actionDescription:{name:j.scrollLineUp}},scrollLineDown:{defaultHandler:function(d){return c._doScroll(a(d,{type:"lineDown"}))},
actionDescription:{name:j.scrollLineDown}},wordPrevious:{defaultHandler:function(d){return c._doCursorPrevious(a(d,{select:!1,unit:"word"}))},actionDescription:{name:j.wordPrevious}},wordNext:{defaultHandler:function(d){return c._doCursorNext(a(d,{select:!1,unit:"word"}))},actionDescription:{name:j.wordNext}},textStart:{defaultHandler:function(d){return c._doHome(a(d,{select:!1,ctrl:!0}))},actionDescription:{name:j.textStart}},textEnd:{defaultHandler:function(d){return c._doEnd(a(d,{select:!1,ctrl:!0}))},
actionDescription:{name:j.textEnd}},scrollTextStart:{defaultHandler:function(d){return c._doScroll(a(d,{type:"textStart"}))},actionDescription:{name:j.scrollTextStart}},scrollTextEnd:{defaultHandler:function(d){return c._doScroll(a(d,{type:"textEnd"}))},actionDescription:{name:j.scrollTextEnd}},centerLine:{defaultHandler:function(d){return c._doScroll(a(d,{type:"centerLine"}))},actionDescription:{name:j.centerLine}},selectLineUp:{defaultHandler:function(d){return c._doLineUp(a(d,{select:!0}))},actionDescription:{name:j.selectLineUp}},
selectLineDown:{defaultHandler:function(d){return c._doLineDown(a(d,{select:!0}))},actionDescription:{name:j.selectLineDown}},selectWholeLineUp:{defaultHandler:function(d){return c._doLineUp(a(d,{select:!0,wholeLine:!0}))},actionDescription:{name:j.selectWholeLineUp}},selectWholeLineDown:{defaultHandler:function(d){return c._doLineDown(a(d,{select:!0,wholeLine:!0}))},actionDescription:{name:j.selectWholeLineDown}},selectLineStart:{defaultHandler:function(d){return c._doHome(a(d,{select:!0,ctrl:!1}))},
actionDescription:{name:j.selectLineStart}},selectLineEnd:{defaultHandler:function(d){return c._doEnd(a(d,{select:!0,ctrl:!1}))},actionDescription:{name:j.selectLineEnd}},selectCharPrevious:{defaultHandler:function(d){return c._doCursorPrevious(a(d,{select:!0,unit:"character"}))},actionDescription:{name:j.selectCharPrevious}},selectCharNext:{defaultHandler:function(d){return c._doCursorNext(a(d,{select:!0,unit:"character"}))},actionDescription:{name:j.selectCharNext}},selectPageUp:{defaultHandler:function(d){return c._doPageUp(a(d,
{select:!0}))},actionDescription:{name:j.selectPageUp}},selectPageDown:{defaultHandler:function(d){return c._doPageDown(a(d,{select:!0}))},actionDescription:{name:j.selectPageDown}},selectWordPrevious:{defaultHandler:function(d){return c._doCursorPrevious(a(d,{select:!0,unit:"word"}))},actionDescription:{name:j.selectWordPrevious}},selectWordNext:{defaultHandler:function(d){return c._doCursorNext(a(d,{select:!0,unit:"word"}))},actionDescription:{name:j.selectWordNext}},selectTextStart:{defaultHandler:function(d){return c._doHome(a(d,
{select:!0,ctrl:!0}))},actionDescription:{name:j.selectTextStart}},selectTextEnd:{defaultHandler:function(d){return c._doEnd(a(d,{select:!0,ctrl:!0}))},actionDescription:{name:j.selectTextEnd}},deletePrevious:{defaultHandler:function(d){return c._doBackspace(a(d,{unit:"character"}))},actionDescription:{name:j.deletePrevious}},deleteNext:{defaultHandler:function(d){return c._doDelete(a(d,{unit:"character"}))},actionDescription:{name:j.deleteNext}},deleteWordPrevious:{defaultHandler:function(d){return c._doBackspace(a(d,
{unit:"word"}))},actionDescription:{name:j.deleteWordPrevious}},deleteWordNext:{defaultHandler:function(d){return c._doDelete(a(d,{unit:"word"}))},actionDescription:{name:j.deleteWordNext}},deleteLineStart:{defaultHandler:function(d){return c._doBackspace(a(d,{unit:"line"}))},actionDescription:{name:j.deleteLineStart}},deleteLineEnd:{defaultHandler:function(d){return c._doDelete(a(d,{unit:"line"}))},actionDescription:{name:j.deleteLineEnd}},tab:{defaultHandler:function(){return c._doTab()},actionDescription:{name:j.tab}},
shiftTab:{defaultHandler:function(){return c._doShiftTab()},actionDescription:{name:j.shiftTab}},enter:{defaultHandler:function(){return c._doEnter()},actionDescription:{name:j.enter}},enterNoCursor:{defaultHandler:function(d){return c._doEnter(a(d,{noCursor:!0}))},actionDescription:{name:j.enterNoCursor}},selectAll:{defaultHandler:function(){return c._doSelectAll()},actionDescription:{name:j.selectAll}},copy:{defaultHandler:function(){return c._doCopy()},actionDescription:{name:j.copy}},cut:{defaultHandler:function(){return c._doCut()},
actionDescription:{name:j.cut}},paste:{defaultHandler:function(){return c._doPaste()},actionDescription:{name:j.paste}},uppercase:{defaultHandler:function(d){return c._doCase(a(d,{type:"upper"}))},actionDescription:{name:j.uppercase}},lowercase:{defaultHandler:function(d){return c._doCase(a(d,{type:"lower"}))},actionDescription:{name:j.lowercase}},capitalize:{defaultHandler:function(d){return c._doCase(a(d,{unit:"word",type:"capitalize"}))},actionDescription:{name:j.capitalize}},reversecase:{defaultHandler:function(d){return c._doCase(a(d,
{type:"reverse"}))},actionDescription:{name:j.reversecase}},toggleOverwriteMode:{defaultHandler:function(){return c._doOverwriteMode()},actionDescription:{name:j.toggleOverwriteMode}},toggleTabMode:{defaultHandler:function(){return c._doTabMode()},actionDescription:{name:j.toggleTabMode}},toggleWrapMode:{defaultHandler:function(){return c._doWrapMode()},actionDescription:{name:j.toggleWrapMode}}}},_createRuler:function(a,c){if(this._clientDiv){var d=a.getLocation()==="left"?this._leftDiv:this._rightDiv;
d.style.display="block";var b=e.createElement(d.ownerDocument,"div");b._ruler=a;b.rulerChanged=!0;b.style.position="relative";b.style.cssFloat="left";b.style.styleFloat="left";b.style.borderWidth="0px";b.style.margin="0px";b.style.padding="0px";b.style.outline="none";if(c===void 0||c<0||c>=d.children.length)d.appendChild(b);else{for(var k=d.firstChild;k&&c-- >0;)k=k.nextSibling;d.insertBefore(b,k)}}},_createView:function(){if(!this._clientDiv){for(var a=this._parent;a.hasChildNodes();)a.removeChild(a.lastChild);
var c=a.ownerDocument,d=e.createElement(c,"div");this._rootDiv=d;d.tabIndex=-1;d.style.position="relative";d.style.overflow="hidden";d.style.width="100%";d.style.height="100%";d.style.overflow="hidden";d.style.WebkitTextSizeAdjust="100%";d.setAttribute("role","application");a.appendChild(d);a=e.createElement(c,"div");a.className="textviewLeftRuler";this._leftDiv=a;a.tabIndex=-1;a.style.overflow="hidden";a.style.MozUserSelect="none";a.style.WebkitUserSelect="none";a.style.position="absolute";a.style.top=
"0px";a.style.bottom="0px";a.style.cursor="default";a.style.display="none";a.setAttribute("aria-hidden","true");d.appendChild(a);a=e.createElement(c,"div");a.className="textviewScroll";this._viewDiv=a;a.tabIndex=-1;a.style.position="absolute";a.style.top="0px";a.style.bottom="0px";a.style.borderWidth="0px";a.style.margin="0px";a.style.outline="none";a.style.background="transparent";if(e.isMac&&e.isWebkit)a.style.pointerEvents="none",a.style.zIndex="2";d.appendChild(a);var b=e.createElement(c,"div");
b.className="textviewRightRuler";this._rightDiv=b;b.tabIndex=-1;b.style.display="none";b.style.overflow="hidden";b.style.MozUserSelect="none";b.style.WebkitUserSelect="none";b.style.position="absolute";b.style.top="0px";b.style.bottom="0px";b.style.cursor="default";b.style.right="0px";b.setAttribute("aria-hidden","true");d.appendChild(b);this._scrollDiv=b=e.createElement(c,"div");b.style.margin="0px";b.style.borderWidth="0px";b.style.padding="0px";a.appendChild(b);if(!e.isIE&&!e.isIOS)this._clipDiv=
a=e.createElement(c,"div"),a.style.position="absolute",a.style.overflow="hidden",a.style.margin="0px",a.style.borderWidth="0px",a.style.padding="0px",a.style.background="transparent",d.appendChild(a),this._clipScrollDiv=b=e.createElement(c,"div"),b.style.position="absolute",b.style.height="1px",b.style.top="-1000px",b.style.background="transparent",a.appendChild(b);this._setFullSelection(this._fullSelection,!0);a=e.createElement(c,"div");a.className="textviewContent";this._clientDiv=a;a.tabIndex=
0;a.style.position="absolute";a.style.borderWidth="0px";a.style.margin="0px";a.style.padding="0px";a.style.outline="none";a.style.zIndex="1";a.style.WebkitUserSelect="text";a.setAttribute("spellcheck","false");if(e.isIOS||e.isAndroid)a.style.WebkitTapHighlightColor="transparent";(this._clipDiv||d).appendChild(a);if(e.isIOS||e.isAndroid)this._vScrollDiv=b=e.createElement(c,"div"),b.style.position="absolute",b.style.borderWidth="1px",b.style.borderColor="white",b.style.borderStyle="solid",b.style.borderRadius=
"4px",b.style.backgroundColor="black",b.style.opacity="0.5",b.style.margin="0px",b.style.padding="0px",b.style.outline="none",b.style.zIndex="3",b.style.width="8px",b.style.display="none",d.appendChild(b),this._hScrollDiv=b=e.createElement(c,"div"),b.style.position="absolute",b.style.borderWidth="1px",b.style.borderColor="white",b.style.borderStyle="solid",b.style.borderRadius="4px",b.style.backgroundColor="black",b.style.opacity="0.5",b.style.margin="0px",b.style.padding="0px",b.style.outline="none",
b.style.zIndex="3",b.style.height="8px",b.style.display="none",d.appendChild(b);if(e.isFirefox&&!a.setCapture)this._overlayDiv=c=e.createElement(c,"div"),c.style.position=a.style.position,c.style.borderWidth=a.style.borderWidth,c.style.margin=a.style.margin,c.style.padding=a.style.padding,c.style.cursor="text",c.style.zIndex="2",(this._clipDiv||d).appendChild(c);a.contentEditable="true";a.setAttribute("role","textbox");a.setAttribute("aria-multiline","true");this._setWrapMode(this._wrapMode,!0);this._setReadOnly(this._readonly);
this._setThemeClass(this._themeClass,!0);this._setTabSize(this._tabSize,!0);this._hookEvents();d=this._rulers;for(c=0;c<d.length;c++)this._createRuler(d[c]);this._update()}},_defaultOptions:function(){return{parent:{value:void 0,update:null},model:{value:void 0,update:this.setModel},scrollAnimation:{value:0,update:null},readonly:{value:!1,update:this._setReadOnly},fullSelection:{value:!0,update:this._setFullSelection},tabMode:{value:!0,update:null},tabSize:{value:8,update:this._setTabSize},expandTab:{value:!1,
update:null},singleMode:{value:!1,update:this._setSingleMode},overwriteMode:{value:!1,update:this._setOverwriteMode},blockCursorVisible:{value:!1,update:this._setBlockCursor},wrapMode:{value:!1,update:this._setWrapMode},wrappable:{value:!1,update:null},theme:{value:b.TextTheme.getTheme(),update:this._setTheme},themeClass:{value:void 0,update:this._setThemeClass}}},_destroyRuler:function(a){var c=a.getLocation()==="left"?this._leftDiv:this._rightDiv;if(c)for(var d=c.firstChild;d;){if(d._ruler===a){d._ruler=
void 0;c.removeChild(d);if(c.children.length===0)c.style.display="none";break}d=d.nextSibling}},_destroyView:function(){if(this._clientDiv){this._setGrab(null);this._unhookEvents();var a=this._getWindow();if(this._autoScrollTimerID)a.clearTimeout(this._autoScrollTimerID),this._autoScrollTimerID=null;if(this._updateTimer)a.clearTimeout(this._updateTimer),this._updateTimer=null;a=this._rootDiv;a.parentNode.removeChild(a);this._hScrollDiv=this._vScrollDiv=this._rightDiv=this._leftDiv=this._overlayDiv=
this._clientDiv=this._clipScrollDiv=this._clipDiv=this._viewDiv=this._scrollDiv=this._rootDiv=this._clipboardDiv=this._selDiv3=this._selDiv2=this._selDiv1=null}},_doAutoScroll:function(a,c,d){this._autoScrollDir=a;this._autoScrollX=c;this._autoScrollY=d;this._autoScrollTimerID||this._autoScrollTimer()},_endAutoScroll:function(){this._autoScrollTimerID&&this._getWindow().clearTimeout(this._autoScrollTimerID);this._autoScrollTimerID=this._autoScrollDir=void 0},_fixCaret:function(){var a=this._clientDiv;
if(a){var c=this._hasFocus;this._ignoreFocus=!0;c&&a.blur();a.contentEditable=!1;a.contentEditable=!0;c&&a.focus();this._ignoreFocus=!1}},_getBaseText:function(a,c){var d=this._model;d.getBaseModel&&(a=d.mapOffset(a),c=d.mapOffset(c),d=d.getBaseModel());return d.getText(a,c)},_getBottomIndex:function(a){var c=this._bottomChild;if(a&&this._getClientHeight()>this._getLineHeight()){var a=c.getBoundingClientRect(),d=this._clientDiv.getBoundingClientRect();a.bottom>d.bottom&&(c=this._getLinePrevious(c)||
c)}return c.lineIndex},_getBoundsAtOffset:function(a){var c=this._getLine(this._model.getLineAtOffset(a)),a=c.getBoundingClientRect(a),d=this._getLinePixel(c.lineIndex);a.top+=d;a.bottom+=d;c.destroy();return a},_getClientHeight:function(){var a=this._getViewPadding();return Math.max(0,this._viewDiv.clientHeight-a.top-a.bottom)},_getClientWidth:function(){var a=this._getViewPadding();return Math.max(0,this._viewDiv.clientWidth-a.left-a.right)},_getClipboardText:function(a,c){var b=this._model.getLineDelimiter(),
k,h,f=this._getWindow(),m=f.clipboardData;if(!m&&a)m=a.clipboardData;if(m)return k=[],h=m.getData(e.isIE?"Text":"text/plain"),d(h,function(a){k.push(a)},function(){k.push(b)}),h=k.join(""),c&&c(h),h;if(e.isFirefox){this._ignoreFocus=!0;var g=this._clipboardDiv,m=this._rootDiv.ownerDocument;if(!g)this._clipboardDiv=g=e.createElement(m,"div"),g.style.position="fixed",g.style.whiteSpace="pre",g.style.left="-1000px",this._rootDiv.appendChild(g);g.innerHTML="<pre contenteditable=''></pre>";g.firstChild.focus();
var i=this,q=function(){var a=i._getTextFromElement(g);g.innerHTML="";k=[];d(a,function(a){k.push(a)},function(){k.push(b)});return k.join("")},p=!1;this._ignorePaste=!0;if(!e.isLinux||this._lastMouseButton!==2)try{p=m.execCommand("paste",!1,null)}catch(r){p=g.childNodes.length>1||g.firstChild&&g.firstChild.childNodes.length>0}this._ignorePaste=!1;if(!p)return a?(f.setTimeout(function(){i.focus();(h=q())&&c&&c(h);i._ignoreFocus=!1},0),null):(this.focus(),this._ignoreFocus=!1,"");this.focus();this._ignoreFocus=
!1;(h=q())&&c&&c(h);return h}return""},_getDOMText:function(a,c){for(var d=a.firstChild,b="",k=0;d;){var h;if(!d.ignore)if(d.ignoreChars){h=d.lastChild;for(var e=0,f=[],m=-1;h;){for(var g=h.data,i=g.length-1;i>=0;i--){var q=g.substring(i,i+1);e<d.ignoreChars&&(q===" "||q==="\u200c"||q==="\ufeff")?e++:f.push(q==="\u00a0"?"\t":q)}if(c===h)m=f.length;h=h.previousSibling}f=f.reverse().join("");m!==-1&&(k=b.length+f.length-m);b+=f}else for(h=d.firstChild;h;){if(c===h)k=b.length;b+=h.data;h=h.nextSibling}d=
d.nextSibling}return{text:b,offset:k}},_getTextFromElement:function(a){var c=a.ownerDocument,d=c.defaultView;if(!d.getSelection)return a.innerText||a.textContent;c=c.createRange();c.selectNode(a);var a=d.getSelection(),d=[],b;for(b=0;b<a.rangeCount;b++)d.push(a.getRangeAt(b));this._ignoreSelect=!0;a.removeAllRanges();a.addRange(c);c=a.toString();a.removeAllRanges();for(b=0;b<d.length;b++)a.addRange(d[b]);this._ignoreSelect=!1;return c},_getViewPadding:function(){return this._metrics.viewPadding},
_getLine:function(a){var c=this._getLineNode(a);return c&&!c.lineChanged&&!c.lineRemoved?c._line:new r(this,a)},_getLineHeight:function(a,c){if(a!==void 0&&this._lineHeight){var d=this._lineHeight[a];if(d)return d;if(c||c===void 0)return this._lineHeight[a]=this._calculateLineHeight(a)}return this._metrics.lineHeight},_getLineNode:function(a){for(var c=this._clientDiv.firstChild;c;){if(a===c.lineIndex)return c;c=c.nextSibling}},_getLineNext:function(a){for(a=a?a.nextSibling:this._clientDiv.firstChild;a&&
a.lineIndex===-1;)a=a.nextSibling;return a},_getLinePrevious:function(a){for(a=a?a.previousSibling:this._clientDiv.lastChild;a&&a.lineIndex===-1;)a=a.previousSibling;return a},_getLinePixel:function(a){a=Math.min(Math.max(0,a),this._model.getLineCount());if(this._lineHeight){var c=this._getTopIndex(),d=-this._topIndexY+this._getScroll().y;if(a>c)for(;c<a;c++)d+=this._getLineHeight(c);else for(c-=1;c>=a;c--)d-=this._getLineHeight(c);return d}return this._getLineHeight()*a},_getLineIndex:function(a){var c,
d=0,b=this._model.getLineCount();if(this._lineHeight){var d=this._getTopIndex(),k=-this._topIndexY+this._getScroll().y;if(a!==k)if(a<k)for(;a<k&&d>0;)a+=this._getLineHeight(--d);else for(c=this._getLineHeight(d);a-c>=k&&d<b-1;)a-=c,c=this._getLineHeight(++d)}else c=this._getLineHeight(),d=Math.floor(a/c);return Math.max(0,Math.min(b-1,d))},_getScroll:function(a){(a===void 0||a)&&this._cancelAnimation();a=this._viewDiv;return{x:a.scrollLeft,y:a.scrollTop}},_getSelection:function(){return this._selection.clone()},
_getTopIndex:function(a){var c=this._topChild;if(a&&this._getClientHeight()>this._getLineHeight()){var a=c.getBoundingClientRect(),d=this._getViewPadding(),b=this._viewDiv.getBoundingClientRect();a.top<b.top+d.top&&(c=this._getLineNext(c)||c)}return c.lineIndex},_hookEvents:function(){var a=this;this._modelListener={onChanging:function(c){a._onModelChanging(c)},onChanged:function(c){a._onModelChanged(c)}};this._model.addEventListener("preChanging",this._modelListener.onChanging);this._model.addEventListener("postChanged",
this._modelListener.onChanged);this._themeListener={onChanged:function(){a._setThemeClass(a._themeClass)}};this._theme.addEventListener("ThemeChanged",this._themeListener.onChanged);var c=this._handlers=[],d=this._clientDiv,b=this._viewDiv,k=this._rootDiv,h=this._overlayDiv||d,f=d.ownerDocument,m=this._getWindow(),g=e.isIE?f:m;c.push({target:m,type:"resize",handler:function(c){return a._handleResize(c?c:m.event)}});c.push({target:d,type:"blur",handler:function(c){return a._handleBlur(c?c:m.event)}});
c.push({target:d,type:"focus",handler:function(c){return a._handleFocus(c?c:m.event)}});c.push({target:b,type:"focus",handler:function(){d.focus()}});c.push({target:b,type:"scroll",handler:function(c){return a._handleScroll(c?c:m.event)}});c.push({target:d,type:"textInput",handler:function(c){return a._handleTextInput(c?c:m.event)}});c.push({target:d,type:"keydown",handler:function(c){return a._handleKeyDown(c?c:m.event)}});c.push({target:d,type:"keypress",handler:function(c){return a._handleKeyPress(c?
c:m.event)}});c.push({target:d,type:"keyup",handler:function(c){return a._handleKeyUp(c?c:m.event)}});e.isIE&&c.push({target:f,type:"keyup",handler:function(c){return a._handleDocKeyUp(c?c:m.event)}});c.push({target:d,type:"contextmenu",handler:function(c){return a._handleContextMenu(c?c:m.event)}});c.push({target:d,type:"copy",handler:function(c){return a._handleCopy(c?c:m.event)}});c.push({target:d,type:"cut",handler:function(c){return a._handleCut(c?c:m.event)}});c.push({target:d,type:"paste",
handler:function(c){return a._handlePaste(c?c:m.event)}});if(e.isIOS||e.isAndroid)c.push({target:f,type:"selectionchange",handler:function(c){return a._handleSelectionChange(c?c:m.event)}}),c.push({target:d,type:"touchstart",handler:function(c){return a._handleTouchStart(c?c:m.event)}}),c.push({target:d,type:"touchmove",handler:function(c){return a._handleTouchMove(c?c:m.event)}}),c.push({target:d,type:"touchend",handler:function(c){return a._handleTouchEnd(c?c:m.event)}});else{c.push({target:d,type:"selectstart",
handler:function(c){return a._handleSelectStart(c?c:m.event)}});c.push({target:d,type:"mousedown",handler:function(c){return a._handleMouseDown(c?c:m.event)}});c.push({target:d,type:"mouseover",handler:function(c){return a._handleMouseOver(c?c:m.event)}});c.push({target:d,type:"mouseout",handler:function(c){return a._handleMouseOut(c?c:m.event)}});c.push({target:g,type:"mouseup",handler:function(c){return a._handleMouseUp(c?c:m.event)}});c.push({target:g,type:"mousemove",handler:function(c){return a._handleMouseMove(c?
c:m.event)}});c.push({target:k,type:"mousedown",handler:function(c){return a._handleRootMouseDown(c?c:m.event)}});c.push({target:k,type:"mouseup",handler:function(c){return a._handleRootMouseUp(c?c:m.event)}});c.push({target:h,type:"dragstart",handler:function(c){return a._handleDragStart(c?c:m.event)}});c.push({target:h,type:"drag",handler:function(c){return a._handleDrag(c?c:m.event)}});c.push({target:h,type:"dragend",handler:function(c){return a._handleDragEnd(c?c:m.event)}});c.push({target:h,
type:"dragenter",handler:function(c){return a._handleDragEnter(c?c:m.event)}});c.push({target:h,type:"dragover",handler:function(c){return a._handleDragOver(c?c:m.event)}});c.push({target:h,type:"dragleave",handler:function(c){return a._handleDragLeave(c?c:m.event)}});c.push({target:h,type:"drop",handler:function(c){return a._handleDrop(c?c:m.event)}});c.push({target:this._clientDiv,type:e.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(c){return a._handleMouseWheel(c?c:m.event)}});if(e.isFirefox&&
(!e.isWindows||e.isFirefox>=15))(b=m.MutationObserver||m.MozMutationObserver)?(this._mutationObserver=new b(function(c){a._handleDataModified(c)}),this._mutationObserver.observe(d,{subtree:!0,characterData:!0})):c.push({target:this._clientDiv,type:"DOMCharacterDataModified",handler:function(c){return a._handleDataModified(c?c:m.event)}});this._overlayDiv&&(c.push({target:this._overlayDiv,type:"mousedown",handler:function(c){return a._handleMouseDown(c?c:m.event)}}),c.push({target:this._overlayDiv,
type:"mouseover",handler:function(c){return a._handleMouseOver(c?c:m.event)}}),c.push({target:this._overlayDiv,type:"mouseout",handler:function(c){return a._handleMouseOut(c?c:m.event)}}),c.push({target:this._overlayDiv,type:"contextmenu",handler:function(c){return a._handleContextMenu(c?c:m.event)}}));this._isW3CEvents||c.push({target:this._clientDiv,type:"dblclick",handler:function(c){return a._handleDblclick(c?c:m.event)}})}b=this._leftDiv;k=this._rightDiv;e.isIE&&c.push({target:b,type:"selectstart",
handler:function(){return!1}});c.push({target:b,type:e.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(c){return a._handleMouseWheel(c?c:m.event)}});c.push({target:b,type:"click",handler:function(c){a._handleRulerEvent(c?c:m.event)}});c.push({target:b,type:"dblclick",handler:function(c){a._handleRulerEvent(c?c:m.event)}});c.push({target:b,type:"mousemove",handler:function(c){a._handleRulerEvent(c?c:m.event)}});c.push({target:b,type:"mouseover",handler:function(c){a._handleRulerEvent(c?c:
m.event)}});c.push({target:b,type:"mouseout",handler:function(c){a._handleRulerEvent(c?c:m.event)}});e.isIE&&c.push({target:k,type:"selectstart",handler:function(){return!1}});c.push({target:k,type:e.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(c){return a._handleMouseWheel(c?c:m.event)}});c.push({target:k,type:"click",handler:function(c){a._handleRulerEvent(c?c:m.event)}});c.push({target:k,type:"dblclick",handler:function(c){a._handleRulerEvent(c?c:m.event)}});c.push({target:k,type:"mousemove",
handler:function(c){a._handleRulerEvent(c?c:m.event)}});c.push({target:k,type:"mouseover",handler:function(c){a._handleRulerEvent(c?c:m.event)}});c.push({target:k,type:"mouseout",handler:function(c){a._handleRulerEvent(c?c:m.event)}});for(b=0;b<c.length;b++)k=c[b],w(k.target,k.type,k.handler,k.capture)},_getWindow:function(){return this._parent.ownerDocument.defaultView||this._parent.ownerDocument.parentWindow},_ignoreEvent:function(a){for(a=a.target;a&&a!==this._clientDiv;){if(a.ignore)return!0;
a=a.parentNode}return!1},_init:function(a){var c=a.parent;typeof c==="string"&&(c=(a.document||document).getElementById(c));if(!c)throw"no parent";a.parent=c;a.model=a.model||new o.TextModel;var d=this._defaultOptions(),b;for(b in d)d.hasOwnProperty(b)&&(this["_"+b]=a[b]!==void 0?a[b]:d[b].value);this._keyModes=[];this._rulers=[];this._selection=new p(0,0,!1);this._linksVisible=!1;this._maxLineWidth=this._redrawCount=0;this._maxLineIndex=-1;this._ignoreSelect=!0;this._hasFocus=this._ignoreFocus=!1;
this._dragOffset=this._columnX=-1;this._isRangeRects=(!e.isIE||e.isIE>=9)&&typeof c.ownerDocument.createRange().getBoundingClientRect==="function";this._isW3CEvents=c.addEventListener;this._autoScrollTimerID=this._autoScrollY=this._autoScrollX=null;this._AUTO_SCROLL_RATE=50;this._mouseUpClosure=this._moseMoveClosure=this._grabControl=null;this._clickCount=this._lastMouseTime=this._lastMouseY=this._lastMouseX=0;this._clickTime=250;this._clickDist=5;this._isMouseDown=!1;this._doubleClickSelection=null;
this._vScroll=this._hScroll=0;this._imeOffset=-1;this._createActions();this._createView()},_modifyContent:function(a,c){if(!this._readonly||a._code)if(a.type="Verify",this.onVerify(a),!(a.text===null||a.text===void 0)){var d=this._model;try{if(a._ignoreDOMSelection)this._ignoreDOMSelection=!0;d.setText(a.text,a.start,a.end)}finally{if(a._ignoreDOMSelection)this._ignoreDOMSelection=!1}c&&(d=this._getSelection(),d.setCaret(a.start+a.text.length),this._setSelection(d,!0));this.onModify({type:"Modify"})}},
_onModelChanged:function(a){a.type="ModelChanged";this.onModelChanged(a);a.type="Changed";var c=a.start,d=a.addedCharCount,b=a.removedCharCount,k=a.addedLineCount,h=a.removedLineCount,e=this._getSelection();e.end>c&&(e.end>c&&e.start<c+b?e.setCaret(c+d):(e.start+=d-b,e.end+=d-b),this._setSelection(e,!1,!1));c=this._model.getLineAtOffset(c);for(d=this._getLineNext();d;){b=d.lineIndex;if(c<=b&&b<=c+h)c===b&&!d.modelChangedEvent&&!d.lineRemoved?(d.modelChangedEvent=a,d.lineChanged=!0):(d.lineRemoved=
!0,d.lineChanged=!1,d.modelChangedEvent=null);if(b>c+h)d.lineIndex=b+k-h,d._line.lineIndex=d.lineIndex;d=this._getLineNext(d)}this._lineHeight&&(a=[c,h].concat(Array(k)),Array.prototype.splice.apply(this._lineHeight,a));if(!this._wrapMode&&c<=this._maxLineIndex&&this._maxLineIndex<=c+h)this._checkMaxLineIndex=this._maxLineIndex,this._maxLineIndex=-1,this._maxLineWidth=0;this._update()},_onModelChanging:function(a){a.type="ModelChanging";this.onModelChanging(a);a.type="Changing"},_queueUpdate:function(){if(!this._updateTimer&&
!this._ignoreQueueUpdate){var a=this;this._updateTimer=this._getWindow().setTimeout(function(){a._updateTimer=null;a._update()},0)}},_resetLineHeight:function(a,c){if(this._wrapMode||this._variableLineHeight){if(a!==void 0&&c!==void 0)for(var d=a;d<c;d++)this._lineHeight[d]=void 0;else this._lineHeight=Array(this._model.getLineCount());this._calculateLineHeightTimer()}else this._lineHeight=null},_resetLineWidth:function(){var a=this._clientDiv;if(a)for(a=a.firstChild;a;)a.lineWidth=void 0,a=a.nextSibling},
_reset:function(){this._maxLineIndex=-1;this._maxLineWidth=0;this._columnX=-1;this._bottomChild=this._topChild=null;this._topIndexY=0;this._variableLineHeight=!1;this._resetLineHeight();this._setSelection(new p(0,0,!1),!1,!1);if(this._viewDiv)this._viewDiv.scrollLeft=0,this._viewDiv.scrollTop=0;var a=this._clientDiv;if(a){for(var c=a.firstChild;c;)c.lineRemoved=!0,c=c.nextSibling;if(e.isFirefox)this._ignoreFocus=!1,(c=this._hasFocus)&&a.blur(),a.contentEditable=!1,a.contentEditable=!0,c&&a.focus(),
this._ignoreFocus=!1}},_scrollViewAnimated:function(a,c,d){var b=this._getWindow();if(d&&this._scrollAnimation){var k=this;this._animation=new v({window:b,duration:this._scrollAnimation,curve:[c,0],onAnimate:function(a){a=c-Math.floor(a);k._scrollView(0,a);c-=a},onEnd:function(){k._animation=null;k._scrollView(a,c);d&&b.setTimeout(d,0)}});this._animation.play()}else this._scrollView(a,c),d&&b.setTimeout(d,0)},_scrollView:function(a,c){this._ensureCaretVisible=!1;var d=this._viewDiv;a&&(d.scrollLeft+=
a);c&&(d.scrollTop+=c)},_setClipboardText:function(a,c){var b,k=this._getWindow(),h=k.clipboardData;if(!h&&c)h=c.clipboardData;if(h&&(b=[],d(a,function(a){b.push(a)},function(){b.push(e.platformDelimiter)}),h.setData(e.isIE?"Text":"text/plain",b.join(""))))return!0;var m=this._parent.ownerDocument,f=e.createElement(m,"pre");f.style.position="fixed";f.style.left="-1000px";d(a,function(a){f.appendChild(m.createTextNode(a))},function(){f.appendChild(e.createElement(m,"br"))});f.appendChild(m.createTextNode(" "));
this._clientDiv.appendChild(f);h=m.createRange();h.setStart(f.firstChild,0);h.setEndBefore(f.lastChild);var g=k.getSelection();g.rangeCount>0&&g.removeAllRanges();g.addRange(h);var i=this,h=function(){f&&f.parentNode===i._clientDiv&&i._clientDiv.removeChild(f);i._updateDOMSelection()},g=!1;this._ignoreCopy=!0;try{g=m.execCommand("copy",!1,null)}catch(q){}this._ignoreCopy=!1;if(!g&&c)return k.setTimeout(h,0),!1;h();return!0},_setDOMSelection:function(a,c,d,b,k){for(var h,f,m,g,i=0,q=a.firstChild,p,
r,s=this._model.getLine(a.lineIndex).length;q;){if(!q.ignore){p=q.firstChild;r=p.length;q.ignoreChars&&(r-=q.ignoreChars);if(i+r>c||i+r>=s){h=p;f=c-i;q.ignoreChars&&r>0&&f===r&&(f+=q.ignoreChars);break}i+=r}q=q.nextSibling}for(var i=0,q=d.firstChild,j=this._model.getLine(d.lineIndex).length;q;){if(!q.ignore){p=q.firstChild;r=p.length;q.ignoreChars&&(r-=q.ignoreChars);if(r+i>b||i+r>=j){m=p;g=b-i;q.ignoreChars&&r>0&&g===r&&(g+=q.ignoreChars);break}i+=r}q=q.nextSibling}this._setDOMFullSelection(a,c,
s,d,b,j);a=this._getWindow();c=this._parent.ownerDocument;if(a.getSelection){d=a.getSelection();a=c.createRange();a.setStart(h,f);a.setEnd(m,g);if(this._hasFocus&&(d.anchorNode!==h||d.anchorOffset!==f||d.focusNode!==m||d.focusOffset!==g||d.anchorNode!==m||d.anchorOffset!==g||d.focusNode!==h||d.focusOffset!==f))this._ignoreSelect=!1,d.rangeCount>0&&d.removeAllRanges(),d.addRange(a),this._ignoreSelect=!0;if(this._cursorDiv&&(a=c.createRange(),k?(a.setStart(h,f),a.setEnd(h,f)):(a.setStart(m,g),a.setEnd(m,
g)),m=a.getClientRects()[0],g=this._cursorDiv.parentNode,h=g.getBoundingClientRect(),m&&h))this._cursorDiv.style.top=m.top-h.top+g.scrollTop+"px",this._cursorDiv.style.left=m.left-h.left+g.scrollLeft+"px"}else if(c.selection&&this._hasFocus)k=c.body,a=e.createElement(c,"div"),k.appendChild(a),k.removeChild(a),a=k.createTextRange(),a.moveToElementText(h.parentNode),a.moveStart("character",f),h=k.createTextRange(),h.moveToElementText(m.parentNode),h.moveStart("character",g),a.setEndPoint("EndToStart",
h),this._ignoreSelect=!1,a.select(),this._ignoreSelect=!0},_setDOMFullSelection:function(a,c,d,b,k){if(this._selDiv1&&(d=this._selDiv1,d.style.width="0px",d.style.height="0px",d=this._selDiv2,d.style.width="0px",d.style.height="0px",d=this._selDiv3,d.style.width="0px",d.style.height="0px",!(a===b&&c===k))){var h=this._model,e=this._getViewPadding(),m=this._clientDiv.getBoundingClientRect(),f=this._viewDiv.getBoundingClientRect(),d=f.left+e.left,g=m.right,e=f.top+e.top,i=m.bottom,f=m=0;this._clipDiv?
(f=this._clipDiv.getBoundingClientRect(),m=f.left-this._clipDiv.scrollLeft):(f=this._rootDiv.getBoundingClientRect(),m=f.left);f=f.top;this._ignoreDOMSelection=!0;var a=(new r(this,a.lineIndex,a)).getBoundingClientRect(h.getLineStart(a.lineIndex)+c,!1),q=a.left,k=(new r(this,b.lineIndex,b)).getBoundingClientRect(h.getLineStart(b.lineIndex)+k,!1),c=k.left;this._ignoreDOMSelection=!1;var h=this._selDiv1,q=Math.min(g,Math.max(d,q)),p=Math.min(i,Math.max(e,a.top)),s=g,b=Math.min(i,Math.max(e,a.bottom));
h.style.left=q-m+"px";h.style.top=p-f+"px";h.style.width=Math.max(0,s-q)+"px";h.style.height=Math.max(0,b-p)+"px";if(a.top===k.top)s=Math.min(c,g),h.style.width=Math.max(0,s-q)+"px";else if(a=Math.min(i,Math.max(e,k.top)),c=Math.min(g,Math.max(d,c)),e=Math.min(i,Math.max(e,k.bottom)),i=this._selDiv3,i.style.left=d-m+"px",i.style.top=a-f+"px",i.style.width=Math.max(0,c-d)+"px",i.style.height=Math.max(0,e-a)+"px",a-b>0)e=this._selDiv2,e.style.left=d-m+"px",e.style.top=b-f+"px",e.style.width=Math.max(0,
g-d)+"px",e.style.height=Math.max(0,a-b)+"px"}},_setGrab:function(a){if(a!==this._grabControl)a?(a.setCapture&&a.setCapture(),this._grabControl=a):(this._grabControl.releaseCapture&&this._grabControl.releaseCapture(),this._grabControl=null)},_setLinksVisible:function(a){if(this._linksVisible!==a){this._linksVisible=a;if(e.isIE&&a)this._hadFocus=this._hasFocus;var c=this._clientDiv;c.contentEditable=!a;this._hadFocus&&!a&&c.focus();if(this._overlayDiv)this._overlayDiv.style.zIndex=a?"-1":"1";for(a=
this._getLineNext();a;){if(a.hasLink)for(c=a.firstChild;c;)if(c.ignore)c=c.nextSibling;else{var d=c.nextSibling,b=c.viewStyle;b&&b.tagName&&b.tagName.toLowerCase()==="a"&&a.replaceChild(a._line._createSpan(a,c.firstChild.data,b),c);c=d}a=this._getLineNext(a)}this._updateDOMSelection()}},_setSelection:function(a,c,d,b,k){if(a){this._columnX=-1;d===void 0&&(d=!0);var h=this._selection;this._selection=a;c!==!1&&this._showCaret(!1,b,c,k);d&&this._updateDOMSelection();if(!h.equals(a))this.onSelection({type:"Selection",
oldValue:{start:h.start,end:h.end},newValue:{start:a.start,end:a.end}})}},_setSelectionTo:function(a,c,d,b){var k=this._model,h=this._getSelection(),c=this.convert({x:a,y:c},"page","document"),a=this._getLineIndex(c.y);if(this._clickCount===1){k=this._getLine(a);a=k.getOffset(c.x,c.y-this._getLinePixel(a));k.destroy();if(b&&!d&&h.start<=a&&a<h.end)return this._dragOffset=a,!1;h.extend(a);d||h.collapse()}else(this._clickCount&1)===0?(k=this._getLine(a),a=k.getOffset(c.x,c.y-this._getLinePixel(a)),
this._doubleClickSelection?a>=this._doubleClickSelection.start?(d=this._doubleClickSelection.start,b=k.getNextOffset(a,{unit:"wordend",count:1})):(d=k.getNextOffset(a,{unit:"word",count:-1}),b=this._doubleClickSelection.end):(d=k.getNextOffset(a,{unit:"word",count:-1}),b=k.getNextOffset(d,{unit:"wordend",count:1})),k.destroy()):this._doubleClickSelection?(b=k.getLineAtOffset(this._doubleClickSelection.start),a>=b?(d=k.getLineStart(b),b=k.getLineEnd(a)):(d=k.getLineStart(a),b=k.getLineEnd(b))):(d=
k.getLineStart(a),b=k.getLineEnd(a)),h.setCaret(d),h.extend(b);this._setSelection(h,!0,!0);return!0},_setFullSelection:function(a,c){this._fullSelection=a;if(e.isWebkit)this._fullSelection=!0;var d=this._clipDiv||this._rootDiv;if(d)if(this._fullSelection){if(!this._selDiv1&&this._fullSelection&&!e.isIOS){var b=d.ownerDocument;this._highlightRGB=e.isWebkit?"transparent":"Highlight";var k=e.createElement(b,"div");this._selDiv1=k;k.style.position="absolute";k.style.borderWidth="0px";k.style.margin="0px";
k.style.padding="0px";k.style.outline="none";k.style.background=this._highlightRGB;k.style.width="0px";k.style.height="0px";k.style.zIndex="0";d.appendChild(k);var h=e.createElement(b,"div");this._selDiv2=h;h.style.position="absolute";h.style.borderWidth="0px";h.style.margin="0px";h.style.padding="0px";h.style.outline="none";h.style.background=this._highlightRGB;h.style.width="0px";h.style.height="0px";h.style.zIndex="0";d.appendChild(h);this._selDiv3=b=e.createElement(b,"div");b.style.position="absolute";
b.style.borderWidth="0px";b.style.margin="0px";b.style.padding="0px";b.style.outline="none";b.style.background=this._highlightRGB;b.style.width="0px";b.style.height="0px";b.style.zIndex="0";d.appendChild(b);if(e.isFirefox&&e.isMac){d=this._getWindow().getComputedStyle(b,null).getPropertyValue("background-color");switch(d){case "rgb(119, 141, 168)":d="rgb(199, 208, 218)";break;case "rgb(127, 127, 127)":d="rgb(198, 198, 198)";break;case "rgb(255, 193, 31)":d="rgb(250, 236, 115)";break;case "rgb(243, 70, 72)":d=
"rgb(255, 176, 139)";break;case "rgb(255, 138, 34)":d="rgb(255, 209, 129)";break;case "rgb(102, 197, 71)":d="rgb(194, 249, 144)";break;case "rgb(140, 78, 184)":d="rgb(232, 184, 255)";break;default:d="rgb(180, 213, 255)"}this._highlightRGB=d;k.style.background=d;h.style.background=d;b.style.background=d}c||this._updateDOMSelection()}}else{if(this._selDiv1)d.removeChild(this._selDiv1),this._selDiv1=null;if(this._selDiv2)d.removeChild(this._selDiv2),this._selDiv2=null;if(this._selDiv3)d.removeChild(this._selDiv3),
this._selDiv3=null}},_setBlockCursor:function(a){this._blockCursorVisible=a;this._updateBlockCursorVisible()},_setOverwriteMode:function(a){this._overwriteMode=a;this._updateBlockCursorVisible()},_updateBlockCursorVisible:function(){if(this._blockCursorVisible||this._overwriteMode){if(!this._cursorDiv){var a=e.createElement(document,"div");a.className="textviewBlockCursor";this._cursorDiv=a;a.tabIndex=-1;a.style.zIndex="2";a.style.color="transparent";a.style.position="absolute";a.style.pointerEvents=
"none";a.innerHTML="&nbsp;";this._viewDiv.appendChild(a);this._updateDOMSelection()}}else if(this._cursorDiv)this._cursorDiv.parentNode.removeChild(this._cursorDiv),this._cursorDiv=null},_setReadOnly:function(a){this._readonly=a;this._clientDiv.setAttribute("aria-readonly",a?"true":"false")},_setSingleMode:function(a,c){this._singleMode=a;this._updateOverflow();this._updateStyle(c)},_setTabSize:function(a,c){this._tabSize=a;this._customTabSize=void 0;var d=this._clientDiv;if(e.isOpera){if(d)d.style.OTabSize=
this._tabSize+""}else if(e.isWebkit>=537.1){if(d)d.style.tabSize=this._tabSize+""}else if(e.isFirefox>=4){if(d)d.style.MozTabSize=this._tabSize+""}else if(this._tabSize!==8)this._customTabSize=this._tabSize;c||(this.redrawLines(),this._resetLineWidth())},_setTheme:function(a){this._theme&&this._theme.removeEventListener("ThemeChanged",this._themeListener.onChanged);(this._theme=a)&&this._theme.addEventListener("ThemeChanged",this._themeListener.onChanged);this._setThemeClass(this._themeClass)},_setThemeClass:function(a,
c){this._themeClass=a;var d="textview",b=this._theme.getThemeClass();b&&(d+=" "+b);this._themeClass&&b!==this._themeClass&&(d+=" "+this._themeClass);this._rootDiv.className=d;this._updateStyle(c)},_setWrapMode:function(a,c){this._wrapMode=a&&this._wrappable;var d=this._clientDiv;this._wrapMode?(d.style.whiteSpace="pre-wrap",d.style.wordWrap="break-word"):(d.style.whiteSpace="pre",d.style.wordWrap="normal");this._updateOverflow();c||(this.redraw(),this._resetLineWidth());this._resetLineHeight()},_showCaret:function(a,
c,d,b){if(this._clientDiv){var k=this._model,h=this._getSelection(),e=this._getScroll(),f=h.getCaret(),m=h.start,g=h.end,i=k.getLineAtOffset(g),q=Math.max(Math.max(m,k.getLineStart(i)),g-1),k=this._getClientWidth(),i=this._getClientHeight(),p=k/4,r=this._getBoundsAtOffset(f===m?m:q),s=r.left,j=r.right,n=r.top,o=r.bottom;a&&!h.isEmpty()&&(r=this._getBoundsAtOffset(f===g?m:q),r.top===n?f===m?j=s+Math.min(r.right-s,k):s=j-Math.min(j-r.left,k):f===m?o=n+Math.min(r.bottom-n,i):n=o-Math.min(o-r.top,i));
a=0;s<e.x&&(a=Math.min(s-e.x,-p));j>e.x+k&&(a=Math.max(j-e.x-k,p));h=0;n<e.y?h=n-e.y:o>e.y+i&&(h=o-e.y-i);b&&(b>0?h>0&&(h=Math.max(h,b)):h<0&&(h=Math.min(h,b)));if(a!==0||h!==0)return h!==0&&typeof d==="number"&&(d<0&&(d=0),d>1&&(d=1),h+=Math.floor(h>0?d*i:-d*i)),this._scrollViewAnimated(a,h,c),i!==this._getClientHeight()||k!==this._getClientWidth()?this._showCaret():this._ensureCaretVisible=!0,!0;else c&&c();return!1}},_startIME:function(){if(this._imeOffset===-1){var a=this._getSelection();a.isEmpty()||
this._modifyContent({text:"",start:a.start,end:a.end},!0);this._imeOffset=a.start}},_unhookEvents:function(){this._model.removeEventListener("preChanging",this._modelListener.onChanging);this._model.removeEventListener("postChanged",this._modelListener.onChanged);this._theme.removeEventListener("ThemeChanged",this._themeListener.onChanged);this._modelListener=null;for(var a=0;a<this._handlers.length;a++){var c=this._handlers[a];u(c.target,c.type,c.handler)}this._handlers=null;if(this._mutationObserver)this._mutationObserver.disconnect(),
this._mutationObserver=null},_updateDOMSelection:function(){if(!(this._redrawCount>0)&&!this._ignoreDOMSelection&&this._clientDiv){var a=this._getSelection(),c=this._model,d=c.getLineAtOffset(a.start),b=c.getLineAtOffset(a.end),k=this._getLineNext();if(k){var h=this._getLinePrevious(),e;d<k.lineIndex?(e=k,d=0):d>h.lineIndex?(e=h,d=0):(e=this._getLineNode(d),d=a.start-c.getLineStart(d));b<k.lineIndex?c=0:b>h.lineIndex?(k=h,c=0):(k=this._getLineNode(b),c=a.end-c.getLineStart(b));this._setDOMSelection(e,
d,k,c,a.caret)}}},_update:function(a){if(!(this._redrawCount>0)){if(this._updateTimer)this._getWindow().clearTimeout(this._updateTimer),this._updateTimer=null,a=!1;var c=this._clientDiv;if(c){if(this._metrics.invalid)this._ignoreQueueUpdate=!0,this._updateStyle(),this._ignoreQueueUpdate=!1;var d=this._model,b=this._getScroll(!1),k=this._getViewPadding(),h=d.getLineCount(),f=this._getLineHeight(),m=this._getClientWidth();if(this._wrapMode)c.style.width=m+"px";var g,i,q,p,s=0,j=0;if(this._lineHeight){for(;j<
h;){i=this._getLineHeight(j);if(s+i>b.y)break;s+=i;j++}g=j;i=Math.max(0,g-1);q=d=b.y-s;g>0&&(d+=this._getLineHeight(g-1))}else p=Math.max(0,b.y)/f,g=Math.floor(p),i=Math.max(0,g-1),d=Math.round((p-i)*f),q=Math.round((p-g)*f);this._topIndexY=q;p=this._parent;var n=p.clientWidth,o=p.clientHeight;p=this._getClientHeight();if(a){f=0;this._leftDiv&&(g=this._leftDiv.getBoundingClientRect(),f=g.right-g.left);g=m;for(this._wrapMode||(g=Math.max(this._maxLineWidth,g));j<h;)i=this._getLineHeight(j,!1),s+=i,
j++;h=s}else{m=this._viewDiv;q=Math.min(g+Math.floor((p+q)/f),h-1);for(var b=Math.min(q+1,h-1),w,u=c.firstChild;u;){w=u.lineIndex;var v=u.nextSibling;if(!(i<=w&&w<=b)||u.lineRemoved||u.lineIndex===-1)this._mouseWheelLine===u?(u.style.display="none",u.lineIndex=-1):c.removeChild(u);u=v}var u=this._getLineNext(),v=m.ownerDocument,z=v.createDocumentFragment();for(w=i;w<=b;w++)if(!u||u.lineIndex>w)(new r(this,w)).create(z,null);else{z.firstChild&&(c.insertBefore(z,u),z=v.createDocumentFragment());if(u&&
u.lineChanged)u=(new r(this,w)).create(z,u),u.lineChanged=!1;u=this._getLineNext(u)}z.firstChild&&c.insertBefore(z,u);if(e.isWebkit&&!this._wrapMode)c.style.width="0x7fffffffpx";u=this._getLineNext();w=p+d;for(z=!1;u;){i=u.lineWidth;if(i===void 0)if(v=u._line.getBoundingClientRect(),i=u.lineWidth=Math.ceil(v.right-v.left),v=v.bottom-v.top,this._lineHeight)this._lineHeight[u.lineIndex]=v;else if(f!==0&&v!==0&&Math.ceil(f)!==Math.ceil(v))this._variableLineHeight=!0,this._lineHeight=[],this._lineHeight[u.lineIndex]=
v;if(this._lineHeight&&!z&&(w-=this._lineHeight[u.lineIndex],w<0))q=u.lineIndex,z=!0;if(!this._wrapMode){if(i>=this._maxLineWidth)this._maxLineWidth=i,this._maxLineIndex=u.lineIndex;if(this._checkMaxLineIndex===u.lineIndex)this._checkMaxLineIndex=-1}if(u.lineIndex===g)this._topChild=u;if(u.lineIndex===q)this._bottomChild=u;u=this._getLineNext(u)}if(this._checkMaxLineIndex!==-1&&(w=this._checkMaxLineIndex,this._checkMaxLineIndex=-1,0<=w&&w<h)){f=new r(this,w);v=f.getBoundingClientRect();i=v.right-
v.left;if(i>=this._maxLineWidth)this._maxLineWidth=i,this._maxLineIndex=w;f.destroy()}for(;j<h;)i=this._getLineHeight(j,j<=q),s+=i,j++;h=s;this._updateRuler(this._leftDiv,g,b,o);this._updateRuler(this._rightDiv,g,b,o);f=0;this._leftDiv&&(g=this._leftDiv.getBoundingClientRect(),f=g.right-g.left);b=0;this._rightDiv&&(b=this._rightDiv.getBoundingClientRect(),b=b.right-b.left);m.style.left=f+"px";m.style.right=b+"px";b=this._scrollDiv;b.style.height=h+"px";s=m=this._getClientWidth();this._wrapMode||(s=
Math.max(this._maxLineWidth,s));g=s;if((!e.isIE||e.isIE>=9)&&this._maxLineWidth>m)s+=k.right+k.left;b.style.width=s+"px";if(this._clipScrollDiv)this._clipScrollDiv.style.width=s+"px";b=this._getScroll(!1)}if(this._vScrollDiv)s=p-8,j=Math.max(15,Math.ceil(Math.min(1,s/(h+k.top+k.bottom))*s)),this._vScrollDiv.style.left=f+m-8+"px",this._vScrollDiv.style.top=Math.floor(Math.max(0,b.y*s/h))+"px",this._vScrollDiv.style.height=j+"px";if(!this._wrapMode&&this._hScrollDiv)s=m-8,j=Math.max(15,Math.ceil(Math.min(1,
s/(this._maxLineWidth+k.left+k.right))*s)),this._hScrollDiv.style.left=f+Math.floor(Math.max(0,Math.floor(b.x*s/this._maxLineWidth)))+"px",this._hScrollDiv.style.top=p-9+"px",this._hScrollDiv.style.width=j+"px";u=b.x;i=this._clipDiv;s=this._overlayDiv;if(i){i.scrollLeft=u;i.scrollTop=0;j=f+k.left;q=k.top;a=m;f=p;u=0;w=-d;if(b.x===0)j-=k.left,a+=k.left,u=k.left;b.x+m===g&&(a+=k.right);b.y===0&&(q-=k.top,f+=k.top,w+=k.top);b.y+p===h&&(f+=k.bottom);i.style.left=j+"px";i.style.top=q+"px";i.style.right=
n-a-j+"px";i.style.bottom=o-f-q+"px";c.style.left=u+"px";c.style.top=w+"px";c.style.width=g+"px";c.style.height=p+d+"px";if(s)s.style.left=c.style.left,s.style.top=c.style.top,s.style.width=c.style.width,s.style.height=c.style.height}else{j=u;q=d;n=u+m;o=d+p;j===0&&(j-=k.left);q===0&&(q-=k.top);n===g&&(n+=k.right);b.y+p===h&&(o+=k.bottom);c.style.clip="rect("+q+"px,"+n+"px,"+o+"px,"+j+"px)";c.style.left=-u+f+k.left+"px";c.style.width=(e.isWebkit?g:m+u)+"px";if(!a)c.style.top=-d+k.top+"px",c.style.height=
p+d+"px";if(s&&(s.style.clip=c.style.clip,s.style.left=c.style.left,s.style.width=c.style.width,!a))s.style.top=c.style.top,s.style.height=c.style.height}this._updateDOMSelection();c=this._ensureCaretVisible;this._ensureCaretVisible=!1;p!==this._getClientHeight()&&(this._update(),c&&this._showCaret())}}},_updateOverflow:function(){var a=this._viewDiv;this._wrapMode?(a.style.overflowX="hidden",a.style.overflowY="scroll"):this._singleMode?(a.style.overflowX="hidden",a.style.overflowY="hidden"):(a.style.overflowX=
"auto",a.style.overflowY="auto")},_updateRuler:function(a,c,d,b){if(a)for(var k=this._parent.ownerDocument,h=this._getLineHeight(),f=this._getViewPadding(),a=a.firstChild;a;){var m=a._ruler,g=h,q=m.getOverview();q==="page"&&(g+=this._topIndexY);a.style.top=-g+"px";a.style.height=b+g+"px";a.rulerChanged&&i(m.getRulerStyle(),a);var p,r=a.firstChild;r?(p=r,r=r.nextSibling):(p=e.createElement(k,"div"),p.style.visibility="hidden",a.appendChild(p));var s;if(a.rulerChanged&&p){g=-1;if(s=m.getWidestAnnotation())if(i(s.style,
p),s.html)p.innerHTML=s.html;p.lineIndex=g;p.style.height=h+f.top+"px"}var j;if(q==="page"){for(m=m.getAnnotations(c,d+1);r;)g=r.lineIndex,s=r.nextSibling,(!(c<=g&&g<=d)||r.lineChanged)&&a.removeChild(r),r=s;r=a.firstChild.nextSibling;j=k.createDocumentFragment();for(g=c;g<=d;g++)if(!r||r.lineIndex>g){p=e.createElement(k,"div");if(s=m[g]){i(s.style,p);if(s.html)p.innerHTML=s.html;p.annotation=s}p.lineIndex=g;p.style.height=this._getLineHeight(g)+"px";j.appendChild(p)}else if(j.firstChild&&(a.insertBefore(j,
r),j=k.createDocumentFragment()),r)r=r.nextSibling;j.firstChild&&a.insertBefore(j,r)}else{s=this._getClientHeight();g=this._model.getLineCount();r=s+f.top+f.bottom-2*this._metrics.scrollWidth;q=h*g<r?h:r/g;if(a.rulerChanged){for(s=a.childNodes.length;s>1;)a.removeChild(a.lastChild),s--;m=m.getAnnotations(0,g);j=k.createDocumentFragment();for(var n in m)if(g=n>>>0,!(g<0)){p=e.createElement(k,"div");s=m[n];i(s.style,p);p.style.position="absolute";p.style.top=this._metrics.scrollWidth+h+Math.floor(g*
q)+"px";if(s.html)p.innerHTML=s.html;p.annotation=s;p.lineIndex=g;j.appendChild(p)}a.appendChild(j)}else if(a._oldTrackHeight!==r)for(p=a.firstChild?a.firstChild.nextSibling:null;p;)p.style.top=this._metrics.scrollWidth+h+Math.floor(p.lineIndex*q)+"px",p=p.nextSibling;a._oldTrackHeight=r}a.rulerChanged=!1;a=a.nextSibling}},_updateStyleSheet:function(){var a="";e.isWebkit&&this._metrics.scrollWidth>0&&(a+="\n.textview ::-webkit-scrollbar-corner {background: #eeeeee;}");e.isFirefox&&e.isMac&&this._highlightRGB&&
this._highlightRGB!=="Highlight"&&(a+="\n.textview ::-moz-selection {background: "+this._highlightRGB+";}");if(a){var c=document.getElementById("_textviewStyle");if(c)c.removeChild(c.firstChild),c.appendChild(document.createTextNode(a));else{c=e.createElement(document,"style");c.id="_textviewStyle";var d=document.getElementsByTagName("head")[0]||document.documentElement;c.appendChild(document.createTextNode(a));d.insertBefore(c,d.firstChild)}}},_updateStyle:function(a){if(!a&&e.isIE)this._rootDiv.style.lineHeight=
"normal";var c=this._metrics=this._calculateMetrics();this._rootDiv.style.lineHeight=e.isIE?c.lineHeight-(c.lineTrim.top+c.lineTrim.bottom)+"px":"normal";this._updateStyleSheet();a||(this.redraw(),this._resetLineWidth())}};g.EventTarget.addMixin(s.prototype);return{TextView:s}});
define("orion/editor/projectionTextModel",["orion/editor/textModel","orion/editor/eventTarget"],function(j,o){function n(g){this._model=g;this._projections=[]}n.prototype={addProjection:function(g){if(g){var b=this._model,f=this._projections;g._lineIndex=b.getLineAtOffset(g.start);g._lineCount=b.getLineAtOffset(g.end)-g._lineIndex;var e=g.text;e||(e="");g._model=typeof e==="string"?new j.TextModel(e,b.getLineDelimiter()):e;var b=this.mapOffset(g.start,!0),e=g.end-g.start,i=g._lineCount,h=g._model.getCharCount(),
a=g._model.getLineCount()-1;this.onChanging({type:"Changing",text:g._model.getText(),start:b,removedCharCount:e,addedCharCount:h,removedLineCount:i,addedLineCount:a});var c=this._binarySearch(f,g.start);f.splice(c,0,g);this.onChanged({type:"Changed",start:b,removedCharCount:e,addedCharCount:h,removedLineCount:i,addedLineCount:a})}},getProjections:function(){return this._projections.slice(0)},getBaseModel:function(){return this._model},mapOffset:function(g,b){var f=this._projections,e=0,i,h;if(b){for(i=
0;i<f.length;i++){h=f[i];if(h.start>g)break;if(h.end>g)return-1;e+=h._model.getCharCount()-(h.end-h.start)}return g+e}for(i=0;i<f.length;i++){h=f[i];if(h.start>g-e)break;var a=h._model.getCharCount();if(h.start+a>g-e)return-1;e+=a-(h.end-h.start)}return g-e},removeProjection:function(g){var b,f=0;for(b=0;b<this._projections.length;b++){var e=this._projections[b];if(e===g){g=e;break}f+=e._model.getCharCount()-(e.end-e.start)}if(b<this._projections.length){var e=this._model,f=g.start+f,i=g.end-g.start,
h=g._lineCount,a=g._model.getCharCount(),c=g._model.getLineCount()-1;this.onChanging({type:"Changing",text:e.getText(g.start,g.end),start:f,removedCharCount:a,addedCharCount:i,removedLineCount:c,addedLineCount:h});this._projections.splice(b,1);this.onChanged({type:"Changed",start:f,removedCharCount:a,addedCharCount:i,removedLineCount:c,addedLineCount:h})}},_binarySearch:function(g,b){for(var f=g.length,e=-1,i;f-e>1;)i=Math.floor((f+e)/2),b<=g[i].start?f=i:e=i;return f},getCharCount:function(){for(var g=
this._model.getCharCount(),b=this._projections,f=0;f<b.length;f++){var e=b[f];g+=e._model.getCharCount()-(e.end-e.start)}return g},getLine:function(g,b){if(g<0)return null;var f=this._model,e=this._projections,i=0,h=[],a=0,c,d,k;for(c=0;c<e.length;c++){k=e[c];if(k._lineIndex>=g-i)break;d=k._model.getLineCount()-1;if(k._lineIndex+d>=g-i)if(a=g-(k._lineIndex+i),a<d)return k._model.getLine(a,b);else h.push(k._model.getLine(d));a=k.end;i+=d-k._lineCount}for(a=Math.max(a,f.getLineStart(g-i));c<e.length;c++){k=
e[c];if(k._lineIndex>g-i)break;h.push(f.getText(a,k.start));d=k._model.getLineCount()-1;if(k._lineIndex+d>g-i)return h.push(k._model.getLine(0,b)),h.join("");h.push(k._model.getText());a=k.end;i+=d-k._lineCount}e=f.getLineEnd(g-i,b);a<e&&h.push(f.getText(a,e));return h.join("")},getLineAtOffset:function(g){for(var b=this._model,f=this._projections,e=0,i=0,h=0;h<f.length;h++){var a=f[h];if(a.start>g-e)break;var c=a._model.getCharCount();if(a.start+c>g-e){f=g-(a.start+e);i+=a._model.getLineAtOffset(f);
e+=f;break}i+=a._model.getLineCount()-1-a._lineCount;e+=c-(a.end-a.start)}return b.getLineAtOffset(g-e)+i},getLineCount:function(){for(var g=this._projections,b=this._model.getLineCount(),f=0;f<g.length;f++){var e=g[f];b+=e._model.getLineCount()-1-e._lineCount}return b},getLineDelimiter:function(){return this._model.getLineDelimiter()},getLineEnd:function(g,b){if(g<0)return-1;for(var f=this._model,e=this._projections,i=0,h=0,a=0;a<e.length;a++){var c=e[a];if(c._lineIndex>g-i)break;var d=c._model.getLineCount()-
1;if(c._lineIndex+d>g-i)return c._model.getLineEnd(g-(c._lineIndex+i),b)+c.start+h;h+=c._model.getCharCount()-(c.end-c.start);i+=d-c._lineCount}return f.getLineEnd(g-i,b)+h},getLineStart:function(g){if(g<0)return-1;for(var b=this._model,f=this._projections,e=0,i=0,h=0;h<f.length;h++){var a=f[h];if(a._lineIndex>=g-e)break;var c=a._model.getLineCount()-1;if(a._lineIndex+c>=g-e)return a._model.getLineStart(g-(a._lineIndex+e))+a.start+i;i+=a._model.getCharCount()-(a.end-a.start);e+=c-a._lineCount}return b.getLineStart(g-
e)+i},getText:function(g,b){g===void 0&&(g=0);var f=this._model,e=this._projections,i=0,h=[],a,c,d;for(a=0;a<e.length;a++){c=e[a];if(c.start>g-i)break;d=c._model.getCharCount();if(c.start+d>g-i)if(b!==void 0&&c.start+d>b-i)return c._model.getText(g-(c.start+i),b-(c.start+i));else h.push(c._model.getText(g-(c.start+i))),g=c.end+i+d-(c.end-c.start);i+=d-(c.end-c.start)}var k=g-i;if(b!==void 0){for(;a<e.length;a++){c=e[a];if(c.start>b-i)break;h.push(f.getText(k,c.start));d=c._model.getCharCount();if(c.start+
d>b-i)return h.push(c._model.getText(0,b-(c.start+i))),h.join("");h.push(c._model.getText());k=c.end;i+=d-(c.end-c.start)}h.push(f.getText(k,b-i))}else{for(;a<e.length;a++)c=e[a],h.push(f.getText(k,c.start)),h.push(c._model.getText()),k=c.end;h.push(f.getText(k))}return h.join("")},_onChanging:function(g,b,f,e,i,h){for(var a=this._model,c=this._projections,d,k=0,m,p=b+f;d<c.length;d++){f=c[d];if(f.start>b)break;k+=f._model.getCharCount()-(f.end-f.start)}b+=k;for(var q=d;d<c.length;d++){f=c[d];if(f.start>
p)break;k+=f._model.getCharCount()-(f.end-f.start);m+=f._model.getLineCount()-1-f._lineCount}f=p+k;k=d;this.onChanging(b,f-b,e,i+m,h);c.splice(c,k-q);for(g=g.length-(f-b);d<c.length;d++)f=c[d],f.start+=g,f.end+=g,f._lineIndex=a.getLineAtOffset(f.start)},onChanging:function(g){return this.dispatchEvent(g)},onChanged:function(g){return this.dispatchEvent(g)},setLineDelimiter:function(g){this._model.setLineDelimiter(g)},setText:function(g,b,f){g===void 0&&(g="");b===void 0&&(b=0);var e=b,i=f,h=this._model,
a=this._projections,c=0,d=0,k,m,p,q,r,s=0;for(k=0;k<a.length;k++){m=a[k];if(m.start>b-c)break;p=m._model.getCharCount();if(m.start+p>b-c)if(f!==void 0&&m.start+p>f-c){m._model.setText(g,b-(m.start+c),f-(m.start+c));return}else s=m._model.getLineCount()-1-m._model.getLineAtOffset(b-(m.start+c)),q={projection:m,start:b-(m.start+c)},b=m.end+c+p-(m.end-m.start);d+=m._model.getLineCount()-1-m._lineCount;c+=p-(m.end-m.start)}b-=c;var j=k,s=h.getLineAtOffset(b)+d-s;if(f!==void 0)for(;k<a.length;k++){m=a[k];
if(m.start>f-c)break;p=m._model.getCharCount();if(m.start+p>f-c){d+=m._model.getLineAtOffset(f-(m.start+c));p=f-(m.start+c);f=m.end+c;r={projection:m,end:p};break}d+=m._model.getLineCount()-1-m._lineCount;c+=p-(m.end-m.start)}else{for(;k<a.length;k++)m=a[k],d+=m._model.getLineCount()-1-m._lineCount,c+=m._model.getCharCount()-(m.end-m.start);f=i=h.getCharCount()+c}f-=c;m=h.getLineAtOffset(f)+d;i-=e;for(var d=m-s,s=g.length,n=p=m=c=0;;){m!==-1&&m<=n&&(m=g.indexOf("\r",n));p!==-1&&p<=n&&(p=g.indexOf("\n",
n));if(p===-1&&m===-1)break;n=m!==-1&&p!==-1?m+1===p?p+1:(m<p?m:p)+1:m!==-1?m+1:p+1;c++}this.onChanging({type:"Changing",text:g,start:e,removedCharCount:i,addedCharCount:s,removedLineCount:d,addedLineCount:c});h.setText(g,b,f);if(q)m=q.projection,m._model.setText("",q.start);if(r)m=r.projection,m._model.setText("",0,r.end),m.start=m.end,m._lineCount=0;a.splice(j,k-j);for(g=g.length-(f-b);k<a.length;k++)m=a[k],m.start+=g,m.end+=g,m._lineIndex=h.getLineAtOffset(m.start);this.onChanged({type:"Changed",
start:e,removedCharCount:i,addedCharCount:s,removedLineCount:d,addedLineCount:c})}};o.EventTarget.addMixin(n.prototype);return{ProjectionTextModel:n}});
define("orion/editor/annotations",["i18n!orion/editor/nls/messages","orion/editor/eventTarget"],function(j,o){function n(a,c,d){this.start=a;this.end=c;this._projectionModel=d;this.html=this._expandedHTML;this.style=this._expandedStyle;this.expanded=!0}function g(){}function b(a,c){var d=a.lastIndexOf("."),d=a.substring(d+1),b={title:j[d],style:{styleClass:"annotation "+d},html:"<div class='annotationHTML "+d+"'></div>",overviewStyle:{styleClass:"annotationOverview "+d}};c?b.lineStyle={styleClass:"annotationLine "+
d}:b.rangeStyle={styleClass:"annotationRange "+d};g.registerType(a,b)}function f(){}function e(a){this._annotations=[];var c=this;this._listener={onChanged:function(a){c._onChanged(a)}};this.setTextModel(a)}function i(a,c){this._view=a;this._annotationModel=c;var d=this;this._listener={onDestroy:function(a){d._onDestroy(a)},onLineStyle:function(a){d._onLineStyle(a)},onChanged:function(a){d._onAnnotationModelChanged(a)}};a.addEventListener("Destroy",this._listener.onDestroy);a.addEventListener("postLineStyle",
this._listener.onLineStyle);c.addEventListener("Changed",this._listener.onChanged)}n.prototype={_expandedHTML:"<div class='annotationHTML expanded'></div>",_expandedStyle:{styleClass:"annotation expanded"},_collapsedHTML:"<div class='annotationHTML collapsed'></div>",_collapsedStyle:{styleClass:"annotation collapsed"},collapse:function(){if(this.expanded){this.expanded=!1;this.html=this._collapsedHTML;this.style=this._collapsedStyle;var a=this._projectionModel,c=a.getBaseModel();this._projection=
{start:c.getLineStart(c.getLineAtOffset(this.start)+1),end:c.getLineEnd(c.getLineAtOffset(this.end),!0)};a.addProjection(this._projection)}},expand:function(){if(!this.expanded)this.expanded=!0,this.html=this._expandedHTML,this.style=this._expandedStyle,this._projectionModel.removeProjection(this._projection)}};g.ANNOTATION_ERROR="orion.annotation.error";g.ANNOTATION_WARNING="orion.annotation.warning";g.ANNOTATION_TASK="orion.annotation.task";g.ANNOTATION_BREAKPOINT="orion.annotation.breakpoint";
g.ANNOTATION_BOOKMARK="orion.annotation.bookmark";g.ANNOTATION_FOLDING="orion.annotation.folding";g.ANNOTATION_CURRENT_BRACKET="orion.annotation.currentBracket";g.ANNOTATION_MATCHING_BRACKET="orion.annotation.matchingBracket";g.ANNOTATION_CURRENT_LINE="orion.annotation.currentLine";g.ANNOTATION_CURRENT_SEARCH="orion.annotation.currentSearch";g.ANNOTATION_MATCHING_SEARCH="orion.annotation.matchingSearch";g.ANNOTATION_READ_OCCURRENCE="orion.annotation.readOccurrence";g.ANNOTATION_WRITE_OCCURRENCE="orion.annotation.writeOccurrence";
g.ANNOTATION_SELECTED_LINKED_GROUP="orion.annotation.selectedLinkedGroup";g.ANNOTATION_CURRENT_LINKED_GROUP="orion.annotation.currentLinkedGroup";g.ANNOTATION_LINKED_GROUP="orion.annotation.linkedGroup";g.ANNOTATION_BLAME="orion.annotation.blame";g.ANNOTATION_CURRENT_BLAME="orion.annotation.currentBlame";var h={};g.registerType=function(a,c){var d=c;if(typeof d!=="function")d=function(a,c,d){this.start=a;this.end=c;if(d!==void 0)this.title=d},d.prototype=c;d.prototype.type=a;h[a]=d;return a};g.createAnnotation=
function(a,c,d,b){return new (this.getType(a))(c,d,b)};g.getType=function(a){return h[a]};b(g.ANNOTATION_ERROR);b(g.ANNOTATION_WARNING);b(g.ANNOTATION_TASK);b(g.ANNOTATION_BREAKPOINT);b(g.ANNOTATION_BOOKMARK);b(g.ANNOTATION_CURRENT_BRACKET);b(g.ANNOTATION_MATCHING_BRACKET);b(g.ANNOTATION_CURRENT_SEARCH);b(g.ANNOTATION_MATCHING_SEARCH);b(g.ANNOTATION_READ_OCCURRENCE);b(g.ANNOTATION_WRITE_OCCURRENCE);b(g.ANNOTATION_SELECTED_LINKED_GROUP);b(g.ANNOTATION_CURRENT_LINKED_GROUP);b(g.ANNOTATION_LINKED_GROUP);
b(g.ANNOTATION_CURRENT_LINE,!0);b(g.ANNOTATION_BLAME,!0);b(g.ANNOTATION_CURRENT_BLAME,!0);g.registerType(g.ANNOTATION_FOLDING,n);f.addMixin=function(a){var c=f.prototype,d;for(d in c)c.hasOwnProperty(d)&&(a[d]=c[d])};f.prototype={addAnnotationType:function(a){if(!this._annotationTypes)this._annotationTypes=[];this._annotationTypes.push(a)},getAnnotationTypePriority:function(a){if(this._annotationTypes)for(var c=0;c<this._annotationTypes.length;c++)if(this._annotationTypes[c]===a)return c+1;return 0},
getAnnotationsByType:function(a,c,d){a=a.getAnnotations(c,d);for(d=[];a.hasNext();)c=a.next(),this.getAnnotationTypePriority(c.type)!==0&&d.push(c);var b=this;d.sort(function(a,c){return b.getAnnotationTypePriority(a.type)-b.getAnnotationTypePriority(c.type)});return d},isAnnotationTypeVisible:function(a){return this.getAnnotationTypePriority(a)!==0},removeAnnotationType:function(a){if(this._annotationTypes)for(var c=0;c<this._annotationTypes.length;c++)if(this._annotationTypes[c]===a){this._annotationTypes.splice(c,
1);break}}};e.prototype={addAnnotation:function(a){if(a){var c=this._annotations,d=this._binarySearch(c,a.start);c.splice(d,0,a);this.onChanged({type:"Changed",added:[a],removed:[],changed:[]})}},getTextModel:function(){return this._model},getAnnotations:function(a,c){var d=this._annotations,b,h=0,e=function(){for(;h<d.length;){var b=d[h++];if(a===b.start||(a>b.start?a<b.end:b.start<c))return b;if(b.start>=c)break}return null};b=e();return{next:function(){var a=b;a&&(b=e());return a},hasNext:function(){return b!==
null}}},modifyAnnotation:function(a){if(a&&!(this._getAnnotationIndex(a)<0))this.onChanged({type:"Changed",added:[],removed:[],changed:[a]})},onChanged:function(a){return this.dispatchEvent(a)},removeAnnotations:function(a){var c=this._annotations,d,b;if(a){d=[];for(b=c.length-1;b>=0;b--){var h=c[b];h.type===a&&(c.splice(b,1),d.splice(0,0,h))}}else d=c;this.onChanged({type:"Changed",removed:d,added:[],changed:[]})},removeAnnotation:function(a){if(a&&(a=this._getAnnotationIndex(a),!(a<0)))this.onChanged({type:"Changed",
removed:this._annotations.splice(a,1),added:[],changed:[]})},replaceAnnotations:function(a,c){var d=this._annotations,b,h,e,f=[];if(a)for(b=a.length-1;b>=0;b--)e=a[b],h=this._getAnnotationIndex(e),h<0||(d.splice(h,1),f.splice(0,0,e));c||(c=[]);for(b=0;b<c.length;b++)e=c[b],h=this._binarySearch(d,e.start),d.splice(h,0,e);this.onChanged({type:"Changed",removed:f,added:c,changed:[]})},setTextModel:function(a){this._model&&this._model.removeEventListener("Changed",this._listener.onChanged);(this._model=
a)&&this._model.addEventListener("Changed",this._listener.onChanged)},_binarySearch:function(a,c){for(var d=a.length,b=-1,h;d-b>1;)h=Math.floor((d+b)/2),c<=a[h].start?d=h:b=h;return d},_getAnnotationIndex:function(a){for(var c=this._annotations,d=this._binarySearch(c,a.start);d<c.length&&c[d].start===a.start;){if(c[d]===a)return d;d++}return-1},_onChanged:function(a){var c=a.start,d=a.removedCharCount,b=this._annotations,h=c+d;if(0<b.length){for(var e={type:"Changed",added:[],removed:[],changed:[],
textModelChangedEvent:a},a=a.addedCharCount-d,d=0;d<b.length;d++){var f=b[d];f.start>=h?(f.start+=a,f.end+=a,e.changed.push(f)):f.end<=c||(f.start<c&&h<f.end?(f.end+=a,e.changed.push(f)):(b.splice(d,1),e.removed.push(f),d--))}if(e.added.length>0||e.removed.length>0||e.changed.length>0)this.onChanged(e)}}};o.EventTarget.addMixin(e.prototype);i.prototype={destroy:function(){var a=this._view;if(a)a.removeEventListener("Destroy",this._listener.onDestroy),a.removeEventListener("LineStyle",this._listener.onLineStyle),
this.view=null;(a=this._annotationModel)&&a.removeEventListener("Changed",this._listener.onChanged)},_mergeStyle:function(a,c){if(c){a||(a={});a.styleClass&&c.styleClass&&a.styleClass!==c.styleClass?a.styleClass+=" "+c.styleClass:a.styleClass=c.styleClass;var d;if(c.tagName&&!a.tagName)a.tagName=c.tagName;if(c.style){if(!a.style)a.style={};for(d in c.style)a.style[d]||(a.style[d]=c.style[d])}if(c.attributes){if(!a.attributes)a.attributes={};for(d in c.attributes)a.attributes[d]||(a.attributes[d]=
c.attributes[d])}}return a},_mergeStyleRanges:function(a,c){a||(a=[]);var d,b;for(b=0;b<a.length&&c;b++){var h=a[b];if(c.end<=h.start)break;if(!(c.start>=h.end)){d=this._mergeStyle({},h.style);d=this._mergeStyle(d,c.style);var e=[];e.push(b,1);c.start<h.start&&e.push({start:c.start,end:h.start,style:c.style});c.start>h.start&&e.push({start:h.start,end:c.start,style:h.style});e.push({start:Math.max(h.start,c.start),end:Math.min(h.end,c.end),style:d});c.end<h.end&&e.push({start:c.end,end:h.end,style:h.style});
c=c.end>h.end?{start:h.end,end:c.end,style:c.style}:null;Array.prototype.splice.apply(a,e)}}c&&(d=this._mergeStyle({},c.style),a.splice(b,0,{start:c.start,end:c.end,style:d}));return a},_onAnnotationModelChanged:function(a){function c(a){for(var c=0;c<a.length;c++)if(b.isAnnotationTypeVisible(a[c].type)){var e=a[c].start,f=a[c].end;h.getBaseModel&&(e=h.mapOffset(e,!0),f=h.mapOffset(f,!0));e!==-1&&f!==-1&&d.redrawRange(e,f)}}if(!a.textModelChangedEvent){var d=this._view;if(d){var b=this,h=d.getModel();
c(a.added);c(a.removed);c(a.changed)}}},_onDestroy:function(){this.destroy()},_onLineStyle:function(a){var c=this._annotationModel,d=a.textView.getModel(),b=c.getTextModel(),h=a.lineStart,e=a.lineStart+a.lineText.length;b!==d&&(h=d.mapOffset(h),e=d.mapOffset(e));for(c=c.getAnnotations(h,e);c.hasNext();)if(h=c.next(),this.isAnnotationTypeVisible(h.type)){if(h.rangeStyle){var e=h.start,f=h.end;b!==d&&(e=d.mapOffset(e,!0),f=d.mapOffset(f,!0));a.ranges=this._mergeStyleRanges(a.ranges,{start:e,end:f,style:h.rangeStyle})}if(h.lineStyle)a.style=
this._mergeStyle({},a.style),a.style=this._mergeStyle(a.style,h.lineStyle)}}};f.addMixin(i.prototype);return{FoldingAnnotation:n,AnnotationType:g,AnnotationTypeList:f,AnnotationModel:e,AnnotationStyler:i}});
define("orion/editor/tooltip","i18n!orion/editor/nls/messages,orion/editor/textView,orion/editor/textModel,orion/editor/projectionTextModel,orion/editor/util,orion/util".split(","),function(j,o,n,g,b,f){function e(b){this._view=b;this._fadeDelay=500;this._hideDelay=200;this._showDelay=500;this._autoHideDelay=5E3;this._create(b.getOptions("parent").ownerDocument)}e.getTooltip=function(b){if(!b._tooltip)b._tooltip=new e(b);return b._tooltip};e.prototype={_create:function(e){if(!this._tooltipDiv){var h=
this._tooltipDiv=f.createElement(e,"div");h.tabIndex=0;h.className="textviewTooltip";h.setAttribute("aria-live","assertive");h.setAttribute("aria-atomic","true");var a=this._tooltipContents=f.createElement(e,"div");h.appendChild(a);e.body.appendChild(h);var c=this;b.addEventListener(h,"mouseover",function(){if(c._hideDelay){var a=c._getWindow();if(c._delayedHideTimeout)a.clearTimeout(c._delayedHideTimeout),c._delayedHideTimeout=null;if(c._hideTimeout)a.clearTimeout(c._hideTimeout),c._hideTimeout=
null;c._nextTarget=null}},!1);b.addEventListener(h,"mouseout",function(a){a=a.relatedTarget||a.toElement;a===h||c._hasFocus()||(!a||!b.contains(h,a))&&c._hide()},!1);b.addEventListener(h,"keydown",function(a){a.keyCode===27&&c._hide()},!1);b.addEventListener(e,"mousedown",this._mouseDownHandler=function(a){c.isVisible()&&(b.contains(h,a.target||a.srcElement)||c._hide())},!0);this._view.addEventListener("Destroy",function(){c.destroy()});this._hide()}},_getWindow:function(){var b=this._tooltipDiv.ownerDocument;
return b.defaultView||b.parentWindow},destroy:function(){if(this._tooltipDiv){this._hide();var e=this._tooltipDiv.parentNode;e&&e.removeChild(this._tooltipDiv);b.removeEventListener(this._tooltipDiv.ownerDocument,"mousedown",this._mouseDownHandler,!0);this._tooltipDiv=null}},_hasFocus:function(){var e=this._tooltipDiv;return!e?!1:b.contains(e,e.ownerDocument.activeElement)},hide:function(b){if(b===void 0)b=this._hideDelay;var h=this._getWindow();if(this._delayedHideTimeout)h.clearTimeout(this._delayedHideTimeout),
this._delayedHideTimeout=null;var a=this;b?a._delayedHideTimeout=h.setTimeout(function(){a._delayedHideTimeout=null;a._hide();a.setTarget(a._nextTarget,0)},b):(a._hide(),a.setTarget(a._nextTarget,0))},_hide:function(){var b=this._tooltipDiv;if(b){this._hasFocus()&&this._view.focus();if(this._contentsView)this._contentsView.destroy(),this._contentsView=null;if(this._tooltipContents)this._tooltipContents.innerHTML="";b.style.visibility="hidden";b=this._getWindow();if(this._showTimeout)b.clearTimeout(this._showTimeout),
this._showTimeout=null;if(this._delayedHideTimeout)b.clearTimeout(this._delayedHideTimeout),this._delayedHideTimeout=null;if(this._hideTimeout)b.clearTimeout(this._hideTimeout),this._hideTimeout=null;if(this._fadeTimeout)b.clearInterval(this._fadeTimeout),this._fadeTimeout=null}},isVisible:function(){return this._tooltipDiv&&this._tooltipDiv.style.visibility==="visible"},setTarget:function(b,h,a){if(this.isVisible()){if(!this._hasFocus())this._nextTarget=b,this.hide(a)}else if(this._target=b){var c=
this,b=c._getWindow();if(c._showTimeout)b.clearTimeout(c._showTimeout),c._showTimeout=null;h===0?c.show(!0):c._showTimeout=b.setTimeout(function(){c._showTimeout=null;c.show(!0)},h?h:c._showDelay)}},show:function(b){if(this._target){var h=this._target.getTooltipInfo();if(h){var a=this._tooltipDiv,c=this._tooltipContents;a.style.left=a.style.right=a.style.width=a.style.height=c.style.width=c.style.height="auto";var d=h.contents;d instanceof Array&&(d=this._getAnnotationContents(d));if(typeof d==="string")c.innerHTML=
d;else if(this._isNode(d))c.appendChild(d);else if(d instanceof g.ProjectionTextModel){var k=this._view,e=k.getOptions();e.wrapMode=!1;e.parent=c;var f=e.themeClass;f?((f=f.replace("tooltip",""))&&(f=" "+f),f="tooltip"+f):f="tooltip";e.themeClass=f;e=this._contentsView=new o.TextView(e);e.addEventListener("LineStyle",function(a){k.onLineStyle(a)});e.setModel(d);d=e.computeSize();c.style.width=d.width+"px";c.style.height=d.height+"px";e.resize()}else return;c=a.ownerDocument.documentElement;h.anchor===
"right"?(d=c.clientWidth-h.x,a.style.right=d+"px"):(d=parseInt(this._getNodeStyle(a,"padding-left","0"),10),d+=parseInt(this._getNodeStyle(a,"border-left-width","0"),10),d=h.x-d,a.style.left=d+"px");a.style.maxWidth=c.clientWidth-d-10+"px";d=parseInt(this._getNodeStyle(a,"padding-top","0"),10);d+=parseInt(this._getNodeStyle(a,"border-top-width","0"),10);d=h.y-d;a.style.top=d+"px";a.style.maxHeight=c.clientHeight-d-10+"px";a.style.opacity="1";a.style.visibility="visible";if(b){var q=this,r=this._getWindow();
q._hideTimeout=r.setTimeout(function(){q._hideTimeout=null;var c=parseFloat(q._getNodeStyle(a,"opacity","1"));q._fadeTimeout=r.setInterval(function(){a.style.visibility==="visible"&&c>0?(c-=0.1,a.style.opacity=c):q._hide()},q._fadeDelay/10)},q._autoHideDelay)}}}},_getAnnotationContents:function(e){function h(a,c){var d=s.getLineStart(s.getLineAtOffset(a)),b=s.getLineEnd(s.getLineAtOffset(c),!0);return s.getText(d,b)}function a(a){var c=a.title,d=f.createElement(p,"div");d.className="tooltipRow";if(a.html)d.innerHTML=
a.html,d.lastChild&&b.addEventListener(d.lastChild,"click",function(){var c=a.start,d=a.end;r.getBaseModel&&(c=r.mapOffset(c,!0),d=r.mapOffset(d,!0));q.setSelection(c,d,1/3,function(){m._hide()})},!1),d.appendChild(p.createTextNode("\u00a0"));c||(c=h(a.start,a.end));typeof c==="function"&&(c=a.title());if(typeof c==="string"){var k=f.createElement(p,"span");k.appendChild(p.createTextNode(c));c=k}d.appendChild(c);return d}for(var c,d=[],k=0;k<e.length;k++)c=e[k],c.title!==""&&!c.groupAnnotation&&d.push(c);
e=d;if(e.length===0)return null;var m=this,p=this._tooltipDiv.ownerDocument,q=this._view,r=q.getModel(),s=r.getBaseModel?r.getBaseModel():r;if(e.length===1)if(c=e[0],c.title!==void 0){c=a(c);if(c.firstChild)(e=c.firstChild.className)&&(e+=" "),e+="single",c.firstChild.className=e;return c}else return e=new g.ProjectionTextModel(s),d=s.getLineStart(s.getLineAtOffset(c.start)),k=s.getCharCount(),c.end!==k&&e.addProjection({start:c.end,end:k}),d>0&&e.addProjection({start:0,end:d}),e;else{d=f.createElement(p,
"div");c=f.createElement(p,"em");c.appendChild(p.createTextNode(j.multipleAnnotations));d.appendChild(c);for(k=0;k<e.length;k++)c=e[k],(c=a(c))&&d.appendChild(c);return d}},_getNodeStyle:function(b,h,a){var c;if(b&&(c=b.style[h],!c))if(b.currentStyle){for(c=0;(c=h.indexOf("-",c))!==-1;)h=h.substring(0,c)+h.substring(c+1,c+2).toUpperCase()+h.substring(c+2);c=b.currentStyle[h]}else c=(b=b.ownerDocument.defaultView.getComputedStyle(b,null))?b.getPropertyValue(h):null;return c||a},_isNode:function(b){return typeof Node===
"object"?b instanceof Node:b&&typeof b==="object"&&typeof b.nodeType==="number"&&typeof b.nodeName==="string"}};return{Tooltip:e}});
define("orion/editor/rulers",["i18n!orion/editor/nls/messages","orion/editor/annotations","orion/editor/tooltip","orion/util"],function(j,o,n,g){function b(a,c,d,b){this._location=c||"left";this._overview=d||"page";this._rulerStyle=b;this._view=null;var h=this;this._listener={onTextModelChanged:function(a){h._onTextModelChanged(a)},onAnnotationModelChanged:function(a){h._onAnnotationModelChanged(a)}};this.setAnnotationModel(a)}function f(a,c,d,h,e){b.call(this,a,c,"page",d);this._oddStyle=h||{style:{backgroundColor:"white"}};
this._evenStyle=e||{style:{backgroundColor:"white"}};this._numOfDigits=0;this._firstLine=1}function e(a,c,d){b.call(this,a,c,"page",d)}function i(a,c,d){b.call(this,a,c,"document",d)}function h(a,c,d){e.call(this,a,c,d)}b.prototype={getAnnotations:function(a,c){var d=this._annotationModel;if(!d)return[];var b=this._view.getModel(),h=b.getLineStart(a),e=b.getLineEnd(c-1),f=b;b.getBaseModel&&(f=b.getBaseModel(),h=b.mapOffset(h),e=b.mapOffset(e));for(var g=[],d=this.getAnnotationsByType(d,h,e),h=0;h<
d.length;h++)for(var e=d[h],i=f.getLineAtOffset(e.start),j=f.getLineAtOffset(Math.max(e.start,e.end-1)),n=i;n<=j;n++){var o=n;if(b!==f){o=f.getLineStart(n);o=b.mapOffset(o,!0);if(o===-1)continue;o=b.getLineAtOffset(o)}if(a<=o&&o<c){var l=this._mergeAnnotation(g[o],e,n-i,j-i+1);l&&(g[o]=l)}}if(!this._multiAnnotation&&this._multiAnnotationOverlay)for(var t in g)g[t]._multiple&&(g[t].html+=this._multiAnnotationOverlay.html);return g},getAnnotationModel:function(){return this._annotationModel},getLocation:function(){return this._location},
getOverview:function(){return this._overview},getRulerStyle:function(){return this._rulerStyle},getView:function(){return this._view},getWidestAnnotation:function(){return null},setAnnotationModel:function(a){this._annotationModel&&this._annotationModel.removEventListener("Changed",this._listener.onAnnotationModelChanged);(this._annotationModel=a)&&this._annotationModel.addEventListener("Changed",this._listener.onAnnotationModelChanged)},setMultiAnnotation:function(a){this._multiAnnotation=a},setMultiAnnotationOverlay:function(a){this._multiAnnotationOverlay=
a},setView:function(a){this._onTextModelChanged&&this._view&&this._view.removeEventListener("ModelChanged",this._listener.onTextModelChanged);this._view=a;this._onTextModelChanged&&this._view&&this._view.addEventListener("ModelChanged",this._listener.onTextModelChanged)},onClick:function(a){if(a!==void 0){var c=this._view,d=c.getModel(),b=d,h=d.getLineStart(a),e=h,f=h,g=this._annotationModel;if(g){c=c.getSelection();f=d.getLineEnd(a,!0);if(h<=c.start&&c.start<f)h=c.start;d.getBaseModel&&(h=d.mapOffset(h),
f=d.mapOffset(f),b=d.getBaseModel());for(var i,f=g.getAnnotations(h,f),g=null;!i&&f.hasNext();)c=f.next(),this.isAnnotationTypeVisible(c.type)&&(g=c,c.start<=h||(i=c));if(g&&g.groupId!==void 0)this._currentClickGroup=this._currentClickGroup===g.groupId?null:g.groupId,this._setCurrentGroup(a);i&&b.getLineAtOffset(i.start)===b.getLineAtOffset(h)?(h=i.start,f=i.end):f=h=e;d.getBaseModel&&(h=d.mapOffset(h,!0),f=d.mapOffset(f,!0))}(a=n.Tooltip.getTooltip(this._view))&&a.setTarget(null);this._view.setSelection(f,
h,1/3,function(){})}},onDblClick:function(){},onMouseMove:function(a,c){var d=n.Tooltip.getTooltip(this._view);if(d&&!(d.isVisible()&&this._tooltipLineIndex===a)){this._tooltipLineIndex=a;var b=this;d.setTarget({y:c.clientY,getTooltipInfo:function(){return b._getTooltipInfo(b._tooltipLineIndex,this.y)}})}},onMouseOver:function(a,c){this.onMouseMove(a,c);this._currentClickGroup||this._setCurrentGroup(a)},onMouseOut:function(){this._currentClickGroup||this._setCurrentGroup(-1);var a=n.Tooltip.getTooltip(this._view);
a&&a.setTarget(null)},_getTooltipInfo:function(a,c){if(a!==void 0){var d=this._view,b=d.getModel(),h=this._annotationModel,e=[];if(h){var e=b.getLineStart(a),f=b.getLineEnd(a);b.getBaseModel&&(e=b.mapOffset(e),f=b.mapOffset(f));e=this.getAnnotationsByType(h,e,f)}h=this._getTooltipContents(a,e);if(!h)return null;h={contents:h,anchor:this.getLocation()};e=d.getClientArea();e.y=this.getOverview()==="document"?d.convert({y:c},"view","document").y:d.getLocationAtOffset(b.getLineStart(a)).y;d.convert(e,
"document","page");h.x=e.x;h.y=e.y;h.anchor==="right"&&(h.x+=e.width);return h}},_getTooltipContents:function(a,c){return c},_onAnnotationModelChanged:function(a){function c(a){for(var c=0;c<a.length;c++)if(h.isAnnotationTypeVisible(a[c].type)){var e=a[c].start,f=a[c].end;b.getBaseModel&&(e=b.mapOffset(e,!0),f=b.mapOffset(f,!0));e!==-1&&f!==-1&&d.redrawLines(b.getLineAtOffset(e),b.getLineAtOffset(Math.max(e,f-1))+1,h)}}var d=this._view;if(d){var b=d.getModel(),h=this,e=b.getLineCount();a.textModelChangedEvent?
(a=a.textModelChangedEvent.start,b.getBaseModel&&(a=b.mapOffset(a,!0)),a=b.getLineAtOffset(a),d.redrawLines(a,e,h)):(c(a.added),c(a.removed),c(a.changed))}},_mergeAnnotation:function(a,c,d){a||(a={});if(d===0)if(a.html&&c.html){if(c.html!==a.html&&!a._multiple&&this._multiAnnotation)a.html=this._multiAnnotation.html;a._multiple=!0}else a.html=c.html;a.style=this._mergeStyle(a.style,c.style);return a},_mergeStyle:function(a,c){if(c){a||(a={});a.styleClass&&c.styleClass&&a.styleClass!==c.styleClass?
a.styleClass+=" "+c.styleClass:a.styleClass=c.styleClass;var d;if(c.style){if(!a.style)a.style={};for(d in c.style)a.style[d]===void 0&&(a.style[d]=c.style[d])}if(c.attributes){if(!a.attributes)a.attributes={};for(d in c.attributes)a.attributes[d]===void 0&&(a.attributes[d]=c.attributes[d])}}return a},_setCurrentGroup:function(a){var c=this._annotationModel,d=null,b=c.getTextModel(),h,e,f=this._currentGroupAnnotation;if(a!==-1){var g=b.getLineStart(a),i=b.getLineEnd(a);b.getBaseModel&&(g=b.mapOffset(g),
i=b.mapOffset(i));for(e=c.getAnnotations(g,i);e.hasNext();)if(h=e.next(),this.isAnnotationTypeVisible(h.type)&&h.start<=g&&h.end>=i&&h.groupId!==void 0){d=h;break}if(f&&d&&f.groupId===d.groupId)return}this._currentGroupAnnotation=null;f&&c.removeAnnotations(f.groupType);if(d&&a!==-1){this._currentGroupAnnotation=d;e=c.getAnnotations(0,b.getCharCount());for(a=[];e.hasNext();)h=e.next(),delete h.groupAnnotation,h.groupId===d.groupId&&(h=h.createGroupAnnotation(),a.push(h));c.replaceAnnotations(null,
a)}}};o.AnnotationTypeList.addMixin(b.prototype);f.prototype=new b;f.prototype.getAnnotations=function(a,c){for(var d=b.prototype.getAnnotations.call(this,a,c),h=this._view.getModel(),e=a;e<c;e++){var f=e&1?this._oddStyle:this._evenStyle,g=e;h.getBaseModel&&(g=h.getLineStart(g),g=h.getBaseModel().getLineAtOffset(h.mapOffset(g)));d[e]||(d[e]={});d[e].html=this._firstLine+g+"";if(!d[e].style)d[e].style=f}return d};f.prototype.getWidestAnnotation=function(){var a=this._view.getModel().getLineCount();
return this.getAnnotations(a-1,a)[a-1]};f.prototype.setFirstLine=function(a){this._firstLine=a!==void 0?a:1};f.prototype._onTextModelChanged=function(a){var a=a.start,c=this._view.getModel(),d=(this._firstLine+(c.getBaseModel?c.getBaseModel().getLineCount():c.getLineCount())-1+"").length;if(this._numOfDigits!==d)this._numOfDigits=d,this._view.redrawLines(c.getLineAtOffset(a),c.getLineCount(),this)};e.prototype=new b;i.prototype=new b;i.prototype.getRulerStyle=function(){var a={style:{lineHeight:"1px",
fontSize:"1px"}};return a=this._mergeStyle(a,this._rulerStyle)};i.prototype._getTooltipContents=function(a,c){if(c.length===0){var d=this._view.getModel(),h=a;d.getBaseModel&&(h=d.getLineStart(h),h=d.getBaseModel().getLineAtOffset(d.mapOffset(h)));return g.formatMessage(j.line,h+1)}return b.prototype._getTooltipContents.call(this,a,c)};i.prototype._mergeAnnotation=function(a,c,d,b){if(d===0){if(!a)a={html:"&nbsp;",style:{style:{height:3*b+"px"}}},a.style=this._mergeStyle(a.style,c.overviewStyle);
return a}};h.prototype=new e;h.prototype.onClick=function(a){if(a!==void 0){var c=this._annotationModel;if(c){var d=this._view.getModel(),b=d.getLineStart(a),a=d.getLineEnd(a,!0);d.getBaseModel&&(b=d.mapOffset(b),a=d.mapOffset(a),d=d.getBaseModel());for(var h,c=c.getAnnotations(b,a);!h&&c.hasNext();)a=c.next(),this.isAnnotationTypeVisible(a.type)&&(h=a);h&&d.getLineAtOffset(h.start)===d.getLineAtOffset(b)&&((d=n.Tooltip.getTooltip(this._view))&&d.setTarget(null),h.expanded?h.collapse():h.expand(),
this._annotationModel.modifyAnnotation(h))}}};h.prototype._getTooltipContents=function(a,c){return c.length===1&&c[0].expanded?null:e.prototype._getTooltipContents.call(this,a,c)};h.prototype._onAnnotationModelChanged=function(a){function c(a){for(f=0;f<a.length;f++)if(h.isAnnotationTypeVisible(a[f].type)){var c=a[f].start;b.getBaseModel&&(c=b.mapOffset(c,!0));c!==-1&&(i=Math.min(i,b.getLineAtOffset(c)))}}if(a.textModelChangedEvent)e.prototype._onAnnotationModelChanged.call(this,a);else{var d=this._view;
if(d){var b=d.getModel(),h=this,f,g=b.getLineCount(),i=g;c(a.added);c(a.removed);c(a.changed);a=d.getRulers();for(f=0;f<a.length;f++)d.redrawLines(i,g,a[f])}}};return{Ruler:b,AnnotationRuler:e,LineNumberRuler:f,OverviewRuler:i,FoldingRuler:h}});
define("orion/editor/undoStack",[],function(){function j(g,b,f,e){this.offset=g;this.text=b;this.previousText=f;this.type=e}function o(g){this.owner=g;this.changes=[]}function n(g,b){this.view=g;this.size=b!==void 0?b:100;this.reset();var f=g.getModel();f.getBaseModel&&(f=f.getBaseModel());this.model=f;var e=this;this._listener={onChanging:function(b){e._onChanging(b)},onDestroy:function(b){e._onDestroy(b)}};f.addEventListener("Changing",this._listener.onChanging);g.addEventListener("Destroy",this._listener.onDestroy)}
j.prototype={getRedoChanges:function(){return[{start:this.offset,end:this.offset+this.previousText.length,text:this.text}]},getUndoChanges:function(){return[{start:this.offset,end:this.offset+this.text.length,text:this.previousText}]},undo:function(g,b){this._doUndoRedo(this.offset,this.previousText,this.text,g,b);return!0},redo:function(g,b){this._doUndoRedo(this.offset,this.text,this.previousText,g,b);return!0},merge:function(g,b,f,e,i){if(e===this.type)if(e===1&&g===this.offset+this.text.length)return this.text+=
b,!0;else if(e===-1&&i===this.offset)return this.offset=g,this.previousText=f+this.previousText,!0;else if(e===-1&&g===this.offset)return this.previousText+=f,!0;return!1},_doUndoRedo:function(g,b,f,e,i){var h=e.getModel();if(h.mapOffset&&e.annotationModel){var a=h.mapOffset(g,!0);if(a<0)for(var c=e.annotationModel.getAnnotations(g,g+1);c.hasNext();){var d=c.next();if(d.type==="orion.annotation.folding"){d.expand();a=h.mapOffset(g,!0);break}}if(a<0)return;g=a}h.setText(b,g,g+f.length);i&&e.setSelection(g,
g+b.length)}};o.prototype={getRedoChanges:function(){for(var g=[],b=0;b<this.changes.length;b++)g=g.concat(this.changes[b].getRedoChanges());return g},getUndoChanges:function(){for(var g=[],b=this.changes.length-1;b>=0;b--)g=g.concat(this.changes[b].getUndoChanges());return g},add:function(g){this.changes.push(g)},end:function(g){this.endSelection=g.getSelection();this.endCaret=g.getCaretOffset();(g=this.owner)&&g.end&&g.end()},undo:function(g,b){this.changes.length>1&&g.setRedraw(!1);for(var f=this.changes.length-
1;f>=0;f--)this.changes[f].undo(g,!1);this.changes.length>1&&g.setRedraw(!0);if(b){var f=this.startSelection.start,e=this.startSelection.end;g.setSelection(this.startCaret?f:e,this.startCaret?e:f)}(f=this.owner)&&f.undo&&f.undo();return this.changes.length>0},redo:function(g,b){this.changes.length>1&&g.setRedraw(!1);for(var f=0;f<this.changes.length;f++)this.changes[f].redo(g,!1);this.changes.length>1&&g.setRedraw(!0);if(b){var f=this.endSelection.start,e=this.endSelection.end;g.setSelection(this.endCaret?
f:e,this.endCaret?e:f)}(f=this.owner)&&f.redo&&f.redo();return this.changes.length>0},merge:function(g,b,f,e,i){var h=this.changes.length;return h>0?this.changes[h-1].merge(g,b,f,e,i):!1},start:function(g){this.startSelection=g.getSelection();this.startCaret=g.getCaretOffset();(g=this.owner)&&g.start&&g.start()}};n.prototype={add:function(g){this.compoundChange?this.compoundChange.add(g):(this.stack.splice(this.index,this.stack.length-this.index,g),this.index++,this.stack.length>this.size&&(this.stack.shift(),
this.index--))},markClean:function(){this._commitUndo();if(this.cleanChange=this.stack[this.index-1])this.cleanChange.type=2},isClean:function(){return this.cleanChange===this.stack[this.index-1]},canUndo:function(){return this.index>0},canRedo:function(){return this.stack.length-this.index>0},endCompoundChange:function(){this.compoundChange&&this.compoundChange.end(this.view);this.compoundChange=void 0},getSize:function(){return{undo:this.index,redo:this.stack.length-this.index}},getRedoChanges:function(){this._commitUndo();
for(var g=[],b=this.index;b<this.stack.length;b++)g=g.concat(this.stack[b].getRedoChanges());return g},getUndoChanges:function(){this._commitUndo();for(var g=[],b=this.index;b>=0;b--)g=g.concat(this.stack[b].getUndoChanges());return g},undo:function(){this._commitUndo();var g;g=!1;this._ignoreUndo=!0;do{if(this.index<=0)break;g=this.stack[--this.index]}while(!(g=g.undo(this.view,!0)));this._ignoreUndo=!1;return g},redo:function(){this._commitUndo();var g;this._ignoreUndo=!0;do{if(this.index>=this.stack.length)break;
g=this.stack[this.index++]}while(!g.redo(this.view,!0));this._ignoreUndo=!1;return!0},reset:function(){this.index=0;this.cleanChange=void 0;this.stack=[];this._ignoreUndo=!1;this._compoundChange=void 0},startCompoundChange:function(g){this._commitUndo();g=new o(g);this.add(g);this.compoundChange=g;this.compoundChange.start(this.view);return this.compoundChange},_commitUndo:function(){this.endCompoundChange()},_onDestroy:function(){this.model.removeEventListener("Changing",this._listener.onChanging);
this.view.removeEventListener("Destroy",this._listener.onDestroy)},_onChanging:function(g){if(!this._ignoreUndo){var b=g.text,f=g.start,e=g.addedCharCount,i=g.removedCharCount,g=f+i,h=0;e===0&&i===1?h=-1:e===1&&i===0&&(h=1);e=this.stack.length;i=this.model.getText(f,g);(!(e>0&&this.index===e)||!this.stack[e-1].merge(f,b,i,h,g))&&this.add(new j(f,b,i,h))}}};return{UndoStack:n}});
define("orion/editor/textDND",[],function(){function j(j,n){this._view=j;this._undoStack=n;this._dragSelection=null;this._dropOffset=-1;this._dropText=null;var g=this;this._listener={onDragStart:function(b){g._onDragStart(b)},onDragEnd:function(b){g._onDragEnd(b)},onDragEnter:function(b){g._onDragEnter(b)},onDragOver:function(b){g._onDragOver(b)},onDrop:function(b){g._onDrop(b)},onDestroy:function(b){g._onDestroy(b)}};j.addEventListener("DragStart",this._listener.onDragStart);j.addEventListener("DragEnd",
this._listener.onDragEnd);j.addEventListener("DragEnter",this._listener.onDragEnter);j.addEventListener("DragOver",this._listener.onDragOver);j.addEventListener("Drop",this._listener.onDrop);j.addEventListener("Destroy",this._listener.onDestroy)}j.prototype={destroy:function(){var j=this._view;if(j)j.removeEventListener("DragStart",this._listener.onDragStart),j.removeEventListener("DragEnd",this._listener.onDragEnd),j.removeEventListener("DragEnter",this._listener.onDragEnter),j.removeEventListener("DragOver",
this._listener.onDragOver),j.removeEventListener("Drop",this._listener.onDrop),j.removeEventListener("Destroy",this._listener.onDestroy),this._view=null},_onDestroy:function(){this.destroy()},_onDragStart:function(j){var n=this._view,g=n.getSelection(),n=n.getModel();if(n.getBaseModel)g.start=n.mapOffset(g.start),g.end=n.mapOffset(g.end),n=n.getBaseModel();if(n=n.getText(g.start,g.end))this._dragSelection=g,j.event.dataTransfer.effectAllowed="copyMove",j.event.dataTransfer.setData("Text",n)},_onDragEnd:function(j){var n=
this._view;if(this._dragSelection){this._undoStack&&this._undoStack.startCompoundChange();(j=j.event.dataTransfer.dropEffect==="move")&&n.setText("",this._dragSelection.start,this._dragSelection.end);if(this._dropText){var g=this._dropText,b=this._dropOffset;if(j)if(b>=this._dragSelection.end)b-=this._dragSelection.end-this._dragSelection.start;else if(b>=this._dragSelection.start)b=this._dragSelection.start;n.setText(g,b,b);n.setSelection(b,b+g.length);this._dropText=null;this._dropOffset=-1}this._undoStack&&
this._undoStack.endCompoundChange()}this._dragSelection=null},_onDragEnter:function(j){this._onDragOver(j)},_onDragOver:function(j){var n=j.event.dataTransfer.types;if(n){var g=!this._view.getOptions("readonly");g&&(g=n.contains?n.contains("text/plain"):n.indexOf("text/plain")!==-1);if(!g)j.event.dataTransfer.dropEffect="none"}},_onDrop:function(j){var n=this._view,g=j.event.dataTransfer.getData("Text");if(g)j=n.getOffsetAtLocation(j.x,j.y),this._dragSelection?(this._dropOffset=j,this._dropText=g):
(n.setText(g,j,j),n.setSelection(j,j+g.length))}};return{TextDND:j}});
define("orion/editor/editor",["i18n!orion/editor/nls/messages","orion/editor/eventTarget","orion/editor/tooltip","orion/editor/annotations","orion/util"],function(j,o,n,g,b){function f(b,a){if(a)for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}function e(b){this._textViewFactory=b.textViewFactory;this._undoStackFactory=b.undoStackFactory;this._textDNDFactory=b.textDNDFactory;this._annotationFactory=b.annotationFactory;this._foldingRulerFactory=b.foldingRulerFactory;this._lineNumberRulerFactory=
b.lineNumberRulerFactory;this._contentAssistFactory=b.contentAssistFactory;this._keyBindingFactory=b.keyBindingFactory;this._statusReporter=b.statusReporter;this._domNode=b.domNode;this._foldingRuler=this._overviewRuler=this._lineNumberRuler=this._annotationRuler=this._annotationModel=this._annotationStyler=null;this._dirty=!1;this._title=this._contentAssist=null}var i=g.AnnotationType;e.prototype={destroy:function(){this.uninstallTextView();this._textViewFactory=this._undoStackFactory=this._textDNDFactory=
this._annotationFactory=this._foldingRulerFactory=this._lineNumberRulerFactory=this._contentAssistFactory=this._keyBindingFactory=this._statusReporter=this._domNode=null},getAnnotationModel:function(){return this._annotationModel},getAnnotationRuler:function(){return this._annotationRuler},getAnnotationStyler:function(){return this._annotationStyler},getContentAssist:function(){return this._contentAssist},getFoldingRuler:function(){return this._foldingRuler},getLineNumberRuler:function(){return this._lineNumberRuler},
getModel:function(){var b=this._textView.getModel();b.getBaseModel&&(b=b.getBaseModel());return b},getOverviewRuler:function(){return this._overviewRuler},getTextView:function(){return this._textView},getTitle:function(){return this._title},getUndoStack:function(){return this._undoStack},getKeyModes:function(){return this._textView.getKeyModes()},getSourceCodeActions:function(){return this._sourceCodeActions},getLinkedMode:function(){return this._linkedMode},getTextActions:function(){return this._textActions},
focus:function(){this._textView&&this._textView.focus()},isDirty:function(){return this._dirty},setAnnotationRulerVisible:function(b,a){if(this._annotationRulerVisible!==b||a)if(this._annotationRulerVisible=b,this._annotationRuler){var c=this._textView;b?c.addRuler(this._annotationRuler,0):c.removeRuler(this._annotationRuler)}},setFoldingRulerVisible:function(b,a){if(this._foldingRulerVisible!==b||a)if(this._foldingRulerVisible=b,this._foldingRuler){var c=this._textView;c.getModel().getBaseModel&&
(b?c.addRuler(this._foldingRuler):c.removeRuler(this._foldingRuler))}},setDirty:function(b){if(this._dirty!==b)this._dirty=b,this.onDirtyChanged({type:"DirtyChanged"})},setLineNumberRulerVisible:function(b,a){if(this._lineNumberRulerVisible!==b||a)if(this._lineNumberRulerVisible=b,this._lineNumberRuler){var c=this._textView;b?c.addRuler(this._lineNumberRuler,!this._annotationRulerVisible?0:1):c.removeRuler(this._lineNumberRuler)}},setOverviewRulerVisible:function(b,a){if(this._overviewRulerVisible!==
b||a)if(this._overviewRulerVisible=b,this._overviewRuler){var c=this._textView;b?c.addRuler(this._overviewRuler):c.removeRuler(this._overviewRuler)}},mapOffset:function(b,a){var c=this._textView.getModel();c.getBaseModel&&(b=c.mapOffset(b,a));return b},getCaretOffset:function(){return this.mapOffset(this._textView.getCaretOffset())},getSelection:function(){var b=this._textView,a=b.getSelection(),b=b.getModel();if(b.getBaseModel)a.start=b.mapOffset(a.start),a.end=b.mapOffset(a.end);return a},getText:function(b,
a){var c=this._textView.getModel();c.getBaseModel&&(c=c.getBaseModel());return c.getText(b,a)},_expandOffset:function(b){var a=this._textView.getModel(),c=this._annotationModel;if(c&&a.getBaseModel)for(b=c.getAnnotations(b,b+1);b.hasNext();)a=b.next(),a.type===i.ANNOTATION_FOLDING&&a.expand&&(a.expand(),c.modifyAnnotation(a))},setCaretOffset:function(b,a,c){var d=this._textView,e=d.getModel();e.getBaseModel&&(this._expandOffset(b),b=e.mapOffset(b,!0));d.setCaretOffset(b,a,c)},setText:function(b,a,
c){var d=this._textView,e=d.getModel();e.getBaseModel&&(a!==void 0&&(this._expandOffset(a),a=e.mapOffset(a,!0)),c!==void 0&&(this._expandOffset(c),c=e.mapOffset(c,!0)));d.setText(b,a,c)},setSelection:function(b,a,c,d){var e=this._textView,f=e.getModel();f.getBaseModel&&(this._expandOffset(b),this._expandOffset(a),b=f.mapOffset(b,!0),a=f.mapOffset(a,!0));e.setSelection(b,a,c,d)},moveSelection:function(b,a,c,d){var e=this._textView;this.setSelection(b,a||b,1/3,function(){(d===void 0||d)&&e.focus();
c&&c()})},checkDirty:function(){this.setDirty(!this._undoStack.isClean())},reportStatus:function(b,a,c){this._statusReporter&&this._statusReporter(b,a,c)},_getTooltipInfo:function(b,a){var c=this._textView,d=this.getAnnotationModel();if(!d)return null;var e=this._annotationStyler;if(!e)return null;var f=c.getOffsetAtLocation(b,a);if(f===-1)return null;f=this.mapOffset(f);e=e.getAnnotationsByType(d,f,f+1);d=[];for(f=0;f<e.length;f++)e[f].rangeStyle&&d.push(e[f]);if(d.length===0)return null;c=c.convert({x:b,
y:a},"document","page");return{contents:d,anchor:"left",x:c.x+10,y:c.y+20}},_highlightCurrentLine:function(b,a){var c=this._annotationModel;if(c){var d=this._textView;if(!d.getOptions("singleMode")){var e=d.getModel(),f=a?e.getLineAtOffset(a.start):-1,g=e.getLineAtOffset(b.start),d=b.start===b.end,q=!a||a.start===a.end,r=e.getLineStart(g),j=e.getLineEnd(g);e.getBaseModel&&(r=e.mapOffset(r),j=e.mapOffset(j));e=this._currentLineAnnotation;if(!(f===g&&q&&d&&e&&e.start===r&&e.end===j)){var f=e?[e]:null,
n;d&&(e=i.createAnnotation(i.ANNOTATION_CURRENT_LINE,r,j),n=[e]);this._currentLineAnnotation=e;c.replaceAnnotations(f,n)}}}},installTextView:function(){if(!this._textView){this._textView=this._textViewFactory();if(this._undoStackFactory)this._undoStack=this._undoStackFactory.createUndoStack(this);if(this._textDNDFactory)this._textDND=this._textDNDFactory.createTextDND(this,this._undoStack);if(this._contentAssistFactory)this._contentAssist=this._contentAssistFactory.createContentAssistMode(this).getContentAssist();
var b=this,a=this._textView,c=this;this._listener={onModelChanged:function(){c.checkDirty()},onMouseOver:function(a){c._listener.onMouseMove(a)},onMouseMove:function(d){var b=n.Tooltip.getTooltip(a);if(b&&!(c._listener.lastMouseX===d.event.clientX&&c._listener.lastMouseY===d.event.clientY))c._listener.lastMouseX=d.event.clientX,c._listener.lastMouseY=d.event.clientY,b.setTarget({x:d.x,y:d.y,getTooltipInfo:function(){return c._getTooltipInfo(this.x,this.y)}})},onMouseOut:function(d){var b=n.Tooltip.getTooltip(a);
if(b&&!(c._listener.lastMouseX===d.event.clientX&&c._listener.lastMouseY===d.event.clientY))c._listener.lastMouseX=d.event.clientX,c._listener.lastMouseY=d.event.clientY,b.setTarget(null)},onScroll:function(){var c=n.Tooltip.getTooltip(a);c&&c.setTarget(null,0,0)},onSelection:function(a){c._updateCursorStatus();c._highlightCurrentLine(a.newValue,a.oldValue)}};a.addEventListener("ModelChanged",this._listener.onModelChanged);a.addEventListener("Selection",this._listener.onSelection);a.addEventListener("MouseOver",
this._listener.onMouseOver);a.addEventListener("MouseOut",this._listener.onMouseOut);a.addEventListener("MouseMove",this._listener.onMouseMove);a.addEventListener("Scroll",this._listener.onScroll);if(this._keyBindingFactory){var d;if(d=typeof this._keyBindingFactory==="function"?this._keyBindingFactory(this,this.getKeyModes(),this._undoStack,this._contentAssist):this._keyBindingFactory.createKeyBindings(b,this._undoStack,this._contentAssist))this._textActions=d.textActions,this._linkedMode=d.linkedMode,
this._sourceCodeActions=d.sourceCodeActions}d=function(a){if(a!==void 0&&a!==-1){for(var c=this.getView().getModel(),d=this.getAnnotationModel(),e=b.mapOffset(c.getLineStart(a)),a=b.mapOffset(c.getLineEnd(a)),c=d.getAnnotations(e,a),f=null;c.hasNext();){var k=c.next();if(k.type===i.ANNOTATION_BOOKMARK){f=k;break}}f?d.removeAnnotation(f):(f=i.createAnnotation(i.ANNOTATION_BOOKMARK,e,a),f.title=void 0,d.addAnnotation(f))}};if(this._annotationFactory){var e=a.getModel();e.getBaseModel&&(e=e.getBaseModel());
if(this._annotationModel=this._annotationFactory.createAnnotationModel(e))if(e=this._annotationStyler=this._annotationFactory.createAnnotationStyler(a,this._annotationModel))e.addAnnotationType(i.ANNOTATION_CURRENT_SEARCH),e.addAnnotationType(i.ANNOTATION_MATCHING_SEARCH),e.addAnnotationType(i.ANNOTATION_ERROR),e.addAnnotationType(i.ANNOTATION_WARNING),e.addAnnotationType(i.ANNOTATION_MATCHING_BRACKET),e.addAnnotationType(i.ANNOTATION_CURRENT_BRACKET),e.addAnnotationType(i.ANNOTATION_CURRENT_LINE),
e.addAnnotationType(i.ANNOTATION_READ_OCCURRENCE),e.addAnnotationType(i.ANNOTATION_WRITE_OCCURRENCE),e.addAnnotationType(i.ANNOTATION_SELECTED_LINKED_GROUP),e.addAnnotationType(i.ANNOTATION_CURRENT_LINKED_GROUP),e.addAnnotationType(i.ANNOTATION_LINKED_GROUP),e.addAnnotationType("orion.annotation.highlightError");a.annotationModel=this._annotationModel;var e=this._annotationFactory.createAnnotationRulers(this._annotationModel),f=this._annotationRuler=e.annotationRuler;if(f)f.onDblClick=d,f.setMultiAnnotationOverlay({html:"<div class='annotationHTML overlay'></div>"}),
f.addAnnotationType(i.ANNOTATION_ERROR),f.addAnnotationType(i.ANNOTATION_WARNING),f.addAnnotationType(i.ANNOTATION_TASK),f.addAnnotationType(i.ANNOTATION_BOOKMARK);this.setAnnotationRulerVisible(this._annotationRulerVisible||this._annotationRulerVisible===void 0,!0);if(f=this._overviewRuler=e.overviewRuler)f.addAnnotationType(i.ANNOTATION_CURRENT_SEARCH),f.addAnnotationType(i.ANNOTATION_MATCHING_SEARCH),f.addAnnotationType(i.ANNOTATION_READ_OCCURRENCE),f.addAnnotationType(i.ANNOTATION_WRITE_OCCURRENCE),
f.addAnnotationType(i.ANNOTATION_CURRENT_BLAME),f.addAnnotationType(i.ANNOTATION_ERROR),f.addAnnotationType(i.ANNOTATION_WARNING),f.addAnnotationType(i.ANNOTATION_TASK),f.addAnnotationType(i.ANNOTATION_BOOKMARK),f.addAnnotationType(i.ANNOTATION_MATCHING_BRACKET),f.addAnnotationType(i.ANNOTATION_CURRENT_BRACKET),f.addAnnotationType(i.ANNOTATION_CURRENT_LINE);this.setOverviewRulerVisible(this._overviewRulerVisible||this._overviewRulerVisible===void 0,!0)}if(this._lineNumberRulerFactory)this._lineNumberRuler=
this._lineNumberRulerFactory.createLineNumberRuler(this._annotationModel),this._lineNumberRuler.addAnnotationType(i.ANNOTATION_CURRENT_BLAME),this._lineNumberRuler.addAnnotationType(i.ANNOTATION_BLAME),this._lineNumberRuler.onDblClick=d,this.setLineNumberRulerVisible(this._lineNumberRulerVisible||this._lineNumberRulerVisible===void 0,!0);if(this._foldingRulerFactory)this._foldingRuler=this._foldingRulerFactory.createFoldingRuler(this._annotationModel),this._foldingRuler.addAnnotationType(i.ANNOTATION_FOLDING),
this.setFoldingRulerVisible(this._foldingRulerVisible||this._foldingRulerVisible===void 0,!0);this.dispatchEvent({type:"TextViewInstalled",textView:a})}},uninstallTextView:function(){var b=this._textView;if(b)b.destroy(),this._textView=this._undoStack=this._textDND=this._contentAssist=this._listener=this._annotationModel=this._annotationStyler=this._annotationRuler=this._overviewRuler=this._lineNumberRuler=this._foldingRuler=this._currentLineAnnotation=this._title=null,this._dirty=!1,this._foldingRulerVisible=
this._overviewRulerVisible=this._lineNumberRulerVisible=this._annotationRulerVisible=void 0,this.dispatchEvent({type:"TextViewUninstalled",textView:b})},_updateCursorStatus:function(){var e=this.getModel(),a=this.getCaretOffset(),c=e.getLineAtOffset(a),e=e.getLineStart(c);a-=e;for(var e=this.getKeyModes(),d=0;d<e.length;d++){var f=e[d];if(f.isActive()&&f.isStatusActive&&f.isStatusActive())return}this.reportStatus(b.formatMessage(j.lineColumn,c+1,a+1))},showAnnotations:function(b,a,c,d){var e=this._annotationModel;
if(e){for(var f=[],g=[],q=e.getTextModel(),r=e.getAnnotations(0,q.getCharCount()),j;r.hasNext();)j=r.next(),a.indexOf(j.type)!==-1&&j.creatorID===this&&f.push(j);if(b)for(a=0;a<b.length;a++)if(j=b[a]){if(c)j=c(j);else{var n;typeof j.line==="number"?(n=q.getLineStart(j.line-1),r=n+j.start-1,n+=j.end):(r=j.start,n=j.end);var o=d(j);if(!o)continue;j=i.createAnnotation(o,r,n,j.description)}j.creatorID=this;g.push(j)}e.replaceAnnotations(f,g)}},showProblems:function(b){this.showAnnotations(b,[i.ANNOTATION_ERROR,
i.ANNOTATION_WARNING,i.ANNOTATION_TASK],null,function(a){switch(a.severity){case "error":return i.ANNOTATION_ERROR;case "warning":return i.ANNOTATION_WARNING;case "task":return i.ANNOTATION_TASK}return null})},showOccurrences:function(b){this.showAnnotations(b,[i.ANNOTATION_READ_OCCURRENCE,i.ANNOTATION_WRITE_OCCURRENCE],null,function(a){return a.readAccess?i.ANNOTATION_READ_OCCURRENCE:i.ANNOTATION_WRITE_OCCURRENCE})},showBlame:function(e){var a=this._blameRGB,c=this.getTextView().getOptions("parent").ownerDocument;
if(!a){var d=b.createElement(c,"div");d.className="annotation blame";c.body.appendChild(d);var k=(c.defaultView||c.parentWindow).getComputedStyle(d).getPropertyValue("background-color");d.parentNode.removeChild(d);var d=k.indexOf("("),m=k.indexOf(")"),k=k.substring(d+1,m);this._blameRGB=a=k.split(",").slice(0,3)}var p=function(){var a=g.AnnotationType.createAnnotation(this.groupType,this.start,this.end,this.title);a.style=f({},a.style);a.style.style=f({},a.style.style);a.style.style.backgroundColor=
"";this.groupAnnotation=a;a.blame=this.blame;a.html=this.html;return a},q=function(){var a=b.createElement(c,"div");a.className="tooltipTitle";var d=this.blame.Message.indexOf("\n");if(d===-1)d=this.blame.Message.length;var e=b.createElement(c,"a");e.href=this.blame.CommitLink;e.appendChild(c.createTextNode(this.blame.Message.substring(0,d)));a.appendChild(e);a.appendChild(b.createElement(c,"br"));a.appendChild(c.createTextNode(b.formatMessage(j.committerOnTime,this.blame.AuthorName,this.blame.Time)));
return a},r=this.getModel();this.showAnnotations(e,[i.ANNOTATION_BLAME],function(c){var d=r.getLineStart(c.Start-1),b=r.getLineEnd(c.End-1,!0),d=g.AnnotationType.createAnnotation(i.ANNOTATION_BLAME,d,b,q),b=a.slice(0);b.push(c.Shade);d.style=f({},d.style);d.style.style=f({},d.style.style);d.style.style.backgroundColor="rgba("+b.join()+")";d.groupId=c.Name;d.groupType=i.ANNOTATION_CURRENT_BLAME;d.createGroupAnnotation=p;d.html='<img class="annotationHTML blame" src="'+c.AuthorImage+'"/>';d.blame=c;
return d})},showSelection:function(b,a,c,d,e){typeof b==="number"?(typeof a!=="number"&&(a=b),this.moveSelection(b,a)):typeof c==="number"&&(b=this.getModel().getLineStart(c-1),typeof d==="number"&&(b+=d),typeof e!=="number"&&(e=0),this.moveSelection(b,b+e))},setInput:function(b,a,c,d){this._title=b;this._textView&&(d||(a?this._textView.setText(a):c!==null&&c!==void 0&&(this._textView.setText(c),this._textView.getModel().setLineDelimiter("auto"),this._highlightCurrentLine(this._textView.getSelection())),
this._undoStack.reset(),this._textView.focus()),this.checkDirty());this.onInputChanged({type:"InputChanged",title:b,message:a,contents:c,contentsSaved:d})},onInputChanged:function(b){return this.dispatchEvent(b)},onGotoLine:function(b,a,c,d){if(this._textView){var e=this.getModel(),b=Math.max(0,Math.min(b,e.getLineCount()-1)),f=e.getLineStart(b),g=0;c===void 0&&(c=0);typeof a==="string"?(b=e.getLine(b).indexOf(a),b!==-1&&(g=b,c=g+a.length)):(g=a,a=e.getLineEnd(b)-f,g=Math.min(g,a),c=Math.min(c,a));
this.moveSelection(f+g,f+c,d)}},onDirtyChanged:function(b){return this.dispatchEvent(b)}};o.EventTarget.addMixin(e.prototype);return{Editor:e}});define("orion/regex",[],function(){return{escape:function(j){return j.replace(/([\\$\^*\/+?\.\(\)|{}\[\]])/g,"\\$&")},parse:function(j){return(j=/^\s*\/(.+)\/([gim]{0,3})\s*$/.exec(j))?{pattern:j[1],flags:j[2]}:null}}});
define("orion/objects",[],function(){function j(j){for(var n=1;n<arguments.length;n++){var g=arguments[n],b;for(b in g)g.hasOwnProperty(b)&&(j[b]=g[b])}}return{clone:function(o){if(Array.isArray(o))return Array.prototype.slice.call(o);var n=Object.create(Object.getPrototypeOf(o));j(n,o);return n},mixin:j}});
define("orion/editor/find","i18n!orion/editor/nls/messages,orion/keyBinding,orion/editor/keyModes,orion/editor/annotations,orion/regex,orion/objects,orion/util".split(","),function(j,o,n,g,b,f,e){function i(a){var d=a.getTextView();n.KeyMode.call(this,d);this.editor=a;this._active=!1;this._success=!0;this._ignoreSelection=!1;this._prefix="";d.setAction("incrementalFindCancel",function(){this.setActive(!1);return!0}.bind(this));d.setAction("incrementalFindBackspace",function(){return this._backspace()}.bind(this));
var e=this;this._listener={onVerify:function(a){var c=e.editor,d=c.getModel(),h=c.mapOffset(a.start),c=c.mapOffset(a.end),d=d.getText(h,c);if((d=e._prefix.match(RegExp("^"+b.escape(d),"i")))&&d.length>0)e._prefix+=a.text,e._success=!0,e._status(),e.find(e._forward,!0),a.text=null},onSelection:function(){e._ignoreSelection||e.setActive(!1)}}}function h(a,d,b){if(a){this._editor=a;this._undoStack=d;this._showAll=!0;this._visible=!1;this._wrap=this._caseInsensitive=!0;this._wholeWord=!1;this._incremental=
!0;this._regex=!1;this._findAfterReplace=!0;this._reverse=this._hideAfterFind=!1;this._timer=this._end=this._start=void 0;this._lastString="";var e=this;this._listeners={onEditorFocus:function(a){e._removeCurrentAnnotation(a)}};this.setOptions(b)}}var a={};i.prototype=new n.KeyMode;f.mixin(i.prototype,{createKeyBindings:function(){var a=o.KeyBinding,d=[];d.push({actionID:"incrementalFindBackspace",keyBinding:new a(8)});d.push({actionID:"incrementalFindCancel",keyBinding:new a(13)});d.push({actionID:"incrementalFindCancel",
keyBinding:new a(27)});d.push({actionID:"incrementalFindReverse",keyBinding:new a(38)});d.push({actionID:"incrementalFind",keyBinding:new a(40)});d.push({actionID:"incrementalFindReverse",keyBinding:new a("k",!0,!0)});d.push({actionID:"incrementalFind",keyBinding:new a("k",!0)});return d},find:function(a,d){this._forward=a;if(!this.isActive())return this.setActive(!0),!1;var b=this._prefix;if(b.length===0)return!1;var e=this.editor,h=e.getModel(),h=a?this._success?d?this._start:e.getCaretOffset()+
1:0:this._success?d?this._start:e.getCaretOffset():h.getCharCount()-1;if(b=e.getModel().find({string:b,start:h,reverse:!a,caseInsensitive:b.toLowerCase()===b}).next()){if(!d)this._start=h;this._ignoreSelection=this._success=!0;e.moveSelection(a?b.start:b.end,a?b.end:b.start);this._ignoreSelection=!1}else this._success=!1;this._status();return!0},isActive:function(){return this._active},isStatusActive:function(){return this.isActive()},setActive:function(a){if(this._active!==a)this._active=a,this._prefix=
"",this._success=!0,a=this.editor.getTextView(),this._start=this.editor.getCaretOffset(),this.editor.setCaretOffset(this._start),this._active?(a.addEventListener("Verify",this._listener.onVerify),a.addEventListener("Selection",this._listener.onSelection),a.addKeyMode(this)):(a.removeEventListener("Verify",this._listener.onVerify),a.removeEventListener("Selection",this._listener.onSelection),a.removeKeyMode(this)),this._status()},_backspace:function(){var a=this._prefix,a=this._prefix=a.substring(0,
a.length-1);return a.length===0?(this._ignoreSelection=this._success=!0,this.editor.setCaretOffset(this.editor.getSelection().start),this._ignoreSelection=!1,this._status(),!0):this.find(this._forward,!0)},_status:function(){if(this.isActive()){var a;a=this._forward?this._success?j.incrementalFindStr:j.incrementalFindStrNotFound:this._success?j.incrementalFindReverseStr:j.incrementalFindReverseStrNotFound;a=e.formatMessage(a,this._prefix);this.editor.reportStatus(a,this._success?"":"error")}else this.editor.reportStatus("")}});
a.IncrementalFind=i;h.prototype={find:function(a,d,b){this.setOptions({reverse:!a});var e=this.getFindString(),h;if(d)e=d.findString||e,h=d.count;a=this.getOptions();this.setOptions(d);d=b?this._startOffset:this.getStartOffset();if((h=this._doFind(e,d,h))&&!b)this._startOffset=h.start;this.setOptions(a);this._hideAfterFind&&this.hide();return h},getStartOffset:function(){return this._start!==void 0?this._start:this._reverse?this._editor.getSelection().start-1:this._editor.getCaretOffset()},getFindString:function(){var a=
this._editor.getSelection();return this._editor.getText(a.start,a.end)||this._lastString},getOptions:function(){return{showAll:this._showAll,caseInsensitive:this._caseInsensitive,wrap:this._wrap,wholeWord:this._wholeWord,incremental:this._incremental,regex:this._regex,findAfterReplace:this._findAfterReplace,hideAfterFind:this._hideAfterFind,reverse:this._reverse,findCallback:this._findCallback,start:this._start,end:this._end}},getReplaceString:function(){return""},hide:function(){this._visible=!1;
if(this._savedOptions&&(this.setOptions(this._savedOptions.pop()),this._savedOptions.length===0))this._savedOptions=null;this._removeAllAnnotations();var a=this._editor.getTextView();a&&(a.removeEventListener("Focus",this._listeners.onEditorFocus),a.focus())},isVisible:function(){return this._visible},replace:function(){var a=this.getFindString();if(a){var d=this._editor,b=this.getReplaceString(),e=d.getSelection().start;if(d=d.getModel().find({string:a,start:e,reverse:!1,wrap:this._wrap,regex:this._regex,
wholeWord:this._wholeWord,caseInsensitive:this._caseInsensitive}).next())this.startUndo(),this._doReplace(d.start,d.end,a,b),this.endUndo()}this._findAfterReplace&&a&&this._doFind(a,this.getStartOffset())},replaceAll:function(){var a=this.getFindString();if(a){this._replacingAll=!0;var d=this._editor,b=d.getTextView();d.reportStatus(j.replaceAll);var h=this.getReplaceString(),f=this;window.setTimeout(function(){for(var g=0,i=0;;){var s=f._doFind(a,g,null,!0);if(!s)break;i++;i===1&&(b.setRedraw(!1),
f.startUndo());f._doReplace(s.start,s.end,a,h);g=f.getStartOffset()}i>0&&(f.endUndo(),b.setRedraw(!0));g>0?d.reportStatus(e.formatMessage(j.replacedMatches,i)):d.reportStatus(j.nothingReplaced,"error");f._replacingAll=!1},100)}},setOptions:function(a){if(a){if((a.showAll===!0||a.showAll===!1)&&this._showAll!==a.showAll)if(this._showAll=a.showAll,this.isVisible())if(this._showAll)this._markAllOccurrences();else{var d=this._editor.getAnnotationModel();d&&d.removeAnnotations(g.AnnotationType.ANNOTATION_MATCHING_SEARCH)}if(a.caseInsensitive===
!0||a.caseInsensitive===!1)this._caseInsensitive=a.caseInsensitive;if(a.wrap===!0||a.wrap===!1)this._wrap=a.wrap;if(a.wholeWord===!0||a.wholeWord===!1)this._wholeWord=a.wholeWord;if(a.incremental===!0||a.incremental===!1)this._incremental=a.incremental;if(a.regex===!0||a.regex===!1)this._regex=a.regex;if(a.findAfterReplace===!0||a.findAfterReplace===!1)this._findAfterReplace=a.findAfterReplace;if(a.hideAfterFind===!0||a.hideAfterFind===!1)this._hideAfterFind=a.hideAfterFind;if(a.reverse===!0||a.reverse===
!1)this._reverse=a.reverse;if(a.hasOwnProperty("findCallback"))this._findCallback=a.findCallback;if(a.hasOwnProperty("start"))this._start=a.start;if(a.hasOwnProperty("end"))this._end=a.end}},show:function(a){this._visible=!0;if(a){if(!this._savedOptions)this._savedOptions=[];this._savedOptions.push(this.getOptions());this.setOptions(a)}this._startOffset=this._editor.getSelection().start;this._editor.getTextView().addEventListener("Focus",this._listeners.onEditorFocus);var d=this;window.setTimeout(function(){d._incremental&&
d.find(!0,null,!0)},0)},startUndo:function(){this._undoStack&&this._undoStack.startCompoundChange()},endUndo:function(){this._undoStack&&this._undoStack.endCompoundChange()},_doFind:function(a,d,b,e){var b=b||1,h=this._editor;if(!a)return this._removeAllAnnotations(),null;this._lastString=a;for(var a=h.getModel().find({string:a,start:d,end:this._end,reverse:this._reverse,wrap:e?!1:this._wrap,regex:this._regex,wholeWord:this._wholeWord,caseInsensitive:this._caseInsensitive}),f,d=0;d<b&&a.hasNext();d++)f=
a.next();if(!this._replacingAll){f?this._editor.reportStatus(""):this._editor.reportStatus(j.notFound,"error");if(this.isVisible()){b=g.AnnotationType.ANNOTATION_CURRENT_SEARCH;if(a=h.getAnnotationModel())a.removeAnnotations(b),f&&a.addAnnotation(g.AnnotationType.createAnnotation(b,f.start,f.end));if(this._showAll){this._timer&&window.clearTimeout(this._timer);var i=this;this._timer=window.setTimeout(function(){i._markAllOccurrences();i._timer=null},500)}}this._findCallback?this._findCallback(f):
f&&h.moveSelection(f.start,f.end,null,!1)}return f},_doReplace:function(a,d,b,e){var h=this._editor;if(this._regex&&(e=h.getText(a,d).replace(RegExp(b,this._caseInsensitive?"i":""),e),!e))return;h.setText(e,a,d);h.setSelection(a,a+e.length,!0)},_markAllOccurrences:function(){var a=this._editor.getAnnotationModel();if(a){for(var d=g.AnnotationType.ANNOTATION_MATCHING_SEARCH,b=a.getAnnotations(0,a.getTextModel().getCharCount()),e=[],h;b.hasNext();){var f=b.next();f.type===d&&e.push(f)}if(this.isVisible()){b=
this.getFindString();b=this._editor.getModel().find({string:b,regex:this._regex,wholeWord:this._wholeWord,caseInsensitive:this._caseInsensitive});for(h=[];b.hasNext();)f=b.next(),h.push(g.AnnotationType.createAnnotation(d,f.start,f.end))}a.replaceAnnotations(e,h)}},_removeAllAnnotations:function(){var a=this._editor.getAnnotationModel();a&&(a.removeAnnotations(g.AnnotationType.ANNOTATION_CURRENT_SEARCH),a.removeAnnotations(g.AnnotationType.ANNOTATION_MATCHING_SEARCH))},_removeCurrentAnnotation:function(){var a=
this._editor.getAnnotationModel();a&&a.removeAnnotations(g.AnnotationType.ANNOTATION_CURRENT_SEARCH)}};a.Find=h;return a});
define("orion/editor/actions","i18n!orion/editor/nls/messages,orion/keyBinding,orion/editor/annotations,orion/editor/tooltip,orion/editor/find,orion/util".split(","),function(j,o,n,g,b,f){function e(a,c,d){this.editor=a;this.undoStack=c;this._incrementalFind=new b.IncrementalFind(a);this._find=d?d:new b.Find(a,c);this._lastEditLocation=null;this.init()}function i(a,c,d,b){this.editor=a;this.undoStack=c;this.contentAssist=d;this.linkedMode=b;this.contentAssist&&this.contentAssist.addEventListener("ProposalApplied",
this.contentAssistProposalApplied.bind(this));this.init()}var h={};e.prototype={init:function(){var a=this.editor.getTextView();this._lastEditListener={onModelChanged:function(a){if(this.editor.isDirty())this._lastEditLocation=a.start+a.addedCharCount}.bind(this)};a.addEventListener("ModelChanged",this._lastEditListener.onModelChanged);a.setAction("undo",function(){return this.undoStack?(this.undoStack.undo(),!0):!1}.bind(this),{name:j.undo});a.setAction("redo",function(){return this.undoStack?(this.undoStack.redo(),
!0):!1}.bind(this),{name:j.redo});a.setKeyBinding(new o.KeyBinding("f",!0),"find");a.setAction("find",function(){if(this._find){var a=this.editor.getSelection();(a=prompt(j.find,this.editor.getText(a.start,a.end)))&&this._find.find(!0,{findString:a})}}.bind(this),{name:j.find});a.setKeyBinding(new o.KeyBinding("k",!0),"findNext");a.setAction("findNext",function(a){return this._find?(this._find.find(!0,a),!0):!1}.bind(this),{name:j.findNext});a.setKeyBinding(new o.KeyBinding("k",!0,!0),"findPrevious");
a.setAction("findPrevious",function(a){return this._find?(this._find.find(!1,a),!0):!1}.bind(this),{name:j.findPrevious});a.setKeyBinding(new o.KeyBinding("j",!0),"incrementalFind");a.setAction("incrementalFind",function(){this._incrementalFind&&this._incrementalFind.find(!0);return!0}.bind(this),{name:j.incrementalFind});a.setKeyBinding(new o.KeyBinding("j",!0,!0),"incrementalFindReverse");a.setAction("incrementalFindReverse",function(){this._incrementalFind&&this._incrementalFind.find(!1);return!0}.bind(this),
{name:j.incrementalFindReverse});a.setAction("tab",function(){return this.indentLines()}.bind(this));a.setAction("shiftTab",function(){return this.unindentLines()}.bind(this),{name:j.unindentLines});a.setKeyBinding(new o.KeyBinding(38,!1,!1,!0),"moveLinesUp");a.setAction("moveLinesUp",function(){return this.moveLinesUp()}.bind(this),{name:j.moveLinesUp});a.setKeyBinding(new o.KeyBinding(40,!1,!1,!0),"moveLinesDown");a.setAction("moveLinesDown",function(){return this.moveLinesDown()}.bind(this),{name:j.moveLinesDown});
a.setKeyBinding(new o.KeyBinding(38,!0,!1,!0),"copyLinesUp");a.setAction("copyLinesUp",function(){return this.copyLinesUp()}.bind(this),{name:j.copyLinesUp});a.setKeyBinding(new o.KeyBinding(40,!0,!1,!0),"copyLinesDown");a.setAction("copyLinesDown",function(){return this.copyLinesDown()}.bind(this),{name:j.copyLinesDown});a.setKeyBinding(new o.KeyBinding("d",!0,!1,!1),"deleteLines");a.setAction("deleteLines",function(a){return this.deleteLines(a)}.bind(this),{name:j.deleteLines});a.setKeyBinding(new o.KeyBinding("l",
!f.isMac,!1,!1,f.isMac),"gotoLine");a.setAction("gotoLine",function(){return this.gotoLine()}.bind(this),{name:j.gotoLine});a.setKeyBinding(new o.KeyBinding(190,!0),"nextAnnotation");a.setAction("nextAnnotation",function(){return this.nextAnnotation(!0)}.bind(this),{name:j.nextAnnotation});a.setKeyBinding(new o.KeyBinding(188,!0),"previousAnnotation");a.setAction("previousAnnotation",function(){return this.nextAnnotation(!1)}.bind(this),{name:j.prevAnnotation});a.setKeyBinding(new o.KeyBinding("e",
!0,!1,!0,!1),"expand");a.setAction("expand",function(){return this.expandAnnotation(!0)}.bind(this),{name:j.expand});a.setKeyBinding(new o.KeyBinding("c",!0,!1,!0,!1),"collapse");a.setAction("collapse",function(){return this.expandAnnotation(!1)}.bind(this),{name:j.collapse});a.setKeyBinding(new o.KeyBinding("e",!0,!0,!0,!1),"expandAll");a.setAction("expandAll",function(){return this.expandAnnotations(!0)}.bind(this),{name:j.expandAll});a.setKeyBinding(new o.KeyBinding("c",!0,!0,!0,!1),"collapseAll");
a.setAction("collapseAll",function(){return this.expandAnnotations(!1)}.bind(this),{name:j.collapseAll});a.setKeyBinding(new o.KeyBinding("q",!f.isMac,!1,!1,f.isMac),"lastEdit");a.setAction("lastEdit",function(){return this.gotoLastEdit()}.bind(this),{name:j.lastEdit})},copyLinesDown:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var c=a.getModel(),d=a.getSelection(),b=c.getLineAtOffset(d.start),d=c.getLineAtOffset(d.end>d.start?d.end-1:d.end),e=c.getLineStart(b),
b=c.getLineEnd(d,!0),h=c.getLineCount(),f="",e=c.getText(e,b);d===h-1&&(e=(f=c.getLineDelimiter())+e);a.setText(e,b,b);a.setSelection(b+f.length,b+e.length);return!0},copyLinesUp:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var c=a.getModel(),d=a.getSelection(),b=c.getLineAtOffset(d.start),d=c.getLineAtOffset(d.end>d.start?d.end-1:d.end),b=c.getLineStart(b),e=c.getLineEnd(d,!0),h=c.getLineCount(),f="",e=c.getText(b,e);d===h-1&&(e+=f=c.getLineDelimiter());a.setText(e,
b,b);a.setSelection(b,b+e.length-f.length);return!0},deleteLines:function(a){var c=this.editor;if(c.getTextView().getOptions("readonly"))return!1;var d=1;if(a&&a.count)d=a.count;var b=c.getSelection(),e=c.getModel(),h=e.getLineAtOffset(b.start),a=e.getLineStart(h),d=b.start!==b.end||d===1?e.getLineAtOffset(b.end>b.start?b.end-1:b.end):Math.min(h+d-1,e.getLineCount()-1),d=e.getLineEnd(d,!0);c.setText("",a,d);return!0},expandAnnotation:function(a){var c=this.editor,d=c.getAnnotationModel();if(!d)return!0;
var b=c.getModel(),e=c.getCaretOffset(),h=b.getLineAtOffset(e),e=b.getLineStart(h),h=b.getLineEnd(h,!0);b.getBaseModel&&(e=b.mapOffset(e),h=b.mapOffset(h),b.getBaseModel());for(var f,b=d.getAnnotations(e,h);!f&&b.hasNext();)e=b.next(),e.type===n.AnnotationType.ANNOTATION_FOLDING&&(f=e);f&&a!==f.expanded&&(a?f.expand():(c.setCaretOffset(f.start),f.collapse()),d.modifyAnnotation(f));return!0},expandAnnotations:function(a){var c=this.editor,d=c.getTextView(),b=c.getAnnotationModel();if(!b)return!0;var c=
c.getModel(),e=b.getAnnotations(0,c.getCharCount());for(d.setRedraw(!1);e.hasNext();)c=e.next(),c.type===n.AnnotationType.ANNOTATION_FOLDING&&a!==c.expanded&&(a?c.expand():c.collapse(),b.modifyAnnotation(c));d.setRedraw(!0);return!0},indentLines:function(){var a=this.editor,c=a.getTextView();if(c.getOptions("readonly"))return!1;if(c.getOptions("tabMode")){var d=a.getModel(),b=a.getSelection(),e=d.getLineAtOffset(b.start),h=d.getLineAtOffset(b.end>b.start?b.end-1:b.end);if(e!==h){var f=[];f.push("");
for(var g=e;g<=h;g++)f.push(d.getLine(g,!0));g=d.getLineStart(e);d=d.getLineEnd(h,!0);c=c.getOptions("tabSize","expandTab");c=c.expandTab?Array(c.tabSize+1).join(" "):"\t";a.setText(f.join(c),g,d);a.setSelection(g===b.start?b.start:b.start+c.length,b.end+(h-e+1)*c.length);return!0}return!1}},gotoLastEdit:function(){typeof this._lastEditLocation==="number"&&this.editor.showSelection(this._lastEditLocation);return!0},gotoLine:function(){var a=this.editor,c=a.getModel().getLineAtOffset(a.getCaretOffset());
if(c=prompt(j.gotoLinePrompty,c+1))c=parseInt(c,10),a.onGotoLine(c-1,0);return!0},moveLinesDown:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var c=a.getModel(),d=a.getSelection(),b=c.getLineAtOffset(d.start),e=c.getLineAtOffset(d.end>d.start?d.end-1:d.end),h=c.getLineCount();if(e===h-1)return!0;var b=c.getLineStart(b),d=c.getLineEnd(e,!0),f=c.getLineEnd(e+1,!0)-(d-b),g=0;e!==h-2?c=c.getText(b,d):(e=c.getLineEnd(e),c=c.getText(e,d)+c.getText(b,e),g+=d-e);this.startUndo();
a.setText("",b,d);a.setText(c,f,f);a.setSelection(f+g,f+g+c.length);this.endUndo();return!0},moveLinesUp:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var c=a.getModel(),d=a.getSelection(),b=c.getLineAtOffset(d.start);if(b===0)return!0;var e=c.getLineAtOffset(d.end>d.start?d.end-1:d.end),h=c.getLineCount(),d=c.getLineStart(b-1),f=c.getLineStart(b),g=c.getLineEnd(e,!0),i=c.getText(f,g),j=0;e===h-1&&(e=c.getLineEnd(b-1),b=c.getLineEnd(b-1,!0),i+=c.getText(e,b),f=e,
j=b-e);this.startUndo();a.setText("",f,g);a.setText(i,d,d);a.setSelection(d,d+i.length-j);this.endUndo();return!0},nextAnnotation:function(a){var c=this.editor,b=c.getAnnotationModel();if(!b)return!0;var e=c.getAnnotationStyler();if(!e)return!0;for(var h=c.getModel(),f=c.getCaretOffset(),b=b.getAnnotations(a?f:0,a?h.getCharCount():f),i=null;b.hasNext();){var j=b.next();if(a){if(j.start<=f)continue}else if(j.start>=f)continue;if(j.rangeStyle&&e.isAnnotationTypeVisible(j.type)&&(i=j,a))break}if(i){var s=
c.getTextView(),n=h.getLineAtOffset(i.start),o=g.Tooltip.getTooltip(s);if(!o)return c.moveSelection(i.start),!0;c.moveSelection(i.start,i.start,function(){o.setTarget({getTooltipInfo:function(){var a=s.convert({x:s.getLocationAtOffset(i.start).x,y:s.getLocationAtOffset(h.getLineStart(n)).y},"document","page");return{contents:[i],x:a.x,y:a.y+Math.floor(s.getLineHeight(n)*1.33)}}},0)})}return!0},unindentLines:function(){var a=this.editor,c=a.getTextView();if(c.getOptions("readonly"))return!1;if(c.getOptions("tabMode")){for(var b=
a.getModel(),e=a.getSelection(),h=b.getLineAtOffset(e.start),f=b.getLineAtOffset(e.end>e.start?e.end-1:e.end),g=c.getOptions("tabSize"),i=Array(g+1).join(" "),j=[],n=c=0,o=h;o<=f;o++){var v=b.getLine(o,!0);if(b.getLineStart(o)!==b.getLineEnd(o))if(v.indexOf("\t")===0)v=v.substring(1),c++;else if(v.indexOf(i)===0)v=v.substring(g),c+=g;else return!0;o===h&&(n=c);j.push(v)}h=b.getLineStart(h);g=b.getLineEnd(f,!0);b=b.getLineStart(f);a.setText(j.join(""),h,g);f=h===e.start?e.start:e.start-n;e=Math.max(f,
e.end-c+(e.end===b+1&&e.start!==e.end?1:0));a.setSelection(f,e);return!0}},startUndo:function(){this.undoStack&&this.undoStack.startCompoundChange()},endUndo:function(){this.undoStack&&this.undoStack.endCompoundChange()}};h.TextActions=e;i.prototype={init:function(){var a=this.editor.getTextView();a.setAction("lineStart",function(){return this.lineStart()}.bind(this));a.setAction("enter",function(){return this.autoIndent()}.bind(this));a.setKeyBinding(new o.KeyBinding("t",!0,!1,!0),"trimTrailingWhitespaces");
a.setAction("trimTrailingWhitespaces",function(){return this.trimTrailingWhitespaces()}.bind(this),{name:j.trimTrailingWhitespaces});a.setKeyBinding(new o.KeyBinding(191,!0),"toggleLineComment");a.setAction("toggleLineComment",function(){return this.toggleLineComment()}.bind(this),{name:j.toggleLineComment});a.setKeyBinding(new o.KeyBinding(191,!0,!f.isMac,!1,f.isMac),"addBlockComment");a.setAction("addBlockComment",function(){return this.addBlockComment()}.bind(this),{name:j.addBlockComment});a.setKeyBinding(new o.KeyBinding(220,
!0,!f.isMac,!1,f.isMac),"removeBlockComment");a.setAction("removeBlockComment",function(){return this.removeBlockComment()}.bind(this),{name:j.removeBlockComment});a.setKeyBinding(new o.KeyBinding("[",!1,!1,!1,!1,"keypress"),"autoPairSquareBracket");a.setAction("autoPairSquareBracket",function(){return this.autoPairBrackets("[","]")}.bind(this));a.setKeyBinding(new o.KeyBinding("]",!1,!1,!1,!1,"keypress"),"skipClosingSquareBracket");a.setAction("skipClosingSquareBracket",function(){return this.skipClosingBracket("]")}.bind(this));
a.setKeyBinding(new o.KeyBinding("(",!1,!1,!1,!1,"keypress"),"autoPairParentheses");a.setAction("autoPairParentheses",function(){return this.autoPairBrackets("(",")")}.bind(this));a.setKeyBinding(new o.KeyBinding(")",!1,!1,!1,!1,"keypress"),"skipClosingParenthesis");a.setAction("skipClosingParenthesis",function(){return this.skipClosingBracket(")")}.bind(this));a.setKeyBinding(new o.KeyBinding("{",!1,!1,!1,!1,"keypress"),"autoPairBraces");a.setAction("autoPairBraces",function(){return this.autoPairBrackets("{",
"}")}.bind(this));a.setKeyBinding(new o.KeyBinding("}",!1,!1,!1,!1,"keypress"),"skipClosingBrace");a.setAction("skipClosingBrace",function(){return this.skipClosingBracket("}")}.bind(this));a.setKeyBinding(new o.KeyBinding("'",!1,!1,!1,!1,"keypress"),"autoPairSingleQuotation");a.setAction("autoPairSingleQuotation",function(){return this.autoPairQuotations("'")}.bind(this));a.setKeyBinding(new o.KeyBinding('"',!1,!1,!1,!1,"keypress"),"autoPairDblQuotation");a.setAction("autoPairDblQuotation",function(){return this.autoPairQuotations('"')}.bind(this));
a.setAction("deletePrevious",function(){return this.deletePrevious()}.bind(this))},autoIndent:function(){var a=this.editor,c=a.getTextView();if(c.getOptions("readonly"))return!1;var b=a.getSelection();if(b.start===b.end){for(var e=a.getModel(),h=e.getLineAtOffset(b.start),f=e.getLine(h,!1),g=e.getLineStart(h),i=0,j=b.start-g,n;i<j&&((n=f.charCodeAt(i))===32||n===9);)i++;var g=f.substring(0,i),c=c.getOptions("tabSize","expandTab"),o=c.expandTab?Array(c.tabSize+1).join(" "):"\t",c=e.getLineDelimiter(),
v=/^[\s]*\/\*[\*]*[\s]*$/,l=/^[\s]*\*/,t=/\*\/[\s]*$/,x=f.substring(0,j),y=f.substring(j),B=x.trimRight().length-1;if(this.smartIndentation&&f.charCodeAt(B)===123)return e=j-B-1,y=y.length-y.trimLeft().length,f=f.charCodeAt(j+y)===125?c+g+o+c+g:c+g+o,a.setText(f,b.start-e,b.end+y),a.setCaretOffset(b.start+c.length+g.length+o.length-e),!0;else if(!t.test(x)&&(v.test(x)||l.test(x))){if(i=v.exec(x)){f=c+g+" * ";f+=t.test(y)?y.substring(0,y.length-2).trim():y.trim();if(e.getLineCount()===h+1||!l.test(e.getLine(h+
1)))f+=c+g+" */";a.setText(f,b.start,b.end+y.length);a.setCaretOffset(b.start+c.length+g.length+3);return!0}if(i=l.exec(x))for(h-=1;h>=0;h--)if(i=e.getLine(h,!1),v.test(i))return t.test(y)||f.charCodeAt(j)===47?(f=c+g+"*"+y,g=b.start+c.length+g.length+1):(f=c+g+"* "+y,g=b.start+c.length+g.length+2),a.setText(f,b.start,b.end+y.length),a.setCaretOffset(g),!0;else if(!l.test(i))break}else if(t.test(x))return f=f.substring(b.start)+c+g.substring(0,g.length-1),a.setText(f,b.start,b.end),a.setCaretOffset(b.start+
f.length),!0;else if(i>0){for(i=j;i<f.length&&((n=f.charCodeAt(i++))===32||n===9);)b.end++;a.setText(e.getLineDelimiter()+g,b.start,b.end);return!0}}return!1},addBlockComment:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var c=a.getModel(),b=a.getSelection(),e=this._findEnclosingComment(c,b.start,b.end);if(e.commentStart!==void 0&&e.commentEnd!==void 0)return!0;c=c.getText(b.start,b.end);if(c.length===0)return!0;var e=c.length,c=c.replace(/\/\*|\*\//g,""),f=c.length;
a.setText("/*"+c+"*/",b.start,b.end);a.setSelection(b.start+2,b.end+2+(f-e));return!0},autoPairBrackets:function(a,c){if(!this.autoPairing)return!1;var b=this.editor;if(b.getTextView().getOptions("readonly"))return!1;var e=b.getSelection(),f=b.getModel(),h=b.getCaretOffset()===f.getCharCount()?"":f.getText(e.start,e.start+1).trim(),g=/^$|[)}\]>]/;if(e.start===e.end&&g.test(h))return b.setText(a+c,e.start,e.start),b.setCaretOffset(e.start+1),!0;else if(e.start!==e.end)return f=f.getText(e.start,e.end),
b.setText(a+f+c,e.start,e.end),b.setSelection(e.start+1,e.end+1),!0;return!1},autoPairQuotations:function(a){if(!this.autoPairing)return!1;var c=this.editor;if(c.getTextView().getOptions("readonly"))return!1;var b=c.getSelection(),e=c.getModel(),f=c.getCaretOffset(),h=f===0?"":e.getText(b.start-1,b.start).trim(),g=f===e.getCharCount()?"":e.getText(b.start,b.start+1).trim(),f=/^"$|^'$/,i=/\w/,j=/^$|[)}\]>]/;if(b.start!==b.end){e=e.getText(b.start,b.end);if(f.test(e))return!1;c.setText(a+e+a,b.start,
b.end);c.setSelection(b.start+1,b.end+1)}else if(g===a)c.setCaretOffset(b.start+1);else if(h===a||f.test(g)||i.test(h)||!j.test(g))return!1;else c.setText(a+a,b.start,b.start),c.setCaretOffset(b.start+1);return!0},contentAssistProposalApplied:function(a){a=a.data.proposal;if(a.positions&&a.positions.length>0&&this.linkedMode){for(var c=[],b=0;b<a.positions.length;++b)c[b]={positions:[{offset:a.positions[b].offset,length:a.positions[b].length}]};this.linkedMode.enterLinkedMode({groups:c,escapePosition:a.escapePosition})}else a.groups&&
a.groups.length>0&&this.linkedMode?this.linkedMode.enterLinkedMode({groups:a.groups,escapePosition:a.escapePosition}):a.escapePosition&&this.editor.getTextView().setCaretOffset(a.escapePosition);return!0},deletePrevious:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var c=a.getSelection(),b=a.getModel(),e=a.getCaretOffset(),f=e===0?"":b.getText(c.start-1,c.start),b=e===b.getCharCount()?"":b.getText(c.start,c.start+1);(f==="("&&b===")"||f==="["&&b==="]"||f==="{"&&b===
"}"||f==="<"&&b===">"||f==='"'&&b==='"'||f==="'"&&b==="'")&&a.setText("",c.start,c.start+1);return!1},_findEnclosingComment:function(a,c,b){var e=a.getLineAtOffset(c),f=a.getLineAtOffset(b),h,g,i,j,n,o;for(h=e;h>=0;h--)if(g=a.getLine(h),i=h===e?c-a.getLineStart(e):g.length,j=g.lastIndexOf("/*",i),g=g.lastIndexOf("*/",i),g>j)break;else if(j!==-1){n=a.getLineStart(h)+j;break}for(h=f;h<a.getLineCount();h++)if(g=a.getLine(h),i=h===f?b-a.getLineStart(f):0,j=g.indexOf("/*",i),g=g.indexOf("*/",i),j!==-1&&
j<g)break;else if(g!==-1){o=a.getLineStart(h)+g;break}return{commentStart:n,commentEnd:o}},lineStart:function(){for(var a=this.editor,c=a.getModel(),b=a.getCaretOffset(),e=c.getLineAtOffset(b),f=c.getLineStart(e),c=c.getLine(e),e=0;e<c.length;e++){var h=c.charCodeAt(e);if(!(h===32||h===9))break}e+=f;return b!==e?(a.setSelection(e,e),!0):!1},removeBlockComment:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var c=a.getModel(),b=a.getSelection(),e=c.getText(b.start,b.end),
f,h,g;for(g=0;g<e.length;g++)if(e.substring(g,g+2)==="/*"){f=b.start+g;break}for(;g<e.length;g++)if(e.substring(g,g+2)==="*/"){h=b.start+g;break}if(f!==void 0&&h!==void 0)a.setText(c.getText(f+2,h),f,h+2),a.setSelection(f,h);else{e=this._findEnclosingComment(c,b.start,b.end);if(e.commentStart===void 0||e.commentEnd===void 0)return!0;c=c.getText(e.commentStart+2,e.commentEnd);a.setText(c,e.commentStart,e.commentEnd+2);a.setSelection(b.start-2,b.end-2)}return!0},toggleLineComment:function(){var a=this.editor;
if(a.getTextView().getOptions("readonly"))return!1;for(var c=a.getModel(),b=a.getSelection(),e=c.getLineAtOffset(b.start),f=c.getLineAtOffset(b.end>b.start?b.end-1:b.end),h=!0,g=[],i,j,n=e;n<=f;n++)if(i=c.getLine(n,!0),g.push(i),!h||(j=i.indexOf("//"))===-1)h=!1;else if(j!==0){var o;for(o=0;o<j;o++)if(h=i.charCodeAt(o),!(h===32||h===9))break;h=o===j}n=c.getLineStart(e);o=c.getLineEnd(f,!0);if(h){for(h=0;h<g.length;h++)i=g[h],j=i.indexOf("//"),g[h]=i.substring(0,j)+i.substring(j+2);g=g.join("");i=
c.getLineStart(f);c=n===b.start?b.start:b.start-2;b=b.end-2*(f-e+1)+(b.end===i+1?2:0)}else g.splice(0,0,""),g=g.join("//"),c=n===b.start?b.start:b.start+2,b=b.end+2*(f-e+1);a.setText(g,n,o);a.setSelection(c,b);return!0},trimTrailingWhitespaces:function(){var a=this.editor,c=a.getModel(),b=a.getSelection();a.getTextView().setRedraw(!1);a.getUndoStack().startCompoundChange();for(var e=/(\s+$)/,f=c.getLineCount(),h=0;h<f;h++){var g=c.getLine(h),i=e.exec(g);if(i){var j=c.getLineStart(h),g=i[0].length,
i=j+i.index;c.setText("",i,i+g);if(b.start>i)b.start=Math.max(i,b.start-g);if(b.start!==b.end&&b.end>i)b.end=Math.max(i,b.end-g)}}a.getUndoStack().endCompoundChange();a.getTextView().setRedraw(!0);a.setSelection(b.start,b.end,!1)},startUndo:function(){this.undoStack&&this.undoStack.startCompoundChange()},skipClosingBracket:function(a){var c=this.editor;if(c.getTextView().getOptions("readonly"))return!1;var b=c.getSelection(),e=c.getModel();return(c.getCaretOffset()===e.getCharCount()?"":e.getText(b.start,
b.start+1))===a?(c.setCaretOffset(b.start+1),!0):!1},endUndo:function(){this.undoStack&&this.undoStack.endCompoundChange()},setAutoPairing:function(a){this.autoPairing=a},setSmartIndentation:function(a){this.smartIndentation=a}};h.SourceCodeActions=i;return h});
define("orion/editor/templates",[],function(){function j(j,g,b){this.prefix=j;this.description=g;this.template=b;this._parse()}function o(j,g){this._keywords=j||[];this._templates=[];this.addTemplates(g||[])}j.prototype={getProposal:function(j,g,b){var j=g-j.length,g={},f,e=b.delimiter!==void 0?b.delimiter:"\n";b.indentation&&(e+=b.indentation);for(var i=b.tab!==void 0?b.tab:"\t",h=0,a=this.variables,c=this.segments,b=[],d=0;d<c.length;d++){var k=c[d],m=a[k];if(m!==void 0)switch(k){case "${tab}":k=
i;break;case "${delimiter}":k=e;break;case "${cursor}":k="";f=h;break;default:var p=g[k];p||(p=g[k]={data:m.data,positions:[]});k=m.substitution;p.data&&p.data.values&&(k=p.data.values[0]);p.positions.push({offset:j+h,length:k.length})}b.push(k);h+=k.length}var e=[],q;for(q in g)g.hasOwnProperty(q)&&e.push(g[q]);b=b.join("");if(f===void 0)f=b.length;return{proposal:b,description:this.description,groups:e,escapePosition:j+f}},match:function(j){return this.prefix.indexOf(j)===0},_parse:function(){var j=
this.template,g=[],b={},f,e=0,j=j.replace(/\n/g,"${delimiter}"),j=j.replace(/\t/g,"${tab}");j.replace(/\$\{((?:[^\\}]+|\\.))*\}/g,function(i,h,a){var c=i.substring(2,i.length-1),h=i,d=c,k=null,m=d.indexOf(":");m!==-1&&(d=d.substring(0,m),h="${"+d+"}",k=JSON.parse(c.substring(m+1).replace("\\}","}").trim()));(c=b[h])||(c=b[h]={});c.substitution=d;if(k)c.data=k;(f=j.substring(e,a))&&g.push(f);g.push(h);e=a+i.length;return d});(f=j.substring(e,j.length))&&g.push(f);this.segments=g;this.variables=b}};
o.prototype={addTemplates:function(n){for(var g=this.getTemplates(),b=0;b<n.length;b++)g.push(new j(n[b].prefix,n[b].description,n[b].template))},computeProposals:function(j,g,b){var f=this.getPrefix(j,g,b),e=[];if(!this.isValid(f,j,g,b))return e;e=e.concat(this.getTemplateProposals(f,g,b));return e=e.concat(this.getKeywordProposals(f))},getKeywords:function(){return this._keywords},getKeywordProposals:function(j){var g=[],b=this.getKeywords();if(b)for(var f=0;f<b.length;f++)b[f].indexOf(j)===0&&
g.push({proposal:b[f].substring(j.length),description:b[f]});return g},getPrefix:function(j,g,b){return b.prefix},getTemplates:function(){return this._templates},getTemplateProposals:function(j,g,b){for(var f=[],e=this.getTemplates(),i=0;i<e.length;i++){var h=e[i];h.match(j)&&(h=h.getProposal(j,g,b),this.removePrefix(j,h),f.push(h))}return f},removePrefix:function(j,g){if(!(g.overwrite=g.proposal.substring(0,j.length)!==j))g.proposal=g.proposal.substring(j.length)},isValid:function(){return!0}};return{Template:j,
TemplateContentAssist:o}});
define("orion/editor/linkedMode","i18n!orion/editor/nls/messages,orion/keyBinding,orion/editor/keyModes,orion/editor/annotations,orion/editor/templates,orion/objects,orion/util".split(","),function(j,o,n,g,b,f){function e(b,a,c){var d=b.getTextView();n.KeyMode.call(this,d);this.editor=b;this.undoStack=a;this.contentAssist=c;this.linkedModeModel=null;d.setAction("linkedModeEnter",function(){this.exitLinkedMode(!0);return!0}.bind(this));d.setAction("linkedModeCancel",function(){this.exitLinkedMode(!1);return!0}.bind(this));
d.setAction("linkedModeNextGroup",function(){var a=this.linkedModeModel;this.selectLinkedGroup((a.selectedGroupIndex+1)%a.groups.length);return!0}.bind(this));d.setAction("linkedModePreviousGroup",function(){var a=this.linkedModeModel;this.selectLinkedGroup(a.selectedGroupIndex>0?a.selectedGroupIndex-1:a.groups.length-1);return!0}.bind(this));this.linkedModeListener={onActivating:function(){this._groupContentAssistProvider&&(this.contentAssist.setProviders([this._groupContentAssistProvider]),this.contentAssist.setProgress(null))}.bind(this),
onModelChanged:function(a){if(!this.ignoreVerify){for(var c=this.linkedModeModel,b,d;c;)if(b=this._getPositionChanged(c,a.start,a.start+a.removedCharCount),d=b.position,d===void 0||d.model!==c)this.exitLinkedMode(!1),c=this.linkedModeModel;else break;if(c){c=0;d=a.addedCharCount-a.removedCharCount;b=b.positions;for(var e,f,h=0;h<b.length;++h){f=b[h];e=f.position;var g=e.offset<=a.start&&a.start<=e.offset+e.length;g&&!f.ansestor?(e.offset+=c,e.length+=d,c+=d):(e.offset+=c,f.ansestor&&g&&(e.length+=
d));if(f.escape)f.model.escapePosition=e.offset}this._updateAnnotations(b)}}}.bind(this),onVerify:function(a){if(!this.ignoreVerify){for(var c=this.linkedModeModel,b,d;c;)if(b=this._getPositionChanged(c,a.start,a.end),d=b.position,d===void 0||d.model!==c)this.exitLinkedMode(!1),c=this.linkedModeModel;else break;if(c){var e=this._compoundChange;e?e.owner.model===c&&e.owner.group===d.group||(this.endUndo(),this.startUndo()):this.startUndo();c.selectedGroupIndex=d.group;var e=0,f=a.text.length-(a.end-
a.start);b=b.positions;for(var h,g,i=a.start-d.position.offset,l=a.end-d.position.offset,j=0;j<b.length;++j)if(g=b[j],h=g.position,g.oldOffset=h.offset,g.model===c&&g.group===d.group?(h.offset+=e,h.length+=f,e+=f):(h.offset+=e,g.ansestor&&(h.length+=d.count*f)),g.escape)g.model.escapePosition=h.offset;this.ignoreVerify=!0;e=this.editor.getTextView();for(j=b.length-1;j>=0;j--)g=b[j],g.model===c&&g.group===d.group&&e.setText(a.text,g.oldOffset+i,g.oldOffset+l);this.ignoreVerify=!1;a.text=null;this._updateAnnotations(b)}}}.bind(this)}}
var i={};e.prototype=new n.KeyMode;f.mixin(e.prototype,{createKeyBindings:function(){var b=o.KeyBinding,a=[];a.push({actionID:"linkedModeEnter",keyBinding:new b(13)});a.push({actionID:"linkedModeCancel",keyBinding:new b(27)});a.push({actionID:"linkedModeNextGroup",keyBinding:new b(9)});a.push({actionID:"linkedModePreviousGroup",keyBinding:new b(9,!1,!0)});return a},enterLinkedMode:function(b){if(!this.linkedModeModel){var a=this.editor.getTextView();a.addKeyMode(this);a.addEventListener("Verify",
this.linkedModeListener.onVerify);a.addEventListener("ModelChanged",this.linkedModeListener.onModelChanged);this.contentAssist.addEventListener("Activating",this.linkedModeListener.onActivating);this.editor.reportStatus(j.linkedModeEntered,null,!0)}this._sortedPositions=null;if(this.linkedModeModel)b.previousModel=this.linkedModeModel,b.parentGroup=this.linkedModeModel.selectedGroupIndex,this.linkedModeModel.nextModel=b;this.linkedModeModel=b;this.selectLinkedGroup(0)},exitLinkedMode:function(b){if(this.isActive()){if(this._compoundChange)this.endUndo(),
this._compoundChange=null;this._sortedPositions=null;var a=this.linkedModeModel;this.linkedModeModel=a.previousModel;a.parentGroup=a.previousModel=void 0;if(this.linkedModeModel)this.linkedModeModel.nextModel=void 0;if(!this.linkedModeModel){var c=this.editor.getTextView();c.removeKeyMode(this);c.removeEventListener("Verify",this.linkedModeListener.onVerify);c.removeEventListener("ModelChanged",this.linkedModeListener.onModelChanged);var d=this.contentAssist;d.removeEventListener("Activating",this.linkedModeListener.onActivating);
d.offset=void 0;this.editor.reportStatus(j.linkedModeExited,null,!0);b&&c.setCaretOffset(a.escapePosition,!1)}this.selectLinkedGroup(0)}},startUndo:function(){if(this.undoStack){var b=this,a=this.linkedModeModel;this._compoundChange=this.undoStack.startCompoundChange({model:a,group:a.selectedGroupIndex,end:function(){b._compoundChange=null}})}},endUndo:function(){this.undoStack&&this.undoStack.endCompoundChange()},isActive:function(){return!!this.linkedModeModel},isStatusActive:function(){return!!this.linkedModeModel},
selectLinkedGroup:function(e){var a=this.linkedModeModel;if(a){a.selectedGroupIndex=e;var e=a.groups[e],c=e.positions[0],d=this.editor.getTextView();d.setSelection(c.offset,c.offset+c.length);if(a=this.contentAssist)if(a.offset=void 0,e.data&&e.data.type==="link"&&e.data.values)(this._groupContentAssistProvider=new b.TemplateContentAssist(e.data.values)).getPrefix=function(){var a=d.getSelection();return a.start===a.end&&(a=d.getCaretOffset(),c.offset<=a&&a<=c.offset+c.length)?d.getText(c.offset,
a):""},a.offset=c.offset,a.deactivate(),a.activate();else if(this._groupContentAssistProvider)this._groupContentAssistProvider=null,a.deactivate()}this._updateAnnotations()},_getModelPositions:function(b,a,c){for(var d=a.groups,e=0;e<d.length;e++)for(var f=d[e].positions,g=0;g<f.length;g++){var i=f[g];c&&(i={offset:i.offset+c,length:i.length});i={index:g,group:e,count:f.length,model:a,position:i};b.push(i);if(a.nextModel&&a.nextModel.parentGroup===e)i.ansestor=!0,this._getModelPositions(b,a.nextModel,
(c||0)+f[g].offset-f[0].offset)}},_getSortedPositions:function(b){var a=this._sortedPositions;if(!a){for(a=[];b.previousModel;)b=b.previousModel;for(this._getModelPositions(a,b);b;)b.escapePosition!==void 0&&a.push({escape:!0,model:b,position:{offset:b.escapePosition,length:0}}),b=b.nextModel;a.sort(function(a,b){return a.position.offset-b.position.offset});this._sortedPositions=a}return a},_getPositionChanged:function(b,a,c){for(var d,b=this._getSortedPositions(b),e=b.length-1;e>=0;e--){var f=b[e].position;
if(f.offset<=a&&c<=f.offset+f.length){d=b[e];break}}return{position:d,positions:b}},_updateAnnotations:function(b){var a=this.editor.getAnnotationModel();if(a){for(var c=[],d=[],e=a.getTextModel(),e=a.getAnnotations(0,e.getCharCount()),f;e.hasNext();)switch(f=e.next(),f.type){case g.AnnotationType.ANNOTATION_LINKED_GROUP:case g.AnnotationType.ANNOTATION_CURRENT_LINKED_GROUP:case g.AnnotationType.ANNOTATION_SELECTED_LINKED_GROUP:c.push(f)}if(e=this.linkedModeModel)for(var b=b||this._getSortedPositions(e),
i=0;i<b.length;i++)if(f=b[i],f.model===e){var j=g.AnnotationType.ANNOTATION_LINKED_GROUP;f.group===e.selectedGroupIndex&&(j=f.index===0?g.AnnotationType.ANNOTATION_SELECTED_LINKED_GROUP:g.AnnotationType.ANNOTATION_CURRENT_LINKED_GROUP);f=f.position;f=g.AnnotationType.createAnnotation(j,f.offset,f.offset+f.length,"");d.push(f)}a.replaceAnnotations(c,d)}}});i.LinkedMode=e;return i});
define("orion/editor/factories","orion/editor/actions,orion/editor/undoStack,orion/editor/rulers,orion/editor/annotations,orion/editor/textDND,orion/editor/linkedMode".split(","),function(j,o,n,g,b,f){function e(){}function i(){}function h(){}function a(){}function c(){}function d(){}var k={};e.prototype={createKeyBindings:function(a,c,b,d){var d=new j.TextActions(a,c,d),e=new f.LinkedMode(a,c,b),a=new j.SourceCodeActions(a,c,b,e);return{textActions:d,linkedMode:e,sourceCodeActions:a}}};k.KeyBindingsFactory=
e;i.prototype={createUndoStack:function(a){a=a.getTextView();return new o.UndoStack(a,200)}};k.UndoFactory=i;h.prototype={createLineNumberRuler:function(a){return new n.LineNumberRuler(a,"left",{styleClass:"ruler lines"},{styleClass:"rulerLines odd"},{styleClass:"rulerLines even"})}};k.LineNumberRulerFactory=h;a.prototype={createFoldingRuler:function(a){return new n.FoldingRuler(a,"left",{styleClass:"ruler folding"})}};k.FoldingRulerFactory=a;c.prototype={createAnnotationModel:function(a){return new g.AnnotationModel(a)},
createAnnotationStyler:function(a,c){return new g.AnnotationStyler(a,c)},createAnnotationRulers:function(a){var c=new n.AnnotationRuler(a,"left",{styleClass:"ruler annotations"}),a=new n.OverviewRuler(a,"right",{styleClass:"ruler overview"});return{annotationRuler:c,overviewRuler:a}}};k.AnnotationFactory=c;d.prototype={createTextDND:function(a,c){return new b.TextDND(a.getTextView(),c)}};k.TextDNDFactory=d;return k});
define("orion/editor/editorFeatures",["orion/editor/factories","orion/editor/actions","orion/editor/linkedMode"],function(j,o,n){var g={};g.KeyBindingsFactory=j.KeyBindingsFactory;g.UndoFactory=j.UndoFactory;g.LineNumberRulerFactory=j.LineNumberRulerFactory;g.FoldingRulerFactory=j.FoldingRulerFactory;g.AnnotationFactory=j.AnnotationFactory;g.TextDNDFactory=j.TextDNDFactory;g.TextActions=o.TextActions;g.SourceCodeActions=o.SourceCodeActions;g.LinkedMode=n.LinkedMode;return g});
(function(j,o){typeof define==="function"&&define.amd?define("orion/Deferred",o):typeof exports==="object"?module.exports=o():(j.orion=j.orion||{},j.orion.Deferred=o())})(this,function(){function j(){for(var a;a=e.shift()||i.shift();)a();h=!1}function o(a,c){(c?i:e).push(a);h||(h=!0,c?setTimeout(j,0):j())}function n(a){return function(){a.apply(null,arguments)}}function g(){}function b(){var a=Error("Cancel");a.name="Cancel";return a}function f(){function a(){for(var a;a=e.shift();){var b=a.deferred,
f=d==="resolved"?"resolve":"reject";if(typeof a[f]==="function")try{var h=a[f](c);h&&typeof h.then==="function"?(b.cancel=h.cancel||g,h.then(n(b.resolve),n(b.reject),b.progress)):b.resolve(h)}catch(i){b.reject(i)}else b[f](c)}}var c,d,e=[],h=this;this.reject=function(b){d||(d="rejected",c=b,e.length&&o(a));return h.promise};this.resolve=function(b){d||(d="resolved",c=b,e.length&&o(a));return h.promise};this.progress=function(a){d||e.forEach(function(c){c.progress&&c.progress(a)});return h.promise};
this.cancel=function(){d||h.reject(b())};this.then=function(c,b,g){var c={resolve:c,reject:b,progress:g,deferred:new f},i=c.deferred,j=!1,n=function(){j||(j=!0,o(function(){var a=i.cancel===n?h.cancel:i.cancel;typeof a==="function"&&a()},!0))};i.cancel=n;e.push(c);d&&o(a,!0);return i.promise};this.promise=Object.create(Object.prototype,{then:{value:h.then},cancel:{get:function(){return h.cancel},set:function(a){h.cancel=a}}})}var e=[],i=[],h=!1;f.all=function(a,c){function b(a,c){i||(g[a]=c,--h===
0&&j.resolve(g))}function e(a,f){if(!i){if(c)try{b(a,c(f));return}catch(h){f=h}j.reject(f)}}var h=a.length,g=[],i=!1,j=new f;j.then(null,function(){i=!0;a.forEach(function(a){a.cancel&&a.cancel()})});h===0?j.resolve(g):a.forEach(function(a,c){a.then(b.bind(null,c),e.bind(null,c))});return j.promise};f.when=function(a,c,b,e){var h;if(!(a&&typeof a.then==="function"))h=new f,h.resolve(a),a=h.promise;return a.then(c,b,e)};return f});
define("orion/editor/contentAssist","i18n!orion/editor/nls/messages,orion/keyBinding,orion/editor/keyModes,orion/editor/eventTarget,orion/Deferred,orion/objects,orion/editor/util,orion/util".split(","),function(j,o,n,g,b,f,e,i){var h,a,c;function d(b){this.textView=b;this.state=h;this.providers=[];var d=this;this.contentAssistListener={onModelChanging:function(b){d.isDeactivatingChange(b)?d.setState(h):d.state===a&&d.setState(c)},onScroll:function(){d.setState(h)},onSelection:function(){var b=d.state;
if(b===a||b===c)d.computeProposals(),d.setState(c)}};b.setKeyBinding(i.isMac?new o.KeyBinding(" ",!1,!1,!1,!0):new o.KeyBinding(" ",!0),"contentAssist");b.setAction("contentAssist",function(){d.activate();return!0},{name:j.contentAssist})}function k(a,c){var b=a.textView;n.KeyMode.call(this,b);this.contentAssist=a;this.widget=c;this.proposals=[];var d=this;this.contentAssist.addEventListener("ProposalsComputed",function(a){d.proposals=a.data.proposals;d.proposals.length===0?(d.selectedIndex=-1,d.cancel()):
d.selectedIndex=0});b.setAction("contentAssistApply",function(){return this.enter()}.bind(this));b.setAction("contentAssistCancel",function(){return this.cancel()}.bind(this));b.setAction("contentAssistNextProposal",function(){return this.lineDown()}.bind(this));b.setAction("contentAssistPreviousProposal",function(){return this.lineUp()}.bind(this));b.setAction("contentAssistNextPage",function(){return this.pageDown()}.bind(this));b.setAction("contentAssistPreviousPage",function(){return this.pageUp()}.bind(this));
b.setAction("contentAssistTab",function(){return this.tab()}.bind(this))}function m(a,c){this.contentAssist=a;this.textView=this.contentAssist.getTextView();this.isShowing=this.textViewListenerAdded=!1;var b=this.textView.getOptions("parent").ownerDocument;this.parentNode=typeof c==="string"?b.getElementById(c):c;if(!this.parentNode){this.parentNode=i.createElement(b,"div");this.parentNode.className="contentassist";var d=b.getElementsByTagName("body")[0];if(d)d.appendChild(this.parentNode);else throw Error("parentNode is required");
}var f=this;this.textViewListener={onMouseDown:function(a){a.event.target.parentElement!==f.parentNode&&f.contentAssist.deactivate()}};this.contentAssist.addEventListener("ProposalsComputed",function(a){f.setProposals(a.data.proposals);f.show();if(!f.textViewListenerAdded)f.textView.addEventListener("MouseDown",f.textViewListener.onMouseDown),f.textViewListenerAdded=!0});this.contentAssist.addEventListener("Deactivating",function(){f.setProposals([]);f.hide();if(f.textViewListenerAdded)f.textView.removeEventListener("MouseDown",
f.textViewListener.onMouseDown),f.textViewListenerAdded=!1;f.textViewListenerAdded=!1});this.scrollListener=function(){f.isShowing&&f.position()};e.addEventListener(b,"scroll",this.scrollListener)}h=1;a=2;c=3;var p={selected:" selected",hr:"proposal-hr",emphasis:"proposal-emphasis",noemphasis:"proposal-noemphasis",dfault:"proposal-default"};d.prototype={apply:function(a){if(!a)return!1;var c=this.textView.getSelection(),b=Math.min(c.start,c.end),c=Math.max(c.start,c.end);a.overwrite&&(b=this.getPrefixStart(b));
var d={proposal:a,start:b,end:c};this.setState(h);this.textView.setText(typeof a==="string"?a:a.proposal,b,c);this.dispatchEvent({type:"ProposalApplied",data:d});return!0},activate:function(){this.state===h&&this.setState(a)},deactivate:function(){this.setState(h)},getTextView:function(){return this.textView},isActive:function(){return this.state===a||this.state===c},isDeactivatingChange:function(a){var c=a.removedCharCount>0&&a.addedCharCount===0,b=this.textView,b=a.start+1<=b.getModel().getCharCount()&&
/^\s*$/.test(b.getText(a.start,a.start+1));return a.removedLineCount>0||a.addedLineCount>0||c&&b},setState:function(c){var b;c===a?(b="Activating",this._mode&&this._mode.setActive(!0)):c===h&&(b="Deactivating",this._mode&&this._mode.setActive(!1));b&&this.dispatchEvent({type:b});this.state=c;this.onStateChange(c)},setMode:function(a){this._mode=a},onStateChange:function(c){if(c===h){if(this.listenerAdded)this.textView.removeEventListener("ModelChanging",this.contentAssistListener.onModelChanging),
this.textView.removeEventListener("Scroll",this.contentAssistListener.onScroll),this.textView.removeEventListener("Selection",this.contentAssistListener.onSelection),this.listenerAdded=!1}else if(c===a){if(!this.listenerAdded)this.textView.addEventListener("ModelChanging",this.contentAssistListener.onModelChanging),this.textView.addEventListener("Scroll",this.contentAssistListener.onScroll),this.textView.addEventListener("Selection",this.contentAssistListener.onSelection),this.listenerAdded=!0;this.computeProposals()}},
computeProposals:function(){var a=this;this._computeProposals(this.textView.getCaretOffset()).then(function(c){a.isActive()&&a.dispatchEvent({type:"ProposalsComputed",data:{proposals:c}})})},getPrefixStart:function(a){for(;a>0&&/[A-Za-z0-9_]/.test(this.textView.getText(a-1,a));)a--;return a},handleError:function(a){typeof console!=="undefined"&&(console.log("Error retrieving content assist proposals"),console.log(a))},_computeProposals:function(a){for(var c=this.providers,d=this.textView,e=d.getModel(),
f=d.getText(),h=e.getLine(e.getLineAtOffset(a)),g=0;g<h.length&&/\s/.test(h.charAt(g));)g++;var g=h.substring(0,g),i=d.getOptions("tabSize","expandTab"),i=i.expandTab?Array(i.tabSize+1).join(" "):"\t",k={line:h,prefix:d.getText(this.getPrefixStart(a),a),selection:d.getSelection(),delimiter:e.getLineDelimiter(),tab:i,indentation:g},j=this,c=c.map(function(c){var d=c.computeProposals||c.getProposals,e;try{typeof d==="function"&&(e=j.progress?j.progress.progress(d.apply(c,[f,a,k]),"Generating content assist proposal"):
d.apply(c,[f,a,k]))}catch(h){j.handleError(h)}return b.when(e)});return b.all(c,this.handleError).then(function(a){return a.reduce(function(a,c){return c instanceof Array?a.concat(c):a},[])})},setProviders:function(a){this.providers=a.slice(0)},setProgress:function(a){this.progress=a}};g.EventTarget.addMixin(d.prototype);k.prototype=new n.KeyMode;f.mixin(k.prototype,{createKeyBindings:function(){var a=o.KeyBinding,c=[];c.push({actionID:"contentAssistApply",keyBinding:new a(13)});c.push({actionID:"contentAssistCancel",
keyBinding:new a(27)});c.push({actionID:"contentAssistNextProposal",keyBinding:new a(40)});c.push({actionID:"contentAssistPreviousProposal",keyBinding:new a(38)});c.push({actionID:"contentAssistNextPage",keyBinding:new a(34)});c.push({actionID:"contentAssistPreviousPage",keyBinding:new a(33)});c.push({actionID:"contentAssistTab",keyBinding:new a(9)});return c},cancel:function(){this.getContentAssist().deactivate()},getContentAssist:function(){return this.contentAssist},isActive:function(){return this.getContentAssist().isActive()},
setActive:function(a){a?this.contentAssist.textView.addKeyMode(this):this.contentAssist.textView.removeKeyMode(this)},lineUp:function(){return this._lineUp(this.selectedIndex===0?this.proposals.length-1:this.selectedIndex-1)},_lineUp:function(a){for(;this.proposals[a].unselectable&&a>0;)a--;this.selectedIndex=a;this.widget&&this.widget.setSelectedIndex(this.selectedIndex);return!0},lineDown:function(){return this._lineDown(this.selectedIndex===this.proposals.length-1?0:this.selectedIndex+1)},_lineDown:function(a){for(;this.proposals[a].unselectable&&
a<this.proposals.length-1;)a++;this.selectedIndex=a;this.widget&&this.widget.setSelectedIndex(this.selectedIndex);return!0},pageUp:function(){if(this.widget){var a=this.widget.getTopIndex();a===this.selectedIndex&&(this.widget.scrollIndex(a,!1),a=this.widget.getTopIndex());return this._lineUp(a)}else return this.lineUp()},pageDown:function(){if(this.widget){var a=this.widget.getBottomIndex();a===this.selectedIndex&&(this.widget.scrollIndex(a,!0),a=this.widget.getBottomIndex());return this._lineDown(a)}else return this.lineDown()},
enter:function(){return this.contentAssist.apply(this.proposals[this.selectedIndex]||null)},tab:function(){return this.widget?(this.widget.createAccessible(this),this.widget.parentNode.focus(),!0):!1}});m.prototype={onClick:function(a){if(!a)a=window.event;this.contentAssist.apply(this.getProposal(a.target||a.srcElement));this.textView.focus()},createDiv:function(a,c,b,d){var e=b.ownerDocument,f=i.createElement(e,"div");f.id="contentoption"+d;f.setAttribute("role","option");a.style==="hr"?a=i.createElement(e,
"hr"):(f.className=this.calculateClasses(a.style,c),a=e.createTextNode(this.getDisplayString(a)),c&&this.parentNode.setAttribute("aria-activedescendant",f.id));f.appendChild(a,f);b.appendChild(f)},createAccessible:function(a){this._isAccessible||e.addEventListener(this.parentNode,"keydown",function(c){if(!c)c=window.event;if(c.keyCode===27)return a.cancel();else if(c.keyCode===38)return a.lineUp();else if(c.keyCode===40)return a.lineDown();else if(c.keyCode===13)return a.enter();c.preventDefault?
c.preventDefault():(c.cancelBubble=!0,c.returnValue=!1,c.keyCode=0);return!1});this._isAccessible=!0},calculateClasses:function(a,c){var b=p[a];if(!b)b=p.dfault;return c?b+p.selected:b},getDisplayString:function(a){return typeof a==="string"?a:a.description&&typeof a.description==="string"?a.description:a.proposal},getProposal:function(a){for(var c=0,b=this.parentNode.firstChild;b!==null;b=b.nextSibling){if(b===a)return this.proposals[c]||null;c++}return null},getTopIndex:function(){for(var a=this.parentNode.childNodes,
c=0;c<a.length;c++)if(a[c].offsetTop>=this.parentNode.scrollTop)return c;return 0},getBottomIndex:function(){for(var a=this.parentNode.childNodes,c=0;c<a.length;c++){var b=a[c];if(b.offsetTop+b.offsetHeight>this.parentNode.scrollTop+this.parentNode.clientHeight)return Math.max(0,c-1)}return a.length-1},scrollIndex:function(a,c){this.parentNode.childNodes[a].scrollIntoView(c)},setSelectedIndex:function(a){this.selectedIndex=a;this.selectNode(this.parentNode.childNodes[this.selectedIndex])},selectNode:function(a){for(var c=
this.parentNode.childNodes,b=0;b<c.length;b++){var d=c[b],e=d.className.indexOf(p.selected);if(e>=0)d.className=d.className.substring(0,e)+d.className.substring(e+p.selected.length);d===a&&(d.className+=p.selected,this.parentNode.setAttribute("aria-activedescendant",d.id),d.focus(),d.offsetTop<this.parentNode.scrollTop?d.scrollIntoView(!0):d.offsetTop+d.offsetHeight>this.parentNode.scrollTop+this.parentNode.clientHeight&&d.scrollIntoView(!1))}},setProposals:function(a){this.proposals=a},show:function(){if(this.proposals.length===
0)this.hide();else{this.parentNode.innerHTML="";for(var a=0;a<this.proposals.length;a++)this.createDiv(this.proposals[a],a===0,this.parentNode,a);this.position();this.parentNode.onclick=this.onClick.bind(this);this.isShowing=!0}},hide:function(){this.parentNode.ownerDocument.activeElement===this.parentNode&&this.textView.focus();this.parentNode.style.display="none";this.parentNode.onclick=null;this.isShowing=!1},position:function(){var a=this.contentAssist,a=this.textView.getLocationAtOffset(a.offset!==
void 0?a.offset:this.textView.getCaretOffset());a.y+=this.textView.getLineHeight();this.textView.convert(a,"document","page");this.parentNode.style.position="fixed";this.parentNode.style.left=a.x+"px";this.parentNode.style.top=a.y+"px";this.parentNode.style.display="block";this.parentNode.scrollTop=0;var c=this.parentNode.ownerDocument,b=c.documentElement.clientWidth;if(a.y+this.parentNode.offsetHeight>c.documentElement.clientHeight)this.parentNode.style.top=a.y-this.parentNode.offsetHeight-this.textView.getLineHeight()+
"px";if(a.x+this.parentNode.offsetWidth>b)this.parentNode.style.left=b-this.parentNode.offsetWidth+"px"}};return{ContentAssist:d,ContentAssistMode:k,ContentAssistWidget:m}});
define("orion/editor/keywords",[],function(){return{JSKeywords:"break,case,class,catch,continue,const,debugger,default,delete,do,else,enum,export,extends,false,finally,for,function,if,implements,import,in,instanceof,interface,let,new,null,package,private,protected,public,return,static,super,switch,this,throw,true,try,typeof,undefined,var,void,while,with,yield".split(","),CSSKeywords:"alignment-adjust,alignment-baseline,animation,animation-delay,animation-direction,animation-duration,animation-iteration-count,animation-name,animation-play-state,animation-timing-function,appearance,azimuth,backface-visibility,background,background-attachment,background-clip,background-color,background-image,background-origin,background-position,background-repeat,background-size,baseline-shift,binding,bleed,bookmark-label,bookmark-level,bookmark-state,bookmark-target,border,border-bottom,border-bottom-color,border-bottom-left-radius,border-bottom-right-radius,border-bottom-style,border-bottom-width,border-collapse,border-color,border-image,border-image-outset,border-image-repeat,border-image-slice,border-image-source,border-image-width,border-left,border-left-color,border-left-style,border-left-width,border-radius,border-right,border-right-color,border-right-style,border-right-width,border-spacing,border-style,border-top,border-top-color,border-top-left-radius,border-top-right-radius,border-top-style,border-top-width,border-width,bottom,box-align,box-decoration-break,box-direction,box-flex,box-flex-group,box-lines,box-ordinal-group,box-orient,box-pack,box-shadow,box-sizing,break-after,break-before,break-inside,caption-side,clear,clip,color,color-profile,column-count,column-fill,column-gap,column-rule,column-rule-color,column-rule-style,column-rule-width,column-span,column-width,columns,content,counter-increment,counter-reset,crop,cue,cue-after,cue-before,cursor,direction,display,dominant-baseline,drop-initial-after-adjust,drop-initial-after-align,drop-initial-before-adjust,drop-initial-before-align,drop-initial-size,drop-initial-value,elevation,empty-cells,fit,fit-position,flex-align,flex-flow,flex-inline-pack,flex-order,flex-pack,float,float-offset,font,font-family,font-size,font-size-adjust,font-stretch,font-style,font-variant,font-weight,grid-columns,grid-rows,hanging-punctuation,height,hyphenate-after,hyphenate-before,hyphenate-character,hyphenate-lines,hyphenate-resource,hyphens,icon,image-orientation,image-rendering,image-resolution,inline-box-align,left,letter-spacing,line-height,line-stacking,line-stacking-ruby,line-stacking-shift,line-stacking-strategy,list-style,list-style-image,list-style-position,list-style-type,margin,margin-bottom,margin-left,margin-right,margin-top,mark,mark-after,mark-before,marker-offset,marks,marquee-direction,marquee-loop,marquee-play-count,marquee-speed,marquee-style,max-height,max-width,min-height,min-width,move-to,nav-down,nav-index,nav-left,nav-right,nav-up,opacity,orphans,outline,outline-color,outline-offset,outline-style,outline-width,overflow,overflow-style,overflow-x,overflow-y,padding,padding-bottom,padding-left,padding-right,padding-top,page,page-break-after,page-break-before,page-break-inside,page-policy,pause,pause-after,pause-before,perspective,perspective-origin,phonemes,pitch,pitch-range,play-during,position,presentation-level,punctuation-trim,quotes,rendering-intent,resize,rest,rest-after,rest-before,richness,right,rotation,rotation-point,ruby-align,ruby-overhang,ruby-position,ruby-span,size,speak,speak-header,speak-numeral,speak-punctuation,speech-rate,stress,string-set,table-layout,target,target-name,target-new,target-position,text-align,text-align-last,text-decoration,text-emphasis,text-height,text-indent,text-justify,text-outline,text-shadow,text-transform,text-wrap,top,transform,transform-origin,transform-style,transition,transition-delay,transition-duration,transition-property,transition-timing-function,unicode-bidi,vertical-align,visibility,voice-balance,voice-duration,voice-family,voice-pitch,voice-pitch-range,voice-rate,voice-stress,voice-volume,volume,white-space,white-space-collapse,widows,width,word-break,word-spacing,word-wrap,z-index".split(","),
JAVAKeywords:"abstract,boolean,break,byte,case,catch,char,class,continue,default,do,double,else,extends,false,final,finally,float,for,if,implements,import,instanceof,int,interface,long,native,new,null,package,private,protected,public,return,short,static,super,switch,synchronized,this,throw,throws,transient,true,try,void,volatile,while".split(",")}});
define("orion/editor/cssContentAssist",["orion/editor/templates","orion/editor/keywords"],function(j,o){function n(a){return JSON.stringify(a).replace("}","\\}")}function g(){}for(var b={type:"link",values:"visible,hidden,scroll,auto,no-display,no-content".split(",")},f={type:"link",values:"solid,dashed,dotted,double,groove,ridge,inset,outset".split(",")},e={type:"link",values:[]},i=0;i<10;i++)e.values.push(i.toString());for(var h={type:"link",values:"black,white,red,green,blue,magenta,yellow,cyan,grey,darkred,darkgreen,darkblue,darkmagenta,darkcyan,darkyellow,darkgray,lightgray".split(",")},
a=[{prefix:"rule",description:"rule - class selector rule",template:".${class} {\n\t${cursor}\n}"},{prefix:"rule",description:"rule - id selector rule",template:"#${id} {\n\t${cursor}\n}"},{prefix:"outline",description:"outline - outline style",template:"outline: ${color:"+n(h)+"} ${style:"+n(f)+"} ${width:"+n(e)+"}px;"},{prefix:"background-image",description:"background-image - image style",template:'background-image: url("${uri}");'},{prefix:"url",description:"url - url image",template:'url("${uri}");'},
{prefix:"rgb",description:"rgb - rgb color",template:"rgb(${red},${green},${blue});"},{prefix:"@",description:"import - import style sheet",template:'@import "${uri}";'}],c=[{prop:"display",values:{type:"link",values:"none,block,box,flex,inline,inline-block,inline-flex,inline-table,list-item,table,table-caption,table-cell,table-column,table-column-group,table-footer-group,table-header-group,table-row,table-row-group,inherit".split(",")}},{prop:"overflow",values:b},{prop:"overflow-x",values:b},{prop:"overflow-y",
values:b},{prop:"float",values:{type:"link",values:["left","right","none","inherit"]}},{prop:"position",values:{type:"link",values:["absolute","fixed","relative","static","inherit"]}},{prop:"cursor",values:{type:"link",values:"auto,crosshair,default,e-resize,help,move,n-resize,ne-resize,nw-resize,pointer,progress,s-resize,se-resize,sw-resize,text,w-resize,wait,inherit".split(",")}},{prop:"color",values:h},{prop:"border-top-color",values:h},{prop:"border-bottom-color",values:h},{prop:"border-right-color",
values:h},{prop:"border-left-color",values:h},{prop:"background-color",values:h},{prop:"font-style",values:{type:"link",values:["italic","normal","oblique","inherit"]}},{prop:"font-weight",values:{type:"link",values:"bold,normal,bolder,lighter,100,200,300,400,500,600,700,800,900,inherit".split(",")}},{prop:"white-space",values:{type:"link",values:"pre,pre-line,pre-wrap,nowrap,normal,inherit".split(",")}},{prop:"word-wrap",values:{type:"link",values:["normal","break-word"]}},{prop:"visibility",values:{type:"link",
values:["hidden","visible","collapse","inherit"]}}],i=0;i<c.length;i++)b=c[i],a.push({prefix:b.prop,description:b.prop+" - "+b.prop+" style",template:b.prop+": ${value:"+n(b.values)+"};"});c="width,height,top,bottom,left,right,min-width,min-height,max-width,max-height,margin,padding,padding-left,padding-right,padding-top,padding-bottom,margin-left,margin-top,margin-bottom,margin-right".split(",");for(i=0;i<c.length;i++)b=c[i],a.push({prefix:b,description:b+" - "+b+" pixel style",template:b+": ${value}px;"});
c=["padding","margin"];for(i=0;i<c.length;i++)b=c[i],a.push({prefix:b,description:b+" - "+b+" top right bottom left style",template:b+": ${top}px ${left}px ${bottom}px ${right}px;"}),a.push({prefix:b,description:b+" - "+b+" top right,left bottom style",template:b+": ${top}px ${right_left}px ${bottom}px;"}),a.push({prefix:b,description:b+" - "+b+" top,bottom right,left style",template:b+": ${top_bottom}px ${right_left}px"});c=["border","border-top","border-bottom","border-left","border-right"];for(i=
0;i<c.length;i++)b=c[i],a.push({prefix:b,description:b+" - "+b+" style",template:b+": ${width:"+n(e)+"}px ${style:"+n(f)+"} ${color:"+n(h)+"};"});g.prototype=new j.TemplateContentAssist(o.CSSKeywords,a);g.prototype.getPrefix=function(a,c){for(var b=c;b&&/[A-Za-z\-\@]/.test(a.charAt(b-1));)b--;return b?a.substring(b,c):""};return{CssContentAssistProvider:g}});
define("orion/editor/htmlContentAssist",["orion/editor/templates"],function(j){function o(){}var n=new j.Template("","Simple HTML document",'<!DOCTYPE html>\n<html lang="en">\n\t<head>\n\t\t<meta charset=utf-8>\n\t\t<title>${title}</title>\n\t</head>\n\t<body>\n\t\t<h1>${header}</h1>\n\t\t<p>\n\t\t\t${cursor}\n\t\t</p>\n\t</body>\n</html>'),g=[{prefix:"<img",description:"<img> - HTML image element",template:'<img src="${cursor}" alt="${Image}"/>'},{prefix:"<a",description:"<a> - HTML anchor element",
template:'<a href="${cursor}"></a>'},{prefix:"<ul",description:"<ul> - HTML unordered list",template:"<ul>\n\t<li>${cursor}</li>\n</ul>"},{prefix:"<ol",description:"<ol> - HTML ordered list",template:"<ol>\n\t<li>${cursor}</li>\n</ol>"},{prefix:"<dl",description:"<dl> - HTML definition list",template:"<dl>\n\t<dt>${cursor}</dt>\n\t<dd></dd>\n</dl>"},{prefix:"<table",description:"<table> - basic HTML table",template:"<table>\n\t<tr>\n\t\t<td>${cursor}</td>\n\t</tr>\n</table>"}],b,f,e,i,h="abbr,b,button,canvas,cite,command,dd,del,dfn,dt,em,embed,font,h1,h2,h3,h4,h5,h6,i,ins,kbd,label,li,mark,meter,object,option,output,progress,q,rp,rt,samp,small,strong,sub,sup,td,time,title,tt,u,var".split(",");
for(i=0;i<h.length;i++)b=h[i],e="<"+b+"></"+b+">",f="<"+b+">${cursor}</"+b+">",g.push({prefix:"<"+b,description:e,template:f});h="address,article,aside,audio,bdo,blockquote,body,caption,code,colgroup,datalist,details,div,fieldset,figure,footer,form,head,header,hgroup,iframe,legend,map,menu,nav,noframes,noscript,optgroup,p,pre,ruby,script,section,select,span,style,tbody,textarea,tfoot,th,thead,tr,video".split(",");for(i=0;i<h.length;i++)b=h[i],e="<"+b+"></"+b+">",f="<"+b+">\n\t${cursor}\n</"+b+">",
g.push({prefix:"<"+b,description:e,template:f});h="area,base,br,col,hr,input,link,meta,param,keygen,source".split(",");for(i=0;i<h.length;i++)b=h[i],f=e="<"+b+"/>",g.push({prefix:"<"+b,description:e,template:f});o.prototype=new j.TemplateContentAssist([],g);o.prototype.getPrefix=function(a,c){for(var b=c;b&&/[A-Za-z<]/.test(a.charAt(b-1));)if(b--,a.charAt(b)==="<")break;return b?a.substring(b,c):""};o.prototype.computeProposals=function(a,c,b){return a.length===0?[n.getProposal("",c,b)]:j.TemplateContentAssist.prototype.computeProposals.call(this,
a,c,b)};return{HTMLContentAssistProvider:o}});
define("orion/editor/jsTemplateContentAssist",["orion/editor/templates","orion/editor/keywords"],function(j,o){function n(){}var g=[{prefix:"if",description:"if - if statement",template:"if (${condition}) {\n\t${cursor}\n}"},{prefix:"if",description:"if - if else statement",template:"if (${condition}) {\n\t${cursor}\n} else {\n\t\n}"},{prefix:"for",description:"for - iterate over array",template:"for (var ${i}=0; ${i}<${array}.length; ${i}++) {\n\t${cursor}\n}"},{prefix:"for",description:"for - iterate over array with local var",
template:"for (var ${i}=0; ${i}<${array}.length; ${i}++) {\n\tvar ${value} = ${array}[${i}];\n\t${cursor}\n}"},{prefix:"for",description:"for..in - iterate over properties of an object",template:"for (var ${property} in ${object}) {\n\tif (${object}.hasOwnProperty(${property})) {\n\t\t${cursor}\n\t}\n}"},{prefix:"while",description:"while - while loop with condition",template:"while (${condition}) {\n\t${cursor}\n}"},{prefix:"do",description:"do - do while loop with condition",template:"do {\n\t${cursor}\n} while (${condition});"},
{prefix:"switch",description:"switch - switch case statement",template:"switch (${expression}) {\n\tcase ${value1}:\n\t\t${cursor}\n\t\tbreak;\n\tdefault:\n}"},{prefix:"case",description:"case - case statement",template:"case ${value}:\n\t${cursor}\n\tbreak;"},{prefix:"try",description:"try - try..catch statement",template:"try {\n\t${cursor}\n} catch (${err}) {\n}"},{prefix:"try",description:"try - try..catch statement with finally block",template:"try {\n\t${cursor}\n} catch (${err}) {\n} finally {\n}"},
{prefix:"var",description:"var - variable declaration",template:"var ${name};"},{prefix:"var",description:"var - variable declaration with value",template:"var ${name} = ${value};"},{prefix:"let",description:"let - local scope variable declaration",template:"let ${name};"},{prefix:"let",description:"let - local scope variable declaration with value",template:"let ${name} = ${value};"},{prefix:"return",description:"return - return result",template:"return ${result};"},{prefix:"typeof",description:"typeof - typeof statement",
template:'typeof ${object} === "${type:'+JSON.stringify({type:"link",values:"undefined,object,boolean,number,string,function,xml".split(",")}).replace("}","\\}")+'}"'},{prefix:"instanceof",description:"instanceof - instanceof statement",template:"${object} instanceof ${type}"},{prefix:"with",description:"with - with statement",template:"with (${object}) {\n\t${cursor}\n}"},{prefix:"function",description:"function - function declaration",template:"function ${name} (${parameter}) {\n\t${cursor}\n}"},
{prefix:"nls",description:"string - non NLS",template:"${cursor} //$NON-NLS-${0}$"},{prefix:"log",description:"log - console log",template:"console.log(${object});"}];n.prototype=new j.TemplateContentAssist(o.JSKeywords,g);n.prototype.isValid=function(b,f,e){b=e-b.length-1;for(e="";b>=0;)if(e=f[b],e==="\n"||e==="\r")break;else if(/\s/.test(e))b--;else break;return":!@#$^&*.?<>".indexOf(e)===-1};return{JSTemplateContentAssistProvider:n}});
define("orion/editor/AsyncStyler",["i18n!orion/editor/nls/messages","orion/editor/annotations"],function(j,o){function n(e){return e.getProperty("objectClass").indexOf(b)!==-1&&e.getProperty("type")==="highlighter"}function g(b,f,h){this.initialize(b,f,h);this.lineStyles=[]}var b="orion.edit.highlighter",f=b+" service must be an event emitter";o.AnnotationType.registerType("orion.annotation.highlightError",{title:j.syntaxError,html:"<div class='annotationHTML error'></div>",rangeStyle:{styleClass:"annotationRange error"}});
g.prototype={initialize:function(e,f,h){this.textView=e;this.serviceRegistry=f;this.annotationModel=h;this.services=[];var a=this;this.listener={onModelChanging:function(c){a.onModelChanging(c)},onModelChanged:function(c){a.onModelChanged(c)},onDestroy:function(c){a.onDestroy(c)},onLineStyle:function(c){a.onLineStyle(c)},onStyleReady:function(c){a.onStyleReady(c)},onServiceAdded:function(c){a.onServiceAdded(c.serviceReference,a.serviceRegistry.getService(c.serviceReference))},onServiceRemoved:function(c){a.onServiceRemoved(c.serviceReference,
a.serviceRegistry.getService(c.serviceReference))}};e.addEventListener("ModelChanging",this.listener.onModelChanging);e.addEventListener("ModelChanged",this.listener.onModelChanged);e.addEventListener("Destroy",this.listener.onDestroy);e.addEventListener("LineStyle",this.listener.onLineStyle);f.addEventListener("registered",this.listener.onServiceAdded);f.addEventListener("unregistering",this.listener.onServiceRemoved);e=f.getServiceReferences(b);for(h=0;h<e.length;h++){var c=e[h];n(c)&&this.addServiceListener(f.getService(c))}},
onDestroy:function(){this.destroy()},destroy:function(){if(this.textView)this.textView.removeEventListener("ModelChanging",this.listener.onModelChanging),this.textView.removeEventListener("ModelChanged",this.listener.onModelChanged),this.textView.removeEventListener("Destroy",this.listener.onDestroy),this.textView.removeEventListener("LineStyle",this.listener.onLineStyle),this.textView=null;if(this.services){for(var b=0;b<this.services.length;b++)this.removeServiceListener(this.services[b]);this.services=
null}if(this.serviceRegistry)this.serviceRegistry.removeEventListener("registered",this.listener.onServiceAdded),this.serviceRegistry.removeEventListener("unregistering",this.listener.onServiceRemoved),this.serviceRegistry=null;this.lineStyles=this.listener=null},onModelChanging:function(b){this.startLine=this.textView.getModel().getLineAtOffset(b.start)},onModelChanged:function(b){var f=this.startLine;(b.addedLineCount||b.removedLineCount)&&Array.prototype.splice.apply(this.lineStyles,[f,b.removedLineCount].concat(this._getEmptyStyle(b.addedLineCount)))},
onStyleReady:function(b){var f=b.lineStyles||b.style,b=Number.MAX_VALUE,h=-1,a=this.textView.getModel(),c;for(c in f)f.hasOwnProperty(c)&&(this.lineStyles[c]=f[c],b=Math.min(b,c),h=Math.max(h,c));b=Math.max(b,0);h=Math.min(h,a.getLineCount());if(f=this.annotationModel){for(var d=f.getAnnotations(a.getLineStart(b),a.getLineEnd(h)),g=[];d.hasNext();){var j=d.next();j.type==="orion.annotation.highlightError"&&g.push(j)}d=[];for(j=b;j<=h;j++){c=j;var p=this.lineStyles[c],p=p&&p.errors;c=a.getLineStart(c);
if(p)for(var n=0;n<p.length;n++){var r=p[n];d.push(o.AnnotationType.createAnnotation("orion.annotation.highlightError",r.start+c,r.end+c))}}f.replaceAnnotations(g,d)}this.textView.redrawLines(b,h+1)},onLineStyle:function(b){function f(a,c){for(var b=a.length,e=[],h=0;h<b;h++){var g=a[h];e.push({start:g.start+c,end:g.end+c,style:g.style})}return e}var h=this.lineStyles[b.lineIndex];if(h)if(h.ranges)b.ranges=f(h.ranges,b.lineStart);else if(h.style)b.style=h.style},_getEmptyStyle:function(b){for(var f=
[],h=0;h<b;h++)f.push(null);return f},setContentType:function(b){this.contentType=b;if(this.services)for(b=0;b<this.services.length;b++){var f=this.services[b];if(f.setContentType){var h=this.serviceRegistry.getService("orion.page.progress");h?h.progress(f.setContentType(this.contentType),"Styling content type: "+this.contentType.id?this.contentType.id:this.contentType):f.setContentType(this.contentType)}}},onServiceAdded:function(b,f){n(b)&&this.addServiceListener(f)},onServiceRemoved:function(b,
f){this.services.indexOf(f)!==-1&&this.removeServiceListener(f)},addServiceListener:function(b){if(typeof b.addEventListener==="function"){if(b.addEventListener("orion.edit.highlighter.styleReady",this.listener.onStyleReady),this.services.push(b),b.setContentType&&this.contentType){var g=this.serviceRegistry.getService("orion.page.progress");g?g.progress(b.setContentType(this.contentType),"Styling content type: "+this.contentType.id?this.contentType.id:this.contentType):b.setContentType(this.contentType)}}else typeof console!==
"undefined"&&console.log(Error(f))},removeServiceListener:function(b){typeof b.removeEventListener==="function"?(b.removeEventListener("orion.edit.highlighter.styleReady",this.listener.onStyleReady),b=this.services.indexOf(b),b!==-1&&this.services.splice(b,1)):typeof console!=="undefined"&&console.log(Error(f))}};return g});
define("orion/editor/mirror",["i18n!orion/editor/nls/messages","orion/editor/eventTarget","orion/editor/annotations"],function(j,o,n){function g(b){this.string=b;this.tokenStart=this.pos=0}function b(){this._modes={};this.mimeModes={};this.options={};this.StringStream=g}function f(b){var a=[],c;for(c in b)Object.prototype.hasOwnProperty.call(b,c)&&a.push(c);return a}function e(b,a,c){c=c||{};this.model=b;this.codeMirror=a;this.isWhitespaceVisible=typeof c.whitespacesVisible==="undefined"?!1:c.whitespacesVisible;
this.mode=null;this.isModeLoaded=!1;this.lines=[];this.dirtyLines=[];this.startLine=Number.MAX_VALUE;this.endLine=-1;this.timer=null;this.initialize(b)}function i(b,a,c){this.init(b,a,c)}g.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return this.pos===0},peek:function(){return this.string[this.pos]},next:function(){return this.string[this.pos++]},eat:function(b){var a=this.string[this.pos];return typeof a==="string"&&(a===b||b.test&&b.test(a)||typeof b==="function"&&
b(a))?this.string[this.pos++]:void 0},eatWhile:function(b){for(var a=!1;this.eat(b)!==void 0;)a=!0;return a},eatSpace:function(){return this.eatWhile(/\s/)},skipToEnd:function(){this.pos=this.string.length},skipTo:function(b){b=this.string.indexOf(b,this.pos);return b!==-1?(this.pos=b,!0):!1},match:function(b,a,c){a=a===!0||typeof a==="undefined";if(typeof b==="string"){var d=c?this.string.toLowerCase():this.string,b=c?b.toLowerCase():b,c=d.indexOf(b,this.pos);if(c!==-1&&a)this.pos=c+b.length;return c!==
-1}else return(b=this.string.substring(this.pos).match(b))&&a&&typeof b[0]==="string"&&(this.pos+=b.index+b[0].length),b},backUp:function(b){this.pos-=b},column:function(){for(var b=0,a=0;a<this.tokenStart;)b+=this.string[a++]==="\t"?4:1;return b},indentation:function(){for(var b=this.string.search(/\S/),a=0,c=0;c<b;)a+=this.string[c++]==="\t"?4:1;return a},current:function(){return this.string.substring(this.tokenStart,this.pos)},advance:function(){this.tokenStart=this.pos}};b.prototype={options:{},
setOption:function(b,a){this.options[b]=a},getOption:function(b){return this.options[b]},copyState:function(b,a){if(typeof b.copyState==="function")return b.copyState(a);var c={},d;for(d in a){var e=a[d];c[d]=e instanceof Array?e.slice():e}return c},defineMode:function(b,a){this._modes[b]=a},defineMIME:function(b,a){this.mimeModes[b]=a},getMode:function(b,a){var c={},d;typeof a==="string"&&this.mimeModes[a]&&(a=this.mimeModes[a]);typeof a==="object"&&(c=a,d=this._modes[a.name]);d=d||this._modes[a];
if(typeof d!=="function")throw"Mode not found "+a;return d(b,c)},listModes:function(){return f(this._modes)},listMIMEs:function(){return f(this.mimeModes)},_getModeName:function(b){b=this.mimeModes[b];if(typeof b==="object")b=b.name;return b}};e.prototype={initialize:function(){var b=this;this.listener={onModelChanging:function(a){b._onModelChanging(a)},onModelChanged:function(a){b._onModelChanged(a)},onDestroy:function(a){b._onDestroy(a)}};this.model.addEventListener("Changing",this.listener.onModelChanging);
this.model.addEventListener("Changed",this.listener.onModelChanged);this.model.addEventListener("Destroy",this.listener.onDestroy)},destroy:function(){this.model&&(this.model.removeEventListener("Changing",this.listener.onModelChanging),this.model.removeEventListener("Changed",this.listener.onModelChanged),this.model.removeEventListener("Destroy",this.listener.onDestroy));this.dirtyLines=this.lines=this.mode=this.codeMirror=this.model=null;clearTimeout(this.timer);this.timer=null},_onModelChanging:function(b){this.startLine=
this.model.getLineAtOffset(b.start)},_onModelChanged:function(b){this._dbgEvent(b);var a=this.startLine;(b.removedLineCount||b.addedLineCount)&&Array.prototype.splice.apply(this.lines,[a+1,b.removedLineCount].concat(this._newLines(b.addedLineCount)));this.mode&&(b=Math.max(b.addedLineCount,b.removedLineCount),b=a+Math.min(b,500),this.highlight(a,b),this.highlightLater(b+1))},_onDestroy:function(){this.destroy()},setViewportIndex:function(b){this.viewportIndex=b},_dbgEvent:function(){},_dbgStyle:function(){},
_newLines:function(b){for(var a=[],c=0;c<b;c++)a.push({style:null,eolState:null});return a},setMode:function(b,a){if(b)this.mode=this.codeMirror.getMode(this.codeMirror.options,b),this.lines=this._newLines(this.model.getLineCount()),a&&this.highlight()},highlight:function(b,a,c){if(this.mode){for(var d=this.model.getLineCount(),b=typeof b==="undefined"?0:b,a=typeof a==="undefined"?d-1:Math.min(a,d-1),d=this.mode,e=this.getState(b),f=b;f<=a;f++){var g=this.lines[f];this.highlightLine(f,g,e);g.eolState=
this.codeMirror.copyState(d,e)}this._expandRange(b,a);if(!c)this.onHighlightDone()}},highlightLater:function(b){this.dirtyLines.push(b);var a=this;this.timer=setTimeout(function(){a._highlightJob()},50)},_highlightJob:function(){for(var b=+new Date+30,a=this.mode.compareStates,c=this.model.getLineCount();this.dirtyLines.length;){var d=this.viewportIndex,e=this.lines[d],d=e&&!e.eolState?d:this.dirtyLines.pop();if(d>=c)break;this._expandRange(d,d);for(var e=this._getResumeLineIndex(d),d=e+1,e=(e=e>=
0&&this.lines[e].eolState)?this.codeMirror.copyState(this.mode,e):this.mode.startState(),f=0,g=d;g<c;g++){var i=this.lines[g],j=i.eolState,n=this.highlightLine(g,i,e);i.eolState=this.codeMirror.copyState(this.mode,e);n&&this._expandRange(d,g+1);var i=a&&j&&a(j,i.eolState),o=!a&&!n&&f++>3;if(i||o)break;else if(!j||n)f=0;j=g<c||this.dirtyLines.length;if(+new Date>b&&j){this.highlightLater(g+1);this.onHighlightDone();return}}}this.onHighlightDone()},onHighlightDone:function(){this.startLine!==Number.MAX_VALUE&&
this.endLine!==-1&&this.dispatchEvent({type:"Highlight",start:this.startLine,end:this.endLine});this.startLine=Number.MAX_VALUE;this.endLine=-1},_getResumeLineIndex:function(b){for(var a=this.lines,c=b-1;c>=0;c--)if(a[c].eolState||b-c>40)return c;return-1},getState:function(b){var a=this.mode,c=this.lines,d,e;for(d=b-1;d>=0;d--)if(e=c[d],e.eolState||b-d>40)break;var f=d>=0&&c[d].eolState;if(f){f=this.codeMirror.copyState(a,f);for(d=Math.max(0,d);d<b-1;d++)e=c[d],this.highlightLine(d,e,f),e.eolState=
this.codeMirror.copyState(a,f);return f}else return a.startState()},highlightLine:function(b,a,c){if(this.mode){var d=this.model;d.getLineStart(b)===d.getLineEnd(b)&&this.mode.blankLine&&this.mode.blankLine(c);for(var e=a.style||[],b=d.getLine(b),b=new g(b),d=!a.style,f=[],i=0;!b.eol();i++){var j=this.mode.token(b,c)||null,n=b.current();this._whitespaceStyle(j,n,b.tokenStart);j=[b.tokenStart,b.pos,j];n=e[i];f.push(j);d=d||!n||n[0]!==j[0]||n[1]!==j[1]||n[2]!==j[2];b.advance()}if(d=d||f.length!==e.length)a.style=
f.length?f:null;return d}},_whitespaceStyle:function(b,a,c){if(!b&&this.isWhitespaceVisible&&/\s+/.test(a)){for(var b=[],d,e,f=0;f<a.length;f++){var g=a[f];g!==e&&(e&&b.push([c+d,c+f,e==="\t"?"token_tab":"token_space"]),d=f,e=g)}b.push([c+d,c+f,e==="\t"?"token_tab":"token_space"]);return b}return null},_expandRange:function(b,a){this.startLine=Math.min(this.startLine,b);this.endLine=Math.max(this.endLine,a)},toStyleRangesAndErrors:function(b,a){var c=b.style;if(!c)return null;for(var d=[],e=[],f=
typeof a==="undefined"?0:this.model.getLineStart(a),g=0;g<c.length;g++){var i=c[g],j=!i[2]?null:i[2]==="token_tab"||i[2]==="token_space"?i[2]:"cm-"+i[2];j&&(i={start:f+i[0],end:f+i[1],style:{styleClass:j}},d.push(i),j==="cm-error"&&e.push(i))}return[d,e]},getLineStyle:function(b){return this.lines[b]},getLineStyles:function(){return this.lines}};o.EventTarget.addMixin(e.prototype);n.AnnotationType.registerType("orion.annotation.highlightError",{title:j.syntaxError,html:"<div class='annotationHTML error'></div>",
rangeStyle:{styleClass:"annotationRange error"}});i.prototype={init:function(b,a,c){this.textView=b;this.annotationModel=c;this.modeApplier=new e(b.getModel(),a);var d=this;this.listener={onLineStyle:function(a){d.onLineStyle(a)},onDestroy:function(a){d.onDestroy(a)},onHighlight:function(a){d.onHighlight(a)}};b.addEventListener("LineStyle",this.listener.onLineStyle);b.addEventListener("Destroy",this.listener.onDestroy);this.modeApplier.addEventListener("Highlight",this.listener.onHighlight)},destroy:function(){this.modeApplier&&
(this.modeApplier.removeEventListener("Highlight",this.listener.onHighlight),this.modeApplier.destroy());this.textView&&(this.textView.removeEventListener("LineStyle",this.listener.onLineStyle),this.textView.removeEventListener("Destroy",this.listener.onDestroy));this.listener=this.modeApplier=this.annotationModel=this.textView=null},setMode:function(b){this.modeApplier.setMode(b)},onLineStyle:function(b){var a=b.lineIndex,c=this.modeApplier,d=c.getLineStyle(a);if(!d||!d.eolState){var e=this.textView.getModel().getLineCount();
c.highlight(a,Math.min(a+20,e-1),!0);d=c.getLineStyle(a)}e=this.textView.getModel();if(d){var f=c.toStyleRangesAndErrors(d,a);if(f&&(b.ranges=f[0],b=this.annotationModel)){c=[];d=[];if(f=f[1])for(var g=0;g<f.length;g++){var i=f[g];i.style.styleClass==="cm-error"&&d.push(n.AnnotationType.createAnnotation("orion.annotation.highlightError",i.start,i.end))}for(a=b.getAnnotations(e.getLineStart(a),e.getLineEnd(a));a.hasNext();)e=a.next(),e.type==="orion.annotation.highlightError"&&c.push(e);b.replaceAnnotations(c,
d)}}},onHighlight:function(b){this.textView.redrawLines(b.start,b.end)},onDestroy:function(){this.destroy()}};return{Mirror:b,ModeApplier:e,CodeMirrorStyler:i}});
define("orion/editor/textMateStyler",["orion/regex"],function(j){function o(b){var f;if(b instanceof Array){f=Array(b.length);for(var e=0;e<b.length;e++)f[e]=o(b[e])}else for(e in f={},b)if(Object.prototype.hasOwnProperty.call(b,e)){var g=b[e];f[e]=typeof g==="object"&&g!==null?o(g):g}return f}function n(b,f,e){this.initialize(b);this.grammar=o(f);this.externalGrammars=e?o(e):[];this._styles={};this._tree=null;this._allGrammars={};this.preprocess(this.grammar)}var g={unsupported:[{regex:/\(\?[ims\-]:/,
func:function(){return"option on/off for subexp"}},{regex:/\(\?<([=!])/,func:function(b){return b[1]==="="?"lookbehind":"negative lookbehind"}},{regex:/\(\?>/,func:function(){return"atomic group"}}],toRegExp:function(b){function f(a,b){throw Error('Unsupported regex feature "'+a+'": "'+b[0]+'" at index: '+b.index+" in "+b.input);}var e="",i,b=g.processGlobalFlag("x",b,function(a){for(var b="",d=!1,e=a.length,f=0;f<e;){var h=a.charAt(f);if(!d&&h==="#")for(;f<e&&h!=="\r"&&h!=="\n";)h=a.charAt(++f);
else if(!d&&/\s/.test(h))for(;f<e&&/\s/.test(h);)h=a.charAt(++f);else h==="\\"?(b+=h,/\s/.test(a.charAt(f+1))||(b+=a.charAt(f+1),f+=1)):(h==="["?d=!0:h==="]"&&(d=!1),b+=h),f+=1}return b}),b=g.processGlobalFlag("i",b,function(a){e+="i";return a});for(i=0;i<this.unsupported.length;i++){var h;(h=this.unsupported[i].regex.exec(b))&&f(this.unsupported[i].func(h),h)}return RegExp(b,e)},processGlobalFlag:function(b,f,e){function g(a,b){for(var d=0,e=a.length,f=-1,h=b;h<e&&f===-1;h++)switch(a.charAt(h)){case "\\":h++;
break;case "(":d++;break;case ")":d--,d===0&&(f=h)}return f}var h="(?"+b+")",b="(?"+b+":";if(f.substring(0,h.length)===h)return e(f.substring(h.length));else if(f.substring(0,b.length)===b){h=g(f,0);if(h<f.length-1)throw Error("Only a "+b+") group that encloses the entire regex is supported in: "+f);return e(f.substring(b.length,h))}return f},hasBackReference:function(b){return/\\\d+/.test(b.source)},getSubstitutedRegex:function(b,f,e){for(var e=typeof e==="undefined"?!0:!1,b=b.source.split(/(\\\d+)/g),
g=[],h=0;h<b.length;h++){var a=b[h],c=/\\(\d+)/.exec(a);c?(a=f[c[1]]||"",g.push(e?j.escape(a):a)):g.push(a)}return RegExp(g.join(""))},groupify:function(b,f){for(var e=b.source,g=e.length,h=[],a=0,c=[],d=1,k=1,j=[],n={},o={},r=0;r<g;r++){var s=h[h.length-1],w=e.charAt(r);switch(w){case "(":if(s===4)h.pop(),j.push(")"),c[c.length-1].end=r;var u=r+2<g?e.charAt(r+1)+""+e.charAt(r+2):null;if(u==="?:"||u==="?="||u==="?!"){var v;u==="?:"?v=1:(v=3,a++);h.push(v);c.push({start:r,end:-1,type:v});j.push(w);
j.push(u);r+=u.length}else h.push(2),c.push({start:r,end:-1,type:2,oldNum:d,num:k}),j.push(w),a===0&&(o[k]=null),n[d]=k,d++,k++;break;case ")":s=h.pop();s===3&&a--;c[c.length-1].end=r;j.push(w);break;case "*":case "+":case "?":case "}":var l=w,t=e.charAt(r-1),u=r-1;if(w==="}"){for(v=r-1;e.charAt(v)!=="{"&&v>=0;v--);t=e.charAt(v-1);u=v-1;l=e.substring(v,r+1)}v=c[c.length-1];if(t===")"&&(v.type===2||v.type===4)){j.splice(v.start,0,"(");j.push(l);j.push(")");w={start:v.start,end:j.length-1,type:4,num:v.num};
for(t=0;t<c.length;t++)if(s=c[t],(s.type===2||s.type===4)&&s.start>=v.start&&s.end<=u)if(s.start+=1,s.end+=1,s.num+=1,s.type===2)n[s.oldNum]=s.num;c.push(w);k++;break}default:w!=="|"&&s!==2&&s!==4&&a===0&&(h.push(4),c.push({start:r,end:-1,type:4,num:k}),j.push("("),o[k]=null,k++),j.push(w),w==="\\"&&(w=e.charAt(r+1),j.push(w),r+=1)}}for(;h.length;)h.pop(),j.push(")");var e=RegExp(j.join("")),g={},f=f||n,x;for(x in f)f.hasOwnProperty(x)&&(g[x]="\\"+f[x]);e=this.getSubstitutedRegex(e,g,!1);return[e,
n,o]},complexCaptures:function(b){if(!b)return!1;for(var f in b)if(b.hasOwnProperty(f)&&f!=="0")return!0;return!1}};n.prototype={initialize:function(b){this.textView=b;this.textView.stylerOptions=this;var f=this;this._listener={onModelChanged:function(b){f.onModelChanged(b)},onDestroy:function(b){f.onDestroy(b)},onLineStyle:function(b){f.onLineStyle(b)},onStorage:function(b){f.onStorage(b)}};b.addEventListener("ModelChanged",this._listener.onModelChanged);b.addEventListener("Destroy",this._listener.onDestroy);
b.addEventListener("LineStyle",this._listener.onLineStyle);b.redrawLines()},onDestroy:function(){this.destroy()},destroy:function(){if(this.textView)this.textView.removeEventListener("ModelChanged",this._listener.onModelChanged),this.textView.removeEventListener("Destroy",this._listener.onDestroy),this.textView.removeEventListener("LineStyle",this._listener.onLineStyle),this.textView=null;this._listener=this._tree=this._styles=this.grammar=null},preprocess:function(b){for(b=[b];b.length!==0;){var f=
b.pop();if(!f._resolvedRule||!f._typedRule)if(f._resolvedRule=this._resolve(f),f._typedRule=this._createTypedRule(f),this.addStyles(f.name),this.addStyles(f.contentName),this.addStylesForCaptures(f.captures),this.addStylesForCaptures(f.beginCaptures),this.addStylesForCaptures(f.endCaptures),f._resolvedRule!==f&&b.push(f._resolvedRule),f.patterns)for(var e=0;e<f.patterns.length;e++)b.push(f.patterns[e])}},addStyles:function(b){if(b&&!this._styles[b]){this._styles[b]=[];for(var f=b.split("."),e=0;e<
f.length;e++)this._styles[b].push(f.slice(0,e+1).join("-"))}},addStylesForCaptures:function(b){for(var f in b)b.hasOwnProperty(f)&&this.addStyles(b[f].name)},ContainerRule:function(){function b(b){this.rule=b;this.subrules=b.patterns}b.prototype.valueOf=function(){return"aa"};return b}(),BeginEndRule:function(){function b(b){this.rule=b;this.beginRegex=g.toRegExp(b.begin);this.endRegex=g.toRegExp(b.end);this.subrules=b.patterns||[];this.endRegexHasBackRef=g.hasBackReference(this.endRegex);var e=g.complexCaptures(b.captures),
b=g.complexCaptures(b.beginCaptures)||g.complexCaptures(b.endCaptures);if(this.isComplex=e||b)e=g.groupify(this.beginRegex),this.beginRegex=e[0],this.beginOld2New=e[1],this.beginConsuming=e[2],e=g.groupify(this.endRegex,this.beginOld2New),this.endRegex=e[0],this.endOld2New=e[1],this.endConsuming=e[2]}b.prototype.valueOf=function(){return this.beginRegex};return b}(),MatchRule:function(){function b(b){this.rule=b;this.matchRegex=g.toRegExp(b.match);if(this.isComplex=g.complexCaptures(b.captures))b=
g.groupify(this.matchRegex),this.matchRegex=b[0],this.matchOld2New=b[1],this.matchConsuming=b[2]}b.prototype.valueOf=function(){return this.matchRegex};return b}(),_createTypedRule:function(b){return b.match?new this.MatchRule(b):b.begin?new this.BeginEndRule(b):new this.ContainerRule(b)},_resolve:function(b){var f=b;if(b.include){if(b.begin||b.end||b.match)throw Error('Unexpected regex pattern in "include" rule '+b.include);b=b.include;if(b.charAt(0)==="#"){if(f=this.grammar.repository&&this.grammar.repository[b.substring(1)],
!f)throw Error("Couldn't find included rule "+b+" in grammar repository");}else if(b==="$self")f=this.grammar;else if(b==="$base")throw Error('Include "$base" is not supported');else if(f=this._allGrammars[b],!f)for(var e=0;e<this.externalGrammars.length;e++){var g=this.externalGrammars[e];if(g.scopeName===b){this.preprocess(g);f=this._allGrammars[b]=g;break}}}return f},ContainerNode:function(){function b(b,e){this.parent=b;this.rule=e;this.children=[];this.end=this.start=null}b.prototype.addChild=
function(b){this.children.push(b)};b.prototype.valueOf=function(){var b=this.rule;return"ContainerNode { "+(b.include||"")+" "+(b.name||"")+(b.comment||"")+"}"};return b}(),BeginEndNode:function(){function b(b,e,i){this.parent=b;this.rule=e;this.children=[];this.setStart(i);this.endMatch=this.end=null;this.endRegexSubstituted=e.endRegexHasBackRef?g.getSubstitutedRegex(e.endRegex,i):null}b.prototype.addChild=function(b){this.children.push(b)};b.prototype.getIndexInParent=function(){return this.parent?
this.parent.children.indexOf(this):-1};b.prototype.setStart=function(b){this.start=b.index;this.beginMatch=b};b.prototype.setEnd=function(b){b&&typeof b==="object"?(this.endMatch=b,this.end=b.index+b[0].length):(this.endMatch=null,this.end=b)};b.prototype.shiftStart=function(b){this.start+=b;this.beginMatch.index+=b};b.prototype.shiftEnd=function(b){this.end+=b;this.endMatch&&(this.endMatch.index+=b)};b.prototype.valueOf=function(){return"{"+this.rule.beginRegex+" range="+this.start+".."+this.end+
"}"};return b}(),push:function(b,f){if(f)for(var e=f.length;e>0;)b.push(f[--e])},exec:function(b,f,e){(f=b.exec(f))&&(f.index+=e);b.lastIndex=0;return f},afterMatch:function(b){return b.index+b[0].length},getEndMatch:function(b,f,e){if(b instanceof this.BeginEndNode){var g=b.rule,b=b.endRegexSubstituted||g.endRegex;return!b?null:this.exec(b,f,e)}return null},initialParse:function(){this.textView.getModel().getCharCount();this._tree=new this.ContainerNode(null,this.grammar._typedRule);this.parse(this._tree,
!1,0)},onModelChanged:function(b){var f=b.addedCharCount,e=b.removedCharCount,b=b.start;if(this._tree){var g=this.textView.getModel(),h=g.getCharCount(),g=g.getLineEnd(g.getLineAtOffset(b)-1),a=this.getFirstDamaged(g,g),g=g===-1?0:g,f=a?this.parse(a,!0,g,b,f,e):h;this.textView.redrawRange(g,f)}else this.initialParse()},getFirstDamaged:function(b,f){if(b<0)return this._tree;for(var e=[this._tree],g=null;e.length;){var h=e.pop();if(!h.parent||this.isDamaged(h,b,f)){h instanceof this.BeginEndNode&&(g=
h);for(var a=0;a<h.children.length;a++)e.push(h.children[a])}}return g||this._tree},isDamaged:function(b,f,e){return b.start<=e&&b.end>f},parse:function(b,f,e,g,h,a){var c=this.textView.getModel(),d=c.getLineStart(c.getLineCount()-1),k=c.getCharCount(),j=this.getInitialExpected(b,e),n=-1;if(f)b.repaired=!0,b.endNeedsUpdate=!0,n=(n=b.children[b.children.length-1])?c.getLineEnd(c.getLineAtOffset(n.end+(h-a))):-1,g=c.getLineEnd(c.getLineAtOffset(g+a)),n=Math.max(n,g);for(var n=n===-1?k:n,g=j,o=b,r=!1,
s=e,w=-1;o&&(!f||s<n);){var u=this.getNextMatch(c,o,s);u||(s=s>=d?k:c.getLineStart(c.getLineAtOffset(s)+1));var v=u&&u.match,l=u&&u.rule,t=u&&u.isEnd;if(u&&u.isSub){if(s=this.afterMatch(v),l instanceof this.BeginEndRule)r=!0,f&&l===g.rule&&o===g.parent?(o=g,o.setStart(v),o.repaired=!0,o.endNeedsUpdate=!0,g=this.getNextExpected(g,"begin")):(f&&(this.prune(o,g),f=!1),v=new this.BeginEndNode(o,l,v),o.addChild(v),o=v)}else if(t||s===k){if(o instanceof this.BeginEndNode)v?(r=!0,w=Math.max(w,o.end),o.setEnd(v),
s=this.afterMatch(v),f&&o===g&&o.parent===g.parent?(o.repaired=!0,delete o.endNeedsUpdate,g=this.getNextExpected(g,"end")):f&&(this.prune(o,g),f=!1)):(o.setEnd(k),delete o.endNeedsUpdate);o=o.parent}f&&s>=n&&!r&&(this.prune(b,j),f=!1)}this.removeUnrepairedChildren(b,f,e);this.cleanup(f,b,e,n,k,h,a);return f?Math.max(w,s):s},removeUnrepairedChildren:function(b,f,e){if(f){for(var f=b.children,g=-1,h=0;h<f.length;h++){var a=f[h];if(!a.repaired&&this.isDamaged(a,e,Number.MAX_VALUE)){g=h;break}}if(g!==
-1)b.children.length=g}},cleanup:function(b,f,e,g,h,a,c){if(b){b=a-c;h=this.getIntersecting(g-b+1,h);f=this.getIntersecting(e,g);for(e=0;e<h.length;e++)g=h[e],!g.repaired&&g instanceof this.BeginEndNode&&(g.shiftEnd(b),g.shiftStart(b));for(e=0;e<f.length;e++)g=f[e],g.repaired&&g.endNeedsUpdate&&g.shiftEnd(b),delete g.endNeedsUpdate,delete g.repaired}else{f=this.getIntersecting(e,g);for(e=0;e<f.length;e++)delete f[e].repaired}},getNextMatch:function(b,f,e,g){var h=b.getLineAtOffset(e),h=b.getLineEnd(h),
a=b.getText(e,h),c=[],d=[],b=[],h=[];for(this.push(c,f.rule.subrules);c.length;){var k=c.length?c.pop():null,k=k&&k._resolvedRule._typedRule;if(k instanceof this.ContainerRule&&d.indexOf(k)===-1)d.push(k),this.push(c,k.subrules);else if(!k||!g||k.matchRegex){var j=k&&this.exec(k.matchRegex||k.beginRegex,a,e);j&&(b.push(j),h.push(k))}}c=Number.MAX_VALUE;d=-1;for(k=0;k<b.length;k++)if(j=b[k],j.index<c)c=j.index,d=k;if(!g&&(e=this.getEndMatch(f,a,e)))if(g=f.rule.applyEndPatternLast,d===-1||e.index<c||
!g&&e.index===c)return{isEnd:!0,rule:f.rule,match:e};return d===-1?null:{isSub:!0,rule:h[d],match:b[d]}},getInitialExpected:function(b,f){var e,g;if(b===this._tree)for(e=0;e<b.children.length;e++){if(g=b.children[e],g.start>=f)return g}else if(b instanceof this.BeginEndNode&&b.endMatch){var h=b.endMatch.index;for(e=0;e<b.children.length;e++)if(g=b.children[e],g.start>=f)break;if(g&&g.start<h)return g}return b},getNextExpected:function(b,f){if(f==="begin"){var e=b.children[0];return e?e:b}else if(f===
"end"&&(e=b.parent)){var g=e.children[e.children.indexOf(b)+1];return g?g:e}return null},prune:function(b,f){if(f.parent===b)b.children.length=f.getIndexInParent();else if(b instanceof this.BeginEndNode)b.endMatch=null,b.end=null;if(b.parent)b.parent.children.length=b.getIndexInParent()+1},onLineStyle:function(b){this._tree||this.initialParse();var f=b.lineStart,e=this.textView.getModel(),g=e.getLineEnd(b.lineIndex),h=e.getLineEnd(e.getLineAtOffset(f)-1),h=this.getFirstDamaged(h,h),f=this.getLineScope(e,
h,f,g);b.ranges=this.toStyleRanges(f);b.ranges.sort(function(a,b){return a.start-b.start})},getLineScope:function(b,f,e,g){for(var h=e,a=this.getInitialExpected(f,e),c=[],d=[];f&&h<g;){var k=this.getNextMatch(b,f,h);if(!k)break;var j=k&&k.match,n=k&&k.rule,o=k&&k.isSub,k=k&&k.isEnd;j.index!==h&&d.push({start:h,end:j.index,node:f});if(o)h=this.afterMatch(j),n instanceof this.BeginEndRule?(this.addBeginScope(c,j,n),f=a,a=this.getNextExpected(a,"begin")):this.addMatchScope(c,j,n);else if(k)h=this.afterMatch(j),
this.addEndScope(c,j,n),a=this.getNextExpected(a,"end"),f=f.parent}h<g&&d.push({start:h,end:g,node:f});b=this.getInheritedLineScope(d,e,g);return c.concat(b)},getInheritedLineScope:function(b){for(var f=[],e=0;e<b.length;e++)for(var g=b[e],h=g.node;h;){var a=h.rule.rule,c=a.name;if(a=a.contentName||c){this.addScopeRange(f,g.start,g.end,a);break}h=h.parent}return f},addBeginScope:function(b,f,e){var g=e.rule;this.addCapturesScope(b,f,g.beginCaptures||g.captures,e.isComplex,e.beginOld2New,e.beginConsuming)},
addEndScope:function(b,f,e){var g=e.rule;this.addCapturesScope(b,f,g.endCaptures||g.captures,e.isComplex,e.endOld2New,e.endConsuming)},addMatchScope:function(b,f,e){var g=e.rule,h=g.name;(g=g.captures)?this.addCapturesScope(b,f,g,e.isComplex,e.matchOld2New,e.matchConsuming):this.addScope(b,f,h)},addScope:function(b,f,e){e&&b.push({start:f.index,end:this.afterMatch(f),scope:e})},addScopeRange:function(b,f,e,g){g&&b.push({start:f,end:e,scope:g})},addCapturesScope:function(b,f,e,g,h,a){if(e)if(g){for(var g=
{1:0},c=0,d=1;f[d]!==void 0;d++)a[d]!==void 0&&(c+=f[d].length),f[d+1]!==void 0&&(g[d+1]=c);a=f.index;for(c=1;e[c];c++){var d=e[c].name,j=h[c],m=a+g[j];typeof f[j]!=="undefined"&&this.addScopeRange(b,m,m+f[j].length,d)}}else this.addScope(b,f,e[0]&&e[0].name)},getIntersecting:function(b,f){for(var e=[],g=this._tree?[this._tree]:[];g.length;){var h=g.pop(),a=!1;h instanceof this.ContainerNode?a=!0:this.isDamaged(h,b,f)&&(a=!0,e.push(h));if(a)for(var a=h.children.length,c=0;c<a;c++)g.push(h.children[c])}return e.reverse()},
toStyleRanges:function(b){for(var f=[],e=0;e<b.length;e++){var g=b[e],h=this._styles[g.scope];if(!h)throw Error("styles not found for "+g.scope);h=h.join(" ");f.push({start:g.start,end:g.end,style:{styleClass:h}})}return f}};return{RegexUtil:g,TextMateStyler:n}});
define("orion/editor/htmlGrammar",[],function(){return{HtmlGrammar:function(){return{scopeName:"source.html",uuid:"3B5C76FB-EBB5-D930-F40C-047D082CE99B",patterns:[{begin:"<!(doctype|DOCTYPE)",end:">",contentName:"entity.name.tag.doctype.html",beginCaptures:{0:{name:"entity.name.tag.doctype.html"}},endCaptures:{0:{name:"entity.name.tag.doctype.html"}}},{begin:"<\!--",end:"--\>",beginCaptures:{0:{name:"punctuation.definition.comment.html"}},endCaptures:{0:{name:"punctuation.definition.comment.html"}},
patterns:[{match:"--",name:"invalid.illegal.badcomment.html"}],contentName:"comment.block.html"},{match:"<[A-Za-z0-9_\\-:]+(?= ?)",name:"entity.name.tag.html"},{include:"#attrName"},{include:"#qString"},{include:"#qqString"},{include:"#entity"},{match:"</[A-Za-z0-9_\\-:]+>",name:"entity.name.tag.html"},{match:">",name:"entity.name.tag.html"}],repository:{attrName:{match:"[A-Za-z\\-:]+(?=\\s*=\\s*['\"])",name:"entity.other.attribute.name.html"},qqString:{match:'(")[^"]+(")',name:"string.quoted.double.html"},
qString:{match:"(')[^']+(')",name:"string.quoted.single.html"},entity:{match:"&[A-Za-z0-9]+;",name:"constant.character.entity.html"}}}}}});
define("examples/editor/textStyler",["orion/editor/annotations","orion/editor/keywords"],function(j,o){function n(a,b){this.keywords=a;this.whitespacesVisible=b;this.setText("")}function g(){n.call(this,null,!0)}function b(a){n.call(this,null,a)}function f(){n.call(this,null,!1)}function e(c,d,e){this.commentStart="/*";this.commentEnd="*/";var j=[];switch(d){case "java":j=h;break;case "js":j=i;break;case "css":j=a}this.whitespacesVisible=this.spacesVisible=this.tabsVisible=!1;this.detectHyperlinks=
!0;this.highlightCaretLine=!1;this.detectTasks=this.foldingEnabled=!0;this._scanner=new n(j,this.whitespacesVisible);this._firstScanner=new f;this._commentScanner=new b(this.whitespacesVisible);this._whitespaceScanner=new g;if(d==="css")this._scanner.isCSS=!0,this._firstScanner.isCSS=!0;this.view=c;this.annotationModel=e;this._bracketAnnotations=void 0;var k=this;this._listener={onChanged:function(a){k._onModelChanged(a)},onDestroy:function(a){k._onDestroy(a)},onLineStyle:function(a){k._onLineStyle(a)},
onMouseDown:function(a){k._onMouseDown(a)},onSelection:function(a){k._onSelection(a)}};d=c.getModel();d.getBaseModel&&(d=d.getBaseModel());d.addEventListener("Changed",this._listener.onChanged);c.addEventListener("MouseDown",this._listener.onMouseDown);c.addEventListener("Selection",this._listener.onSelection);c.addEventListener("Destroy",this._listener.onDestroy);c.addEventListener("LineStyle",this._listener.onLineStyle);this._computeComments();this._computeFolding();c.redrawLines()}var i=o.JSKeywords,
h=o.JAVAKeywords,a=o.CSSKeywords,c={styleClass:"token_singleline_comment"},d={styleClass:"token_multiline_comment"},k={styleClass:"token_doc_comment"},m={styleClass:"token_doc_html_markup"},p={styleClass:"token_task_tag"},q={styleClass:"token_doc_tag"},r={styleClass:"token_string"},s={styleClass:"token_number"},w={styleClass:"token_keyword"},u={styleClass:"token_space",unmergeable:!0},v={styleClass:"token_tab",unmergeable:!0},l={styleClass:"line_caret"};n.prototype={getOffset:function(){return this.offset},
getStartOffset:function(){return this.startOffset},getData:function(){return this.text.substring(this.startOffset,this.offset)},getDataLength:function(){return this.offset-this.startOffset},_default:function(a){switch(a){case 32:case 9:if(this.whitespacesVisible)return a===32?11:10;do a=this._read();while(a===32||a===9);this._unread(a);return 9;case 123:case 125:case 40:case 41:case 91:case 93:case 60:case 62:return a;default:var b=this.isCSS,c=this.offset-1;if(!b&&48<=a&&a<=57){var d=b=!1,e=!1,f=
a;do if(a=this._read(),a===46&&!b)b=!0;else if(a===101&&!d)b=d=!0,a=this._read(),a!==45&&this._unread(a);else if(a===120&&f===48&&this.offset-c===2)b=d=e=!0;else if(!(48<=a&&a<=57||e&&(65<=a&&a<=70||97<=a&&a<=102)))break;while(1);this._unread(a);return 3}if(97<=a&&a<=122||65<=a&&a<=90||a===95||45===a&&b){do a=this._read();while(97<=a&&a<=122||65<=a&&a<=90||a===95||48<=a&&a<=57||45===a&&b);this._unread(a);a=this.keywords;if(a.length>0){c=this.text.substring(c,this.offset);for(b=0;b<a.length;b++)if(this.keywords[b]===
c)return 2}}return 1}},_read:function(){return this.offset<this.text.length?this.text.charCodeAt(this.offset++):-1},_unread:function(a){a!==-1&&this.offset--},nextToken:function(){for(this.startOffset=this.offset;;){var a=this._read(),b;switch(a){case -1:return null;case 47:a=this._read();if(!this.isCSS&&a===47)for(;;)if(a=this._read(),a===-1||a===10||a===13)return this._unread(a),6;if(a===42){a=this._read();b=7;for(a===42&&(b=8);;){for(;a===42;)if(a=this._read(),a===47)return b;if(a===-1)return this._unread(a),
b;a=this._read()}}this._unread(a);return 1;case 39:for(b=4;;)switch(a=this._read(),a){case 39:return b;case 13:case 10:case -1:return this._unread(a),b;case 92:switch(a=this._read(),a){case 10:b=5;break;case 13:b=5,a=this._read(),a!==10&&this._unread(a)}}break;case 34:for(b=4;;)switch(a=this._read(),a){case 34:return b;case 13:case 10:case -1:return this._unread(a),b;case 92:switch(a=this._read(),a){case 10:b=5;break;case 13:b=5,a=this._read(),a!==10&&this._unread(a)}}break;default:return this._default(a)}}},
setText:function(a){this.text=a;this.startOffset=this.offset=0}};g.prototype=new n(null);g.prototype.nextToken=function(){for(this.startOffset=this.offset;;){var a=this._read();switch(a){case -1:return null;case 32:return 11;case 9:return 10;default:do a=this._read();while(!(a===32||a===9||a===-1));this._unread(a);return 1}}};b.prototype=new n(null);b.prototype.setType=function(a){this._type=a};b.prototype.nextToken=function(){for(this.startOffset=this.offset;;){var a=this._read();switch(a){case -1:return null;
case 32:case 9:if(this.whitespacesVisible)return a===32?11:10;do a=this._read();while(a===32||a===9);this._unread(a);return 9;case 60:if(this._type===8){do a=this._read();while(!(a===62||a===-1));if(a===62)return 12}return 1;case 64:if(this._type===8){do a=this._read();while(97<=a&&a<=122||65<=a&&a<=90||a===95||48<=a&&a<=57);this._unread(a);return 13}return 1;case 84:if((a=this._read())===79)if((a=this._read())===68)if((a=this._read())===79)if(a=this._read(),!(97<=a&&a<=122||65<=a&&a<=90||a===95||
48<=a&&a<=57))return this._unread(a),14;this._unread(a);default:do a=this._read();while(!(a===32||a===9||a===-1||a===60||a===64||a===84));this._unread(a);return 1}}};f.prototype=new n(null);f.prototype._default=function(a){for(;;)switch(a=this._read(),a){case 47:case 34:case 39:case -1:return this._unread(a),1}};e.prototype={destroy:function(){var a=this.view;if(a){var b=a.getModel();b.getBaseModel&&(b=b.getBaseModel());b.removeEventListener("Changed",this._listener.onChanged);a.removeEventListener("MouseDown",
this._listener.onMouseDown);a.removeEventListener("Selection",this._listener.onSelection);a.removeEventListener("Destroy",this._listener.onDestroy);a.removeEventListener("LineStyle",this._listener.onLineStyle);this.view=null}},setHighlightCaretLine:function(a){this.highlightCaretLine=a},setWhitespacesVisible:function(a,b){if(this.whitespacesVisible!==a)this.whitespacesVisible=a,this._scanner.whitespacesVisible=a,this._commentScanner.whitespacesVisible=a,b&&this.view.redraw()},setTabsVisible:function(a){if(this.tabsVisible!==
a)this.tabsVisible=a,this.setWhitespacesVisible(this.tabsVisible||this.spacesVisible,!1),this.view.redraw()},setSpacesVisible:function(a){if(this.spacesVisible!==a)this.spacesVisible=a,this.setWhitespacesVisible(this.tabsVisible||this.spacesVisible,!1),this.view.redraw()},setDetectHyperlinks:function(a){this.detectHyperlinks=a},setFoldingEnabled:function(a){this.foldingEnabled=a},setDetectTasks:function(a){this.detectTasks=a},_binarySearch:function(a,b,c,d,e){var f;d===void 0&&(d=-1);if(e===void 0)e=
a.length;for(;e-d>1;)if(f=Math.floor((e+d)/2),b<=a[f].start)e=f;else if(c&&b<a[f].end){e=f;break}else d=f;return e},_computeComments:function(){var a=this.view.getModel();a.getBaseModel&&(a=a.getBaseModel());this.comments=this._findComments(a.getText())},_computeFolding:function(){if(this.foldingEnabled){var a=this.view.getModel();if(a.getBaseModel){var b=this.annotationModel;if(b){b.removeAnnotations(j.AnnotationType.ANNOTATION_FOLDING);for(var c=[],d=a.getBaseModel(),e=this.comments,f=0;f<e.length;f++){var g=
e[f];(g=this._createFoldingAnnotation(a,d,g.start,g.end))&&c.push(g)}b.replaceAnnotations(null,c)}}}},_createFoldingAnnotation:function(a,b,c,d){var e=b.getLineAtOffset(c),b=b.getLineAtOffset(d);return e===b?null:new (j.AnnotationType.getType(j.AnnotationType.ANNOTATION_FOLDING))(c,d,a)},_computeTasks:function(a,b,c){if(this.detectTasks){var d=this.annotationModel;if(d){var e=this.view.getModel(),f=e;e.getBaseModel&&(f=e.getBaseModel());for(var g=d.getAnnotations(b,c),e=[],h=j.AnnotationType.ANNOTATION_TASK;g.hasNext();){var i=
g.next();i.type===h&&e.push(i)}g=[];i=this._commentScanner;i.setText(f.getText(b,c));for(var k;k=i.nextToken();){var l=i.getStartOffset()+b;k===14&&(k=f.getLineEnd(f.getLineAtOffset(l)),a!==6&&(k=Math.min(k,c-this.commentEnd.length)),g.push(j.AnnotationType.createAnnotation(h,l,k,f.getText(l,k))))}d.replaceAnnotations(e,g)}}},_getLineStyle:function(a){if(this.highlightCaretLine){var b=this.view,c=b.getModel(),b=b.getSelection();if(b.start===b.end&&c.getLineAtOffset(b.start)===a)return l}return null},
_getStyles:function(a,b,c){a.getBaseModel&&(c=a.mapOffset(c));for(var e=c+b.length,f=[],g=c,h=this.comments,i=this._binarySearch(h,c,!0);i<h.length;i++){if(h[i].start>=e)break;var j=h[i].start,l=h[i].end;g<j&&this._parse(b.substring(g-c,j-c),g,f);var m=h[i].type,n;switch(m){case 8:n=k;break;case 7:n=d;break;case 5:n=r}g=Math.max(g,j);j=Math.min(e,l);(m===8||m===7)&&(this.whitespacesVisible||this.detectHyperlinks)?this._parseComment(b.substring(g-c,j-c),g,f,n,m):m===5&&this.whitespacesVisible?this._parseString(b.substring(g-
c,j-c),g,f,r):f.push({start:g,end:j,style:n});g=l}g<e&&this._parse(b.substring(g-c,e-c),g,f);if(a.getBaseModel)for(b=0;b<f.length;b++)c=f[b].end-f[b].start,f[b].start=a.mapOffset(f[b].start,!0),f[b].end=f[b].start+c;return f},_parse:function(a,b,e){var f=this._scanner;for(f.setText(a);a=f.nextToken();){var g=f.getStartOffset()+b,h=null;switch(a){case 2:h=w;break;case 3:h=s;break;case 5:case 4:if(this.whitespacesVisible){this._parseString(f.getData(),g,e,r);continue}else h=r;break;case 8:this._parseComment(f.getData(),
g,e,k,a);continue;case 6:this._parseComment(f.getData(),g,e,c,a);continue;case 7:this._parseComment(f.getData(),g,e,d,a);continue;case 10:this.whitespacesVisible&&this.tabsVisible&&(h=v);break;case 11:this.whitespacesVisible&&this.spacesVisible&&(h=u)}e.push({start:g,end:f.getOffset()+b,style:h})}},_parseComment:function(a,b,c,d,e){var f=this._commentScanner;f.setText(a);for(f.setType(e);a=f.nextToken();){var e=f.getStartOffset()+b,g=d;switch(a){case 10:this.whitespacesVisible&&this.tabsVisible&&
(g=v);break;case 11:this.whitespacesVisible&&this.spacesVisible&&(g=u);break;case 12:g=m;break;case 13:g=q;break;case 14:g=p;break;default:this.detectHyperlinks&&(g=this._detectHyperlinks(f.getData(),e,c,g))}g&&c.push({start:e,end:f.getOffset()+b,style:g})}},_parseString:function(a,b,c,d){var e=this._whitespaceScanner;for(e.setText(a);a=e.nextToken();){var f=e.getStartOffset()+b,g=d;switch(a){case 10:this.whitespacesVisible&&this.tabsVisible&&(g=v);break;case 11:this.whitespacesVisible&&this.spacesVisible&&
(g=u)}g&&c.push({start:f,end:e.getOffset()+b,style:g})}},_detectHyperlinks:function(a,b,c,d){var e=null,f;if((f=a.indexOf("://"))>0){for(var e=a,g=f;g>0;){f=e.charCodeAt(g-1);if(!(97<=f&&f<=122||65<=f&&f<=90||45===f||48<=f&&f<=57))break;g--}if(g>0&&(f="\"\"''(){}[]<>".indexOf(e.substring(g-1,g)),f!==-1&&(f&1)===0&&(f=e.lastIndexOf("\"\"''(){}[]<>".substring(f+1,f+2)))!==-1)){var h=f;f=this._clone(d);f.tagName="a";f.attributes={href:e.substring(g,h)};c.push({start:b,end:b+g,style:d});c.push({start:b+
g,end:b+h,style:f});c.push({start:b+h,end:b+a.length,style:d});return null}}else a.toLowerCase().indexOf("bug#")===0&&(e="https://bugs.eclipse.org/bugs/show_bug.cgi?id="+parseInt(a.substring(4),10));return e?(f=this._clone(d),f.tagName="a",f.attributes={href:e},f):d},_clone:function(a){if(!a)return a;var b={},c;for(c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},_findComments:function(a,b){var b=b||0,c=this._firstScanner,d;c.setText(a);for(var e=[];d=c.nextToken();)(d===7||d===8||d===5)&&e.push({start:c.getStartOffset()+
b,end:c.getOffset()+b,type:d}),(d===6||d===7||d===8)&&this._computeTasks(d,c.getStartOffset()+b,c.getOffset()+b);return e},_findMatchingBracket:function(a,b){var c="{}()[]<>",d=a.getText(b,b+1),e=c.indexOf(d,0);if(e===-1)return-1;var f;f=e&1?c.substring(e-1,e):c.substring(e+1,e+2);for(var g=a.getLineAtOffset(b),c=a.getLine(g),h=a.getLineStart(g),i=a.getLineEnd(g),c=this._findBrackets(d,f,c,h,h,i),i=0;i<c.length;i++)if(h=c[i]>=0?1:-1,c[i]*h-1===b){var j=1;if(e&1){for(i--;i>=0;i--)if(h=c[i]>=0?1:-1,
j+=h,j===0)return c[i]*h-1;for(g-=1;g>=0;){c=a.getLine(g);h=a.getLineStart(g);i=a.getLineEnd(g);c=this._findBrackets(d,f,c,h,h,i);for(e=c.length-1;e>=0;e--)if(h=c[e]>=0?1:-1,j+=h,j===0)return c[e]*h-1;g--}}else{for(i++;i<c.length;i++)if(h=c[i]>=0?1:-1,j+=h,j===0)return c[i]*h-1;g+=1;for(e=a.getLineCount();g<e;){c=a.getLine(g);h=a.getLineStart(g);i=a.getLineEnd(g);c=this._findBrackets(d,f,c,h,h,i);for(i=0;i<c.length;i++)if(h=c[i]>=0?1:-1,j+=h,j===0)return c[i]*h-1;g++}}break}return-1},_findBrackets:function(a,
b,c,d,e,f){for(var g=[],a=a.charCodeAt(0),b=b.charCodeAt(0),h=e,i=this._scanner,j,k=this.comments,l=this._binarySearch(k,e,!0);l<k.length;l++){if(k[l].start>=f)break;j=k[l].start;var m=k[l].end;if(h<j)for(i.setText(c.substring(h-e,j-e));j=i.nextToken();)j===a?g.push(i.getStartOffset()+h-e+d+1):j===b&&g.push(-(i.getStartOffset()+h-e+d+1));h=m}if(h<f)for(i.setText(c.substring(h-e,f-e));j=i.nextToken();)j===a?g.push(i.getStartOffset()+h-e+d+1):j===b&&g.push(-(i.getStartOffset()+h-e+d+1));return g},_onDestroy:function(){this.destroy()},
_onLineStyle:function(a){if(a.textView===this.view)a.style=this._getLineStyle(a.lineIndex);a.ranges=this._getStyles(a.textView.getModel(),a.lineText,a.lineStart)},_onSelection:function(a){var b=a.oldValue,c=a.newValue,d=this.view,a=d.getModel(),e;if(this.highlightCaretLine){var f=a.getLineAtOffset(b.start);e=a.getLineAtOffset(c.start);var g=c.start===c.end,b=b.start===b.end;f===e&&b&&g||(b&&d.redrawLines(f,f+1),(f!==e||!b)&&g&&d.redrawLines(e,e+1))}if(this.annotationModel){var b=this._bracketAnnotations,
h,i;if(c.start===c.end&&(i=d.getCaretOffset())>0)i-=1,a.getBaseModel&&(i=a.mapOffset(i),a=a.getBaseModel()),a=this._findMatchingBracket(a,i),a!==-1&&(h=[j.AnnotationType.createAnnotation(j.AnnotationType.ANNOTATION_MATCHING_BRACKET,a,a+1),j.AnnotationType.createAnnotation(j.AnnotationType.ANNOTATION_CURRENT_BRACKET,i,i+1)]);this._bracketAnnotations=h;this.annotationModel.replaceAnnotations(b,h)}},_onMouseDown:function(a){if(a.clickCount===2){var b=this.view,c=b.getModel(),d=b.getOffsetAtLocation(a.x,
a.y);if(d>0){var e=d-1,f=c;c.getBaseModel&&(e=c.mapOffset(e),f=c.getBaseModel());e=this._findMatchingBracket(f,e);e!==-1&&(a.preventDefault(),a=e,c.getBaseModel&&(a=c.mapOffset(a,!0)),d>a&&(d--,a++),b.setSelection(a,d))}}},_onModelChanged:function(a){var b=a.start,c=a.removedCharCount,d=a.addedCharCount-c,e=this.view,a=e.getModel(),f=a.getBaseModel?a.getBaseModel():a,c=b+c,g=f.getCharCount(),h=this.comments.length,i=f.getLineStart(f.getLineAtOffset(b)),k=this._binarySearch(this.comments,i,!0),l=this._binarySearch(this.comments,
c,!1,k-1,h);k<h&&this.comments[k].start<=i&&i<this.comments[k].end?(i=this.comments[k].start,i>b&&(i+=d)):i=k===h&&h>0&&g-d===this.comments[h-1].end?this.comments[h-1].start:i;var m;l<h?(m=this.comments[l].end,m>b&&(m+=d),l+=1):(l=h,m=g);for(var n,g=this._findComments(f.getText(i,m),i),h=k;h<this.comments.length;h++)n=this.comments[h],n.start>b&&(n.start+=d),n.start>b&&(n.end+=d);var o=l-k!==g.length;if(!o)for(h=0;h<g.length;h++){n=this.comments[k+h];var p=g[h];if(n.start!==p.start||n.end!==p.end||
n.type!==p.type){o=!0;break}}h=[k,l-k].concat(g);Array.prototype.splice.apply(this.comments,h);o&&(h=i,n=m,a!==f&&(h=a.mapOffset(h,!0),n=a.mapOffset(n,!0)),e.redrawRange(h,n));if(this.foldingEnabled&&f!==a&&this.annotationModel){e=this.annotationModel;k=e.getAnnotations(i,m);i=[];for(m=[];k.hasNext();)if(n=k.next(),n.type===j.AnnotationType.ANNOTATION_FOLDING){m.push(n);for(h=0;h<g.length;h++)if(n.start===g[h].start&&n.end===g[h].end)break;h===g.length?(i.push(n),n.expand()):(h=n.start,l=n.end,h>
b&&(h-=d),l>b&&(l-=d),h<=b&&b<l&&h<=c&&c<l&&(h=f.getLineAtOffset(n.start),l=f.getLineAtOffset(n.end),h!==l?n.expanded||(n.expand(),e.modifyAnnotation(n)):e.removeAnnotation(n)))}b=[];for(h=0;h<g.length;h++){n=g[h];for(d=0;d<m.length;d++)if(m[d].start===n.start&&m[d].end===n.end)break;d===m.length&&(n=this._createFoldingAnnotation(a,f,n.start,n.end))&&b.push(n)}e.replaceAnnotations(i,b)}}};return{TextStyler:e}});
define("orion/editor/edit","orion/editor/shim,orion/editor/textView,orion/editor/textModel,orion/editor/textTheme,orion/editor/projectionTextModel,orion/editor/eventTarget,orion/keyBinding,orion/editor/rulers,orion/editor/annotations,orion/editor/tooltip,orion/editor/undoStack,orion/editor/textDND,orion/editor/editor,orion/editor/editorFeatures,orion/editor/contentAssist,orion/editor/cssContentAssist,orion/editor/htmlContentAssist,orion/editor/jsTemplateContentAssist,orion/editor/AsyncStyler,orion/editor/mirror,orion/editor/textMateStyler,orion/editor/htmlGrammar,examples/editor/textStyler".split(","),function(j,
o,n,g,b,f,e,i,h,a,c,d,k,m,p,q,r,s,w,u,v,l,t){function x(a){var b=a.firstChild;if(b&&b.tagName==="TEXTAREA")return b.value;var c=a.ownerDocument,d=c.defaultView||c.parentWindow,e;if(!(e=!d.getSelection)){if(!(b=a.childNodes.length===1&&b.nodeType===Node.TEXT_NODE)){for(var f,b=a;b&&b!==c&&f!=="none";)f=d.getComputedStyle?d.getComputedStyle(b,null).getPropertyValue("display"):b.currentStyle.display,b=b.parentNode;b=f==="none"}e=b}if(e)return a.innerText||a.textContent;c=c.createRange();c.selectNode(a);
a=d.getSelection();d=[];for(f=0;f<a.rangeCount;f++)d.push(a.getRangeAt(f));a.removeAllRanges();a.addRange(c);c=a.toString();a.removeAllRanges();for(f=0;f<d.length;f++)a.addRange(d[f]);return c}function y(a){if(a.substring(0,12)==="data-editor-")return a=a.substring(12),a=a.replace(/-([a-z])/ig,function(a,b){return b.toUpperCase()})}function B(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}function K(a,b){var c={};B(c,b);for(var d,e=0,f=a.attributes,g=f.length;e<g;e++){d=f.item(e);var h=y(d.nodeName);
if(h){d=d.nodeValue;if(d==="true"||d==="false")d=d==="true";c[h]=d}}return c}function L(a){a=a.getBoundingClientRect();return a.bottom-a.top}function H(a){var c=a.parent;c||(c="editor");typeof c==="string"&&(c=(a.document||document).getElementById(c));if(!c&&a.className){var d=(a.document||document).getElementsByClassName(a.className);if(d){a.className=void 0;for(var e=[],f=0;f<d.length;f++)a.parent=d[f],e.push(H(a));return e}}if(!c)throw"no parent";a=K(c,a);if(typeof a.theme==="string"){var d=g.TextTheme.getTheme(a.theme),
f=a.theme.lastIndexOf("/"),h=a.theme;f!==-1&&(h=h.substring(f+1));h.substring(h.length-4)===".css"&&(h=h.substring(0,h.length-4));d.setThemeClass(h,{href:a.theme});a.theme=d}var i;a.readonly||(e={createContentAssistMode:function(a){i=new p.ContentAssist(a.getTextView());a=new p.ContentAssistWidget(i);a=new p.ContentAssistMode(i,a);i.setMode(a);return a}});var j=new k.Editor({textViewFactory:function(){return new o.TextView({parent:c,model:new b.ProjectionTextModel(new n.TextModel("")),tabSize:a.tabSize?
a.tabSize:4,readonly:a.readonly,fullSelection:a.fullSelection,tabMode:a.tabMode,expandTab:a.expandTab,singleMode:a.singleMode,themeClass:a.themeClass,theme:a.theme,wrapMode:a.wrapMode})},undoStackFactory:new m.UndoFactory,annotationFactory:new m.AnnotationFactory,lineNumberRulerFactory:new m.LineNumberRulerFactory,foldingRulerFactory:new m.FoldingRulerFactory,textDNDFactory:new m.TextDNDFactory,contentAssistFactory:e,keyBindingFactory:new m.KeyBindingsFactory,statusReporter:a.statusReporter,domNode:c});
j.addEventListener("TextViewInstalled",function(){var b=j.getLineNumberRuler();b&&a.firstLineIndex!==void 0&&b.setFirstLine(a.firstLineIndex);j.getSourceCodeActions().setAutoPairing(a.autoPairing)});e=a.contents;e===void 0&&(e=x(c));e||(e="");j.installTextView();j.setLineNumberRulerVisible(a.showLinesRuler===void 0||a.showLinesRuler);j.setAnnotationRulerVisible(a.showAnnotationRuler===void 0||a.showFoldingRuler);j.setOverviewRulerVisible(a.showOverviewRuler===void 0||a.showOverviewRuler);j.setFoldingRulerVisible(a.showFoldingRuler===
void 0||a.showFoldingRuler);j.setInput(a.title,null,e);({styler:null,highlight:function(b,c){if(this.styler)this.styler.destroy(),this.styler=null;if(b){var d=c.getTextView(),e=c.getAnnotationModel();switch(b){case "js":case "java":case "css":this.styler=new t.TextStyler(d,b,e);c.setFoldingRulerVisible(a.showFoldingRuler===void 0||a.showFoldingRuler);break;case "html":this.styler=new v.TextMateStyler(d,new l.HtmlGrammar)}}}}).highlight(a.lang,j);if(i){var u=new q.CssContentAssistProvider,w=new r.HTMLContentAssistProvider,
y=new s.JSTemplateContentAssistProvider;i.addEventListener("Activating",function(){/css$/.test(a.lang)?i.setProviders([u]):/js$/.test(a.lang)?i.setProviders([y]):/html$/.test(a.lang)&&i.setProviders([w])})}if(L(c)<=50)e=j.getTextView().computeSize().height,c.style.height=e+"px";return j}var I=this.orion?this.orion.editor:void 0;if(I)for(var F=0;F<arguments.length;F++)B(I,arguments[F]);return H});var orion=this.orion||(this.orion={}),editor=orion.editor||(orion.editor={});editor.edit=require("orion/editor/edit");