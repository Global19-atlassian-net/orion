/*

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation
  Mihai Sucan (Mozilla Foundation) - fix for Bug#334583 Bug#348471 Bug#349485 Bug#350595 Bug#360726 Bug#361180 Bug#362835 Bug#362428 Bug#362286 Bug#354270 Bug#361474 Bug#363945 Bug#366312 Bug#370584

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2009, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2014 IBM Corporation and others. All rights reserved.
 This program and the accompanying materials are made available under the
 terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors: 
 IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made
 available under the terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation 

 Copyright (c) 2011, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation 

 Copyright (c) 2011, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation 

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made
 available under the terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors: IBM Corporation - initial API and implementation
               Alex Lakatos - fix for bug#369781

 Copyright (c) 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation
 RequireJS i18n 2.0.2 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/requirejs/i18n for details

 Copyright (c) 2011, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation
*/
var requirejs,require,define;
(function(p){function s(a,b){var c,m,g,r,D,e,d,t,f,l=b&&b.split("/"),h=n.map,u=h&&h["*"]||{};if(a&&"."===a.charAt(0))if(b){l=l.slice(0,l.length-1);a=l.concat(a.split("/"));for(t=0;t<a.length;t+=1)if(c=a[t],"."===c)a.splice(t,1),t-=1;else if(".."===c)if(1===t&&(".."===a[2]||".."===a[0]))break;else 0<t&&(a.splice(t-1,2),t-=2);a=a.join("/")}else 0===a.indexOf("./")&&(a=a.substring(2));if((l||u)&&h){c=a.split("/");for(t=c.length;0<t;t-=1){m=c.slice(0,t).join("/");if(l)for(f=l.length;0<f;f-=1)if(g=h[l.slice(0,
f).join("/")])if(g=g[m]){r=g;D=t;break}if(r)break;!e&&(u&&u[m])&&(e=u[m],d=t)}!r&&e&&(r=e,D=d);r&&(c.splice(0,D,r),a=c.join("/"))}return a}function q(a,b){return function(){return c.apply(p,x.call(arguments,0).concat([a,b]))}}function k(a){return function(b){return s(b,a)}}function d(a){return function(b){m[a]=b}}function f(a){if(v.call(t,a)){var b=t[a];delete t[a];u[a]=!0;h.apply(p,b)}if(!v.call(m,a)&&!v.call(u,a))throw Error("No "+a);return m[a]}function e(a){var b,c=a?a.indexOf("!"):-1;-1<c&&(b=
a.substring(0,c),a=a.substring(c+1,a.length));return[b,a]}function l(a){return function(){return n&&n.config&&n.config[a]||{}}}var h,c,b,a,m={},t={},n={},u={},v=Object.prototype.hasOwnProperty,x=[].slice;b=function(a,b){var c,m=e(a),g=m[0];a=m[1];g&&(g=s(g,b),c=f(g));g?a=c&&c.normalize?c.normalize(a,k(b)):s(a,b):(a=s(a,b),m=e(a),g=m[0],a=m[1],g&&(c=f(g)));return{f:g?g+"!"+a:a,n:a,pr:g,p:c}};a={require:function(a){return q(a)},exports:function(a){var b=m[a];return"undefined"!==typeof b?b:m[a]={}},
module:function(a){return{id:a,uri:"",exports:m[a],config:l(a)}}};h=function(c,e,n,l){var g,r,D,G,H=[],h;l=l||c;if("function"===typeof n){e=!e.length&&n.length?["require","exports","module"]:e;for(G=0;G<e.length;G+=1)if(D=b(e[G],l),r=D.f,"require"===r)H[G]=a.require(c);else if("exports"===r)H[G]=a.exports(c),h=!0;else if("module"===r)g=H[G]=a.module(c);else if(v.call(m,r)||v.call(t,r)||v.call(u,r))H[G]=f(r);else if(D.p)D.p.load(D.n,q(l,!0),d(r),{}),H[G]=m[r];else throw Error(c+" missing "+r);e=n.apply(m[c],
H);if(c)if(g&&g.exports!==p&&g.exports!==m[c])m[c]=g.exports;else if(e!==p||!h)m[c]=e}else c&&(m[c]=n)};requirejs=require=c=function(m,e,d,t,g){if("string"===typeof m)return a[m]?a[m](e):f(b(m,e).f);m.splice||(n=m,e.splice?(m=e,e=d,d=null):m=p);e=e||function(){};"function"===typeof d&&(d=t,t=g);t?h(p,m,e,d):setTimeout(function(){h(p,m,e,d)},4);return c};c.config=function(a){n=a;return c};define=function(a,b,c){b.splice||(c=b,b=[]);!v.call(m,a)&&!v.call(t,a)&&(t[a]=[a,b,c])};define.amd={jQuery:!0}})();
define("almond",function(){});
define("orion/editor/shim",[],function(){Object.create||(Object.create=function(p,s){function q(){}q.prototype=p;var k=new q;if(s)for(var d in s)s.hasOwnProperty(d)&&(s[d].hasOwnProperty("value")?k[d]=s[d].value:k[d]=function(){if(0<arguments.length)return s[d].get();s[d].set(arguments)});return k});Object.keys||(Object.keys=function(p){var s=[],q;for(q in p)p.hasOwnProperty(q)&&s.push(q);return s});Function.prototype.bind||(Function.prototype.bind=function(p){var s=this,q=Array.prototype.slice.call(arguments,
1);return q.length?function(){return arguments.length?s.apply(p,q.concat(Array.prototype.slice.call(arguments))):s.apply(p,q)}:function(){return arguments.length?s.apply(p,arguments):s.call(p)}});Array.isArray||(Array.isArray=function(p){return"[object Array]"===Object.prototype.toString.call(p)});Array.prototype.indexOf||(Array.prototype.indexOf=function(p){for(var s=0;s<this.length;s++)if(this[s]===p)return s;return-1});Array.prototype.forEach||(Array.prototype.forEach=function(p){for(var s=0;s<
this.length;s++)p(this[s],s)});Array.prototype.map||(Array.prototype.map=function(p){for(var s=Array(this.length),q=0;q<this.length;q++)s[q]=p(this[q]);return s});Array.prototype.reduce||(Array.prototype.reduce=function(p,s){var q,k=!1;1<arguments.length&&(q=s,k=!0);for(var d=0;this.length>d;++d)k?q=p(q,this[d],d,this):(q=this[d],k=!0);return q});String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});String.prototype.trimLeft||(String.prototype.trimLeft=function(){return this.replace(/^\s+/g,
"")});String.prototype.trimRight||(String.prototype.trimRight=function(){return this.replace(/\s+$/g,"")});return{}});
(function(){function p(d,f,e,l,h,c){f[d]&&(e.push(d),(!0===f[d]||1===f[d])&&l.push(h+d+"/"+c))}function s(d,f,e,l,h){f=l+f+"/"+h;require._fileExists(d.toUrl(f+".js"))&&e.push(f)}function q(d,f,e){for(var l in f)f.hasOwnProperty(l)&&(!d.hasOwnProperty(l)||e)?d[l]=f[l]:"object"===typeof f[l]&&q(d[l],f[l],e)}var k=/(^.*(^|\/)nls(\/|$))([^\/]*)\/?([^\/]*)/;define("i18n",["module"],function(d){var f=d.config?d.config():{},f=f||{};return{version:"2.0.1+",load:function(e,d,h,c){c=c||{};c.locale&&(f.locale=
c.locale);var b=k.exec(e),a=b[1],m=b[4],t=b[5],n=m.split("-"),u=[],v={},x,w="";b[5]?(a=b[1],e=a+t):(t=b[4],m=f.locale,m||(m=f.locale="undefined"===typeof navigator?"root":(navigator.language||navigator.userLanguage||"root").toLowerCase()),n=m.split("-"));if(c.isBuild){u.push(e);s(d,"root",u,a,t);for(x=0;x<n.length;x++)c=n[x],w+=(w?"-":"")+c,s(d,w,u,a,t);d(u,function(){h()})}else d([e],function(b){var c=[],m;p("root",b,c,u,a,t);for(x=0;x<n.length;x++)m=n[x],w+=(w?"-":"")+m,p(w,b,c,u,a,t);d(u,function(){var g,
r,D;for(g=c.length-1;-1<g&&c[g];g--){D=c[g];r=b[D];if(!0===r||1===r)r=d(a+D+"/"+t);q(v,r)}h(v)})})}}})})();define("orion/editor/i18n",{load:function(p,s,q,k){s.specified&&s.specified("orion/bootstrap")?s(["orion/i18n!"+p],function(d){q(d)}):q({})}});
define("orion/editor/nls/root/messages",{multipleAnnotations:"Multiple annotations:",line:"Line: ${0}",breakpoint:"Breakpoint",bookmark:"Bookmark",task:"Task",error:"Error",warning:"Warning",matchingSearch:"Matching Search",currentSearch:"Current Search",currentLine:"Current Line",matchingBracket:"Matching Bracket",currentBracket:"Current Bracket",lineUp:"Line Up",lineDown:"Line Down",lineStart:"Line Start",lineEnd:"Line End",charPrevious:"Previous Character",charNext:"Next Character",pageUp:"Page Up",
pageDown:"Page Down",scrollPageUp:"Scroll Page Up",scrollPageDown:"Scroll Page Down",scrollLineUp:"Scroll Line Up",scrollLineDown:"Scroll Line Down",wordPrevious:"Previous Word",wordNext:"Next Word",textStart:"Document Start",textEnd:"Document End",scrollTextStart:"Scroll Document Start",scrollTextEnd:"Scroll Document End",centerLine:"Center Line",selectLineUp:"Select Line Up",selectLineDown:"Select Line Down",selectWholeLineUp:" Select Whole Line Up",selectWholeLineDown:"Select Whole Line Down",
selectLineStart:"Select Line Start",selectLineEnd:"Select Line End",selectCharPrevious:"Select Previous Character",selectCharNext:"Select Next Character",selectPageUp:"Select Page Up",selectPageDown:"Select Page Down",selectWordPrevious:"Select Previous Word",selectWordNext:"Select Next Word",selectTextStart:"Select Document Start",selectTextEnd:"Select Document End",deletePrevious:"Delete Previous Character",deleteNext:"Delete Next Character",deleteWordPrevious:"Delete Previous Word",deleteWordNext:"Delete Next Word",
deleteLineStart:"Delete Line Start",deleteLineEnd:"Delete Line End",tab:"Insert Tab",enter:"Insert Line Delimiter",enterNoCursor:"Insert Line Delimiter",selectAll:"Select All",copy:"Copy",cut:"Cut",paste:"Paste",uppercase:"To Upper Case",lowercase:"To Lower Case",capitalize:"Capitalize",reversecase:"Reverse Case",toggleWrapMode:"Toggle Wrap Mode",toggleTabMode:"Toggle Tab Mode",toggleOverwriteMode:"Toggle Overwrite Mode",committerOnTime:"${0} on ${1}",emacs:"Emacs",exchangeMarkPoint:"Exchange Mark and Point",
setMarkCommand:"Set Mark",clearMark:"Clear Mark",digitArgument:"Digit Argument ${0}",negativeArgument:"Negative Argument",Comment:"Comment","Flat outline":"Flat outline",incrementalFindStr:"Incremental find: ${0}",incrementalFindStrNotFound:"Incremental find: ${0} (not found)",incrementalFindReverseStr:"Reverse Incremental find: ${0}",incrementalFindReverseStrNotFound:"Reverse Incremental find: ${0} (not found)",find:"Find...",undo:"Undo",redo:"Redo",cancelMode:"Cancel Current Mode",findNext:"Find Next Occurrence",
findPrevious:"Find Previous Occurrence",incrementalFind:"Incremental Find",incrementalFindReverse:"Incremental Find Reverse",indentLines:"Indent Lines",unindentLines:"Unindent Lines",moveLinesUp:"Move Lines Up",moveLinesDown:"Move Lines Down",copyLinesUp:"Copy Lines Up",copyLinesDown:"Copy Lines Down",deleteLines:"Delete Lines",gotoLine:"Goto Line...",gotoLinePrompty:"Goto Line:",nextAnnotation:"Next Annotation",prevAnnotation:"Previous Annotation",expand:"Expand",collapse:"Collapse",expandAll:"Expand All",
collapseAll:"Collapse All",lastEdit:"Last Edit Location",trimTrailingWhitespaces:"Trim Trailing Whitespaces",toggleLineComment:"Toggle Line Comment",addBlockComment:"Add Block Comment",removeBlockComment:"Remove Block Comment",linkedModeEntered:"Linked Mode entered",linkedModeExited:"Linked Mode exited",syntaxError:"Syntax Error",contentAssist:"Content Assist",lineColumn:"Line ${0} : Col ${1}",vi:"vi",vimove:"(Move)",viyank:"(Yank)",videlete:"(Delete)",vichange:"(Change)",viLeft:"${0} Left",viRight:"${0} Right",
viUp:"${0} Up",viDown:"${0} Down",viw:"${0} Next Word",vib:"${0} Beginning of Word",viW:"${0} Next Word (ws stop)",viB:"${0} Beginning of Word (ws stop)",vie:"${0} End of Word",viE:"${0} End of Word (ws stop)",vi$:"${0} End of the line","vi^_":"${0} First non-blank Char Current Line","vi+":"${0} First Char Next Line","vi-":"${0} First Char Previous Line","vi|":"${0} nth Column in Line",viH:"${0} Top of Page",viM:"${0} Middle of Page",viL:"${0} Bottom of Page","vi/":"${0} Search Forward","vi?":"${0} Search Backward",
vin:"${0} Next Search",viN:"${0} Previous Search",vif:"${0} Search Char Fwd",viF:"${0} Search Char Bckwd",vit:"${0} Search Before Char Fwd",viT:"${0} Search Before Char Bckwd","vi,":"${0} Repeat Reverse Char Search","vi;":"${0} Repeat Char Search",viG:"${0} Go to Line",viycd:"${0} Current Line",via:"Append After Cursor",viA:"Append to End of Line",vii:"Insert Before Cursor",viI:"Insert at Beginning of Line",viO:"Insert Line Above",vio:"Insert Line Below",viR:"Begin Overwriting Text",vis:"Substitute a Character",
viS:"Substitute Entire Line",viC:"Change Text Until Line End",vip:"Paste After Char or Line",viP:"Paste Before Char or Line",viStar:"Search Word Under Cursor",next:"Next",previous:"Previous",replace:"Replace",replaceAll:"Replace All",findWith:"Find With",replaceWith:"Replace With",caseInsensitive:"Aa",regex:"/.*/",wholeWord:"\\b",caseInsensitiveTooltip:"Toggle Case Insensitive",regexTooltip:"Toogle Regex",wholeWordTooltip:"Toggle Whole Word",closeTooltip:"Close",replacingAll:"Replacing all...",replacedMatches:"Replaced ${0} matches",
nothingReplaced:"Nothing replaced",notFound:"Not found"});define("orion/editor/nls/messages",["orion/editor/i18n!orion/editor/nls/messages","orion/editor/nls/root/messages"],function(p,s){var q={root:s},k;for(k in p)p.hasOwnProperty(k)&&"undefined"===typeof q[k]&&(q[k]=p[k]);return q});
define("orion/editor/eventTarget",[],function(){function p(){}p.addMixin=function(s){var q=p.prototype,k;for(k in q)q.hasOwnProperty(k)&&(s[k]=q[k])};p.prototype={addEventListener:function(p,q,k){this._eventTypes||(this._eventTypes={});var d=this._eventTypes[p];d||(d=this._eventTypes[p]={level:0,listeners:[]});d.listeners.push({listener:q,useCapture:k})},dispatchEvent:function(p){var q=p.type;this._dispatchEvent("pre"+q,p);this._dispatchEvent(q,p);this._dispatchEvent("post"+q,p)},_dispatchEvent:function(p,
q){var k=this._eventTypes?this._eventTypes[p]:null;if(k){var d=k.listeners;try{if(k.level++,d)for(var f=0,e=d.length;f<e;f++)if(d[f]){var l=d[f].listener;"function"===typeof l?l.call(this,q):l.handleEvent&&"function"===typeof l.handleEvent&&l.handleEvent(q)}}finally{if(k.level--,k.compact&&0===k.level){for(f=d.length-1;0<=f;f--)d[f]||d.splice(f,1);0===d.length&&delete this._eventTypes[p];k.compact=!1}}}},isListening:function(p){return!this._eventTypes?!1:void 0!==this._eventTypes[p]},removeEventListener:function(p,
q,k){if(this._eventTypes){var d=this._eventTypes[p];if(d){for(var f=d.listeners,e=0,l=f.length;e<l;e++){var h=f[e];if(h&&h.listener===q&&h.useCapture===k){0!==d.level?(f[e]=null,d.compact=!0):f.splice(e,1);break}}0===f.length&&delete this._eventTypes[p]}}}};return{EventTarget:p}});define("orion/regex",[],function(){return{escape:function(p){return p.replace(/([\\$\^*\/+?\.\(\)|{}\[\]])/g,"\\$\x26")},parse:function(p){return(p=/^\s*\/(.+)\/([gim]{0,3})\s*$/.exec(p))?{pattern:p[1],flags:p[2]}:null}}});
define("orion/util",[],function(){var p=navigator.userAgent,s=-1!==p.indexOf("MSIE")||-1!==p.indexOf("Trident")?document.documentMode:void 0,q=parseFloat(p.split("Firefox/")[1]||p.split("Minefield/")[1])||void 0,k=-1!==p.indexOf("Opera")?parseFloat(p.split("Version/")[1]):void 0,d=parseFloat(p.split("Chrome/")[1])||void 0,f=-1!==p.indexOf("Safari")&&!d,e=parseFloat(p.split("WebKit/")[1])||void 0,l=-1!==p.indexOf("Android"),h=-1!==p.indexOf("iPad"),p=-1!==p.indexOf("iPhone"),c=h||p,b=-1!==navigator.platform.indexOf("Mac"),
a=-1!==navigator.platform.indexOf("Win"),m=-1!==navigator.platform.indexOf("Linux"),t="ontouchstart"in document.createElement("input");return{formatMessage:function(a){var b=arguments;return a.replace(/\$\{([^\}]+)\}/g,function(a,c){return b[(c<<0)+1]})},createElement:function(a,b){return a.createElementNS?a.createElementNS("http://www.w3.org/1999/xhtml",b):a.createElement(b)},isIE:s,isFirefox:q,isOpera:k,isChrome:d,isSafari:f,isWebkit:e,isAndroid:l,isIPad:h,isIPhone:p,isIOS:c,isMac:b,isWindows:a,
isLinux:m,isTouch:t,platformDelimiter:a?"\r\n":"\n"}});
define("orion/editor/textModel",["orion/editor/eventTarget","orion/regex","orion/util"],function(p,s,q){function k(d,f){this._lastLineIndex=-1;this._text=[""];this._lineOffsets=[0];this.setText(d);this.setLineDelimiter(f)}k.prototype={destroy:function(){},find:function(d){1<this._text.length&&(this._text=[this._text.join("")]);var f=d.string,e=d.regex,l=f,h="",c=d.caseInsensitive;if(l)if(e){if(f=s.parse(l))l=f.pattern,h=f.flags}else l=f.replace(/([\\$\^*\/+?\.\(\)|{}\[\]])/g,"\\$\x26"),c&&(l=l.replace(/[iI\u0130\u0131]/g,
"[Ii\u0130\u0131]"));var b=null,a;if(l){var f=d.reverse,m=d.wrap,e=d.wholeWord,t=d.start||0;d=d.end;var n=null!==d&&void 0!==d;-1===h.indexOf("g")&&(h+="g");-1===h.indexOf("m")&&(h+="m");c&&-1===h.indexOf("i")&&(h+="i");e&&(l="\\b"+l+"\\b");var u=this._text[0],v,k,w=0;n&&(c=t<d?t:d,u=u.substring(c,t<d?d:t),w=c);var p=RegExp(l,h);f?a=function(){var a=null;for(p.lastIndex=0;;){k=p.lastIndex;v=p.exec(u);if(k===p.lastIndex)return null;if(v){if(!(v.index+w<t)){if(!m||a)break;t=u.length+w}a={start:v.index+
w,end:p.lastIndex+w}}else break}a&&(t=a.start);return a}:(n||(p.lastIndex=t),a=function(){for(;;){k=p.lastIndex;v=p.exec(u);if(k===p.lastIndex)break;if(v)return{start:v.index+w,end:p.lastIndex+w};if(!(0!==k&&m))break}return null});b=a()}return{next:function(){var c=b;c&&(b=a());return c},hasNext:function(){return null!==b}}},getCharCount:function(){for(var d=0,f=0;f<this._text.length;f++)d+=this._text[f].length;return d},getLine:function(d,f){var e=this.getLineCount();if(!(0<=d&&d<e))return null;
var l=this._lineOffsets[d];if(d+1<e){e=this.getText(l,this._lineOffsets[d+1]);if(f)return e;for(var l=e.length,h;10===(h=e.charCodeAt(l-1))||13===h;)l--;return e.substring(0,l)}return this.getText(l)},getLineAtOffset:function(d){var f=this.getCharCount();if(!(0<=d&&d<=f))return-1;var e=this.getLineCount();if(d===f)return e-1;var l,h,c=this._lastLineIndex;if(0<=c&&c<e&&(l=this._lineOffsets[c],h=c+1<e?this._lineOffsets[c+1]:f,l<=d&&d<h))return c;for(var b=e,a=-1;1<b-a;)if(c=Math.floor((b+a)/2),l=this._lineOffsets[c],
h=c+1<e?this._lineOffsets[c+1]:f,d<=l)b=c;else if(d<h){b=c;break}else a=c;return this._lastLineIndex=b},getLineCount:function(){return this._lineOffsets.length},getLineDelimiter:function(){return this._lineDelimiter},getLineEnd:function(d,f){var e=this.getLineCount();if(!(0<=d&&d<e))return-1;if(d+1<e){e=this._lineOffsets[d+1];if(f)return e;for(var l=this.getText(Math.max(this._lineOffsets[d],e-2),e),h=l.length,c;10===(c=l.charCodeAt(h-1))||13===c;)h--;return e-(l.length-h)}return this.getCharCount()},
getLineStart:function(d){return!(0<=d&&d<this.getLineCount())?-1:this._lineOffsets[d]},getText:function(d,f){void 0===d&&(d=0);void 0===f&&(f=this.getCharCount());if(d===f)return"";for(var e=0,l=0,h;l<this._text.length;){h=this._text[l].length;if(d<=e+h)break;e+=h;l++}for(var c=e,b=l;l<this._text.length;){h=this._text[l].length;if(f<=e+h)break;e+=h;l++}if(b===l)return this._text[b].substring(d-c,f-e);c=this._text[b].substring(d-c);e=this._text[l].substring(0,f-e);return c+this._text.slice(b+1,l).join("")+
e},onChanging:function(d){return this.dispatchEvent(d)},onChanged:function(d){return this.dispatchEvent(d)},setLineDelimiter:function(d,f){"auto"===d&&(d=void 0,1<this.getLineCount()&&(d=this.getText(this.getLineEnd(0),this.getLineEnd(0,!0))));this._lineDelimiter=d?d:q.platformDelimiter;if(f){var e=this.getLineCount();if(1<e){for(var l=Array(e),h=0;h<e;h++)l[h]=this.getLine(h);this.setText(l.join(this._lineDelimiter))}}},setText:function(d,f,e){void 0===d&&(d="");void 0===f&&(f=0);void 0===e&&(e=
this.getCharCount());if(!(f===e&&""===d)){for(var l=this.getLineAtOffset(f),h=this.getLineAtOffset(e),c=f,b=e-f,a=h-l,m=d.length,t=0,n=this.getLineCount(),u=0,v=0,k=0,w=[];;){-1!==u&&u<=k&&(u=d.indexOf("\r",k));-1!==v&&v<=k&&(v=d.indexOf("\n",k));if(-1===v&&-1===u)break;k=-1!==u&&-1!==v?u+1===v?v+1:(u<v?u:v)+1:-1!==u?u+1:v+1;w.push(f+k);t++}this.onChanging({type:"Changing",text:d,start:c,removedCharCount:b,addedCharCount:m,removedLineCount:a,addedLineCount:t});0===w.length&&(k=this.getLineStart(l),
h=h+1<n?this.getLineStart(h+1):this.getCharCount(),f!==k&&(d=this.getText(k,f)+d,f=k),e!==h&&(d+=this.getText(e,h),e=h));k=m-b;for(h=l+a+1;h<n;h++)this._lineOffsets[h]+=k;if(5E4>w.length)l=[l+1,a].concat(w),Array.prototype.splice.apply(this._lineOffsets,l);else{k=l+1;this._lineOffsets.splice(k,a);for(n=0;n<w.length;n+=5E4)l=[k,0].concat(w.slice(n,Math.min(w.length,n+5E4))),Array.prototype.splice.apply(this._lineOffsets,l),k+=5E4}for(k=n=0;k<this._text.length;){h=this._text[k].length;if(f<=n+h)break;
n+=h;k++}l=n;for(w=k;k<this._text.length;){h=this._text[k].length;if(e<=n+h)break;n+=h;k++}h=this._text[k];f=this._text[w].substring(0,f-l);e=h.substring(e-n);w=[w,k-w+1];f&&w.push(f);d&&w.push(d);e&&w.push(e);Array.prototype.splice.apply(this._text,w);0===this._text.length&&(this._text=[""]);this.onChanged({type:"Changed",start:c,removedCharCount:b,addedCharCount:m,removedLineCount:a,addedLineCount:t})}}};p.EventTarget.addMixin(k.prototype);return{TextModel:k}});
define("orion/keyBinding",["orion/util"],function(p){function s(k,d,f,e,l,h){this.type=h||"keydown";this.keyCode="string"===typeof k&&"keydown"===this.type?k.toUpperCase().charCodeAt(0):k;this.mod1=void 0!==d&&null!==d?d:!1;this.mod2=void 0!==f&&null!==f?f:!1;this.mod3=void 0!==e&&null!==e?e:!1;this.mod4=void 0!==l&&null!==l?l:!1}function q(k){this.keys=k}s.prototype={getKeys:function(){return[this]},match:function(k,d){if(void 0!==d){if(0!==d)return!1}else if(k instanceof Array){if(1<k.length)return!1;
k=k[0]}return k.type!==this.type?!1:this.keyCode===k.keyCode||this.keyCode===String.fromCharCode(p.isOpera?k.which:void 0!==k.charCode?k.charCode:k.keyCode)?this.mod1!==(p.isMac?k.metaKey:k.ctrlKey)||"keydown"===this.type&&this.mod2!==k.shiftKey||this.mod3!==k.altKey||p.isMac&&this.mod4!==k.ctrlKey?!1:!0:!1},equals:function(k){return!k||this.keyCode!==k.keyCode||this.mod1!==k.mod1||this.mod2!==k.mod2||this.mod3!==k.mod3||this.mod4!==k.mod4||this.type!==k.type?!1:!0}};q.prototype={getKeys:function(){return this.keys.slice(0)},
match:function(k,d){var f=this.keys;if(void 0!==d)return d>f.length?!1:f[d].match(k)?d===f.length-1?!0:d+1:!1;k instanceof Array||(k=[k]);if(k.length>f.length)return!1;var e;for(e=0;e<k.length;e++)if(!f[e].match(k[e]))return!1;return e===f.length?!0:e},equals:function(k){if(!k.keys||k.keys.length!==this.keys.length)return!1;for(var d=0;d<k.keys.length;d++)if(!k.keys[d].equals(this.keys[d]))return!1;return!0}};return{KeyBinding:s,KeyStroke:s,KeySequence:q}});
define("orion/editor/keyModes",["orion/keyBinding","orion/util"],function(p,s){function q(d){d&&(this._view=d,this._keyBindings=this.createKeyBindings(),this._keyBindingIndex=0)}function k(d){q.call(this,d)}q.prototype={createKeyBindings:function(){return[]},getKeyBindings:function(d){for(var f=[],e=this._keyBindings,l=0;l<e.length;l++)e[l].actionID===d&&f.push(e[l].keyBinding);return f},getView:function(){return this._view},isActive:function(){return-1!==this._view.getKeyModes().indexOf(this)},match:function(d){if("keydown"===
d.type)switch(d.keyCode){case 16:case 17:case 18:case 91:return}for(var f=this._keyBindingIndex,e=this._matchingKeyBindings||this._keyBindings,l=[],h=0;h<e.length;h++){var c=e[h],b=c.keyBinding.match(d,f);if(!0===b)return this._keyBindingIndex=0,this._matchingKeyBindings=null,c.actionID;"number"===typeof b&&l.push(c)}if(0===l.length)this._keyBindingIndex=0,this._matchingKeyBindings=null;else return this._keyBindingIndex++,this._matchingKeyBindings=l,"noop"},setKeyBinding:function(d,f){for(var e=this._keyBindings,
l=0;l<e.length;l++){var h=e[l];if(h.keyBinding.equals(d)){f?h.actionID=f:h.predefined?h.actionID="noop":e.splice(l,1);return}}f&&e.push({keyBinding:d,actionID:f})},setView:function(d){this._view=d}};k.prototype=new q;k.prototype.createKeyBindings=function(){var d=p.KeyBinding,f=[];f.push({actionID:"lineUp",keyBinding:new d(38),predefined:!0});f.push({actionID:"lineDown",keyBinding:new d(40),predefined:!0});f.push({actionID:"charPrevious",keyBinding:new d(37),predefined:!0});f.push({actionID:"charNext",
keyBinding:new d(39),predefined:!0});s.isMac?(f.push({actionID:"scrollPageUp",keyBinding:new d(33),predefined:!0}),f.push({actionID:"scrollPageDown",keyBinding:new d(34),predefined:!0}),f.push({actionID:"pageUp",keyBinding:new d(33,null,null,!0),predefined:!0}),f.push({actionID:"pageDown",keyBinding:new d(34,null,null,!0),predefined:!0}),f.push({actionID:"lineStart",keyBinding:new d(37,!0),predefined:!0}),f.push({actionID:"lineEnd",keyBinding:new d(39,!0),predefined:!0}),f.push({actionID:"wordPrevious",
keyBinding:new d(37,null,null,!0),predefined:!0}),f.push({actionID:"wordNext",keyBinding:new d(39,null,null,!0),predefined:!0}),f.push({actionID:"scrollTextStart",keyBinding:new d(36),predefined:!0}),f.push({actionID:"scrollTextEnd",keyBinding:new d(35),predefined:!0}),f.push({actionID:"textStart",keyBinding:new d(38,!0),predefined:!0}),f.push({actionID:"textEnd",keyBinding:new d(40,!0),predefined:!0}),f.push({actionID:"scrollPageUp",keyBinding:new d(38,null,null,null,!0),predefined:!0}),f.push({actionID:"scrollPageDown",
keyBinding:new d(40,null,null,null,!0),predefined:!0}),f.push({actionID:"lineStart",keyBinding:new d(37,null,null,null,!0),predefined:!0}),f.push({actionID:"lineEnd",keyBinding:new d(39,null,null,null,!0),predefined:!0}),f.push({actionID:"lineStart",keyBinding:new d(38,null,null,!0),predefined:!0}),f.push({actionID:"lineEnd",keyBinding:new d(40,null,null,!0),predefined:!0})):(f.push({actionID:"pageUp",keyBinding:new d(33),predefined:!0}),f.push({actionID:"pageDown",keyBinding:new d(34),predefined:!0}),
f.push({actionID:"lineStart",keyBinding:new d(36),predefined:!0}),f.push({actionID:"lineEnd",keyBinding:new d(35),predefined:!0}),f.push({actionID:"wordPrevious",keyBinding:new d(37,!0),predefined:!0}),f.push({actionID:"wordNext",keyBinding:new d(39,!0),predefined:!0}),f.push({actionID:"textStart",keyBinding:new d(36,!0),predefined:!0}),f.push({actionID:"textEnd",keyBinding:new d(35,!0),predefined:!0}));s.isFirefox&&s.isLinux&&(f.push({actionID:"lineUp",keyBinding:new d(38,!0),predefined:!0}),f.push({actionID:"lineDown",
keyBinding:new d(40,!0),predefined:!0}));s.isWindows&&(f.push({actionID:"scrollLineUp",keyBinding:new d(38,!0),predefined:!0}),f.push({actionID:"scrollLineDown",keyBinding:new d(40,!0),predefined:!0}));f.push({actionID:"selectLineUp",keyBinding:new d(38,null,!0),predefined:!0});f.push({actionID:"selectLineDown",keyBinding:new d(40,null,!0),predefined:!0});f.push({actionID:"selectCharPrevious",keyBinding:new d(37,null,!0),predefined:!0});f.push({actionID:"selectCharNext",keyBinding:new d(39,null,!0),
predefined:!0});f.push({actionID:"selectPageUp",keyBinding:new d(33,null,!0),predefined:!0});f.push({actionID:"selectPageDown",keyBinding:new d(34,null,!0),predefined:!0});s.isMac?(f.push({actionID:"selectLineStart",keyBinding:new d(37,!0,!0),predefined:!0}),f.push({actionID:"selectLineEnd",keyBinding:new d(39,!0,!0),predefined:!0}),f.push({actionID:"selectWordPrevious",keyBinding:new d(37,null,!0,!0),predefined:!0}),f.push({actionID:"selectWordNext",keyBinding:new d(39,null,!0,!0),predefined:!0}),
f.push({actionID:"selectTextStart",keyBinding:new d(36,null,!0),predefined:!0}),f.push({actionID:"selectTextEnd",keyBinding:new d(35,null,!0),predefined:!0}),f.push({actionID:"selectTextStart",keyBinding:new d(38,!0,!0),predefined:!0}),f.push({actionID:"selectTextEnd",keyBinding:new d(40,!0,!0),predefined:!0}),f.push({actionID:"selectLineStart",keyBinding:new d(37,null,!0,null,!0),predefined:!0}),f.push({actionID:"selectLineEnd",keyBinding:new d(39,null,!0,null,!0),predefined:!0}),f.push({actionID:"selectLineStart",
keyBinding:new d(38,null,!0,!0),predefined:!0}),f.push({actionID:"selectLineEnd",keyBinding:new d(40,null,!0,!0),predefined:!0})):(s.isLinux&&(f.push({actionID:"selectWholeLineUp",keyBinding:new d(38,!0,!0),predefined:!0}),f.push({actionID:"selectWholeLineDown",keyBinding:new d(40,!0,!0),predefined:!0})),f.push({actionID:"selectLineStart",keyBinding:new d(36,null,!0),predefined:!0}),f.push({actionID:"selectLineEnd",keyBinding:new d(35,null,!0),predefined:!0}),f.push({actionID:"selectWordPrevious",
keyBinding:new d(37,!0,!0),predefined:!0}),f.push({actionID:"selectWordNext",keyBinding:new d(39,!0,!0),predefined:!0}),f.push({actionID:"selectTextStart",keyBinding:new d(36,!0,!0),predefined:!0}),f.push({actionID:"selectTextEnd",keyBinding:new d(35,!0,!0),predefined:!0}));f.push({actionID:"undo",keyBinding:new p.KeyBinding("z",!0),predefined:!0});s.isMac?f.push({actionID:"redo",keyBinding:new p.KeyBinding("z",!0,!0),predefined:!0}):f.push({actionID:"redo",keyBinding:new p.KeyBinding("y",!0),predefined:!0});
f.push({actionID:"deletePrevious",keyBinding:new d(8),predefined:!0});f.push({actionID:"deletePrevious",keyBinding:new d(8,null,!0),predefined:!0});f.push({actionID:"deleteNext",keyBinding:new d(46),predefined:!0});f.push({actionID:"deleteWordPrevious",keyBinding:new d(8,!0),predefined:!0});f.push({actionID:"deleteWordPrevious",keyBinding:new d(8,!0,!0),predefined:!0});f.push({actionID:"deleteWordNext",keyBinding:new d(46,!0),predefined:!0});f.push({actionID:"tab",keyBinding:new d(9),predefined:!0});
f.push({actionID:"shiftTab",keyBinding:new d(9,null,!0),predefined:!0});f.push({actionID:"enter",keyBinding:new d(13),predefined:!0});f.push({actionID:"enter",keyBinding:new d(13,null,!0),predefined:!0});f.push({actionID:"selectAll",keyBinding:new d("a",!0),predefined:!0});f.push({actionID:"toggleTabMode",keyBinding:new d("m",!0),predefined:!0});s.isMac&&(f.push({actionID:"deleteNext",keyBinding:new d(46,null,!0),predefined:!0}),f.push({actionID:"deleteWordPrevious",keyBinding:new d(8,null,null,!0),
predefined:!0}),f.push({actionID:"deleteWordNext",keyBinding:new d(46,null,null,!0),predefined:!0}));f.push({actionID:"toggleWrapMode",keyBinding:new p.KeyBinding("w",!0,!1,!0)});f.push({actionID:"toggleOverwriteMode",keyBinding:new p.KeyBinding(45)});if(!s.isFirefox){var e=s.isMac&&s.isChrome;f.push({actionID:"noop",keyBinding:new d("u",!e,!1,!1,e),predefined:!0});f.push({actionID:"noop",keyBinding:new d("i",!e,!1,!1,e),predefined:!0});f.push({actionID:"noop",keyBinding:new d("b",!e,!1,!1,e),predefined:!0})}s.isFirefox&&
(f.push({actionID:"copy",keyBinding:new d(45,!0),predefined:!0}),f.push({actionID:"paste",keyBinding:new d(45,null,!0),predefined:!0}),f.push({actionID:"cut",keyBinding:new d(46,null,!0),predefined:!0}));s.isMac&&(f.push({actionID:"lineStart",keyBinding:new d("a",!1,!1,!1,!0),predefined:!0}),f.push({actionID:"lineEnd",keyBinding:new d("e",!1,!1,!1,!0),predefined:!0}),f.push({actionID:"lineUp",keyBinding:new d("p",!1,!1,!1,!0),predefined:!0}),f.push({actionID:"lineDown",keyBinding:new d("n",!1,!1,
!1,!0),predefined:!0}),f.push({actionID:"charPrevious",keyBinding:new d("b",!1,!1,!1,!0),predefined:!0}),f.push({actionID:"charNext",keyBinding:new d("f",!1,!1,!1,!0),predefined:!0}),f.push({actionID:"deletePrevious",keyBinding:new d("h",!1,!1,!1,!0),predefined:!0}),f.push({actionID:"deleteNext",keyBinding:new d("d",!1,!1,!1,!0),predefined:!0}),f.push({actionID:"deleteLineEnd",keyBinding:new d("k",!1,!1,!1,!0),predefined:!0}),s.isFirefox?(f.push({actionID:"scrollPageDown",keyBinding:new d("v",!1,
!1,!1,!0),predefined:!0}),f.push({actionID:"deleteLineStart",keyBinding:new d("u",!1,!1,!1,!0),predefined:!0}),f.push({actionID:"deleteWordPrevious",keyBinding:new d("w",!1,!1,!1,!0),predefined:!0})):(f.push({actionID:"pageDown",keyBinding:new d("v",!1,!1,!1,!0),predefined:!0}),f.push({actionID:"centerLine",keyBinding:new d("l",!1,!1,!1,!0),predefined:!0}),f.push({actionID:"enterNoCursor",keyBinding:new d("o",!1,!1,!1,!0),predefined:!0})));return f};return{KeyMode:q,DefaultKeyMode:k}});
define("orion/editor/textTheme",["require","orion/editor/eventTarget","orion/util"],function(p,s,q){function k(d){d=d||{};this._document=d.document||document}var d={};k.getTheme=function(f){f=f||"default";var e=d[f];e||(e=d[f]=new k);return e};k.prototype={getThemeClass:function(){return this._themeClass},setThemeClass:function(d,e){var l=this,h=l._themeClass;l._themeClass=d;this._load(d,e,function(){l.onThemeChanged({type:"ThemeChanged",oldValue:h,newValue:l.getThemeClass()})})},onThemeChanged:function(d){return this.dispatchEvent(d)},
buildStyleSheet:function(d,e){function l(c,b,a){b&&(h.push("."+d+" ."+c+" {"),h.push("\t"+(a?"background-color":"color")+": "+b+";"),h.push("}"))}var h=[];h.push("");h.push("."+d+" {");e.fontFamily&&h.push("\tfont-family: "+e.fontFamily+";");e.fontSize&&h.push("\tfont-size: "+e.fontSize+";");e.fontSize&&h.push("\tcolor: "+e.text+";");h.push("}");h.push("."+d+".textview {");e.background&&h.push("\tbackground-color: "+e.background+";");h.push("}");l("ruler.annotations",e.annotationRuler,!0);l("ruler.lines",
e.annotationRuler,!0);l("ruler.folding",e.annotationRuler,!0);l("ruler.overview",e.overviewRuler,!0);l("rulerLines",e.lineNumber,!1);l("rulerLines.even",e.lineNumberEven,!1);l("rulerLines.odd",e.lineNumberOdd,!1);l("annotationLine.currentLine",e.currentLine,!0);l("entity-name-tag",e.keyword,!1);l("entity-other-attribute-name",e.attribute,!1);l("string-quoted",e.string,!1);l("meta.annotation.currentLine",e.currentLine,!0);l("keyword",e.keyword,!1);l("string",e.string,!1);l("comment",e.comment,!1);
l("comment.block.documentation",e.comment,!1);l("keyword.other.documentation.markup",e.comment,!1);return h.join("\n")},_createStyle:function(d,e,l,h){var c=this._document;d="orion-theme-"+d;var b=c.getElementById(d);if(b){if(h||b.firstChild.data===e)return;b.removeChild(b.firstChild);b.appendChild(c.createTextNode(e))}else h?(b=q.createElement(c,"link"),b.rel="stylesheet",b.type="text/css",b.href=e,b.addEventListener("load",function(){l()})):(b=q.createElement(c,"style"),b.appendChild(c.createTextNode(e))),
b.id=d,(c.getElementsByTagName("head")[0]||c.documentElement).appendChild(b);h||l()},_load:function(d,e,l){if(d)if("string"===typeof e)this._createStyle(d,e,l);else if(e=e.href,".css"!==e.substring(e.length-4)&&(e+=".css"),/^\//.test(e)||/[a-zA-Z0-9]+:\/\//i.test(e)||!p.toUrl)this._createStyle(d,e,l,!0);else{var h=this;p(["text!"+e],function(c){h._createStyle(d,c,l,!1)})}else l()}};s.EventTarget.addMixin(k.prototype);return{TextTheme:k}});
define("orion/editor/util",[],function(){return{contains:function(p,s){if(!s)return!1;if(!p.compareDocumentPosition){for(var q=s;q;){if(p===q)return!0;q=q.parentNode}return!1}return p===s||0!==(p.compareDocumentPosition(s)&16)},addEventListener:function(p,s,q,k){"function"===typeof p.addEventListener?p.addEventListener(s,q,!0===k):p.attachEvent("on"+s,q)},removeEventListener:function(p,s,q,k){"function"===typeof p.removeEventListener?p.removeEventListener(s,q,!0===k):p.detachEvent("on"+s,q)}}});
define("orion/editor/textView","i18n!orion/editor/nls/messages orion/editor/textModel orion/editor/keyModes orion/editor/eventTarget orion/editor/textTheme orion/editor/util orion/util".split(" "),function(p,s,q,k,d,f,e){function l(g,r,a){if(a){r.className="";a=r.attributes;for(var b=a.length;0<b--;)(!e.isIE||9<=e.isIE||9>e.isIE&&a[b].specified)&&r.removeAttribute(a[b].name)}if(g){g.styleClass&&(r.className=g.styleClass);if(a=g.style)for(var c in a)a.hasOwnProperty(c)&&(r.style[c]=a[c]);if(g=g.attributes)for(var m in g)g.hasOwnProperty(m)&&
r.setAttribute(m,g[m])}}function h(g){return g instanceof Array?g.slice(0):g}function c(g,r){if(!g)return r;if(!r)return g;for(var a in r)r.hasOwnProperty(a)&&(g.hasOwnProperty(a)||(g[a]=r[a]));return g}function b(g,r){if(g===r)return!0;if(g&&!r||!g&&r||g&&g.constructor===String||r&&r.constructor===String)return!1;if(g instanceof Array||r instanceof Array){if(!(g instanceof Array&&r instanceof Array)||g.length!==r.length)return!1;for(var a=0;a<g.length;a++)if(!b(g[a],r[a]))return!1;return!0}if(!(g instanceof
Object)||!(r instanceof Object))return!1;for(a in g)if(g.hasOwnProperty(a)&&(!r.hasOwnProperty(a)||!b(g[a],r[a])))return!1;for(a in r)if(!g.hasOwnProperty(a))return!1;return!0}function a(g,r,a){for(var b=0,c=0,m=0,e=g.length;m<e;){-1!==b&&b<=m&&(b=g.indexOf("\r",m));-1!==c&&c<=m&&(c=g.indexOf("\n",m));var n=m,d;if(-1===c&&-1===b){r(g.substring(m));break}-1!==b&&-1!==c?b+1===c?(d=b,m=c+1):(d=b<c?b:c,m=(b<c?b:c)+1):-1!==b?(d=b,m=b+1):(d=c,m=c+1);r(g.substring(n,d));a()}}function m(g){var r,a,b,c,m=
g.ownerDocument.defaultView||g.ownerDocument.parentWindow;m.getComputedStyle?(g=m.getComputedStyle(g,null),r=g.getPropertyValue("padding-left"),a=g.getPropertyValue("padding-top"),b=g.getPropertyValue("padding-right"),c=g.getPropertyValue("padding-bottom")):g.currentStyle&&(r=g.currentStyle.paddingLeft,a=g.currentStyle.paddingTop,b=g.currentStyle.paddingRight,c=g.currentStyle.paddingBottom);return{left:parseInt(r,10)||0,top:parseInt(a,10)||0,right:parseInt(b,10)||0,bottom:parseInt(c,10)||0}}function t(g){var r,
a,b,c,e=g._trim;if(!e){var e=m(g),n=g.ownerDocument.defaultView||g.ownerDocument.parentWindow;n.getComputedStyle?(c=n.getComputedStyle(g,null),r=c.getPropertyValue("border-left-width"),a=c.getPropertyValue("border-top-width"),b=c.getPropertyValue("border-right-width"),c=c.getPropertyValue("border-bottom-width")):g.currentStyle&&(r=g.currentStyle.borderLeftWidth,a=g.currentStyle.borderTopWidth,b=g.currentStyle.borderRightWidth,c=g.currentStyle.borderBottomWidth);r=parseInt(r,10)||0;a=parseInt(a,10)||
0;b=parseInt(b,10)||0;c=parseInt(c,10)||0;e.left+=r;e.top+=a;e.right+=b;e.bottom+=c;g._trim=e}return e}function n(g,r,a,b){function c(r){if(r.animationName===e){var a=r.target;"function"===typeof a.__DOMReady&&(g.defaultView||g.parentWindow).setTimeout(function(){a.__DOMReady()},0)}}function m(g,r){for(var a=["","-webkit-","-moz-","-ms-","-o-"],b="",D="body ."+g+" {\n",c=0;c<a.length;c++)b+="@"+a[c]+"keyframes "+r+" {\nfrom { opacity: 0.99; }\nto { opacity: 1; }\n}\n",D+=a[c]+"animation-duration: 0.001s;\n"+
a[c]+"animation-name: "+r+";\n";return b+(D+"}")}a="_"+a+"DOMReady";r.className=r.className?r.className+" "+a:a;r.__DOMReady=b;b=a+"Style";if(!g.getElementById(b)){var e=a+"Animation";g.addEventListener("animationstart",c,!1);g.addEventListener("MSAnimationStart",c,!1);g.addEventListener("webkitAnimationStart",c,!1);r=g.createElement("style");r.id=b;b=g.getElementsByTagName("head")[0]||g.documentElement;r.appendChild(g.createTextNode(m(a,e)));b.insertBefore(r,b.firstChild)}}function u(g,r,a){this.start=
g;this.end=r;this.caret=a}function v(g){this.left=g.left;this.top=g.top;this.right=g.right;this.bottom=g.bottom}function x(g,r,a){this.view=g;this.lineIndex=r;this._lineDiv=a}function w(g){this._init(g||{})}var y=f.addEventListener,A=f.removeEventListener,z=function(){function g(g){this.options=g}g.prototype.play=function(){var g="number"===typeof this.options.duration?this.options.duration:350,a=this.options.easing||this.defaultEasing,b=this.options.onAnimate||function(){},c=this.options.curve[0],
m=this.options.curve[1],e=m-c,n=-1,d,t=this;this.interval=this.options.window.setInterval(function(){n=-1===n?(new Date).getTime():n;var f=((new Date).getTime()-n)/g;1>f?(f=a(f),d=c+f*e,b(d)):(b(m),t.stop())},"number"===typeof this.options.rate?this.options.rate:20)};g.prototype.stop=function(){this.options.window.clearInterval(this.interval);(this.options.onEnd||function(){})()};g.prototype.defaultEasing=function(g){return Math.sin(g*(Math.PI/2))};return g}();u.prototype={clone:function(){return new u(this.start,
this.end,this.caret)},collapse:function(){this.caret?this.end=this.start:this.start=this.end},extend:function(g){this.caret?this.start=g:this.end=g;this.start>this.end&&(g=this.start,this.start=this.end,this.end=g,this.caret=!this.caret)},setCaret:function(g){this.end=this.start=g;this.caret=!1},getCaret:function(){return this.caret?this.start:this.end},toString:function(){return"start\x3d"+this.start+" end\x3d"+this.end+(this.caret?" caret is at start":" caret is at end")},isEmpty:function(){return this.start===
this.end},equals:function(g){return this.caret===g.caret&&this.start===g.start&&this.end===g.end}};v.prototype={toString:function(){return"{l\x3d"+this.left+", t\x3d"+this.top+", r\x3d"+this.right+", b\x3d"+this.bottom+"}"}};x.prototype={create:function(g,r){if(!this._lineDiv){var a=this._lineDiv=this._createLine(g,r,this.lineIndex);a._line=this;return a}},_createLine:function(g,r,a){var c=this.view,m=c._model,n=m.getLine(a),d=m.getLineStart(a),t={type:"LineStyle",textView:c,lineIndex:a,lineText:n,
lineStart:d};c.onLineStyle(t);var f=g.ownerDocument,m=r||e.createElement(f,"div");if(!r||!b(r.viewStyle,t.style))l(t.style,m,r),r&&(r._trim=null),m.viewStyle=t.style,m.setAttribute("role","presentation");m.lineIndex=a;if(r&&m.viewLineText===n&&b(t.ranges,m.viewRanges))return m;m.viewRanges=t.ranges;m.viewLineText=n;a=[];this._createRanges(t.ranges,n,0,n.length,d,{tabOffset:0,ranges:a});t=" ";!c._fullSelection&&9>e.isIE&&(t="\ufeff");c={text:t,style:c._metrics.largestFontStyle,ignoreChars:1};0===a.length||
!a[a.length-1].style||"div"!==a[a.length-1].style.tagName?a.push(c):a.splice(a.length-1,0,c);var h,u,k,v=t=0;if(e.isFirefox&&2E3<n.length){r&&(m.innerHTML="",r.lineWidth=void 0);r=f.createDocumentFragment();for(n=0;n<a.length;n++)c=a[n],d=c.text,h=c.style,h=this._createSpan(m,d,h,c.ignoreChars),r.appendChild(h);m.appendChild(r)}else{var x,z;if(r){if(u=r.modelChangedEvent)0===u.removedLineCount&&0===u.addedLineCount?(z=u.start-d,x=u.addedCharCount-u.removedCharCount):z=-1,r.modelChangedEvent=void 0;
u=r.firstChild}for(n=0;n<a.length;n++){c=a[n];d=c.text;t+=d.length;h=c.style;if(u)if(k=u.firstChild.data,f=u.viewStyle,k===d&&b(h,f)){v+=k.length;u._rectsCache=void 0;h=u=u.nextSibling;continue}else for(;u;){if(-1!==z){f=t;f>=z&&(f-=x);k=(k=u.firstChild.data)?k.length:0;if(v+k>f)break;v+=k}f=u.nextSibling;m.removeChild(u);u=f}h=this._createSpan(m,d,h,c.ignoreChars);u?m.insertBefore(h,u):m.appendChild(h);r&&(r.lineWidth=void 0)}if(r)for(x=h?h.nextSibling:null;x;)f=x.nextSibling,r.removeChild(x),x=
f}m.parentNode||g.appendChild(m);return m},_createRanges:function(g,r,a,c,m,e){if(!(a>c)){if(g)for(var n=0;n<g.length;n++){var d=g[n];if(!(d.end<m+a)){var t=Math.max(m+a,d.start)-m;if(t>c)break;var f=Math.min(m+c,d.end)-m;if(t<=f){t=Math.max(a,t);f=Math.min(c,f);a<t&&this._createRange(r,a,t,null,e);if(!d.style||!d.style.unmergeable)for(;n+1<g.length&&g[n+1].start-m===f&&b(d.style,g[n+1].style);)d=g[n+1],f=Math.min(m+c,d.end)-m,n++;this._createRange(r,t,f,d.style,e);a=f}}}a<c&&this._createRange(r,
a,c,null,e)}},_createRange:function(g,r,a,b,c){if(!(r>a)){var m=this.view._customTabSize;if(m&&8!==m)for(var e=g.indexOf("\t",r);-1!==e&&e<a;){r<e&&(r={text:g.substring(r,e),style:b},c.ranges.push(r),c.tabOffset+=r.text.length);r=m-c.tabOffset%m;if(0<r){for(var n="\u00a0",d=1;d<r;d++)n+=" ";r={text:n,style:b,ignoreChars:r-1};c.ranges.push(r);c.tabOffset+=r.text.length}r=e+1;if(r===a)return;e=g.indexOf("\t",r)}r<=a&&(r={text:g.substring(r,a),style:b},c.ranges.push(r),c.tabOffset+=r.text.length)}},
_createSpan:function(g,r,a,b){var c=this.view,m="span";a&&a.tagName&&(m=a.tagName.toLowerCase());var n="a"===m;n&&(this.hasLink=!0);n&&!c._linksVisible&&(m="span");n=g.ownerDocument;g=e.createElement(g.ownerDocument,m);g.appendChild(n.createTextNode(a&&a.text?a.text:r));a&&a.html?(g.innerHTML=a.html,g.ignore=!0):a&&a.node&&(g.appendChild(a.node),g.ignore=!0);l(a,g);if("a"===m){var d=c._getWindow();y(g,"click",function(g){return c._handleLinkClick(g?g:d.event)},!1)}g.viewStyle=a;b&&(g.ignoreChars=
b);return g},_ensureCreated:function(){return this._lineDiv?this._lineDiv:this._createdDiv=this.create(this.view._clientDiv,null)},getBoundingClientRect:function(g,r){var a=this._ensureCreated(),b=this.view;if(void 0===g)return this._getLineBoundingClientRect(a,!0);var c=b._model,m=a.ownerDocument,n=this.lineIndex,d=null;if(g<c.getLineEnd(n)){var t=c.getLineStart(n);this.forEach(function(r){var c=r.firstChild,n=this._nodeLength(r);if(t+n>g){var f=g-t;if(1===c.length)d=new v(r.getBoundingClientRect());
else if(b._isRangeRects)n=m.createRange(),n.setStart(c,f),n.setEnd(c,f+1),d=new v(n.getBoundingClientRect());else if(e.isIE)n=m.body.createTextRange(),n.moveToElementText(r),n.collapse(),(c=0===f&&8===e.isIE)&&(f=1),n.moveEnd("character",f+1),n.moveStart("character",f),d=new v(n.getBoundingClientRect()),c&&(d.left=r.getClientRects()[0].left);else{var l=c.data;r.removeChild(c);r.appendChild(m.createTextNode(l.substring(0,f)));var h=e.createElement(m,"span");h.appendChild(m.createTextNode(l.substring(f,
f+1)));r.appendChild(h);r.appendChild(m.createTextNode(l.substring(f+1)));d=new v(h.getBoundingClientRect());r.innerHTML="";r.appendChild(c);this._createdDiv||(r=b._getSelection(),(t<=r.start&&r.start<t+n||t<=r.end&&r.end<t+n)&&b._updateDOMSelection())}e.isIE&&(f=a.ownerDocument.defaultView||a.ownerDocument.parentWindow,r=f.screen.logicalXDPI/f.screen.deviceXDPI,f=f.screen.logicalYDPI/f.screen.deviceYDPI,d.left*=r,d.right*=r,d.top*=f,d.bottom*=f);return!1}t+=n;return!0})}c=this.getBoundingClientRect();
d||(b._wrapMode?(n=this.getClientRects(),d=n[n.length-1],d.left=d.right,d.left+=c.left,d.top+=c.top,d.right+=c.left,d.bottom+=c.top):(d=new v(c),d.left=d.right));if(r||void 0===r)d.left-=c.left,d.top-=c.top,d.right-=c.left,d.bottom-=c.top;return d},forEach:function(g){for(var r=this._ensureCreated().firstChild;r;){var a=r.nextSibling;if(!r.ignore&&!g.call(this,r))break;r=a}},_getClientRects:function(g,r){var a,b,c,m;if(!g._rectsCache){a=g.getClientRects();b=Array(a.length);for(m=0;m<a.length;m++)c=
b[m]=new v(a[m]),c.left-=r.left,c.top-=r.top,c.right-=r.left,c.bottom-=r.top;g._rectsCache=b}a=g._rectsCache;b=[a.length];for(m=0;m<a.length;m++)b[m]=new v(a[m]);return b},getClientRects:function(g){if(!this.view._wrapMode)return[this.getBoundingClientRect()];var r=[],a=this._ensureCreated().getBoundingClientRect();this.forEach(function(g){g=this._getClientRects(g,a);for(var b=0;b<g.length;b++){var c=g[b],m,e;if(c.top!==c.bottom){var d=c.top+(c.bottom-c.top)/2;for(m=0;m<r.length&&!(e=r[m],e.top<=
d&&d<e.bottom);m++);m===r.length?r.push(c):(c.left<e.left&&(e.left=c.left),c.top<e.top&&(e.top=c.top),c.right>e.right&&(e.right=c.right),c.bottom>e.bottom&&(e.bottom=c.bottom))}}return!0});return void 0!==g?r[g]:r},_getLineBoundingClientRect:function(g,r){var a=new v(g.getBoundingClientRect());if(!this.view._wrapMode){a.right=a.left;for(var b=g.lastChild;b&&b.ignoreChars===b.firstChild.length;)b=b.previousSibling;b&&(b=b.getBoundingClientRect(),a.right=b.right+t(g).right)}r&&(b=t(g),a.left+=b.left,
a.right-=b.right);return a},getLineCount:function(){return!this.view._wrapMode?1:this.getClientRects().length},getLineIndex:function(g){if(!this.view._wrapMode)return 0;var r=this.getClientRects();g=this.getBoundingClientRect(g);g=g.top+(g.bottom-g.top)/2;for(var a=0;a<r.length;a++)if(r[a].top<=g&&g<r[a].bottom)return a;return r.length-1},getLineStart:function(g){if(!this.view._wrapMode||0===g)return this.view._model.getLineStart(this.lineIndex);var r=this.getClientRects();return this.getOffset(r[g].left+
1,r[g].top+1)},_nodeLength:function(g){if(!g||g.ignore)return 0;var r=g.firstChild.length;g.ignoreChars&&(r-=g.ignoreChars);return r},getModelOffset:function(g,r){if(!g)return 0;var a=0;this.forEach(function(b){var c=b.firstChild;if(c===g)return b.ignoreChars&&(a-=b.ignoreChars),a+=r,!1;b.ignoreChars&&(a-=b.ignoreChars);a+=c.data.length;return!0});return Math.max(0,a)+this.view._model.getLineStart(this.lineIndex)},getNodeOffset:function(g){var r=0,a,b,c=this.view._model,m=c.getLineStart(this.lineIndex),
e=g-m,d=c.getLineEnd(this.lineIndex)-m;this.forEach(function(g){var c=g.firstChild,m=this._nodeLength(g);if(m+r>e||r+m>=d)return a=c,b=e-r,g.ignoreChars&&(0<m&&b===m)&&(b+=g.ignoreChars),!1;r+=m;return!0});return{node:a,offset:b}},getText:function(g){var r="",a=0;this.forEach(function(b){var c;if(b.ignoreChars){c=b.lastChild;for(var m=0,e=[],d=-1;c;){var n=c.data;if(n)for(var t=n.length-1;0<=t;t--){var f=n.substring(t,t+1);m<b.ignoreChars&&(" "===f||"\ufeff"===f)?m++:e.push("\u00a0"===f?"\t":f)}g===
c&&(d=e.length);c=c.previousSibling}e=e.reverse().join("");-1!==d&&(a=r.length+e.length-d);r+=e}else for(c=b.firstChild;c;)g===c&&(a=r.length),r+=c.data,c=c.nextSibling;return!0});return{text:r,offset:a}},getOffset:function(g,r){function a(b,D,t){var u=b.firstChild,G=h._nodeLength(b),k=f.ownerDocument,v=k.defaultView||k.parentWindow,x=e.isIE?v.screen.logicalXDPI/v.screen.deviceXDPI:1,z=e.isIE?v.screen.logicalYDPI/v.screen.deviceYDPI:1,w,p,q,v=t.left+l.left,M,s;if(e.isIE||c._isRangeRects){for(var k=
c._isRangeRects?k.createRange():k.body.createTextRange(),y=G,E=-1;1<y-E;){var A=Math.floor((y+E)/2);t=E+1;w=A===G-1&&b.ignoreChars?u.length:A+1;M=0===t&&8===e.isIE;c._isRangeRects?(k.setStart(u,t),k.setEnd(u,w)):(M&&(t=1),k.moveToElementText(b),k.move("character",t),k.moveEnd("character",w-t));s=k.getClientRects();for(var Q=!1,K=0;K<s.length;K++)if(t=s[K],w=(M?v:t.left)*x-l.left,q=t.right*x-l.left,p=t.top*z-l.top,t=t.bottom*z-l.top,w<=g&&g<q&&(!c._wrapMode||p<=r&&r<t)){Q=!0;break}Q?y=A:E=A}D+=y;t=
y;w=y===G-1&&b.ignoreChars?u.length:Math.min(y+1,u.length);c._isRangeRects?(k.setStart(u,t),k.setEnd(u,w)):(k.moveToElementText(b),k.move("character",t),k.moveEnd("character",w-t));s=k.getClientRects();G=!1;0<s.length&&(t=s[0],w=(M?v:t.left)*x-l.left,q=t.right*x-l.left,G=g>w+(q-w)/2);b=D-n;u=m.getLine(d);x=u.charCodeAt(b);55296<=x&&56319>=x&&G?b<u.length&&(x=u.charCodeAt(b+1),56320<=x&&57343>=x&&(D+=1)):56320<=x&&(57343>=x&&!G)&&0<b&&(x=u.charCodeAt(b-1),55296<=x&&56319>=x&&(D-=1));G&&D++}else{x=
[];for(M=0;M<G;M++)x.push("\x3cspan\x3e"),M===G-1?x.push(u.data.substring(M)):x.push(u.data.substring(M,M+1)),x.push("\x3c/span\x3e");b.innerHTML=x.join("");for(x=b.firstChild;x;){t=x.getBoundingClientRect();w=t.left-l.left;q=t.right-l.left;if(w<=g&&g<q){g>w+(q-w)/2&&D++;break}D++;x=x.nextSibling}h._createdDiv||(b.innerHTML="",b.appendChild(u),b=c._getSelection(),(D<=b.start&&b.start<D+G||D<=b.end&&b.end<D+G)&&c._updateDOMSelection())}return D}function b(a){if(a.ignore)return null;a=h._getClientRects(a,
l);for(var m=0;m<a.length;m++){var e=a[m];if(e.left<=g&&g<e.right&&(!c._wrapMode||e.top<=r&&r<e.bottom))return e}return null}var c=this.view,m=c._model,d=this.lineIndex,n=m.getLineStart(d),t=m.getLineEnd(d);if(n===t)return n;var f=this._ensureCreated(),l=this.getBoundingClientRect(),h=this,u,k;if(c._wrapMode){u=this.getClientRects();r<u[0].top&&(r=u[0].top);for(var v=0;v<u.length&&!(k=u[v],k.top<=r&&r<k.bottom);v++);g<k.left&&(g=k.left);g>k.right&&(g=k.right-1)}else 0>g&&(g=0),g>l.right-l.left&&(g=
l.right-l.left);var x,z;if(this._lastHitChild&&this._lastHitChild.parentNode){if(x=this._lastHitOffset,z=this._lastHitChild,k=b(z),!k){u=x;for(var v=x+this._nodeLength(z),w=z.previousSibling,p=z.nextSibling;w||p;){if(w){u-=this._nodeLength(w);if(k=b(w)){z=w;x=u;break}w=w.previousSibling}if(p){if(k=b(p)){z=p;x=v;break}v+=this._nodeLength(p);p=p.nextSibling}}}}else x=n,this.forEach(function(g){z=g;if(k=b(z))return!1;x+=this._nodeLength(z);return!0});z&&k&&(this._lastHitChild=z,this._lastHitOffset=x,
x=a(z,x,k));return Math.min(t,Math.max(n,x))},getNextOffset:function(g,r){if("line"===r.unit){var a=this.view._model,b=a.getLineAtOffset(g);if(0<r.count)return r.count--,a.getLineEnd(b);r.count++;return a.getLineStart(b)}return"wordend"===r.unit||"wordWS"===r.unit||"wordendWS"===r.unit?this._getNextOffset_W3C(g,r):e.isIE?this._getNextOffset_IE(g,r):this._getNextOffset_W3C(g,r)},_getNextOffset_W3C:function(g,r){function a(g){return 33<=g&&47>=g||58<=g&&64>=g||91<=g&&94>=g||96===g||123<=g&&126>=g}function b(g){return 32===
g||9===g}var c=this.view._model,m=c.getLineAtOffset(g),e=c.getLine(m),d=c.getLineStart(m),c=c.getLineEnd(m),m=e.length,n=g-d,t,f=0>r.count?-1:1;if("word"===r.unit||"wordend"===r.unit||"wordWS"===r.unit||"wordendWS"===r.unit)for(var l,u,h;0!==r.count;){if(0<r.count){if(n===m)return c;t=e.charCodeAt(n);l=a(t);u=!l&&!b(t);for(n++;n<m;){t=e.charCodeAt(n);if("wordWS"!==r.unit&&"wordendWS"!==r.unit){h=a(t);if("wordend"===r.unit){if(!h&&l)break}else if(h&&!l)break;t=!h&&!b(t)}else t=!b(t);if("wordend"===
r.unit||"wordendWS"===r.unit){if(!t&&u)break}else if(t&&!u)break;u=t;l=h;n++}}else{if(0===n)return d;n--;t=e.charCodeAt(n);l=a(t);for(u=!l&&!b(t);0<n;){t=e.charCodeAt(n-1);if("wordWS"!==r.unit&&"wordendWS"!==r.unit){h=a(t);if("wordend"===r.unit){if(h&&!l)break}else if(!h&&l)break;t=!h&&!b(t)}else t=!b(t);if("wordend"===r.unit||"wordendWS"===r.unit){if(t&&!u)break}else if(!t&&u)break;u=t;l=h;n--}}r.count-=f}else for(;0!==r.count&&0<=n+f&&n+f<=m;)n+=f,t=e.charCodeAt(n),56320<=t&&57343>=t&&0<n&&(t=e.charCodeAt(n-
1),55296<=t&&56319>=t&&(n+=f)),r.count-=f;return d+n},_getNextOffset_IE:function(g,r){var a=this._ensureCreated(),b=this.view._model,c=this.lineIndex,m=0,e;e=b.getLineStart(c);var n=a.ownerDocument,d=0>r.count?-1:1;if(g===b.getLineEnd(c)){for(a=a.lastChild;a&&a.ignoreChars===a.firstChild.length;)a=a.previousSibling;if(!a)return e;m=n.body.createTextRange();m.moveToElementText(a);e=m.text.length;m.moveEnd(r.unit,d);m=g+m.text.length-e}else if(g===e&&0>r.count)m=e;else for(a=a.firstChild;a;){b=this._nodeLength(a);
if(e+b>g){m=n.body.createTextRange();if(g===e&&0>r.count){for(e=a.previousSibling;e&&(!e.firstChild||!e.firstChild.length);)e=e.previousSibling;m.moveToElementText(e?e:a.previousSibling)}else m.moveToElementText(a),m.collapse(),m.moveEnd("character",g-e);e=m.text.length;m.moveEnd(r.unit,d);m=g+m.text.length-e;break}e=b+e;a=a.nextSibling}r.count-=d;return m},updateLinks:function(){var g=this._ensureCreated();if(this.hasLink){var r=this;this.forEach(function(a){var b=a.viewStyle;b&&(b.tagName&&"a"===
b.tagName.toLowerCase())&&g.replaceChild(r._createSpan(g,a.firstChild.data,b),a);return!0})}},destroy:function(){var g=this._createdDiv;g&&(g.parentNode.removeChild(g),this._createdDiv=null)}};w.prototype={addKeyMode:function(g,r){var a=this._keyModes;void 0!==r?a.splice(r,0,g):a.push(g);g._modeAdded&&g._modeAdded()},addRuler:function(g,r){g.setView(this);var a=this._rulers;if(void 0!==r){var b,c;for(c=b=0;b<a.length&&c<r;b++)g.getLocation()===a[b].getLocation()&&c++;a.splice(c,0,g);r=c}else a.push(g);
this._createRuler(g,r);this._update()},computeSize:function(){var g=0,r=0,a=this._model,b=this._clientDiv;if(!b)return{width:g,height:r};var c=b.style.width;e.isWebkit&&(b.style.width="0x7fffffffpx");for(var a=a.getLineCount(),m=0;m<a;m++){var n=this._getLine(m),d=n.getBoundingClientRect(),g=Math.max(g,d.right-d.left),r=r+(d.bottom-d.top);n.destroy()}e.isWebkit&&(b.style.width=c);b=this._getViewPadding();g+=b.right+b.left+this._metrics.scrollWidth;r+=b.bottom+b.top+this._metrics.scrollWidth;return{width:g,
height:r}},convert:function(g,r,a){if(this._clientDiv){var b=this._getScroll(),c=this._getViewPadding(),m=this._viewDiv.getBoundingClientRect();"document"===r&&(void 0!==g.x&&(g.x+=-b.x+m.left+c.left),void 0!==g.y&&(g.y+=-b.y+m.top+c.top));"document"===a&&(void 0!==g.x&&(g.x+=b.x-m.left-c.left),void 0!==g.y&&(g.y+=b.y-m.top-c.top));return g}},destroy:function(){for(var g=0;g<this._rulers.length;g++)this._rulers[g].setView(null);this.rulers=null;this._destroyView();this.onDestroy({type:"Destroy"});
this._parent=null;this._model&&this._model.destroy&&this._model.destroy();this._actions=this._keyModes=this._doubleClickSelection=this._selection=this._theme=this._model=null},focus:function(){this._clientDiv&&(this._updateDOMSelection(),this._clientDiv.focus(),this._updateDOMSelection())},hasFocus:function(){return this._hasFocus},getActionDescription:function(g){if(g=this._actions[g])return g.actionDescription},getActions:function(g){var r=[],a=this._actions,b;for(b in a)a.hasOwnProperty(b)&&(g||
!a[b].defaultHandler)&&r.push(b);return r},getBottomIndex:function(g){return!this._clientDiv?0:this._getBottomIndex(g)},getBottomPixel:function(){return!this._clientDiv?0:this._getScroll().y+this._getClientHeight()},getCaretOffset:function(){return this._getSelection().getCaret()},getClientArea:function(){if(!this._clientDiv)return{x:0,y:0,width:0,height:0};var g=this._getScroll();return{x:g.x,y:g.y,width:this._getClientWidth(),height:this._getClientHeight()}},getHorizontalPixel:function(){return!this._clientDiv?
0:this._getScroll().x},getKeyBindings:function(g){for(var r=[],a=this._keyModes,b=0;b<a.length;b++)r=r.concat(a[b].getKeyBindings(g));return r},getKeyModes:function(){return this._keyModes.slice(0)},getLineHeight:function(g){return!this._clientDiv?0:this._getLineHeight(g)},getLineIndex:function(g){return!this._clientDiv?0:this._getLineIndex(g)},getLinePixel:function(g){return!this._clientDiv?0:this._getLinePixel(g)},getLocationAtOffset:function(g){if(!this._clientDiv)return{x:0,y:0};var r=this._model;
g=Math.min(Math.max(0,g),r.getCharCount());var r=r.getLineAtOffset(g),a=this._getLine(r);g=a.getBoundingClientRect(g);a.destroy();a=g.left;r=this._getLinePixel(r)+g.top;return{x:a,y:r}},getNextOffset:function(g,r){var a=new u(g,g,!1);this._doMove(r,a);return a.getCaret()},getOptions:function(){var g;if(0===arguments.length)g=this._defaultOptions();else if(1===arguments.length){if(g=arguments[0],"string"===typeof g)return h(this["_"+g])}else{g={};for(var r in arguments)arguments.hasOwnProperty(r)&&
(g[arguments[r]]=void 0)}for(var a in g)g.hasOwnProperty(a)&&(g[a]=h(this["_"+a]));return g},getModel:function(){return this._model},getOffsetAtLocation:function(g,r){if(!this._clientDiv)return 0;var a=this._getLineIndex(r),b=this._getLine(a),a=b.getOffset(g,r-this._getLinePixel(a));b.destroy();return a},getLineAtOffset:function(g){this.getModel().getLineAtOffset(g)},getLineStart:function(g){this.getModel().getLineStart(g)},getRulers:function(){return this._rulers.slice(0)},getSelection:function(){var g=
this._getSelection();return{start:g.start,end:g.end}},getText:function(g,r){return this._model.getText(g,r)},getTopIndex:function(g){return!this._clientDiv?0:this._getTopIndex(g)},getTopPixel:function(){return!this._clientDiv?0:this._getScroll().y},invokeAction:function(g,r,a){if(this._clientDiv){if(g=this._actions[g]){if(!r&&g.handler&&g.handler(a))return!0;if(g.defaultHandler)return"boolean"===typeof g.defaultHandler(a)}return!1}},isDestroyed:function(){return!this._clientDiv},onContextMenu:function(g){return this.dispatchEvent(g)},
onDragStart:function(g){return this.dispatchEvent(g)},onDrag:function(g){return this.dispatchEvent(g)},onDragEnd:function(g){return this.dispatchEvent(g)},onDragEnter:function(g){return this.dispatchEvent(g)},onDragOver:function(g){return this.dispatchEvent(g)},onDragLeave:function(g){return this.dispatchEvent(g)},onDrop:function(g){return this.dispatchEvent(g)},onDestroy:function(g){return this.dispatchEvent(g)},onLineStyle:function(g){return this.dispatchEvent(g)},onKeyDown:function(g){return this.dispatchEvent(g)},
onKeyPress:function(g){return this.dispatchEvent(g)},onKeyUp:function(g){return this.dispatchEvent(g)},onModelChanged:function(g){return this.dispatchEvent(g)},onModelChanging:function(g){return this.dispatchEvent(g)},onModify:function(g){return this.dispatchEvent(g)},onMouseDown:function(g){return this.dispatchEvent(g)},onMouseUp:function(g){return this.dispatchEvent(g)},onMouseMove:function(g){return this.dispatchEvent(g)},onMouseOver:function(g){return this.dispatchEvent(g)},onMouseOut:function(g){return this.dispatchEvent(g)},
onSelection:function(g){return this.dispatchEvent(g)},onScroll:function(g){return this.dispatchEvent(g)},onVerify:function(g){return this.dispatchEvent(g)},onFocus:function(g){return this.dispatchEvent(g)},onBlur:function(g){return this.dispatchEvent(g)},redraw:function(){if(!(0<this._redrawCount)){var g=this._model.getLineCount();this.redrawRulers(0,g);this.redrawLines(0,g)}},redrawRulers:function(g,r){if(!(0<this._redrawCount))for(var a=this.getRulers(),b=0;b<a.length;b++)this.redrawLines(g,r,a[b])},
redrawLines:function(g,r,a){if(!(0<this._redrawCount)&&(void 0===g&&(g=0),void 0===r&&(r=this._model.getLineCount()),g!==r)){var b=this._clientDiv;if(b){if(a)for(b=this._getRulerParent(a).firstChild;b&&b._ruler!==a;)b=b.nextSibling;a?b.rulerChanged=!0:this._lineHeight&&this._resetLineHeight(g,r);if(!a||"page"===a.getOverview())for(b=b.firstChild;b;){var c=b.lineIndex;g<=c&&c<r&&(b.lineChanged=!0);b=b.nextSibling}!a&&(!this._wrapMode&&g<=this._maxLineIndex&&this._maxLineIndex<r)&&(this._checkMaxLineIndex=
this._maxLineIndex,this._maxLineIndex=-1,this._maxLineWidth=0);this._queueUpdate()}}},redrawRange:function(g,r){if(!(0<this._redrawCount)){var a=this._model;void 0===g&&(g=0);void 0===r&&(r=a.getCharCount());var b=a.getLineAtOffset(g),a=a.getLineAtOffset(Math.max(g,r-1))+1;this.redrawLines(b,a)}},removeKeyMode:function(g){for(var r=this._keyModes,a=0;a<r.length;a++)if(r[a]===g){r.splice(a,1);break}g._modeRemoved&&g._modeRemoved()},removeRuler:function(g){for(var r=this._rulers,a=0;a<r.length;a++)if(r[a]===
g){r.splice(a,1);g.setView(null);this._destroyRuler(g);this._update();break}},resize:function(){this._clientDiv&&this._handleResize(null)},setAction:function(g,a,b){if(g){var c=this._actions,m=c[g];m||(m=c[g]={});m.handler=a;void 0!==b&&(m.actionDescription=b)}},setKeyBinding:function(g,a){this._keyModes[0].setKeyBinding(g,a)},setCaretOffset:function(g,a,b){var c=this._model.getCharCount();g=Math.max(0,Math.min(g,c));g=new u(g,g,!1);this._setSelection(g,void 0===a||a,!0,b)},setHorizontalPixel:function(g){this._clientDiv&&
(g=Math.max(0,g),this._scrollView(g-this._getScroll().x,0))},setRedraw:function(g){g?0===--this._redrawCount&&this.redraw():this._redrawCount++},setModel:function(g){if(g&&g!==this._model){this._model.removeEventListener("preChanging",this._modelListener.onChanging);this._model.removeEventListener("postChanged",this._modelListener.onChanged);var a=this._model.getLineCount(),b=this._model.getCharCount(),c=g.getLineCount(),m=g.getCharCount(),e={type:"ModelChanging",text:g.getText(),start:0,removedCharCount:b,
addedCharCount:m,removedLineCount:a,addedLineCount:c};this.onModelChanging(e);this._model=g;e={type:"ModelChanged",start:0,removedCharCount:b,addedCharCount:m,removedLineCount:a,addedLineCount:c};this.onModelChanged(e);this._model.addEventListener("preChanging",this._modelListener.onChanging);this._model.addEventListener("postChanged",this._modelListener.onChanged);this._reset();this._update()}},setOptions:function(g){var a=this._defaultOptions(),c;for(c in g)if(g.hasOwnProperty(c)){var m=g[c];if(!b(this["_"+
c],m)){var e=a[c]?a[c].update:null;e?e.call(this,m):this["_"+c]=h(m)}}},setSelection:function(g,a,b,c){var m=g>a;if(m){var e=g;g=a;a=e}e=this._model.getCharCount();g=Math.max(0,Math.min(g,e));a=Math.max(0,Math.min(a,e));g=new u(g,a,m);this._setSelection(g,void 0===b||b,!0,c)},setText:function(g,a,b){var c=void 0===a&&void 0===b;void 0===a&&(a=0);void 0===b&&(b=this._model.getCharCount());c&&(this._variableLineHeight=!1);this._modifyContent({text:g,start:a,end:b,_code:!0},!c);c&&(this._columnX=-1,
this._setSelection(new u(0,0,!1),!0),13>e.isFirefox&&this._fixCaret())},setTopIndex:function(g){this._clientDiv&&this._scrollView(0,this._getLinePixel(Math.max(0,g))-this._getScroll().y)},setTopPixel:function(g){this._clientDiv&&this._scrollView(0,Math.max(0,g)-this._getScroll().y)},showSelection:function(g,a){return this._showCaret(g?!1:!0,a,g)},update:function(g,a){this._clientDiv&&((g||this._metrics.invalid)&&this._updateStyle(),void 0===a||a?this._update():this._queueUpdate())},_handleRootMouseDown:function(g){this._cancelCheckSelection();
if(!this._ignoreEvent(g)){13>e.isFirefox&&1===g.which&&(this._clientDiv.contentEditable=!1,this._ignoreBlur=(this._overlayDiv||this._clientDiv).draggable=!0);var a=this._overlayDiv||this._clientDiv;9>e.isIE&&(a=this._viewDiv);for(var b=g.target?g.target:g.srcElement;b;){if(a===b||b.className&&-1!==b.className.indexOf("textViewFind"))return;b=b.parentNode}g.preventDefault&&g.preventDefault();g.stopPropagation&&g.stopPropagation();if(!this._isW3CEvents){var c=this;this._getWindow().setTimeout(function(){c._clientDiv.focus()},
0)}}},_handleRootMouseUp:function(g){!this._ignoreEvent(g)&&(13>e.isFirefox&&1===g.which)&&(this._clientDiv.contentEditable=!0,(this._overlayDiv||this._clientDiv).draggable=!1,this._fixCaret(),this._ignoreBlur=!1)},_handleBlur:function(g){this._cancelCheckSelection();if(!this._ignoreBlur){this._hasFocus=!1;if(9>e.isIE&&!this._getSelection().isEmpty()){g=this._rootDiv;var a=e.createElement(g.ownerDocument,"div");g.appendChild(a);g.removeChild(a)}this._cursorDiv&&(this._cursorDiv.style.display="none");
if(this._selDiv1)if(this._selDiv1.style.background="lightgray",this._selDiv2.style.background="lightgray",this._selDiv3.style.background="lightgray",g=this._getWindow(),a=this._selDiv1.ownerDocument,g.getSelection){a=g.getSelection();for(g=a.anchorNode;g;){if(g===this._clientDiv){0<a.rangeCount&&a.removeAllRanges();break}g=g.parentNode}}else if(a.selection){this._ignoreSelect=!1;for(g=a.selection.createRange().parentElement();g;){if(g===this._clientDiv){a.selection.empty();break}g=g.parentNode}this._ignoreSelect=
!0}if(!this._ignoreFocus)this.onBlur({type:"Blur"})}},_handleContextMenu:function(g){if(!this._ignoreEvent(g)){e.isIE&&3===this._lastMouseButton&&this._updateDOMSelection();var a=!1;this.isListening("ContextMenu")?(a=this._createMouseEvent("ContextMenu",g),a.screenX=g.screenX,a.screenY=g.screenY,this.onContextMenu(a),a=a.defaultPrevented):e.isMac&&(e.isFirefox&&0===g.button)&&(a=!0);if(a)return g.preventDefault&&g.preventDefault(),!1;this._contextMenuOpen=!0;e.isFirefox&&(this._checkSelectionChange=
!0,this._pollSelectionChange(!0))}},_handleCopy:function(g){this._cancelCheckSelection();if(!this._ignoreEvent(g)&&!this._ignoreCopy&&this._doCopy(g))return g.preventDefault&&g.preventDefault(),!1},_handleCut:function(g){this._cancelCheckSelection();if(!this._ignoreEvent(g)&&this._doCut(g))return g.preventDefault&&g.preventDefault(),!1},_handleDataModified:function(g){this._ignoreEvent(g)||this._startIME()},_handleDblclick:function(g){this._ignoreEvent(g)||(this._lastMouseTime=g.timeStamp?g.timeStamp:
(new Date).getTime(),2!==this._clickCount&&(this._clickCount=2,this._handleMouse(g)))},_handleDragStart:function(g){if(!this._ignoreEvent(g)){if(13>e.isFirefox){var a=this;this._getWindow().setTimeout(function(){a._clientDiv.contentEditable=!0;a._clientDiv.draggable=!1;a._ignoreBlur=!1},0)}if(this.isListening("DragStart")&&-1!==this._dragOffset)this._isMouseDown=!1,this.onDragStart(this._createMouseEvent("DragStart",g)),this._dragOffset=-1;else return g.preventDefault&&g.preventDefault(),!1}},_handleDrag:function(g){if(!this._ignoreEvent(g)&&
this.isListening("Drag"))this.onDrag(this._createMouseEvent("Drag",g))},_handleDragEnd:function(g){if(!this._ignoreEvent(g)){this._dropTarget=!1;this._dragOffset=-1;if(this.isListening("DragEnd"))this.onDragEnd(this._createMouseEvent("DragEnd",g));13>e.isFirefox&&(this._fixCaret(),"none"===g.dataTransfer.dropEffect&&!g.dataTransfer.mozUserCancelled&&this._fixCaret())}},_handleDragEnter:function(g){if(!this._ignoreEvent(g)){var a=!0;this._dropTarget=!0;this.isListening("DragEnter")&&(a=!1,this.onDragEnter(this._createMouseEvent("DragEnter",
g)));if(e.isWebkit||a)return g.preventDefault&&g.preventDefault(),!1}},_handleDragOver:function(g){if(!this._ignoreEvent(g)){var a=!0;this.isListening("DragOver")&&(a=!1,this.onDragOver(this._createMouseEvent("DragOver",g)));if(e.isWebkit||a)return a&&(g.dataTransfer.dropEffect="none"),g.preventDefault&&g.preventDefault(),!1}},_handleDragLeave:function(g){if(!this._ignoreEvent(g)&&(this._dropTarget=!1,this.isListening("DragLeave")))this.onDragLeave(this._createMouseEvent("DragLeave",g))},_handleDrop:function(g){if(!this._ignoreEvent(g)){this._dropTarget=
!1;if(this.isListening("Drop"))this.onDrop(this._createMouseEvent("Drop",g));g.preventDefault&&g.preventDefault();return!1}},_handleFocus:function(g){this._hasFocus=!0;e.isIOS&&void 0!==this._lastTouchOffset?(this.setCaretOffset(this._lastTouchOffset,!0),this._lastTouchOffset=void 0):this._updateDOMSelection();this._cursorDiv&&(this._cursorDiv.style.display="block");this._selDiv1&&(g=this._highlightRGB,this._selDiv1.style.background=g,this._selDiv2.style.background=g,this._selDiv3.style.background=
g);if(!this._ignoreFocus)this.onFocus({type:"Focus"})},_handleKeyDown:function(g){this._cancelCheckSelection();if(!this._ignoreEvent(g)){if(this.isListening("KeyDown")){var a=this._createKeyEvent("KeyDown",g);this.onKeyDown(a);if(a.defaultPrevented){e.isFirefox&&(this._keyDownPrevented=!0);g.preventDefault();return}}a=!1;switch(g.keyCode){case 16:case 17:case 18:case 91:a=!0;break;default:this._setLinksVisible(!1)}if(229===g.keyCode){if(this._readonly)return g.preventDefault&&g.preventDefault(),!1;
a=!0;e.isSafari&&e.isMac&&g.ctrlKey&&(a=!1,g.keyCode=129);a&&this._startIME()}else a||this._commitIME();if((e.isMac||e.isLinux)&&4>e.isFirefox||12.16>e.isOpera)return this._keyDownEvent=g,!0;if(this._doAction(g))return g.preventDefault?(g.preventDefault(),g.stopPropagation()):(g.cancelBubble=!0,g.returnValue=!1,g.keyCode=0),!1}},_handleKeyPress:function(g){if(!this._ignoreEvent(g))if(this._keyDownPrevented)g.preventDefault&&(g.preventDefault(),g.stopPropagation()),this._keyDownPrevented=void 0;else{if(e.isMac&&
e.isWebkit&&(63232<=g.keyCode&&63487>=g.keyCode||13===g.keyCode||8===g.keyCode)||((e.isMac||e.isLinux)&&4>e.isFirefox||12.16>e.isOpera)&&this._doAction(this._keyDownEvent))return g.preventDefault&&g.preventDefault(),!1;var a=e.isMac?g.metaKey:g.ctrlKey;if(void 0!==g.charCode&&a)switch(g.charCode){case 99:case 118:case 120:return!0}if(this.isListening("KeyPress")&&(a=this._createKeyEvent("KeyPress",g),this.onKeyPress(a),a.defaultPrevented)){g.preventDefault();return}if(this._doAction(g))return g.preventDefault?
(g.preventDefault(),g.stopPropagation()):(g.cancelBubble=!0,g.returnValue=!1,g.keyCode=0),!1;a=!1;if(e.isMac){if(g.ctrlKey||g.metaKey)a=!0}else if(e.isFirefox){if(g.ctrlKey||g.altKey)a=!0}else g.ctrlKey^g.altKey&&(a=!0);if(!a&&(a=e.isOpera?g.which:void 0!==g.charCode?g.charCode:g.keyCode,31<a))return this._doContent(String.fromCharCode(a)),g.preventDefault&&g.preventDefault(),!1}},_handleDocKeyUp:function(g){(e.isMac?g.metaKey:g.ctrlKey)||this._setLinksVisible(!1)},_handleKeyUp:function(g){if(!this._ignoreEvent(g)){if(this.isListening("KeyUp")){var a=
this._createKeyEvent("KeyUp",g);this.onKeyUp(a);if(a.defaultPrevented){g.preventDefault();return}}this._handleDocKeyUp(g);13===g.keyCode&&this._commitIME()}},_handleLinkClick:function(g){if(!(e.isMac?g.metaKey:g.ctrlKey))return g.preventDefault&&g.preventDefault(),!1},_handleMouse:function(g){var a=this._getWindow(),b=!0,c=a;if(e.isIE||e.isFirefox&&!this._overlayDiv)c=this._clientDiv;if(this._overlayDiv){this._hasFocus&&(this._ignoreFocus=!0);var m=this;a.setTimeout(function(){m.focus();m._ignoreFocus=
!1},0)}1===this._clickCount?(b=this._setSelectionTo(g.clientX,g.clientY,g.shiftKey,(!e.isOpera||12.16<=e.isOpera)&&this._hasFocus&&this.isListening("DragStart")))&&this._setGrab(c):(this._isW3CEvents&&this._setGrab(c),this._doubleClickSelection=null,this._setSelectionTo(g.clientX,g.clientY,g.shiftKey),this._doubleClickSelection=this._getSelection());return b},_handleMouseDown:function(g){if(!this._ignoreEvent(g)){if(this._linksVisible)if("A"!==(g.target||g.srcElement).tagName)this._setLinksVisible(!1);
else return;this._commitIME();var a=g.which;a||(4===g.button&&(a=2),2===g.button&&(a=3),1===g.button&&(a=1));var b=2!==a&&g.timeStamp?g.timeStamp:(new Date).getTime(),c=b-this._lastMouseTime,m=Math.abs(this._lastMouseX-g.clientX),n=Math.abs(this._lastMouseY-g.clientY),d=this._lastMouseButton===a;this._lastMouseX=g.clientX;this._lastMouseY=g.clientY;this._lastMouseTime=b;this._lastMouseButton=a;1===a&&(this._isMouseDown=!0,d&&c<=this._clickTime&&m<=this._clickDist&&n<=this._clickDist?this._clickCount++:
this._clickCount=1);if(this.isListening("MouseDown")&&(b=this._createMouseEvent("MouseDown",g),this.onMouseDown(b),b.defaultPrevented)){g.preventDefault();return}if(1===a&&this._handleMouse(g)&&(9<=e.isIE||e.isOpera||e.isChrome||e.isSafari||e.isFirefox&&!this._overlayDiv))this._hasFocus||this.focus(),g.preventDefault();e.isFirefox&&3===this._lastMouseButton&&this._updateDOMSelection()}},_handleMouseOver:function(g){if(!this._ignoreEvent(g)&&!this._animation&&this.isListening("MouseOver"))this.onMouseOver(this._createMouseEvent("MouseOver",
g))},_handleMouseOut:function(g){if(!this._ignoreEvent(g)&&!this._animation&&this.isListening("MouseOut"))this.onMouseOut(this._createMouseEvent("MouseOut",g))},_handleMouseMove:function(g){if(!this._animation){var a=this._isClientDiv(g);if(this.isListening("MouseMove")&&a)this.onMouseMove(this._createMouseEvent("MouseMove",g));if(!this._dropTarget){var b=this._linksVisible||this._lastMouseMoveX!==g.clientX||this._lastMouseMoveY!==g.clientY;this._lastMouseMoveX=g.clientX;this._lastMouseMoveY=g.clientY;
this._setLinksVisible(b&&!this._isMouseDown&&(e.isMac?g.metaKey:g.ctrlKey));this._checkOverlayScroll();if(!this._isW3CEvents){if(0===g.button)return this._setGrab(null),!0;if(!this._isMouseDown&&1===g.button&&0!==(this._clickCount&1)&&a)return this._clickCount=2,this._handleMouse(g,this._clickCount)}if(this._isMouseDown&&-1===this._dragOffset){a=g.clientX;g=g.clientY;var c=this._getViewPadding(),m=this._viewDiv.getBoundingClientRect(),n=this._getClientWidth(),d=this._getClientHeight(),b=m.left+c.left,
t=m.top+c.top,n=m.left+c.left+n,c=m.top+c.top+d;g<t?this._doAutoScroll("up",a,g-t):g>c?this._doAutoScroll("down",a,g-c):a<b&&!this._wrapMode?this._doAutoScroll("left",a-b,g):a>n&&!this._wrapMode?this._doAutoScroll("right",a-n,g):(this._endAutoScroll(),this._setSelectionTo(a,g,!0))}}}},_isClientDiv:function(g){var a=this._overlayDiv||this._clientDiv;for(g=g.target?g.target:g.srcElement;g;){if(a===g)return!0;g=g.parentNode}return!1},_createKeyEvent:function(g,a){return{type:g,event:a,preventDefault:function(){this.defaultPrevented=
!0}}},_createMouseEvent:function(g,a){var b=this.convert({x:a.clientX,y:a.clientY},"page","document");return{type:g,event:a,clickCount:this._clickCount,x:b.x,y:b.y,preventDefault:function(){this.defaultPrevented=!0}}},_handleMouseUp:function(g){var a=g.which?0===g.button:1===g.button;if(this.isListening("MouseUp")&&(this._isClientDiv(g)||a&&this._isMouseDown))this.onMouseUp(this._createMouseEvent("MouseUp",g));if(!this._linksVisible){if(a&&this._isMouseDown){if(-1!==this._dragOffset){var b=this._getSelection();
b.extend(this._dragOffset);b.collapse();this._setSelection(b,!0,!0);this._dragOffset=-1}this._isMouseDown=!1;this._endAutoScroll();this._isW3CEvents&&this._setGrab(null)}a&&e.isFirefox&&(this._updateDOMSelection(),g.preventDefault())}},_handleMouseWheel:function(g){var a=this._getLineHeight(),b=0,c=0;e.isIE||e.isOpera?c=-g.wheelDelta/40*a:e.isFirefox?"wheel"===g.type?g.deltaMode?(b=Math.max(-256,Math.min(256,g.deltaX))*a,c=Math.max(-256,Math.min(256,g.deltaY))*a):(b=g.deltaX,c=g.deltaY):(a=e.isMac?
3*g.detail:Math.max(-256,Math.min(256,g.detail))*a,g.axis===g.HORIZONTAL_AXIS?b=a:c=a):e.isMac?(c=g.timeStamp-this._wheelTimeStamp,this._wheelTimeStamp=g.timeStamp,b=0!==g.wheelDeltaX%120?1:40>c?40/(40-c):40,c=0!==g.wheelDeltaY%120?1:40>c?40/(40-c):40,b=Math.ceil(-g.wheelDeltaX/b),-1<b&&0>b&&(b=-1),0<b&&1>b&&(b=1),c=Math.ceil(-g.wheelDeltaY/c),-1<c&&0>c&&(c=-1),0<c&&1>c&&(c=1)):(b=-g.wheelDeltaX,c=8*(-g.wheelDeltaY/120)*a);if(e.isSafari||e.isChrome&&e.isMac){for(a=g.target;a&&void 0===a.lineIndex;)a=
a.parentNode;this._mouseWheelLine=a}a=this._getScroll();this._scrollView(b,c);b=this._getScroll();if(a.x!==b.x||a.y!==b.y)return g.preventDefault&&g.preventDefault(),!1},_handlePaste:function(g){this._cancelCheckSelection();if(!this._ignoreEvent(g)&&!this._ignorePaste&&this._doPaste(g)){if(e.isIE){var a=this;this._ignoreFocus=!0;this._getWindow().setTimeout(function(){a._updateDOMSelection();a._ignoreFocus=!1},0)}g.preventDefault&&g.preventDefault();return!1}},_handleResize:function(g){g=this._rootDiv.clientWidth;
var a=this._rootDiv.clientHeight;if(this._rootWidth!==g||this._rootHeight!==a)this._rootWidth!==g&&this._wrapMode&&this._resetLineHeight(),this._rootWidth=g,this._rootHeight=a,g=9>e.isIE,a=this._calculateMetrics(),b(a,this._metrics)||(this._variableLineHeight&&(this._variableLineHeight=!1,this._resetLineHeight()),this._metrics=a,g=!0),g?this._queueUpdate():this._update()},_handleRulerEvent:function(g){for(var a=g.target?g.target:g.srcElement,b=a.lineIndex;a&&!a._ruler;)void 0===b&&void 0!==a.lineIndex&&
(b=a.lineIndex),a=a.parentNode;var c=a?a._ruler:null;if(void 0===b&&c&&"document"===c.getOverview()){var b=this._getClientHeight(),m=this._model.getLineCount(),e=this._getViewPadding(),n=this._viewDiv.getBoundingClientRect(),b=Math.floor((g.clientY-n.top-this._metrics.scrollWidth)*m/(b+e.top+e.bottom-2*this._metrics.scrollWidth));0<=b&&b<m||(b=void 0)}if(c)switch(g.type){case "click":if(c.onClick)c.onClick(b,g);break;case "dblclick":if(c.onDblClick)c.onDblClick(b,g);break;case "mousemove":if(c.onMouseMove)c.onMouseMove(b,
g);break;case "mouseover":if(c.onMouseOver)c.onMouseOver(b,g);break;case "mouseout":if(c.onMouseOut){for(m=g.relatedTarget;m&&m!==this._rootDiv;){if(m===a)return;m=m.parentNode}c.onMouseOut(b,g)}}},_handleScroll:function(){this._lastScrollTime=(new Date).getTime();var g=this._getScroll(!1),a=this._hScroll,b=this._vScroll;if(a!==g.x||b!==g.y)this._hScroll=g.x,this._vScroll=g.y,this._commitIME(),this._update(b===g.y),this.onScroll({type:"Scroll",oldValue:{x:a,y:b},newValue:g})},_handleSelectStart:function(g){var a=
this._contextMenuOpen;this._contextMenuOpen=!1;if(a)this._checkSelectionChange=!0;else if(this._ignoreSelect)return g&&g.preventDefault&&g.preventDefault(),!1},_getModelOffset:function(g,a){if(g){var b;b="DIV"===g.tagName?g:g.parentNode.parentNode;return!b._line?0:b._line.getModelOffset(g,a)}},_updateSelectionFromDOM:function(){if(!e.isOS&&!e.isAndroid&&!this._checkSelectionChange)return!1;var g=this._getWindow().getSelection(),a=this._getModelOffset(g.anchorNode,g.anchorOffset),b=this._getModelOffset(g.focusNode,
g.focusOffset),c=this._getSelection();if(void 0===a||void 0===b||c.start===a&&c.end===b)return!1;if(this._checkSelectionChange){var c=this._getLineNext(),m=this._getLinePrevious();if(g.anchorNode===c.firstChild.firstChild&&0===g.anchorOffset&&g.focusNode===m.firstChild.firstChild&&0===g.focusOffset)return!1;if(g.anchorNode===c.firstChild.firstChild&&0===g.anchorOffset&&g.focusNode===m.lastChild.firstChild||g.anchorNode===this._clientDiv&&g.focusNode===this._clientDiv)a=0,b=this.getModel().getCharCount()}this._setSelection(new u(a,
b),!1,!1);this._checkSelectionChange=!1;return!0},_cancelCheckSelection:function(){this._checkSelectionChange&&(this._checkSelectionChange=!1,this._cancelPollSelectionChange())},_cancelPollSelectionChange:function(){this._selPollTimer&&(this._getWindow().clearTimeout(this._selPollTimer),this._selPollTimer=null)},_pollSelectionChange:function(g){var a=this,b=this._getWindow();this._cancelPollSelectionChange();this._selPollTimer=b.setTimeout(function(){a._selPollTimer=null;a._clientDiv&&!a._updateSelectionFromDOM()&&
g&&a._pollSelectionChange(g)},100)},_handleSelectionChange:function(g){-1===this._imeOffset&&(e.isAndroid?this._pollSelectionChange():this._updateSelectionFromDOM())},_handleTextInput:function(g){if(!this._ignoreEvent(g)){this._imeOffset=-1;var a=this._getWindow().getSelection();if(a.anchorNode!==this._anchorNode||a.focusNode!==this._focusNode||a.anchorOffset!==this._anchorOffset||a.focusOffset!==this._focusOffset){for(var b=a.anchorNode;b&&void 0===b.lineIndex;)b=b.parentNode;if(b){var c=this._model,
m=b.lineIndex,n=c.getLine(m),d=n,t=0,c=c.getLineStart(m);0<a.rangeCount&&(a.getRangeAt(0).deleteContents(),m=b.ownerDocument.createTextNode(g.data),a.getRangeAt(0).insertNode(m),t=this._getDOMText(b,m),d=t.text,t=t.offset,m.parentNode.removeChild(m));b.lineRemoved=!0;for(b=0;n.charCodeAt(b)===d.charCodeAt(b)&&b<t;)b++;a=n.length-1;for(m=d.length-n.length;n.charCodeAt(a)===d.charCodeAt(a+m)&&a+m>=t+g.data.length;)a--;a++;n=d.substring(b,a+m);this._ignoreQueueUpdate=e.isSafari;this._modifyContent({text:n,
start:b+c,end:a+c,_ignoreDOMSelection:!0,_ignoreDOMSelection1:e.isChrome},!0);this._ignoreQueueUpdate=!1}}else this._doContent(g.data);g.preventDefault()}},_handleTouchStart:function(g){this._commitIME();var a=this._getWindow();this._touchScrollTimer&&(this._vScrollDiv.style.display="none",this._hScrollDiv.style.display="none",a.clearInterval(this._touchScrollTimer),this._touchScrollTimer=null);var b=g.touches;if(1===b.length){var b=b[0],c=b.clientX,m=b.clientY;this._touchStartX=c;this._touchStartY=
m;if(e.isAndroid&&(m<b.pageY-a.pageYOffset||c<b.pageX-a.pageXOffset))c=b.pageX-a.pageXOffset,m=b.pageY-a.pageYOffset;a=this.convert({x:c,y:m},"page","document");this._lastTouchOffset=this.getOffsetAtLocation(a.x,a.y);this._touchStartTime=g.timeStamp;this._touching=!0}},_handleTouchMove:function(g){var a=g.touches;if(1===a.length){a=a[0];this._touchCurrentX=a.clientX;this._touchCurrentY=a.clientY;if(!this._touchScrollTimer&&200>g.timeStamp-this._touchStartTime){this._vScrollDiv.style.display="block";
this._wrapMode||(this._hScrollDiv.style.display="block");var b=this,c=this._getWindow();this._touchScrollTimer=c.setInterval(function(){var g=0,a=0;if(b._touching)g=b._touchStartX-b._touchCurrentX,a=b._touchStartY-b._touchCurrentY,b._touchSpeedX=g/10,b._touchSpeedY=a/10,b._touchStartX=b._touchCurrentX,b._touchStartY=b._touchCurrentY;else{if(0.1>Math.abs(b._touchSpeedX)&&0.1>Math.abs(b._touchSpeedY)){b._vScrollDiv.style.display="none";b._hScrollDiv.style.display="none";c.clearInterval(b._touchScrollTimer);
b._touchScrollTimer=null;return}g=10*b._touchSpeedX;a=10*b._touchSpeedY;b._touchSpeedX*=0.95;b._touchSpeedY*=0.95}b._scrollView(g,a)},10)}this._touchScrollTimer&&g.preventDefault()}},_handleTouchEnd:function(g){0===g.touches.length&&(this._touching=!1)},_doAction:function(g){var a,b,c=this._keyModes;for(b=c.length-1;0<=b;b--)if(a=c[b],"function"===typeof a.match&&(a=a.match(g),void 0!==a))return this.invokeAction(a);return!1},_doMove:function(g,a){var b=this._model,c=a.getCaret(),m=b.getLineAtOffset(c);
g.count||(g.count=1);for(;0!==g.count;){var e=b.getLineStart(m);if(0>g.count&&c===e)if(0<m)"character"===g.unit&&g.count++,m--,a.extend(b.getLineEnd(m));else break;else if(0<g.count&&c===b.getLineEnd(m))if(m+1<b.getLineCount())"character"===g.unit&&g.count--,m++,a.extend(b.getLineStart(m));else break;else{var n=!1;g.expandTab&&("character"===g.unit&&0===(c-e)%this._tabSize)&&(e=b.getText(e,c),n=!/[^ ]/.test(e));n?(a.extend(c-this._tabSize),g.count+=0>g.count?1:-1):(e=this._getLine(m),a.extend(e.getNextOffset(c,
g)),e.destroy())}c=a.getCaret()}return a},_doBackspace:function(g){var a=this._getSelection();a.isEmpty()&&(g.count||(g.count=1),g.count*=-1,g.expandTab=this._expandTab,this._doMove(g,a));this._modifyContent({text:"",start:a.start,end:a.end},!0);return!0},_doCase:function(g){var a=this._getSelection();this._doMove(g,a);var b=this.getText(a.start,a.end);this._setSelection(a,!0);switch(g.type){case "lower":b=b.toLowerCase();break;case "capitalize":b=b.replace(/(?:^|\s)\S/g,function(g){return g.toUpperCase()});
break;case "reverse":g="";for(a=0;a<b.length;a++){var c=b[a],m=c.toLowerCase(),c=m!==c?m:c.toUpperCase();g+=c}b=g;break;default:b=b.toUpperCase()}this._doContent(b);return!0},_doContent:function(g){var a=this._getSelection();if(this._overwriteMode&&a.isEmpty()){var b=this._model,c=b.getLineAtOffset(a.end);a.end<b.getLineEnd(c)&&(b=this._getLine(c),a.extend(b.getNextOffset(a.getCaret(),{unit:"character",count:1})),b.destroy())}this._modifyContent({text:g,start:a.start,end:a.end,_ignoreDOMSelection:!0},
!0)},_doCopy:function(g){var a=this._getSelection();return!a.isEmpty()?(a=this._getBaseText(a.start,a.end),this._setClipboardText(a,g)):!0},_doCursorNext:function(g){var a=this._getSelection();!a.isEmpty()&&!g.select?a.start=a.end:this._doMove(g,a);g.select||a.collapse();this._setSelection(a,!0);return!0},_doCursorPrevious:function(g){var a=this._getSelection();!a.isEmpty()&&!g.select?a.end=a.start:(g.count||(g.count=1),g.count*=-1,this._doMove(g,a));g.select||a.collapse();this._setSelection(a,!0);
return!0},_doCut:function(g){var a=this._getSelection();return!a.isEmpty()?(a=this._getBaseText(a.start,a.end),this._doContent(""),this._setClipboardText(a,g)):!0},_doDelete:function(g){var a=this._getSelection();a.isEmpty()&&this._doMove(g,a);this._modifyContent({text:"",start:a.start,end:a.end},!0);return!0},_doEnd:function(g){var a=this._getSelection(),b=this._model,c;if(g.ctrl)a.extend(b.getCharCount()),c=function(){};else{var m=a.getCaret(),e=b.getLineAtOffset(m);if(this._wrapMode){var n=this._getLine(e),
m=n.getLineIndex(m),m=m===n.getLineCount()-1?b.getLineEnd(e):n.getLineStart(m+1)-1;n.destroy()}else g.count&&0<g.count&&(e=Math.min(e+g.count-1,b.getLineCount()-1)),m=b.getLineEnd(e);a.extend(m)}g.select||a.collapse();this._setSelection(a,!0,!0,c);return!0},_doEnter:function(g){var a=this._model,b=this._getSelection();this._doContent(a.getLineDelimiter());g&&g.noCursor&&(b.end=b.start,this._setSelection(b,!0));return!0},_doHome:function(g){var a=this._getSelection(),b=this._model,c;if(g.ctrl)a.extend(0),
c=function(){};else{var m=a.getCaret(),e=b.getLineAtOffset(m);this._wrapMode?(b=this._getLine(e),m=b.getLineIndex(m),m=b.getLineStart(m),b.destroy()):m=b.getLineStart(e);a.extend(m)}g.select||a.collapse();this._setSelection(a,!0,!0,c);return!0},_doLineDown:function(g){var a=this._model,b=this._getSelection(),c=b.getCaret(),m=a.getLineAtOffset(c),n=this._getLine(m),d=this._columnX,t=1,f=!1;if(-1===d||g.wholeLine||g.select&&e.isIE)d=g.wholeLine?a.getLineEnd(m+1):c,d=n.getBoundingClientRect(d).left;
(c=n.getLineIndex(c))<n.getLineCount()-1?t=n.getClientRects(c+1).top+1:(c=a.getLineCount()-1,f=m===c,g.count&&0<g.count?m=Math.min(m+g.count,c):m++);c=!1;if(f){if(g.select||e.isMac||e.isLinux)b.extend(a.getCharCount()),c=!0}else n.lineIndex!==m&&(n.destroy(),n=this._getLine(m)),b.extend(n.getOffset(d,t)),c=!0;c&&(g.select||b.collapse(),this._setSelection(b,!0,!0));this._columnX=d;n.destroy();return!0},_doLineUp:function(g){var a=this._model,b=this._getSelection(),c=b.getCaret(),m=a.getLineAtOffset(c),
n=this._getLine(m),d=this._columnX,t=!1,f;if(-1===d||g.wholeLine||g.select&&e.isIE)d=g.wholeLine?a.getLineStart(m-1):c,d=n.getBoundingClientRect(d).left;0<(c=n.getLineIndex(c))?f=n.getClientRects(c-1).top+1:(t=0===m,t||(g.count&&0<g.count?m=Math.max(m-g.count,0):m--,f=this._getLineHeight(m)-1));c=!1;if(t){if(g.select||e.isMac||e.isLinux)b.extend(0),c=!0}else n.lineIndex!==m&&(n.destroy(),n=this._getLine(m)),b.extend(n.getOffset(d,f)),c=!0;c&&(g.select||b.collapse(),this._setSelection(b,!0,!0));this._columnX=
d;n.destroy();return!0},_doNoop:function(){return!0},_doPageDown:function(g){var a=this,b=this._model,c=this._getSelection(),m=c.getCaret(),n=b.getLineAtOffset(m),d=b.getLineCount(),t=this._getScroll(),b=this._getClientHeight(),f,l;if(this._lineHeight){f=this._columnX;t=this._getBoundsAtOffset(m);if(-1===f||g.select&&e.isIE)f=t.left;m=this._getLineIndex(t.top+b);l=this._getLine(m);n=this._getLinePixel(m);m=l.getOffset(f,t.top+b-n);b=l.getBoundingClientRect(m);l.destroy();c.extend(m);g.select||c.collapse();
this._setSelection(c,!0,!0,function(){a._columnX=f},b.top+n-t.top);return!0}if(n<d-1){var u=this._getLineHeight(),h=Math.min(d-n-1,Math.floor(b/u)),h=Math.max(1,h);f=this._columnX;if(-1===f||g.select&&e.isIE)l=this._getLine(n),f=l.getBoundingClientRect(m).left,l.destroy();l=this._getLine(n+h);c.extend(l.getOffset(f,0));l.destroy();g.select||c.collapse();g=d*u;m=t.y+h*u;m+b>g&&(m=g-b);this._setSelection(c,!0,!0,function(){a._columnX=f},m-t.y)}return!0},_doPageUp:function(g){var a=this,b=this._model,
c=this._getSelection(),m=c.getCaret(),n=b.getLineAtOffset(m),d=this._getScroll(),t=this._getClientHeight(),f;if(this._lineHeight){f=this._columnX;d=this._getBoundsAtOffset(m);if(-1===f||g.select&&e.isIE)f=d.left;m=this._getLineIndex(d.bottom-t);b=this._getLine(m);n=this._getLinePixel(m);m=b.getOffset(f,d.bottom-t-n);t=b.getBoundingClientRect(m);b.destroy();c.extend(m);g.select||c.collapse();this._setSelection(c,!0,!0,function(){a._columnX=f},t.top+n-d.top);return!0}if(0<n){var l=this._getLineHeight(),
t=Math.max(1,Math.min(n,Math.floor(t/l)));f=this._columnX;if(-1===f||g.select&&e.isIE)b=this._getLine(n),f=b.getBoundingClientRect(m).left,b.destroy();b=this._getLine(n-t);c.extend(b.getOffset(f,this._getLineHeight(n-t)-1));b.destroy();g.select||c.collapse();g=Math.max(0,d.y-t*l);this._setSelection(c,!0,!0,function(){a._columnX=f},g-d.y)}return!0},_doPaste:function(g){var a=this;return null!==this._getClipboardText(g,function(g){g&&(e.isLinux&&2===a._lastMouseButton&&(new Date).getTime()-a._lastMouseTime<=
a._clickTime&&a._setSelectionTo(a._lastMouseX,a._lastMouseY),a._doContent(g))})},_doScroll:function(g){var a=g.type,b=this._model,c=b.getLineCount();g=this._getClientHeight();var m=this._getLineHeight(),c=c*m,e=this._getScroll().y,n;switch(a){case "textStart":n=0;break;case "textEnd":n=c-g;break;case "pageDown":n=e+g;break;case "pageUp":n=e-g;break;case "lineDown":n=e+m;break;case "lineUp":n=e-m;break;case "centerLine":a=this._getSelection(),n=b.getLineAtOffset(a.start),b=(b.getLineAtOffset(a.end)-
n+1)*m,n=n*m-g/2+b/2}void 0!==n&&(n=Math.min(Math.max(0,n),c-g),this._scrollViewAnimated(0,n-e,function(){}));return!0},_doSelectAll:function(g){g=this._model;var a=this._getSelection();a.setCaret(0);a.extend(g.getCharCount());this._setSelection(a,!1);return!0},_doTab:function(g){if(this._tabMode&&!this._readonly){g="\t";if(this._expandTab){var a=this._model;g=this._getSelection().getCaret();var b=a.getLineAtOffset(g),a=a.getLineStart(b);g=Array(this._tabSize-(g-a)%this._tabSize+1).join(" ")}this._doContent(g);
return!0}},_doShiftTab:function(g){if(this._tabMode&&!this._readonly)return!0},_doOverwriteMode:function(g){if(!this._readonly)return this.setOptions({overwriteMode:!this.getOptions("overwriteMode")}),!0},_doTabMode:function(g){this._tabMode=!this._tabMode;return!0},_doWrapMode:function(g){this.setOptions({wrapMode:!this.getOptions("wrapMode")});return!0},_autoScroll:function(){var g=this._model,a=this._getSelection(),b=this.convert({x:this._autoScrollX,y:this._autoScrollY},"page","document"),c=a.getCaret(),
m=g.getLineCount(),n=g.getLineAtOffset(c),d;if("up"===this._autoScrollDir||"down"===this._autoScrollDir)c=this._autoScrollY/this._getLineHeight(),c=0>c?Math.floor(c):Math.ceil(c),d=Math.max(0,Math.min(m-1,n+c));else if("left"===this._autoScrollDir||"right"===this._autoScrollDir)d=this._getLineIndex(b.y),n=this._getLine(n),b.x+=n.getBoundingClientRect(c,!1).left,n.destroy();0===d&&(e.isMac||e.isLinux)?a.extend(0):d===m-1&&(e.isMac||e.isLinux)?a.extend(g.getCharCount()):(n=this._getLine(d),a.extend(n.getOffset(b.x,
b.y-this._getLinePixel(d))),n.destroy());this._setSelection(a,!0)},_autoScrollTimer:function(){this._autoScroll();var g=this;this._autoScrollTimerID=this._getWindow().setTimeout(function(){g._autoScrollTimer()},this._AUTO_SCROLL_RATE)},_calculateLineHeightTimer:function(g){if(this._lineHeight&&!this._calculateLHTimer){var a=this._model.getLineCount(),b=0;if(g){g=0;for(var c=(new Date).getTime(),m=0;b<a&&!(this._lineHeight[b]||(g++,m||(m=b),this._lineHeight[b]=this._calculateLineHeight(b)),b++,100<
(new Date).getTime()-c););this.redrawRulers(0,a);this._queueUpdate()}g=this._getWindow();if(b!==a){var n=this;this._calculateLHTimer=g.setTimeout(function(){n._calculateLHTimer=null;n._calculateLineHeightTimer(!0)},0)}else this._calculateLHTimer&&(g.clearTimeout(this._calculateLHTimer),this._calculateLHTimer=void 0)}},_calculateLineHeight:function(g){g=this._getLine(g);var a=g.getBoundingClientRect();g.destroy();return Math.max(1,a.bottom-a.top)},_calculateMetrics:function(){var g=this._clientDiv,
a=g.ownerDocument,b=e.createElement(a,"div");b.style.lineHeight="normal";var c={type:"LineStyle",textView:this,0:0,lineText:this._model.getLine(0),lineStart:0};this.onLineStyle(c);l(c.style,b);b.style.position="fixed";b.style.left="-1000px";var n=e.createElement(a,"span");n.appendChild(a.createTextNode(" "));b.appendChild(n);var d=e.createElement(a,"span");d.style.fontStyle="italic";d.appendChild(a.createTextNode(" "));b.appendChild(d);var f=e.createElement(a,"span");f.style.fontWeight="bold";f.appendChild(a.createTextNode(" "));
b.appendChild(f);c=e.createElement(a,"span");c.style.fontWeight="bold";c.style.fontStyle="italic";c.appendChild(a.createTextNode(" "));b.appendChild(c);g.appendChild(b);var u=b.getBoundingClientRect(),n=n.getBoundingClientRect(),d=d.getBoundingClientRect(),f=f.getBoundingClientRect(),c=c.getBoundingClientRect(),n=n.bottom-n.top,d=d.bottom-d.top,f=f.bottom-f.top,h=c.bottom-c.top,k=0,c=0>=u.bottom-u.top,u=Math.max(1,u.bottom-u.top);d>n&&(k=1);f>d&&(k=2);h>f&&(k=3);var v;0!==k&&(v={style:{}},0!==(k&
1)&&(v.style.fontStyle="italic"),0!==(k&2)&&(v.style.fontWeight="bold"));n=t(b);g.removeChild(b);h=m(this._viewDiv);b=e.createElement(a,"div");b.style.position="fixed";b.style.left="-1000px";b.style.paddingLeft=h.left+"px";b.style.paddingTop=h.top+"px";b.style.paddingRight=h.right+"px";b.style.paddingBottom=h.bottom+"px";b.style.width="100px";b.style.height="100px";h=e.createElement(a,"div");h.style.width="100%";h.style.height="100%";b.appendChild(h);g.appendChild(b);k=b.getBoundingClientRect();d=
h.getBoundingClientRect();f=0;this._singleMode||(b.style.overflow="hidden",h.style.height="200px",f=b.clientWidth,b.style.overflow="scroll",f-=b.clientWidth);g.removeChild(b);h={left:d.left-k.left,top:d.top-k.top,right:k.right-d.right,bottom:k.bottom-d.bottom};d=k=0;if(!c&&(this._wrapOffset||this._marginOffset))b=e.createElement(a,"div"),b.style.position="fixed",b.style.left="-1000px",b.innerHTML=Array(this._wrapOffset+1+(e.isWebkit?0:1)).join(" "),g.appendChild(b),k=b.getBoundingClientRect(),k=Math.ceil(k.right-
k.left),b.innerHTML=Array(this._marginOffset+1).join(" "),d=b.getBoundingClientRect(),d=Math.ceil(d.right-d.left),g.removeChild(b);return{lineHeight:u,largestFontStyle:v,lineTrim:n,viewPadding:h,scrollWidth:f,wrapWidth:k,marginWidth:d,invalid:c}},_cancelAnimation:function(){this._animation&&(this._animation.stop(),this._animation=null)},_clearSelection:function(g){var a=this._getSelection();if(a.isEmpty())return!1;"next"===g?a.start=a.end:a.end=a.start;this._setSelection(a,!0);return!0},_commitIME:function(){if(-1!==
this._imeOffset){this._scrollDiv.focus();this._clientDiv.focus();var g=this._model,a=g.getLineAtOffset(this._imeOffset),b=g.getLineStart(a),c=this._getDOMText(this._getLineNode(a)).text,g=g.getLine(a),b=this._imeOffset-b,g=b+c.length-g.length;b!==g&&(c=c.substring(b,g),this._doContent(c));this._imeOffset=-1}},_createActions:function(){this.addKeyMode(new q.DefaultKeyMode(this));var g=this;this._actions={noop:{defaultHandler:function(){return g._doNoop()}},lineUp:{defaultHandler:function(a){return g._doLineUp(c(a,
{select:!1}))},actionDescription:{name:p.lineUp}},lineDown:{defaultHandler:function(a){return g._doLineDown(c(a,{select:!1}))},actionDescription:{name:p.lineDown}},lineStart:{defaultHandler:function(a){return g._doHome(c(a,{select:!1,ctrl:!1}))},actionDescription:{name:p.lineStart}},lineEnd:{defaultHandler:function(a){return g._doEnd(c(a,{select:!1,ctrl:!1}))},actionDescription:{name:p.lineEnd}},charPrevious:{defaultHandler:function(a){return g._doCursorPrevious(c(a,{select:!1,unit:"character"}))},
actionDescription:{name:p.charPrevious}},charNext:{defaultHandler:function(a){return g._doCursorNext(c(a,{select:!1,unit:"character"}))},actionDescription:{name:p.charNext}},pageUp:{defaultHandler:function(a){return g._doPageUp(c(a,{select:!1}))},actionDescription:{name:p.pageUp}},pageDown:{defaultHandler:function(a){return g._doPageDown(c(a,{select:!1}))},actionDescription:{name:p.pageDown}},scrollPageUp:{defaultHandler:function(a){return g._doScroll(c(a,{type:"pageUp"}))},actionDescription:{name:p.scrollPageUp}},
scrollPageDown:{defaultHandler:function(a){return g._doScroll(c(a,{type:"pageDown"}))},actionDescription:{name:p.scrollPageDown}},scrollLineUp:{defaultHandler:function(a){return g._doScroll(c(a,{type:"lineUp"}))},actionDescription:{name:p.scrollLineUp}},scrollLineDown:{defaultHandler:function(a){return g._doScroll(c(a,{type:"lineDown"}))},actionDescription:{name:p.scrollLineDown}},wordPrevious:{defaultHandler:function(a){return g._doCursorPrevious(c(a,{select:!1,unit:"word"}))},actionDescription:{name:p.wordPrevious}},
wordNext:{defaultHandler:function(a){return g._doCursorNext(c(a,{select:!1,unit:"word"}))},actionDescription:{name:p.wordNext}},textStart:{defaultHandler:function(a){return g._doHome(c(a,{select:!1,ctrl:!0}))},actionDescription:{name:p.textStart}},textEnd:{defaultHandler:function(a){return g._doEnd(c(a,{select:!1,ctrl:!0}))},actionDescription:{name:p.textEnd}},scrollTextStart:{defaultHandler:function(a){return g._doScroll(c(a,{type:"textStart"}))},actionDescription:{name:p.scrollTextStart}},scrollTextEnd:{defaultHandler:function(a){return g._doScroll(c(a,
{type:"textEnd"}))},actionDescription:{name:p.scrollTextEnd}},centerLine:{defaultHandler:function(a){return g._doScroll(c(a,{type:"centerLine"}))},actionDescription:{name:p.centerLine}},selectLineUp:{defaultHandler:function(a){return g._doLineUp(c(a,{select:!0}))},actionDescription:{name:p.selectLineUp}},selectLineDown:{defaultHandler:function(a){return g._doLineDown(c(a,{select:!0}))},actionDescription:{name:p.selectLineDown}},selectWholeLineUp:{defaultHandler:function(a){return g._doLineUp(c(a,
{select:!0,wholeLine:!0}))},actionDescription:{name:p.selectWholeLineUp}},selectWholeLineDown:{defaultHandler:function(a){return g._doLineDown(c(a,{select:!0,wholeLine:!0}))},actionDescription:{name:p.selectWholeLineDown}},selectLineStart:{defaultHandler:function(a){return g._doHome(c(a,{select:!0,ctrl:!1}))},actionDescription:{name:p.selectLineStart}},selectLineEnd:{defaultHandler:function(a){return g._doEnd(c(a,{select:!0,ctrl:!1}))},actionDescription:{name:p.selectLineEnd}},selectCharPrevious:{defaultHandler:function(a){return g._doCursorPrevious(c(a,
{select:!0,unit:"character"}))},actionDescription:{name:p.selectCharPrevious}},selectCharNext:{defaultHandler:function(a){return g._doCursorNext(c(a,{select:!0,unit:"character"}))},actionDescription:{name:p.selectCharNext}},selectPageUp:{defaultHandler:function(a){return g._doPageUp(c(a,{select:!0}))},actionDescription:{name:p.selectPageUp}},selectPageDown:{defaultHandler:function(a){return g._doPageDown(c(a,{select:!0}))},actionDescription:{name:p.selectPageDown}},selectWordPrevious:{defaultHandler:function(a){return g._doCursorPrevious(c(a,
{select:!0,unit:"word"}))},actionDescription:{name:p.selectWordPrevious}},selectWordNext:{defaultHandler:function(a){return g._doCursorNext(c(a,{select:!0,unit:"word"}))},actionDescription:{name:p.selectWordNext}},selectTextStart:{defaultHandler:function(a){return g._doHome(c(a,{select:!0,ctrl:!0}))},actionDescription:{name:p.selectTextStart}},selectTextEnd:{defaultHandler:function(a){return g._doEnd(c(a,{select:!0,ctrl:!0}))},actionDescription:{name:p.selectTextEnd}},deletePrevious:{defaultHandler:function(a){return g._doBackspace(c(a,
{unit:"character"}))},actionDescription:{name:p.deletePrevious}},deleteNext:{defaultHandler:function(a){return g._doDelete(c(a,{unit:"character"}))},actionDescription:{name:p.deleteNext}},deleteWordPrevious:{defaultHandler:function(a){return g._doBackspace(c(a,{unit:"word"}))},actionDescription:{name:p.deleteWordPrevious}},deleteWordNext:{defaultHandler:function(a){return g._doDelete(c(a,{unit:"word"}))},actionDescription:{name:p.deleteWordNext}},deleteLineStart:{defaultHandler:function(a){return g._doBackspace(c(a,
{unit:"line"}))},actionDescription:{name:p.deleteLineStart}},deleteLineEnd:{defaultHandler:function(a){return g._doDelete(c(a,{unit:"line"}))},actionDescription:{name:p.deleteLineEnd}},tab:{defaultHandler:function(a){return g._doTab()},actionDescription:{name:p.tab}},shiftTab:{defaultHandler:function(a){return g._doShiftTab()},actionDescription:{name:p.shiftTab}},enter:{defaultHandler:function(a){return g._doEnter()},actionDescription:{name:p.enter}},enterNoCursor:{defaultHandler:function(a){return g._doEnter(c(a,
{noCursor:!0}))},actionDescription:{name:p.enterNoCursor}},selectAll:{defaultHandler:function(a){return g._doSelectAll()},actionDescription:{name:p.selectAll}},copy:{defaultHandler:function(a){return g._doCopy()},actionDescription:{name:p.copy}},cut:{defaultHandler:function(a){return g._doCut()},actionDescription:{name:p.cut}},paste:{defaultHandler:function(a){return g._doPaste()},actionDescription:{name:p.paste}},uppercase:{defaultHandler:function(a){return g._doCase(c(a,{type:"upper"}))},actionDescription:{name:p.uppercase}},
lowercase:{defaultHandler:function(a){return g._doCase(c(a,{type:"lower"}))},actionDescription:{name:p.lowercase}},capitalize:{defaultHandler:function(a){return g._doCase(c(a,{unit:"word",type:"capitalize"}))},actionDescription:{name:p.capitalize}},reversecase:{defaultHandler:function(a){return g._doCase(c(a,{type:"reverse"}))},actionDescription:{name:p.reversecase}},toggleOverwriteMode:{defaultHandler:function(a){return g._doOverwriteMode()},actionDescription:{name:p.toggleOverwriteMode}},toggleTabMode:{defaultHandler:function(a){return g._doTabMode()},
actionDescription:{name:p.toggleTabMode}},toggleWrapMode:{defaultHandler:function(a){return g._doWrapMode()},actionDescription:{name:p.toggleWrapMode}}}},_createRulerParent:function(a,b){var c=e.createElement(a,"div");c.className=b;c.tabIndex=-1;c.style.overflow="hidden";c.style.MozUserSelect="none";c.style.WebkitUserSelect="none";c.style.position="absolute";c.style.top="0px";c.style.bottom="0px";c.style.cursor="default";c.style.display="none";c.setAttribute("aria-hidden","true");this._rootDiv.appendChild(c);
return c},_createRuler:function(a,b){if(this._clientDiv){var c=this._getRulerParent(a);if(c){if(c!==this._marginDiv||this._marginOffset)c.style.display="block";var m=e.createElement(c.ownerDocument,"div");m._ruler=a;m.rulerChanged=!0;m.style.position="relative";m.style.cssFloat="left";m.style.styleFloat="left";m.style.outline="none";if(void 0===b||0>b||b>=c.children.length)c.appendChild(m);else{for(var n=c.firstChild;n&&0<b--;)n=n.nextSibling;c.insertBefore(m,n)}}}},_createView:function(){function a(){t._rootDiv&&
(t.update(!0),t._metrics.invalid&&t._getWindow().setTimeout(function(){a()},100))}if(!this._clientDiv){for(var b=this._parent;b.hasChildNodes();)b.removeChild(b.lastChild);var c=b.ownerDocument,m=e.createElement(c,"div");this._rootDiv=m;m.tabIndex=-1;m.style.position="relative";m.style.overflow="hidden";m.style.width="100%";m.style.height="100%";m.style.overflow="hidden";m.style.WebkitTextSizeAdjust="100%";m.setAttribute("role","application");b.appendChild(m);this._leftDiv=this._createRulerParent(c,
"textviewLeftRuler");b=e.createElement(c,"div");b.className="textviewScroll";this._viewDiv=b;b.tabIndex=-1;b.style.position="absolute";b.style.top="0px";b.style.bottom="0px";b.style.borderWidth="0px";b.style.margin="0px";b.style.outline="none";b.style.background="transparent";m.appendChild(b);var d=this._createRulerParent(c,"textviewRightRuler");this._rightDiv=d;d.style.right="0px";this._scrollDiv=d=e.createElement(c,"div");d.style.margin="0px";d.style.borderWidth="0px";d.style.padding="0px";b.appendChild(d);
(this._marginDiv=this._createRulerParent(c,"textviewMarginRuler")).style.zIndex="4";!e.isIE&&!e.isIOS&&(this._clipDiv=b=e.createElement(c,"div"),b.style.position="absolute",b.style.overflow="hidden",b.style.margin="0px",b.style.borderWidth="0px",b.style.padding="0px",b.style.background="transparent",m.appendChild(b),this._clipScrollDiv=d=e.createElement(c,"div"),d.style.position="absolute",d.style.height="1px",d.style.top="-1000px",d.style.background="transparent",b.appendChild(d));this._setFullSelection(this._fullSelection,
!0);b=e.createElement(c,"div");b.className="textviewContent";this._clientDiv=b;b.tabIndex=0;b.style.position="absolute";b.style.borderWidth="0px";b.style.margin="0px";b.style.padding="0px";b.style.outline="none";b.style.zIndex="1";b.style.WebkitUserSelect="text";b.setAttribute("spellcheck","false");if(e.isIOS||e.isAndroid)b.style.WebkitTapHighlightColor="transparent";(this._clipDiv||m).appendChild(b);if(e.isIOS||e.isAndroid)this._vScrollDiv=d=e.createElement(c,"div"),d.style.position="absolute",d.style.borderWidth=
"1px",d.style.borderColor="white",d.style.borderStyle="solid",d.style.borderRadius="4px",d.style.backgroundColor="black",d.style.opacity="0.5",d.style.margin="0px",d.style.padding="0px",d.style.outline="none",d.style.zIndex="3",d.style.width="8px",d.style.display="none",m.appendChild(d),this._hScrollDiv=d=e.createElement(c,"div"),d.style.position="absolute",d.style.borderWidth="1px",d.style.borderColor="white",d.style.borderStyle="solid",d.style.borderRadius="4px",d.style.backgroundColor="black",
d.style.opacity="0.5",d.style.margin="0px",d.style.padding="0px",d.style.outline="none",d.style.zIndex="3",d.style.height="8px",d.style.display="none",m.appendChild(d);e.isFirefox&&!b.setCapture&&(this._overlayDiv=d=e.createElement(c,"div"),d.style.position=b.style.position,d.style.borderWidth=b.style.borderWidth,d.style.margin=b.style.margin,d.style.padding=b.style.padding,d.style.cursor="text",d.style.zIndex="2",(this._clipDiv||m).appendChild(d));b.contentEditable="true";b.setAttribute("role","textbox");
b.setAttribute("aria-multiline","true");this._setWrapMode(this._wrapMode,!0);this._setReadOnly(this._readonly);this._setThemeClass(this._themeClass,!0);this._setTabSize(this._tabSize,!0);this._setMarginOffset(this._marginOffset,!0);this._hookEvents();b=this._rulers;for(d=0;d<b.length;d++)this._createRuler(b[d]);this._update();var t=this;n(c,m,"textview",a)}},_defaultOptions:function(){return{parent:{value:void 0,update:null},model:{value:void 0,update:this.setModel},scrollAnimation:{value:0,update:null},
readonly:{value:!1,update:this._setReadOnly},fullSelection:{value:!0,update:this._setFullSelection},tabMode:{value:!0,update:null},tabSize:{value:8,update:this._setTabSize},expandTab:{value:!1,update:null},singleMode:{value:!1,update:this._setSingleMode},overwriteMode:{value:!1,update:this._setOverwriteMode},blockCursorVisible:{value:!1,update:this._setBlockCursor},marginOffset:{value:0,update:this._setMarginOffset},wrapOffset:{value:0,update:this._setWrapOffset},wrapMode:{value:!1,update:this._setWrapMode},
wrappable:{value:!1,update:null},theme:{value:d.TextTheme.getTheme(),update:this._setTheme},themeClass:{value:void 0,update:this._setThemeClass}}},_destroyRuler:function(a){var b=this._getRulerParent(a);if(b)for(var c=b.firstChild;c;){if(c._ruler===a){c._ruler=void 0;b.removeChild(c);if(0===b.children.length&&(b!==this._marginDiv||!this._marginOffset))b.style.display="none";break}c=c.nextSibling}},_destroyView:function(){if(this._clientDiv){this._setGrab(null);this._unhookEvents();var a=this._getWindow();
this._autoScrollTimerID&&(a.clearTimeout(this._autoScrollTimerID),this._autoScrollTimerID=null);this._updateTimer&&(a.clearTimeout(this._updateTimer),this._updateTimer=null);a=this._rootDiv;a.parentNode.removeChild(a);this._hScrollDiv=this._vScrollDiv=this._cursorDiv=this._marginDiv=this._rightDiv=this._leftDiv=this._overlayDiv=this._clientDiv=this._clipScrollDiv=this._clipDiv=this._viewDiv=this._scrollDiv=this._rootDiv=this._clipboardDiv=this._selDiv3=this._selDiv2=this._selDiv1=null}},_doAutoScroll:function(a,
b,c){this._autoScrollDir=a;this._autoScrollX=b;this._autoScrollY=c;this._autoScrollTimerID||this._autoScrollTimer()},_endAutoScroll:function(){this._autoScrollTimerID&&this._getWindow().clearTimeout(this._autoScrollTimerID);this._autoScrollTimerID=this._autoScrollDir=void 0},_fixCaret:function(){var a=this._clientDiv;if(a){var b=this._hasFocus;this._ignoreFocus=!0;b&&a.blur();a.contentEditable=!1;a.contentEditable=!0;b&&a.focus();this._ignoreFocus=!1}},_getBaseText:function(a,b){var c=this._model;
c.getBaseModel&&(a=c.mapOffset(a),b=c.mapOffset(b),c=c.getBaseModel());return c.getText(a,b)},_getBottomIndex:function(a){var b=this._bottomChild;if(a&&this._getClientHeight()>this._getLineHeight()){a=b.getBoundingClientRect();var c=this._clientDiv.getBoundingClientRect();a.bottom>c.bottom&&(b=this._getLinePrevious(b)||b)}return b.lineIndex},_getBoundsAtOffset:function(a){var b=this._getLine(this._model.getLineAtOffset(a));a=b.getBoundingClientRect(a);var c=this._getLinePixel(b.lineIndex);a.top+=
c;a.bottom+=c;b.destroy();return a},_getClientHeight:function(){var a=this._getViewPadding();return Math.max(0,this._viewDiv.clientHeight-a.top-a.bottom)},_getClientWidth:function(){var a=this._getViewPadding();return Math.max(0,this._viewDiv.clientWidth-a.left-a.right)},_getClipboardText:function(g,b){var c=this._model.getLineDelimiter(),m,d,n=this._getWindow(),t=n.clipboardData;!t&&g&&(t=g.clipboardData);if(t)return m=[],d=t.getData(e.isIE?"Text":"text/plain"),a(d,function(a){m.push(a)},function(){m.push(c)}),
d=m.join(""),b&&b(d),d;if(e.isFirefox){this._ignoreFocus=!0;var f=this._clipboardDiv,t=this._rootDiv.ownerDocument;f||(this._clipboardDiv=f=e.createElement(t,"div"),f.style.position="fixed",f.style.whiteSpace="pre",f.style.left="-1000px",this._rootDiv.appendChild(f));f.innerHTML="\x3cpre contenteditable\x3d''\x3e\x3c/pre\x3e";f.firstChild.focus();var l=this,h=function(){var g=l._getTextFromElement(f);f.innerHTML="";m=[];a(g,function(a){m.push(a)},function(){m.push(c)});return m.join("")},u=!1;this._ignorePaste=
!0;if(!e.isLinux||2!==this._lastMouseButton)try{u=t.execCommand("paste",!1,null)}catch(k){u=1<f.childNodes.length||f.firstChild&&0<f.firstChild.childNodes.length}this._ignorePaste=!1;if(!u){if(g)return n.setTimeout(function(){l.focus();(d=h())&&b&&b(d);l._ignoreFocus=!1},0),null;this.focus();this._ignoreFocus=!1;return""}this.focus();this._ignoreFocus=!1;(d=h())&&b&&b(d);return d}return""},_getDOMText:function(a,b){return a._line.getText(b)},_getTextFromElement:function(a){var b=a.ownerDocument,c=
b.defaultView;if(!c.getSelection)return a.innerText||a.textContent;b=b.createRange();b.selectNode(a);a=c.getSelection();var c=[],m;for(m=0;m<a.rangeCount;m++)c.push(a.getRangeAt(m));this._ignoreSelect=!0;a.removeAllRanges();a.addRange(b);b=a.toString();a.removeAllRanges();for(m=0;m<c.length;m++)a.addRange(c[m]);this._ignoreSelect=!1;return b},_getViewPadding:function(){return this._metrics.viewPadding},_getLine:function(a){var b=this._getLineNode(a);return b&&!b.lineChanged&&!b.lineRemoved?b._line:
new x(this,a)},_getLineHeight:function(a,b){if(void 0!==a&&this._lineHeight){var c=this._lineHeight[a];if(c)return c;if(b||void 0===b)return this._lineHeight[a]=this._calculateLineHeight(a)}return this._metrics.lineHeight},_getLineNode:function(a){for(var b=this._clientDiv.firstChild;b;){if(a===b.lineIndex)return b;b=b.nextSibling}},_getLineNext:function(a){for(a=a?a.nextSibling:this._clientDiv.firstChild;a&&(-1===a.lineIndex||!a._line);)a=a.nextSibling;return a},_getLinePrevious:function(a){for(a=
a?a.previousSibling:this._clientDiv.lastChild;a&&(-1===a.lineIndex||!a._line);)a=a.previousSibling;return a},_getLinePixel:function(a){a=Math.min(Math.max(0,a),this._model.getLineCount());if(this._lineHeight){var b=this._getTopIndex(),c=-this._topIndexY+this._getScroll().y;if(a>b)for(;b<a;b++)c+=this._getLineHeight(b);else for(b-=1;b>=a;b--)c-=this._getLineHeight(b);return c}return this._getLineHeight()*a},_getLineIndex:function(a){var b,c=0,m=this._model.getLineCount();if(this._lineHeight){var c=
this._getTopIndex(),d=-this._topIndexY+this._getScroll().y;if(a!==d)if(a<d)for(;a<d&&0<c;)a+=this._getLineHeight(--c);else for(b=this._getLineHeight(c);a-b>=d&&c<m-1;)a-=b,b=this._getLineHeight(++c)}else b=this._getLineHeight(),c=Math.floor(a/b);return Math.max(0,Math.min(m-1,c))},_getRulerParent:function(a){switch(a.getLocation()){case "left":return this._leftDiv;case "right":return this._rightDiv;case "margin":return this._marginDiv}return null},_getScroll:function(a){(void 0===a||a)&&this._cancelAnimation();
a=this._viewDiv;return{x:a.scrollLeft,y:a.scrollTop}},_getSelection:function(){return this._selection.clone()},_getTopIndex:function(a){var b=this._topChild;if(a&&this._getClientHeight()>this._getLineHeight()){a=b.getBoundingClientRect();var c=this._getViewPadding(),m=this._viewDiv.getBoundingClientRect();a.top<m.top+c.top&&(b=this._getLineNext(b)||b)}return b.lineIndex},_hookEvents:function(){var a=this;this._modelListener={onChanging:function(b){a._onModelChanging(b)},onChanged:function(b){a._onModelChanged(b)}};
this._model.addEventListener("preChanging",this._modelListener.onChanging);this._model.addEventListener("postChanged",this._modelListener.onChanged);this._themeListener={onChanged:function(b){a._setThemeClass(a._themeClass)}};this._theme.addEventListener("ThemeChanged",this._themeListener.onChanged);var b=this._handlers=[],c=this._clientDiv,m=this._viewDiv,d=this._rootDiv,n=this._overlayDiv||c,t=c.ownerDocument,f=this._getWindow(),l=e.isIE?t:f;b.push({target:f,type:"resize",handler:function(b){return a._handleResize(b?
b:f.event)}});b.push({target:c,type:"blur",handler:function(b){return a._handleBlur(b?b:f.event)}});b.push({target:c,type:"focus",handler:function(b){return a._handleFocus(b?b:f.event)}});b.push({target:m,type:"focus",handler:function(a){c.focus()}});b.push({target:m,type:"scroll",handler:function(b){return a._handleScroll(b?b:f.event)}});b.push({target:c,type:"textInput",handler:function(b){return a._handleTextInput(b?b:f.event)}});b.push({target:c,type:"keydown",handler:function(b){return a._handleKeyDown(b?
b:f.event)}});b.push({target:c,type:"keypress",handler:function(b){return a._handleKeyPress(b?b:f.event)}});b.push({target:c,type:"keyup",handler:function(b){return a._handleKeyUp(b?b:f.event)}});e.isIE&&b.push({target:t,type:"keyup",handler:function(b){return a._handleDocKeyUp(b?b:f.event)}});b.push({target:c,type:"contextmenu",handler:function(b){return a._handleContextMenu(b?b:f.event)}});b.push({target:c,type:"copy",handler:function(b){return a._handleCopy(b?b:f.event)}});b.push({target:c,type:"cut",
handler:function(b){return a._handleCut(b?b:f.event)}});b.push({target:c,type:"paste",handler:function(b){return a._handlePaste(b?b:f.event)}});b.push({target:t,type:"selectionchange",handler:function(b){return a._handleSelectionChange(b?b:f.event)}});if(e.isIOS||e.isAndroid)b.push({target:c,type:"touchstart",handler:function(b){return a._handleTouchStart(b?b:f.event)}}),b.push({target:c,type:"touchmove",handler:function(b){return a._handleTouchMove(b?b:f.event)}}),b.push({target:c,type:"touchend",
handler:function(b){return a._handleTouchEnd(b?b:f.event)}});else{b.push({target:c,type:"selectstart",handler:function(b){return a._handleSelectStart(b?b:f.event)}});b.push({target:c,type:"mousedown",handler:function(b){return a._handleMouseDown(b?b:f.event)}});b.push({target:c,type:"mouseover",handler:function(b){return a._handleMouseOver(b?b:f.event)}});b.push({target:c,type:"mouseout",handler:function(b){return a._handleMouseOut(b?b:f.event)}});b.push({target:l,type:"mouseup",handler:function(b){return a._handleMouseUp(b?
b:f.event)}});b.push({target:l,type:"mousemove",handler:function(b){return a._handleMouseMove(b?b:f.event)}});b.push({target:d,type:"mousedown",handler:function(b){return a._handleRootMouseDown(b?b:f.event)}});b.push({target:d,type:"mouseup",handler:function(b){return a._handleRootMouseUp(b?b:f.event)}});b.push({target:n,type:"dragstart",handler:function(b){return a._handleDragStart(b?b:f.event)}});b.push({target:n,type:"drag",handler:function(b){return a._handleDrag(b?b:f.event)}});b.push({target:n,
type:"dragend",handler:function(b){return a._handleDragEnd(b?b:f.event)}});b.push({target:n,type:"dragenter",handler:function(b){return a._handleDragEnter(b?b:f.event)}});b.push({target:n,type:"dragover",handler:function(b){return a._handleDragOver(b?b:f.event)}});b.push({target:n,type:"dragleave",handler:function(b){return a._handleDragLeave(b?b:f.event)}});b.push({target:n,type:"drop",handler:function(b){return a._handleDrop(b?b:f.event)}});b.push({target:this._clientDiv,type:26<e.isFirefox?"wheel":
e.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(b){return a._handleMouseWheel(b?b:f.event)}});this._clipDiv&&b.push({target:this._clipDiv,type:26<e.isFirefox?"wheel":e.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(b){return a._handleMouseWheel(b?b:f.event)}});if(e.isFirefox&&(!e.isWindows||15<=e.isFirefox))(m=f.MutationObserver||f.MozMutationObserver)?(this._mutationObserver=new m(function(b){a._handleDataModified(b)}),this._mutationObserver.observe(c,{subtree:!0,characterData:!0})):
b.push({target:this._clientDiv,type:"DOMCharacterDataModified",handler:function(b){return a._handleDataModified(b?b:f.event)}});this._overlayDiv&&(b.push({target:this._overlayDiv,type:"mousedown",handler:function(b){return a._handleMouseDown(b?b:f.event)}}),b.push({target:this._overlayDiv,type:"mouseover",handler:function(b){return a._handleMouseOver(b?b:f.event)}}),b.push({target:this._overlayDiv,type:"mouseout",handler:function(b){return a._handleMouseOut(b?b:f.event)}}),b.push({target:this._overlayDiv,
type:"contextmenu",handler:function(b){return a._handleContextMenu(b?b:f.event)}}));this._isW3CEvents||b.push({target:this._clientDiv,type:"dblclick",handler:function(b){return a._handleDblclick(b?b:f.event)}})}this._hookRulerEvents(this._leftDiv,b);this._hookRulerEvents(this._rightDiv,b);this._hookRulerEvents(this._marginDiv,b);for(m=0;m<b.length;m++)d=b[m],y(d.target,d.type,d.handler,d.capture)},_hookRulerEvents:function(a,b){if(a){var c=this,m=this._getWindow();e.isIE&&b.push({target:a,type:"selectstart",
handler:function(){return!1}});b.push({target:a,type:26<e.isFirefox?"wheel":e.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(a){return c._handleMouseWheel(a?a:m.event)}});b.push({target:a,type:"click",handler:function(a){c._handleRulerEvent(a?a:m.event)}});b.push({target:a,type:"dblclick",handler:function(a){c._handleRulerEvent(a?a:m.event)}});b.push({target:a,type:"mousemove",handler:function(a){c._handleRulerEvent(a?a:m.event)}});b.push({target:a,type:"mouseover",handler:function(a){c._handleRulerEvent(a?
a:m.event)}});b.push({target:a,type:"mouseout",handler:function(a){c._handleRulerEvent(a?a:m.event)}})}},_getWindow:function(){return this._parent.ownerDocument.defaultView||this._parent.ownerDocument.parentWindow},_ignoreEvent:function(a){for(a=a.target;a&&a!==this._clientDiv;){if(a.ignore)return!0;a=a.parentNode}return!1},_init:function(a){var b=a.parent;"string"===typeof b&&(b=(a.document||document).getElementById(b));if(!b)throw"no parent";a.parent=b;a.model=a.model||new s.TextModel;var c=this._defaultOptions(),
m;for(m in c)c.hasOwnProperty(m)&&(this["_"+m]=void 0!==a[m]?a[m]:c[m].value);this._keyModes=[];this._rulers=[];this._selection=new u(0,0,!1);this._linksVisible=!1;this._maxLineWidth=this._redrawCount=0;this._maxLineIndex=-1;this._ignoreSelect=!0;this._hasFocus=this._ignoreFocus=!1;this._dragOffset=this._columnX=-1;this._isRangeRects=(!e.isIE||9<=e.isIE)&&"function"===typeof b.ownerDocument.createRange().getBoundingClientRect;this._isW3CEvents=b.addEventListener;this._autoScrollTimerID=this._autoScrollY=
this._autoScrollX=null;this._AUTO_SCROLL_RATE=50;this._mouseUpClosure=this._moseMoveClosure=this._grabControl=null;this._clickCount=this._lastMouseTime=this._lastMouseY=this._lastMouseX=0;this._clickTime=250;this._clickDist=5;this._isMouseDown=!1;this._doubleClickSelection=null;this._vScroll=this._hScroll=0;this._imeOffset=-1;this._createActions();this._createView()},_checkOverlayScroll:function(){if(e.isMac&&e.isWebkit&&!this._metrics.invalid&&0===this._metrics.scrollWidth){var a=this._viewDiv,b=
this._isOverOverlayScroll();a.style.pointerEvents=b.vertical||b.horizontal?"":"none"}},_isOverOverlayScroll:function(){if(!(200>(new Date).getTime()-this._lastScrollTime))return{};var a=this._viewDiv.getBoundingClientRect(),b=this._lastMouseMoveX,c=this._lastMouseMoveY;return{vertical:a.top<=c&&c<a.bottom&&a.right-15<=b&&b<a.right,horizontal:a.bottom-15<=c&&c<a.bottom&&a.left<=b&&b<a.right}},_modifyContent:function(a,b){if(!this._readonly||a._code)if(a.type="Verify",this.onVerify(a),!(null===a.text||
void 0===a.text)){var c=this._model;try{a._ignoreDOMSelection&&(this._ignoreDOMSelection=!0),c.setText(a.text,a.start,a.end)}finally{a._ignoreDOMSelection&&(this._ignoreDOMSelection=!1)}if(b){c=this._getSelection();c.setCaret(a.start+a.text.length);try{a._ignoreDOMSelection1&&(this._ignoreDOMSelection=!0),this._setSelection(c,!0)}finally{a._ignoreDOMSelection1&&(this._ignoreDOMSelection=!1)}}this.onModify({type:"Modify"})}},_onModelChanged:function(a){a.type="ModelChanged";this.onModelChanged(a);
a.type="Changed";var b=a.start,c=a.addedCharCount,m=a.removedCharCount,d=a.addedLineCount,n=a.removedLineCount,e=this._getSelection();e.end>b&&(e.end>b&&e.start<b+m?e.setCaret(b+c):(e.start+=c-m,e.end+=c-m),this._setSelection(e,!1,!1));b=this._model.getLineAtOffset(b);for(c=this._getLineNext();c;)m=c.lineIndex,b<=m&&m<=b+n&&(b===m&&!c.modelChangedEvent&&!c.lineRemoved?(c.modelChangedEvent=a,c.lineChanged=!0):(c.lineRemoved=!0,c.lineChanged=!1,c.modelChangedEvent=null)),m>b+n&&(c.lineIndex=m+d-n,c._line.lineIndex=
c.lineIndex),c=this._getLineNext(c);this._lineHeight&&(a=[b,n].concat(Array(d)),Array.prototype.splice.apply(this._lineHeight,a));!this._wrapMode&&(b<=this._maxLineIndex&&this._maxLineIndex<=b+n)&&(this._checkMaxLineIndex=this._maxLineIndex,this._maxLineIndex=-1,this._maxLineWidth=0);this._update()},_onModelChanging:function(a){a.type="ModelChanging";this.onModelChanging(a);a.type="Changing"},_queueUpdate:function(){if(!this._updateTimer&&!this._ignoreQueueUpdate){var a=this;this._updateTimer=this._getWindow().setTimeout(function(){a._updateTimer=
null;a._update()},0)}},_resetLineHeight:function(a,b){if(this._wrapMode||this._variableLineHeight){if(void 0!==a&&void 0!==b)for(var c=a;c<b;c++)this._lineHeight[c]=void 0;else this._lineHeight=Array(this._model.getLineCount());this._calculateLineHeightTimer()}else this._lineHeight=null},_resetLineWidth:function(){var a=this._clientDiv;if(a)for(a=a.firstChild;a;)a.lineWidth=void 0,a=a.nextSibling},_reset:function(){this._maxLineIndex=-1;this._maxLineWidth=0;this._columnX=-1;this._bottomChild=this._topChild=
null;this._topIndexY=0;this._variableLineHeight=!1;this._resetLineHeight();this._setSelection(new u(0,0,!1),!1,!1);this._viewDiv&&(this._viewDiv.scrollLeft=0,this._viewDiv.scrollTop=0);var a=this._clientDiv;if(a){for(a=a.firstChild;a;)a.lineRemoved=!0,a=a.nextSibling;13>e.isFirefox&&this._fixCaret()}},_scrollViewAnimated:function(a,b,c){var m=this._getWindow();if(c&&this._scrollAnimation){var d=this;this._animation=new z({window:m,duration:this._scrollAnimation,curve:[b,0],onAnimate:function(a){a=
b-Math.floor(a);d._scrollView(0,a);b-=a},onEnd:function(){d._animation=null;d._scrollView(a,b);c&&m.setTimeout(c,0)}});this._animation.play()}else this._scrollView(a,b),c&&m.setTimeout(c,0)},_scrollView:function(a,b){this._ensureCaretVisible=!1;var c=this._viewDiv;a&&(c.scrollLeft+=a);b&&(c.scrollTop+=b)},_setClipboardText:function(b,c){var m,d=this._getWindow(),n=d.clipboardData;!n&&c&&(n=c.clipboardData);if(n&&(m=[],a(b,function(a){m.push(a)},function(){m.push(e.platformDelimiter)}),n.setData(e.isIE?
"Text":"text/plain",m.join(""))||21<e.isFirefox))return!0;var t=this._parent.ownerDocument,f=e.createElement(t,"pre");f.style.position="fixed";f.style.left="-1000px";a(b,function(a){f.appendChild(t.createTextNode(a))},function(){f.appendChild(e.createElement(t,"br"))});f.appendChild(t.createTextNode(" "));this._clientDiv.appendChild(f);n=t.createRange();n.setStart(f.firstChild,0);n.setEndBefore(f.lastChild);var l=d.getSelection();0<l.rangeCount&&l.removeAllRanges();l.addRange(n);var h=this,n=function(){f&&
f.parentNode===h._clientDiv&&h._clientDiv.removeChild(f);h._updateDOMSelection()},l=!1;this._ignoreCopy=!0;try{l=t.execCommand("copy",!1,null)}catch(u){}this._ignoreCopy=!1;if(!l&&c)return d.setTimeout(n,0),!1;n();return!0},_setDOMSelection:function(a,b,c,m,d){this._setDOMFullSelection(a,b,c,m);a=a._line.getNodeOffset(b);c=c._line.getNodeOffset(m);m=this._getWindow();b=this._parent.ownerDocument;if(m.getSelection){var n=m.getSelection();m=b.createRange();m.setStart(a.node,a.offset);m.setEnd(c.node,
c.offset);if(this._hasFocus&&(n.anchorNode!==a.node||n.anchorOffset!==a.offset||n.focusNode!==c.node||n.focusOffset!==c.offset||n.anchorNode!==c.node||n.anchorOffset!==c.offset||n.focusNode!==a.node||n.focusOffset!==a.offset))this._anchorNode=a.node,this._anchorOffset=a.offset,this._focusNode=c.node,this._focusOffset=c.offset,this._ignoreSelect=!1,0<n.rangeCount&&n.removeAllRanges(),n.addRange(m),this._ignoreSelect=!0;this._cursorDiv&&(m=b.createRange(),d?(m.setStart(a.node,a.offset),m.setEnd(a.node,
a.offset)):(m.setStart(c.node,c.offset),m.setEnd(c.node,c.offset)),d=m.getClientRects()[0],a=this._cursorDiv.parentNode,c=a.getBoundingClientRect(),d&&c&&(this._cursorDiv.style.top=d.top-c.top+a.scrollTop+"px",this._cursorDiv.style.left=d.left-c.left+a.scrollLeft+"px"))}else b.selection&&this._hasFocus&&(d=b.body,m=e.createElement(b,"div"),d.appendChild(m),d.removeChild(m),m=d.createTextRange(),m.moveToElementText(a.node.parentNode),m.moveStart("character",a.offset),d=d.createTextRange(),d.moveToElementText(c.node.parentNode),
d.moveStart("character",c.offset),m.setEndPoint("EndToStart",d),this._ignoreSelect=!1,m.select(),this._ignoreSelect=!0)},_setDOMFullSelection:function(a,b,c,m){if(this._selDiv1){var d=this._selDiv1;d.style.width="0px";d.style.height="0px";d=this._selDiv2;d.style.width="0px";d.style.height="0px";d=this._selDiv3;d.style.width="0px";d.style.height="0px";if(!(a===c&&b===m)){var n=this._getViewPadding(),e=this._clientDiv.getBoundingClientRect(),t=this._viewDiv.getBoundingClientRect(),d=t.left+n.left,f=
e.right,n=t.top+n.top,l=e.bottom,t=e=0;this._clipDiv?(t=this._clipDiv.getBoundingClientRect(),e=t.left-this._clipDiv.scrollLeft):(t=this._rootDiv.getBoundingClientRect(),e=t.left);t=t.top;this._ignoreDOMSelection=!0;var h=(new x(this,a.lineIndex,a)).getBoundingClientRect(b,!1),u=h.left;b=(new x(this,c.lineIndex,c)).getBoundingClientRect(m,!1);var k=b.left;this._ignoreDOMSelection=!1;var v=this._selDiv1,u=Math.min(f,Math.max(d,u)),z=Math.min(l,Math.max(n,h.top)),w=f;m=Math.min(l,Math.max(n,h.bottom));
v.style.left=u-e+"px";v.style.top=z-t+"px";v.style.width=Math.max(0,w-u)+"px";v.style.height=Math.max(0,m-z)+"px";a.lineIndex===c.lineIndex?(w=Math.min(k,f),v.style.width=Math.max(0,w-u)+"px"):(h=Math.min(l,Math.max(n,b.top)),k=Math.min(f,Math.max(d,k)),n=Math.min(l,Math.max(n,b.bottom)),l=this._selDiv3,l.style.left=d-e+"px",l.style.top=h-t+"px",l.style.width=Math.max(0,k-d)+"px",l.style.height=Math.max(0,n-h)+"px",1<Math.abs(a.lineIndex-c.lineIndex)&&(a=this._selDiv2,a.style.left=d-e+"px",a.style.top=
m-t+"px",a.style.width=Math.max(0,f-d)+"px",a.style.height=Math.max(0,h-m)+"px"))}}},_setGrab:function(a){a!==this._grabControl&&(a?(a.setCapture&&a.setCapture(),this._grabControl=a):(this._grabControl.releaseCapture&&this._grabControl.releaseCapture(),this._grabControl=null))},_setLinksVisible:function(a){if(this._linksVisible!==a){this._linksVisible=a;e.isIE&&a&&(this._hadFocus=this._hasFocus);var b=this._clientDiv;b.contentEditable=!a;this._hadFocus&&!a&&b.focus();this._overlayDiv&&(this._overlayDiv.style.zIndex=
a?"-1":"1");for(a=this._getLineNext();a;)a._line.updateLinks(),a=this._getLineNext(a);this._updateDOMSelection()}},_setSelection:function(a,b,c,m,d){if(a){this._columnX=-1;void 0===c&&(c=!0);var n=this._selection;this._selection=a;!1!==b&&this._showCaret(!1,m,b,d);c&&this._updateDOMSelection();if(!n.equals(a))this.onSelection({type:"Selection",oldValue:{start:n.start,end:n.end},newValue:{start:a.start,end:a.end}})}},_setSelectionTo:function(a,b,c,m){var d=this._model,n=this._getSelection();b=this.convert({x:a,
y:b},"page","document");a=this._getLineIndex(b.y);if(1===this._clickCount){d=this._getLine(a);a=d.getOffset(b.x,b.y-this._getLinePixel(a));d.destroy();if(m&&!c&&n.start<=a&&a<n.end)return this._dragOffset=a,!1;n.extend(a);c||n.collapse()}else 0===(this._clickCount&1)?(d=this._getLine(a),a=d.getOffset(b.x,b.y-this._getLinePixel(a)),this._doubleClickSelection?a>=this._doubleClickSelection.start?(c=this._doubleClickSelection.start,m=d.getNextOffset(a,{unit:"wordend",count:1})):(c=d.getNextOffset(a,{unit:"word",
count:-1}),m=this._doubleClickSelection.end):(c=d.getNextOffset(a,{unit:"word",count:-1}),m=d.getNextOffset(c,{unit:"wordend",count:1})),d.destroy()):this._doubleClickSelection?(m=d.getLineAtOffset(this._doubleClickSelection.start),a>=m?(c=d.getLineStart(m),m=d.getLineEnd(a)):(c=d.getLineStart(a),m=d.getLineEnd(m))):(c=d.getLineStart(a),m=d.getLineEnd(a)),n.setCaret(c),n.extend(m);this._setSelection(n,!0,!0);return!0},_setFullSelection:function(a,b){this._fullSelection=a;e.isWebkit&&(this._fullSelection=
!0);var c=this._clipDiv||this._rootDiv;if(c)if(this._fullSelection){if(!this._selDiv1&&this._fullSelection&&!e.isIOS){var m=c.ownerDocument;this._highlightRGB=e.isWebkit?"transparent":"Highlight";var d=e.createElement(m,"div");this._selDiv1=d;d.style.position="absolute";d.style.borderWidth="0px";d.style.margin="0px";d.style.padding="0px";d.style.outline="none";d.style.background=this._highlightRGB;d.style.width="0px";d.style.height="0px";d.style.zIndex="0";c.appendChild(d);var n=e.createElement(m,
"div");this._selDiv2=n;n.style.position="absolute";n.style.borderWidth="0px";n.style.margin="0px";n.style.padding="0px";n.style.outline="none";n.style.background=this._highlightRGB;n.style.width="0px";n.style.height="0px";n.style.zIndex="0";c.appendChild(n);this._selDiv3=m=e.createElement(m,"div");m.style.position="absolute";m.style.borderWidth="0px";m.style.margin="0px";m.style.padding="0px";m.style.outline="none";m.style.background=this._highlightRGB;m.style.width="0px";m.style.height="0px";m.style.zIndex=
"0";c.appendChild(m);if(e.isFirefox&&e.isMac){c=this._getWindow().getComputedStyle(m,null).getPropertyValue("background-color");switch(c){case "rgb(119, 141, 168)":c="rgb(199, 208, 218)";break;case "rgb(127, 127, 127)":c="rgb(198, 198, 198)";break;case "rgb(255, 193, 31)":c="rgb(250, 236, 115)";break;case "rgb(243, 70, 72)":c="rgb(255, 176, 139)";break;case "rgb(255, 138, 34)":c="rgb(255, 209, 129)";break;case "rgb(102, 197, 71)":c="rgb(194, 249, 144)";break;case "rgb(140, 78, 184)":c="rgb(232, 184, 255)";
break;default:c="rgb(180, 213, 255)"}this._highlightRGB=c;d.style.background=c;n.style.background=c;m.style.background=c}b||this._updateDOMSelection()}}else this._selDiv1&&(c.removeChild(this._selDiv1),this._selDiv1=null),this._selDiv2&&(c.removeChild(this._selDiv2),this._selDiv2=null),this._selDiv3&&(c.removeChild(this._selDiv3),this._selDiv3=null)},_setBlockCursor:function(a){this._blockCursorVisible=a;this._updateBlockCursorVisible()},_setOverwriteMode:function(a){this._overwriteMode=a;this._updateBlockCursorVisible()},
_updateBlockCursorVisible:function(){if(this._blockCursorVisible||this._overwriteMode){if(!this._cursorDiv){var a=this._viewDiv,b=e.createElement(a.ownerDocument,"div");b.className="textviewBlockCursor";this._cursorDiv=b;b.tabIndex=-1;b.style.zIndex="2";b.style.color="transparent";b.style.position="absolute";b.style.pointerEvents="none";b.innerHTML="\x26nbsp;";a.appendChild(b);this._updateDOMSelection()}}else this._cursorDiv&&(this._cursorDiv.parentNode.removeChild(this._cursorDiv),this._cursorDiv=
null)},_setMarginOffset:function(a,b){this._marginOffset=a;this._marginDiv.style.display=a?"block":"none";b||(this._metrics=this._calculateMetrics(),this._queueUpdate())},_setWrapOffset:function(a,b){this._wrapOffset=a;b||(this._metrics=this._calculateMetrics(),this._queueUpdate())},_setReadOnly:function(a){this._readonly=a;this._clientDiv.setAttribute("aria-readonly",a?"true":"false")},_setSingleMode:function(a,b){this._singleMode=a;this._updateOverflow();this._updateStyle(b)},_setTabSize:function(a,
b){this._tabSize=a;this._customTabSize=void 0;var c=this._clientDiv;e.isOpera?c&&(c.style.OTabSize=this._tabSize+""):537.1<=e.isWebkit?c&&(c.style.tabSize=this._tabSize+""):4<=e.isFirefox?c&&(c.style.MozTabSize=this._tabSize+""):8!==this._tabSize&&(this._customTabSize=this._tabSize);b||(this.redrawLines(),this._resetLineWidth())},_setTheme:function(a){this._theme&&this._theme.removeEventListener("ThemeChanged",this._themeListener.onChanged);(this._theme=a)&&this._theme.addEventListener("ThemeChanged",
this._themeListener.onChanged);this._setThemeClass(this._themeClass)},_setThemeClass:function(a,b){this._themeClass=a;var c="textview",m=this._theme.getThemeClass();m&&(c+=" "+m);this._themeClass&&m!==this._themeClass&&(c+=" "+this._themeClass);this._rootDiv.className=c;this._updateStyle(b)},_setWrapMode:function(a,b){this._wrapMode=a&&this._wrappable;var c=this._clientDiv;this._wrapMode?(c.style.whiteSpace="pre-wrap",c.style.wordWrap="break-word"):(c.style.whiteSpace="pre",c.style.wordWrap="normal");
this._updateOverflow();b||(this.redraw(),this._resetLineWidth());this._resetLineHeight()},_showCaret:function(a,b,c,m){if(this._clientDiv&&!(0<this._redrawCount)&&!this._ignoreDOMSelection){var d=this._model,n=this._getSelection(),e=this._getScroll(),t=n.getCaret(),f=n.start,l=n.end,h=d.getLineAtOffset(f),u=d.getLineAtOffset(l),k=Math.max(Math.max(f,d.getLineStart(u)),l-1),d=this._getClientWidth(),v=this._getClientHeight(),x=d/4,z=this._getBoundsAtOffset(t===f?f:k),w=z.left,p=z.right,q=z.top,s=z.bottom,
y=0,A="object"===typeof c;if((a||A)&&!n.isEmpty())z=this._getBoundsAtOffset(t===l?f:k),y=(z.bottom>s?z.bottom:s)-(z.top<q?z.top:q),a&&(z.top===q?t===f?p=w+Math.min(z.right-w,d):w=p-Math.min(p-z.left,d):t===f?s=q+Math.min(z.bottom-q,v):q=s-Math.min(s-z.top,v));a=0;w<e.x&&(a=Math.min(w-e.x,-x));p>e.x+d&&(a=Math.max(p-e.x-d,x));n=0;q<e.y?n=q-e.y:s>e.y+v&&(n=s-e.y-v);m&&(0<m?0<n&&(n=Math.max(n,m)):0>n&&(n=Math.min(n,m)));m=A&&"always"===c.scrollPolicy;if(0!==a||0!==n||m)return A?(m=0<n,0===n&&(n=q-e.y),
e=c.viewAnchor,q=c.selectionAnchor,c=Math.min(Math.max(0,c.viewAnchorOffset||0)),n="top"===e?n+Math.floor(m?(1-c)*v:-c*v):"bottom"===e?n+Math.floor(m?c*v:-(1-c)*v):"center"===e?n+Math.floor(m?v/2+c*v:v/2-(1-c)*v):n+Math.floor(m?c*v:-c*v),h!==u&&("top"===q&&t!==f?n+=Math.floor(-y):"bottom"===q&&t!==l?n+=Math.floor(y):"center"===q&&(n+=Math.floor(y/2)))):0!==n&&"number"===typeof c&&(0>c&&(c=0),1<c&&(c=1),n+=Math.floor(0<n?c*v:-c*v)),this._scrollViewAnimated(a,n,b),v!==this._getClientHeight()||d!==this._getClientWidth()?
this._showCaret():this._ensureCaretVisible=!0,!0;b&&b();return!1}},_startIME:function(){if(-1===this._imeOffset){var a=this._getSelection();a.isEmpty()||this._modifyContent({text:"",start:a.start,end:a.end},!0);this._imeOffset=a.start}},_unhookEvents:function(){this._model.removeEventListener("preChanging",this._modelListener.onChanging);this._model.removeEventListener("postChanged",this._modelListener.onChanged);this._theme.removeEventListener("ThemeChanged",this._themeListener.onChanged);this._modelListener=
null;for(var a=0;a<this._handlers.length;a++){var b=this._handlers[a];A(b.target,b.type,b.handler)}this._handlers=null;this._mutationObserver&&(this._mutationObserver.disconnect(),this._mutationObserver=null)},_updateDOMSelection:function(){if(!(0<this._redrawCount)&&!this._ignoreDOMSelection&&this._clientDiv){var a=this._getSelection(),b=this._model,c=b.getLineAtOffset(a.start),m=b.getLineAtOffset(a.end),d=this._getLineNext();if(d){var n=this._getLinePrevious(),e;c<d.lineIndex?(c=d,e=b.getLineStart(d.lineIndex)):
c>n.lineIndex?(c=n,e=b.getLineStart(n.lineIndex)):(c=this._getLineNode(c),e=a.start);m<d.lineIndex?(m=d,b=b.getLineStart(d.lineIndex)):m>n.lineIndex?(m=n,b=b.getLineStart(n.lineIndex)):(m=this._getLineNode(m),b=a.end);this._setDOMSelection(c,e,m,b,a.caret)}}},_update:function(a){if(!(0<this._redrawCount)){this._updateTimer&&(this._getWindow().clearTimeout(this._updateTimer),this._updateTimer=null,a=!1);var b=this._clientDiv,c=this._viewDiv;if(b){this._metrics.invalid&&(this._ignoreQueueUpdate=!0,
this._updateStyle(),this._ignoreQueueUpdate=!1);var m=this._model,d=this._getScroll(!1),n=this._getViewPadding(),t=m.getLineCount(),f=this._getLineHeight(),l=!1,h=!1,u=!1,k=this._metrics.scrollWidth;this._wrapMode&&(b.style.width=(this._metrics.wrapWidth||this._getClientWidth())+"px");var v,z,w,p,q=0,s=0,y;if(this._lineHeight){for(;s<t;){y=this._getLineHeight(s);if(q+y>d.y)break;q+=y;s++}v=s;z=Math.max(0,v-1);w=m=d.y-q;0<v&&(m+=this._getLineHeight(v-1))}else p=Math.max(0,d.y)/f,v=Math.floor(p),z=
Math.max(0,v-1),m=Math.round((p-z)*f),w=Math.round((p-v)*f);this._topIndexY=w;p=this._rootDiv;var A=p.clientWidth,I=p.clientHeight;if(a){f=0;this._leftDiv&&(v=this._leftDiv.getBoundingClientRect(),f=v.right-v.left);v=this._getClientWidth();p=this._getClientHeight();h=v;this._wrapMode?this._metrics.wrapWidth&&(h=this._metrics.wrapWidth):h=Math.max(this._maxLineWidth,h);for(;s<t;)y=this._getLineHeight(s,!1),q+=y,s++;t=q}else{p=this._getClientHeight();w=Math.min(v+Math.floor((p+w)/f),t-1);var d=Math.min(w+
1,t-1),B;for(y=b.firstChild;y;){B=y.lineIndex;var C=y.nextSibling;if(!(z<=B&&B<=d)||y.lineRemoved||-1===y.lineIndex)this._mouseWheelLine===y?(y.style.display="none",y.lineIndex=-1):b.removeChild(y);y=C}y=this._getLineNext();var C=c.ownerDocument,L=C.createDocumentFragment();for(B=z;B<=d;B++)!y||y.lineIndex>B?(new x(this,B)).create(L,null):(L.firstChild&&(b.insertBefore(L,y),L=C.createDocumentFragment()),y&&y.lineChanged&&(y=(new x(this,B)).create(L,y),y.lineChanged=!1),y=this._getLineNext(y));L.firstChild&&
b.insertBefore(L,y);e.isWebkit&&!this._wrapMode&&(b.style.width="0x7fffffffpx");y=this._getLineNext();B=p+m;for(L=!1;y;)z=y.lineWidth,void 0===z&&(C=y._line.getBoundingClientRect(),z=y.lineWidth=Math.ceil(C.right-C.left),C=C.bottom-C.top,this._lineHeight?this._lineHeight[y.lineIndex]=C:0!==f&&(0!==C&&Math.ceil(f)!==Math.ceil(C))&&(this._variableLineHeight=!0,this._lineHeight=[],this._lineHeight[y.lineIndex]=C)),this._lineHeight&&!L&&(B-=this._lineHeight[y.lineIndex],0>B&&(w=y.lineIndex,L=!0)),this._wrapMode||
(z>=this._maxLineWidth&&(this._maxLineWidth=z,this._maxLineIndex=y.lineIndex),this._checkMaxLineIndex===y.lineIndex&&(this._checkMaxLineIndex=-1)),y.lineIndex===v&&(this._topChild=y),y.lineIndex===w&&(this._bottomChild=y),y=this._getLineNext(y);-1!==this._checkMaxLineIndex&&(B=this._checkMaxLineIndex,this._checkMaxLineIndex=-1,0<=B&&B<t&&(f=new x(this,B),C=f.getBoundingClientRect(),z=C.right-C.left,z>=this._maxLineWidth&&(this._maxLineWidth=z,this._maxLineIndex=B),f.destroy()));for(;s<t;)y=this._getLineHeight(s,
s<=w),q+=y,s++;t=q;this._updateRuler(this._leftDiv,v,d,I);this._updateRuler(this._rightDiv,v,d,I);this._updateRuler(this._marginDiv,v,d,I);f=0;this._leftDiv&&(v=this._leftDiv.getBoundingClientRect(),f=v.right-v.left);d=0;this._rightDiv&&(d=this._rightDiv.getBoundingClientRect(),d=d.right-d.left);c.style.left=f+"px";c.style.right=d+"px";d=this._scrollDiv;d.style.height=t+"px";v=this._getClientWidth();!this._singleMode&&!this._wrapMode&&(q=l=p,(s="scroll"===c.style.overflowX)?l+=k:q-=k,y=w=v,(z="scroll"===
c.style.overflowY)?w+=k:y-=k,p=l,v=w,t>p&&(u=!0,v=y),this._maxLineWidth>v&&(h=!0,p=q,t>p&&(u=!0,v=y)),s!==h&&(c.style.overflowX=h?"scroll":"hidden"),z!==u&&(c.style.overflowY=u?"scroll":"hidden"),l=s!==h||z!==u);u=v;this._wrapMode?this._metrics.wrapWidth&&(u=this._metrics.wrapWidth):u=Math.max(this._maxLineWidth,u);h=u;if((!e.isIE||9<=e.isIE)&&this._maxLineWidth>v)u+=n.right+n.left;d.style.width=u+"px";this._clipScrollDiv&&(this._clipScrollDiv.style.width=u+"px");d=this._getScroll(!1)}this._vScrollDiv&&
(u=p-8,q=Math.max(15,Math.ceil(Math.min(1,u/(t+n.top+n.bottom))*u)),this._vScrollDiv.style.left=f+v-8+"px",this._vScrollDiv.style.top=Math.floor(Math.max(0,d.y*u/t))+"px",this._vScrollDiv.style.height=q+"px");!this._wrapMode&&this._hScrollDiv&&(u=v-8,q=Math.max(15,Math.ceil(Math.min(1,u/(this._maxLineWidth+n.left+n.right))*u)),this._hScrollDiv.style.left=f+Math.floor(Math.max(0,Math.floor(d.x*u/this._maxLineWidth)))+"px",this._hScrollDiv.style.top=p-9+"px",this._hScrollDiv.style.width=q+"px");s=d.x;
q=this._clipDiv;u=this._overlayDiv;if(w=this._marginDiv)w.style.left=-s+f+this._metrics.marginWidth+n.left+"px",w.style.bottom=("scroll"===c.style.overflowX?k:0)+"px";q?(q.scrollLeft=s,q.scrollTop=0,c=f+n.left,k=n.top,a=v,f=p,s=0,w=-m,0===d.x&&(c-=n.left,a+=n.left,s=n.left),d.x+v===h&&(a+=n.right),0===d.y&&(k-=n.top,f+=n.top,w+=n.top),d.y+p===t&&(f+=n.bottom),q.style.left=c+"px",q.style.top=k+"px",q.style.right=A-a-c+"px",q.style.bottom=I-f-k+"px",b.style.left=s+"px",b.style.top=w+"px",b.style.width=
h+"px",b.style.height=p+m+"px",u&&(u.style.left=b.style.left,u.style.top=b.style.top,u.style.width=b.style.width,u.style.height=b.style.height)):(c=s,k=m,A=s+v,I=m+p,0===c&&(c-=n.left),0===k&&(k-=n.top),A===h&&(A+=n.right),d.y+p===t&&(I+=n.bottom),b.style.clip="rect("+k+"px,"+A+"px,"+I+"px,"+c+"px)",b.style.left=-s+f+n.left+"px",b.style.width=(this._wrapMode||e.isWebkit?h:v+s)+"px",a||(b.style.top=-m+n.top+"px",b.style.height=p+m+"px"),u&&(u.style.clip=b.style.clip,u.style.left=b.style.left,u.style.width=
b.style.width,a||(u.style.top=b.style.top,u.style.height=b.style.height)));this._updateDOMSelection();l&&(b=this._ensureCaretVisible,this._ensureCaretVisible=!1,b&&this._showCaret(),this._queueUpdate())}}},_updateOverflow:function(){var a=this._viewDiv;this._wrapMode?(a.style.overflowX="hidden",a.style.overflowY="scroll"):a.style.overflow="hidden"},_updateRuler:function(a,b,c,m){if(a){var d=this._parent.ownerDocument,n=this._getLineHeight(),t=this._getViewPadding();for(a=a.firstChild;a;){var f=a._ruler,
u=n,h=f.getOverview();"page"===h&&(u+=this._topIndexY);a.style.top=-u+"px";a.style.height=m+u+"px";a.rulerChanged&&l(f.getRulerStyle(),a);var k,v=a.firstChild;v?(k=v,v=v.nextSibling):(k=e.createElement(d,"div"),k.style.visibility="hidden",a.appendChild(k));var x;if(a.rulerChanged&&k){u=-1;if(x=f.getWidestAnnotation())l(x.style,k),x.html&&(k.innerHTML=x.html);k.lineIndex=u;k.style.height=n+t.top+"px"}var z;if("page"===h){for(f=f.getAnnotations(b,c+1);v;)u=v.lineIndex,x=v.nextSibling,(!(b<=u&&u<=c)||
v.lineChanged)&&a.removeChild(v),v=x;v=a.firstChild.nextSibling;z=d.createDocumentFragment();for(u=b;u<=c;u++)if(!v||v.lineIndex>u){k=e.createElement(d,"div");if(x=f[u])l(x.style,k),x.html&&(k.innerHTML=x.html),k.annotation=x;k.lineIndex=u;k.style.height=this._getLineHeight(u)+"px";z.appendChild(k)}else z.firstChild&&(a.insertBefore(z,v),z=d.createDocumentFragment()),v&&(v=v.nextSibling);z.firstChild&&a.insertBefore(z,v)}else{x=this._getClientHeight();u=this._model.getLineCount();v=x+t.top+t.bottom-
2*this._metrics.scrollWidth;h=n*u<v?n:v/u;if(a.rulerChanged){for(x=a.childNodes.length;1<x;)a.removeChild(a.lastChild),x--;f=f.getAnnotations(0,u);z=d.createDocumentFragment();for(var w in f)u=w>>>0,0>u||(k=e.createElement(d,"div"),x=f[w],l(x.style,k),k.style.position="absolute",k.style.top=this._metrics.scrollWidth+n+Math.floor(u*h)+"px",x.html&&(k.innerHTML=x.html),k.annotation=x,k.lineIndex=u,z.appendChild(k));a.appendChild(z)}else if(a._oldTrackHeight!==v)for(k=a.firstChild?a.firstChild.nextSibling:
null;k;)k.style.top=this._metrics.scrollWidth+n+Math.floor(k.lineIndex*h)+"px",k=k.nextSibling;a._oldTrackHeight=v}a.rulerChanged=!1;a=a.nextSibling}}},_updateStyleSheet:function(){var a="";e.isWebkit&&0<this._metrics.scrollWidth&&(a+="\n.textview ::-webkit-scrollbar-corner {background: #eeeeee;}");e.isFirefox&&(e.isMac&&this._highlightRGB&&"Highlight"!==this._highlightRGB)&&(a+="\n.textview ::-moz-selection {background: "+this._highlightRGB+";}");if(a){var b=this._clientDiv.ownerDocument,c=b.getElementById("_textviewStyle");
if(c)c.removeChild(c.firstChild),c.appendChild(b.createTextNode(a));else{c=e.createElement(b,"style");c.id="_textviewStyle";var m=b.getElementsByTagName("head")[0]||b.documentElement;c.appendChild(b.createTextNode(a));m.insertBefore(c,m.firstChild)}}},_updateStyle:function(a){!a&&e.isIE&&(this._rootDiv.style.lineHeight="normal");var b=this._metrics=this._calculateMetrics();this._variableLineHeight&&(this._variableLineHeight=!1,this._resetLineHeight());this._rootDiv.style.lineHeight=e.isIE?b.lineHeight-
(b.lineTrim.top+b.lineTrim.bottom)+"px":"normal";this._updateStyleSheet();if(e.isMac&&e.isWebkit){var c=this._viewDiv;!b.invalid&&0===b.scrollWidth?(c.style.pointerEvents="none",c.style.zIndex="2"):(c.style.pointerEvents="",c.style.zIndex="")}a||(this.redraw(),this._resetLineWidth())}};k.EventTarget.addMixin(w.prototype);return{TextView:w}});
define("orion/editor/projectionTextModel",["orion/editor/textModel","orion/editor/eventTarget"],function(p,s){function q(k){this._model=k;this._projections=[];var d=this;this._listener={onChanged:function(f){d._onChanged(f)},onChanging:function(f){d._onChanging(f)}};k.addEventListener("postChanged",this._listener.onChanged);k.addEventListener("preChanging",this._listener.onChanging)}q.prototype={destroy:function(){this._model&&(this._model.removeEventListener("postChanged",this._listener.onChanged),
this._model.removeEventListener("preChanging",this._listener.onChanging),this._model=null)},addProjection:function(k){if(k){var d=this._model,f=this._projections;k._lineIndex=d.getLineAtOffset(k.start);k._lineCount=d.getLineAtOffset(k.end)-k._lineIndex;var e=k.text;e||(e="");k._model="string"===typeof e?new p.TextModel(e,d.getLineDelimiter()):e;var d=this.mapOffset(k.start,!0),e=k.end-k.start,l=k._lineCount,h=k._model.getCharCount(),c=k._model.getLineCount()-1,b={type:"Changing",text:k._model.getText(),
start:d,removedCharCount:e,addedCharCount:h,removedLineCount:l,addedLineCount:c};this.onChanging(b);b=this._binarySearch(f,k.start);f.splice(b,0,k);this.onChanged({type:"Changed",start:d,removedCharCount:e,addedCharCount:h,removedLineCount:l,addedLineCount:c})}},getProjections:function(){return this._projections.slice(0)},getBaseModel:function(){return this._model},mapOffset:function(k,d){var f=this._projections,e=0,l,h;if(d){for(l=0;l<f.length;l++){h=f[l];if(h.start>k)break;if(h.end>k)return-1;e+=
h._model.getCharCount()-(h.end-h.start)}return k+e}for(l=0;l<f.length;l++){h=f[l];if(h.start>k-e)break;var c=h._model.getCharCount();if(h.start+c>k-e)return-1;e+=c-(h.end-h.start)}return k-e},removeProjection:function(k){var d,f=0;for(d=0;d<this._projections.length;d++){var e=this._projections[d];if(e===k){k=e;break}f+=e._model.getCharCount()-(e.end-e.start)}if(d<this._projections.length){var e=this._model,f=k.start+f,l=k.end-k.start,h=k._lineCount,c=k._model.getCharCount(),b=k._model.getLineCount()-
1;k={type:"Changing",text:e.getText(k.start,k.end),start:f,removedCharCount:c,addedCharCount:l,removedLineCount:b,addedLineCount:h};this.onChanging(k);this._projections.splice(d,1);this.onChanged({type:"Changed",start:f,removedCharCount:c,addedCharCount:l,removedLineCount:b,addedLineCount:h})}},_binarySearch:function(k,d){for(var f=k.length,e=-1,l;1<f-e;)l=Math.floor((f+e)/2),d<=k[l].start?f=l:e=l;return f},getCharCount:function(){for(var k=this._model.getCharCount(),d=this._projections,f=0;f<d.length;f++)var e=
d[f],k=k+(e._model.getCharCount()-(e.end-e.start));return k},getLine:function(k,d){if(0>k)return null;var f=this._model,e=this._projections,l=0,h=[],c=0,b,a,m;for(b=0;b<e.length;b++){m=e[b];if(m._lineIndex>=k-l)break;a=m._model.getLineCount()-1;if(m._lineIndex+a>=k-l){c=k-(m._lineIndex+l);if(c<a)return m._model.getLine(c,d);h.push(m._model.getLine(a))}c=m.end;l+=a-m._lineCount}for(c=Math.max(c,f.getLineStart(k-l));b<e.length;b++){m=e[b];if(m._lineIndex>k-l)break;h.push(f.getText(c,m.start));a=m._model.getLineCount()-
1;if(m._lineIndex+a>k-l)return h.push(m._model.getLine(0,d)),h.join("");h.push(m._model.getText());c=m.end;l+=a-m._lineCount}e=f.getLineEnd(k-l,d);c<e&&h.push(f.getText(c,e));return h.join("")},getLineAtOffset:function(k){for(var d=this._model,f=this._projections,e=0,l=0,h=0;h<f.length;h++){var c=f[h];if(c.start>k-e)break;var b=c._model.getCharCount();if(c.start+b>k-e){f=k-(c.start+e);l+=c._model.getLineAtOffset(f);e+=f;break}l+=c._model.getLineCount()-1-c._lineCount;e+=b-(c.end-c.start)}return d.getLineAtOffset(k-
e)+l},getLineCount:function(){for(var k=this._projections,d=this._model.getLineCount(),f=0;f<k.length;f++)var e=k[f],d=d+(e._model.getLineCount()-1-e._lineCount);return d},getLineDelimiter:function(){return this._model.getLineDelimiter()},getLineEnd:function(k,d){if(0>k)return-1;for(var f=this._model,e=this._projections,l=0,h=0,c=0;c<e.length;c++){var b=e[c];if(b._lineIndex>k-l)break;var a=b._model.getLineCount()-1;if(b._lineIndex+a>k-l)return b._model.getLineEnd(k-(b._lineIndex+l),d)+b.start+h;h+=
b._model.getCharCount()-(b.end-b.start);l+=a-b._lineCount}return f.getLineEnd(k-l,d)+h},getLineStart:function(k){if(0>k)return-1;for(var d=this._model,f=this._projections,e=0,l=0,h=0;h<f.length;h++){var c=f[h];if(c._lineIndex>=k-e)break;var b=c._model.getLineCount()-1;if(c._lineIndex+b>=k-e)return c._model.getLineStart(k-(c._lineIndex+e))+c.start+l;l+=c._model.getCharCount()-(c.end-c.start);e+=b-c._lineCount}return d.getLineStart(k-e)+l},getText:function(k,d){void 0===k&&(k=0);var f=this._model,e=
this._projections,l=0,h=[],c,b,a;for(c=0;c<e.length;c++){b=e[c];if(b.start>k-l)break;a=b._model.getCharCount();if(b.start+a>k-l){if(void 0!==d&&b.start+a>d-l)return b._model.getText(k-(b.start+l),d-(b.start+l));h.push(b._model.getText(k-(b.start+l)));k=b.end+l+a-(b.end-b.start)}l+=a-(b.end-b.start)}var m=k-l;if(void 0!==d){for(;c<e.length;c++){b=e[c];if(b.start>d-l)break;h.push(f.getText(m,b.start));a=b._model.getCharCount();if(b.start+a>d-l)return h.push(b._model.getText(0,d-(b.start+l))),h.join("");
h.push(b._model.getText());m=b.end;l+=a-(b.end-b.start)}h.push(f.getText(m,d-l))}else{for(;c<e.length;c++)b=e[c],h.push(f.getText(m,b.start)),h.push(b._model.getText()),m=b.end;h.push(f.getText(m))}return h.join("")},_onChanged:function(k){k=this._change;var d=k.baseStart,f=k.baseEnd,e,l,h=this._projections;for(e=0;e<h.length&&!(l=h[e],l.end>d);e++);var c=e;for(e=0;e<h.length&&!(l=h[e],l.start>=f);e++);var b=e,a=this._model,d=k.baseText.length-(f-d);for(e=b;e<h.length;e++)l=h[e],l.start+=d,l.end+=
d,l._lineIndex=a.getLineAtOffset(l.start);l=h.splice(c,b-c);for(e=0;e<l.length;e++)l[e].annotation&&l[e].annotation._expand();this.onChanged({type:"Changed",start:k.start,removedCharCount:k.removedCharCount,addedCharCount:k.addedCharCount,removedLineCount:k.removedLineCount,addedLineCount:k.addedLineCount});this._change=void 0},_onChanging:function(k){var d=!!this._change,f=this._change||{},e=k.start,l=e+k.removedCharCount;f.baseStart=e;f.baseEnd=l;f.baseText=k.text;f.addedLineCount=k.addedLineCount;
if(!d){this._change=f;f.text=k.text;var h=this._projections,c,b,a;k=function(m){for(c=b=0;b<h.length;b++){a=h[b];if(a.start>m)break;if(a.end>m)return-1;c+=a._model.getCharCount()-(a.end-a.start)}return m+c};f.start=k(e);-1===f.start&&(f.text=this._model.getText(a.start,e)+f.text,f.addedLineCount+=this._model.getLineAtOffset(e)-this._model.getLineAtOffset(a.start),f.start=a.start+c);f.end=k(l);-1===f.end&&(f.text+=this._model.getText(l,a.end),f.addedLineCount+=this._model.getLineAtOffset(a.end)-this._model.getLineAtOffset(l),
f.end=a.start+c)}f.addedCharCount=f.text.length;f.removedCharCount=f.end-f.start;f.removedLineCount=this.getLineAtOffset(f.end)-this.getLineAtOffset(f.start);this.onChanging({type:"Changing",text:f.text,start:f.start,removedCharCount:f.removedCharCount,addedCharCount:f.addedCharCount,removedLineCount:f.removedLineCount,addedLineCount:f.addedLineCount})},onChanging:function(k){return this.dispatchEvent(k)},onChanged:function(k){return this.dispatchEvent(k)},setLineDelimiter:function(k){this._model.setLineDelimiter(k)},
setText:function(k,d,f){function e(a){for(h=c=0;c<l.length;c++){b=l[c];if(b.start>a-h)break;var m=b._model.getCharCount();if(b.start+m>a-h)return-1;h+=m-(b.end-b.start)}return a-h}this._change={text:k||"",start:d||0,end:void 0===f?this.getCharCount():f};var l=this._projections,h,c,b,a,m;k=e(this._change.start);-1===k&&(a={projection:b,start:this._change.start-(b.start+h)},k=b.end);d=e(this._change.end);-1===d&&(m={projection:b,end:this._change.end-(b.start+h)},d=b.start);a&&m&&a.projection===m.projection?
b._model.setText(this._change.text,a.start,m.end):(this._model.setText(this._change.text,k,d),a&&(b=a.projection,b._model.setText("",a.start)),m&&(b=m.projection,b._model.setText("",0,m.end),b.start=b.end,b._lineCount=0));this._change=void 0}};s.EventTarget.addMixin(q.prototype);return{ProjectionTextModel:q}});
define("orion/editor/annotations",["i18n!orion/editor/nls/messages","orion/editor/eventTarget"],function(p,s){function q(){}function k(b,a,c){this.start=b;this.end=a;this._projectionModel=c;this.html=this._expandedHTML;this.style=this._expandedStyle;this.expanded=!0}function d(b,a){var c=b.lastIndexOf("."),c=b.substring(c+1),d={title:p[c],style:{styleClass:"annotation "+c},html:"\x3cdiv class\x3d'annotationHTML "+c+"'\x3e\x3c/div\x3e",overviewStyle:{styleClass:"annotationOverview "+c}};a?d.lineStyle=
{styleClass:"annotationLine "+c}:d.rangeStyle={styleClass:"annotationRange "+c};q.registerType(b,d)}function f(){}function e(b,a,c,d,n){var e;void 0===d&&(d=-1);void 0===n&&(n=b.length);for(;1<n-d;)if(e=Math.floor((n+d)/2),a<=b[e].start)n=e;else if(c&&a<b[e].end){n=e;break}else d=e;return n}function l(b){this._annotations=[];var a=this;this._listener={onChanged:function(b){a._onChanged(b)}};this.setTextModel(b)}function h(b,a){this._view=b;this._annotationModel=a;var c=this;this._listener={onDestroy:function(a){c._onDestroy(a)},
onLineStyle:function(a){c._onLineStyle(a)},onChanged:function(a){c._onAnnotationModelChanged(a)}};b.addEventListener("Destroy",this._listener.onDestroy);b.addEventListener("postLineStyle",this._listener.onLineStyle);a.addEventListener("Changed",this._listener.onChanged)}k.prototype={_expandedHTML:"\x3cdiv class\x3d'annotationHTML expanded'\x3e\x3c/div\x3e",_expandedStyle:{styleClass:"annotation expanded"},_collapsedHTML:"\x3cdiv class\x3d'annotationHTML collapsed'\x3e\x3c/div\x3e",_collapsedStyle:{styleClass:"annotation collapsed"},
_collapse:function(){if(!this.expanded)return!1;this.expanded=!1;this.html=this._collapsedHTML;this.style=this._collapsedStyle;this._annotationModel&&this._annotationModel.modifyAnnotation(this);return!0},_expand:function(){if(this.expanded)return!1;this.expanded=!0;this.html=this._expandedHTML;this.style=this._expandedStyle;this._annotationModel&&this._annotationModel.modifyAnnotation(this);return!0},_collapseImpl:function(b){if(this._collapse()){b&&this._forEachOverlaping(function(a){a.expanded||
(a._expandImpl(!1),a._recollapse=!0)});b=this._projectionModel;var a=b.getBaseModel();this._projection={annotation:this,start:a.getLineStart(a.getLineAtOffset(this.start)+1),end:a.getLineEnd(a.getLineAtOffset(this.end),!0)};b.addProjection(this._projection)}},_expandImpl:function(b){this._expand()&&(this._projectionModel.removeProjection(this._projection),b&&this._forEachOverlaping(function(a){a._recollapse&&(a._collapseImpl(!1),a._recollapse=!1)}))},_forEachOverlaping:function(b){if(this._annotationModel)for(var a=
this._annotationModel.getAnnotations(this.start,this.end);a.hasNext();){var c=a.next();c!==this&&c.type===q.ANNOTATION_FOLDING&&b.call(this,c)}},collapse:function(){this._recollapse=!1;this._collapseImpl(!0)},expand:function(){this._recollapse=!1;this._expandImpl(!0)}};q.ANNOTATION_ERROR="orion.annotation.error";q.ANNOTATION_WARNING="orion.annotation.warning";q.ANNOTATION_TASK="orion.annotation.task";q.ANNOTATION_BREAKPOINT="orion.annotation.breakpoint";q.ANNOTATION_BOOKMARK="orion.annotation.bookmark";
q.ANNOTATION_FOLDING="orion.annotation.folding";q.ANNOTATION_CURRENT_BRACKET="orion.annotation.currentBracket";q.ANNOTATION_MATCHING_BRACKET="orion.annotation.matchingBracket";q.ANNOTATION_CURRENT_LINE="orion.annotation.currentLine";q.ANNOTATION_CURRENT_SEARCH="orion.annotation.currentSearch";q.ANNOTATION_MATCHING_SEARCH="orion.annotation.matchingSearch";q.ANNOTATION_READ_OCCURRENCE="orion.annotation.readOccurrence";q.ANNOTATION_WRITE_OCCURRENCE="orion.annotation.writeOccurrence";q.ANNOTATION_SELECTED_LINKED_GROUP=
"orion.annotation.selectedLinkedGroup";q.ANNOTATION_CURRENT_LINKED_GROUP="orion.annotation.currentLinkedGroup";q.ANNOTATION_LINKED_GROUP="orion.annotation.linkedGroup";q.ANNOTATION_BLAME="orion.annotation.blame";q.ANNOTATION_CURRENT_BLAME="orion.annotation.currentBlame";var c={};q.registerType=function(b,a){var m=a;"function"!==typeof m&&(m=function(a,b,c){this.start=a;this.end=b;void 0!==c&&(this.title=c)},m.prototype=a);m.prototype.type=b;c[b]=m;return b};q.createAnnotation=function(b,a,c,d){return new (this.getType(b))(a,
c,d)};q.getType=function(b){return c[b]};d(q.ANNOTATION_ERROR);d(q.ANNOTATION_WARNING);d(q.ANNOTATION_TASK);d(q.ANNOTATION_BREAKPOINT);d(q.ANNOTATION_BOOKMARK);d(q.ANNOTATION_CURRENT_BRACKET);d(q.ANNOTATION_MATCHING_BRACKET);d(q.ANNOTATION_CURRENT_SEARCH);d(q.ANNOTATION_MATCHING_SEARCH);d(q.ANNOTATION_READ_OCCURRENCE);d(q.ANNOTATION_WRITE_OCCURRENCE);d(q.ANNOTATION_SELECTED_LINKED_GROUP);d(q.ANNOTATION_CURRENT_LINKED_GROUP);d(q.ANNOTATION_LINKED_GROUP);d(q.ANNOTATION_CURRENT_LINE,!0);d(q.ANNOTATION_BLAME,
!0);d(q.ANNOTATION_CURRENT_BLAME,!0);q.registerType(q.ANNOTATION_FOLDING,k);f.addMixin=function(b){var a=f.prototype,c;for(c in a)a.hasOwnProperty(c)&&(b[c]=a[c])};f.prototype={addAnnotationType:function(b,a){this._annotationTypes||(this._annotationTypes=[]);var c=a-1;void 0==a||!(0<=c&&c<this._annotationTypes.length)?this._annotationTypes.push(b):this._annotationTypes.splice(c,0,b)},getAnnotationTypePriority:function(b){if(this._annotationTypes)for(var a=0;a<this._annotationTypes.length;a++)if(this._annotationTypes[a]===
b)return a+1;return 0},getAnnotationsByType:function(b,a,c){b=b.getAnnotations(a,c);for(c=[];b.hasNext();)a=b.next(),0!==this.getAnnotationTypePriority(a.type)&&c.push(a);var d=this;c.sort(function(a,b){return d.getAnnotationTypePriority(a.type)-d.getAnnotationTypePriority(b.type)});return c},isAnnotationTypeVisible:function(b){return 0!==this.getAnnotationTypePriority(b)},removeAnnotationType:function(b){if(this._annotationTypes)for(var a=0;a<this._annotationTypes.length;a++)if(this._annotationTypes[a]===
b){this._annotationTypes.splice(a,1);break}}};l.prototype={addAnnotation:function(b){if(b){var a=this._annotations,c=e(a,b.start);a.splice(c,0,b);b._annotationModel=this;this.onChanged({type:"Changed",added:[b],removed:[],changed:[]})}},getTextModel:function(){return this._model},getAnnotations:function(b,a){var c=this._annotations,d,n=0,e;e=void 0===b&&void 0===a?function(){return n<c.length?c[n++]:null}:function(){for(;n<c.length;){var d=c[n++];if(b===d.start||(b>d.start?b<d.end:d.start<a))return d;
if(d.start>=a)break}return null};d=e();return{next:function(){var a=d;a&&(d=e());return a},hasNext:function(){return null!==d}}},modifyAnnotation:function(b){if(b&&!(0>this._getAnnotationIndex(b)))this.onChanged({type:"Changed",added:[],removed:[],changed:[b]})},onChanged:function(b){return this.dispatchEvent(b)},removeAnnotations:function(b){var a=this._annotations,c,d;if(b){c=[];for(d=a.length-1;0<=d;d--){var n=a[d];n.type===b&&(a.splice(d,1),c.splice(0,0,n),n._annotationModel=null)}}else c=a;this.onChanged({type:"Changed",
removed:c,added:[],changed:[]})},removeAnnotation:function(b){if(b){var a=this._getAnnotationIndex(b);0>a||(b._annotationModel=null,b={type:"Changed",removed:this._annotations.splice(a,1),added:[],changed:[]},this.onChanged(b))}},replaceAnnotations:function(b,a){var c=this._annotations,d,n,f,l=[];if(b)for(d=b.length-1;0<=d;d--)f=b[d],n=this._getAnnotationIndex(f),0>n||(f._annotationModel=null,c.splice(n,1),l.splice(0,0,f));a||(a=[]);for(d=0;d<a.length;d++)f=a[d],n=e(c,f.start),f._annotationModel=
this,c.splice(n,0,f);this.onChanged({type:"Changed",removed:l,added:a,changed:[]})},setTextModel:function(b){this._model&&this._model.removeEventListener("Changed",this._listener.onChanged);(this._model=b)&&this._model.addEventListener("Changed",this._listener.onChanged)},_getAnnotationIndex:function(b){for(var a=this._annotations,c=e(a,b.start);c<a.length&&a[c].start===b.start;){if(a[c]===b)return c;c++}return-1},_onChanged:function(b){var a=b.start,c=b.addedCharCount,d=b.removedCharCount,n=this._annotations,
e=a+d;if(0<n.length){b={type:"Changed",added:[],removed:[],changed:[],textModelChangedEvent:b};c-=d;for(d=0;d<n.length;d++){var f=n[d];f.start>=e?(f._oldStart=f.start,f._oldEnd=f.end,f.start+=c,f.end+=c,b.changed.push(f)):f.end<=a||(f.start<a&&e<f.end?(f._oldStart=f.start,f._oldEnd=f.end,f.end+=c,b.changed.push(f)):(n.splice(d,1),b.removed.push(f),f._annotationModel=null,f.expand&&f.expand(),d--))}if(0<b.added.length||0<b.removed.length||0<b.changed.length)this.onChanged(b)}}};s.EventTarget.addMixin(l.prototype);
h.prototype={destroy:function(){var b=this._view;b&&(b.removeEventListener("Destroy",this._listener.onDestroy),b.removeEventListener("LineStyle",this._listener.onLineStyle),this.view=null);(b=this._annotationModel)&&b.removeEventListener("Changed",this._listener.onChanged)},_mergeStyle:function(b,a){if(a){b||(b={});b.styleClass=b.styleClass&&a.styleClass&&b.styleClass!==a.styleClass?b.styleClass+(" "+a.styleClass):a.styleClass;var c;a.tagName&&!b.tagName&&(b.tagName=a.tagName);if(a.style)for(c in b.style||
(b.style={}),a.style)b.style[c]||(b.style[c]=a.style[c]);if(a.attributes)for(c in b.attributes||(b.attributes={}),a.attributes)b.attributes[c]||(b.attributes[c]=a.attributes[c])}return b},_mergeStyleRanges:function(b,a){b||(b=[]);for(var c,d=e(b,a.start,!0);d<b.length&&a;d++){var n=b[d];if(a.end<=n.start)break;if(!(a.start>=n.end)){c=this._mergeStyle({},n.style);c=this._mergeStyle(c,a.style);var f=[];f.push(d,1);a.start<n.start&&f.push({start:a.start,end:n.start,style:a.style});a.start>n.start&&f.push({start:n.start,
end:a.start,style:n.style});f.push({start:Math.max(n.start,a.start),end:Math.min(n.end,a.end),style:c});a.end<n.end&&f.push({start:a.end,end:n.end,style:n.style});a=a.end>n.end?{start:n.end,end:a.end,style:a.style}:null;Array.prototype.splice.apply(b,f)}}a&&(c=this._mergeStyle({},a.style),b.splice(d,0,{start:a.start,end:a.end,style:c}));return b},_onAnnotationModelChanged:function(b){function a(a,b){e.getBaseModel&&(a=e.mapOffset(a,!0),b=e.mapOffset(b,!0));-1!==a&&-1!==b&&d.redrawRange(a,b)}function c(b,
m){for(var d=0;d<b.length;d++)if(n.isAnnotationTypeVisible(b[d].type)){var e=b[d];a(e.start,e.end);m&&(void 0!==e._oldStart&&e._oldEnd)&&a(e._oldStart,e._oldEnd)}}var d=this._view;if(d){var n=this,e=d.getModel();c(b.added);c(b.removed);c(b.changed,!0)}},_onDestroy:function(b){this.destroy()},_onLineStyle:function(b){var a=this._annotationModel,c=b.textView.getModel(),d=a.getTextModel(),n=b.lineStart,e=b.lineStart+b.lineText.length;d!==c&&(n=c.mapOffset(n),e=c.mapOffset(e));for(a=a.getAnnotations(n,
e);a.hasNext();)if(n=a.next(),this.isAnnotationTypeVisible(n.type)){if(n.rangeStyle){var e=n.start,f=n.end;d!==c&&(e=c.mapOffset(e,!0),f=c.mapOffset(f,!0));b.ranges=this._mergeStyleRanges(b.ranges,{start:e,end:f,style:n.rangeStyle})}n.lineStyle&&(b.style=this._mergeStyle({},b.style),b.style=this._mergeStyle(b.style,n.lineStyle))}}};f.addMixin(h.prototype);return{FoldingAnnotation:k,AnnotationType:q,AnnotationTypeList:f,AnnotationModel:l,AnnotationStyler:h}});
define("orion/editor/tooltip","i18n!orion/editor/nls/messages orion/editor/textView orion/editor/textModel orion/editor/projectionTextModel orion/editor/util orion/util".split(" "),function(p,s,q,k,d,f){function e(d){this._view=d;this._fadeDelay=500;this._hideDelay=200;this._showDelay=500;this._autoHideDelay=5E3;this._create(d.getOptions("parent").ownerDocument)}e.getTooltip=function(d){d._tooltip||(d._tooltip=new e(d));return d._tooltip};e.prototype={_create:function(e){if(!this._tooltipDiv){var h=
this._tooltipDiv=f.createElement(e,"div");h.tabIndex=0;h.className="textviewTooltip";h.setAttribute("aria-live","assertive");h.setAttribute("aria-atomic","true");var c=this._tooltipContents=f.createElement(e,"div");h.appendChild(c);e.body.appendChild(h);var b=this;d.addEventListener(h,"mouseover",function(a){b._hideDelay&&(a=b._getWindow(),b._delayedHideTimeout&&(a.clearTimeout(b._delayedHideTimeout),b._delayedHideTimeout=null),b._hideTimeout&&(a.clearTimeout(b._hideTimeout),b._hideTimeout=null),
b._nextTarget=null)},!1);d.addEventListener(h,"mouseout",function(a){a=a.relatedTarget||a.toElement;!(a===h||b._hasFocus())&&(!a||!d.contains(h,a))&&b._hide()},!1);d.addEventListener(h,"keydown",function(a){27===a.keyCode&&b._hide()},!1);d.addEventListener(e,"mousedown",this._mouseDownHandler=function(a){b.isVisible()&&(d.contains(h,a.target||a.srcElement)||b._hide())},!0);this._view.addEventListener("Destroy",function(){b.destroy()});this._hide()}},_getWindow:function(){var d=this._tooltipDiv.ownerDocument;
return d.defaultView||d.parentWindow},destroy:function(){if(this._tooltipDiv){this._hide();var e=this._tooltipDiv.parentNode;e&&e.removeChild(this._tooltipDiv);d.removeEventListener(this._tooltipDiv.ownerDocument,"mousedown",this._mouseDownHandler,!0);this._tooltipDiv=null}},_hasFocus:function(){var e=this._tooltipDiv;return!e?!1:d.contains(e,e.ownerDocument.activeElement)},hide:function(d){void 0===d&&(d=this._hideDelay);var e=this._getWindow();this._delayedHideTimeout&&(e.clearTimeout(this._delayedHideTimeout),
this._delayedHideTimeout=null);var c=this;d?c._delayedHideTimeout=e.setTimeout(function(){c._delayedHideTimeout=null;c._hide();c.setTarget(c._nextTarget,0)},d):(c._hide(),c.setTarget(c._nextTarget,0))},_hide:function(){var d=this._tooltipDiv;d&&(this._hasFocus()&&this._view.focus(),this._contentsView&&(this._contentsView.destroy(),this._contentsView=null),this._tooltipContents&&(this._tooltipContents.innerHTML=""),d.style.visibility="hidden",d=this._getWindow(),this._showTimeout&&(d.clearTimeout(this._showTimeout),
this._showTimeout=null),this._delayedHideTimeout&&(d.clearTimeout(this._delayedHideTimeout),this._delayedHideTimeout=null),this._hideTimeout&&(d.clearTimeout(this._hideTimeout),this._hideTimeout=null),this._fadeTimeout&&(d.clearInterval(this._fadeTimeout),this._fadeTimeout=null))},isVisible:function(){return this._tooltipDiv&&"visible"===this._tooltipDiv.style.visibility},setTarget:function(d,e,c){if(this.isVisible())this._hasFocus()||(this._nextTarget=d,this.hide(c));else if(this._target=d){var b=
this;d=b._getWindow();b._showTimeout&&(d.clearTimeout(b._showTimeout),b._showTimeout=null);0===e?b.show(!0):b._showTimeout=d.setTimeout(function(){b._showTimeout=null;b.show(!0)},e?e:b._showDelay)}},show:function(d){if(this._target){var e=this._target.getTooltipInfo();if(e){var c=this._tooltipDiv,b=this._tooltipContents;c.style.left=c.style.right=c.style.width=c.style.height=b.style.width=b.style.height="auto";var a=e.contents;a instanceof Array&&(a=this._getAnnotationContents(a));if("string"===typeof a)b.innerHTML=
a;else if(this._isNode(a))b.appendChild(a);else if(a instanceof k.ProjectionTextModel){var m=this._view,f=m.getOptions();f.wrapMode=!1;f.parent=b;var n=f.themeClass;n?((n=n.replace("tooltipTheme",""))&&(n=" "+n),n="tooltipTheme"+n):n="tooltipTheme";f.themeClass=n;f=this._contentsView=new s.TextView(f);f.addEventListener("LineStyle",function(a){m.onLineStyle(a)});f.setModel(a);a=f.computeSize();b.style.width=a.width+"px";b.style.height=a.height+"px";f.resize()}else return;b=c.ownerDocument.documentElement;
"right"===e.anchor?(a=b.clientWidth-e.x,c.style.right=a+"px"):(a=parseInt(this._getNodeStyle(c,"padding-left","0"),10),a+=parseInt(this._getNodeStyle(c,"border-left-width","0"),10),a=e.x-a,c.style.left=a+"px");c.style.maxWidth=b.clientWidth-a-10+"px";a=parseInt(this._getNodeStyle(c,"padding-top","0"),10);a+=parseInt(this._getNodeStyle(c,"border-top-width","0"),10);a=e.y-a;c.style.top=a+"px";c.style.maxHeight=b.clientHeight-a-10+"px";c.style.opacity="1";c.style.visibility="visible";if(d){var u=this,
v=this._getWindow();u._hideTimeout=v.setTimeout(function(){u._hideTimeout=null;var a=parseFloat(u._getNodeStyle(c,"opacity","1"));u._fadeTimeout=v.setInterval(function(){"visible"===c.style.visibility&&0<a?(a-=0.1,c.style.opacity=a):u._hide()},u._fadeDelay/10)},u._autoHideDelay)}}}},_getAnnotationContents:function(e){function h(a,b){var c=x.getLineStart(x.getLineAtOffset(a)),d=x.getLineEnd(x.getLineAtOffset(b),!0);return x.getText(c,d)}function c(a){var b=a.title,c=f.createElement(n,"div");c.className=
"tooltipRow";a.html&&(c.innerHTML=a.html,c.lastChild&&d.addEventListener(c.lastChild,"click",function(b){b=a.start;var c=a.end;v.getBaseModel&&(b=v.mapOffset(b,!0),c=v.mapOffset(c,!0));u.setSelection(b,c,1/3,function(){t._hide()})},!1),c.appendChild(n.createTextNode("\u00a0")));b||(b=h(a.start,a.end));"function"===typeof b&&(b=a.title());if("string"===typeof b){var m=f.createElement(n,"span");m.appendChild(n.createTextNode(b));b=m}c.appendChild(b);return c}for(var b,a=[],m=0;m<e.length;m++)b=e[m],
""!==b.title&&!b.groupAnnotation&&a.push(b);e=a;if(0===e.length)return null;var t=this,n=this._tooltipDiv.ownerDocument,u=this._view,v=u.getModel(),x=v.getBaseModel?v.getBaseModel():v;if(1===e.length){b=e[0];if(void 0!==b.title)return b=c(b),b.firstChild&&((e=b.firstChild.className)&&(e+=" "),b.firstChild.className=e+"single"),b;e=new k.ProjectionTextModel(x);a=x.getLineStart(x.getLineAtOffset(b.start));m=x.getCharCount();b.end!==m&&e.addProjection({start:b.end,end:m});0<a&&e.addProjection({start:0,
end:a});return e}a=f.createElement(n,"div");b=f.createElement(n,"em");b.appendChild(n.createTextNode(p.multipleAnnotations));a.appendChild(b);for(m=0;m<e.length;m++)b=e[m],(b=c(b))&&a.appendChild(b);return a},_getNodeStyle:function(d,e,c){var b;if(d&&(b=d.style[e],!b))if(d.currentStyle){for(b=0;-1!==(b=e.indexOf("-",b));)e=e.substring(0,b)+e.substring(b+1,b+2).toUpperCase()+e.substring(b+2);b=d.currentStyle[e]}else b=(d=d.ownerDocument.defaultView.getComputedStyle(d,null))?d.getPropertyValue(e):null;
return b||c},_isNode:function(d){return"object"===typeof Node?d instanceof Node:d&&"object"===typeof d&&"number"===typeof d.nodeType&&"string"===typeof d.nodeName}};return{Tooltip:e}});
define("orion/editor/rulers",["i18n!orion/editor/nls/messages","orion/editor/annotations","orion/editor/tooltip","orion/util"],function(p,s,q,k){function d(c,b,a,d){this._location=b||"left";this._overview=a||"page";this._rulerStyle=d;this._view=null;var e=this;this._listener={onTextModelChanged:function(a){e._onTextModelChanged(a)},onAnnotationModelChanged:function(a){e._onAnnotationModelChanged(a)}};this.setAnnotationModel(c)}function f(c,b,a,m,e){d.call(this,c,b,"page",a);this._oddStyle=m||{style:{backgroundColor:"white"}};
this._evenStyle=e||{style:{backgroundColor:"white"}};this._numOfDigits=0;this._firstLine=1}function e(c,b,a){d.call(this,c,b,"page",a)}function l(c,b,a){d.call(this,c,b,"document",a)}function h(c,b,a){e.call(this,c,b,a)}d.prototype={getAnnotations:function(c,b){var a=this._annotationModel;if(!a)return[];var d=this._view.getModel(),e=d.getLineStart(c),n=d.getLineEnd(b-1),f=d;d.getBaseModel&&(f=d.getBaseModel(),e=d.mapOffset(e),n=d.mapOffset(n));for(var h=[],a=this.getAnnotationsByType(a,e,n),e=0;e<
a.length;e++)for(var n=a[e],l=f.getLineAtOffset(n.start),k=f.getLineAtOffset(Math.max(n.start,n.end-1)),p=l;p<=k;p++){var q=p;if(d!==f){q=f.getLineStart(p);q=d.mapOffset(q,!0);if(-1===q)continue;q=d.getLineAtOffset(q)}if(c<=q&&q<b){var z=this._mergeAnnotation(h[q],n,p-l,k-l+1);z&&(h[q]=z)}}if(!this._multiAnnotation&&this._multiAnnotationOverlay)for(var g in h)h[g]._multiple&&(h[g].html+=this._multiAnnotationOverlay.html);return h},getAnnotationModel:function(){return this._annotationModel},getLocation:function(){return this._location},
getOverview:function(){return this._overview},getRulerStyle:function(){return this._rulerStyle},getView:function(){return this._view},getWidestAnnotation:function(){return null},setAnnotationModel:function(c){this._annotationModel&&this._annotationModel.removEventListener("Changed",this._listener.onAnnotationModelChanged);(this._annotationModel=c)&&this._annotationModel.addEventListener("Changed",this._listener.onAnnotationModelChanged)},setMultiAnnotation:function(c){this._multiAnnotation=c},setMultiAnnotationOverlay:function(c){this._multiAnnotationOverlay=
c},setView:function(c){this._onTextModelChanged&&this._view&&this._view.removeEventListener("ModelChanged",this._listener.onTextModelChanged);this._view=c;this._onTextModelChanged&&this._view&&this._view.addEventListener("ModelChanged",this._listener.onTextModelChanged)},onClick:function(c,b){if(void 0!==c){var a=this._view,d=a.getModel(),e=d,n=d.getLineStart(c),f=n,h=n,l=this._annotationModel;if(l){a=a.getSelection();h=d.getLineEnd(c,!0);n<=a.start&&a.start<h&&(n=a.start);d.getBaseModel&&(n=d.mapOffset(n),
h=d.mapOffset(h),e=d.getBaseModel());for(var k,h=l.getAnnotations(n,h),l=null;!k&&h.hasNext();)a=h.next(),this.isAnnotationTypeVisible(a.type)&&(l=a,a.start<=n||(k=a));l&&void 0!==l.groupId&&(this._currentClickGroup=this._currentClickGroup===l.groupId?null:l.groupId,this._setCurrentGroup(c));k&&e.getLineAtOffset(k.start)===e.getLineAtOffset(n)?(n=k.start,h=k.end):h=n=f;d.getBaseModel&&(n=d.mapOffset(n,!0),h=d.mapOffset(h,!0))}(d=q.Tooltip.getTooltip(this._view))&&d.setTarget(null);this._view.setSelection(h,
n,1/3,function(){})}},onDblClick:function(c,b){},onMouseMove:function(c,b){var a=q.Tooltip.getTooltip(this._view);if(a&&!(a.isVisible()&&this._tooltipLineIndex===c)){this._tooltipLineIndex=c;var d=this;a.setTarget({y:b.clientY,getTooltipInfo:function(){return d._getTooltipInfo(d._tooltipLineIndex,this.y)}})}},onMouseOver:function(c,b){this.onMouseMove(c,b);this._currentClickGroup||this._setCurrentGroup(c)},onMouseOut:function(c,b){this._currentClickGroup||this._setCurrentGroup(-1);var a=q.Tooltip.getTooltip(this._view);
a&&a.setTarget(null)},_getTooltipInfo:function(c,b){if(void 0!==c){var a=this._view,d=a.getModel(),e=this._annotationModel,n=[];if(e){var n=d.getLineStart(c),f=d.getLineEnd(c);d.getBaseModel&&(n=d.mapOffset(n),f=d.mapOffset(f));n=this.getAnnotationsByType(e,n,f)}e=this._getTooltipContents(c,n);if(!e)return null;e={contents:e,anchor:this.getLocation()};n=a.getClientArea();"document"===this.getOverview()?n.y=a.convert({y:b},"view","document").y:n.y=a.getLocationAtOffset(d.getLineStart(c)).y;a.convert(n,
"document","page");e.x=n.x;e.y=n.y;"right"===e.anchor&&(e.x+=n.width);return e}},_getTooltipContents:function(c,b){return b},_onAnnotationModelChanged:function(c){function b(b){for(var c=0;c<b.length;c++)if(e.isAnnotationTypeVisible(b[c].type)){var n=b[c].start,f=b[c].end;d.getBaseModel&&(n=d.mapOffset(n,!0),f=d.mapOffset(f,!0));-1!==n&&-1!==f&&a.redrawLines(d.getLineAtOffset(n),d.getLineAtOffset(Math.max(n,f-1))+1,e)}}var a=this._view;if(a){var d=a.getModel(),e=this,n=d.getLineCount();c.textModelChangedEvent?
(c=c.textModelChangedEvent.start,d.getBaseModel&&(c=d.mapOffset(c,!0)),c=d.getLineAtOffset(c),a.redrawLines(c,n,e)):(b(c.added),b(c.removed),b(c.changed))}},_mergeAnnotation:function(c,b,a,d){c||(c={});0===a&&(c.html&&b.html?(b.html!==c.html&&(!c._multiple&&this._multiAnnotation)&&(c.html=this._multiAnnotation.html),c._multiple=!0):c.html=b.html);c.style=this._mergeStyle(c.style,b.style);return c},_mergeStyle:function(c,b){if(b){c||(c={});c.styleClass=c.styleClass&&b.styleClass&&c.styleClass!==b.styleClass?
c.styleClass+(" "+b.styleClass):b.styleClass;var a;if(b.style)for(a in c.style||(c.style={}),b.style)void 0===c.style[a]&&(c.style[a]=b.style[a]);if(b.attributes)for(a in c.attributes||(c.attributes={}),b.attributes)void 0===c.attributes[a]&&(c.attributes[a]=b.attributes[a])}return c},_setCurrentGroup:function(c){var b=this._annotationModel,a=null,d=b.getTextModel(),e,n=this._currentGroupAnnotation;if(-1!==c){var f=d.getLineStart(c),h=d.getLineEnd(c);d.getBaseModel&&(f=d.mapOffset(f),h=d.mapOffset(h));
for(e=b.getAnnotations(f,h);e.hasNext();)if(d=e.next(),this.isAnnotationTypeVisible(d.type)&&d.start<=f&&d.end>=h&&void 0!==d.groupId){a=d;break}if(n&&a&&n.groupId===a.groupId)return}this._currentGroupAnnotation=null;n&&b.removeAnnotations(n.groupType);if(a&&-1!==c){this._currentGroupAnnotation=a;e=b.getAnnotations();for(c=[];e.hasNext();)d=e.next(),delete d.groupAnnotation,d.groupId===a.groupId&&(d=d.createGroupAnnotation(),c.push(d));b.replaceAnnotations(null,c)}}};s.AnnotationTypeList.addMixin(d.prototype);
f.prototype=new d;f.prototype.getAnnotations=function(c,b){for(var a=d.prototype.getAnnotations.call(this,c,b),m=this._view.getModel(),e=c;e<b;e++){var n=e&1?this._oddStyle:this._evenStyle,f=e;m.getBaseModel&&(f=m.getLineStart(f),f=m.getBaseModel().getLineAtOffset(m.mapOffset(f)));a[e]||(a[e]={});a[e].html=this._firstLine+f+"";a[e].style||(a[e].style=n)}return a};f.prototype.getWidestAnnotation=function(){var c=this._view.getModel().getLineCount();return this.getAnnotations(c-1,c)[c-1]};f.prototype.setFirstLine=
function(c){this._firstLine=void 0!==c?c:1};f.prototype._onTextModelChanged=function(c){var b=c.start;c=this._view.getModel();var a=c.getBaseModel?c.getBaseModel().getLineCount():c.getLineCount(),a=(this._firstLine+a-1+"").length;this._numOfDigits!==a&&(this._numOfDigits=a,b=c.getLineAtOffset(b),this._view.redrawLines(b,c.getLineCount(),this))};e.prototype=new d;l.prototype=new d;l.prototype.getRulerStyle=function(){var c={style:{lineHeight:"1px",fontSize:"1px"}};return c=this._mergeStyle(c,this._rulerStyle)};
l.prototype._getTooltipContents=function(c,b){if(0===b.length){var a=this._view.getModel(),m=c;a.getBaseModel&&(m=a.getLineStart(m),m=a.getBaseModel().getLineAtOffset(a.mapOffset(m)));return k.formatMessage(p.line,m+1)}return d.prototype._getTooltipContents.call(this,c,b)};l.prototype._mergeAnnotation=function(c,b,a,d){if(0===a)return c||(c={html:"\x26nbsp;",style:{style:{height:3*d+"px"}}},c.style=this._mergeStyle(c.style,b.overviewStyle)),c};h.prototype=new e;h.prototype.onClick=function(c,b){if(void 0!==
c){var a=this._annotationModel;if(a){var d=this._view.getModel(),e=d.getLineStart(c),n=d.getLineEnd(c,!0);d.getBaseModel&&(e=d.mapOffset(e),n=d.mapOffset(n),d=d.getBaseModel());for(var f,a=a.getAnnotations(e,n);!f&&a.hasNext();)n=a.next(),this.isAnnotationTypeVisible(n.type)&&d.getLineAtOffset(n.start)===d.getLineAtOffset(e)&&(f=n);f&&((d=q.Tooltip.getTooltip(this._view))&&d.setTarget(null),f.expanded?f.collapse():f.expand())}}};h.prototype._getTooltipContents=function(c,b){if(0<b.length){var a=this._view.getModel(),
d=a.getLineStart(c);a.getBaseModel&&(d=a.mapOffset(d),a=a.getBaseModel());for(var d=a.getLineAtOffset(d),f=0;f<b.length;f++){var n=b[f];if(this.isAnnotationTypeVisible(n.type)&&a.getLineAtOffset(n.start)===d){if(b[f].expanded)break;return e.prototype._getTooltipContents.call(this,c,[n])}}}return null};h.prototype._onAnnotationModelChanged=function(c){function b(a){for(n=0;n<a.length;n++)if(f.isAnnotationTypeVisible(a[n].type)){var b=a[n].start;d.getBaseModel&&(b=d.mapOffset(b,!0));-1!==b&&(l=Math.min(l,
d.getLineAtOffset(b)))}}if(c.textModelChangedEvent)e.prototype._onAnnotationModelChanged.call(this,c);else{var a=this._view;if(a){var d=a.getModel(),f=this,n,h=d.getLineCount(),l=h;b(c.added);b(c.removed);b(c.changed);c=a.getRulers();for(n=0;n<c.length;n++)a.redrawLines(l,h,c[n])}}};return{Ruler:d,AnnotationRuler:e,LineNumberRuler:f,OverviewRuler:l,FoldingRuler:h}});
define("orion/editor/undoStack",[],function(){function p(k,d,f,e,l){this.model=k;this.offset=d;this.text=f;this.previousText=e;this.type=l}function s(k){this.owner=k;this.changes=[]}function q(k,d){this.size=void 0!==d?d:100;this.reset();var f=this;this._listener={onChanging:function(d){f._onChanging(d)},onDestroy:function(d){f._onDestroy(d)}};if(k.getModel){var e=k.getModel();e.getBaseModel&&(e=e.getBaseModel());this.model=e;this.setView(k)}else this.shared=!0,this.model=k;this.model.addEventListener("Changing",
this._listener.onChanging)}p.prototype={getRedoChanges:function(){return[{start:this.offset,end:this.offset+this.previousText.length,text:this.text}]},getUndoChanges:function(){return[{start:this.offset,end:this.offset+this.text.length,text:this.previousText}]},undo:function(k,d){this._doUndoRedo(this.offset,this.previousText,this.text,k,d);return!0},redo:function(k,d){this._doUndoRedo(this.offset,this.text,this.previousText,k,d);return!0},merge:function(k,d,f,e,l){if(e===this.type){if(1===e&&k===
this.offset+this.text.length)return this.text+=d,!0;if(-1===e&&l===this.offset)return this.offset=k,this.previousText=f+this.previousText,!0;if(-1===e&&k===this.offset)return this.previousText+=f,!0}return!1},_doUndoRedo:function(k,d,f,e,l){this.model.setText(d,k,k+f.length);l&&e&&(f=e.getModel(),f!==this.model&&(k=f.mapOffset(k,!0)),e.setSelection(k,k+d.length))}};s.prototype={getRedoChanges:function(){for(var k=[],d=0;d<this.changes.length;d++)k=k.concat(this.changes[d].getRedoChanges());return k},
getUndoChanges:function(){for(var k=[],d=this.changes.length-1;0<=d;d--)k=k.concat(this.changes[d].getUndoChanges());return k},add:function(k){this.changes.push(k)},end:function(k){k&&(this.endSelection=k.getSelection(),this.endCaret=k.getCaretOffset());(k=this.owner)&&k.end&&k.end()},undo:function(k,d){1<this.changes.length&&k&&k.setRedraw(!1);for(var f=this.changes.length-1;0<=f;f--)this.changes[f].undo(k,!1);1<this.changes.length&&k&&k.setRedraw(!0);if(d&&k){var f=this.startSelection.start,e=this.startSelection.end;
k.setSelection(this.startCaret?f:e,this.startCaret?e:f)}(f=this.owner)&&f.undo&&f.undo();return 0<this.changes.length},redo:function(k,d){1<this.changes.length&&k&&k.setRedraw(!1);for(var f=0;f<this.changes.length;f++)this.changes[f].redo(k,!1);(1<this.changes.length,k)&&k.setRedraw(!0);if(d&&k){var f=this.endSelection.start,e=this.endSelection.end;k.setSelection(this.endCaret?f:e,this.endCaret?e:f)}(f=this.owner)&&f.redo&&f.redo();return 0<this.changes.length},merge:function(k,d,f,e,l){var h=this.changes.length;
return 0<h?this.changes[h-1].merge(k,d,f,e,l):!1},start:function(k){k&&(this.startSelection=k.getSelection(),this.startCaret=k.getCaretOffset());(k=this.owner)&&k.start&&k.start()}};q.prototype={destroy:function(){this._onDestroy()},add:function(k){this.compoundChange?this.compoundChange.add(k):(this.stack.splice(this.index,this.stack.length-this.index,k),this.index++,this.stack.length>this.size&&(this.stack.shift(),this.index--))},markClean:function(){this._commitUndo();if(this.cleanChange=this.stack[this.index-
1])this.cleanChange.type=2},isClean:function(){return this.cleanChange===this.stack[this.index-1]},canUndo:function(){return 0<this.index},canRedo:function(){return 0<this.stack.length-this.index},endCompoundChange:function(){this.compoundChange&&this.compoundChange.end(this.view);this.compoundChange=void 0},getSize:function(){return{undo:this.index,redo:this.stack.length-this.index}},getRedoChanges:function(){this._commitUndo();for(var k=[],d=this.index;d<this.stack.length;d++)k=k.concat(this.stack[d].getRedoChanges());
return k},getUndoChanges:function(){this._commitUndo();for(var k=[],d=this.index;0<=d;d--)k=k.concat(this.stack[d].getUndoChanges());return k},undo:function(){this._commitUndo();var k;k=!1;this._ignoreUndo=!0;do{if(0>=this.index)break;k=this.stack[--this.index]}while(!(k=k.undo(this.view,!0)));this._ignoreUndo=!1;return k},redo:function(){this._commitUndo();var k;this._ignoreUndo=!0;do{if(this.index>=this.stack.length)break;k=this.stack[this.index++]}while(!k.redo(this.view,!0));this._ignoreUndo=
!1;return!0},reset:function(){this.index=0;this.cleanChange=void 0;this.stack=[];this._ignoreUndo=!1;this._compoundChange=void 0},setView:function(k){this.view!==k&&(this.view&&k.removeEventListener("Destroy",this._listener.onDestroy),(this.view=k)&&k.addEventListener("Destroy",this._listener.onDestroy))},startCompoundChange:function(k){this._commitUndo();k=new s(k);this.add(k);this.compoundChange=k;this.compoundChange.start(this.view);return this.compoundChange},_commitUndo:function(){this.endCompoundChange()},
_onDestroy:function(k){(!k||!this.shared)&&this.model.removeEventListener("Changing",this._listener.onChanging);this.view&&(this.view.removeEventListener("Destroy",this._listener.onDestroy),this.view=null)},_onChanging:function(k){if(!this._ignoreUndo){var d=k.text,f=k.start,e=k.addedCharCount,l=k.removedCharCount;k=f+l;var h=0;0===e&&1===l?h=-1:1===e&&0===l&&(h=1);e=this.stack.length;l=this.model.getText(f,k);(!(0<e&&this.index===e)||!this.stack[e-1].merge(f,d,l,h,k))&&this.add(new p(this.model,
f,d,l,h))}}};return{UndoStack:q}});
define("orion/editor/textDND",["orion/util"],function(p){function s(p,k){this._view=p;this._undoStack=k;this._dragSelection=null;this._dropOffset=-1;this._dropText=null;var d=this;this._listener={onDragStart:function(f){d._onDragStart(f)},onDragEnd:function(f){d._onDragEnd(f)},onDragEnter:function(f){d._onDragEnter(f)},onDragOver:function(f){d._onDragOver(f)},onDrop:function(f){d._onDrop(f)},onDestroy:function(f){d._onDestroy(f)}};p.addEventListener("DragStart",this._listener.onDragStart);p.addEventListener("DragEnd",
this._listener.onDragEnd);p.addEventListener("DragEnter",this._listener.onDragEnter);p.addEventListener("DragOver",this._listener.onDragOver);p.addEventListener("Drop",this._listener.onDrop);p.addEventListener("Destroy",this._listener.onDestroy)}s.prototype={destroy:function(){var p=this._view;p&&(p.removeEventListener("DragStart",this._listener.onDragStart),p.removeEventListener("DragEnd",this._listener.onDragEnd),p.removeEventListener("DragEnter",this._listener.onDragEnter),p.removeEventListener("DragOver",
this._listener.onDragOver),p.removeEventListener("Drop",this._listener.onDrop),p.removeEventListener("Destroy",this._listener.onDestroy),this._view=null)},_onDestroy:function(p){this.destroy()},_onDragStart:function(p){var k=this._view,d=k.getSelection(),k=k.getModel();k.getBaseModel&&(d.start=k.mapOffset(d.start),d.end=k.mapOffset(d.end),k=k.getBaseModel());if(k=k.getText(d.start,d.end))this._dragSelection=d,p.event.dataTransfer.effectAllowed="copyMove",p.event.dataTransfer.setData("Text",k)},_onDragEnd:function(q){if(this._dragSelection){var k=
this._view,d=q.event.dataTransfer.dropEffect;if(!p.isFirefox&&("none"!==d||this._dropText))d=q.event.dataTransfer.dropEffect=this._dropEffect;this._undoStack&&this._undoStack.startCompoundChange();(q="move"===d)&&k.setText("",this._dragSelection.start,this._dragSelection.end);if(this._dropText){var d=this._dropText,f=this._dropOffset;q&&(f>=this._dragSelection.end?f-=this._dragSelection.end-this._dragSelection.start:f>=this._dragSelection.start&&(f=this._dragSelection.start));k.setText(d,f,f);k.setSelection(f,
f+d.length);this._dropText=null;this._dropOffset=-1}this._undoStack&&this._undoStack.endCompoundChange()}this._dragSelection=null},_onDragEnter:function(p){this._onDragOver(p)},_onDragOver:function(q){var k=q.event.dataTransfer.types,d=!this._view.getOptions("readonly");d&&k&&(d=k.contains?k.contains("text/plain")||k.contains("Text"):-1!==k.indexOf("text/plain")||-1!==k.indexOf("Text"));d?p.isFirefox||(this._dropEffect=q.event.dataTransfer.dropEffect=(p.isMac?q.event.altKey:q.event.ctrlKey)?"copy":
"move"):q.event.dataTransfer.dropEffect="none"},_onDrop:function(q){var k=this._view,d=q.event.dataTransfer.getData("Text");d&&(p.isFirefox||(q.event.dataTransfer.dropEffect=this._dropEffect),q=k.getOffsetAtLocation(q.x,q.y),this._dragSelection?(this._dropOffset=q,this._dropText=d):(k.setText(d,q,q),k.setSelection(q,q+d.length)))}};return{TextDND:s}});
define("orion/objects",[],function(){function p(p){for(var q=1;q<arguments.length;q++){var k=arguments[q],d;for(d in k)Object.prototype.hasOwnProperty.call(k,d)&&(p[d]=k[d])}return p}return{clone:function(s){if(Array.isArray(s))return Array.prototype.slice.call(s);var q=Object.create(Object.getPrototypeOf(s));p(q,s);return q},mixin:p,toArray:function(p){return Array.isArray(p)?p:[p]}}});
define("orion/editor/editor","i18n!orion/editor/nls/messages orion/editor/eventTarget orion/editor/tooltip orion/editor/annotations orion/objects orion/util".split(" "),function(p,s,q,k,d,f){function e(c){c=c||{};this._domNode=c.domNode;this._model=c.model;this._undoStack=c.undoStack;this._statusReporter=c.statusReporter;this._title=null;var b=this;this._listener={onChanged:function(a){b.onChanged(a)}};this._model&&this._model.addEventListener("Changed",this._listener.onChanged);this.checkDirty()}
function l(c){c=c||{};e.call(this,c);this._textViewFactory=c.textViewFactory;this._undoStackFactory=c.undoStackFactory;this._textDNDFactory=c.textDNDFactory;this._annotationFactory=c.annotationFactory;this._foldingRulerFactory=c.foldingRulerFactory;this._lineNumberRulerFactory=c.lineNumberRulerFactory;this._contentAssistFactory=c.contentAssistFactory;this._keyBindingFactory=c.keyBindingFactory;this._contentAssist=this._foldingRuler=this._overviewRuler=this._lineNumberRuler=this._annotationRuler=this._annotationModel=
this._annotationStyler=null}var h=k.AnnotationType;e.prototype={destroy:function(){this.uninstall();this._statusReporter=this._domNode=null;this._model&&this._model.removeEventListener("Changed",this._listener.onChanged)},checkDirty:function(){this.setDirty(this._undoStack&&!this._undoStack.isClean())},focus:function(){},getModel:function(){return this._model},getText:function(c,b){return this.getModel().getText(c,b)},getTitle:function(){return this._title},getUndoStack:function(){return this._undoStack},
install:function(){this.installed=!0},isDirty:function(){return this._dirty},markClean:function(){this.getUndoStack().markClean();this.setDirty(!1)},onDirtyChanged:function(c){return this.dispatchEvent(c)},onInputChanged:function(c){return this.dispatchEvent(c)},onChanged:function(c){this.checkDirty()},reportStatus:function(c,b,a){this._statusReporter&&this._statusReporter(c,b,a)},resize:function(){},setDirty:function(c){this._dirty!==c&&(this._dirty=c,this.onDirtyChanged({type:"DirtyChanged"}))},
_setModelText:function(c){this._model&&this._model.setText(c)},setInput:function(c,b,a,d){this._title=c;d||(b?this.reportStatus(b,"error"):null!==a&&(void 0!==a&&"string"===typeof a)&&this._setModelText(a),this._undoStack&&this._undoStack.reset());this.checkDirty();this.onInputChanged({type:"InputChanged",title:c,message:b,contents:a,contentsSaved:d})},setText:function(c,b,a){this.getModel().setText(c,b,a)},uninstall:function(){this.installed=!1}};s.EventTarget.addMixin(e.prototype);l.prototype=new e;
d.mixin(l.prototype,{destroy:function(){e.prototype.destroy.call(this);this._textViewFactory=this._undoStackFactory=this._textDNDFactory=this._annotationFactory=this._foldingRulerFactory=this._lineNumberRulerFactory=this._contentAssistFactory=this._keyBindingFactory=null},getAnnotationModel:function(){return this._annotationModel},getAnnotationRuler:function(){return this._annotationRuler},getAnnotationStyler:function(){return this._annotationStyler},getContentAssist:function(){return this._contentAssist},
getFoldingRuler:function(){return this._foldingRuler},getLineNumberRuler:function(){return this._lineNumberRuler},getModel:function(){if(!this._textView)return null;var c=this._textView.getModel();c.getBaseModel&&(c=c.getBaseModel());return c},getOverviewRuler:function(){return this._overviewRuler},getTextView:function(){return this._textView},getKeyModes:function(){return this._textView.getKeyModes()},getSourceCodeActions:function(){return this._sourceCodeActions},getLinkedMode:function(){return this._linkedMode},
getTextActions:function(){return this._textActions},focus:function(){this._textView&&this._textView.focus()},resize:function(){this._textView&&this._textView.resize()},setAnnotationRulerVisible:function(c,b){if(this._annotationRulerVisible!==c||b)if(this._annotationRulerVisible=c,this._annotationRuler){var a=this._textView;c?a.addRuler(this._annotationRuler,0):a.removeRuler(this._annotationRuler)}},setFoldingRulerVisible:function(c,b){if(this._foldingRulerVisible!==c||b)if(this._foldingRulerVisible=
c,this._foldingRuler){var a=this._textView;a.getModel().getBaseModel&&(c?a.addRuler(this._foldingRuler):a.removeRuler(this._foldingRuler))}},setLineNumberRulerVisible:function(c,b){if(this._lineNumberRulerVisible!==c||b)if(this._lineNumberRulerVisible=c,this._lineNumberRuler){var a=this._textView;c?a.addRuler(this._lineNumberRuler,!this._annotationRulerVisible?0:1):a.removeRuler(this._lineNumberRuler)}},setOverviewRulerVisible:function(c,b){if(this._overviewRulerVisible!==c||b)if(this._overviewRulerVisible=
c,this._overviewRuler){var a=this._textView;c?a.addRuler(this._overviewRuler):a.removeRuler(this._overviewRuler)}},mapOffset:function(c,b){var a=this._textView.getModel();a.getBaseModel&&(c=a.mapOffset(c,b));return c},getLineAtOffset:function(c){return this.getModel().getLineAtOffset(this.mapOffset(c))},getLineStart:function(c){return this.getModel().getLineStart(c)},getCaretOffset:function(){return this.mapOffset(this._textView.getCaretOffset())},getSelection:function(){var c=this._textView,b=c.getSelection(),
c=c.getModel();c.getBaseModel&&(b.start=c.mapOffset(b.start),b.end=c.mapOffset(b.end));return b},_expandOffset:function(c){var b=this._textView.getModel(),a=this._annotationModel;if(a&&b.getBaseModel)for(c=a.getAnnotations(c,c+1);c.hasNext();)b=c.next(),b.type===h.ANNOTATION_FOLDING&&b.expand&&b.expand()},setCaretOffset:function(c,b,a){var d=this._textView,e=d.getModel();e.getBaseModel&&(this._expandOffset(c),c=e.mapOffset(c,!0));d.setCaretOffset(c,b,a)},setText:function(c,b,a){var d=this._textView,
e=d.getModel();e.getBaseModel&&(void 0!==b&&(this._expandOffset(b),b=e.mapOffset(b,!0)),void 0!==a&&(this._expandOffset(a),a=e.mapOffset(a,!0)));d.setText(c,b,a)},setSelection:function(c,b,a,d){var e=this._textView,n=e.getModel();n.getBaseModel&&(this._expandOffset(c),this._expandOffset(b),c=n.mapOffset(c,!0),b=n.mapOffset(b,!0));e.setSelection(c,b,a,d)},moveSelection:function(c,b,a,d){var e=this._textView;this.setSelection(c,b||c,1/3,function(){(void 0===d||d)&&e.focus();a&&a()})},_getTooltipInfo:function(c,
b){var a=this._textView,d=this.getAnnotationModel();if(!d)return null;var e=this._annotationStyler;if(!e)return null;var n=a.getOffsetAtLocation(c,b);if(-1===n)return null;n=this.mapOffset(n);e=e.getAnnotationsByType(d,n,n+1);d=[];for(n=0;n<e.length;n++)e[n].rangeStyle&&d.push(e[n]);if(0===d.length)return null;a=a.convert({x:c,y:b},"document","page");return{contents:d,anchor:"left",x:a.x+10,y:a.y+20}},_highlightCurrentLine:function(c,b){var a=this._annotationModel;if(a){var d=this._textView;if(!d.getOptions("singleMode")){var e=
d.getModel(),n=b?e.getLineAtOffset(b.start):-1,f=e.getLineAtOffset(c.start),d=c.start===c.end,l=!b||b.start===b.end,k=e.getLineStart(f),p=e.getLineEnd(f);e.getBaseModel&&(k=e.mapOffset(k),p=e.mapOffset(p));e=this._currentLineAnnotation;if(!(n===f&&l&&d&&e&&e.start===k&&e.end===p)){var n=e?[e]:null,q;d&&(e=h.createAnnotation(h.ANNOTATION_CURRENT_LINE,k,p),q=[e]);this._currentLineAnnotation=e;a.replaceAnnotations(n,q)}}}},installTextView:function(){this.install()},install:function(){if(!this._textView){this._textView=
this._textViewFactory();this._undoStackFactory&&(this._undoStack=this._undoStackFactory.createUndoStack(this),this.checkDirty());this._textDNDFactory&&(this._textDND=this._textDNDFactory.createTextDND(this,this._undoStack));this._contentAssistFactory&&(this._contentAssist=this._contentAssistFactory.createContentAssistMode(this).getContentAssist());var c=this,b=this._textView,a=this;this._listener={onModelChanged:function(b){a.checkDirty()},onMouseOver:function(b){a._listener.onMouseMove(b)},onMouseMove:function(c){var d=
q.Tooltip.getTooltip(b);d&&!(a._listener.lastMouseX===c.event.clientX&&a._listener.lastMouseY===c.event.clientY)&&(a._listener.lastMouseX=c.event.clientX,a._listener.lastMouseY=c.event.clientY,d.setTarget({x:c.x,y:c.y,getTooltipInfo:function(){return a._getTooltipInfo(this.x,this.y)}}))},onMouseOut:function(c){var d=q.Tooltip.getTooltip(b);d&&!(a._listener.lastMouseX===c.event.clientX&&a._listener.lastMouseY===c.event.clientY)&&(a._listener.lastMouseX=c.event.clientX,a._listener.lastMouseY=c.event.clientY,
d.setTarget(null))},onScroll:function(a){(a=q.Tooltip.getTooltip(b))&&a.setTarget(null,0,0)},onSelection:function(b){a._updateCursorStatus();a._highlightCurrentLine(b.newValue,b.oldValue)}};b.addEventListener("ModelChanged",this._listener.onModelChanged);b.addEventListener("Selection",this._listener.onSelection);b.addEventListener("MouseOver",this._listener.onMouseOver);b.addEventListener("MouseOut",this._listener.onMouseOut);b.addEventListener("MouseMove",this._listener.onMouseMove);b.addEventListener("Scroll",
this._listener.onScroll);if(this._keyBindingFactory){var d;if(d="function"===typeof this._keyBindingFactory?this._keyBindingFactory(this,this.getKeyModes(),this._undoStack,this._contentAssist):this._keyBindingFactory.createKeyBindings(c,this._undoStack,this._contentAssist))this._textActions=d.textActions,this._linkedMode=d.linkedMode,this._sourceCodeActions=d.sourceCodeActions}d=function(a,b){if(void 0!==a&&-1!==a){for(var d=this.getView().getModel(),e=this.getAnnotationModel(),n=c.mapOffset(d.getLineStart(a)),
d=c.mapOffset(d.getLineEnd(a)),m=e.getAnnotations(n,d),f=null;m.hasNext();){var g=m.next();if(g.type===h.ANNOTATION_BOOKMARK){f=g;break}}f?e.removeAnnotation(f):(f=h.createAnnotation(h.ANNOTATION_BOOKMARK,n,d),f.title=void 0,e.addAnnotation(f))}};if(this._annotationFactory){var f=b.getModel();f.getBaseModel&&(f=f.getBaseModel());if(this._annotationModel=this._annotationFactory.createAnnotationModel(f))if(f=this._annotationStyler=this._annotationFactory.createAnnotationStyler(b,this._annotationModel))f.addAnnotationType(h.ANNOTATION_CURRENT_SEARCH),
f.addAnnotationType(h.ANNOTATION_MATCHING_SEARCH),f.addAnnotationType(h.ANNOTATION_ERROR),f.addAnnotationType(h.ANNOTATION_WARNING),f.addAnnotationType(h.ANNOTATION_MATCHING_BRACKET),f.addAnnotationType(h.ANNOTATION_CURRENT_BRACKET),f.addAnnotationType(h.ANNOTATION_CURRENT_LINE),f.addAnnotationType(h.ANNOTATION_READ_OCCURRENCE),f.addAnnotationType(h.ANNOTATION_WRITE_OCCURRENCE),f.addAnnotationType(h.ANNOTATION_SELECTED_LINKED_GROUP),f.addAnnotationType(h.ANNOTATION_CURRENT_LINKED_GROUP),f.addAnnotationType(h.ANNOTATION_LINKED_GROUP),
f.addAnnotationType("orion.annotation.highlightError");var f=this._annotationFactory.createAnnotationRulers(this._annotationModel),n=this._annotationRuler=f.annotationRuler;n&&(n.onDblClick=d,n.setMultiAnnotationOverlay({html:"\x3cdiv class\x3d'annotationHTML overlay'\x3e\x3c/div\x3e"}),n.addAnnotationType(h.ANNOTATION_ERROR),n.addAnnotationType(h.ANNOTATION_WARNING),n.addAnnotationType(h.ANNOTATION_TASK),n.addAnnotationType(h.ANNOTATION_BOOKMARK));this.setAnnotationRulerVisible(this._annotationRulerVisible||
void 0===this._annotationRulerVisible,!0);if(n=this._overviewRuler=f.overviewRuler)n.addAnnotationType(h.ANNOTATION_CURRENT_SEARCH),n.addAnnotationType(h.ANNOTATION_MATCHING_SEARCH),n.addAnnotationType(h.ANNOTATION_READ_OCCURRENCE),n.addAnnotationType(h.ANNOTATION_WRITE_OCCURRENCE),n.addAnnotationType(h.ANNOTATION_CURRENT_BLAME),n.addAnnotationType(h.ANNOTATION_ERROR),n.addAnnotationType(h.ANNOTATION_WARNING),n.addAnnotationType(h.ANNOTATION_TASK),n.addAnnotationType(h.ANNOTATION_BOOKMARK),n.addAnnotationType(h.ANNOTATION_MATCHING_BRACKET),
n.addAnnotationType(h.ANNOTATION_CURRENT_BRACKET),n.addAnnotationType(h.ANNOTATION_CURRENT_LINE);this.setOverviewRulerVisible(this._overviewRulerVisible||void 0===this._overviewRulerVisible,!0)}this._lineNumberRulerFactory&&(this._lineNumberRuler=this._lineNumberRulerFactory.createLineNumberRuler(this._annotationModel),this._lineNumberRuler.addAnnotationType(h.ANNOTATION_CURRENT_BLAME),this._lineNumberRuler.addAnnotationType(h.ANNOTATION_BLAME),this._lineNumberRuler.onDblClick=d,this.setLineNumberRulerVisible(this._lineNumberRulerVisible||
void 0===this._lineNumberRulerVisible,!0));this._foldingRulerFactory&&(this._foldingRuler=this._foldingRulerFactory.createFoldingRuler(this._annotationModel),this._foldingRuler.addAnnotationType(h.ANNOTATION_FOLDING),this.setFoldingRulerVisible(this._foldingRulerVisible||void 0===this._foldingRulerVisible,!0));this.dispatchEvent({type:"TextViewInstalled",textView:b});e.prototype.install.call(this)}},uninstallTextView:function(){this.uninstall()},uninstall:function(){var c=this._textView;c&&(c.destroy(),
this._textView=this._undoStack=this._textDND=this._contentAssist=this._listener=this._annotationModel=this._annotationStyler=this._annotationRuler=this._overviewRuler=this._lineNumberRuler=this._foldingRuler=this._currentLineAnnotation=this._title=null,this._dirty=!1,this._foldingRulerVisible=this._overviewRulerVisible=this._lineNumberRulerVisible=this._annotationRulerVisible=void 0,this.dispatchEvent({type:"TextViewUninstalled",textView:c}),e.prototype.uninstall.call(this))},_updateCursorStatus:function(){for(var c=
this.getModel(),b=this.getCaretOffset(),a=c.getLineAtOffset(b),c=c.getLineStart(a),b=b-c,c=this.getKeyModes(),d=0;d<c.length;d++){var e=c[d];if(e.isActive()&&e.isStatusActive&&e.isStatusActive())return}this.reportStatus(f.formatMessage(p.lineColumn,a+1,b+1))},showAnnotations:function(c,b,a,d){var e=this._annotationModel;if(e){for(var n=[],f=[],l=e.getTextModel(),k=e.getAnnotations(),p;k.hasNext();)p=k.next(),-1!==b.indexOf(p.type)&&p.creatorID===this&&n.push(p);if(c)for(b=0;b<c.length;b++)if(p=c[b]){if(a)p=
a(p);else{var q;"number"===typeof p.line?(q=l.getLineStart(p.line-1),k=q+p.start-1,q=q+p.end-1):(k=p.start,q=p.end);var s=d(p);if(!s)continue;p=h.createAnnotation(s,k,q,p.description)}p.creatorID=this;f.push(p)}e.replaceAnnotations(n,f)}},showProblems:function(c){this.showAnnotations(c,[h.ANNOTATION_ERROR,h.ANNOTATION_WARNING,h.ANNOTATION_TASK],null,function(b){switch(b.severity){case "error":return h.ANNOTATION_ERROR;case "warning":return h.ANNOTATION_WARNING;case "task":return h.ANNOTATION_TASK}return null})},
showOccurrences:function(c){this.showAnnotations(c,[h.ANNOTATION_READ_OCCURRENCE,h.ANNOTATION_WRITE_OCCURRENCE],null,function(b){return b.readAccess?h.ANNOTATION_READ_OCCURRENCE:h.ANNOTATION_WRITE_OCCURRENCE})},showBlame:function(c){var b=this._blameRGB,a=this.getTextView().getOptions("parent").ownerDocument;if(!b){var e=f.createElement(a,"div");e.className="annotation blame";a.body.appendChild(e);var t=(a.defaultView||a.parentWindow).getComputedStyle(e).getPropertyValue("background-color");e.parentNode.removeChild(e);
var e=t.indexOf("("),n=t.indexOf(")"),t=t.substring(e+1,n);this._blameRGB=b=t.split(",").slice(0,3)}var l=function(){var a=k.AnnotationType.createAnnotation(this.groupType,this.start,this.end,this.title);a.style=d.mixin({},a.style);a.style.style=d.mixin({},a.style.style);a.style.style.backgroundColor="";this.groupAnnotation=a;a.blame=this.blame;a.html=this.html;a.creatorID=this.creatorID;return a},v=function(){var b=f.createElement(a,"div");b.className="tooltipTitle";var c=this.blame.Message.indexOf("\n");
-1===c&&(c=this.blame.Message.length);var d=f.createElement(a,"a");d.href=this.blame.CommitLink;d.appendChild(a.createTextNode(this.blame.Message.substring(0,c)));b.appendChild(d);b.appendChild(f.createElement(a,"br"));b.appendChild(a.createTextNode(f.formatMessage(p.committerOnTime,this.blame.AuthorName,this.blame.Time)));return b},x=this.getModel();this.showAnnotations(c,[h.ANNOTATION_BLAME,h.ANNOTATION_CURRENT_BLAME],function(a){var c=x.getLineStart(a.Start-1),e=x.getLineEnd(a.End-1,!0),c=k.AnnotationType.createAnnotation(h.ANNOTATION_BLAME,
c,e,v),e=b.slice(0);e.push(a.Shade);c.style=d.mixin({},c.style);c.style.style=d.mixin({},c.style.style);c.style.style.backgroundColor="rgba("+e.join()+")";c.groupId=a.Name;c.groupType=h.ANNOTATION_CURRENT_BLAME;c.createGroupAnnotation=l;c.html='\x3cimg class\x3d"annotationHTML blame" src\x3d"'+a.AuthorImage+'"/\x3e';c.blame=a;return c})},showSelection:function(c,b,a,d,e){"number"===typeof c?("number"!==typeof b&&(b=c),this.moveSelection(c,b)):"number"===typeof a&&(c=this.getModel().getLineStart(a-
1),"number"===typeof d&&(c+=d),"number"!==typeof e&&(e=0),this.moveSelection(c,c+e))},_setModelText:function(c){this._textView&&(this._textView.setText(c),this._textView.getModel().setLineDelimiter("auto"),this._highlightCurrentLine(this._textView.getSelection()))},setInput:function(c,b,a,d,f){e.prototype.setInput.call(this,c,b,a,d);this._textView&&(!d&&!f)&&this._textView.focus()},onGotoLine:function(c,b,a,d){if(this._textView){var e=this.getModel();c=Math.max(0,Math.min(c,e.getLineCount()-1));var n=
e.getLineStart(c),f=0;void 0===a&&(a=0);"string"===typeof b?(c=e.getLine(c).indexOf(b),-1!==c&&(f=c,a=f+b.length)):(f=b,b=e.getLineEnd(c)-n,f=Math.min(f,b),a=Math.min(a,b));this.moveSelection(n+f,n+a,d)}}});return{BaseEditor:e,Editor:l}});
define("orion/editor/find","i18n!orion/editor/nls/messages orion/keyBinding orion/editor/keyModes orion/editor/annotations orion/regex orion/objects orion/util".split(" "),function(p,s,q,k,d,f,e){function l(b){var a=b.getTextView();q.KeyMode.call(this,a);this.editor=b;this._active=!1;this._success=!0;this._ignoreSelection=!1;this._prefix="";a.setAction("incrementalFindCancel",function(){this.setActive(!1);return!0}.bind(this));a.setAction("incrementalFindBackspace",function(){return this._backspace()}.bind(this));
var c=this;this._listener={onVerify:function(a){var b=c.editor,e=b.getModel(),f=b.mapOffset(a.start),b=b.mapOffset(a.end),e=e.getText(f,b);if((e=c._prefix.match(RegExp("^"+d.escape(e),"i")))&&0<e.length)c._prefix+=a.text,c._success=!0,c._status(),c.find(c._forward,!0),a.text=null},onSelection:function(){c._ignoreSelection||c.setActive(!1)}}}function h(b,a,c){if(b){this._editor=b;this._undoStack=a;this._showAll=!0;this._visible=!1;this._wrap=this._caseInsensitive=!0;this._wholeWord=!1;this._incremental=
!0;this._regex=!1;this._findAfterReplace=!0;this._reverse=this._hideAfterFind=!1;this._timer=this._end=this._start=void 0;this._lastString="";var d=this;this._listeners={onEditorFocus:function(a){d._removeCurrentAnnotation(a)}};this.setOptions(c)}}var c={};l.prototype=new q.KeyMode;f.mixin(l.prototype,{createKeyBindings:function(){var b=s.KeyBinding,a=[];a.push({actionID:"incrementalFindBackspace",keyBinding:new b(8)});a.push({actionID:"incrementalFindCancel",keyBinding:new b(13)});a.push({actionID:"incrementalFindCancel",
keyBinding:new b(27)});a.push({actionID:"incrementalFindReverse",keyBinding:new b(38)});a.push({actionID:"incrementalFind",keyBinding:new b(40)});a.push({actionID:"incrementalFindReverse",keyBinding:new b("k",!0,!0)});a.push({actionID:"incrementalFind",keyBinding:new b("k",!0)});return a},find:function(b,a){this._forward=b;if(!this.isActive())return this.setActive(!0),!1;var c=this._prefix;if(0===c.length)return!1;var d=this.editor,e=d.getModel(),e=b?this._success?a?this._start:d.getCaretOffset()+
1:0:this._success?a?this._start:d.getCaretOffset():e.getCharCount()-1;(c=d.getModel().find({string:c,start:e,reverse:!b,caseInsensitive:c.toLowerCase()===c}).next())?(a||(this._start=e),this._ignoreSelection=this._success=!0,d.moveSelection(b?c.start:c.end,b?c.end:c.start),this._ignoreSelection=!1):this._success=!1;this._status();return!0},isActive:function(){return this._active},isStatusActive:function(){return this.isActive()},setActive:function(b){this._active!==b&&(this._active=b,this._prefix=
"",this._success=!0,b=this.editor.getTextView(),this._start=this.editor.getCaretOffset(),this.editor.setCaretOffset(this._start),this._active?(b.addEventListener("Verify",this._listener.onVerify),b.addEventListener("Selection",this._listener.onSelection),b.addKeyMode(this)):(b.removeEventListener("Verify",this._listener.onVerify),b.removeEventListener("Selection",this._listener.onSelection),b.removeKeyMode(this)),this._status())},_backspace:function(){var b=this._prefix,b=this._prefix=b.substring(0,
b.length-1);return 0===b.length?(this._ignoreSelection=this._success=!0,this.editor.setCaretOffset(this.editor.getSelection().start),this._ignoreSelection=!1,this._status(),!0):this.find(this._forward,!0)},_status:function(){if(this.isActive()){var b;b=this._forward?this._success?p.incrementalFindStr:p.incrementalFindStrNotFound:this._success?p.incrementalFindReverseStr:p.incrementalFindReverseStrNotFound;b=e.formatMessage(b,this._prefix);this.editor.reportStatus(b,this._success?"":"error")}else this.editor.reportStatus("")}});
c.IncrementalFind=l;h.prototype={find:function(b,a,c){this.setOptions({reverse:!b});var d=this.getFindString(),e;a&&(d=a.findString||d,e=a.count);b=this.getOptions();this.setOptions(a);a=c?this._startOffset:this.getStartOffset();if((e=this._doFind(d,a,e))&&!c)this._startOffset=e.start;this.setOptions(b);this._hideAfterFind&&this.hide();return e},getStartOffset:function(){return void 0!==this._start?this._start:this._reverse?this._editor.getSelection().start-1:this._editor.getCaretOffset()},getFindString:function(){var b=
this._editor.getSelection(),b=this._editor.getText(b.start,b.end);this._regex&&(b=d.escape(b));return b||this._lastString},getOptions:function(){return{showAll:this._showAll,caseInsensitive:this._caseInsensitive,wrap:this._wrap,wholeWord:this._wholeWord,incremental:this._incremental,regex:this._regex,findAfterReplace:this._findAfterReplace,hideAfterFind:this._hideAfterFind,reverse:this._reverse,findCallback:this._findCallback,start:this._start,end:this._end}},getReplaceString:function(){return""},
hide:function(){this._visible=!1;this._savedOptions&&(this.setOptions(this._savedOptions.pop()),0===this._savedOptions.length&&(this._savedOptions=null));this._removeAllAnnotations();var b=this._editor.getTextView();b&&(b.removeEventListener("Focus",this._listeners.onEditorFocus),b.focus())},_processReplaceString:function(b){var a=b;if(this._regex){for(var a="",c=!1,d=this._editor.getModel().getLineDelimiter(),e=0;e<b.length;e++){var f=b.substring(e,e+1);if(c){switch(f){case "R":a+=d;break;case "r":a+=
"\r";break;case "n":a+="\n";break;case "t":a+="\t";break;case "\\":a+="\\";break;default:a+="\\"+f}c=!1}else"\\"===f?c=!0:a+=f}c&&(a+="\\")}return a},isVisible:function(){return this._visible},replace:function(){var b=this.getFindString();if(b){var a=this._editor,c=this._processReplaceString(this.getReplaceString()),d=a.getSelection().start;if(a=a.getModel().find({string:b,start:d,reverse:!1,wrap:this._wrap,regex:this._regex,wholeWord:this._wholeWord,caseInsensitive:this._caseInsensitive}).next())this.startUndo(),
this._doReplace(a.start,a.end,b,c),this.endUndo()}this._findAfterReplace&&b&&this._doFind(b,this.getStartOffset())},replaceAll:function(){var b=this.getFindString();if(b){this._replacingAll=!0;var a=this._editor,c=a.getTextView();a.reportStatus(p.replacingAll);var d=this._processReplaceString(this.getReplaceString()),n=this;window.setTimeout(function(){for(var f=0,h=0;;){var l=n._doFind(b,f,null,!0);if(!l)break;h++;1===h&&(c.setRedraw(!1),n.startUndo());n._doReplace(l.start,l.end,b,d);f=n.getStartOffset()}0<
h&&(n.endUndo(),c.setRedraw(!0));0<f?a.reportStatus(e.formatMessage(p.replacedMatches,h)):a.reportStatus(p.nothingReplaced,"error");n._replacingAll=!1},100)}},setOptions:function(b){if(b){if((!0===b.showAll||!1===b.showAll)&&this._showAll!==b.showAll)if(this._showAll=b.showAll,this.isVisible())if(this._showAll)this._markAllOccurrences();else{var a=this._editor.getAnnotationModel();a&&a.removeAnnotations(k.AnnotationType.ANNOTATION_MATCHING_SEARCH)}if(!0===b.caseInsensitive||!1===b.caseInsensitive)this._caseInsensitive=
b.caseInsensitive;if(!0===b.wrap||!1===b.wrap)this._wrap=b.wrap;if(!0===b.wholeWord||!1===b.wholeWord)this._wholeWord=b.wholeWord;if(!0===b.incremental||!1===b.incremental)this._incremental=b.incremental;if(!0===b.regex||!1===b.regex)this._regex=b.regex;if(!0===b.findAfterReplace||!1===b.findAfterReplace)this._findAfterReplace=b.findAfterReplace;if(!0===b.hideAfterFind||!1===b.hideAfterFind)this._hideAfterFind=b.hideAfterFind;if(!0===b.reverse||!1===b.reverse)this._reverse=b.reverse;b.hasOwnProperty("findCallback")&&
(this._findCallback=b.findCallback);b.hasOwnProperty("start")&&(this._start=b.start);b.hasOwnProperty("end")&&(this._end=b.end)}},show:function(b){this._visible=!0;b&&(this._savedOptions||(this._savedOptions=[]),this._savedOptions.push(this.getOptions()),this.setOptions(b));this._startOffset=this._editor.getSelection().start;this._editor.getTextView().addEventListener("Focus",this._listeners.onEditorFocus);var a=this;window.setTimeout(function(){a._incremental&&a.find(!0,null,!0)},0)},startUndo:function(){this._undoStack&&
this._undoStack.startCompoundChange()},endUndo:function(){this._undoStack&&this._undoStack.endCompoundChange()},_find:function(b,a,c){return this._editor.getModel().find({string:b,start:a,end:this._end,reverse:this._reverse,wrap:c?!1:this._wrap,regex:this._regex,wholeWord:this._wholeWord,caseInsensitive:this._caseInsensitive})},_doFind:function(b,a,c,d){c=c||1;var e=this._editor;if(!b)return this._removeAllAnnotations(),null;this._lastString=b;var f,h;if(this._regex)try{h=this._find(b,a,d)}catch(l){e.reportStatus(l.message,
"error");return}else h=this._find(b,a,d);for(b=0;b<c&&h.hasNext();b++)f=h.next();if(!this._replacingAll){f?this._editor.reportStatus(""):this._editor.reportStatus(p.notFound,"error");if(this.isVisible()){c=k.AnnotationType.ANNOTATION_CURRENT_SEARCH;if(h=e.getAnnotationModel())h.removeAnnotations(c),f&&h.addAnnotation(k.AnnotationType.createAnnotation(c,f.start,f.end));if(this._showAll){this._timer&&window.clearTimeout(this._timer);var q=this;this._timer=window.setTimeout(function(){q._markAllOccurrences();
q._timer=null},500)}}this._findCallback?this._findCallback(f):f&&e.moveSelection(f.start,f.end,null,!1)}return f},_doReplace:function(b,a,c,d){var e=this._editor;this._regex&&(d=e.getText(b,a).replace(RegExp(c,this._caseInsensitive?"i":""),d));e.setText(d,b,a);e.setSelection(b,b+d.length,!0)},_markAllOccurrences:function(){var b=this._editor.getAnnotationModel();if(b){for(var a=k.AnnotationType.ANNOTATION_MATCHING_SEARCH,c=b.getAnnotations(),d=[],e;c.hasNext();){var f=c.next();f.type===a&&d.push(f)}if(this.isVisible()){c=
this.getFindString();c=this._editor.getModel().find({string:c,regex:this._regex,wholeWord:this._wholeWord,caseInsensitive:this._caseInsensitive});for(e=[];c.hasNext();)f=c.next(),e.push(k.AnnotationType.createAnnotation(a,f.start,f.end))}b.replaceAnnotations(d,e)}},_removeAllAnnotations:function(){var b=this._editor.getAnnotationModel();b&&(b.removeAnnotations(k.AnnotationType.ANNOTATION_CURRENT_SEARCH),b.removeAnnotations(k.AnnotationType.ANNOTATION_MATCHING_SEARCH))},_removeCurrentAnnotation:function(b){(b=
this._editor.getAnnotationModel())&&b.removeAnnotations(k.AnnotationType.ANNOTATION_CURRENT_SEARCH)}};c.Find=h;return c});
define("orion/editor/findUI",["i18n!orion/editor/nls/messages","orion/editor/find","orion/objects","orion/editor/util","orion/util"],function(p,s,q,k,d){function f(d,f,h){s.Find.call(this,d,f,h)}f.prototype=new s.Find;q.mixin(f.prototype,{getFindString:function(){var d=this._findInput;return!d?s.Find.prototype.getFindString.call(this):d.value},getReplaceString:function(){var d=this._replaceInput;return!d?s.Find.prototype.getReplaceString(this):d.value},hide:function(){var d=this.isVisible();s.Find.prototype.hide.call(this);
d&&(this._rootDiv.className="textViewFind")},show:function(d){s.Find.prototype.show.call(this,d);var f=d.findString;d=d.replaceString;var h=this._findInput;h||(this._create(),h=this._findInput);f&&(h.value=f);d&&(this._replaceInput.value=d);var c=this;window.setTimeout(function(){c._rootDiv.className="textViewFind show";h.select();h.focus()},0)},_create:function(){var e=this,f=this._editor.getTextView(),h=f.getOptions("parent").ownerDocument,c=d.createElement(h,"div");c.className="textViewFind";k.addEventListener(c,
"keydown",function(b){e._handleKeyDown(b)});this._rootDiv=c;this._createContents(h,c);f._rootDiv.insertBefore(c,f._rootDiv.firstChild)},_createContents:function(e,f){var h=this,c=d.createElement(e,"input");c.className="textViewFindInput";this._findInput=c;c.type="text";c.placeholder=p.findWith;k.addEventListener(c,"input",function(b){return h._handleInput(b)});f.appendChild(c);c=d.createElement(e,"span");h._createButton(e,c,p.next,function(){h.find(!0)});h._createButton(e,c,p.previous,function(){h.find(!1)});
f.appendChild(c);h._editor.getTextView().getOptions("readonly")||(c=d.createElement(e,"input"),c.className="textViewReplaceInput",this._replaceInput=c,c.type="text",c.placeholder=p.replaceWith,f.appendChild(c),c=d.createElement(e,"span"),h._createButton(e,c,p.replace,function(){h.replace()}),h._createButton(e,c,p.replaceAll,function(){h.replaceAll()}),f.appendChild(c));c=d.createElement(e,"span");h._createButton(e,c,p.regex,function(b){h._toggle("regex",b.target)},this._regex,p.regexTooltip);h._createButton(e,
c,p.caseInsensitive,function(b){h._toggle("caseInsensitive",b.target)},this._caseInsensitive,p.caseInsensitiveTooltip);h._createButton(e,c,p.wholeWord,function(b){h._toggle("wholeWord",b.target)},this._wholeWord,p.wholeWordTooltip);f.appendChild(c);c=h._createButton(e,f,"",function(){h.hide()});c.className="textViewFindCloseButton";c.title=p.closeTooltip},_createButton:function(d,f,h,c,b,a){var m=d.createElement("button");this._checked(b,m);a&&(m.title=a);k.addEventListener(m,"click",function(a){c.call(this,
a)},!1);h&&m.appendChild(d.createTextNode(h));f.appendChild(m);return m},_toggle:function(d,f){var h={};h[d]=!this["_"+d];this.setOptions(h);this._checked(h[d],f)},_checked:function(d,f){f.className="textViewFindButton";d&&(f.className+=" checked")},_handleInput:function(){this._incremental&&this.find(!0,null,!0);return!0},_handleKeyDown:function(e){var f,h=(d.isMac?e.metaKey:e.ctrlKey)&&!e.altKey&&!e.shiftKey;h&&70===e.keyCode&&(f=!0);if((d.isMac?e.metaKey:e.ctrlKey)&&!e.altKey&&75===e.keyCode||
13===e.keyCode)13===e.keyCode?this.find(this._reverse?e.shiftKey:!e.shiftKey):this.find(!e.shiftKey),f=!0;h&&82===e.keyCode&&(this.replace(),f=!0);27===e.keyCode&&(this.hide(),f=!0);return f?(e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,!1):!0}});return{FindUI:f}});
define("orion/editor/actions","i18n!orion/editor/nls/messages orion/keyBinding orion/editor/annotations orion/editor/tooltip orion/editor/find orion/editor/findUI orion/util".split(" "),function(p,s,q,k,d,f,e){function l(a,b,c){this.editor=a;this.undoStack=b;this._incrementalFind=new d.IncrementalFind(a);this._find=c?c:new f.FindUI(a,b);this._lastEditLocation=null;this.init()}function h(a,b,c,d){this.editor=a;this.undoStack=b;this.contentAssist=c;this.linkedMode=d;this.contentAssist&&this.contentAssist.addEventListener("ProposalApplied",
this.contentAssistProposalApplied.bind(this));this.init()}var c=q.AnnotationType,b={};l.prototype={init:function(){var a=this.editor.getTextView();this._lastEditListener={onModelChanged:function(a){this.editor.isDirty()&&(this._lastEditLocation=a.start+a.addedCharCount)}.bind(this)};a.addEventListener("ModelChanged",this._lastEditListener.onModelChanged);a.setAction("undo",function(a){if(this.undoStack){var b=1;a&&a.count&&(b=a.count);for(;0<b;)this.undoStack.undo(),--b;return!0}return!1}.bind(this),
{name:p.undo});a.setAction("redo",function(a){if(this.undoStack){var b=1;a&&a.count&&(b=a.count);for(;0<b;)this.undoStack.redo(),--b;return!0}return!1}.bind(this),{name:p.redo});a.setKeyBinding(new s.KeyBinding("f",!0),"find");a.setAction("find",function(){if(this._find){var a=this.editor.getSelection();this._find.show({findString:this.editor.getText(a.start,a.end)});return!0}return!1}.bind(this),{name:p.find});a.setKeyBinding(new s.KeyBinding("k",!0),"findNext");a.setAction("findNext",function(a){return this._find?
(this._find.find(!0,a),!0):!1}.bind(this),{name:p.findNext});a.setKeyBinding(new s.KeyBinding("k",!0,!0),"findPrevious");a.setAction("findPrevious",function(a){return this._find?(this._find.find(!1,a),!0):!1}.bind(this),{name:p.findPrevious});a.setKeyBinding(new s.KeyBinding("j",!0),"incrementalFind");a.setAction("incrementalFind",function(){this._incrementalFind&&this._incrementalFind.find(!0);return!0}.bind(this),{name:p.incrementalFind});a.setKeyBinding(new s.KeyBinding("j",!0,!0),"incrementalFindReverse");
a.setAction("incrementalFindReverse",function(){this._incrementalFind&&this._incrementalFind.find(!1);return!0}.bind(this),{name:p.incrementalFindReverse});a.setAction("tab",function(){return this.indentLines()}.bind(this));a.setAction("shiftTab",function(){return this.unindentLines()}.bind(this),{name:p.unindentLines});a.setKeyBinding(new s.KeyBinding(38,!1,!1,!0),"moveLinesUp");a.setAction("moveLinesUp",function(){return this.moveLinesUp()}.bind(this),{name:p.moveLinesUp});a.setKeyBinding(new s.KeyBinding(40,
!1,!1,!0),"moveLinesDown");a.setAction("moveLinesDown",function(){return this.moveLinesDown()}.bind(this),{name:p.moveLinesDown});a.setKeyBinding(new s.KeyBinding(38,!0,!1,!0),"copyLinesUp");a.setAction("copyLinesUp",function(){return this.copyLinesUp()}.bind(this),{name:p.copyLinesUp});a.setKeyBinding(new s.KeyBinding(40,!0,!1,!0),"copyLinesDown");a.setAction("copyLinesDown",function(){return this.copyLinesDown()}.bind(this),{name:p.copyLinesDown});a.setKeyBinding(new s.KeyBinding("d",!0,!1,!1),
"deleteLines");a.setAction("deleteLines",function(a){return this.deleteLines(a)}.bind(this),{name:p.deleteLines});a.setKeyBinding(new s.KeyBinding("l",!e.isMac,!1,!1,e.isMac),"gotoLine");a.setAction("gotoLine",function(){return this.gotoLine()}.bind(this),{name:p.gotoLine});a.setKeyBinding(new s.KeyBinding(190,!0),"nextAnnotation");a.setAction("nextAnnotation",function(){return this.nextAnnotation(!0)}.bind(this),{name:p.nextAnnotation});a.setKeyBinding(new s.KeyBinding(188,!0),"previousAnnotation");
a.setAction("previousAnnotation",function(){return this.nextAnnotation(!1)}.bind(this),{name:p.prevAnnotation});a.setKeyBinding(new s.KeyBinding("e",!0,!1,!0,!1),"expand");a.setAction("expand",function(){return this.expandAnnotation(!0)}.bind(this),{name:p.expand});a.setKeyBinding(new s.KeyBinding("c",!0,!1,!0,!1),"collapse");a.setAction("collapse",function(){return this.expandAnnotation(!1)}.bind(this),{name:p.collapse});a.setKeyBinding(new s.KeyBinding("e",!0,!0,!0,!1),"expandAll");a.setAction("expandAll",
function(){return this.expandAnnotations(!0)}.bind(this),{name:p.expandAll});a.setKeyBinding(new s.KeyBinding("c",!0,!0,!0,!1),"collapseAll");a.setAction("collapseAll",function(){return this.expandAnnotations(!1)}.bind(this),{name:p.collapseAll});a.setKeyBinding(new s.KeyBinding("q",!e.isMac,!1,!1,e.isMac),"lastEdit");a.setAction("lastEdit",function(){return this.gotoLastEdit()}.bind(this),{name:p.lastEdit})},copyLinesDown:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;
var b=a.getModel(),c=a.getSelection(),d=b.getLineAtOffset(c.start),c=b.getLineAtOffset(c.end>c.start?c.end-1:c.end),e=b.getLineStart(d),d=b.getLineEnd(c,!0),f=b.getLineCount(),h="",e=b.getText(e,d);c===f-1&&(e=(h=b.getLineDelimiter())+e);a.setText(e,d,d);a.setSelection(d+h.length,d+e.length);return!0},copyLinesUp:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var b=a.getModel(),c=a.getSelection(),d=b.getLineAtOffset(c.start),c=b.getLineAtOffset(c.end>c.start?c.end-
1:c.end),d=b.getLineStart(d),e=b.getLineEnd(c,!0),f=b.getLineCount(),h="",e=b.getText(d,e);c===f-1&&(e+=h=b.getLineDelimiter());a.setText(e,d,d);a.setSelection(d,d+e.length-h.length);return!0},deleteLines:function(a){var b=this.editor;if(b.getTextView().getOptions("readonly"))return!1;var c=1;a&&a.count&&(c=a.count);var d=b.getSelection(),e=b.getModel(),f=e.getLineAtOffset(d.start);a=e.getLineStart(f);c=d.start!==d.end||1===c?e.getLineAtOffset(d.end>d.start?d.end-1:d.end):Math.min(f+c-1,e.getLineCount()-
1);c=e.getLineEnd(c,!0);b.setText("",a,c);return!0},expandAnnotation:function(a){var b=this.editor,c=b.getAnnotationModel();if(!c)return!0;var d=b.getModel(),e=b.getCaretOffset(),f=d.getLineAtOffset(e),e=d.getLineStart(f),f=d.getLineEnd(f,!0);d.getBaseModel&&(e=d.mapOffset(e),f=d.mapOffset(f),d.getBaseModel());for(var h,c=c.getAnnotations(e,f);!h&&c.hasNext();)d=c.next(),d.type===q.AnnotationType.ANNOTATION_FOLDING&&(h=d);h&&a!==h.expanded&&(a?h.expand():(b.setCaretOffset(h.start),h.collapse()));
return!0},expandAnnotations:function(a){var b=this.editor,c=b.getTextView(),b=b.getAnnotationModel();if(!b)return!0;var d=b.getAnnotations();for(c.setRedraw(!1);d.hasNext();)b=d.next(),b.type===q.AnnotationType.ANNOTATION_FOLDING&&a!==b.expanded&&(a?b.expand():b.collapse());c.setRedraw(!0);return!0},indentLines:function(){var a=this.editor,b=a.getTextView();if(b.getOptions("readonly"))return!1;if(b.getOptions("tabMode")){var c=a.getModel(),d=a.getSelection(),e=c.getLineAtOffset(d.start),f=c.getLineAtOffset(d.end>
d.start?d.end-1:d.end);if(e!==f){var h=[];h.push("");for(var l=e;l<=f;l++)h.push(c.getLine(l,!0));l=c.getLineStart(e);c=c.getLineEnd(f,!0);b=b.getOptions("tabSize","expandTab");b=b.expandTab?Array(b.tabSize+1).join(" "):"\t";a.setText(h.join(b),l,c);a.setSelection(l===d.start?d.start:d.start+b.length,d.end+(f-e+1)*b.length);return!0}return!1}},gotoLastEdit:function(){"number"===typeof this._lastEditLocation&&this.editor.showSelection(this._lastEditLocation);return!0},gotoLine:function(){var a=this.editor,
b=a.getModel().getLineAtOffset(a.getCaretOffset());if(b=prompt(p.gotoLinePrompty,b+1))b=parseInt(b,10),a.onGotoLine(b-1,0);return!0},moveLinesDown:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var b=a.getModel(),c=a.getSelection(),d=b.getLineAtOffset(c.start),e=b.getLineAtOffset(c.end>c.start?c.end-1:c.end),f=b.getLineCount();if(e===f-1)return!0;var d=b.getLineStart(d),c=b.getLineEnd(e,!0),h=b.getLineEnd(e+1,!0)-(c-d),l=0;e!==f-2?b=b.getText(d,c):(e=b.getLineEnd(e),
b=b.getText(e,c)+b.getText(d,e),l+=c-e);this.startUndo();a.setText("",d,c);a.setText(b,h,h);a.setSelection(h+l,h+l+b.length);this.endUndo();return!0},moveLinesUp:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var b=a.getModel(),c=a.getSelection(),d=b.getLineAtOffset(c.start);if(0===d)return!0;var e=b.getLineAtOffset(c.end>c.start?c.end-1:c.end),f=b.getLineCount(),c=b.getLineStart(d-1),h=b.getLineStart(d),l=b.getLineEnd(e,!0),k=b.getText(h,l),p=0;e===f-1&&(e=b.getLineEnd(d-
1),d=b.getLineEnd(d-1,!0),k+=b.getText(e,d),h=e,p=d-e);this.startUndo();a.setText("",h,l);a.setText(k,c,c);a.setSelection(c,c+k.length-p);this.endUndo();return!0},nextAnnotation:function(a){function b(a){return!!a.lineStyle||a.type===c.ANNOTATION_MATCHING_BRACKET||a.type===c.ANNOTATION_CURRENT_BRACKET||!f.isAnnotationTypeVisible(a.type)}var d=this.editor,e=d.getAnnotationModel();if(!e)return!0;var f=d.getOverviewRuler()||d.getAnnotationStyler();if(!f)return!0;for(var h=d.getModel(),l=d.getCaretOffset(),
p=e.getAnnotations(a?l:0,a?h.getCharCount():l),q=null;p.hasNext();){var s=p.next();if(a){if(s.start<=l)continue}else if(s.start>=l)continue;if(!b(s)&&(q=s,a))break}if(q){for(var z=[q],p=e.getAnnotations(q.start,q.start);p.hasNext();)s=p.next(),s!==q&&!b(s)&&z.push(s);var g=d.getTextView(),r=h.getLineAtOffset(q.start),D=k.Tooltip.getTooltip(g);if(!D)return d.moveSelection(q.start),!0;d.moveSelection(q.start,q.start,function(){D.setTarget({getTooltipInfo:function(){var a=g.convert({x:g.getLocationAtOffset(q.start).x,
y:g.getLocationAtOffset(h.getLineStart(r)).y},"document","page");return{contents:z,x:a.x,y:a.y+Math.floor(1.33*g.getLineHeight(r))}}},0)})}return!0},unindentLines:function(){var a=this.editor,b=a.getTextView();if(b.getOptions("readonly"))return!1;if(b.getOptions("tabMode")){for(var c=a.getModel(),d=a.getSelection(),e=c.getLineAtOffset(d.start),f=c.getLineAtOffset(d.end>d.start?d.end-1:d.end),h=b.getOptions("tabSize"),l=Array(h+1).join(" "),k=[],p=b=0,z=e;z<=f;z++){var g=c.getLine(z,!0);if(c.getLineStart(z)!==
c.getLineEnd(z))if(0===g.indexOf("\t"))g=g.substring(1),b++;else if(0===g.indexOf(l))g=g.substring(h),b+=h;else return!0;z===e&&(p=b);k.push(g)}e=c.getLineStart(e);h=c.getLineEnd(f,!0);c=c.getLineStart(f);a.setText(k.join(""),e,h);f=e===d.start?d.start:d.start-p;d=Math.max(f,d.end-b+(d.end===c+1&&d.start!==d.end?1:0));a.setSelection(f,d);return!0}},startUndo:function(){this.undoStack&&this.undoStack.startCompoundChange()},endUndo:function(){this.undoStack&&this.undoStack.endCompoundChange()}};b.TextActions=
l;h.prototype={init:function(){var a=this.editor.getTextView();a.setAction("lineStart",function(){return this.lineStart()}.bind(this));a.setAction("enter",function(){return this.autoIndent()}.bind(this));a.setKeyBinding(new s.KeyBinding("t",!0,!1,!0),"trimTrailingWhitespaces");a.setAction("trimTrailingWhitespaces",function(){return this.trimTrailingWhitespaces()}.bind(this),{name:p.trimTrailingWhitespaces});a.setKeyBinding(new s.KeyBinding(191,!0),"toggleLineComment");a.setAction("toggleLineComment",
function(){return this.toggleLineComment()}.bind(this),{name:p.toggleLineComment});a.setKeyBinding(new s.KeyBinding(191,!0,!e.isMac,!1,e.isMac),"addBlockComment");a.setAction("addBlockComment",function(){return this.addBlockComment()}.bind(this),{name:p.addBlockComment});a.setKeyBinding(new s.KeyBinding(220,!0,!e.isMac,!1,e.isMac),"removeBlockComment");a.setAction("removeBlockComment",function(){return this.removeBlockComment()}.bind(this),{name:p.removeBlockComment});a.setKeyBinding(new s.KeyBinding("[",
!1,!1,!1,!1,"keypress"),"autoPairSquareBracket");a.setAction("autoPairSquareBracket",function(){return this.autoPairBrackets("[","]")}.bind(this));a.setKeyBinding(new s.KeyBinding("]",!1,!1,!1,!1,"keypress"),"skipClosingSquareBracket");a.setAction("skipClosingSquareBracket",function(){return this.skipClosingBracket("]")}.bind(this));a.setKeyBinding(new s.KeyBinding("\x3c",!1,!1,!1,!1,"keypress"),"autoPairAngleBracket");a.setAction("autoPairAngleBracket",function(){return this.autoPairBrackets("\x3c",
"\x3e")}.bind(this));a.setKeyBinding(new s.KeyBinding("\x3e",!1,!1,!1,!1,"keypress"),"skipClosingAngleBracket");a.setAction("skipClosingAngleBracket",function(){return this.skipClosingBracket("\x3e")}.bind(this));a.setKeyBinding(new s.KeyBinding("(",!1,!1,!1,!1,"keypress"),"autoPairParentheses");a.setAction("autoPairParentheses",function(){return this.autoPairBrackets("(",")")}.bind(this));a.setKeyBinding(new s.KeyBinding(")",!1,!1,!1,!1,"keypress"),"skipClosingParenthesis");a.setAction("skipClosingParenthesis",
function(){return this.skipClosingBracket(")")}.bind(this));a.setKeyBinding(new s.KeyBinding("{",!1,!1,!1,!1,"keypress"),"autoPairBraces");a.setAction("autoPairBraces",function(){return this.autoPairBrackets("{","}")}.bind(this));a.setKeyBinding(new s.KeyBinding("}",!1,!1,!1,!1,"keypress"),"skipClosingBrace");a.setAction("skipClosingBrace",function(){return this.skipClosingBracket("}")}.bind(this));a.setKeyBinding(new s.KeyBinding("'",!1,!1,!1,!1,"keypress"),"autoPairSingleQuotation");a.setAction("autoPairSingleQuotation",
function(){return this.autoPairQuotations("'")}.bind(this));a.setKeyBinding(new s.KeyBinding('"',!1,!1,!1,!1,"keypress"),"autoPairDblQuotation");a.setAction("autoPairDblQuotation",function(){return this.autoPairQuotations('"')}.bind(this));a.setAction("deletePrevious",function(){return this.deletePrevious()}.bind(this))},autoIndent:function(){var a=this.editor,b=a.getTextView();if(b.getOptions("readonly"))return!1;var c=a.getSelection();if(c.start===c.end){for(var d=a.getModel(),e=d.getLineAtOffset(c.start),
f=d.getLine(e,!1),h=d.getLineStart(e),l=0,k=c.start-h,p;l<k&&(32===(p=f.charCodeAt(l))||9===p);)l++;var h=f.substring(0,l),b=b.getOptions("tabSize","expandTab"),z=b.expandTab?Array(b.tabSize+1).join(" "):"\t",b=d.getLineDelimiter(),g=/^[\s]*\/\*[\*]*[\s]*$/,r=/^[\s]*\*/,q=/\*\/[\s]*$/,s=f.substring(0,k),H=f.substring(k),R;if(this.smartIndentation&&123===f.charCodeAt(R=s.trimRight().length-1))return d=k-R-1,H=H.length-H.trimLeft().length,f=125===f.charCodeAt(k+H)?b+h+z+b+h:b+h+z,a.setText(f,c.start-
d,c.end+H),a.setCaretOffset(c.start+b.length+h.length+z.length-d),!0;if(this.autoCompleteComments&&!q.test(s)&&(g.test(s)||r.test(s))){if(l=g.exec(s)){f=b+h+" * ";f=q.test(H)?f+H.substring(0,H.length-2).trim():f+H.trim();if(d.getLineCount()===e+1||!r.test(d.getLine(e+1)))f+=b+h+" */";a.setText(f,c.start,c.end+H.length);a.setCaretOffset(c.start+b.length+h.length+3);return!0}if(l=r.exec(s))for(e-=1;0<=e;e--){l=d.getLine(e,!1);if(g.test(l))return q.test(H)||47===f.charCodeAt(k)?(f=b+h+"*"+H,h=c.start+
b.length+h.length+1):(f=b+h+"* "+H,h=c.start+b.length+h.length+2),a.setText(f,c.start,c.end+H.length),a.setCaretOffset(h),!0;if(!r.test(l))break}}else{if(q.test(s)&&32===h.charCodeAt(h.length-1))return f=b+h.substring(0,h.length-1),a.setText(f,c.start,c.end),a.setCaretOffset(c.start+f.length),!0;if(0<l){for(l=k;l<f.length&&(32===(p=f.charCodeAt(l++))||9===p);)c.end++;a.setText(d.getLineDelimiter()+h,c.start,c.end);return!0}}}return!1},addBlockComment:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;
var b=a.getModel(),c=a.getSelection(),d=this._findEnclosingComment(b,c.start,c.end);if(void 0!==d.commentStart&&void 0!==d.commentEnd)return!0;b=b.getText(c.start,c.end);if(0===b.length)return!0;var d=b.length,b=b.replace(/\/\*|\*\//g,""),e=b.length;a.setText("/*"+b+"*/",c.start,c.end);a.setSelection(c.start+2,c.end+2+(e-d));return!0},autoPairBrackets:function(a,b){if("["===a&&!this.autoPairSquareBrackets||"{"===a&&!this.autoPairBraces||"("===a&&!this.autoPairParentheses||"\x3c"===a&&!this.autoPairAngleBrackets)return!1;
var c=this.editor;if(c.getTextView().getOptions("readonly"))return!1;var d=c.getSelection(),e=c.getModel(),f=c.getCaretOffset()===e.getCharCount()?"":e.getText(d.start,d.start+1).trim(),h=/^$|[)}\]>]/;return d.start===d.end&&h.test(f)?(c.setText(a+b,d.start,d.start),c.setCaretOffset(d.start+1),!0):d.start!==d.end?(e=e.getText(d.start,d.end),c.setText(a+e+b,d.start,d.end),c.setSelection(d.start+1,d.end+1),!0):!1},autoPairQuotations:function(a){if(!this.autoPairQuotation)return!1;var b=this.editor;
if(b.getTextView().getOptions("readonly"))return!1;var c=b.getSelection(),d=b.getModel(),e=b.getCaretOffset(),f=0===e?"":d.getText(c.start-1,c.start).trim(),h=e===d.getCharCount()?"":d.getText(c.start,c.start+1).trim(),e=/^"$|^'$/,l=/\w/,k=/^$|[)}\]>]/;if(c.start!==c.end){d=d.getText(c.start,c.end);if(e.test(d))return!1;b.setText(a+d+a,c.start,c.end);b.setSelection(c.start+1,c.end+1)}else{if(h!==a){if(f===a||e.test(h)||l.test(f)||!k.test(h))return!1;b.setText(a+a,c.start,c.start)}b.setCaretOffset(c.start+
1)}return!0},contentAssistProposalApplied:function(a){a=a.data.proposal;if(a.positions&&0<a.positions.length&&this.linkedMode){for(var b=[],c=0;c<a.positions.length;++c)b[c]={positions:[{offset:a.positions[c].offset,length:a.positions[c].length}]};this.linkedMode.enterLinkedMode({groups:b,escapePosition:a.escapePosition})}else a.groups&&0<a.groups.length&&this.linkedMode?this.linkedMode.enterLinkedMode({groups:a.groups,escapePosition:a.escapePosition}):a.escapePosition&&this.editor.getTextView().setCaretOffset(a.escapePosition);
return!0},deletePrevious:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var b=a.getSelection();if(b.start!==b.end)return!1;var c=a.getModel(),d=a.getCaretOffset(),e=0===d?"":c.getText(b.start-1,b.start),c=d===c.getCharCount()?"":c.getText(b.start,b.start+1);("("===e&&")"===c||"["===e&&"]"===c||"{"===e&&"}"===c||"\x3c"===e&&"\x3e"===c||'"'===e&&'"'===c||"'"===e&&"'"===c)&&a.setText("",b.start,b.start+1);return!1},_findEnclosingComment:function(a,b,c){var d=a.getLineAtOffset(b),
e=a.getLineAtOffset(c),f,h,l,k,p,z;for(f=d;0<=f&&!(h=a.getLine(f),l=f===d?b-a.getLineStart(d):h.length,k=h.lastIndexOf("/*",l),h=h.lastIndexOf("*/",l),h>k);f--)if(-1!==k){p=a.getLineStart(f)+k;break}for(f=e;f<a.getLineCount()&&!(h=a.getLine(f),l=f===e?c-a.getLineStart(e):0,k=h.indexOf("/*",l),h=h.indexOf("*/",l),-1!==k&&k<h);f++)if(-1!==h){z=a.getLineStart(f)+h;break}return{commentStart:p,commentEnd:z}},lineStart:function(){for(var a=this.editor,b=a.getModel(),c=a.getCaretOffset(),d=b.getLineAtOffset(c),
e=b.getLineStart(d),b=b.getLine(d),d=0;d<b.length;d++){var f=b.charCodeAt(d);if(!(32===f||9===f))break}d+=e;return c!==d?(a.setSelection(d,d),!0):!1},removeBlockComment:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var b=a.getModel(),c=a.getSelection(),d=b.getText(c.start,c.end),e,f,h;for(h=0;h<d.length;h++)if("/*"===d.substring(h,h+2)){e=c.start+h;break}for(;h<d.length;h++)if("*/"===d.substring(h,h+2)){f=c.start+h;break}if(void 0!==e&&void 0!==f)a.setText(b.getText(e+
2,f),e,f+2),a.setSelection(e,f);else{d=this._findEnclosingComment(b,c.start,c.end);if(void 0===d.commentStart||void 0===d.commentEnd)return!0;b=b.getText(d.commentStart+2,d.commentEnd);a.setText(b,d.commentStart,d.commentEnd+2);a.setSelection(c.start-2,c.end-2)}return!0},toggleLineComment:function(){var a=this.editor,b=a.getTextView();if(b.getOptions("readonly"))return!1;for(var c=this.lineComment||"//",d=a.getModel(),e=a.getSelection(),f=d.getLineAtOffset(e.start),h=d.getLineAtOffset(e.end>e.start?
e.end-1:e.end),l=!0,k=[],p,z=f;z<=h;z++){var g=d.getLine(z,!0);p=g.indexOf(c);k.push(p);if(!l||-1===p)l=!1;else if(0!==p){for(l=0;l<p;l++){var r=g.charCodeAt(l);if(!(32===r||9===r))break}l=l===p}}z=c.length;g=d.getLineStart(f);b.setRedraw(!1);this.startUndo();if(l){for(l=k.length-1;0<=l;l--)p=k[l]+d.getLineStart(f+l),a.setText("",p,p+z);d=d.getLineStart(h);c=g===e.start?e.start:e.start-z;e=e.end-z*(h-f+1)+(e.end===d+1?z:0)}else{for(l=k.length-1;0<=l;l--)p=d.getLineStart(f+l),a.setText(c,p,p);c=g===
e.start?e.start:e.start+z;e=e.end+z*(h-f+1)}this.endUndo();b.setRedraw(!0);a.setSelection(c,e);return!0},trimTrailingWhitespaces:function(){var a=this.editor,b=a.getModel(),c=a.getSelection();a.getTextView().setRedraw(!1);a.getUndoStack().startCompoundChange();for(var d=/(\s+$)/,e=b.getLineCount(),f=0;f<e;f++){var h=b.getLine(f),l=d.exec(h);if(l){var k=b.getLineStart(f),h=l[0].length,l=k+l.index;b.setText("",l,l+h);c.start>l&&(c.start=Math.max(l,c.start-h));c.start!==c.end&&c.end>l&&(c.end=Math.max(l,
c.end-h))}}a.getUndoStack().endCompoundChange();a.getTextView().setRedraw(!0);a.setSelection(c.start,c.end,!1)},startUndo:function(){this.undoStack&&this.undoStack.startCompoundChange()},skipClosingBracket:function(a){var b=this.editor;if(b.getTextView().getOptions("readonly"))return!1;var c=b.getSelection(),d=b.getModel();return(b.getCaretOffset()===d.getCharCount()?"":d.getText(c.start,c.start+1))===a?(b.setCaretOffset(c.start+1),!0):!1},endUndo:function(){this.undoStack&&this.undoStack.endCompoundChange()},
setAutoPairParentheses:function(a){this.autoPairParentheses=a},setAutoPairBraces:function(a){this.autoPairBraces=a},setAutoPairSquareBrackets:function(a){this.autoPairSquareBrackets=a},setAutoPairAngleBrackets:function(a){this.autoPairAngleBrackets=a},setAutoPairQuotations:function(a){this.autoPairQuotation=a},setAutoCompleteComments:function(a){this.autoCompleteComments=a},setLineComment:function(a){this.lineComment=a},setSmartIndentation:function(a){this.smartIndentation=a}};b.SourceCodeActions=
h;String.prototype.trimLeft||(String.prototype.trimLeft=function(){return this.replace(/^\s+/g,"")});String.prototype.trimRight||(String.prototype.trimRight=function(){return this.replace(/\s+$/g,"")});return b});
define("orion/editor/templates",[],function(){function p(p,k,d,f){this.prefix=p;this.description=k;this.template=d;this.name=f;this._parse()}function s(p,k){this._keywords=p||[];this._templates=[];this.addTemplates(k||[])}p.prototype={getProposal:function(p,k,d){p=k-p.length;k={};var f,e=void 0!==d.delimiter?d.delimiter:"\n";d.indentation&&(e+=d.indentation);var l=void 0!==d.tab?d.tab:"\t",h=0,c=this.variables,b=this.segments;d=[];for(var a=0;a<b.length;a++){var m=b[a],t=c[m];if(void 0!==t)switch(m){case "${tab}":m=
l;break;case "${delimiter}":m=e;break;case "${cursor}":m="";f=h;break;default:var n=k[m];n||(n=k[m]={data:t.data,positions:[]});m=t.substitution;n.data&&n.data.values&&(m=n.data.values[0]);n.positions.push({offset:p+h,length:m.length})}d.push(m);h+=m.length}var e=[],u;for(u in k)k.hasOwnProperty(u)&&e.push(k[u]);d=d.join("");void 0===f&&(f=d.length);return{proposal:d,name:this.name,description:this.description,groups:e,escapePosition:p+f,style:"noemphasis"}},match:function(p){return 0===this.prefix.indexOf(p)},
_parse:function(){var p=this.template,k=[],d={},f,e=0,p=p.replace(/\n/g,"${delimiter}"),p=p.replace(/\t/g,"${tab}");p.replace(/\$\{((?:[^\\}]+|\\.))*\}/g,function(l,h,c){var b=l.substring(2,l.length-1);h=l;var a=b,m=null,t=a.indexOf(":");-1!==t&&(a=a.substring(0,t),h="${"+a+"}",m=JSON.parse(b.substring(t+1).replace("\\}","}").trim()));(b=d[h])||(b=d[h]={});b.substitution=a;m&&(b.data=m);(f=p.substring(e,c))&&k.push(f);k.push(h);e=c+l.length;return a});(f=p.substring(e,p.length))&&k.push(f);this.segments=
k;this.variables=d}};s.prototype={addTemplates:function(q){for(var k=this.getTemplates(),d=0;d<q.length;d++)k.push(new p(q[d].prefix,q[d].description,q[d].template,q[d].name))},computeProposals:function(p,k,d){var f=this.getPrefix(p,k,d),e=[];this.isValid(f,p,k,d)&&(e=e.concat(this.getTemplateProposals(f,k,d)),e=e.concat(this.getKeywordProposals(f)));return e},getKeywords:function(){return this._keywords},getKeywordProposals:function(p){var k=[],d=this.getKeywords();if(d){for(var f=0;f<d.length;f++)0===
d[f].indexOf(p)&&k.push({proposal:d[f].substring(p.length),description:d[f],style:"noemphasis_keyword"});0<k.length&&k.splice(0,0,{proposal:"",description:"Keywords",style:"noemphasis_title_keywords",unselectable:!0})}return k},getPrefix:function(p,k,d){return d.prefix},getTemplates:function(){return this._templates},getTemplateProposals:function(p,k,d){for(var f=[],e=this.getTemplates(),l=0;l<e.length;l++){var h=e[l];h.match(p)&&(h=h.getProposal(p,k,d),this.removePrefix(p,h),f.push(h))}0<f.length&&
(f.sort(function(c,b){return c.name<b.name?-1:c.name>b.name?1:0}),f.splice(0,0,{proposal:"",description:"Templates",style:"noemphasis_title",unselectable:!0}));return f},removePrefix:function(p,k){if(!(k.overwrite=k.proposal.substring(0,p.length)!==p))k.proposal=k.proposal.substring(p.length)},isValid:function(p,k,d,f){return!0}};return{Template:p,TemplateContentAssist:s}});
define("orion/editor/linkedMode","i18n!orion/editor/nls/messages orion/keyBinding orion/editor/keyModes orion/editor/annotations orion/editor/templates orion/objects orion/util".split(" "),function(p,s,q,k,d,f){function e(d,c,b){var a=d.getTextView();q.KeyMode.call(this,a);this.editor=d;this.undoStack=c;this.contentAssist=b;this.linkedModeModel=null;a.setAction("linkedModeEnter",function(){this.exitLinkedMode(!0);return!0}.bind(this));a.setAction("linkedModeCancel",function(){this.exitLinkedMode(!1);
return!0}.bind(this));a.setAction("linkedModeNextGroup",function(){var a=this.linkedModeModel;this.selectLinkedGroup((a.selectedGroupIndex+1)%a.groups.length);return!0}.bind(this));a.setAction("linkedModePreviousGroup",function(){var a=this.linkedModeModel;this.selectLinkedGroup(0<a.selectedGroupIndex?a.selectedGroupIndex-1:a.groups.length-1);return!0}.bind(this));this.linkedModeListener={onActivating:function(a){this._groupContentAssistProvider&&(this.contentAssist.setProviders([this._groupContentAssistProvider]),
this.contentAssist.setProgress(null))}.bind(this),onModelChanged:function(a){if(!this.ignoreVerify){for(var b=this.editor.mapOffset(a.start),c=this.linkedModeModel,d,e;c;)if(d=this._getPositionChanged(c,b,b+a.removedCharCount),e=d.position,void 0===e||e.model!==c)this.exitLinkedMode(!1),c=this.linkedModeModel;else break;if(c){c=0;a=a.addedCharCount-a.removedCharCount;d=d.positions;for(var f,h=0;h<d.length;++h){f=d[h];e=f.position;var l=e.offset<=b&&b<=e.offset+e.length;l&&!f.ansestor?(e.offset+=c,
e.length+=a,c+=a):(e.offset+=c,f.ansestor&&l&&(e.length+=a));f.escape&&(f.model.escapePosition=e.offset)}this._updateAnnotations(d)}}}.bind(this),onVerify:function(a){if(!this.ignoreVerify){for(var b=this.editor,c=b.mapOffset(a.start),d=this.editor.mapOffset(a.end),e=this.linkedModeModel,f,h;e;)if(f=this._getPositionChanged(e,c,d),h=f.position,void 0===h||h.model!==e)this.exitLinkedMode(!1),e=this.linkedModeModel;else break;if(e){var l=this._compoundChange;l?l.owner.model===e&&l.owner.group===h.group||
(this.endUndo(),this.startUndo()):this.startUndo();e.selectedGroupIndex=h.group;var l=0,k=a.text.length-(d-c);f=f.positions;for(var p,c=c-h.position.offset,g=d-h.position.offset,r=0;r<f.length;++r)p=f[r],d=p.position,p.oldOffset=d.offset,p.model===e&&p.group===h.group?(d.offset+=l,d.length+=k,l+=k):(d.offset+=l,p.ansestor&&(d.length+=h.count*k)),p.escape&&(p.model.escapePosition=d.offset);this.ignoreVerify=!0;for(r=f.length-1;0<=r;r--)p=f[r],p.model===e&&p.group===h.group&&b.setText(a.text,p.oldOffset+
c,p.oldOffset+g);this.ignoreVerify=!1;a.text=null;this._updateAnnotations(f)}}}.bind(this)}}var l={};e.prototype=new q.KeyMode;f.mixin(e.prototype,{createKeyBindings:function(){var d=s.KeyBinding,c=[];c.push({actionID:"linkedModeEnter",keyBinding:new d(13)});c.push({actionID:"linkedModeCancel",keyBinding:new d(27)});c.push({actionID:"linkedModeNextGroup",keyBinding:new d(9)});c.push({actionID:"linkedModePreviousGroup",keyBinding:new d(9,!1,!0)});return c},enterLinkedMode:function(d){if(!this.linkedModeModel){var c=
this.editor.getTextView();c.addKeyMode(this);c.addEventListener("Verify",this.linkedModeListener.onVerify);c.addEventListener("ModelChanged",this.linkedModeListener.onModelChanged);this.contentAssist.addEventListener("Activating",this.linkedModeListener.onActivating);this.editor.reportStatus(p.linkedModeEntered,null,!0)}this._sortedPositions=null;this.linkedModeModel&&(d.previousModel=this.linkedModeModel,d.parentGroup=this.linkedModeModel.selectedGroupIndex,this.linkedModeModel.nextModel=d);this.linkedModeModel=
d;this.selectLinkedGroup(0)},exitLinkedMode:function(d){if(this.isActive()){this._compoundChange&&(this.endUndo(),this._compoundChange=null);this._sortedPositions=null;var c=this.linkedModeModel;this.linkedModeModel=c.previousModel;c.parentGroup=c.previousModel=void 0;this.linkedModeModel&&(this.linkedModeModel.nextModel=void 0);if(!this.linkedModeModel){var b=this.editor,a=b.getTextView();a.removeKeyMode(this);a.removeEventListener("Verify",this.linkedModeListener.onVerify);a.removeEventListener("ModelChanged",
this.linkedModeListener.onModelChanged);a=this.contentAssist;a.removeEventListener("Activating",this.linkedModeListener.onActivating);a.offset=void 0;this.editor.reportStatus(p.linkedModeExited,null,!0);d&&b.setCaretOffset(c.escapePosition,!1)}this.selectLinkedGroup(0)}},startUndo:function(){if(this.undoStack){var d=this,c=this.linkedModeModel;this._compoundChange=this.undoStack.startCompoundChange({model:c,group:c.selectedGroupIndex,end:function(){d._compoundChange=null}})}},endUndo:function(){this.undoStack&&
this.undoStack.endCompoundChange()},isActive:function(){return!!this.linkedModeModel},isStatusActive:function(){return!!this.linkedModeModel},selectLinkedGroup:function(e){var c=this.linkedModeModel;if(c){c.selectedGroupIndex=e;e=c.groups[e];var b=e.positions[0],a=this.editor;a.setSelection(b.offset,b.offset+b.length);if(c=this.contentAssist)c.offset=void 0,e.data&&"link"===e.data.type&&e.data.values?((this._groupContentAssistProvider=new d.TemplateContentAssist(e.data.values)).getPrefix=function(){var c=
a.getSelection();return c.start===c.end&&(c=a.getCaretOffset(),b.offset<=c&&c<=b.offset+b.length)?a.getText(b.offset,c):""},c.offset=b.offset,c.deactivate(),c.activate()):this._groupContentAssistProvider&&(this._groupContentAssistProvider=null,c.deactivate())}this._updateAnnotations()},_getModelPositions:function(d,c,b){for(var a=c.groups,e=0;e<a.length;e++)for(var f=a[e].positions,n=0;n<f.length;n++){var l=f[n];b&&(l={offset:l.offset+b,length:l.length});l={index:n,group:e,count:f.length,model:c,
position:l};d.push(l);c.nextModel&&c.nextModel.parentGroup===e&&(l.ansestor=!0,this._getModelPositions(d,c.nextModel,(b||0)+f[n].offset-f[0].offset))}},_getSortedPositions:function(d){var c=this._sortedPositions;if(!c){for(c=[];d.previousModel;)d=d.previousModel;for(this._getModelPositions(c,d);d;)void 0!==d.escapePosition&&c.push({escape:!0,model:d,position:{offset:d.escapePosition,length:0}}),d=d.nextModel;c.sort(function(b,a){return b.position.offset-a.position.offset});this._sortedPositions=c}return c},
_getPositionChanged:function(d,c,b){var a;d=this._getSortedPositions(d);for(var e=d.length-1;0<=e;e--){var f=d[e].position;if(f.offset<=c&&b<=f.offset+f.length){a=d[e];break}}return{position:a,positions:d}},_updateAnnotations:function(d){var c=this.editor.getAnnotationModel();if(c){var b=[],a=[];c.getTextModel();for(var e=c.getAnnotations(),f;e.hasNext();)switch(f=e.next(),f.type){case k.AnnotationType.ANNOTATION_LINKED_GROUP:case k.AnnotationType.ANNOTATION_CURRENT_LINKED_GROUP:case k.AnnotationType.ANNOTATION_SELECTED_LINKED_GROUP:b.push(f)}if(e=
this.linkedModeModel){d=d||this._getSortedPositions(e);for(var n=0;n<d.length;n++)if(f=d[n],f.model===e){var l=k.AnnotationType.ANNOTATION_LINKED_GROUP;f.group===e.selectedGroupIndex&&(l=0===f.index?k.AnnotationType.ANNOTATION_SELECTED_LINKED_GROUP:k.AnnotationType.ANNOTATION_CURRENT_LINKED_GROUP);f=f.position;f=k.AnnotationType.createAnnotation(l,f.offset,f.offset+f.length,"");a.push(f)}}c.replaceAnnotations(b,a)}}});l.LinkedMode=e;return l});
define("orion/editor/factories","orion/editor/actions orion/editor/undoStack orion/editor/rulers orion/editor/annotations orion/editor/textDND orion/editor/linkedMode".split(" "),function(p,s,q,k,d,f){function e(){}function l(){}function h(){}function c(){}function b(){}function a(){}var m={};e.prototype={createKeyBindings:function(a,b,c,d){d=new p.TextActions(a,b,d);var e=new f.LinkedMode(a,b,c);a=new p.SourceCodeActions(a,b,c,e);return{textActions:d,linkedMode:e,sourceCodeActions:a}}};m.KeyBindingsFactory=
e;l.prototype={createUndoStack:function(a){a=a.getTextView();return new s.UndoStack(a,200)}};m.UndoFactory=l;h.prototype={createLineNumberRuler:function(a){return new q.LineNumberRuler(a,"left",{styleClass:"ruler lines"},{styleClass:"rulerLines odd"},{styleClass:"rulerLines even"})}};m.LineNumberRulerFactory=h;c.prototype={createFoldingRuler:function(a){return new q.FoldingRuler(a,"left",{styleClass:"ruler folding"})}};m.FoldingRulerFactory=c;b.prototype={createAnnotationModel:function(a){return new k.AnnotationModel(a)},
createAnnotationStyler:function(a,b){return new k.AnnotationStyler(a,b)},createAnnotationRulers:function(a){var b=new q.AnnotationRuler(a,"left",{styleClass:"ruler annotations"});a=new q.OverviewRuler(a,"right",{styleClass:"ruler overview"});return{annotationRuler:b,overviewRuler:a}}};m.AnnotationFactory=b;a.prototype={createTextDND:function(a,b){return new d.TextDND(a.getTextView(),b)}};m.TextDNDFactory=a;return m});
define("orion/editor/editorFeatures",["orion/editor/factories","orion/editor/actions","orion/editor/linkedMode","orion/objects"],function(p,s,q,k){return k.mixin({},p,s,q)});
(function(p,s){"function"===typeof define&&define.amd?define("orion/Deferred",s):"object"===typeof exports?module.exports=s():(p.orion=p.orion||{},p.orion.Deferred=s())})(this,function(){function p(){for(var e;e=d.shift();)e();f=!1}function s(l){d.push(l);f||(f=!0,e())}function q(d){return function(e){d(e)}}function k(){function d(){for(var b;b=p.shift();){var c=b.deferred,e="fulfilled"===f?"resolve":"reject";b=b[e];if("function"===typeof b)try{var n=b(a),h=n&&("object"===typeof n||"function"===typeof n)&&
n.then;if("function"===typeof h)if(n===c.promise)c.reject(new TypeError);else{var l=n.cancel;"function"===typeof l?c._parentCancel=l.bind(n):delete c._parentCancel;h.call(n,q(c.resolve),q(c.reject),q(c.progress))}else c.resolve(n)}catch(k){c.reject(k)}else c[e](a)}}function e(b){delete n._parentCancel;f="rejected";a=b;p.length&&s(d)}function c(b){function v(a){return function(b){(!f||"assumed"===f)&&a(b)}}delete n._parentCancel;try{var q=b&&("object"===typeof b||"function"===typeof b)&&b.then;if("function"===
typeof q)if(b===n)e(new TypeError);else{f="assumed";var w=b&&b.cancel;if("function"!==typeof w){var y=new k;b=y.promise;try{q(y.resolve,y.reject,y.progress)}catch(A){y.reject(A)}w=b.cancel;q=b.then}a=b;q.call(b,v(c),v(e));n._parentCancel=w.bind(b)}else f="fulfilled",a=b,p.length&&s(d)}catch(z){v(e)(z)}}function b(){var a=n._parentCancel;a?(delete n._parentCancel,a()):f||(a=Error("Cancel"),a.name="Cancel",e(a))}var a,f,p=[],n=this;this.resolve=function(a){f||c(a);return n};this.reject=function(a){f||
e(a);return n};this.progress=function(a){f||p.forEach(function(b){if(b.progress)try{b.progress(a)}catch(c){}});return n.promise};this.cancel=function(){n._parentCancel?setTimeout(b,0):b();return n};this.then=function(a,b,c){var e=new k;e._parentCancel=n.promise.cancel;p.push({resolve:a,reject:b,progress:c,deferred:e});("fulfilled"===f||"rejected"===f)&&s(d);return e.promise};this.promise={then:n.then,cancel:n.cancel}}var d=[],f=!1,e=function(){if("undefined"!==typeof process&&"function"===typeof process.nextTick){var d=
process.nextTick;return function(){d(p)}}if("function"===typeof MutationObserver){var e=document.createElement("div");(new MutationObserver(p)).observe(e,{attributes:!0});return function(){e.setAttribute("class","_tick")}}return function(){setTimeout(p,0)}}();k.all=function(d,e){function c(b,c){p||(f[b]=c,0===--a&&n.resolve(f))}function b(a,b){if(!p){if(e)try{c(a,e(b));return}catch(d){b=d}n.reject(b)}}var a=d.length,f=[],p=!1,n=new k;n.then(void 0,function(){p=!0;d.forEach(function(a){a.cancel&&a.cancel()})});
0===a?n.resolve(f):d.forEach(function(a,d){a.then(c.bind(void 0,d),b.bind(void 0,d))});return n.promise};k.when=function(d,e,c,b){var a;d&&"function"===typeof d.then||(a=new k,a.resolve(d),d=a.promise);return d.then(e,c,b)};return k});
define("orion/webui/littlelib",["orion/util"],function(p){function s(d,c){c||(c=document);return c.querySelectorAll(d)}function q(d){var c=d.tabIndex;0===c&&p.isIE&&!{a:!0,body:!0,button:!0,frame:!0,iframe:!0,img:!0,input:!0,isindex:!0,object:!0,select:!0,textarea:!0}[d.nodeName.toLowerCase()]&&!d.attributes.tabIndex&&(c=-1);return c}function k(d){if(0<=q(d))return d;if(d.hasChildNodes())for(var c=0;c<d.childNodes.length;c++){var b=k(d.childNodes[c]);if(b)return b}return null}function d(e){if(0<=
q(e))return e;if(e.hasChildNodes())for(var c=e.childNodes.length-1;0<=c;c--){var b=d(e.childNodes[c]);if(b)return b}return null}function f(d,c){if(3===d.nodeType){var b=e.exec(d.nodeValue);b&&1<b.length&&c(d,b)}if(d.hasChildNodes())for(b=0;b<d.childNodes.length;b++)f(d.childNodes[b],c)}var e=/\$\{([^\}]+)\}/,l=null;return{$:function(d,c){c||(c=document);return c.querySelector(d)},$$:s,$$array:function(d,c){return Array.prototype.slice.call(s(d,c))},node:function(d){var c=d;"string"===typeof d&&(c=
document.getElementById(d));return c},contains:function(d,c){if(!d||!c)return!1;if(d===c)return!0;var b=d.compareDocumentPosition(c);return Boolean(b&16)},bounds:function(d){d=d.getBoundingClientRect();return{left:d.left+document.documentElement.scrollLeft,top:d.top+document.documentElement.scrollTop,width:d.width,height:d.height}},empty:function(d){for(;d.hasChildNodes();)d.removeChild(d.firstChild)},firstTabbable:k,lastTabbable:d,stop:function(d){window.document.all&&(d.keyCode=0);d.preventDefault&&
(d.preventDefault(),d.stopPropagation())},processTextNodes:function(d,c){f(d,function(b,a){b.parentNode.replaceChild(document.createTextNode(c[a[1]]||a[1]),b)})},processDOMNodes:function(d,c){f(d,function(b,a){var d=c[a[1]];if(d){var e=document.createRange(),f=a.index;e.setStart(b,f);e.setEnd(b,f+a[0].length);e.deleteContents();e.insertNode(d)}})},addAutoDismiss:function(d,c){function b(a){l.forEach(function(b){var c=!1,d=b.excludeNodes.some(function(b){return document.body.contains(b)?(c=!0,b.contains(a.target)):
!1});if(c&&!d)try{b.dismiss(a)}catch(e){"undefined"!==typeof console&&console&&console.error(e&&e.message)}});l=l.filter(function(a){return a.excludeNodes.some(function(a){return document.body.contains(a)})})}null===l&&(l=[],document.addEventListener("click",b,!0),p.isIOS&&document.addEventListener("touchend",function(a){function b(){a.target.removeEventListener("click",b)}0===a.touches.length&&a.target.addEventListener("click",b)},!1));l.push({excludeNodes:d,dismiss:c})},setFramesEnabled:function(d){for(var c=
document.getElementsByTagName("iframe"),b=0;b<c.length;b++)c[b].parentNode.style.pointerEvents=d?"":"none"},removeAutoDismiss:function(d){l=l.filter(function(c){return d!==c.dismiss})},KEY:{BKSPC:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DEL:46}}});
define("orion/editor/contentAssist","i18n!orion/editor/nls/messages orion/keyBinding orion/editor/keyModes orion/editor/eventTarget orion/Deferred orion/objects orion/editor/util orion/util orion/webui/littlelib".split(" "),function(p,s,q,k,d,f,e,l,h){function c(a){this.textView=a;this.state=m.INACTIVE;this.resetProviderInfoArray();var b=this;this.contentAssistListener={onModelChanging:function(a){this._latestModelChangingEvent=a}.bind(this),onSelection:function(a){this.isDeactivatingChange(this._latestModelChangingEvent,
a)?this.setState(m.INACTIVE):this.isActive()&&(this.state===m.ACTIVE&&this.setState(m.FILTERING),this.filterProposals(a));this._latestModelChangingEvent=null}.bind(this),onScroll:function(a){this.setState(m.INACTIVE)}.bind(this)};a.setKeyBinding(l.isMac?new s.KeyBinding(" ",!1,!1,!1,!0):new s.KeyBinding(" ",!0),"contentAssist");a.setKeyBinding(l.isMac?new s.KeyBinding(" ",!1,!1,!0,!0):new s.KeyBinding(" ",!0,!1,!0),"contentAssist");a.setAction("contentAssist",function(){a.getOptions("readonly")||
b.activate();return!0},{name:p.contentAssist})}function b(a,b){var c=a.textView;q.KeyMode.call(this,c);this.contentAssist=a;this.widget=b;this.proposals=[];var d=this;this.contentAssist.addEventListener("ProposalsComputed",function(a){d.proposals=a.data.proposals;if(0===d.proposals.length)d.selectedIndex=-1,d.cancel();else{for(d.selectedIndex=0;d.proposals[d.selectedIndex]&&d.proposals[d.selectedIndex].unselectable;)d.selectedIndex++;if(d.proposals[d.selectedIndex]){if(d.widget){var b=!0;if(a.autoApply){for(a=
d.selectedIndex+1;d.proposals[a]&&d.proposals[a].unselectable;)a++;d.proposals[a]||(b=!1,d.contentAssist.apply(d.proposals[d.selectedIndex]))}b&&(d.widget.show(),d.widget.selectNode(d.selectedIndex))}}else d.selectedIndex=-1,d.cancel()}});c.setAction("contentAssistApply",function(){return this.enter()}.bind(this));c.setAction("contentAssistCancel",function(){return this.cancel()}.bind(this));c.setAction("contentAssistNextProposal",function(){return this.lineDown()}.bind(this));c.setAction("contentAssistPreviousProposal",
function(){return this.lineUp()}.bind(this));c.setAction("contentAssistNextPage",function(){return this.pageDown()}.bind(this));c.setAction("contentAssistPreviousPage",function(){return this.pageUp()}.bind(this));c.setAction("contentAssistHome",function(){this.widget&&this.widget.scrollIndex(0,!0);return this.lineDown(0)}.bind(this));c.setAction("contentAssistEnd",function(){return this.lineUp(this.proposals.length-1)}.bind(this));c.setAction("contentAssistTab",function(){return this.tab()}.bind(this));
this.widget&&(this.widget.setContentAssistMode(this),this.widget.createAccessible())}function a(a,b){this.contentAssist=a;this.textView=this.contentAssist.getTextView();this.isShowing=this.textViewListenerAdded=!1;var c=this.textView.getOptions("parent").ownerDocument;this.parentNode="string"===typeof b?c.getElementById(b):b;if(!this.parentNode){this.parentNode=l.createElement(c,"div");this.parentNode.className="contentassist";var d=c.getElementsByTagName("body")[0];if(d)d.appendChild(this.parentNode);
else throw Error("parentNode is required");}this.parentNode.addEventListener("scroll",this.onScroll.bind(this));var f=this;this.textViewListener={onMouseDown:function(a){(a.event.target||a.event.srcElement).parentElement!==f.parentNode&&f.contentAssist.deactivate()}};this.contentAssist.addEventListener("Deactivating",function(a){f.hide()});this.scrollListener=function(a){f.isShowing&&f.position()};e.addEventListener(c,"scroll",this.scrollListener)}var m={INACTIVE:1,ACTIVE:2,FILTERING:3},t={selected:"selected",
hr:"proposal-hr",emphasis:"proposal-emphasis",noemphasis:"proposal-noemphasis",noemphasis_keyword:"proposal-noemphasis-keyword",noemphasis_title:"proposal-noemphasis-title",noemphasis_title_keywords:"proposal-noemphasis-title-keywords",dfault:"proposal-default"};c.prototype={apply:function(a){if(!a)return!1;var b=this.textView,c=b.getSelection(),d=this._initialCaretOffset,e=d,f=c=Math.max(c.start,c.end),l=b.getModel();l.getBaseModel&&(e=l.mapOffset(e),f=l.mapOffset(f),l=l.getBaseModel());a.overwrite&&
(d=this.getPrefixStart(l,e));e={proposal:a,start:e,end:f};this.setState(m.INACTIVE);b.setText("string"===typeof a?a:a.proposal,d,c);this.dispatchEvent({type:"ProposalApplied",data:e});return!0},activate:function(a,b){this.state===m.INACTIVE&&(this._autoTriggered=b?!0:!1,this.setState(m.ACTIVE,a))},deactivate:function(){this.setState(m.INACTIVE)},getTextView:function(){return this.textView},isActive:function(){return this.state===m.ACTIVE||this.state===m.FILTERING},isDeactivatingChange:function(a,
b){var c=!1;b.newValue.start<this._initialCaretOffset?c=!0:a&&(c=0<a.removedLineCount||0<a.addedLineCount);return c},setState:function(a,b){var c;a===m.ACTIVE?(this._filterText="",c="Activating",this._mode&&this._mode.setActive(!0)):a===m.INACTIVE&&(c="Deactivating",this._mode&&this._mode.setActive(!1),this._initialCaretOffset=-1,this._filterText="");c&&this.dispatchEvent({type:c,providerInfoArray:b});this.state=a;this.onStateChange(a)},setMode:function(a){this._mode=a},onStateChange:function(a){a===
m.INACTIVE?this.listenerAdded&&(this._latestModelChangingEvent=null,this.textView.removeEventListener("ModelChanging",this.contentAssistListener.onModelChanging),this.textView.removeEventListener("Scroll",this.contentAssistListener.onScroll),this.textView.removeEventListener("Selection",this.contentAssistListener.onSelection),this.listenerAdded=!1):a===m.ACTIVE&&(this.listenerAdded||(this.textView.addEventListener("ModelChanging",this.contentAssistListener.onModelChanging),this.textView.addEventListener("Scroll",
this.contentAssistListener.onScroll),this.textView.addEventListener("Selection",this.contentAssistListener.onSelection),this.listenerAdded=!0),this.computeProposals())},computeProposals:function(){var a=this,b=this.textView.getCaretOffset(),c=this.textView.getSelection(),c=Math.min(c.start,c.end);this._initialCaretOffset=Math.min(b,c);this._computeProposals(this._initialCaretOffset).then(function(b){a._computedProposals=b;a.isActive()&&(b=a._flatten(b),a.dispatchEvent({type:"ProposalsComputed",data:{proposals:b},
autoApply:!a._autoTriggered}))})},getPrefixStart:function(a,b){for(var c=b;0<c&&/[A-Za-z0-9_]/.test(a.getText(c-1,c));)c--;return c},handleError:function(a){"undefined"!==typeof console&&(console.log("Error retrieving content assist proposals"),console.log(a&&a.stack))},_computeProposals:function(a){var b=this._providerInfoArray,c=this.textView,e=c.getSelection(),m=c.getModel(),l=a;m.getBaseModel&&(l=m.mapOffset(l),e.start=m.mapOffset(e.start),e.end=m.mapOffset(e.end),m=m.getBaseModel());a=m.getLine(m.getLineAtOffset(l));
for(var h=0;h<a.length&&/\s/.test(a.charAt(h));)h++;var h=a.substring(0,h),c=c.getOptions("tabSize","expandTab"),c=c.expandTab?Array(c.tabSize+1).join(" "):"\t",k={line:a,offset:l,prefix:m.getText(this.getPrefixStart(m,l),l),selection:e,delimiter:m.getLineDelimiter(),tab:c,indentation:h},g=this,b=b.map(function(a){a=a.provider;var b;try{var c,e;if(c=a.computeContentAssist){var n=g.editorContextProvider,h=n.getEditorContext();k=f.mixin(k,n.getOptions());e=c.apply(a,[h,k])}else if(c=a.getProposals||
a.computeProposals)e=c.apply(a,[m.getText(),l,k]);b=g.progress?g.progress.progress(e,"Generating content assist proposal"):e}catch(p){g.handleError(p)}return d.when(b)});return d.all(b,this.handleError)},filterProposals:function(a){a="";var b=0;if(this._latestModelChangingEvent){a=this._latestModelChangingEvent.text;if(b=this._latestModelChangingEvent.removedCharCount)this._filterText=this._filterText.substring(0,this._filterText.length-b);a&&(this._filterText=this._filterText.concat(a));a=this.textView.getModel();
a.getBaseModel&&(a=a.getBaseModel());a=this.getPrefixStart(a,this._initialCaretOffset);var c=this.textView.getText(a,this._initialCaretOffset),d=[];this._computedProposals.forEach(function(a){a=a.filter(function(a){if(t[a.style]===t.hr||t[a.style]===t.noemphasis_title)return!0;var b="";if(a.overwrite){if(a.name)b=a.name;else if(a.proposal)b=a.proposal;else return!1;return 0===b.indexOf(c+this._filterText)}return a.name||a.proposal?(b=!1,a.name&&(b=0===a.name.indexOf(c+this._filterText)),!b&&a.proposal&&
(b=0===a.proposal.indexOf(this._filterText)),b):"string"===typeof a?0===a.indexOf(this._filterText):!1},this);0<a.length&&d.push(a)},this);d=this._removeExtraUnselectableElements(d);a=this._flatten(d);this.dispatchEvent({type:"ProposalsComputed",data:{proposals:a},autoApply:!1})}},_removeExtraUnselectableElements:function(a){return a.map(function(a){return a.filter(function(b,c){var d=!0;if(t[b.style]===t.hr)0===c||a.length-1===c?d=!1:t.hr===t[a[c-1].style]&&(d=!1);else if(t[b.style]===t.noemphasis_title){var e=
a[c+1];e?t[e.style]===t.noemphasis_title&&(d=!1):d=!1}return d})})},setEditorContextProvider:function(a){this.editorContextProvider=a},_generateProviderId:function(){this._uniqueProviderIdCounter?this._uniqueProviderIdCounter++:this._uniqueProviderIdCounter=0;return"ContentAssistGeneratedID_"+this._uniqueProviderIdCounter},setAutoTriggerEnabled:function(a){this._autoTriggerEnabled=a;this._updateAutoTriggerListenerState()},setProviders:function(a){a=a.map(function(a){return{provider:a,id:this._generateProviderId()}},
this);this.setProviderInfoArray(a)},setProviderInfoArray:function(a){this.resetProviderInfoArray();this._providerInfoArray=a;this._charTriggersInstalled=a.some(function(a){return a.charTriggers});this._updateAutoTriggerListenerState()},resetProviderInfoArray:function(){this._providerInfoArray=[];this._charTriggersInstalled=!1;this._updateAutoTriggerListenerState()},setProgress:function(a){this.progress=a},setStyleAccessor:function(a){this._styleAccessor=a},_flatten:function(a){return a.reduce(function(a,
b){var c=a;if(Array.isArray(b)&&0<b.length){var c=b,d=a;b[0].style&&0===t[b[0].style].indexOf(t.noemphasis)&&(c=a,d=b);0<c.length&&c[c.length-1].style&&t.hr!==t[c[c.length-1].style]&&(c=c.concat({proposal:"",name:"",description:"---------------------------------",style:"hr",unselectable:!0}));c=c.concat(d)}return c},[])},_triggerListener:function(a){if(this._styleAccessor){var b=this.textView.getCaretOffset(),c=null,d=[];if(this._charTriggersInstalled){var e=this.textView.getText(b-1,b);this._providerInfoArray.forEach(function(a){var f=
a.charTriggers;if(f&&f.test(e)){var f=!1,n=a.excludedStyles;n&&(c||(c=this._styleAccessor.getStyles(b-1)),f=c.some(function(a){return n.test(a.style)}));f||d.push(a)}},this);0<d.length&&this.activate(d,!0)}}},_updateAutoTriggerListenerState:function(){this._boundTriggerListener||(this._boundTriggerListener=this._triggerListener.bind(this));if(this._triggerListenerInstalled){if(!this._autoTriggerEnabled||!this._charTriggersInstalled)this.textView.removeEventListener("Modify",this._boundTriggerListener),
this._triggerListenerInstalled=!1}else this._autoTriggerEnabled&&this._charTriggersInstalled&&(this.textView.addEventListener("Modify",this._boundTriggerListener),this._triggerListenerInstalled=!0)}};k.EventTarget.addMixin(c.prototype);b.prototype=new q.KeyMode;f.mixin(b.prototype,{createKeyBindings:function(){var a=s.KeyBinding,b=[];b.push({actionID:"contentAssistApply",keyBinding:new a(13)});b.push({actionID:"contentAssistCancel",keyBinding:new a(27)});b.push({actionID:"contentAssistNextProposal",
keyBinding:new a(40)});b.push({actionID:"contentAssistPreviousProposal",keyBinding:new a(38)});b.push({actionID:"contentAssistNextPage",keyBinding:new a(34)});b.push({actionID:"contentAssistPreviousPage",keyBinding:new a(33)});b.push({actionID:"contentAssistHome",keyBinding:new a(h.KEY.HOME)});b.push({actionID:"contentAssistEnd",keyBinding:new a(h.KEY.END)});b.push({actionID:"contentAssistTab",keyBinding:new a(9)});return b},cancel:function(){this.getContentAssist().deactivate()},getContentAssist:function(){return this.contentAssist},
getProposals:function(){return this.proposals},isActive:function(){return this.getContentAssist().isActive()},setActive:function(a){a?this.contentAssist.textView.addKeyMode(this):this.contentAssist.textView.removeKeyMode(this)},lineUp:function(a,b){return this.selectNew(a,b,!1)},lineDown:function(a,b){return this.selectNew(a,b,!0)},selectNew:function(a,b,c){if(c){if(void 0===a&&(a=this.selectedIndex+1),a>=this.proposals.length){if(b)return!0;a=0}}else if(void 0===a&&(a=this.selectedIndex-1),0>a){if(b)return!0;
a=this.proposals.length-1}for(var d=a;this.proposals[a]&&this.proposals[a].unselectable;){if(c){if(a++,a>=this.proposals.length){if(b)return!0;a=0}}else if(a--,0>a){if(b)return!0;a=this.proposals.length-1}if(a===d){a=-1;break}}this.selectedIndex=a;this.widget&&this.widget.selectNode(a);return!0},pageUp:function(){if(this.widget){var a=this.widget.getTopIndex();a===this.selectedIndex&&(this.widget.scrollIndex(a,!1),a=this.widget.getTopIndex());return 0===a?this.lineDown(a,!0):this.lineUp(a,!0)}return this.lineUp()},
pageDown:function(){if(this.widget){var a=this.widget.getBottomIndex();a===this.selectedIndex&&(this.widget.scrollIndex(a,!0),a=this.widget.getBottomIndex());return this.lineDown(a,!0)}return this.lineDown()},enter:function(){return this.contentAssist.apply(this.proposals[this.selectedIndex]||null)},tab:function(){return this.widget?(this.widget.parentNode.focus(),!0):!1}});a.prototype={onClick:function(a){a||(a=window.event);this.contentAssist.apply(this.getProposal(a.target||a.srcElement));this.textView.focus()},
onScroll:function(a){this.previousCloneNode&&!this.preserveCloneThroughScroll&&(this._removeCloneNode(),this.previousSelectedNode.classList.add(t.selected));this.preserveCloneThroughScroll=!1},createDiv:function(a,b,c){var d=b.ownerDocument,e=l.createElement(d,"div");e.id="contentoption"+c;e.setAttribute("role","option");e.className=t[a.style]?t[a.style]:t.dfault;"hr"===a.style?a=l.createElement(d,"hr"):(a=this._createDisplayNode(e,a,c),e.contentAssistProposalIndex=c);e.appendChild(a);b.appendChild(e)},
createAccessible:function(){var a=this._contentAssistMode,b=this;this.parentNode.addEventListener("keydown",function(c){c||(c=window.event);c.preventDefault&&c.preventDefault();return c.keyCode===h.KEY.ESCAPE?a.cancel():c.keyCode===h.KEY.UP?a.lineUp():c.keyCode===h.KEY.DOWN?a.lineDown():c.keyCode===h.KEY.ENTER?a.enter():c.keyCode===h.KEY.PAGEDOWN?a.pageDown():c.keyCode===h.KEY.PAGEUP?a.pageUp():c.keyCode===h.KEY.HOME?(b.scrollIndex(0,!0),a.lineDown(0)):c.keyCode===h.KEY.END?a.lineUp(a.getProposals().length-
1):!1})},_createDisplayNode:function(a,b,c){var d=null,e=null;if("string"===typeof b)e=b;else if(b.description&&"string"===typeof b.description)if(b.name&&"string"===typeof b.name){var f=this._createNameNode(b.name);f.contentAssistProposalIndex=c;d=document.createElement("span");d.appendChild(f);f=document.createTextNode(b.description);d.appendChild(f);a.setAttribute("title",b.name+b.description)}else e=b.description;else e=b.proposal;e&&(d=this._createNameNode(e),a.setAttribute("title",e));d.contentAssistProposalIndex=
c;return d},_createNameNode:function(a){var b=document.createElement("span");b.classList.add("proposal-name");b.appendChild(document.createTextNode(a));return b},getProposal:function(a){var b=null;a=a.contentAssistProposalIndex;void 0!==a&&(b=this._contentAssistMode.getProposals()[a]||null);return b},getTopIndex:function(){for(var a=this.parentNode.childNodes,b=0;b<a.length;b++)if(a[b].offsetTop>=this.parentNode.scrollTop)return b;return 0},getBottomIndex:function(){for(var a=this.parentNode.childNodes,
b=0;b<a.length;b++){var c=a[b];if(c.offsetTop+c.offsetHeight>this.parentNode.scrollTop+this.parentNode.clientHeight)return Math.max(0,b-1)}return a.length-1},scrollIndex:function(a,b){this.parentNode.childNodes[a].scrollIntoView(b);this.preserveCloneThroughScroll=!0},selectNode:function(a){var b=null;this.previousSelectedNode&&(this.previousSelectedNode.classList.remove(t.selected),this.previousSelectedNode=null,this.previousCloneNode&&this._removeCloneNode());if(-1!==a){b=this.parentNode.childNodes[a];
b.classList.add(t.selected);this.parentNode.setAttribute("aria-activedescendant",b.id);b.focus();b.offsetTop<this.parentNode.scrollTop?(b.scrollIntoView(!0),this.preserveCloneThroughScroll=!0):b.offsetTop+b.offsetHeight>this.parentNode.scrollTop+this.parentNode.clientHeight&&(b.scrollIntoView(!1),this.preserveCloneThroughScroll=!0);var c=h.bounds(b.firstChild||b),d=h.bounds(this.parentNode);a=window.getComputedStyle(this.parentNode);var e=window.getComputedStyle(b),e=parseInt(a.paddingLeft)+parseInt(a.paddingRight)+
parseInt(e.paddingLeft)+parseInt(e.paddingRight);if(c.width>=d.width-e){e=parseInt(a.top);d=b.cloneNode(!0);d.classList.add("cloneProposal");d.style.top=e+b.offsetTop-this.parentNode.scrollTop+"px";d.style.left=a.left;d.setAttribute("id",d.id+"_clone");c=c.left+c.width-parseInt(document.documentElement.clientWidth);0<c&&(a=parseInt(a.left)-c,0>a&&(a=0),d.style.left=a+"px");a=document.createElement("div");a.id="clone_contentassist";a.classList.add("contentassist");a.classList.add("cloneWrapper");a.appendChild(d);
a.onclick=this.parentNode.onclick;this.parentNode.parentNode.insertBefore(a,this.parentNode);var f=function(a){a.contentAssistProposalIndex=b.contentAssistProposalIndex;if(a.hasChildNodes())for(var c=0;c<a.childNodes.length;c++)f(a.childNodes[c])};f(a);b.classList.remove(t.selected);this.previousCloneNode=a}}this.previousSelectedNode=b},setContentAssistMode:function(a){this._contentAssistMode=a},show:function(){var a=this._contentAssistMode.getProposals();if(0===a.length)this.hide();else{this.parentNode.innerHTML=
"";for(var b=0;b<a.length;b++)this.createDiv(a[b],this.parentNode,b);this.position();this.parentNode.onclick=this.onClick.bind(this);this.isShowing=!0;this.textViewListenerAdded||(this.textView.addEventListener("MouseDown",this.textViewListener.onMouseDown),this.textViewListenerAdded=!0)}},hide:function(){this.parentNode.ownerDocument.activeElement===this.parentNode&&this.textView.focus();this.parentNode.style.display="none";this.parentNode.onclick=null;this.isShowing=!1;this.textViewListenerAdded&&
(this.textView.removeEventListener("MouseDown",this.textViewListener.onMouseDown),this.textViewListenerAdded=!1);this.previousSelectedNode&&(this.previousSelectedNode=null,this.previousCloneNode&&this._removeCloneNode())},position:function(){var a=this.contentAssist,b=this.textView;if(void 0!==a.offset){var a=a.offset,c=b.getModel();c.getBaseModel&&(a=c.mapOffset(a,!0))}else a=this.textView.getCaretOffset();a=b.getLocationAtOffset(a);a.y+=b.getLineHeight();this.textView.convert(a,"document","page");
this.parentNode.style.position="fixed";this.parentNode.style.left=a.x+"px";this.parentNode.style.top=a.y+"px";this.parentNode.style.display="block";this.parentNode.scrollTop=0;b=this.parentNode.ownerDocument;c=b.documentElement.clientWidth;a.y+this.parentNode.offsetHeight>b.documentElement.clientHeight&&(this.parentNode.style.top=a.y-this.parentNode.offsetHeight-this.textView.getLineHeight()+"px");a.x+this.parentNode.offsetWidth>c&&(this.parentNode.style.left=c-this.parentNode.offsetWidth+"px")},
_removeCloneNode:function(){this.parentNode.parentNode.contains(this.previousCloneNode)&&this.parentNode.parentNode.removeChild(this.previousCloneNode);this.previousCloneNode=null}};return{ContentAssist:c,ContentAssistMode:b,ContentAssistWidget:a}});
define("orion/editor/stylers/lib/syntax",[],function(){return{id:"orion.lib",grammars:[{id:"orion.lib",repository:{brace_open:{match:"{",name:"punctuation.section.block.begin"},brace_close:{match:"}",name:"punctuation.section.block.end"},bracket_open:{match:"\\[",name:"punctuation.section.bracket.begin"},bracket_close:{match:"\\]",name:"punctuation.section.bracket.end"},parenthesis_open:{match:"\\(",name:"punctuation.section.parens.begin"},parenthesis_close:{match:"\\)",name:"punctuation.section.parens.end"},
doc_block:{begin:{match:"/\\*\\*",literal:"/**"},end:{match:"\\*/",literal:"*/"},name:"comment.block.documentation",patterns:[{match:"@(?:(?!\\*/)\\S)*",name:"keyword.other.documentation.tag"},{match:"\\\x3c\\S*\\\x3e",name:"keyword.other.documentation.markup"},{match:"(\\b)(TODO)(\\b)(((?!\\*/).)*)",name:"meta.annotation.task.todo",captures:{2:{name:"keyword.other.documentation.task"},4:{name:"comment.block"}}}]},number_decimal:{match:"\\b-?(?:\\.\\d+|\\d+\\.?\\d*)(?:[eE][+-]?\\d+)?\\b",name:"constant.numeric.number"},
number_hex:{match:"\\b0[xX][0-9A-Fa-f]+\\b",name:"constant.numeric.hex"},string_doubleQuote:{match:'"(?:\\\\.|[^"])*"?',name:"string.quoted.double"},string_singleQuote:{match:"'(?:\\\\.|[^'])*'?",name:"string.quoted.single"},todo_comment_singleLine:{match:"(\\b)(TODO)(\\b)(.*)",name:"meta.annotation.task.todo",captures:{2:{name:"keyword.other.documentation.task"},4:{name:"comment.line"}}}}},{id:"orion.c-like",repository:{comment_singleLine:{match:{match:"//.*",literal:"//"},name:"comment.line.double-slash",
patterns:[{include:"orion.lib#todo_comment_singleLine"}]},comment_block:{begin:{match:"/\\*",literal:"/*"},end:{match:"\\*/",literal:"*/"},name:"comment.block",patterns:[{match:"(\\b)(TODO)(\\b)(((?!\\*/).)*)",name:"meta.annotation.task.todo",captures:{2:{name:"keyword.other.documentation.task"},4:{name:"comment.block"}}}]}}}],keywords:[]}});
define("orion/editor/stylers/text_css/syntax",["orion/editor/stylers/lib/syntax"],function(p){var s="alignment-adjust alignment-baseline animation-delay animation-direction animation-duration animation-iteration-count animation-name animation-play-state animation-timing-function animation appearance azimuth backface-visibility background-attachment background-clip background-color background-image background-origin background-position background-repeat background-size background baseline-shift binding bleed bookmark-label bookmark-level bookmark-state bookmark-target border-bottom-color border-bottom-left-radius border-bottom-right-radius border-bottom-style border-bottom-width border-bottom border-collapse border-color border-image-outset border-image-repeat border-image-slice border-image-source border-image-width border-image border-left-color border-left-style border-left-width border-left border-radius border-right-color border-right-style border-right-width border-right border-spacing border-style border-top-color border-top-left-radius border-top-right-radius border-top-style border-top-width border-top border-width border bottom box-align box-decoration-break box-direction box-flex-group box-flex box-lines box-ordinal-group box-orient box-pack box-shadow box-sizing break-after break-before break-inside caption-side clear clip color-profile color column-count column-fill column-gap column-rule-color column-rule-style column-rule-width column-rule column-span column-width columns content counter-increment counter-reset crop cue-after cue-before cue cursor direction display dominant-baseline drop-initial-after-adjust drop-initial-after-align drop-initial-before-adjust drop-initial-before-align drop-initial-size drop-initial-value elevation empty-cells fit-position fit flex-align flex-flow flex-inline-pack flex-order flex-pack float-offset float font-family font-size font-size-adjust font-stretch font-style font-variant font-weight font grid-columns grid-rows hanging-punctuation height hyphenate-after hyphenate-before hyphenate-character hyphenate-lines hyphenate-resource hyphens icon image-orientation image-rendering image-resolution inline-box-align left letter-spacing line-height line-stacking-ruby line-stacking-shift line-stacking-strategy line-stacking list-style-image list-style-position list-style-type list-style margin-bottom margin-left margin-right margin-top margin mark-after mark-before mark marker-offset marks marquee-direction marquee-loop marquee-play-count marquee-speed marquee-style max-height max-width min-height min-width move-to nav-down nav-index nav-left nav-right nav-up opacity orphans outline-color outline-offset outline-style outline-width outline overflow-style overflow-x overflow-y overflow padding-bottom padding-left padding-right padding-top padding page-break-after page-break-before page-break-inside page-policy page pause-after pause-before pause perspective-origin perspective phonemes pitch-range pitch play-during position presentation-level punctuation-trim quotes rendering-intent resize rest-after rest-before rest richness right rotation-point rotation ruby-align ruby-overhang ruby-position ruby-span size speak-header speak-numeral speak-punctuation speak speech-rate stress string-set table-layout target-name target-new target-position target text-align-last text-align text-decoration text-emphasis text-height text-indent text-justify text-outline text-shadow text-transform text-wrap top transform-origin transform-style transform transition-delay transition-duration transition-property transition-timing-function transition unicode-bidi vertical-align visibility voice-balance voice-duration voice-family voice-pitch-range voice-pitch voice-rate voice-stress voice-volume volume white-space-collapse white-space widows width word-break word-spacing word-wrap z-index".split(" ");p=
p.grammars;p.push({id:"orion.css",contentTypes:["text/css"],patterns:[{begin:"'(?:\\\\.|[^\\\\'])*\\\\$",end:"^(?:$|(?:\\\\.|[^\\\\'])*('|[^\\\\]$))",name:"string.quoted.single.css"},{begin:'"(?:\\\\.|[^\\\\"])*\\\\$',end:'^(?:$|(?:\\\\.|[^\\\\"])*("|[^\\\\]$))',name:"string.quoted.double.css"},{include:"orion.lib#string_doubleQuote"},{include:"orion.lib#string_singleQuote"},{include:"orion.c-like#comment_block"},{include:"orion.lib#brace_open"},{include:"orion.lib#brace_close"},{include:"orion.lib#bracket_open"},
{include:"orion.lib#bracket_close"},{include:"orion.lib#parenthesis_open"},{include:"orion.lib#parenthesis_close"},{include:"orion.lib#number_decimal"},{include:"#number_hex"},{match:"(?i)\\b-?(?:\\.\\d+|\\d+\\.?\\d*)(?:%|em|ex|ch|rem|vw|vh|vmin|vmax|in|cm|mm|pt|pc|px|deg|grad|rad|turn|s|ms|Hz|kHz|dpi|dpcm|dppx)?\\b",name:"constant.numeric.value.css"},{match:"(?:-webkit-|-moz-|-ms-|\\b)(?:"+s.join("|")+")\\b",name:"keyword.control.css"}],repository:{number_hex:{match:"#[0-9A-Fa-f]+\\b",name:"constant.numeric.hex.css"}}});
return{id:p[p.length-1].id,grammars:p,keywords:s}});
define("webtools/cssContentAssist",["orion/editor/templates","orion/editor/stylers/text_css/syntax"],function(p,s){function q(a){return JSON.stringify(a).replace("}","\\}")}function k(){}for(var d={type:"link",values:"visible hidden scroll auto no-display no-content".split(" ")},f={type:"link",values:"solid dashed dotted double groove ridge inset outset".split(" ")},e={type:"link",values:[]},l=0;10>l;l++)e.values.push(l.toString());for(var h={type:"link",values:"black white red green blue magenta yellow cyan grey darkred darkgreen darkblue darkmagenta darkcyan darkyellow darkgray lightgray".split(" ")},
c=[{prefix:"rule",description:"rule - class selector rule",template:".${class} {\n\t${cursor}\n}"},{prefix:"rule",description:"rule - id selector rule",template:"#${id} {\n\t${cursor}\n}"},{prefix:"outline",description:"outline - outline style",template:"outline: ${color:"+q(h)+"} ${style:"+q(f)+"} ${width:"+q(e)+"}px;"},{prefix:"background-image",description:"background-image - image style",template:'background-image: url("${uri}");'},{prefix:"url",description:"url - url image",template:'url("${uri}");'},
{prefix:"rgb",description:"rgb - rgb color",template:"rgb(${red},${green},${blue});"},{prefix:"@",description:"import - import style sheet",template:'@import "${uri}";'}],b=[{prop:"display",values:{type:"link",values:"none block box flex inline inline-block inline-flex inline-table list-item table table-caption table-cell table-column table-column-group table-footer-group table-header-group table-row table-row-group inherit".split(" ")}},{prop:"overflow",values:d},{prop:"overflow-x",values:d},{prop:"overflow-y",
values:d},{prop:"float",values:{type:"link",values:["left","right","none","inherit"]}},{prop:"position",values:{type:"link",values:["absolute","fixed","relative","static","inherit"]}},{prop:"cursor",values:{type:"link",values:"auto crosshair default e-resize help move n-resize ne-resize nw-resize pointer progress s-resize se-resize sw-resize text w-resize wait inherit".split(" ")}},{prop:"color",values:h},{prop:"border-top-color",values:h},{prop:"border-bottom-color",values:h},{prop:"border-right-color",
values:h},{prop:"border-left-color",values:h},{prop:"background-color",values:h},{prop:"font-style",values:{type:"link",values:["italic","normal","oblique","inherit"]}},{prop:"font-weight",values:{type:"link",values:"bold normal bolder lighter 100 200 300 400 500 600 700 800 900 inherit".split(" ")}},{prop:"white-space",values:{type:"link",values:"pre pre-line pre-wrap nowrap normal inherit".split(" ")}},{prop:"word-wrap",values:{type:"link",values:["normal","break-word"]}},{prop:"visibility",values:{type:"link",
values:["hidden","visible","collapse","inherit"]}}],l=0;l<b.length;l++)d=b[l],c.push({prefix:d.prop,description:d.prop+" - "+d.prop+" style",template:d.prop+": ${value:"+q(d.values)+"};"});b="width height top bottom left right min-width min-height max-width max-height margin padding padding-left padding-right padding-top padding-bottom margin-left margin-top margin-bottom margin-right".split(" ");for(l=0;l<b.length;l++)d=b[l],c.push({prefix:d,description:d+" - "+d+" pixel style",template:d+": ${value}px;"});
b=["padding","margin"];for(l=0;l<b.length;l++)d=b[l],c.push({prefix:d,description:d+" - "+d+" top right bottom left style",template:d+": ${top}px ${left}px ${bottom}px ${right}px;"}),c.push({prefix:d,description:d+" - "+d+" top right,left bottom style",template:d+": ${top}px ${right_left}px ${bottom}px;"}),c.push({prefix:d,description:d+" - "+d+" top,bottom right,left style",template:d+": ${top_bottom}px ${right_left}px"});b=["border","border-top","border-bottom","border-left","border-right"];for(l=
0;l<b.length;l++)d=b[l],c.push({prefix:d,description:d+" - "+d+" style",template:d+": ${width:"+q(e)+"}px ${style:"+q(f)+"} ${color:"+q(h)+"};"});k.prototype=new p.TemplateContentAssist(s.keywords,c);k.prototype.getPrefix=function(a,b,c){for(c=b;c&&/[A-Za-z\-\@]/.test(a.charAt(c-1));)c--;return c?a.substring(c,b):""};return{CssContentAssistProvider:k}});
define("webtools/htmlContentAssist",["orion/editor/templates"],function(p){function s(){}var q=new p.Template("","Simple HTML document",'\x3c!DOCTYPE html\x3e\n\x3chtml lang\x3d"en"\x3e\n\t\x3chead\x3e\n\t\t\x3cmeta charset\x3dutf-8\x3e\n\t\t\x3ctitle\x3e${title}\x3c/title\x3e\n\t\x3c/head\x3e\n\t\x3cbody\x3e\n\t\t\x3ch1\x3e${header}\x3c/h1\x3e\n\t\t\x3cp\x3e\n\t\t\t${cursor}\n\t\t\x3c/p\x3e\n\t\x3c/body\x3e\n\x3c/html\x3e'),k=[{prefix:"\x3cimg",name:"\x3cimg\x3e",description:" - HTML image element",
template:'\x3cimg src\x3d"${cursor}" alt\x3d"${Image}"/\x3e'},{prefix:"\x3ca",name:"\x3ca\x3e",description:" - HTML anchor element",template:'\x3ca href\x3d"${cursor}"\x3e\x3c/a\x3e'},{prefix:"\x3cul",name:"\x3cul\x3e",description:" - HTML unordered list",template:"\x3cul\x3e\n\t\x3cli\x3e${cursor}\x3c/li\x3e\n\x3c/ul\x3e"},{prefix:"\x3col",name:"\x3col\x3e",description:" - HTML ordered list",template:"\x3col\x3e\n\t\x3cli\x3e${cursor}\x3c/li\x3e\n\x3c/ol\x3e"},{prefix:"\x3cdl",name:"\x3cdl\x3e",
description:" - HTML definition list",template:"\x3cdl\x3e\n\t\x3cdt\x3e${cursor}\x3c/dt\x3e\n\t\x3cdd\x3e\x3c/dd\x3e\n\x3c/dl\x3e"},{prefix:"\x3ctable",name:"\x3ctable\x3e",description:" - basic HTML table",template:"\x3ctable\x3e\n\t\x3ctr\x3e\n\t\t\x3ctd\x3e${cursor}\x3c/td\x3e\n\t\x3c/tr\x3e\n\x3c/table\x3e"},{prefix:"\x3c!--",name:"\x3c!-- --\x3e",description:" - HTML comment",template:"\x3c!-- ${cursor} --\x3e"}],d,f,e,l,h="abbr b button canvas cite command dd del dfn dt em embed font h1 h2 h3 h4 h5 h6 i ins kbd label li mark meter object option output progress q rp rt samp small strong sub sup td time title tt u var".split(" ");
for(l=0;l<h.length;l++)d=h[l],e="\x3c"+d+"\x3e\x3c/"+d+"\x3e",f="\x3c"+d+"\x3e${cursor}\x3c/"+d+"\x3e",k.push({prefix:"\x3c"+d,description:e,template:f});h="address article aside audio bdo blockquote body caption code colgroup datalist details div fieldset figure footer form head header hgroup iframe legend map menu nav noframes noscript optgroup p pre ruby script section select span style tbody textarea tfoot th thead tr video".split(" ");for(l=0;l<h.length;l++)d=h[l],e="\x3c"+d+"\x3e\x3c/"+d+"\x3e",
f="\x3c"+d+"\x3e\n\t${cursor}\n\x3c/"+d+"\x3e",k.push({prefix:"\x3c"+d,description:e,template:f});h="area base br col hr input link meta param keygen source".split(" ");for(l=0;l<h.length;l++)d=h[l],f=e="\x3c"+d+"/\x3e",k.push({prefix:"\x3c"+d,description:e,template:f});s.prototype=new p.TemplateContentAssist([],k);s.prototype.getPrefix=function(c,b,a){a="";for(var d=b;d&&/[A-Za-z0-9<!-]/.test(c.charAt(d-1));)if(d--,"\x3c"===c.charAt(d)){a=c.substring(d,b);break}return a};s.prototype.computeProposals=
function(c,b,a){return 0===c.length?[q.getProposal("",b,a)]:p.TemplateContentAssist.prototype.computeProposals.call(this,c,b,a).sort(function(a,b){var c=a.prefix||a.proposal,d=b.prefix||b.proposal;if(c){if(!d)return 1}else return-1;return c.toLowerCase().localeCompare(d.toLowerCase())})};return{HTMLContentAssistProvider:s}});
define("orion/editor/AsyncStyler",["i18n!orion/editor/nls/messages","orion/editor/annotations"],function(p,s){function q(e){return-1!==e.getProperty("objectClass").indexOf(d)&&"highlighter"===e.getProperty("type")}function k(d,f,h){this.initialize(d,f,h);this.lineStyles=[]}var d="orion.edit.highlighter",f=d+" service must be an event emitter";s.AnnotationType.registerType("orion.annotation.highlightError",{title:p.syntaxError,html:"\x3cdiv class\x3d'annotationHTML error'\x3e\x3c/div\x3e",rangeStyle:{styleClass:"annotationRange error"}});
k.prototype={initialize:function(e,f,h){this.textView=e;this.serviceRegistry=f;this.annotationModel=h;this.services=[];var c=this;this.listener={onModelChanging:function(a){c.onModelChanging(a)},onModelChanged:function(a){c.onModelChanged(a)},onDestroy:function(a){c.onDestroy(a)},onLineStyle:function(a){c.onLineStyle(a)},onStyleReady:function(a){c.onStyleReady(a)},onServiceAdded:function(a){c.onServiceAdded(a.serviceReference,c.serviceRegistry.getService(a.serviceReference))},onServiceRemoved:function(a){c.onServiceRemoved(a.serviceReference,
c.serviceRegistry.getService(a.serviceReference))}};e.addEventListener("ModelChanging",this.listener.onModelChanging);e.addEventListener("ModelChanged",this.listener.onModelChanged);e.addEventListener("Destroy",this.listener.onDestroy);e.addEventListener("LineStyle",this.listener.onLineStyle);f.addEventListener("registered",this.listener.onServiceAdded);f.addEventListener("unregistering",this.listener.onServiceRemoved);e=f.getServiceReferences(d);for(h=0;h<e.length;h++){var b=e[h];q(b)&&this.addServiceListener(f.getService(b))}},
onDestroy:function(d){this.destroy()},destroy:function(){this.textView&&(this.textView.removeEventListener("ModelChanging",this.listener.onModelChanging),this.textView.removeEventListener("ModelChanged",this.listener.onModelChanged),this.textView.removeEventListener("Destroy",this.listener.onDestroy),this.textView.removeEventListener("LineStyle",this.listener.onLineStyle),this.textView=null);if(this.services){for(var d=0;d<this.services.length;d++)this.removeServiceListener(this.services[d]);this.services=
null}this.serviceRegistry&&(this.serviceRegistry.removeEventListener("registered",this.listener.onServiceAdded),this.serviceRegistry.removeEventListener("unregistering",this.listener.onServiceRemoved),this.serviceRegistry=null);this.lineStyles=this.listener=null},onModelChanging:function(d){this.startLine=this.textView.getModel().getLineAtOffset(d.start)},onModelChanged:function(d){var f=this.startLine;(d.addedLineCount||d.removedLineCount)&&Array.prototype.splice.apply(this.lineStyles,[f,d.removedLineCount].concat(this._getEmptyStyle(d.addedLineCount)))},
onStyleReady:function(d){var f=d.lineStyles||d.style;d=Number.MAX_VALUE;var h=-1,c=this.textView.getModel(),b;for(b in f)Object.prototype.hasOwnProperty.call(f,b)&&(this.lineStyles[b]=f[b],d=Math.min(d,b),h=Math.max(h,b));d=Math.max(d,0);h=Math.min(h,c.getLineCount());if(f=this.annotationModel){for(var a=f.getAnnotations(c.getLineStart(d),c.getLineEnd(h)),m=[];a.hasNext();){var k=a.next();"orion.annotation.highlightError"===k.type&&m.push(k)}a=[];for(k=d;k<=h;k++){b=k;var n=this.lineStyles[b],n=n&&
n.errors;b=c.getLineStart(b);if(n)for(var p=0;p<n.length;p++){var q=n[p];a.push(s.AnnotationType.createAnnotation("orion.annotation.highlightError",q.start+b,q.end+b))}}f.replaceAnnotations(m,a)}this.textView.redrawLines(d,h+1)},onLineStyle:function(d){var f=this.lineStyles[d.lineIndex];if(f)if(f.ranges){for(var f=f.ranges,h=d.lineStart,c=f.length,b=[],a=0;a<c;a++){var m=f[a];b.push({start:m.start+h,end:m.end+h,style:m.style})}d.ranges=b}else f.style&&(d.style=f.style)},_getEmptyStyle:function(d){for(var f=
[],h=0;h<d;h++)f.push(null);return f},setContentType:function(d){this.contentType=d;if(this.services)for(d=0;d<this.services.length;d++){var f=this.services[d];if(f.setContentType){var h=this.serviceRegistry.getService("orion.page.progress");h?h.progress(f.setContentType(this.contentType),"Styling content type: "+this.contentType.id?this.contentType.id:this.contentType):f.setContentType(this.contentType)}}},onServiceAdded:function(d,f){q(d)&&this.addServiceListener(f)},onServiceRemoved:function(d,
f){-1!==this.services.indexOf(f)&&this.removeServiceListener(f)},addServiceListener:function(d){if("function"===typeof d.addEventListener){if(d.addEventListener("orion.edit.highlighter.styleReady",this.listener.onStyleReady),this.services.push(d),d.setContentType&&this.contentType){var l=this.serviceRegistry.getService("orion.page.progress");l?l.progress(d.setContentType(this.contentType),"Styling content type: "+this.contentType.id?this.contentType.id:this.contentType):d.setContentType(this.contentType)}}else"undefined"!==
typeof console&&console.log(Error(f))},removeServiceListener:function(d){"function"===typeof d.removeEventListener?(d.removeEventListener("orion.edit.highlighter.styleReady",this.listener.onStyleReady),d=this.services.indexOf(d),-1!==d&&this.services.splice(d,1)):"undefined"!==typeof console&&console.log(Error(f))}};return k});
define("orion/editor/mirror",["i18n!orion/editor/nls/messages","orion/editor/eventTarget","orion/editor/annotations"],function(p,s,q){function k(c){this.string=c;this.tokenStart=this.pos=0}function d(c,b){return{token:function(a,b){return a.skipToEnd()}}}function f(c){this._modes={};this.mimeModes={};this.options={};this.StringStream=k;this.defineMode("null",d);this.defineMIME("text/plain","null")}function e(c){var b=[],a;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&b.push(a);return b}function l(c,
b,a){a=a||{};this.model=c;this.codeMirror=b;this.isWhitespaceVisible="undefined"===typeof a.whitespacesVisible?!1:a.whitespacesVisible;this.mode=null;this.isModeLoaded=!1;this.lines=[];this.dirtyLines=[];this.startLine=Number.MAX_VALUE;this.endLine=-1;this.timer=null;this.initialize(c)}function h(c,b,a){this.init(c,b,a)}k.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return 0===this.pos},peek:function(){return this.string[this.pos]},next:function(){return this.string[this.pos++]},
eat:function(c){var b=this.string[this.pos];return"string"===typeof b&&(b===c||c.test&&c.test(b)||"function"===typeof c&&c(b))?this.string[this.pos++]:void 0},eatWhile:function(c){for(var b=!1;void 0!==this.eat(c);)b=!0;return b},eatSpace:function(){return this.eatWhile(/\s/)},skipToEnd:function(){this.pos=this.string.length},skipTo:function(c){c=this.string.indexOf(c,this.pos);return-1!==c?(this.pos=c,!0):!1},match:function(c,b,a){b=!0===b||"undefined"===typeof b;if("string"===typeof c){var d=a?
this.string.toLowerCase():this.string;c=a?c.toLowerCase():c;a=d.indexOf(c,this.pos);-1!==a&&b&&(this.pos=a+c.length);return-1!==a}if((c=this.string.substring(this.pos).match(c))&&b&&"string"===typeof c[0])this.pos+=c.index+c[0].length;return c},backUp:function(c){this.pos-=c},column:function(){for(var c=0,b=0;b<this.tokenStart;)c+="\t"===this.string[b++]?4:1;return c},indentation:function(){for(var c=this.string.search(/\S/),b=0,a=0;a<c;)b+="\t"===this.string[a++]?4:1;return b},current:function(){return this.string.substring(this.tokenStart,
this.pos)},advance:function(){this.tokenStart=this.pos}};f.prototype={options:{},setOption:function(c,b){this.options[c]=b},getOption:function(c){return this.options[c]},copyState:function(c,b){if("function"===typeof c.copyState)return c.copyState(b);var a={},d;for(d in b){var e=b[d];a[d]=e instanceof Array?e.slice():e}return a},startState:function(c,b){return c.startState(b)},defineMode:function(c,b){this._modes[c]=b},defineMIME:function(c,b){this.mimeModes[c]=b},getMode:function(c,b){var a={},d;
"string"===typeof b&&this.mimeModes[b]&&(b=this.mimeModes[b]);"object"===typeof b&&(a=b,d=this._modes[b.name]);d=d||this._modes[b];return"function"!==typeof d?("undefined"!==typeof console&&console&&console.log("Mode not found: "+b),this.getMode(c,"null")):d(c,a)},listModes:function(){return e(this._modes)},listMIMEs:function(){return e(this.mimeModes)},_getModeName:function(c){c=this.mimeModes[c];"object"===typeof c&&(c=c.name);return c}};l.prototype={initialize:function(c){var b=this;this.listener=
{onModelChanging:function(a){b._onModelChanging(a)},onModelChanged:function(a){b._onModelChanged(a)},onDestroy:function(a){b._onDestroy(a)}};this.model.addEventListener("Changing",this.listener.onModelChanging);this.model.addEventListener("Changed",this.listener.onModelChanged);this.model.addEventListener("Destroy",this.listener.onDestroy)},destroy:function(){this.model&&(this.model.removeEventListener("Changing",this.listener.onModelChanging),this.model.removeEventListener("Changed",this.listener.onModelChanged),
this.model.removeEventListener("Destroy",this.listener.onDestroy));this.dirtyLines=this.lines=this.mode=this.codeMirror=this.model=null;clearTimeout(this.timer);this.timer=null},_onModelChanging:function(c){this.startLine=this.model.getLineAtOffset(c.start)},_onModelChanged:function(c){this._dbgEvent(c);var b=this.startLine;(c.removedLineCount||c.addedLineCount)&&Array.prototype.splice.apply(this.lines,[b+1,c.removedLineCount].concat(this._newLines(c.addedLineCount)));this.mode&&(c=Math.max(c.addedLineCount,
c.removedLineCount),c=b+Math.min(c,500),this.highlight(b,c),this.highlightLater(c+1))},_onDestroy:function(c){this.destroy()},setViewportIndex:function(c){this.viewportIndex=c},_dbgEvent:function(c){},_dbgStyle:function(){},_newLines:function(c,b){for(var a=[],d=0;d<c;d++)a.push({style:null,eolState:null});return a},setMode:function(c,b){c&&(this.mode=this.codeMirror.getMode(this.codeMirror.options,c),this.lines=this._newLines(this.model.getLineCount()),b&&this.highlight())},highlight:function(c,
b,a){if(this.mode){var d=this.model.getLineCount();c="undefined"===typeof c?0:c;b="undefined"===typeof b?d-1:Math.min(b,d-1);for(var d=this.mode,e=this.getState(c),f=c;f<=b;f++){var h=this.lines[f];this.highlightLine(f,h,e);h.eolState=this.codeMirror.copyState(d,e)}this._expandRange(c,b);if(!a)this.onHighlightDone()}},highlightLater:function(c){this.dirtyLines.push(c);var b=this;this.timer=setTimeout(function(){b._highlightJob()},50)},_highlightJob:function(){for(var c=+new Date+30,b=this.mode.compareStates,
a=this.model.getLineCount();this.dirtyLines.length;){var d=this.viewportIndex,e=this.lines[d],d=e&&!e.eolState?d:this.dirtyLines.pop();if(d>=a)break;this._expandRange(d,d);for(var e=this._getResumeLineIndex(d),d=e+1,e=(e=0<=e&&this.lines[e].eolState)?this.codeMirror.copyState(this.mode,e):this.mode.startState(),f=0,h=d;h<a;h++){var l=this.lines[h],k=l.eolState,p=this.highlightLine(h,l,e);l.eolState=this.codeMirror.copyState(this.mode,e);p&&this._expandRange(d,h+1);var l=b&&k&&b(k,l.eolState),q=!b&&
!p&&3<f++;if(l||q)break;else if(!k||p)f=0;k=h<a||this.dirtyLines.length;if(+new Date>c&&k){this.highlightLater(h+1);this.onHighlightDone();return}}}this.onHighlightDone()},onHighlightDone:function(){this.startLine!==Number.MAX_VALUE&&-1!==this.endLine&&this.dispatchEvent({type:"Highlight",start:this.startLine,end:this.endLine});this.startLine=Number.MAX_VALUE;this.endLine=-1},_getResumeLineIndex:function(c){for(var b=this.lines,a=c-1;0<=a;a--)if(b[a].eolState||40<c-a)return a;return-1},getState:function(c){var b=
this.mode,a=this.lines,d,e;for(d=c-1;0<=d&&!(e=a[d],e.eolState||40<c-d);d--);var f=0<=d&&a[d].eolState;if(f){f=this.codeMirror.copyState(b,f);for(d=Math.max(0,d);d<c-1;d++)e=a[d],this.highlightLine(d,e,f),e.eolState=this.codeMirror.copyState(b,f);return f}return b.startState()},highlightLine:function(c,b,a){if(this.mode){var d=this.model;d.getLineStart(c)===d.getLineEnd(c)&&this.mode.blankLine&&this.mode.blankLine(a);var e=b.style||[];c=d.getLine(c);c=new k(c);for(var d=!b.style,f=[],h=0;!c.eol();h++){var l=
this.mode.token(c,a)||null,p=c.current();this._whitespaceStyle(l,p,c.tokenStart);l=[c.tokenStart,c.pos,l];p=e[h];f.push(l);d=d||!p||p[0]!==l[0]||p[1]!==l[1]||p[2]!==l[2];c.advance()}if(d=d||f.length!==e.length)b.style=f.length?f:null;return d}},_whitespaceStyle:function(c,b,a){if(!c&&this.isWhitespaceVisible&&/\s+/.test(b)){c=[];for(var d,e,f=0;f<b.length;f++){var h=b[f];h!==e&&(e&&c.push([a+d,a+f,"\t"===e?"punctuation separator tab":"punctuation separator space"]),d=f,e=h)}c.push([a+d,a+f,"\t"===
e?"punctuation separator tab":"punctuation separator space"]);return c}return null},_expandRange:function(c,b){this.startLine=Math.min(this.startLine,c);this.endLine=Math.max(this.endLine,b)},toStyleRangesAndErrors:function(c,b){var a=c.style;if(!a)return null;for(var d=[],e=[],f="undefined"===typeof b?0:this.model.getLineStart(b),h=0;h<a.length;h++){var l=a[h],k;k=(k=l[2])?"punctuation separator tab"===k||"punctuation separator space"===k?k:"cm-"+k:null;k&&(l={start:f+l[0],end:f+l[1],style:{styleClass:k}},
d.push(l),"cm-error"===k&&e.push(l))}return[d,e]},getLineStyle:function(c){return this.lines[c]},getLineStyles:function(){return this.lines}};s.EventTarget.addMixin(l.prototype);q.AnnotationType.registerType("orion.annotation.highlightError",{title:p.syntaxError,html:"\x3cdiv class\x3d'annotationHTML error'\x3e\x3c/div\x3e",rangeStyle:{styleClass:"annotationRange error"}});h.prototype={init:function(c,b,a){this.textView=c;this.annotationModel=a;this.modeApplier=new l(c.getModel(),b);var d=this;this.listener=
{onLineStyle:function(a){d.onLineStyle(a)},onDestroy:function(a){d.onDestroy(a)},onHighlight:function(a){d.onHighlight(a)}};c.addEventListener("LineStyle",this.listener.onLineStyle);c.addEventListener("Destroy",this.listener.onDestroy);this.modeApplier.addEventListener("Highlight",this.listener.onHighlight)},destroy:function(){this.modeApplier&&(this.modeApplier.removeEventListener("Highlight",this.listener.onHighlight),this.modeApplier.destroy());this.textView&&(this.textView.removeEventListener("LineStyle",
this.listener.onLineStyle),this.textView.removeEventListener("Destroy",this.listener.onDestroy));this.listener=this.modeApplier=this.annotationModel=this.textView=null},setMode:function(c){this.modeApplier.setMode(c)},onLineStyle:function(c){var b=c.lineIndex,a=this.modeApplier,d=a.getLineStyle(b);if(!d||!d.eolState){var e=this.textView.getModel().getLineCount();a.highlight(b,Math.min(b+20,e-1),!0);d=a.getLineStyle(b)}e=this.textView.getModel();if(d){var f=a.toStyleRangesAndErrors(d,b);if(f&&(c.ranges=
f[0],c=this.annotationModel)){a=[];d=[];if(f=f[1])for(var h=0;h<f.length;h++){var l=f[h];"cm-error"===l.style.styleClass&&d.push(q.AnnotationType.createAnnotation("orion.annotation.highlightError",l.start,l.end))}for(b=c.getAnnotations(e.getLineStart(b),e.getLineEnd(b));b.hasNext();)e=b.next(),"orion.annotation.highlightError"===e.type&&a.push(e);c.replaceAnnotations(a,d)}}},onHighlight:function(c){this.textView.redrawLines(c.start,c.end)},onDestroy:function(c){this.destroy()}};return{Mirror:f,ModeApplier:l,
CodeMirrorStyler:h}});
define("orion/editor/textMateStyler",["orion/regex"],function(p){function s(d){var f;if(d instanceof Array){f=Array(d.length);for(var e=0;e<d.length;e++)f[e]=s(d[e])}else for(e in f={},d)if(Object.prototype.hasOwnProperty.call(d,e)){var l=d[e];f[e]="object"===typeof l&&null!==l?s(l):l}return f}function q(d,f,e){this.initialize(d);this.grammar=s(f);this.externalGrammars=e?s(e):[];this._styles={};this._tree=null;this._allGrammars={};this.preprocess(this.grammar)}var k={unsupported:[{regex:/\(\?[ims\-]:/,func:function(d){return"option on/off for subexp"}},
{regex:/\(\?<([=!])/,func:function(d){return"\x3d"===d[1]?"lookbehind":"negative lookbehind"}},{regex:/\(\?>/,func:function(d){return"atomic group"}}],toRegExp:function(d){function f(c,b){throw Error('Unsupported regex feature "'+c+'": "'+b[0]+'" at index: '+b.index+" in "+b.input);}var e="",l;d=k.processGlobalFlag("x",d,function(c){for(var b="",a=!1,d=c.length,e=0;e<d;){var f=c.charAt(e);if(!a&&"#"===f)for(;e<d&&"\r"!==f&&"\n"!==f;)f=c.charAt(++e);else if(!a&&/\s/.test(f))for(;e<d&&/\s/.test(f);)f=
c.charAt(++e);else"\\"===f?(b+=f,/\s/.test(c.charAt(e+1))||(b+=c.charAt(e+1),e+=1)):("["===f?a=!0:"]"===f&&(a=!1),b+=f),e+=1}return b});d=k.processGlobalFlag("i",d,function(c){e+="i";return c});for(l=0;l<this.unsupported.length;l++){var h;(h=this.unsupported[l].regex.exec(d))&&f(this.unsupported[l].func(h),h)}return RegExp(d,e)},processGlobalFlag:function(d,f,e){var l="(?"+d+")";d="(?"+d+":";if(f.substring(0,l.length)===l)return e(f.substring(l.length));if(f.substring(0,d.length)===d){for(var l=0,
h=f.length,c=-1,b=0;b<h&&-1===c;b++)switch(f.charAt(b)){case "\\":b++;break;case "(":l++;break;case ")":l--,0===l&&(c=b)}l=c;if(l<f.length-1)throw Error("Only a "+d+") group that encloses the entire regex is supported in: "+f);return e(f.substring(d.length,l))}return f},hasBackReference:function(d){return/\\\d+/.test(d.source)},getSubstitutedRegex:function(d,f,e){e="undefined"===typeof e?!0:!1;d=d.source.split(/(\\\d+)/g);for(var l=[],h=0;h<d.length;h++){var c=d[h],b=/\\(\d+)/.exec(c);b?(c=f[b[1]]||
"",l.push(e?p.escape(c):c)):l.push(c)}return RegExp(l.join(""))},groupify:function(d,f){for(var e=d.source,l=e.length,h=[],c=0,b=[],a=1,m=1,k=[],n={},p={},q=0;q<l;q++){var s=h[h.length-1],w=e.charAt(q);switch(w){case "(":4===s&&(h.pop(),k.push(")"),b[b.length-1].end=q);var y=q+2<l?e.charAt(q+1)+""+e.charAt(q+2):null;if("?:"===y||"?\x3d"===y||"?!"===y){var A;"?:"===y?A=1:(A=3,c++);h.push(A);b.push({start:q,end:-1,type:A});k.push(w);k.push(y);q+=y.length}else h.push(2),b.push({start:q,end:-1,type:2,
oldNum:a,num:m}),k.push(w),0===c&&(p[m]=null),n[a]=m,a++,m++;break;case ")":s=h.pop();3===s&&c--;b[b.length-1].end=q;k.push(w);break;case "*":case "+":case "?":case "}":var z=w,g=e.charAt(q-1),y=q-1;if("}"===w){for(A=q-1;"{"!==e.charAt(A)&&0<=A;A--);g=e.charAt(A-1);y=A-1;z=e.substring(A,q+1)}A=b[b.length-1];if(")"===g&&(2===A.type||4===A.type)){k.splice(A.start,0,"(");k.push(z);k.push(")");w={start:A.start,end:k.length-1,type:4,num:A.num};for(g=0;g<b.length;g++)if(s=b[g],(2===s.type||4===s.type)&&
s.start>=A.start&&s.end<=y)s.start+=1,s.end+=1,s.num+=1,2===s.type&&(n[s.oldNum]=s.num);b.push(w);m++;break}default:"|"!==w&&(2!==s&&4!==s)&&0===c&&(h.push(4),b.push({start:q,end:-1,type:4,num:m}),k.push("("),p[m]=null,m++),k.push(w),"\\"===w&&(w=e.charAt(q+1),k.push(w),q+=1)}}for(;h.length;)h.pop(),k.push(")");e=RegExp(k.join(""));l={};f=f||n;for(var r in f)f.hasOwnProperty(r)&&(l[r]="\\"+f[r]);e=this.getSubstitutedRegex(e,l,!1);return[e,n,p]},complexCaptures:function(d){if(!d)return!1;for(var f in d)if(d.hasOwnProperty(f)&&
"0"!==f)return!0;return!1}};q.prototype={initialize:function(d){this.textView=d;this.textView.stylerOptions=this;var f=this;this._listener={onModelChanged:function(d){f.onModelChanged(d)},onDestroy:function(d){f.onDestroy(d)},onLineStyle:function(d){f.onLineStyle(d)},onStorage:function(d){f.onStorage(d)}};d.addEventListener("ModelChanged",this._listener.onModelChanged);d.addEventListener("Destroy",this._listener.onDestroy);d.addEventListener("LineStyle",this._listener.onLineStyle);d.redrawLines()},
onDestroy:function(d){this.destroy()},destroy:function(){this.textView&&(this.textView.removeEventListener("ModelChanged",this._listener.onModelChanged),this.textView.removeEventListener("Destroy",this._listener.onDestroy),this.textView.removeEventListener("LineStyle",this._listener.onLineStyle),this.textView=null);this._listener=this._tree=this._styles=this.grammar=null},preprocess:function(d){for(d=[d];0!==d.length;){var f=d.pop();if(!f._resolvedRule||!f._typedRule)if(f._resolvedRule=this._resolve(f),
f._typedRule=this._createTypedRule(f),this.addStyles(f.name),this.addStyles(f.contentName),this.addStylesForCaptures(f.captures),this.addStylesForCaptures(f.beginCaptures),this.addStylesForCaptures(f.endCaptures),f._resolvedRule!==f&&d.push(f._resolvedRule),f.patterns)for(var e=0;e<f.patterns.length;e++)d.push(f.patterns[e])}},addStyles:function(d){if(d&&!this._styles[d]){this._styles[d]=[];for(var f=d.split("."),e=0;e<f.length;e++)this._styles[d].push(f.slice(0,e+1).join("-"))}},addStylesForCaptures:function(d){for(var f in d)d.hasOwnProperty(f)&&
this.addStyles(d[f].name)},ContainerRule:function(){function d(d){this.rule=d;this.subrules=d.patterns}d.prototype.valueOf=function(){return"aa"};return d}(),BeginEndRule:function(){function d(d){this.rule=d;this.beginRegex=k.toRegExp(d.begin);this.endRegex=k.toRegExp(d.end);this.subrules=d.patterns||[];this.endRegexHasBackRef=k.hasBackReference(this.endRegex);var e=k.complexCaptures(d.captures);d=k.complexCaptures(d.beginCaptures)||k.complexCaptures(d.endCaptures);if(this.isComplex=e||d)e=k.groupify(this.beginRegex),
this.beginRegex=e[0],this.beginOld2New=e[1],this.beginConsuming=e[2],e=k.groupify(this.endRegex,this.beginOld2New),this.endRegex=e[0],this.endOld2New=e[1],this.endConsuming=e[2]}d.prototype.valueOf=function(){return this.beginRegex};return d}(),MatchRule:function(){function d(d){this.rule=d;this.matchRegex=k.toRegExp(d.match);if(this.isComplex=k.complexCaptures(d.captures))d=k.groupify(this.matchRegex),this.matchRegex=d[0],this.matchOld2New=d[1],this.matchConsuming=d[2]}d.prototype.valueOf=function(){return this.matchRegex};
return d}(),_createTypedRule:function(d){return d.match?new this.MatchRule(d):d.begin?new this.BeginEndRule(d):new this.ContainerRule(d)},_resolve:function(d){var f=d;if(d.include){if(d.begin||d.end||d.match)throw Error('Unexpected regex pattern in "include" rule '+d.include);d=d.include;if("#"===d.charAt(0)){if(f=this.grammar.repository&&this.grammar.repository[d.substring(1)],!f)throw Error("Couldn't find included rule "+d+" in grammar repository");}else if("$self"===d)f=this.grammar;else{if("$base"===
d)throw Error('Include "$base" is not supported');f=this._allGrammars[d];if(!f)for(var e=0;e<this.externalGrammars.length;e++){var l=this.externalGrammars[e];if(l.scopeName===d){this.preprocess(l);f=this._allGrammars[d]=l;break}}}}return f},ContainerNode:function(){function d(d,e){this.parent=d;this.rule=e;this.children=[];this.end=this.start=null}d.prototype.addChild=function(d){this.children.push(d)};d.prototype.valueOf=function(){var d=this.rule;return"ContainerNode { "+(d.include||"")+" "+(d.name||
"")+(d.comment||"")+"}"};return d}(),BeginEndNode:function(){function d(d,e,l){this.parent=d;this.rule=e;this.children=[];this.setStart(l);this.endMatch=this.end=null;this.endRegexSubstituted=e.endRegexHasBackRef?k.getSubstitutedRegex(e.endRegex,l):null}d.prototype.addChild=function(d){this.children.push(d)};d.prototype.getIndexInParent=function(d){return this.parent?this.parent.children.indexOf(this):-1};d.prototype.setStart=function(d){this.start=d.index;this.beginMatch=d};d.prototype.setEnd=function(d){d&&
"object"===typeof d?(this.endMatch=d,this.end=d.index+d[0].length):(this.endMatch=null,this.end=d)};d.prototype.shiftStart=function(d){this.start+=d;this.beginMatch.index+=d};d.prototype.shiftEnd=function(d){this.end+=d;this.endMatch&&(this.endMatch.index+=d)};d.prototype.valueOf=function(){return"{"+this.rule.beginRegex+" range\x3d"+this.start+".."+this.end+"}"};return d}(),push:function(d,f){if(f)for(var e=f.length;0<e;)d.push(f[--e])},exec:function(d,f,e){if(f=d.exec(f))f.index+=e;d.lastIndex=
0;return f},afterMatch:function(d){return d.index+d[0].length},getEndMatch:function(d,f,e){if(d instanceof this.BeginEndNode){var l=d.rule;d=d.endRegexSubstituted||l.endRegex;return!d?null:this.exec(d,f,e)}return null},initialParse:function(){this.textView.getModel().getCharCount();this._tree=new this.ContainerNode(null,this.grammar._typedRule);this.parse(this._tree,!1,0)},onModelChanged:function(d){var f=d.addedCharCount,e=d.removedCharCount;d=d.start;if(this._tree){var l=this.textView.getModel(),
h=l.getCharCount(),l=l.getLineEnd(l.getLineAtOffset(d)-1),c=this.getFirstDamaged(l,l),l=-1===l?0:l,f=c?this.parse(c,!0,l,d,f,e):h;this.textView.redrawRange(l,f)}else this.initialParse()},getFirstDamaged:function(d,f){if(0>d)return this._tree;for(var e=[this._tree],l=null;e.length;){var h=e.pop();if(!h.parent||this.isDamaged(h,d,f)){h instanceof this.BeginEndNode&&(l=h);for(var c=0;c<h.children.length;c++)e.push(h.children[c])}}return l||this._tree},isDamaged:function(d,f,e){return d.start<=e&&d.end>
f},parse:function(d,f,e,l,h,c){var b=this.textView.getModel(),a=b.getLineStart(b.getLineCount()-1),m=b.getCharCount(),k=this.getInitialExpected(d,e),n=-1;f&&(d.repaired=!0,d.endNeedsUpdate=!0,n=(n=d.children[d.children.length-1])?b.getLineEnd(b.getLineAtOffset(n.end+(h-c))):-1,l=b.getLineEnd(b.getLineAtOffset(l+c)),n=Math.max(n,l));n=-1===n?m:n;l=k;for(var p=d,q=!1,s=e,w=-1;p&&(!f||s<n);){var y=this.getNextMatch(b,p,s);y||(s=s>=a?m:b.getLineStart(b.getLineAtOffset(s)+1));var A=y&&y.match,z=y&&y.rule,
g=y&&y.isEnd;if(y&&y.isSub)s=this.afterMatch(A),z instanceof this.BeginEndRule&&(q=!0,f&&z===l.rule&&p===l.parent?(p=l,p.setStart(A),p.repaired=!0,p.endNeedsUpdate=!0,l=this.getNextExpected(l,"begin")):(f&&(this.prune(p,l),f=!1),A=new this.BeginEndNode(p,z,A),p.addChild(A),p=A));else if(g||s===m)p instanceof this.BeginEndNode&&(A?(q=!0,w=Math.max(w,p.end),p.setEnd(A),s=this.afterMatch(A),f&&p===l&&p.parent===l.parent?(p.repaired=!0,delete p.endNeedsUpdate,l=this.getNextExpected(l,"end")):f&&(this.prune(p,
l),f=!1)):(p.setEnd(m),delete p.endNeedsUpdate)),p=p.parent;f&&(s>=n&&!q)&&(this.prune(d,k),f=!1)}this.removeUnrepairedChildren(d,f,e);this.cleanup(f,d,e,n,m,h,c);return f?Math.max(w,s):s},removeUnrepairedChildren:function(d,f,e){if(f){f=d.children;for(var l=-1,h=0;h<f.length;h++){var c=f[h];if(!c.repaired&&this.isDamaged(c,e,Number.MAX_VALUE)){l=h;break}}-1!==l&&(d.children.length=l)}},cleanup:function(d,f,e,l,h,c,b){if(d){d=c-b;h=this.getIntersecting(l-d+1,h);f=this.getIntersecting(e,l);for(e=0;e<
h.length;e++)l=h[e],!l.repaired&&l instanceof this.BeginEndNode&&(l.shiftEnd(d),l.shiftStart(d));for(e=0;e<f.length;e++)l=f[e],l.repaired&&l.endNeedsUpdate&&l.shiftEnd(d),delete l.endNeedsUpdate,delete l.repaired}else{f=this.getIntersecting(e,l);for(e=0;e<f.length;e++)delete f[e].repaired}},getNextMatch:function(d,f,e,l){var h=d.getLineAtOffset(e),h=d.getLineEnd(h),c=d.getText(e,h),b=[],a=[];d=[];h=[];for(this.push(b,f.rule.subrules);b.length;){var m=b.length?b.pop():null,m=m&&m._resolvedRule._typedRule;
if(m instanceof this.ContainerRule&&-1===a.indexOf(m))a.push(m),this.push(b,m.subrules);else if(!m||!l||m.matchRegex){var k=m&&this.exec(m.matchRegex||m.beginRegex,c,e);k&&(d.push(k),h.push(m))}}b=Number.MAX_VALUE;a=-1;for(m=0;m<d.length;m++)k=d[m],k.index<b&&(b=k.index,a=m);if(!l&&(e=this.getEndMatch(f,c,e)))if(l=f.rule.applyEndPatternLast,-1===a||e.index<b||!l&&e.index===b)return{isEnd:!0,rule:f.rule,match:e};return-1===a?null:{isSub:!0,rule:h[a],match:d[a]}},getInitialExpected:function(d,f){var e,
l;if(d===this._tree)for(e=0;e<d.children.length;e++){if(l=d.children[e],l.start>=f)return l}else if(d instanceof this.BeginEndNode&&d.endMatch){var h=d.endMatch.index;for(e=0;e<d.children.length&&!(l=d.children[e],l.start>=f);e++);if(l&&l.start<h)return l}return d},getNextExpected:function(d,f){if("begin"===f){var e=d.children[0];return e?e:d}if("end"===f&&(e=d.parent)){var l=e.children[e.children.indexOf(d)+1];return l?l:e}return null},prune:function(d,f){f.parent===d?d.children.length=f.getIndexInParent():
d instanceof this.BeginEndNode&&(d.endMatch=null,d.end=null);d.parent&&(d.parent.children.length=d.getIndexInParent()+1)},onLineStyle:function(d){this._tree||this.initialParse();var f=d.lineStart,e=this.textView.getModel(),l=e.getLineEnd(d.lineIndex),h=e.getLineEnd(e.getLineAtOffset(f)-1),h=this.getFirstDamaged(h,h),f=this.getLineScope(e,h,f,l);d.ranges=this.toStyleRanges(f);d.ranges.sort(function(c,b){return c.start-b.start})},getLineScope:function(d,f,e,l){for(var h=e,c=this.getInitialExpected(f,
e),b=[],a=[];f&&h<l;){var k=this.getNextMatch(d,f,h);if(!k)break;var p=k&&k.match,n=k&&k.rule,q=k&&k.isSub,k=k&&k.isEnd;p.index!==h&&a.push({start:h,end:p.index,node:f});q?(h=this.afterMatch(p),n instanceof this.BeginEndRule?(this.addBeginScope(b,p,n),f=c,c=this.getNextExpected(c,"begin")):this.addMatchScope(b,p,n)):k&&(h=this.afterMatch(p),this.addEndScope(b,p,n),c=this.getNextExpected(c,"end"),f=f.parent)}h<l&&a.push({start:h,end:l,node:f});d=this.getInheritedLineScope(a,e,l);return b.concat(d)},
getInheritedLineScope:function(d,f,e){f=[];for(e=0;e<d.length;e++)for(var k=d[e],h=k.node;h;){var c=h.rule.rule,b=c.name;if(c=c.contentName||b){this.addScopeRange(f,k.start,k.end,c);break}h=h.parent}return f},addBeginScope:function(d,f,e){var k=e.rule;this.addCapturesScope(d,f,k.beginCaptures||k.captures,e.isComplex,e.beginOld2New,e.beginConsuming)},addEndScope:function(d,f,e){var k=e.rule;this.addCapturesScope(d,f,k.endCaptures||k.captures,e.isComplex,e.endOld2New,e.endConsuming)},addMatchScope:function(d,
f,e){var k=e.rule,h=k.name;(k=k.captures)?this.addCapturesScope(d,f,k,e.isComplex,e.matchOld2New,e.matchConsuming):this.addScope(d,f,h)},addScope:function(d,f,e){e&&d.push({start:f.index,end:this.afterMatch(f),scope:e})},addScopeRange:function(d,f,e,k){k&&d.push({start:f,end:e,scope:k})},addCapturesScope:function(d,f,e,k,h,c){if(e)if(k){k={1:0};for(var b=0,a=1;void 0!==f[a];a++)void 0!==c[a]&&(b+=f[a].length),void 0!==f[a+1]&&(k[a+1]=b);c=f.index;for(b=1;e[b];b++){var a=e[b].name,m=h[b],p=c+k[m];
"undefined"!==typeof f[m]&&this.addScopeRange(d,p,p+f[m].length,a)}}else this.addScope(d,f,e[0]&&e[0].name)},getIntersecting:function(d,f){for(var e=[],k=this._tree?[this._tree]:[];k.length;){var h=k.pop(),c=!1;h instanceof this.ContainerNode?c=!0:this.isDamaged(h,d,f)&&(c=!0,e.push(h));if(c)for(var c=h.children.length,b=0;b<c;b++)k.push(h.children[b])}return e.reverse()},toStyleRanges:function(d){for(var f=[],e=0;e<d.length;e++){var k=d[e],h=this._styles[k.scope];if(!h)throw Error("styles not found for "+
k.scope);h=h.join(" ");f.push({start:k.start,end:k.end,style:{styleClass:h}})}return f}};return{RegexUtil:k,TextMateStyler:q}});
define("orion/editor/htmlGrammar",[],function(){return{HtmlGrammar:function(){return{scopeName:"source.html",uuid:"3B5C76FB-EBB5-D930-F40C-047D082CE99B",patterns:[{begin:"\x3c!(doctype|DOCTYPE)",end:"\x3e",contentName:"entity.name.tag.doctype.html",beginCaptures:{0:{name:"entity.name.tag.doctype.html"}},endCaptures:{0:{name:"entity.name.tag.doctype.html"}}},{begin:"\x3c!--",end:"--\x3e",beginCaptures:{0:{name:"punctuation.definition.comment.html"}},endCaptures:{0:{name:"punctuation.definition.comment.html"}},
patterns:[{match:"--",name:"invalid.illegal.badcomment.html"}],contentName:"comment.block.html"},{match:"\x3c[A-Za-z0-9_\\-:]+(?\x3d ?)",name:"entity.name.tag.html"},{include:"#attrName"},{include:"#qString"},{include:"#qqString"},{include:"#entity"},{match:"\x3c/[A-Za-z0-9_\\-:]+\x3e",name:"entity.name.tag.html"},{match:"\x3e",name:"entity.name.tag.html"}],repository:{attrName:{match:"[A-Za-z\\-:]+(?\x3d\\s*\x3d\\s*['\"])",name:"entity.other.attribute.name.html"},qqString:{match:'(")[^"]+(")',name:"string.quoted.double.html"},
qString:{match:"(')[^']+(')",name:"string.quoted.single.html"},entity:{match:"\x26[A-Za-z0-9]+;",name:"constant.character.entity.html"}}}}}});
define("orion/editor/textStyler",["orion/editor/annotations"],function(p){function s(a,b){this._unnamedCounter=0;this._patterns=[];this._rootId=b;a.forEach(function(a){this._addRepositoryPatterns(a.repository||{},a.id);this._addPatterns(a.patterns||[],a.id)}.bind(this))}function q(a,b,c,d,e){this.start=a.start;this.end=a.end;this.contentStart=a.contentStart;this.contentEnd=a.contentEnd;this.pattern=b;this._styler=c;this._parent=e;this._linePatterns=[];this._blockPatterns=[];this._enclosurePatterns=
{};d&&(this._initPatterns(),this._subBlocks=y(d,d.getText(this.start,this.end),this,this.start))}function k(a){this._styler=a}function d(a,b,c,d){this.highlightCaretLine=this.whitespacesVisible=this.spacesVisible=this.tabsVisible=!1;this.detectTasks=this.foldingEnabled=!0;this.view=a;this.annotationModel=b;this.patternManager=new s(c,d);this._accessor=new k(this);this._bracketAnnotations=void 0;var e=this;this._listener={onChanged:function(a){e._onModelChanged(a)},onDestroy:function(a){e._onDestroy(a)},
onLineStyle:function(a){e._onLineStyle(a)},onMouseDown:function(a){e._onMouseDown(a)},onSelection:function(a){e._onSelection(a)}};c=a.getModel();c.getBaseModel&&(c=c.getBaseModel());c.addEventListener("Changed",this._listener.onChanged);a.addEventListener("MouseDown",this._listener.onMouseDown);a.addEventListener("Selection",this._listener.onSelection);a.addEventListener("Destroy",this._listener.onDestroy);a.addEventListener("LineStyle",this._listener.onLineStyle);d=c.getCharCount();this._rootBlock=
new q({start:0,contentStart:0,end:d,contentEnd:d},null,this,c);b&&(d=[],b.removeAnnotations(p.AnnotationType.ANNOTATION_FOLDING),this._computeFolding(this._rootBlock.getBlocks(),a.getModel(),d),this.detectTasks&&(b.removeAnnotations(p.AnnotationType.ANNOTATION_TASK),A(this._rootBlock,c,d)),b.replaceAnnotations([],d));a.redrawLines()}var f={styleClass:"meta annotation currentLine"},e=/$/,l=/\\(\d)/g,h=/^\(\?i\)\s*/,c=/(.*)(?:[\r\n]|$)/g,b={regex:/[ ]/g,style:{styleClass:"punctuation separator space",
unmergeable:!0}},a={regex:/\t/g,style:{styleClass:"punctuation separator tab",unmergeable:!0}},m=function(a,b,c,d,e){var f;void 0===d&&(d=-1);void 0===e&&(e=a.length);for(;1<e-d;)if(f=Math.floor((e+d)/2),b<=a[f].start)e=f;else if(c&&b<a[f].end){e=f;break}else d=f;return e},t=function(a,b,d,e){var f=d,k=a.lastIndex;c.lastIndex=d;d=c.exec(b);var h,m;a.lastIndex=0;if(d){for(m=d.index;0<=--m&&!(h=b.charAt(m),"\n"===h||"\r"===h););h=b.substring(m+1,d.index+d[1].length);a.lastIndex=m=d.index-m-1}for(;d&&
d.index<b.length;){var l;if(e){var n=a.lastIndex;a.test(h)&&(a.lastIndex=n,l=a.exec(h))}else l=a.exec(h);if(l)return l.index+=f,l.index-=m,a.lastIndex=k,l;m=0;f+=d[0].length;if(d=c.exec(b))h=d[1],a.lastIndex=0}a.lastIndex=k;return null},n=function(a,b){var c=a.toString();l.lastIndex=0;if(!l.test(c))return a;l.lastIndex=0;for(var d=l.exec(c);d;)c=c.replace(d[0],b[d[1]]||""),l.lastIndex=0,d=l.exec(c);return RegExp(c.substring(1,c.length-1-1),"g")},u=function(a,b,c,d,e){var f=a.pattern.regex?a.pattern.regex:
a.pattern.regexBegin;e=e||Infinity;if((b=t(f,b,d,!0))&&b.index<e){a.result=b;for(e=0;e<c.length;e++)if(b.index<c[e].result.index||b.index===c[e].result.index&&a.pattern.pattern.index<c[e].pattern.pattern.index){c.splice(e,0,a);return}c.push(a)}},v=function(a,b,c,d){if(b[0])d.push({start:c,end:c+a[0].length,style:b[0].name});else for(var e=0,f=1;f<a.length;f++)if(a[f]){var k=b[f];if(k){var h=c+e;d.push({start:h,end:h+a[f].length,style:k.name})}e+=a[f].length}},x=function(a,b,c){var d=a.start;b.forEach(function(b){d<=
b.start&&c.push({start:d,end:b.start,style:a.style});c.push(b);d=b.end});d<a.end&&c.push({start:d,end:a.end,style:a.style})},w=function(a,b,c,d,f){if(a&&(c=c.getLinePatterns())){var k=[];c.forEach(function(b){var c=b.regex||b.regexBegin;c.oldLastIndex=c.lastIndex;(c=t(c,a,0))&&k.push({result:c,pattern:b})});k.sort(function(a,b){return a.result.index<b.result.index?-1:a.result.index>b.result.index?1:a.pattern.pattern.index<b.pattern.pattern.index?-1:1});for(var h=0;0<k.length;){var m=k[0];k.splice(0,
1);if(!(m.result.index<h)){var l=m.result.index,p,q=[];if(m.pattern.regex){h=m.result;p=l+h[0].length;p={start:b+l,end:b+p,style:m.pattern.pattern.name};if(!f){m.pattern.pattern.captures&&v(h,m.pattern.pattern.captures,b+l,q);q.sort(function(a,b){return a.start<b.start?-1:a.start>b.start?1:0});for(l=0;l<q.length-1;l++)if(q[l+1].start<q[l].end){var s={start:q[l+1].end,end:q[l].end,style:q[l].style};q[l].end=q[l+1].start;q.splice(l+2,0,s)}}x(p,q,d)}else h=m.pattern.regexEnd,h=n(h,m.result),h=t(h,a,
m.result.index+m.result[0].length),h||(e.lastIndex=0,h=e.exec(a)),p=h.index+h[0].length,d.push({start:b+l,end:b+p,style:m.pattern.pattern.name});h=h.index+h[0].length}u(m,a,k,h)}c.forEach(function(a){a=a.regex||a.regexBegin;a.lastIndex=a.oldLastIndex})}},y=function(a,b,c,d,f,h,k){if(!b)return[];var m=[],l=[];f=f||0;h=h||Infinity;k=k||Infinity;c.getBlockPatterns().forEach(function(a){var c=t(a.regexBegin||a.regex,b,f);c&&l.push({result:c,pattern:a})}.bind(this));if(!l.length)return m;l.sort(function(a,
b){return a.result.index<b.result.index?-1:a.result.index>b.result.index?1:a.pattern.pattern.index<b.pattern.pattern.index?-1:1});for(var p=0;0<l.length;){var s=l[0];l.splice(0,1);if(h<s.result.index)break;if(!(s.result.index<p)){var p=d+s.result.index,v=s.result.index,w=null,x=s.pattern.regexEnd;if(x){var v=v+s.result[0].length,E=s.pattern,y=n(x,s.result);y!==x&&(E={pattern:E.pattern,regexBegin:E.regexBegin,regexEnd:y},x=y);for(y=v;!w;){y=t(x,b,y);y||(e.lastIndex=0,y=e.exec(b),E={pattern:E.pattern,
regexBegin:E.regexBegin,regexEnd:e});var O=new q({start:p,end:d+y.index+y[0].length,contentStart:d+v,contentEnd:d+y.index},E,c.getStyler(),a,c),J=O.getBlocks();if(!J.length||J[J.length-1].end<=y.index+d)w=O;y=y.index+y[0].length}}else w=new q({start:p,end:p+s.result[0].length,contentStart:p,contentEnd:p+s.result[0].length},s.pattern,c.getStyler(),a,c);m.push(w);if(m.length===k||h<=w.end)break;p=w.end-d}u(s,b,l,p,h)}return m},A=function(a,b,c,d,e){d=d||a.start;e=e||a.end;if(a.start<=e&&d<=a.end&&a.getAnnotationModel()){var f=
p.AnnotationType.ANNOTATION_TASK;if(a.getLinePatterns().length&&a.pattern&&a.pattern.pattern.name&&0===a.pattern.pattern.name.indexOf("comment")){var h=[];w(b.getText(a.contentStart,a.end),a.contentStart,a,h,!0);for(var k=0;k<h.length;k++)"meta.annotation.task.todo"===h[k].style&&(d<=h[k].start&&h[k].end<=e)&&c.push(p.AnnotationType.createAnnotation(f,h[k].start,h[k].end,b.getText(h[k].start,h[k].end)))}a.getBlocks().forEach(function(a){A(a,b,c,d,e)}.bind(this))}};s.prototype={getPatterns:function(a){a?
(a="string"===typeof a?a:a.qualifiedId,a+="#"):a=this._rootId+"#"+this._NO_ID;var b=[0],c={},d=RegExp("^"+a+"[^#]+$");this._patterns.forEach(function(a){d.test(a.qualifiedId)&&(a.include?this._processInclude(a,b,c):(a.index=b[0]++,c[a.id]=a))}.bind(this));var e=[];Object.keys(c).forEach(function(a){e.push(c[a])});return e},_addPatterns:function(a,b){a.forEach(function(a){this._addPattern(a,this._NO_ID+this._unnamedCounter++,b)}.bind(this))},_addRepositoryPatterns:function(a,b){Object.keys(a).forEach(function(c){this._addPattern(a[c],
c,b)}.bind(this))},_addPattern:function(a,b,c){a.parentId=c;a.id=b;a.qualifiedId=a.parentId+"#"+a.id;this._patterns.push(a);a.patterns&&!a.include&&this._addPatterns(a.patterns,a.qualifiedId)},_processInclude:function(a,b,c){var d,e=a.include.indexOf("#");d=0===e?RegExp("^"+a.qualifiedId.substring(0,a.qualifiedId.indexOf("#"))+a.include+"$"):-1===e?RegExp("^"+a.include+"#"+this._NO_ID+"[^#]+$"):RegExp("^"+a.include+"$");this._patterns.forEach(function(a){d.test(a.qualifiedId)&&(a.include?this._processInclude(a,
b,c):c[a.id]||(a.index=b[0]++,c[a.id]=a))}.bind(this))},_NO_ID:"NoID"};q.prototype={adjustBounds:function(a,b){a<this.start&&(this.start+=b);a<this.contentStart&&(this.contentStart+=b);a<=this.end&&(this.end+=b);a<=this.contentEnd&&(this.contentEnd+=b);this._subBlocks.forEach(function(c){a<=c.end&&c.adjustBounds(a,b)})},computeStyle:function(a,b){if(!this.pattern||!(this.start<=b&&b<this.end))return null;var c={start:this.start,end:this.end,style:this.pattern.pattern.name};if(this.contentStart<=b&&
b<this.contentEnd)return this.pattern.pattern.contentName?{start:this.contentStart,end:this.contentEnd,style:this.pattern.pattern.contentName}:c;var d,e,f,h;if(b<this.contentStart){e=this.pattern.pattern.beginCaptures||this.pattern.pattern.captures;if(!e)return c;d=this.pattern.regexBegin;f=a.getText(this.start,this.contentStart);h=this.start}else{e=this.pattern.pattern.endCaptures||this.pattern.pattern.captures;if(!e)return c;d=this.pattern.regexEnd;f=a.getText(this.contentEnd,this.end);h=this.contentEnd}d.lastIndex=
0;if(d=d.exec(f))if(f=[],v(d,e,h,f),(e=f[m(f,b,!0)])&&e.start<=b&&b<e.end)return e;return c},getAnnotationModel:function(){return this._styler._getAnnotationModel()},getBlockPatterns:function(){return this._blockPatterns},getBlocks:function(){return this._subBlocks},getEnclosurePatterns:function(){return this._enclosurePatterns},getLinePatterns:function(){return this._linePatterns},getParent:function(){return this._parent},getPatternManager:function(){return this._styler._getPatternManager()},getPatterns:function(){return this.getLinePatterns()},
getStyler:function(){return this._styler},isRenderingWhitespace:function(){return this._styler._isRenderingWhitespace()},_initPatterns:function(){if(this.pattern&&this.pattern.pattern._linePatterns)this._linePatterns=this.pattern.pattern._linePatterns,this._blockPatterns=this.pattern.pattern._blockPatterns,this._enclosurePatterns=this.pattern.pattern._enclosurePatterns;else{var a=function(a){a="string"===typeof a?a:a.match;var b=h.exec(a),c="g";b&&(a=a.substring(b[0].length),c+="i");return RegExp(a,
c)},b=-1,c=0;this.getPatternManager().getPatterns(this.pattern?this.pattern.pattern:null).forEach(function(d){var e;if(d.match&&!d.begin&&!d.end){if(e={regex:a(d.match),pattern:d},this._linePatterns.push(e),d.name&&0===d.name.indexOf("punctuation.section")&&(-1!==d.name.indexOf(".begin")||-1!==d.name.indexOf(".end")))this._enclosurePatterns[d.name]=e}else!d.match&&(d.begin&&d.end)&&(b=c,e={regexBegin:a(d.begin),regexEnd:a(d.end),pattern:d},this._linePatterns.push(e));c++}.bind(this));this._blockPatterns=
this._linePatterns.slice(0,b+1);this.pattern&&(this.pattern.pattern._enclosurePatterns=this._enclosurePatterns,this.pattern.pattern._linePatterns=this._linePatterns,this.pattern.pattern._blockPatterns=this._blockPatterns)}}};k.prototype={getPatterns:function(a){return this._styler.getPatterns(a)},getStyles:function(a){return this._styler.getStyles(a)}};d.prototype={destroy:function(){var a=this.view;if(a){var b=a.getModel();b.getBaseModel&&(b=b.getBaseModel());b.removeEventListener("Changed",this._listener.onChanged);
a.removeEventListener("MouseDown",this._listener.onMouseDown);a.removeEventListener("Selection",this._listener.onSelection);a.removeEventListener("Destroy",this._listener.onDestroy);a.removeEventListener("LineStyle",this._listener.onLineStyle);this.view=null}},getPatterns:function(a){return this._findBlock(this._rootBlock,a).getPatterns()},getStyleAccessor:function(){return this._accessor},getStyles:function(a){var b=[],c=this.view.getModel();c.getBaseModel&&(c=c.getBaseModel());var d=this._findBlock(this._rootBlock,
a),e=c.getLineAtOffset(a),f=c.getLine(e),h=[];w(f,c.getLineStart(e),d,h);for((e=h[m(h,a,!0)])&&(e.start<=a&&a<e.end)&&b.push(e);d;)(e=d.computeStyle(c,a))&&b.splice(0,0,e),d=d.getParent();return b},setHighlightCaretLine:function(a){this.highlightCaretLine=a},setWhitespacesVisible:function(a,b){this.whitespacesVisible!==a&&(this.whitespacesVisible=a,b&&this.view.redraw())},setTabsVisible:function(a){this.tabsVisible!==a&&(this.tabsVisible=a,this.setWhitespacesVisible(this.tabsVisible||this.spacesVisible,
!1),this.view.redraw())},setSpacesVisible:function(a){this.spacesVisible!==a&&(this.spacesVisible=a,this.setWhitespacesVisible(this.tabsVisible||this.spacesVisible,!1),this.view.redraw())},setDetectHyperlinks:function(a){},setFoldingEnabled:function(a){this.foldingEnabled=a},setDetectTasks:function(a){this.detectTasks=a},_computeFolding:function(a,b,c){if(b.getBaseModel){var d=b.getBaseModel();a.forEach(function(a){var e=this._createFoldingAnnotation(b,d,a.start,a.end);e&&c.push(e);this._computeFolding(a.getBlocks(),
b,c)}.bind(this))}},_createFoldingAnnotation:function(a,b,c,d){var e=b.getLineAtOffset(c);b=b.getLineAtOffset(d);return e===b?null:new (p.AnnotationType.getType(p.AnnotationType.ANNOTATION_FOLDING))(c,d,a)},_findBlock:function(a,b){var c=a.getBlocks();if(!c.length)return a;var d=m(c,b,!0);return d<c.length&&c[d].start<=b&&b<c[d].end?this._findBlock(c[d],b):a},_findBrackets:function(a,b,c,d,e,f){for(var h=[],k=[],l=e,n=c.getBlocks(),p=m(n,e,!0);p<n.length&&!(n[p].start>=f);p++){var q=n[p].start,s=
n[p].end;l<q&&(w(d.substring(l-e,q-e),l,c,k),k.forEach(function(c){0===c.style.indexOf(a.pattern.name)?h.push(c.start+1):0===c.style.indexOf(b.pattern.name)&&h.push(-(c.start+1))}),k=[]);l=s}l<f&&(w(d.substring(l-e,f-e),l,c,k),k.forEach(function(c){c.style&&(0===c.style.indexOf(a.pattern.name)?h.push(c.start+1):0===c.style.indexOf(b.pattern.name)&&h.push(-(c.start+1)))}));return h},findMatchingBracket:function(a,b,c){for(var d=a.getLineAtOffset(c),e=a.getLineEnd(d),f=a.getText(c,e),h,k=b.getEnclosurePatterns(),
l=Object.keys(k),m=0;m<l.length;m++){var n=k[l[m]],p=t(n.regex,f,0);if(p&&0===p.index){h=n;break}}if(!h)return-1;f=!1;-1!==h.pattern.name.indexOf(".begin")?(f=!0,m=h.pattern.name.replace(".begin",".end")):m=h.pattern.name.replace(".end",".begin");k=k[m];if(!k)return-1;l=a.getLine(d);n=a.getLineStart(d);e=this._findBrackets(h,k,b,l,n,e);for(m=0;m<e.length;m++)if(l=0<=e[m]?1:-1,e[m]*l-1===c){c=1;if(f){for(m++;m<e.length;m++)if(l=0<=e[m]?1:-1,c+=l,0===c)return e[m]*l-1;d+=1;for(m=a.getLineCount();d<
m;){l=a.getLine(d);n=a.getLineStart(d);e=a.getLineEnd(d);e=this._findBrackets(h,k,b,l,n,e);for(f=0;f<e.length;f++)if(l=0<=e[f]?1:-1,c+=l,0===c)return e[f]*l-1;d++}}else{for(m--;0<=m;m--)if(l=0<=e[m]?1:-1,c+=l,0===c)return e[m]*l-1;for(d-=1;0<=d;){l=a.getLine(d);n=a.getLineStart(d);e=a.getLineEnd(d);e=this._findBrackets(h,k,b,l,n,e);for(m=e.length-1;0<=m;m--)if(l=0<=e[m]?1:-1,c+=l,0===c)return e[m]*l-1;d--}}break}return-1},_getAnnotationModel:function(){return this.annotationModel},_getLineStyle:function(a){if(this.highlightCaretLine){var b=
this.view,c=b.getModel(),b=b.getSelection();if(b.start===b.end&&c.getLineAtOffset(b.start)===a)return f}return null},_getPatternManager:function(){return this.patternManager},_getStyles:function(a,b,c,d){b.getBaseModel&&(d=b.mapOffset(d));for(var e=d+c.length,f=[],h=d,k=a.getBlocks(),l=m(k,d,!0);l<k.length&&!(k[l].start>=e);l++){var n=k[l].start,p=k[l].end;h<n&&w(c.substring(h-d,n-d),h,a,f);var q=Math.max(h,n);if(q===n&&k[l].pattern.regexBegin){var s=t(k[l].pattern.regexBegin,c.substring(q-d),0);
if(s){var u=k[l].pattern.pattern.beginCaptures||k[l].pattern.pattern.captures;u?v(s,u,q,f):f.push({start:q,end:q+s[0].length,style:k[l].pattern.pattern.name});q+=s[0].length}}var n=Math.min(e,p),E=[];if(n===p&&k[l].pattern.regexEnd&&(h=c.substring(n-h-(k[l].end-k[l].contentEnd)),s=t(k[l].pattern.regexEnd,h,0)))(u=k[l].pattern.pattern.endCaptures||k[l].pattern.pattern.captures)?v(s,u,n-s[0].length,E):k[l].pattern.pattern.name&&E.push({start:n-s[0].length,end:n,style:k[l].pattern.pattern.name}),n-=
s[0].length;var h=this._getStyles(k[l],b,c.substring(q-d,n-d),q),y=k[l].pattern.pattern.contentName||k[l].pattern.pattern.name;if(y){var x=q;h.forEach(function(a){a.start-x&&f.push({start:x,end:a.start,style:y});f.push(a);x=a.end});n-x&&f.push({start:x,end:n,style:y})}else f=f.concat(h);f=f.concat(E);h=p}h<e&&w(c.substring(h-d,e-d),h,a,f);if(b.getBaseModel)for(a=0;a<f.length;a++)c=f[a].end-f[a].start,f[a].start=b.mapOffset(f[a].start,!0),f[a].end=f[a].start+c;return f},_isRenderingWhitespace:function(){return this.whitespacesVisible&&
(this.tabsVisible||this.spacesVisible)},_onDestroy:function(a){this.destroy()},_onLineStyle:function(c){c.textView===this.view&&(c.style=this._getLineStyle(c.lineIndex));c.ranges=this._getStyles(this._rootBlock,c.textView.getModel(),c.lineText,c.lineStart);c.ranges.forEach(function(a){a.style&&(a.style={styleClass:a.style.replace(/\./g," ")})});this._isRenderingWhitespace()&&(this.spacesVisible&&this._spliceStyles(b,c.ranges,c.lineText,c.lineStart),this.tabsVisible&&this._spliceStyles(a,c.ranges,
c.lineText,c.lineStart))},_onSelection:function(a){var b=a.oldValue,c=a.newValue,d=this.view;a=d.getModel();var e;if(this.highlightCaretLine){var f=a.getLineAtOffset(b.start);e=a.getLineAtOffset(c.start);var h=c.start===c.end,b=b.start===b.end;f===e&&b&&h||(b&&d.redrawLines(f,f+1),(f!==e||!b)&&h&&d.redrawLines(e,e+1))}if(this.annotationModel){var b=this._bracketAnnotations,k,l;if(c.start===c.end&&0<(l=d.getCaretOffset()))l-=1,a.getBaseModel&&(l=a.mapOffset(l),a=a.getBaseModel()),c=this._findBlock(this._rootBlock,
l),a=this.findMatchingBracket(a,c,l),-1!==a&&(k=[p.AnnotationType.createAnnotation(p.AnnotationType.ANNOTATION_MATCHING_BRACKET,a,a+1),p.AnnotationType.createAnnotation(p.AnnotationType.ANNOTATION_CURRENT_BRACKET,l,l+1)]);this._bracketAnnotations=k;this.annotationModel.replaceAnnotations(b,k)}},_onMouseDown:function(a){if(2===a.clickCount){var b=this.view,c=b.getModel(),d=b.getOffsetAtLocation(a.x,a.y);if(0<d){var e=d-1,f=c;c.getBaseModel&&(e=c.mapOffset(e),f=c.getBaseModel());var h=this._findBlock(this._rootBlock,
e),e=this.findMatchingBracket(f,h,e);-1!==e&&(a.preventDefault(),a=e,c.getBaseModel&&(a=c.mapOffset(a,!0)),d>a&&(d--,a++),b.setSelection(a,d))}}},_onModelChanged:function(a){var b=a.start,c=a.removedCharCount;a=a.addedCharCount-c;var d=this.view,f=d.getModel(),h=f.getBaseModel?f.getBaseModel():f,c=b+c,k=h.getCharCount(),l=h.getLineStart(h.getLineAtOffset(b)),q=this._findBlock(this._rootBlock,b),s,u,v,w,x,E;do{if(u=q.getParent()){var K=null,O=[];w=h.getText(q.start,Math.min(k,q.end+a+1));u.getBlockPatterns().forEach(function(a){var b=
t(a.regexBegin||a.regex,w,0);b&&O.push({result:b,pattern:a})}.bind(this));O.sort(function(a,b){return!a.result.index&&b.result.index?-1:a.result.index&&!b.result.index?1:!a.result.index&&!b.result.index?a.pattern.pattern.index<b.pattern.pattern.index?-1:1:0});if(!O.length||0!==O[0].result.index||O[0].pattern.pattern.id!==q.pattern.pattern.id)K=!0;else{var J=O[0],N=J.pattern.regexEnd;if(N){for(var N=n(N,J.result),J=J.result[0].length,P=t(N,w,J);null===K&&P&&q.start+P.index!==q.contentEnd+a;)s=y(h,
w,q,q.start,J,P.index+1),!s.length||s[s.length-1].end<=q.start+P.index?K=!0:s.length?(J=s[s.length-1].end-q.start,P=t(N,w,J)):P=null;P||(e.lastIndex=0,P=e.exec(w),K=q.start+P.index!==q.end+a)}else K=q.start+J.result[0].length!==q.end+a}if(K){q=u;continue}}s=q.getBlocks();var F=s.length,I=m(s,l,!0),B=m(s,c,!1,I-1,F);I<F&&s[I].start<=l&&l<s[I].end?(E=s[I].start,E>b&&(E+=a)):I===F&&0<F&&q.end-a===s[F-1].end?(E=s[F-1].start,E>b&&(E+=a)):E=l;x=B<F?s[B].end:q.contentEnd;b<=x&&(x+=a);x=Math.min(x,k-1);w=
h.getText(E,x+1);var C=y(h,w,q,E);if(B<F){if(C.length&&C[C.length-1].end===x&&C[C.length-1].pattern.pattern.id===s[B].pattern.pattern.id)break;if(C.length&&C[C.length-1].pattern.regexEnd===e){B++;K=C[C.length-1].getBlocks();for(K=(K.length?K[K.length-1]:C[C.length-1]).pattern.pattern.id;B<F;){if(s[B].pattern.pattern.id===K&&(N=s[B].end+a,N=Math.min(N,k-1),w=h.getText(E,N+1),J=y(h,w,q,E),J.length&&J[J.length-1].end===N)){x=N;C=J;break}B++}if(B<F)break}}else if(!C.length||C[C.length-1].end<=q.contentEnd+
a)break;if(!u){x=k;B=F;w=h.getText(E,x);C=y(h,w,q,E);break}q=u;v=!0}while(1);this._rootBlock.adjustBounds(b,a);B=Math.min(B+1,F);v||(v=B-I!==C.length);if(!v)for(k=0;k<C.length;k++)if(F=s[I+k],l=C[k],F.start!==l.start||F.end!==l.end||F.pattern.pattern.id!==l.pattern.pattern.id){v=!0;break}I=[I,B-I].concat(C);Array.prototype.splice.apply(s,I);v&&(s=E,v=x,f!==h&&(s=f.mapOffset(s,!0),v=f.mapOffset(v,!0)),d.redrawRange(s,v));if(this.annotationModel){var d=[],L=[],V=[];s=this.annotationModel.getAnnotations(E,
x);v=this.foldingEnabled&&h!==f;for(I=q.getParent()||q;s.hasNext();)B=s.next(),v&&B.type===p.AnnotationType.ANNOTATION_FOLDING?(V.push(B),F=this._findBlock(I,B.start),!F||!(B.start===F.start&&B.end===F.end)?(d.push(B),B.expand()):(C=B.start,F=B.end,C>b&&(C-=a),F>b&&(F-=a),C<=b&&(b<F&&C<=c&&c<F)&&(C=h.getLineAtOffset(B.start),F=h.getLineAtOffset(B.end),C!==F?B.expanded||B.expand():d.push(B)))):B.type===p.AnnotationType.ANNOTATION_TASK&&q.start<=B.start&&B.end<=q.end&&d.push(B);v&&I.getBlocks().forEach(function(a){this._updateFolding(a,
h,f,V,L,E,x)}.bind(this));this.detectTasks&&A(q,h,L,E,x);this.annotationModel.replaceAnnotations(d,L)}},_spliceStyles:function(a,b,c,d){for(var e=a.regex,f=e.lastIndex=0,h=e.exec(c);h;){for(h=d+h.index;f<b.length&&!(h<b[f].end);)f++;var k={start:h,end:h+1,style:a.style};if(f<b.length&&b[f].start<=h){var l={start:h+1,end:b[f].end,style:b[f].style};b[f].end=h;b.splice(f+1,0,l);b.splice(f+1,0,k);f+=2}else b.splice(f,0,k),f++;h=e.exec(c)}},_updateFolding:function(a,b,c,d,e,f,h){f=f||a.start;h=h||a.end;
if(a.start<=h&&f<=a.end){var k=m(d,a.start,!0);k<d.length&&d[k].start===a.start&&d[k].end===a.end||(k=this._createFoldingAnnotation(c,b,a.start,a.end))&&e.push(k);a.getBlocks().forEach(function(a){this._updateFolding(a,b,c,d,e,f,h)}.bind(this))}}};return{TextStyler:d}});
define("orion/editor/stylers/application_javascript/syntax",["orion/editor/stylers/lib/syntax"],function(p){var s="break case class catch continue const debugger default delete do else enum export extends false finally for function if implements import in instanceof interface let new null package private protected public return static super switch this throw true try typeof undefined var void while with yield".split(" ");p=p.grammars;p.push({id:"orion.js",contentTypes:["application/javascript"],patterns:[{begin:"'(?:\\\\.|[^\\\\'])*\\\\$",
end:"^(?:$|(?:\\\\.|[^\\\\'])*('|[^\\\\]$))",name:"string.quoted.single.js"},{begin:'"(?:\\\\.|[^\\\\"])*\\\\$',end:'^(?:$|(?:\\\\.|[^\\\\"])*("|[^\\\\]$))',name:"string.quoted.double.js"},{include:"orion.lib#string_doubleQuote"},{include:"orion.lib#string_singleQuote"},{include:"orion.c-like#comment_singleLine"},{match:"/(?![\\s\\*])(?:\\\\.|[^/])+/(?:[gim]{0,3})",name:"string.regexp.js"},{include:"orion.lib#doc_block"},{include:"orion.c-like#comment_block"},{include:"orion.lib#brace_open"},{include:"orion.lib#brace_close"},
{include:"orion.lib#bracket_open"},{include:"orion.lib#bracket_close"},{include:"orion.lib#parenthesis_open"},{include:"orion.lib#parenthesis_close"},{include:"orion.lib#number_decimal"},{include:"orion.lib#number_hex"},{match:"\\b(?:"+s.join("|")+")\\b",name:"keyword.control.js"}]});return{id:p[p.length-1].id,grammars:p,keywords:s}});
define("orion/editor/stylers/application_xml/syntax",["orion/editor/stylers/lib/syntax"],function(p){p=p.grammars;p.push({id:"orion.xml",contentTypes:["application/xml","application/xhtml+xml"],patterns:[{include:"#comment"},{include:"#doctype"},{include:"#xmlDeclaration"},{include:"#tag"},{include:"#ampersandEscape"}],repository:{ampersandEscape:{match:"\x26lt;|\x26gt;|\x26amp;",name:"constant.character"},comment:{begin:{match:"\x3c!--",literal:"\x3c!--"},end:{match:"--\x3e",literal:"--\x3e"},name:"comment.block.xml",
patterns:[{match:"(\\b)(TODO)(\\b)(((?!--\x3e).)*)",name:"meta.annotation.task.todo",captures:{2:{name:"keyword.other.documentation.task"},4:{name:"comment.line"}}}]},doctype:{begin:"\x3c!(?:doctype|DOCTYPE)",end:"\x3e",name:"meta.tag.doctype.xml",captures:{0:{name:"entity.name.tag.doctype.xml"}},patterns:[{include:"#comment"},{include:"orion.lib#string_doubleQuote"},{include:"orion.lib#string_singleQuote"}]},tag:{begin:"\x3c/?[A-Za-z0-9]+",end:"/?\x3e",captures:{0:{name:"entity.name.tag.xml"}},name:"meta.tag.xml",
patterns:[{include:"#comment"},{include:"orion.lib#string_doubleQuote"},{include:"orion.lib#string_singleQuote"}]},xmlDeclaration:{begin:"\x3c\\?xml",end:"\\?\x3e",captures:{0:{name:"entity.name.tag.declaration.xml"}},patterns:[{include:"#comment"},{include:"orion.lib#string_doubleQuote"},{include:"orion.lib#string_singleQuote"}],name:"meta.tag.declaration.xml"}}});return{id:p[p.length-1].id,grammars:p,keywords:[]}});
define("orion/editor/stylers/text_html/syntax",["orion/editor/stylers/lib/syntax","orion/editor/stylers/application_javascript/syntax","orion/editor/stylers/text_css/syntax","orion/editor/stylers/application_xml/syntax"],function(p,s,q,k){p=p.grammars.concat(s.grammars).concat(q.grammars).concat(k.grammars);p.push({id:"orion.html",contentTypes:["text/html"],patterns:[{begin:"(?i)(\x3cstyle)([^\x3e]*)(\x3e)",end:"(?i)(\x3c/style\x3e)",captures:{1:{name:"entity.name.tag.html"},3:{name:"entity.name.tag.html"}},
contentName:"source.css.embedded.html",patterns:[{include:"orion.css"}]},{begin:"(?i)\x3cscript\\s*\x3e|\x3cscript\\s.*?(?:language\\s*\x3d\\s*(['\"])javascript\\1|type\\s*\x3d\\s*(['\"])(?:text|application)/(?:javascript|ecmascript)\\2).*?\x3e",end:"(?i)\x3c/script\x3e",captures:{0:{name:"entity.name.tag.html"}},contentName:"source.js.embedded.html",patterns:[{include:"orion.js"}]},{include:"orion.xml#comment"},{include:"orion.xml#doctype"},{include:"orion.xml#tag"},{include:"orion.xml#ampersandEscape"}]});
return{id:p[p.length-1].id,grammars:p,keywords:[]}});
define("orion/editor/edit","require orion/editor/shim orion/editor/textView orion/editor/textModel orion/editor/textTheme orion/editor/projectionTextModel orion/editor/eventTarget orion/keyBinding orion/editor/rulers orion/editor/annotations orion/editor/tooltip orion/editor/undoStack orion/editor/textDND orion/editor/editor orion/editor/editorFeatures orion/editor/contentAssist webtools/cssContentAssist webtools/htmlContentAssist orion/editor/AsyncStyler orion/editor/mirror orion/editor/textMateStyler orion/editor/htmlGrammar orion/editor/textStyler orion/editor/stylers/application_javascript/syntax orion/editor/stylers/text_css/syntax orion/editor/stylers/text_html/syntax".split(" "),function(p,
s,q,k,d,f,e,l,h,c,b,a,m,t,n,u,v,x,w,y,A,z,g,r,D,G){function H(a,b,c){for(var d;c&&c!==b&&"none"!==d;)d=a.getComputedStyle?a.getComputedStyle(c,null).getPropertyValue("display"):c.currentStyle.display,c=c.parentNode;return!c||!d?"none":d}function R(a){var b=a.firstChild;if(b&&"TEXTAREA"===b.tagName)return b.value;var c=a.ownerDocument,d=c.defaultView||c.parentWindow;if(!d.getSelection||1===a.childNodes.length&&b.nodeType===Node.TEXT_NODE||"none"===H(d,c,a))return a.innerText||a.textContent;b=c.createRange();
b.selectNode(a);a=d.getSelection();d=[];for(c=0;c<a.rangeCount;c++)d.push(a.getRangeAt(c));a.removeAllRanges();a.addRange(b);b=a.toString();a.removeAllRanges();for(c=0;c<d.length;c++)a.addRange(d[c]);return b}function W(a){if("data-editor-"===a.substring(0,12))return a=a.substring(12),a=a.replace(/-([a-z])/ig,function(a,b){return b.toUpperCase()})}function S(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}function M(a,b){var c={};S(c,b);for(var d,e=0,f=a.attributes,g=f.length;e<g;e++){d=f.item(e);
var h=W(d.nodeName);if(h){d=d.nodeValue;if("true"===d||"false"===d)d="true"===d;c[h]=d}}return c}function X(a,b){if(a.getElementsByClassName)return a.getElementsByClassName(b);b=b.replace(/ *$/,"");return a.querySelectorAll?a.querySelectorAll((" "+b).replace(/ +/g,".")):null}function T(a){var b=a.document||document,c=a.parent;c||(c="editor");"string"===typeof c&&(c=b.getElementById(c));if(!c&&a.className){var e=X(b,a.className);if(e){a.className=void 0;1<e.length&&void 0===a.noFocus&&(a.noFocus=!0);
for(var b=[],h=e.length-1;0<=h;h--)a.parent=e[h],b.push(T(a));return b}}if(!c)throw"no parent";a=M(c,a);if("string"===typeof a.theme){var e=d.TextTheme.getTheme(a.theme),l=a.theme.lastIndexOf("/"),m=a.theme;-1!==l&&(m=m.substring(l+1));".css"===m.substring(m.length-4)&&(m=m.substring(0,m.length-4));e.setThemeClass(m,{href:a.theme});a.theme=e}var s;a.readonly||(h={createContentAssistMode:function(a){s=new u.ContentAssist(a.getTextView());a=new u.ContentAssistWidget(s);a=new u.ContentAssistMode(s,a);
s.setMode(a);return a}});var r=new t.Editor({textViewFactory:function(){return new q.TextView({parent:c,model:new f.ProjectionTextModel(a.model?a.model:new k.TextModel("")),tabSize:a.tabSize?a.tabSize:4,readonly:a.readonly,fullSelection:a.fullSelection,tabMode:a.tabMode,expandTab:a.expandTab,singleMode:a.singleMode,themeClass:a.themeClass,theme:a.theme,wrapMode:a.wrapMode,wrappable:a.wrappable})},undoStackFactory:new n.UndoFactory,annotationFactory:new n.AnnotationFactory,lineNumberRulerFactory:new n.LineNumberRulerFactory,
foldingRulerFactory:new n.FoldingRulerFactory,textDNDFactory:new n.TextDNDFactory,contentAssistFactory:h,keyBindingFactory:new n.KeyBindingsFactory,statusReporter:a.statusReporter,domNode:c});r.addEventListener("TextViewInstalled",function(){var b=r.getLineNumberRuler();b&&void 0!==a.firstLineIndex&&b.setFirstLine(a.firstLineIndex);if(b=r.getSourceCodeActions())b.setAutoPairParentheses(a.autoPairParentheses),b.setAutoPairBraces(a.autoPairBraces),b.setAutoPairSquareBrackets(a.autoPairSquareBrackets),
b.setAutoPairAngleBrackets(a.autoPairAngleBrackets),b.setAutoPairQuotations(a.autoPairQuotations),b.setAutoCompleteComments(a.autoCompleteComments),b.setSmartIndentation(a.smartIndentation)});h=a.contents;void 0===h&&(h=R(c));h||(h="");r.installTextView();r.setLineNumberRulerVisible(void 0===a.showLinesRuler||a.showLinesRuler);r.setAnnotationRulerVisible(void 0===a.showAnnotationRuler||a.showFoldingRuler);r.setOverviewRulerVisible(void 0===a.showOverviewRuler||a.showOverviewRuler);r.setFoldingRulerVisible(void 0===
a.showFoldingRuler||a.showFoldingRuler);r.setInput(a.title,null,h,!1,a.noFocus);({styler:null,highlight:function(b,c){this.styler&&this.styler.destroy&&this.styler.destroy();this.styler=null;"js"===b?b="application/javascript":"css"===b?b="text/css":"html"===b?b="text/html":"java"===b&&(b="text/x-java-source");var d=c.getTextView(),e=c.getAnnotationModel();b&&(b=b.replace(/[*|:/".<>?+]/g,"_"),p(["./stylers/"+b+"/syntax"],function(a){this.styler=new g.TextStyler(d,e,a.grammars,a.id)}));"text/css"===
b&&c.setFoldingRulerVisible(void 0===a.showFoldingRuler||a.showFoldingRuler)}}).highlight(a.contentType||a.lang,r);if(s){var w=new v.CssContentAssistProvider,y=new x.HTMLContentAssistProvider;s.addEventListener("Activating",function(){/css$/.test(a.lang)?s.setProviders([w]):/html$/.test(a.lang)&&s.setProviders([y])})}h=b.defaultView||b.parentWindow;!a.noComputeSize&&("none"!==H(h,b,c)&&50>=c.clientHeight)&&(b=r.getTextView().computeSize().height,c.style.height=b+"px");return r}var U=this.orion?this.orion.editor:
void 0;if(U)for(var Q=0;Q<arguments.length;Q++)S(U,arguments[Q]);return T});var orion=this.orion||(this.orion={}),editor=orion.editor||(orion.editor={});editor.edit=require("orion/editor/edit");