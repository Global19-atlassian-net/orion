/*

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation
  Mihai Sucan (Mozilla Foundation) - fix for Bug#334583 Bug#348471 Bug#349485 Bug#350595 Bug#360726 Bug#361180 Bug#362835 Bug#362428 Bug#362286 Bug#354270 Bug#361474 Bug#363945 Bug#366312 Bug#370584

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2009, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made
 available under the terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2014 IBM Corporation and others.
 Copyright (c) 2012 VMware, Inc.
 All rights reserved. This program and the accompanying materials are made
 available under the terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors:
     IBM Corporation - initial API and implementation
     Andrew Eisenberg - rename to jsTemplateContentAssist.js

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation 

 Copyright (c) 2011, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation 

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation 

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made
 available under the terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors: IBM Corporation - initial API and implementation
               Alex Lakatos - fix for bug#369781

 Copyright (c) 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation
 RequireJS i18n 2.0.2 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/requirejs/i18n for details

 Copyright (c) 2011, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation
*/
var requirejs,require,define;
(function(n){function r(a,c){var d,e,l,z,x,g,b,f,s,m=c&&c.split("/"),u=p.map,h=u&&u["*"]||{};if(a&&"."===a.charAt(0))if(c){m=m.slice(0,m.length-1);a=m.concat(a.split("/"));for(f=0;f<a.length;f+=1)if(d=a[f],"."===d)a.splice(f,1),f-=1;else if(".."===d)if(1===f&&(".."===a[2]||".."===a[0]))break;else 0<f&&(a.splice(f-1,2),f-=2);a=a.join("/")}else 0===a.indexOf("./")&&(a=a.substring(2));if((m||h)&&u){d=a.split("/");for(f=d.length;0<f;f-=1){e=d.slice(0,f).join("/");if(m)for(s=m.length;0<s;s-=1)if(l=u[m.slice(0,
s).join("/")])if(l=l[e]){z=l;x=f;break}if(z)break;!g&&(h&&h[e])&&(g=h[e],b=f)}!z&&g&&(z=g,x=b);z&&(d.splice(0,x,z),a=d.join("/"))}return a}function q(a,c){return function(){return e.apply(n,v.call(arguments,0).concat([a,c]))}}function k(a){return function(c){return r(c,a)}}function b(a){return function(c){d[a]=c}}function f(a){if(t.call(s,a)){var c=s[a];delete s[a];u[a]=!0;h.apply(n,c)}if(!t.call(d,a)&&!t.call(u,a))throw Error("No "+a);return d[a]}function g(a){var c,d=a?a.indexOf("!"):-1;-1<d&&(c=
a.substring(0,d),a=a.substring(d+1,a.length));return[c,a]}function m(a){return function(){return p&&p.config&&p.config[a]||{}}}var h,e,a,c,d={},s={},p={},u={},t=Object.prototype.hasOwnProperty,v=[].slice;a=function(a,c){var d,e=g(a),l=e[0];a=e[1];l&&(l=r(l,c),d=f(l));l?a=d&&d.normalize?d.normalize(a,k(c)):r(a,c):(a=r(a,c),e=g(a),l=e[0],a=e[1],l&&(d=f(l)));return{f:l?l+"!"+a:a,n:a,pr:l,p:d}};c={require:function(a){return q(a)},exports:function(a){var c=d[a];return"undefined"!==typeof c?c:d[a]={}},
module:function(a){return{id:a,uri:"",exports:d[a],config:m(a)}}};h=function(e,g,p,m){var l,z,x,C,F=[],h;m=m||e;if("function"===typeof p){g=!g.length&&p.length?["require","exports","module"]:g;for(C=0;C<g.length;C+=1)if(x=a(g[C],m),z=x.f,"require"===z)F[C]=c.require(e);else if("exports"===z)F[C]=c.exports(e),h=!0;else if("module"===z)l=F[C]=c.module(e);else if(t.call(d,z)||t.call(s,z)||t.call(u,z))F[C]=f(z);else if(x.p)x.p.load(x.n,q(m,!0),b(z),{}),F[C]=d[z];else throw Error(e+" missing "+z);g=p.apply(d[e],
F);if(e)if(l&&l.exports!==n&&l.exports!==d[e])d[e]=l.exports;else if(g!==n||!h)d[e]=g}else e&&(d[e]=p)};requirejs=require=e=function(d,g,b,s,l){if("string"===typeof d)return c[d]?c[d](g):f(a(d,g).f);d.splice||(p=d,g.splice?(d=g,g=b,b=null):d=n);g=g||function(){};"function"===typeof b&&(b=s,s=l);s?h(n,d,g,b):setTimeout(function(){h(n,d,g,b)},4);return e};e.config=function(a){p=a;return e};define=function(a,c,e){c.splice||(e=c,c=[]);!t.call(d,a)&&!t.call(s,a)&&(s[a]=[a,c,e])};define.amd={jQuery:!0}})();
define("almond",function(){});
define("orion/editor/shim",[],function(){Object.create||(Object.create=function(n,r){function q(){}q.prototype=n;var k=new q;if(r)for(var b in r)r.hasOwnProperty(b)&&(r[b].hasOwnProperty("value")?k[b]=r[b].value:k[b]=function(){if(0<arguments.length)return r[b].get();r[b].set(arguments)});return k});Object.keys||(Object.keys=function(n){var r=[],q;for(q in n)n.hasOwnProperty(q)&&r.push(q);return r});Function.prototype.bind||(Function.prototype.bind=function(n){var r=this,q=Array.prototype.slice.call(arguments,
1);return q.length?function(){return arguments.length?r.apply(n,q.concat(Array.prototype.slice.call(arguments))):r.apply(n,q)}:function(){return arguments.length?r.apply(n,arguments):r.call(n)}});Array.isArray||(Array.isArray=function(n){return"[object Array]"===Object.prototype.toString.call(n)});Array.prototype.indexOf||(Array.prototype.indexOf=function(n){for(var r=0;r<this.length;r++)if(this[r]===n)return r;return-1});Array.prototype.forEach||(Array.prototype.forEach=function(n){for(var r=0;r<
this.length;r++)n(this[r],r)});Array.prototype.map||(Array.prototype.map=function(n){for(var r=Array(this.length),q=0;q<this.length;q++)r[q]=n(this[q]);return r});Array.prototype.reduce||(Array.prototype.reduce=function(n,r){var q,k=!1;1<arguments.length&&(q=r,k=!0);for(var b=0;this.length>b;++b)k?q=n(q,this[b],b,this):(q=this[b],k=!0);return q});String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});String.prototype.trimLeft||(String.prototype.trimLeft=function(){return this.replace(/^\s+/g,
"")});String.prototype.trimRight||(String.prototype.trimRight=function(){return this.replace(/\s+$/g,"")});return{}});
(function(){function n(b,f,g,m,h,e){f[b]&&(g.push(b),(!0===f[b]||1===f[b])&&m.push(h+b+"/"+e))}function r(b,f,g,m,h){f=m+f+"/"+h;require._fileExists(b.toUrl(f+".js"))&&g.push(f)}function q(b,f,g){for(var m in f)f.hasOwnProperty(m)&&(!b.hasOwnProperty(m)||g)?b[m]=f[m]:"object"===typeof f[m]&&q(b[m],f[m],g)}var k=/(^.*(^|\/)nls(\/|$))([^\/]*)\/?([^\/]*)/;define("i18n",["module"],function(b){var f=b.config?b.config():{},f=f||{};return{version:"2.0.1+",load:function(g,b,h,e){e=e||{};e.locale&&(f.locale=
e.locale);var a=k.exec(g),c=a[1],d=a[4],s=a[5],p=d.split("-"),u=[],t={},v,y="";a[5]?(c=a[1],g=c+s):(s=a[4],d=f.locale,d||(d=f.locale="undefined"===typeof navigator?"root":(navigator.language||navigator.userLanguage||"root").toLowerCase()),p=d.split("-"));if(e.isBuild){u.push(g);r(b,"root",u,c,s);for(v=0;v<p.length;v++)e=p[v],y+=(y?"-":"")+e,r(b,y,u,c,s);b(u,function(){h()})}else b([g],function(a){var d=[],e;n("root",a,d,u,c,s);for(v=0;v<p.length;v++)e=p[v],y+=(y?"-":"")+e,n(y,a,d,u,c,s);b(u,function(){var l,
z,x;for(l=d.length-1;-1<l&&d[l];l--){x=d[l];z=a[x];if(!0===z||1===z)z=b(c+x+"/"+s);q(t,z)}h(t)})})}}})})();define("orion/editor/i18n",{load:function(n,r,q,k){r.specified&&r.specified("orion/bootstrap")?r(["orion/i18n!"+n],function(b){q(b)}):q({})}});
define("orion/editor/nls/root/messages",{multipleAnnotations:"Multiple annotations:",line:"Line: ${0}",breakpoint:"Breakpoint",bookmark:"Bookmark",task:"Task",error:"Error",warning:"Warning",matchingSearch:"Matching Search",currentSearch:"Current Search",currentLine:"Current Line",matchingBracket:"Matching Bracket",currentBracket:"Current Bracket",lineUp:"Line Up",lineDown:"Line Down",lineStart:"Line Start",lineEnd:"Line End",charPrevious:"Previous Character",charNext:"Next Character",pageUp:"Page Up",
pageDown:"Page Down",scrollPageUp:"Scroll Page Up",scrollPageDown:"Scroll Page Down",scrollLineUp:"Scroll Line Up",scrollLineDown:"Scroll Line Down",wordPrevious:"Previous Word",wordNext:"Next Word",textStart:"Document Start",textEnd:"Document End",scrollTextStart:"Scroll Document Start",scrollTextEnd:"Scroll Document End",centerLine:"Center Line",selectLineUp:"Select Line Up",selectLineDown:"Select Line Down",selectWholeLineUp:" Select Whole Line Up",selectWholeLineDown:"Select Whole Line Down",
selectLineStart:"Select Line Start",selectLineEnd:"Select Line End",selectCharPrevious:"Select Previous Character",selectCharNext:"Select Next Character",selectPageUp:"Select Page Up",selectPageDown:"Select Page Down",selectWordPrevious:"Select Previous Word",selectWordNext:"Select Next Word",selectTextStart:"Select Document Start",selectTextEnd:"Select Document End",deletePrevious:"Delete Previous Character",deleteNext:"Delete Next Character",deleteWordPrevious:"Delete Previous Word",deleteWordNext:"Delete Next Word",
deleteLineStart:"Delete Line Start",deleteLineEnd:"Delete Line End",tab:"Insert Tab",enter:"Insert Line Delimiter",enterNoCursor:"Insert Line Delimiter",selectAll:"Select All",copy:"Copy",cut:"Cut",paste:"Paste",uppercase:"To Upper Case",lowercase:"To Lower Case",capitalize:"Capitalize",reversecase:"Reverse Case",toggleWrapMode:"Toggle Wrap Mode",toggleTabMode:"Toggle Tab Mode",toggleOverwriteMode:"Toggle Overwrite Mode",committerOnTime:"${0} on ${1}",emacs:"Emacs",exchangeMarkPoint:"Exchange Mark and Point",
setMarkCommand:"Set Mark",clearMark:"Clear Mark",digitArgument:"Digit Argument ${0}",negativeArgument:"Negative Argument",Comment:"Comment","Flat outline":"Flat outline",incrementalFindStr:"Incremental find: ${0}",incrementalFindStrNotFound:"Incremental find: ${0} (not found)",incrementalFindReverseStr:"Reverse Incremental find: ${0}",incrementalFindReverseStrNotFound:"Reverse Incremental find: ${0} (not found)",find:"Find...",undo:"Undo",redo:"Redo",cancelMode:"Cancel Current Mode",findNext:"Find Next Occurrence",
findPrevious:"Find Previous Occurrence",incrementalFind:"Incremental Find",incrementalFindReverse:"Incremental Find Reverse",indentLines:"Indent Lines",unindentLines:"Unindent Lines",moveLinesUp:"Move Lines Up",moveLinesDown:"Move Lines Down",copyLinesUp:"Copy Lines Up",copyLinesDown:"Copy Lines Down",deleteLines:"Delete Lines",gotoLine:"Goto Line...",gotoLinePrompty:"Goto Line:",nextAnnotation:"Next Annotation",prevAnnotation:"Previous Annotation",expand:"Expand",collapse:"Collapse",expandAll:"Expand All",
collapseAll:"Collapse All",lastEdit:"Last Edit Location",trimTrailingWhitespaces:"Trim Trailing Whitespaces",toggleLineComment:"Toggle Line Comment",addBlockComment:"Add Block Comment",removeBlockComment:"Remove Block Comment",linkedModeEntered:"Linked Mode entered",linkedModeExited:"Linked Mode exited",syntaxError:"Syntax Error",contentAssist:"Content Assist",lineColumn:"Line ${0} : Col ${1}",vi:"vi",vimove:"(Move)",viyank:"(Yank)",videlete:"(Delete)",vichange:"(Change)",viLeft:"${0} Left",viRight:"${0} Right",
viUp:"${0} Up",viDown:"${0} Down",viw:"${0} Next Word",vib:"${0} Beginning of Word",viW:"${0} Next Word (ws stop)",viB:"${0} Beginning of Word (ws stop)",vie:"${0} End of Word",viE:"${0} End of Word (ws stop)",vi$:"${0} End of the line","vi^_":"${0} First non-blank Char Current Line","vi+":"${0} First Char Next Line","vi-":"${0} First Char Previous Line","vi|":"${0} nth Column in Line",viH:"${0} Top of Page",viM:"${0} Middle of Page",viL:"${0} Bottom of Page","vi/":"${0} Search Forward","vi?":"${0} Search Backward",
vin:"${0} Next Search",viN:"${0} Previous Search",vif:"${0} Search Char Fwd",viF:"${0} Search Char Bckwd",vit:"${0} Search Before Char Fwd",viT:"${0} Search Before Char Bckwd","vi,":"${0} Repeat Reverse Char Search","vi;":"${0} Repeat Char Search",viG:"${0} Go to Line",viycd:"${0} Current Line",via:"Append After Cursor",viA:"Append to End of Line",vii:"Insert Before Cursor",viI:"Insert at Beginning of Line",viO:"Insert Line Above",vio:"Insert Line Below",viR:"Begin Overwriting Text",vis:"Substitute a Character",
viS:"Substitute Entire Line",viC:"Change Text Until Line End",vip:"Paste After Char or Line",viP:"Paste Before Char or Line",viStar:"Search Word Under Cursor",replaceAll:"Replacing all...",replacedMatches:"Replaced ${0} matches",nothingReplaced:"Nothing replaced",notFound:"Not found"});
define("orion/editor/nls/messages",["orion/editor/i18n!orion/editor/nls/messages","orion/editor/nls/root/messages"],function(n,r){var q={root:r},k;for(k in n)n.hasOwnProperty(k)&&"undefined"===typeof q[k]&&(q[k]=n[k]);return q});
define("orion/editor/eventTarget",[],function(){function n(){}n.addMixin=function(r){var q=n.prototype,k;for(k in q)q.hasOwnProperty(k)&&(r[k]=q[k])};n.prototype={addEventListener:function(n,q,k){this._eventTypes||(this._eventTypes={});var b=this._eventTypes[n];b||(b=this._eventTypes[n]={level:0,listeners:[]});b.listeners.push({listener:q,useCapture:k})},dispatchEvent:function(n){var q=n.type;this._dispatchEvent("pre"+q,n);this._dispatchEvent(q,n);this._dispatchEvent("post"+q,n)},_dispatchEvent:function(n,
q){var k=this._eventTypes?this._eventTypes[n]:null;if(k){var b=k.listeners;try{if(k.level++,b)for(var f=0,g=b.length;f<g;f++)if(b[f]){var m=b[f].listener;"function"===typeof m?m.call(this,q):m.handleEvent&&"function"===typeof m.handleEvent&&m.handleEvent(q)}}finally{if(k.level--,k.compact&&0===k.level){for(f=b.length-1;0<=f;f--)b[f]||b.splice(f,1);0===b.length&&delete this._eventTypes[n];k.compact=!1}}}},isListening:function(n){return!this._eventTypes?!1:void 0!==this._eventTypes[n]},removeEventListener:function(n,
q,k){if(this._eventTypes){var b=this._eventTypes[n];if(b){for(var f=b.listeners,g=0,m=f.length;g<m;g++){var h=f[g];if(h&&h.listener===q&&h.useCapture===k){0!==b.level?(f[g]=null,b.compact=!0):f.splice(g,1);break}}0===f.length&&delete this._eventTypes[n]}}}};return{EventTarget:n}});define("orion/regex",[],function(){return{escape:function(n){return n.replace(/([\\$\^*\/+?\.\(\)|{}\[\]])/g,"\\$\x26")},parse:function(n){return(n=/^\s*\/(.+)\/([gim]{0,3})\s*$/.exec(n))?{pattern:n[1],flags:n[2]}:null}}});
define("orion/util",[],function(){var n=navigator.userAgent,r=-1!==n.indexOf("MSIE")||-1!==n.indexOf("Trident")?document.documentMode:void 0,q=parseFloat(n.split("Firefox/")[1]||n.split("Minefield/")[1])||void 0,k=-1!==n.indexOf("Opera")?parseFloat(n.split("Version/")[1]):void 0,b=parseFloat(n.split("Chrome/")[1])||void 0,f=-1!==n.indexOf("Safari")&&!b,g=parseFloat(n.split("WebKit/")[1])||void 0,m=-1!==n.indexOf("Android"),h=-1!==n.indexOf("iPad"),n=-1!==n.indexOf("iPhone"),e=h||n,a=-1!==navigator.platform.indexOf("Mac"),
c=-1!==navigator.platform.indexOf("Win"),d=-1!==navigator.platform.indexOf("Linux"),s="ontouchstart"in document.createElement("input");return{formatMessage:function(a){var c=arguments;return a.replace(/\$\{([^\}]+)\}/g,function(a,d){return c[(d<<0)+1]})},createElement:function(a,c){return a.createElementNS?a.createElementNS("http://www.w3.org/1999/xhtml",c):a.createElement(c)},isIE:r,isFirefox:q,isOpera:k,isChrome:b,isSafari:f,isWebkit:g,isAndroid:m,isIPad:h,isIPhone:n,isIOS:e,isMac:a,isWindows:c,
isLinux:d,isTouch:s,platformDelimiter:c?"\r\n":"\n"}});
define("orion/editor/textModel",["orion/editor/eventTarget","orion/regex","orion/util"],function(n,r,q){function k(b,f){this._lastLineIndex=-1;this._text=[""];this._lineOffsets=[0];this.setText(b);this.setLineDelimiter(f)}k.prototype={destroy:function(){},find:function(b){1<this._text.length&&(this._text=[this._text.join("")]);var f=b.string,g=b.regex,m=f,h="",e=b.caseInsensitive;if(m)if(g){if(f=r.parse(m))m=f.pattern,h=f.flags}else m=f.replace(/([\\$\^*\/+?\.\(\)|{}\[\]])/g,"\\$\x26"),e&&(m=m.replace(/[iI\u0130\u0131]/g,
"[Ii\u0130\u0131]"));var a=null,c;if(m){var f=b.reverse,d=b.wrap,g=b.wholeWord,s=b.start||0;b=b.end;var p=null!==b&&void 0!==b;-1===h.indexOf("g")&&(h+="g");-1===h.indexOf("m")&&(h+="m");e&&-1===h.indexOf("i")&&(h+="i");g&&(m="\\b"+m+"\\b");var u=this._text[0],t,k,y=0;p&&(e=s<b?s:b,u=u.substring(e,s<b?b:s),y=e);var n=RegExp(m,h);f?c=function(){var a=null;for(n.lastIndex=0;;){k=n.lastIndex;t=n.exec(u);if(k===n.lastIndex)return null;if(t){if(!(t.index+y<s)){if(!d||a)break;s=u.length+y}a={start:t.index+
y,end:n.lastIndex+y}}else break}a&&(s=a.start);return a}:(p||(n.lastIndex=s),c=function(){for(;;){k=n.lastIndex;t=n.exec(u);if(k===n.lastIndex)break;if(t)return{start:t.index+y,end:n.lastIndex+y};if(!(0!==k&&d))break}return null});a=c()}return{next:function(){var d=a;d&&(a=c());return d},hasNext:function(){return null!==a}}},getCharCount:function(){for(var b=0,f=0;f<this._text.length;f++)b+=this._text[f].length;return b},getLine:function(b,f){var g=this.getLineCount();if(!(0<=b&&b<g))return null;
var m=this._lineOffsets[b];if(b+1<g){g=this.getText(m,this._lineOffsets[b+1]);if(f)return g;for(var m=g.length,h;10===(h=g.charCodeAt(m-1))||13===h;)m--;return g.substring(0,m)}return this.getText(m)},getLineAtOffset:function(b){var f=this.getCharCount();if(!(0<=b&&b<=f))return-1;var g=this.getLineCount();if(b===f)return g-1;var m,h,e=this._lastLineIndex;if(0<=e&&e<g&&(m=this._lineOffsets[e],h=e+1<g?this._lineOffsets[e+1]:f,m<=b&&b<h))return e;for(var a=g,c=-1;1<a-c;)if(e=Math.floor((a+c)/2),m=this._lineOffsets[e],
h=e+1<g?this._lineOffsets[e+1]:f,b<=m)a=e;else if(b<h){a=e;break}else c=e;return this._lastLineIndex=a},getLineCount:function(){return this._lineOffsets.length},getLineDelimiter:function(){return this._lineDelimiter},getLineEnd:function(b,f){var g=this.getLineCount();if(!(0<=b&&b<g))return-1;if(b+1<g){g=this._lineOffsets[b+1];if(f)return g;for(var m=this.getText(Math.max(this._lineOffsets[b],g-2),g),h=m.length,e;10===(e=m.charCodeAt(h-1))||13===e;)h--;return g-(m.length-h)}return this.getCharCount()},
getLineStart:function(b){return!(0<=b&&b<this.getLineCount())?-1:this._lineOffsets[b]},getText:function(b,f){void 0===b&&(b=0);void 0===f&&(f=this.getCharCount());if(b===f)return"";for(var g=0,m=0,h;m<this._text.length;){h=this._text[m].length;if(b<=g+h)break;g+=h;m++}for(var e=g,a=m;m<this._text.length;){h=this._text[m].length;if(f<=g+h)break;g+=h;m++}if(a===m)return this._text[a].substring(b-e,f-g);e=this._text[a].substring(b-e);g=this._text[m].substring(0,f-g);return e+this._text.slice(a+1,m).join("")+
g},onChanging:function(b){return this.dispatchEvent(b)},onChanged:function(b){return this.dispatchEvent(b)},setLineDelimiter:function(b,f){"auto"===b&&(b=void 0,1<this.getLineCount()&&(b=this.getText(this.getLineEnd(0),this.getLineEnd(0,!0))));this._lineDelimiter=b?b:q.platformDelimiter;if(f){var g=this.getLineCount();if(1<g){for(var m=Array(g),h=0;h<g;h++)m[h]=this.getLine(h);this.setText(m.join(this._lineDelimiter))}}},setText:function(b,f,g){void 0===b&&(b="");void 0===f&&(f=0);void 0===g&&(g=
this.getCharCount());if(!(f===g&&""===b)){for(var m=this.getLineAtOffset(f),h=this.getLineAtOffset(g),e=f,a=g-f,c=h-m,d=b.length,s=0,p=this.getLineCount(),u=0,t=0,k=0,n=[];;){-1!==u&&u<=k&&(u=b.indexOf("\r",k));-1!==t&&t<=k&&(t=b.indexOf("\n",k));if(-1===t&&-1===u)break;k=-1!==u&&-1!==t?u+1===t?t+1:(u<t?u:t)+1:-1!==u?u+1:t+1;n.push(f+k);s++}this.onChanging({type:"Changing",text:b,start:e,removedCharCount:a,addedCharCount:d,removedLineCount:c,addedLineCount:s});0===n.length&&(k=this.getLineStart(m),
h=h+1<p?this.getLineStart(h+1):this.getCharCount(),f!==k&&(b=this.getText(k,f)+b,f=k),g!==h&&(b+=this.getText(g,h),g=h));k=d-a;for(h=m+c+1;h<p;h++)this._lineOffsets[h]+=k;if(5E4>n.length)m=[m+1,c].concat(n),Array.prototype.splice.apply(this._lineOffsets,m);else{k=m+1;this._lineOffsets.splice(k,c);for(p=0;p<n.length;p+=5E4)m=[k,0].concat(n.slice(p,Math.min(n.length,p+5E4))),Array.prototype.splice.apply(this._lineOffsets,m),k+=5E4}for(k=p=0;k<this._text.length;){h=this._text[k].length;if(f<=p+h)break;
p+=h;k++}m=p;for(n=k;k<this._text.length;){h=this._text[k].length;if(g<=p+h)break;p+=h;k++}h=this._text[k];f=this._text[n].substring(0,f-m);g=h.substring(g-p);n=[n,k-n+1];f&&n.push(f);b&&n.push(b);g&&n.push(g);Array.prototype.splice.apply(this._text,n);0===this._text.length&&(this._text=[""]);this.onChanged({type:"Changed",start:e,removedCharCount:a,addedCharCount:d,removedLineCount:c,addedLineCount:s})}}};n.EventTarget.addMixin(k.prototype);return{TextModel:k}});
define("orion/keyBinding",["orion/util"],function(n){function r(k,b,f,g,m,h){this.type=h||"keydown";this.keyCode="string"===typeof k&&"keydown"===this.type?k.toUpperCase().charCodeAt(0):k;this.mod1=void 0!==b&&null!==b?b:!1;this.mod2=void 0!==f&&null!==f?f:!1;this.mod3=void 0!==g&&null!==g?g:!1;this.mod4=void 0!==m&&null!==m?m:!1}function q(k){this.keys=k}r.prototype={getKeys:function(){return[this]},match:function(k,b){if(void 0!==b){if(0!==b)return!1}else if(k instanceof Array){if(1<k.length)return!1;
k=k[0]}return k.type!==this.type?!1:this.keyCode===k.keyCode||this.keyCode===String.fromCharCode(n.isOpera?k.which:void 0!==k.charCode?k.charCode:k.keyCode)?this.mod1!==(n.isMac?k.metaKey:k.ctrlKey)||"keydown"===this.type&&this.mod2!==k.shiftKey||this.mod3!==k.altKey||n.isMac&&this.mod4!==k.ctrlKey?!1:!0:!1},equals:function(k){return!k||this.keyCode!==k.keyCode||this.mod1!==k.mod1||this.mod2!==k.mod2||this.mod3!==k.mod3||this.mod4!==k.mod4||this.type!==k.type?!1:!0}};q.prototype={getKeys:function(){return this.keys.slice(0)},
match:function(k,b){var f=this.keys;if(void 0!==b)return b>f.length?!1:f[b].match(k)?b===f.length-1?!0:b+1:!1;k instanceof Array||(k=[k]);if(k.length>f.length)return!1;var g;for(g=0;g<k.length;g++)if(!f[g].match(k[g]))return!1;return g===f.length?!0:g},equals:function(k){if(!k.keys||k.keys.length!==this.keys.length)return!1;for(var b=0;b<k.keys.length;b++)if(!k.keys[b].equals(this.keys[b]))return!1;return!0}};return{KeyBinding:r,KeyStroke:r,KeySequence:q}});
define("orion/editor/keyModes",["orion/keyBinding","orion/util"],function(n,r){function q(b){b&&(this._view=b,this._keyBindings=this.createKeyBindings(),this._keyBindingIndex=0)}function k(b){q.call(this,b)}q.prototype={createKeyBindings:function(){return[]},getKeyBindings:function(b){for(var f=[],g=this._keyBindings,m=0;m<g.length;m++)g[m].actionID===b&&f.push(g[m].keyBinding);return f},getView:function(){return this._view},isActive:function(){return-1!==this._view.getKeyModes().indexOf(this)},match:function(b){if("keydown"===
b.type)switch(b.keyCode){case 16:case 17:case 18:case 91:return}for(var f=this._keyBindingIndex,g=this._matchingKeyBindings||this._keyBindings,m=[],h=0;h<g.length;h++){var e=g[h],a=e.keyBinding.match(b,f);if(!0===a)return this._keyBindingIndex=0,this._matchingKeyBindings=null,e.actionID;"number"===typeof a&&m.push(e)}if(0===m.length)this._keyBindingIndex=0,this._matchingKeyBindings=null;else return this._keyBindingIndex++,this._matchingKeyBindings=m,"noop"},setKeyBinding:function(b,f){for(var g=this._keyBindings,
m=0;m<g.length;m++){var h=g[m];if(h.keyBinding.equals(b)){f?h.actionID=f:h.predefined?h.actionID="noop":g.splice(m,1);return}}f&&g.push({keyBinding:b,actionID:f})},setView:function(b){this._view=b}};k.prototype=new q;k.prototype.createKeyBindings=function(){var b=n.KeyBinding,f=[];f.push({actionID:"lineUp",keyBinding:new b(38),predefined:!0});f.push({actionID:"lineDown",keyBinding:new b(40),predefined:!0});f.push({actionID:"charPrevious",keyBinding:new b(37),predefined:!0});f.push({actionID:"charNext",
keyBinding:new b(39),predefined:!0});r.isMac?(f.push({actionID:"scrollPageUp",keyBinding:new b(33),predefined:!0}),f.push({actionID:"scrollPageDown",keyBinding:new b(34),predefined:!0}),f.push({actionID:"pageUp",keyBinding:new b(33,null,null,!0),predefined:!0}),f.push({actionID:"pageDown",keyBinding:new b(34,null,null,!0),predefined:!0}),f.push({actionID:"lineStart",keyBinding:new b(37,!0),predefined:!0}),f.push({actionID:"lineEnd",keyBinding:new b(39,!0),predefined:!0}),f.push({actionID:"wordPrevious",
keyBinding:new b(37,null,null,!0),predefined:!0}),f.push({actionID:"wordNext",keyBinding:new b(39,null,null,!0),predefined:!0}),f.push({actionID:"scrollTextStart",keyBinding:new b(36),predefined:!0}),f.push({actionID:"scrollTextEnd",keyBinding:new b(35),predefined:!0}),f.push({actionID:"textStart",keyBinding:new b(38,!0),predefined:!0}),f.push({actionID:"textEnd",keyBinding:new b(40,!0),predefined:!0}),f.push({actionID:"scrollPageUp",keyBinding:new b(38,null,null,null,!0),predefined:!0}),f.push({actionID:"scrollPageDown",
keyBinding:new b(40,null,null,null,!0),predefined:!0}),f.push({actionID:"lineStart",keyBinding:new b(37,null,null,null,!0),predefined:!0}),f.push({actionID:"lineEnd",keyBinding:new b(39,null,null,null,!0),predefined:!0}),f.push({actionID:"lineStart",keyBinding:new b(38,null,null,!0),predefined:!0}),f.push({actionID:"lineEnd",keyBinding:new b(40,null,null,!0),predefined:!0})):(f.push({actionID:"pageUp",keyBinding:new b(33),predefined:!0}),f.push({actionID:"pageDown",keyBinding:new b(34),predefined:!0}),
f.push({actionID:"lineStart",keyBinding:new b(36),predefined:!0}),f.push({actionID:"lineEnd",keyBinding:new b(35),predefined:!0}),f.push({actionID:"wordPrevious",keyBinding:new b(37,!0),predefined:!0}),f.push({actionID:"wordNext",keyBinding:new b(39,!0),predefined:!0}),f.push({actionID:"textStart",keyBinding:new b(36,!0),predefined:!0}),f.push({actionID:"textEnd",keyBinding:new b(35,!0),predefined:!0}));r.isFirefox&&r.isLinux&&(f.push({actionID:"lineUp",keyBinding:new b(38,!0),predefined:!0}),f.push({actionID:"lineDown",
keyBinding:new b(40,!0),predefined:!0}));r.isWindows&&(f.push({actionID:"scrollLineUp",keyBinding:new b(38,!0),predefined:!0}),f.push({actionID:"scrollLineDown",keyBinding:new b(40,!0),predefined:!0}));f.push({actionID:"selectLineUp",keyBinding:new b(38,null,!0),predefined:!0});f.push({actionID:"selectLineDown",keyBinding:new b(40,null,!0),predefined:!0});f.push({actionID:"selectCharPrevious",keyBinding:new b(37,null,!0),predefined:!0});f.push({actionID:"selectCharNext",keyBinding:new b(39,null,!0),
predefined:!0});f.push({actionID:"selectPageUp",keyBinding:new b(33,null,!0),predefined:!0});f.push({actionID:"selectPageDown",keyBinding:new b(34,null,!0),predefined:!0});r.isMac?(f.push({actionID:"selectLineStart",keyBinding:new b(37,!0,!0),predefined:!0}),f.push({actionID:"selectLineEnd",keyBinding:new b(39,!0,!0),predefined:!0}),f.push({actionID:"selectWordPrevious",keyBinding:new b(37,null,!0,!0),predefined:!0}),f.push({actionID:"selectWordNext",keyBinding:new b(39,null,!0,!0),predefined:!0}),
f.push({actionID:"selectTextStart",keyBinding:new b(36,null,!0),predefined:!0}),f.push({actionID:"selectTextEnd",keyBinding:new b(35,null,!0),predefined:!0}),f.push({actionID:"selectTextStart",keyBinding:new b(38,!0,!0),predefined:!0}),f.push({actionID:"selectTextEnd",keyBinding:new b(40,!0,!0),predefined:!0}),f.push({actionID:"selectLineStart",keyBinding:new b(37,null,!0,null,!0),predefined:!0}),f.push({actionID:"selectLineEnd",keyBinding:new b(39,null,!0,null,!0),predefined:!0}),f.push({actionID:"selectLineStart",
keyBinding:new b(38,null,!0,!0),predefined:!0}),f.push({actionID:"selectLineEnd",keyBinding:new b(40,null,!0,!0),predefined:!0})):(r.isLinux&&(f.push({actionID:"selectWholeLineUp",keyBinding:new b(38,!0,!0),predefined:!0}),f.push({actionID:"selectWholeLineDown",keyBinding:new b(40,!0,!0),predefined:!0})),f.push({actionID:"selectLineStart",keyBinding:new b(36,null,!0),predefined:!0}),f.push({actionID:"selectLineEnd",keyBinding:new b(35,null,!0),predefined:!0}),f.push({actionID:"selectWordPrevious",
keyBinding:new b(37,!0,!0),predefined:!0}),f.push({actionID:"selectWordNext",keyBinding:new b(39,!0,!0),predefined:!0}),f.push({actionID:"selectTextStart",keyBinding:new b(36,!0,!0),predefined:!0}),f.push({actionID:"selectTextEnd",keyBinding:new b(35,!0,!0),predefined:!0}));f.push({actionID:"undo",keyBinding:new n.KeyBinding("z",!0),predefined:!0});r.isMac?f.push({actionID:"redo",keyBinding:new n.KeyBinding("z",!0,!0),predefined:!0}):f.push({actionID:"redo",keyBinding:new n.KeyBinding("y",!0),predefined:!0});
f.push({actionID:"deletePrevious",keyBinding:new b(8),predefined:!0});f.push({actionID:"deletePrevious",keyBinding:new b(8,null,!0),predefined:!0});f.push({actionID:"deleteNext",keyBinding:new b(46),predefined:!0});f.push({actionID:"deleteWordPrevious",keyBinding:new b(8,!0),predefined:!0});f.push({actionID:"deleteWordPrevious",keyBinding:new b(8,!0,!0),predefined:!0});f.push({actionID:"deleteWordNext",keyBinding:new b(46,!0),predefined:!0});f.push({actionID:"tab",keyBinding:new b(9),predefined:!0});
f.push({actionID:"shiftTab",keyBinding:new b(9,null,!0),predefined:!0});f.push({actionID:"enter",keyBinding:new b(13),predefined:!0});f.push({actionID:"enter",keyBinding:new b(13,null,!0),predefined:!0});f.push({actionID:"selectAll",keyBinding:new b("a",!0),predefined:!0});f.push({actionID:"toggleTabMode",keyBinding:new b("m",!0),predefined:!0});r.isMac&&(f.push({actionID:"deleteNext",keyBinding:new b(46,null,!0),predefined:!0}),f.push({actionID:"deleteWordPrevious",keyBinding:new b(8,null,null,!0),
predefined:!0}),f.push({actionID:"deleteWordNext",keyBinding:new b(46,null,null,!0),predefined:!0}));f.push({actionID:"toggleWrapMode",keyBinding:new n.KeyBinding("w",!0,!1,!0)});f.push({actionID:"toggleOverwriteMode",keyBinding:new n.KeyBinding(45)});if(!r.isFirefox){var g=r.isMac&&r.isChrome;f.push({actionID:"noop",keyBinding:new b("u",!g,!1,!1,g),predefined:!0});f.push({actionID:"noop",keyBinding:new b("i",!g,!1,!1,g),predefined:!0});f.push({actionID:"noop",keyBinding:new b("b",!g,!1,!1,g),predefined:!0})}r.isFirefox&&
(f.push({actionID:"copy",keyBinding:new b(45,!0),predefined:!0}),f.push({actionID:"paste",keyBinding:new b(45,null,!0),predefined:!0}),f.push({actionID:"cut",keyBinding:new b(46,null,!0),predefined:!0}));r.isMac&&(f.push({actionID:"lineStart",keyBinding:new b("a",!1,!1,!1,!0),predefined:!0}),f.push({actionID:"lineEnd",keyBinding:new b("e",!1,!1,!1,!0),predefined:!0}),f.push({actionID:"lineUp",keyBinding:new b("p",!1,!1,!1,!0),predefined:!0}),f.push({actionID:"lineDown",keyBinding:new b("n",!1,!1,
!1,!0),predefined:!0}),f.push({actionID:"charPrevious",keyBinding:new b("b",!1,!1,!1,!0),predefined:!0}),f.push({actionID:"charNext",keyBinding:new b("f",!1,!1,!1,!0),predefined:!0}),f.push({actionID:"deletePrevious",keyBinding:new b("h",!1,!1,!1,!0),predefined:!0}),f.push({actionID:"deleteNext",keyBinding:new b("d",!1,!1,!1,!0),predefined:!0}),f.push({actionID:"deleteLineEnd",keyBinding:new b("k",!1,!1,!1,!0),predefined:!0}),r.isFirefox?(f.push({actionID:"scrollPageDown",keyBinding:new b("v",!1,
!1,!1,!0),predefined:!0}),f.push({actionID:"deleteLineStart",keyBinding:new b("u",!1,!1,!1,!0),predefined:!0}),f.push({actionID:"deleteWordPrevious",keyBinding:new b("w",!1,!1,!1,!0),predefined:!0})):(f.push({actionID:"pageDown",keyBinding:new b("v",!1,!1,!1,!0),predefined:!0}),f.push({actionID:"centerLine",keyBinding:new b("l",!1,!1,!1,!0),predefined:!0}),f.push({actionID:"enterNoCursor",keyBinding:new b("o",!1,!1,!1,!0),predefined:!0})));return f};return{KeyMode:q,DefaultKeyMode:k}});
define("orion/editor/textTheme",["require","orion/editor/eventTarget","orion/util"],function(n,r,q){function k(b){b=b||{};this._document=b.document||document}var b={};k.getTheme=function(f){f=f||"default";var g=b[f];g||(g=b[f]=new k);return g};k.prototype={getThemeClass:function(){return this._themeClass},setThemeClass:function(b,g){var m=this,h=m._themeClass;m._themeClass=b;this._load(b,g,function(){m.onThemeChanged({type:"ThemeChanged",oldValue:h,newValue:m.getThemeClass()})})},onThemeChanged:function(b){return this.dispatchEvent(b)},
buildStyleSheet:function(b,g){function m(e,a,c){a&&(h.push("."+b+" ."+e+" {"),h.push("\t"+(c?"background-color":"color")+": "+a+";"),h.push("}"))}var h=[];h.push("");h.push("."+b+" {");g.fontFamily&&h.push("\tfont-family: "+g.fontFamily+";");g.fontSize&&h.push("\tfont-size: "+g.fontSize+";");g.fontSize&&h.push("\tcolor: "+g.text+";");h.push("}");h.push("."+b+".textview {");g.background&&h.push("\tbackground-color: "+g.background+";");h.push("}");m("ruler.annotations",g.annotationRuler,!0);m("ruler.lines",
g.annotationRuler,!0);m("ruler.folding",g.annotationRuler,!0);m("ruler.overview",g.overviewRuler,!0);m("rulerLines",g.lineNumber,!1);m("rulerLines.even",g.lineNumberEven,!1);m("rulerLines.odd",g.lineNumberOdd,!1);m("annotationLine.currentLine",g.currentLine,!0);m("entity-name-tag",g.keyword,!1);m("entity-other-attribute-name",g.attribute,!1);m("string-quoted",g.string,!1);m("meta.annotation.currentLine",g.currentLine,!0);m("keyword",g.keyword,!1);m("string",g.string,!1);m("comment",g.comment,!1);
m("comment.block.documentation",g.comment,!1);m("keyword.other.documentation.markup",g.comment,!1);return h.join("\n")},_createStyle:function(b,g,m,h){var e=this._document;b="orion-theme-"+b;var a=e.getElementById(b);if(a){if(h||a.firstChild.data===g)return;a.removeChild(a.firstChild);a.appendChild(e.createTextNode(g))}else h?(a=q.createElement(e,"link"),a.rel="stylesheet",a.type="text/css",a.href=g,a.addEventListener("load",function(){m()})):(a=q.createElement(e,"style"),a.appendChild(e.createTextNode(g))),
a.id=b,(e.getElementsByTagName("head")[0]||e.documentElement).appendChild(a);h||m()},_load:function(b,g,m){if(b)if("string"===typeof g)this._createStyle(b,g,m);else if(g=g.href,".css"!==g.substring(g.length-4)&&(g+=".css"),/^\//.test(g)||/[a-zA-Z0-9]+:\/\//i.test(g)||!n.toUrl)this._createStyle(b,g,m,!0);else{var h=this;n(["text!"+g],function(e){h._createStyle(b,e,m,!1)})}else m()}};r.EventTarget.addMixin(k.prototype);return{TextTheme:k}});
define("orion/editor/util",[],function(){return{contains:function(n,r){if(!r)return!1;if(!n.compareDocumentPosition){for(var q=r;q;){if(n===q)return!0;q=q.parentNode}return!1}return n===r||0!==(n.compareDocumentPosition(r)&16)},addEventListener:function(n,r,q,k){"function"===typeof n.addEventListener?n.addEventListener(r,q,!0===k):n.attachEvent("on"+r,q)},removeEventListener:function(n,r,q,k){"function"===typeof n.removeEventListener?n.removeEventListener(r,q,!0===k):n.detachEvent("on"+r,q)}}});
define("orion/editor/textView","i18n!orion/editor/nls/messages orion/editor/textModel orion/editor/keyModes orion/editor/eventTarget orion/editor/textTheme orion/editor/util orion/util".split(" "),function(n,r,q,k,b,f,g){function m(l,a,x){if(x){a.className="";x=a.attributes;for(var c=x.length;0<c--;)(!g.isIE||9<=g.isIE||9>g.isIE&&x[c].specified)&&a.removeAttribute(x[c].name)}if(l){l.styleClass&&(a.className=l.styleClass);if(x=l.style)for(var d in x)x.hasOwnProperty(d)&&(a.style[d]=x[d]);if(l=l.attributes)for(var e in l)l.hasOwnProperty(e)&&
a.setAttribute(e,l[e])}}function h(l){return l instanceof Array?l.slice(0):l}function e(l,a){if(!l)return a;if(!a)return l;for(var x in a)a.hasOwnProperty(x)&&(l.hasOwnProperty(x)||(l[x]=a[x]));return l}function a(l,z){if(l===z)return!0;if(l&&!z||!l&&z||l&&l.constructor===String||z&&z.constructor===String)return!1;if(l instanceof Array||z instanceof Array){if(!(l instanceof Array&&z instanceof Array)||l.length!==z.length)return!1;for(var x=0;x<l.length;x++)if(!a(l[x],z[x]))return!1;return!0}if(!(l instanceof
Object)||!(z instanceof Object))return!1;for(x in l)if(l.hasOwnProperty(x)&&(!z.hasOwnProperty(x)||!a(l[x],z[x])))return!1;for(x in z)if(!l.hasOwnProperty(x))return!1;return!0}function c(l,a,x){for(var c=0,d=0,e=0,b=l.length;e<b;){-1!==c&&c<=e&&(c=l.indexOf("\r",e));-1!==d&&d<=e&&(d=l.indexOf("\n",e));var g=e,p;if(-1===d&&-1===c){a(l.substring(e));break}-1!==c&&-1!==d?c+1===d?(p=c,e=d+1):(p=c<d?c:d,e=(c<d?c:d)+1):-1!==c?(p=c,e=c+1):(p=d,e=d+1);a(l.substring(g,p));x()}}function d(l){var a,x,c,d,e=
l.ownerDocument.defaultView||l.ownerDocument.parentWindow;e.getComputedStyle?(l=e.getComputedStyle(l,null),a=l.getPropertyValue("padding-left"),x=l.getPropertyValue("padding-top"),c=l.getPropertyValue("padding-right"),d=l.getPropertyValue("padding-bottom")):l.currentStyle&&(a=l.currentStyle.paddingLeft,x=l.currentStyle.paddingTop,c=l.currentStyle.paddingRight,d=l.currentStyle.paddingBottom);return{left:parseInt(a,10)||0,top:parseInt(x,10)||0,right:parseInt(c,10)||0,bottom:parseInt(d,10)||0}}function s(l){var a,
x,c,e,b=l._trim;if(!b){var b=d(l),g=l.ownerDocument.defaultView||l.ownerDocument.parentWindow;g.getComputedStyle?(e=g.getComputedStyle(l,null),a=e.getPropertyValue("border-left-width"),x=e.getPropertyValue("border-top-width"),c=e.getPropertyValue("border-right-width"),e=e.getPropertyValue("border-bottom-width")):l.currentStyle&&(a=l.currentStyle.borderLeftWidth,x=l.currentStyle.borderTopWidth,c=l.currentStyle.borderRightWidth,e=l.currentStyle.borderBottomWidth);a=parseInt(a,10)||0;x=parseInt(x,10)||
0;c=parseInt(c,10)||0;e=parseInt(e,10)||0;b.left+=a;b.top+=x;b.right+=c;b.bottom+=e;l._trim=b}return b}function p(l,a,x,c){function d(a){if(a.animationName===b){var z=a.target;"function"===typeof z.__DOMReady&&(l.defaultView||l.parentWindow).setTimeout(function(){z.__DOMReady()},0)}}function e(l,a){for(var z=["","-webkit-","-moz-","-ms-","-o-"],x="",c="body ."+l+" {\n",d=0;d<z.length;d++)x+="@"+z[d]+"keyframes "+a+" {\nfrom { opacity: 0.99; }\nto { opacity: 1; }\n}\n",c+=z[d]+"animation-duration: 0.001s;\n"+
z[d]+"animation-name: "+a+";\n";return x+(c+"}")}x="_"+x+"DOMReady";a.className=a.className?a.className+" "+x:x;a.__DOMReady=c;c=x+"Style";if(!l.getElementById(c)){var b=x+"Animation";l.addEventListener("animationstart",d,!1);l.addEventListener("MSAnimationStart",d,!1);l.addEventListener("webkitAnimationStart",d,!1);a=l.createElement("style");a.id=c;c=l.getElementsByTagName("head")[0]||l.documentElement;a.appendChild(l.createTextNode(e(x,b)));c.insertBefore(a,c.firstChild)}}function u(l,a,x){this.start=
l;this.end=a;this.caret=x}function t(l){this.left=l.left;this.top=l.top;this.right=l.right;this.bottom=l.bottom}function v(l,a,x){this.view=l;this.lineIndex=a;this._lineDiv=x}function y(l){this._init(l||{})}var A=f.addEventListener,w=f.removeEventListener,B=function(){function l(l){this.options=l}l.prototype.play=function(){var l="number"===typeof this.options.duration?this.options.duration:350,a=this.options.easing||this.defaultEasing,c=this.options.onAnimate||function(){},d=this.options.curve[0],
e=this.options.curve[1],b=e-d,g=-1,p,f=this;this.interval=this.options.window.setInterval(function(){g=-1===g?(new Date).getTime():g;var s=((new Date).getTime()-g)/l;1>s?(s=a(s),p=d+s*b,c(p)):(c(e),f.stop())},"number"===typeof this.options.rate?this.options.rate:20)};l.prototype.stop=function(){this.options.window.clearInterval(this.interval);(this.options.onEnd||function(){})()};l.prototype.defaultEasing=function(l){return Math.sin(l*(Math.PI/2))};return l}();u.prototype={clone:function(){return new u(this.start,
this.end,this.caret)},collapse:function(){this.caret?this.end=this.start:this.start=this.end},extend:function(l){this.caret?this.start=l:this.end=l;this.start>this.end&&(l=this.start,this.start=this.end,this.end=l,this.caret=!this.caret)},setCaret:function(l){this.end=this.start=l;this.caret=!1},getCaret:function(){return this.caret?this.start:this.end},toString:function(){return"start\x3d"+this.start+" end\x3d"+this.end+(this.caret?" caret is at start":" caret is at end")},isEmpty:function(){return this.start===
this.end},equals:function(l){return this.caret===l.caret&&this.start===l.start&&this.end===l.end}};t.prototype={toString:function(){return"{l\x3d"+this.left+", t\x3d"+this.top+", r\x3d"+this.right+", b\x3d"+this.bottom+"}"}};v.prototype={create:function(l,a){if(!this._lineDiv){var x=this._lineDiv=this._createLine(l,a,this.lineIndex);x._line=this;return x}},_createLine:function(l,z,x){var c=this.view,d=c._model,e=d.getLine(x),b=d.getLineStart(x),p={type:"LineStyle",textView:c,lineIndex:x,lineText:e,
lineStart:b};c.onLineStyle(p);var f=l.ownerDocument,d=z||g.createElement(f,"div");if(!z||!a(z.viewStyle,p.style))m(p.style,d,z),z&&(z._trim=null),d.viewStyle=p.style,d.setAttribute("role","presentation");d.lineIndex=x;if(z&&d.viewLineText===e&&a(p.ranges,d.viewRanges))return d;d.viewRanges=p.ranges;d.viewLineText=e;x=[];this._createRanges(p.ranges,e,0,e.length,b,{tabOffset:0,ranges:x});p=" ";!c._fullSelection&&9>g.isIE&&(p="\ufeff");c={text:p,style:c._metrics.largestFontStyle,ignoreChars:1};0===x.length||
!x[x.length-1].style||"div"!==x[x.length-1].style.tagName?x.push(c):x.splice(x.length-1,0,c);var s,h,u,k=p=0;if(g.isFirefox&&2E3<e.length){z&&(d.innerHTML="",z.lineWidth=void 0);z=f.createDocumentFragment();for(e=0;e<x.length;e++)c=x[e],b=c.text,s=c.style,s=this._createSpan(d,b,s,c.ignoreChars),z.appendChild(s);d.appendChild(z)}else{var t,w;if(z){if(h=z.modelChangedEvent)0===h.removedLineCount&&0===h.addedLineCount?(w=h.start-b,t=h.addedCharCount-h.removedCharCount):w=-1,z.modelChangedEvent=void 0;
h=z.firstChild}for(e=0;e<x.length;e++){c=x[e];b=c.text;p+=b.length;s=c.style;if(h)if(u=h.firstChild.data,f=h.viewStyle,u===b&&a(s,f)){k+=u.length;h._rectsCache=void 0;s=h=h.nextSibling;continue}else for(;h;){if(-1!==w){f=p;f>=w&&(f-=t);u=(u=h.firstChild.data)?u.length:0;if(k+u>f)break;k+=u}f=h.nextSibling;d.removeChild(h);h=f}s=this._createSpan(d,b,s,c.ignoreChars);h?d.insertBefore(s,h):d.appendChild(s);z&&(z.lineWidth=void 0)}if(z)for(t=s?s.nextSibling:null;t;)f=t.nextSibling,z.removeChild(t),t=
f}d.parentNode||l.appendChild(d);return d},_createRanges:function(l,z,c,d,e,b){if(!(c>d)){if(l)for(var g=0;g<l.length;g++){var p=l[g];if(!(p.end<e+c)){var f=Math.max(e+c,p.start)-e;if(f>d)break;var s=Math.min(e+d,p.end)-e;if(f<=s){f=Math.max(c,f);s=Math.min(d,s);c<f&&this._createRange(z,c,f,null,b);if(!p.style||!p.style.unmergeable)for(;g+1<l.length&&l[g+1].start-e===s&&a(p.style,l[g+1].style);)p=l[g+1],s=Math.min(e+d,p.end)-e,g++;this._createRange(z,f,s,p.style,b);c=s}}}c<d&&this._createRange(z,
c,d,null,b)}},_createRange:function(l,a,c,d,e){if(!(a>c)){var b=this.view._customTabSize;if(b&&8!==b)for(var g=l.indexOf("\t",a);-1!==g&&g<c;){a<g&&(a={text:l.substring(a,g),style:d},e.ranges.push(a),e.tabOffset+=a.text.length);a=b-e.tabOffset%b;if(0<a){for(var p="\u00a0",f=1;f<a;f++)p+=" ";a={text:p,style:d,ignoreChars:a-1};e.ranges.push(a);e.tabOffset+=a.text.length}a=g+1;if(a===c)return;g=l.indexOf("\t",a)}a<=c&&(a={text:l.substring(a,c),style:d},e.ranges.push(a),e.tabOffset+=a.text.length)}},
_createSpan:function(l,a,c,d){var e=this.view,b="span";c&&c.tagName&&(b=c.tagName.toLowerCase());var p="a"===b;p&&(this.hasLink=!0);p&&!e._linksVisible&&(b="span");p=l.ownerDocument;l=g.createElement(l.ownerDocument,b);l.appendChild(p.createTextNode(c&&c.text?c.text:a));c&&c.html?(l.innerHTML=c.html,l.ignore=!0):c&&c.node&&(l.appendChild(c.node),l.ignore=!0);m(c,l);if("a"===b){var f=e._getWindow();A(l,"click",function(l){return e._handleLinkClick(l?l:f.event)},!1)}l.viewStyle=c;d&&(l.ignoreChars=
d);return l},_ensureCreated:function(){return this._lineDiv?this._lineDiv:this._createdDiv=this.create(this.view._clientDiv,null)},getBoundingClientRect:function(l,a){var c=this._ensureCreated(),d=this.view;if(void 0===l)return this._getLineBoundingClientRect(c,!0);var e=d._model,b=c.ownerDocument,p=this.lineIndex,f=null;if(l<e.getLineEnd(p)){var s=e.getLineStart(p);this.forEach(function(a){var z=a.firstChild,e=this._nodeLength(a);if(s+e>l){var p=l-s;if(1===z.length)f=new t(a.getBoundingClientRect());
else if(d._isRangeRects)e=b.createRange(),e.setStart(z,p),e.setEnd(z,p+1),f=new t(e.getBoundingClientRect());else if(g.isIE)e=b.body.createTextRange(),e.moveToElementText(a),e.collapse(),(z=0===p&&8===g.isIE)&&(p=1),e.moveEnd("character",p+1),e.moveStart("character",p),f=new t(e.getBoundingClientRect()),z&&(f.left=a.getClientRects()[0].left);else{var m=z.data;a.removeChild(z);a.appendChild(b.createTextNode(m.substring(0,p)));var F=g.createElement(b,"span");F.appendChild(b.createTextNode(m.substring(p,
p+1)));a.appendChild(F);a.appendChild(b.createTextNode(m.substring(p+1)));f=new t(F.getBoundingClientRect());a.innerHTML="";a.appendChild(z);this._createdDiv||(a=d._getSelection(),(s<=a.start&&a.start<s+e||s<=a.end&&a.end<s+e)&&d._updateDOMSelection())}g.isIE&&(p=c.ownerDocument.defaultView||c.ownerDocument.parentWindow,a=p.screen.logicalXDPI/p.screen.deviceXDPI,p=p.screen.logicalYDPI/p.screen.deviceYDPI,f.left*=a,f.right*=a,f.top*=p,f.bottom*=p);return!1}s+=e;return!0})}e=this.getBoundingClientRect();
f||(d._wrapMode?(p=this.getClientRects(),f=p[p.length-1],f.left=f.right,f.left+=e.left,f.top+=e.top,f.right+=e.left,f.bottom+=e.top):(f=new t(e),f.left=f.right));if(a||void 0===a)f.left-=e.left,f.top-=e.top,f.right-=e.left,f.bottom-=e.top;return f},forEach:function(l){for(var a=this._ensureCreated().firstChild;a;){var c=a.nextSibling;if(!a.ignore&&!l.call(this,a))break;a=c}},_getClientRects:function(l,a){var c,e,d,b;if(!l._rectsCache){c=l.getClientRects();e=Array(c.length);for(b=0;b<c.length;b++)d=
e[b]=new t(c[b]),d.left-=a.left,d.top-=a.top,d.right-=a.left,d.bottom-=a.top;l._rectsCache=e}c=l._rectsCache;e=[c.length];for(b=0;b<c.length;b++)e[b]=new t(c[b]);return e},getClientRects:function(l){if(!this.view._wrapMode)return[this.getBoundingClientRect()];var a=[],c=this._ensureCreated().getBoundingClientRect();this.forEach(function(l){l=this._getClientRects(l,c);for(var e=0;e<l.length;e++){var d=l[e],b,g;if(d.top!==d.bottom){var p=d.top+(d.bottom-d.top)/2;for(b=0;b<a.length&&!(g=a[b],g.top<=
p&&p<g.bottom);b++);b===a.length?a.push(d):(d.left<g.left&&(g.left=d.left),d.top<g.top&&(g.top=d.top),d.right>g.right&&(g.right=d.right),d.bottom>g.bottom&&(g.bottom=d.bottom))}}return!0});return void 0!==l?a[l]:a},_getLineBoundingClientRect:function(l,a){var c=new t(l.getBoundingClientRect());if(!this.view._wrapMode){c.right=c.left;for(var d=l.lastChild;d&&d.ignoreChars===d.firstChild.length;)d=d.previousSibling;d&&(d=d.getBoundingClientRect(),c.right=d.right+s(l).right)}a&&(d=s(l),c.left+=d.left,
c.right-=d.right);return c},getLineCount:function(){return!this.view._wrapMode?1:this.getClientRects().length},getLineIndex:function(l){if(!this.view._wrapMode)return 0;var a=this.getClientRects();l=this.getBoundingClientRect(l);l=l.top+(l.bottom-l.top)/2;for(var c=0;c<a.length;c++)if(a[c].top<=l&&l<a[c].bottom)return c;return a.length-1},getLineStart:function(l){if(!this.view._wrapMode||0===l)return this.view._model.getLineStart(this.lineIndex);var a=this.getClientRects();return this.getOffset(a[l].left+
1,a[l].top+1)},_nodeLength:function(l){if(!l||l.ignore)return 0;var a=l.firstChild.length;l.ignoreChars&&(a-=l.ignoreChars);return a},getModelOffset:function(l,a){if(!l)return 0;var c=0;this.forEach(function(d){var e=d.firstChild;if(e===l)return d.ignoreChars&&(c-=d.ignoreChars),c+=a,!1;d.ignoreChars&&(c-=d.ignoreChars);c+=e.data.length;return!0});return Math.max(0,c)+this.view._model.getLineStart(this.lineIndex)},getNodeOffset:function(l){var a=0,c,d,e=this.view._model,b=e.getLineStart(this.lineIndex),
g=l-b,p=e.getLineEnd(this.lineIndex)-b;this.forEach(function(l){var e=l.firstChild,b=this._nodeLength(l);if(b+a>g||a+b>=p)return c=e,d=g-a,l.ignoreChars&&(0<b&&d===b)&&(d+=l.ignoreChars),!1;a+=b;return!0});return{node:c,offset:d}},getText:function(l){var a="",c=0;this.forEach(function(d){var e;if(d.ignoreChars){e=d.lastChild;for(var b=0,g=[],p=-1;e;){var f=e.data;if(f)for(var s=f.length-1;0<=s;s--){var m=f.substring(s,s+1);b<d.ignoreChars&&(" "===m||"\ufeff"===m)?b++:g.push("\u00a0"===m?"\t":m)}l===
e&&(p=g.length);e=e.previousSibling}g=g.reverse().join("");-1!==p&&(c=a.length+g.length-p);a+=g}else for(e=d.firstChild;e;)l===e&&(c=a.length),a+=e.data,e=e.nextSibling;return!0});return{text:a,offset:c}},getOffset:function(l,a){function c(d,x,s){var C=d.firstChild,k=u._nodeLength(d),t=m.ownerDocument,w=t.defaultView||t.parentWindow,v=g.isIE?w.screen.logicalXDPI/w.screen.deviceXDPI:1,n=g.isIE?w.screen.logicalYDPI/w.screen.deviceYDPI:1,y,q,B,w=s.left+h.left,r,A;if(g.isIE||e._isRangeRects){for(var t=
e._isRangeRects?t.createRange():t.body.createTextRange(),G=k,H=-1;1<G-H;){var K=Math.floor((G+H)/2);s=H+1;y=K===k-1&&d.ignoreChars?C.length:K+1;r=0===s&&8===g.isIE;e._isRangeRects?(t.setStart(C,s),t.setEnd(C,y)):(r&&(s=1),t.moveToElementText(d),t.move("character",s),t.moveEnd("character",y-s));A=t.getClientRects();for(var L=!1,M=0;M<A.length;M++)if(s=A[M],y=(r?w:s.left)*v-h.left,B=s.right*v-h.left,q=s.top*n-h.top,s=s.bottom*n-h.top,y<=l&&l<B&&(!e._wrapMode||q<=a&&a<s)){L=!0;break}L?G=K:H=K}x+=G;s=
G;y=G===k-1&&d.ignoreChars?C.length:Math.min(G+1,C.length);e._isRangeRects?(t.setStart(C,s),t.setEnd(C,y)):(t.moveToElementText(d),t.move("character",s),t.moveEnd("character",y-s));A=t.getClientRects();k=!1;0<A.length&&(s=A[0],y=(r?w:s.left)*v-h.left,B=s.right*v-h.left,k=l>y+(B-y)/2);d=x-f;C=b.getLine(p);v=C.charCodeAt(d);55296<=v&&56319>=v&&k?d<C.length&&(v=C.charCodeAt(d+1),56320<=v&&57343>=v&&(x+=1)):56320<=v&&(57343>=v&&!k)&&0<d&&(v=C.charCodeAt(d-1),55296<=v&&56319>=v&&(x-=1));k&&x++}else{v=
[];for(r=0;r<k;r++)v.push("\x3cspan\x3e"),r===k-1?v.push(C.data.substring(r)):v.push(C.data.substring(r,r+1)),v.push("\x3c/span\x3e");d.innerHTML=v.join("");for(v=d.firstChild;v;){s=v.getBoundingClientRect();y=s.left-h.left;B=s.right-h.left;if(y<=l&&l<B){l>y+(B-y)/2&&x++;break}x++;v=v.nextSibling}u._createdDiv||(d.innerHTML="",d.appendChild(C),d=e._getSelection(),(x<=d.start&&d.start<x+k||x<=d.end&&d.end<x+k)&&e._updateDOMSelection())}return x}function d(c){if(c.ignore)return null;c=u._getClientRects(c,
h);for(var x=0;x<c.length;x++){var b=c[x];if(b.left<=l&&l<b.right&&(!e._wrapMode||b.top<=a&&a<b.bottom))return b}return null}var e=this.view,b=e._model,p=this.lineIndex,f=b.getLineStart(p),s=b.getLineEnd(p);if(f===s)return f;var m=this._ensureCreated(),h=this.getBoundingClientRect(),u=this,k,t;if(e._wrapMode){k=this.getClientRects();a<k[0].top&&(a=k[0].top);for(var w=0;w<k.length&&!(t=k[w],t.top<=a&&a<t.bottom);w++);l<t.left&&(l=t.left);l>t.right&&(l=t.right-1)}else 0>l&&(l=0),l>h.right-h.left&&(l=
h.right-h.left);var v,n;if(this._lastHitChild&&this._lastHitChild.parentNode){if(v=this._lastHitOffset,n=this._lastHitChild,t=d(n),!t){k=v;for(var w=v+this._nodeLength(n),y=n.previousSibling,q=n.nextSibling;y||q;){if(y){k-=this._nodeLength(y);if(t=d(y)){n=y;v=k;break}y=y.previousSibling}if(q){if(t=d(q)){n=q;v=w;break}w+=this._nodeLength(q);q=q.nextSibling}}}}else v=f,this.forEach(function(l){n=l;if(t=d(n))return!1;v+=this._nodeLength(n);return!0});n&&t&&(this._lastHitChild=n,this._lastHitOffset=v,
v=c(n,v,t));return Math.min(s,Math.max(f,v))},getNextOffset:function(l,a){if("line"===a.unit){var c=this.view._model,d=c.getLineAtOffset(l);if(0<a.count)return a.count--,c.getLineEnd(d);a.count++;return c.getLineStart(d)}return"wordend"===a.unit||"wordWS"===a.unit||"wordendWS"===a.unit?this._getNextOffset_W3C(l,a):g.isIE?this._getNextOffset_IE(l,a):this._getNextOffset_W3C(l,a)},_getNextOffset_W3C:function(l,a){function c(l){return 33<=l&&47>=l||58<=l&&64>=l||91<=l&&94>=l||96===l||123<=l&&126>=l}function d(l){return 32===
l||9===l}var e=this.view._model,b=e.getLineAtOffset(l),g=e.getLine(b),p=e.getLineStart(b),e=e.getLineEnd(b),b=g.length,f=l-p,s,m=0>a.count?-1:1;if("word"===a.unit||"wordend"===a.unit||"wordWS"===a.unit||"wordendWS"===a.unit)for(var h,u,k;0!==a.count;){if(0<a.count){if(f===b)return e;s=g.charCodeAt(f);h=c(s);u=!h&&!d(s);for(f++;f<b;){s=g.charCodeAt(f);if("wordWS"!==a.unit&&"wordendWS"!==a.unit){k=c(s);if("wordend"===a.unit){if(!k&&h)break}else if(k&&!h)break;s=!k&&!d(s)}else s=!d(s);if("wordend"===
a.unit||"wordendWS"===a.unit){if(!s&&u)break}else if(s&&!u)break;u=s;h=k;f++}}else{if(0===f)return p;f--;s=g.charCodeAt(f);h=c(s);for(u=!h&&!d(s);0<f;){s=g.charCodeAt(f-1);if("wordWS"!==a.unit&&"wordendWS"!==a.unit){k=c(s);if("wordend"===a.unit){if(k&&!h)break}else if(!k&&h)break;s=!k&&!d(s)}else s=!d(s);if("wordend"===a.unit||"wordendWS"===a.unit){if(s&&!u)break}else if(!s&&u)break;u=s;h=k;f--}}a.count-=m}else for(;0!==a.count&&0<=f+m&&f+m<=b;)f+=m,s=g.charCodeAt(f),56320<=s&&57343>=s&&0<f&&(s=g.charCodeAt(f-
1),55296<=s&&56319>=s&&(f+=m)),a.count-=m;return p+f},_getNextOffset_IE:function(l,a){var c=this._ensureCreated(),d=this.view._model,e=this.lineIndex,b=0,g;g=d.getLineStart(e);var p=c.ownerDocument,f=0>a.count?-1:1;if(l===d.getLineEnd(e)){for(c=c.lastChild;c&&c.ignoreChars===c.firstChild.length;)c=c.previousSibling;if(!c)return g;b=p.body.createTextRange();b.moveToElementText(c);g=b.text.length;b.moveEnd(a.unit,f);b=l+b.text.length-g}else if(l===g&&0>a.count)b=g;else for(c=c.firstChild;c;){d=this._nodeLength(c);
if(g+d>l){b=p.body.createTextRange();if(l===g&&0>a.count){for(g=c.previousSibling;g&&(!g.firstChild||!g.firstChild.length);)g=g.previousSibling;b.moveToElementText(g?g:c.previousSibling)}else b.moveToElementText(c),b.collapse(),b.moveEnd("character",l-g);g=b.text.length;b.moveEnd(a.unit,f);b=l+b.text.length-g;break}g=d+g;c=c.nextSibling}a.count-=f;return b},updateLinks:function(){var l=this._ensureCreated();if(this.hasLink){var a=this;this.forEach(function(c){var d=c.viewStyle;d&&(d.tagName&&"a"===
d.tagName.toLowerCase())&&l.replaceChild(a._createSpan(l,c.firstChild.data,d),c);return!0})}},destroy:function(){var l=this._createdDiv;l&&(l.parentNode.removeChild(l),this._createdDiv=null)}};y.prototype={addKeyMode:function(l,a){var c=this._keyModes;void 0!==a?c.splice(a,0,l):c.push(l);l._modeAdded&&l._modeAdded()},addRuler:function(l,a){l.setView(this);var c=this._rulers;if(void 0!==a){var d,e;for(e=d=0;d<c.length&&e<a;d++)l.getLocation()===c[d].getLocation()&&e++;c.splice(e,0,l);a=e}else c.push(l);
this._createRuler(l,a);this._update()},computeSize:function(){var l=0,a=0,c=this._model,d=this._clientDiv;if(!d)return{width:l,height:a};var e=d.style.width;g.isWebkit&&(d.style.width="0x7fffffffpx");for(var c=c.getLineCount(),b=0;b<c;b++){var p=this._getLine(b),f=p.getBoundingClientRect(),l=Math.max(l,f.right-f.left),a=a+(f.bottom-f.top);p.destroy()}g.isWebkit&&(d.style.width=e);d=this._getViewPadding();l+=d.right+d.left+this._metrics.scrollWidth;a+=d.bottom+d.top+this._metrics.scrollWidth;return{width:l,
height:a}},convert:function(l,a,c){if(this._clientDiv){var d=this._getScroll(),e=this._getViewPadding(),b=this._viewDiv.getBoundingClientRect();"document"===a&&(void 0!==l.x&&(l.x+=-d.x+b.left+e.left),void 0!==l.y&&(l.y+=-d.y+b.top+e.top));"document"===c&&(void 0!==l.x&&(l.x+=d.x-b.left-e.left),void 0!==l.y&&(l.y+=d.y-b.top-e.top));return l}},destroy:function(){for(var l=0;l<this._rulers.length;l++)this._rulers[l].setView(null);this.rulers=null;this._destroyView();this.onDestroy({type:"Destroy"});
this._parent=null;this._model&&this._model.destroy&&this._model.destroy();this._actions=this._keyModes=this._doubleClickSelection=this._selection=this._theme=this._model=null},focus:function(){this._clientDiv&&(this._updateDOMSelection(),this._clientDiv.focus(),this._updateDOMSelection())},hasFocus:function(){return this._hasFocus},getActionDescription:function(l){if(l=this._actions[l])return l.actionDescription},getActions:function(l){var a=[],c=this._actions,d;for(d in c)c.hasOwnProperty(d)&&(l||
!c[d].defaultHandler)&&a.push(d);return a},getBottomIndex:function(l){return!this._clientDiv?0:this._getBottomIndex(l)},getBottomPixel:function(){return!this._clientDiv?0:this._getScroll().y+this._getClientHeight()},getCaretOffset:function(){return this._getSelection().getCaret()},getClientArea:function(){if(!this._clientDiv)return{x:0,y:0,width:0,height:0};var l=this._getScroll();return{x:l.x,y:l.y,width:this._getClientWidth(),height:this._getClientHeight()}},getHorizontalPixel:function(){return!this._clientDiv?
0:this._getScroll().x},getKeyBindings:function(l){for(var a=[],c=this._keyModes,d=0;d<c.length;d++)a=a.concat(c[d].getKeyBindings(l));return a},getKeyModes:function(){return this._keyModes.slice(0)},getLineHeight:function(l){return!this._clientDiv?0:this._getLineHeight(l)},getLineIndex:function(l){return!this._clientDiv?0:this._getLineIndex(l)},getLinePixel:function(l){return!this._clientDiv?0:this._getLinePixel(l)},getLocationAtOffset:function(l){if(!this._clientDiv)return{x:0,y:0};var a=this._model;
l=Math.min(Math.max(0,l),a.getCharCount());var a=a.getLineAtOffset(l),c=this._getLine(a);l=c.getBoundingClientRect(l);c.destroy();c=l.left;a=this._getLinePixel(a)+l.top;return{x:c,y:a}},getNextOffset:function(l,a){var c=new u(l,l,!1);this._doMove(a,c);return c.getCaret()},getOptions:function(){var l;if(0===arguments.length)l=this._defaultOptions();else if(1===arguments.length){if(l=arguments[0],"string"===typeof l)return h(this["_"+l])}else{l={};for(var a in arguments)arguments.hasOwnProperty(a)&&
(l[arguments[a]]=void 0)}for(var c in l)l.hasOwnProperty(c)&&(l[c]=h(this["_"+c]));return l},getModel:function(){return this._model},getOffsetAtLocation:function(l,a){if(!this._clientDiv)return 0;var c=this._getLineIndex(a),d=this._getLine(c),c=d.getOffset(l,a-this._getLinePixel(c));d.destroy();return c},getLineAtOffset:function(l){this.getModel().getLineAtOffset(l)},getLineStart:function(l){this.getModel().getLineStart(l)},getRulers:function(){return this._rulers.slice(0)},getSelection:function(){var l=
this._getSelection();return{start:l.start,end:l.end}},getText:function(l,a){return this._model.getText(l,a)},getTopIndex:function(l){return!this._clientDiv?0:this._getTopIndex(l)},getTopPixel:function(){return!this._clientDiv?0:this._getScroll().y},invokeAction:function(l,a,c){if(this._clientDiv){if(l=this._actions[l]){if(!a&&l.handler&&l.handler(c))return!0;if(l.defaultHandler)return"boolean"===typeof l.defaultHandler(c)}return!1}},isDestroyed:function(){return!this._clientDiv},onContextMenu:function(l){return this.dispatchEvent(l)},
onDragStart:function(l){return this.dispatchEvent(l)},onDrag:function(l){return this.dispatchEvent(l)},onDragEnd:function(l){return this.dispatchEvent(l)},onDragEnter:function(l){return this.dispatchEvent(l)},onDragOver:function(l){return this.dispatchEvent(l)},onDragLeave:function(l){return this.dispatchEvent(l)},onDrop:function(l){return this.dispatchEvent(l)},onDestroy:function(l){return this.dispatchEvent(l)},onLineStyle:function(l){return this.dispatchEvent(l)},onKeyDown:function(l){return this.dispatchEvent(l)},
onKeyPress:function(l){return this.dispatchEvent(l)},onKeyUp:function(l){return this.dispatchEvent(l)},onModelChanged:function(l){return this.dispatchEvent(l)},onModelChanging:function(l){return this.dispatchEvent(l)},onModify:function(l){return this.dispatchEvent(l)},onMouseDown:function(l){return this.dispatchEvent(l)},onMouseUp:function(l){return this.dispatchEvent(l)},onMouseMove:function(l){return this.dispatchEvent(l)},onMouseOver:function(l){return this.dispatchEvent(l)},onMouseOut:function(l){return this.dispatchEvent(l)},
onSelection:function(l){return this.dispatchEvent(l)},onScroll:function(l){return this.dispatchEvent(l)},onVerify:function(l){return this.dispatchEvent(l)},onFocus:function(l){return this.dispatchEvent(l)},onBlur:function(l){return this.dispatchEvent(l)},redraw:function(){if(!(0<this._redrawCount)){var l=this._model.getLineCount();this.redrawRulers(0,l);this.redrawLines(0,l)}},redrawRulers:function(l,a){if(!(0<this._redrawCount))for(var c=this.getRulers(),d=0;d<c.length;d++)this.redrawLines(l,a,c[d])},
redrawLines:function(l,a,c){if(!(0<this._redrawCount)&&(void 0===l&&(l=0),void 0===a&&(a=this._model.getLineCount()),l!==a)){var d=this._clientDiv;if(d){if(c)for(d=this._getRulerParent(c).firstChild;d&&d._ruler!==c;)d=d.nextSibling;c?d.rulerChanged=!0:this._lineHeight&&this._resetLineHeight(l,a);if(!c||"page"===c.getOverview())for(d=d.firstChild;d;){var e=d.lineIndex;l<=e&&e<a&&(d.lineChanged=!0);d=d.nextSibling}!c&&(!this._wrapMode&&l<=this._maxLineIndex&&this._maxLineIndex<a)&&(this._checkMaxLineIndex=
this._maxLineIndex,this._maxLineIndex=-1,this._maxLineWidth=0);this._queueUpdate()}}},redrawRange:function(l,a){if(!(0<this._redrawCount)){var c=this._model;void 0===l&&(l=0);void 0===a&&(a=c.getCharCount());var d=c.getLineAtOffset(l),c=c.getLineAtOffset(Math.max(l,a-1))+1;this.redrawLines(d,c)}},removeKeyMode:function(l){for(var a=this._keyModes,c=0;c<a.length;c++)if(a[c]===l){a.splice(c,1);break}l._modeRemoved&&l._modeRemoved()},removeRuler:function(l){for(var a=this._rulers,c=0;c<a.length;c++)if(a[c]===
l){a.splice(c,1);l.setView(null);this._destroyRuler(l);this._update();break}},resize:function(){this._clientDiv&&this._handleResize(null)},setAction:function(l,a,c){if(l){var d=this._actions,e=d[l];e||(e=d[l]={});e.handler=a;void 0!==c&&(e.actionDescription=c)}},setKeyBinding:function(l,a){this._keyModes[0].setKeyBinding(l,a)},setCaretOffset:function(l,a,c){var d=this._model.getCharCount();l=Math.max(0,Math.min(l,d));l=new u(l,l,!1);this._setSelection(l,void 0===a||a,!0,c)},setHorizontalPixel:function(l){this._clientDiv&&
(l=Math.max(0,l),this._scrollView(l-this._getScroll().x,0))},setRedraw:function(l){l?0===--this._redrawCount&&this.redraw():this._redrawCount++},setModel:function(l){if(l&&l!==this._model){this._model.removeEventListener("preChanging",this._modelListener.onChanging);this._model.removeEventListener("postChanged",this._modelListener.onChanged);var a=this._model.getLineCount(),c=this._model.getCharCount(),d=l.getLineCount(),e=l.getCharCount(),b={type:"ModelChanging",text:l.getText(),start:0,removedCharCount:c,
addedCharCount:e,removedLineCount:a,addedLineCount:d};this.onModelChanging(b);this._model=l;b={type:"ModelChanged",start:0,removedCharCount:c,addedCharCount:e,removedLineCount:a,addedLineCount:d};this.onModelChanged(b);this._model.addEventListener("preChanging",this._modelListener.onChanging);this._model.addEventListener("postChanged",this._modelListener.onChanged);this._reset();this._update()}},setOptions:function(l){var c=this._defaultOptions(),d;for(d in l)if(l.hasOwnProperty(d)){var e=l[d];if(!a(this["_"+
d],e)){var b=c[d]?c[d].update:null;b?b.call(this,e):this["_"+d]=h(e)}}},setSelection:function(l,a,c,d){var e=l>a;if(e){var b=l;l=a;a=b}b=this._model.getCharCount();l=Math.max(0,Math.min(l,b));a=Math.max(0,Math.min(a,b));l=new u(l,a,e);this._setSelection(l,void 0===c||c,!0,d)},setText:function(l,a,c){var d=void 0===a&&void 0===c;void 0===a&&(a=0);void 0===c&&(c=this._model.getCharCount());d&&(this._variableLineHeight=!1);this._modifyContent({text:l,start:a,end:c,_code:!0},!d);d&&(this._columnX=-1,
this._setSelection(new u(0,0,!1),!0),13>g.isFirefox&&this._fixCaret())},setTopIndex:function(l){this._clientDiv&&this._scrollView(0,this._getLinePixel(Math.max(0,l))-this._getScroll().y)},setTopPixel:function(l){this._clientDiv&&this._scrollView(0,Math.max(0,l)-this._getScroll().y)},showSelection:function(l,a){return this._showCaret(l?!1:!0,a,l)},update:function(l,a){this._clientDiv&&((l||this._metrics.invalid)&&this._updateStyle(),void 0===a||a?this._update():this._queueUpdate())},_handleRootMouseDown:function(l){this._cancelCheckSelection();
if(!this._ignoreEvent(l)){13>g.isFirefox&&1===l.which&&(this._clientDiv.contentEditable=!1,this._ignoreBlur=(this._overlayDiv||this._clientDiv).draggable=!0);var a=this._overlayDiv||this._clientDiv;9>g.isIE&&(a=this._viewDiv);for(var c=l.target?l.target:l.srcElement;c;){if(a===c)return;c=c.parentNode}l.preventDefault&&l.preventDefault();l.stopPropagation&&l.stopPropagation();if(!this._isW3CEvents){var d=this;this._getWindow().setTimeout(function(){d._clientDiv.focus()},0)}}},_handleRootMouseUp:function(l){!this._ignoreEvent(l)&&
(13>g.isFirefox&&1===l.which)&&(this._clientDiv.contentEditable=!0,(this._overlayDiv||this._clientDiv).draggable=!1,this._fixCaret(),this._ignoreBlur=!1)},_handleBlur:function(l){this._cancelCheckSelection();if(!this._ignoreBlur){this._hasFocus=!1;if(9>g.isIE&&!this._getSelection().isEmpty()){l=this._rootDiv;var a=g.createElement(l.ownerDocument,"div");l.appendChild(a);l.removeChild(a)}this._cursorDiv&&(this._cursorDiv.style.display="none");if(this._selDiv1)if(this._selDiv1.style.background="lightgray",
this._selDiv2.style.background="lightgray",this._selDiv3.style.background="lightgray",l=this._getWindow(),a=this._selDiv1.ownerDocument,l.getSelection){a=l.getSelection();for(l=a.anchorNode;l;){if(l===this._clientDiv){0<a.rangeCount&&a.removeAllRanges();break}l=l.parentNode}}else if(a.selection){this._ignoreSelect=!1;for(l=a.selection.createRange().parentElement();l;){if(l===this._clientDiv){a.selection.empty();break}l=l.parentNode}this._ignoreSelect=!0}if(!this._ignoreFocus)this.onBlur({type:"Blur"})}},
_handleContextMenu:function(l){if(!this._ignoreEvent(l)){g.isIE&&3===this._lastMouseButton&&this._updateDOMSelection();var a=!1;this.isListening("ContextMenu")?(a=this._createMouseEvent("ContextMenu",l),a.screenX=l.screenX,a.screenY=l.screenY,this.onContextMenu(a),a=a.defaultPrevented):g.isMac&&(g.isFirefox&&0===l.button)&&(a=!0);if(a)return l.preventDefault&&l.preventDefault(),!1;this._contextMenuOpen=!0;g.isFirefox&&(this._checkSelectionChange=!0,this._pollSelectionChange(!0))}},_handleCopy:function(l){this._cancelCheckSelection();
if(!this._ignoreEvent(l)&&!this._ignoreCopy&&this._doCopy(l))return l.preventDefault&&l.preventDefault(),!1},_handleCut:function(l){this._cancelCheckSelection();if(!this._ignoreEvent(l)&&this._doCut(l))return l.preventDefault&&l.preventDefault(),!1},_handleDataModified:function(l){this._ignoreEvent(l)||this._startIME()},_handleDblclick:function(l){this._ignoreEvent(l)||(this._lastMouseTime=l.timeStamp?l.timeStamp:(new Date).getTime(),2!==this._clickCount&&(this._clickCount=2,this._handleMouse(l)))},
_handleDragStart:function(l){if(!this._ignoreEvent(l)){if(13>g.isFirefox){var a=this;this._getWindow().setTimeout(function(){a._clientDiv.contentEditable=!0;a._clientDiv.draggable=!1;a._ignoreBlur=!1},0)}if(this.isListening("DragStart")&&-1!==this._dragOffset)this._isMouseDown=!1,this.onDragStart(this._createMouseEvent("DragStart",l)),this._dragOffset=-1;else return l.preventDefault&&l.preventDefault(),!1}},_handleDrag:function(l){if(!this._ignoreEvent(l)&&this.isListening("Drag"))this.onDrag(this._createMouseEvent("Drag",
l))},_handleDragEnd:function(l){if(!this._ignoreEvent(l)){this._dropTarget=!1;this._dragOffset=-1;if(this.isListening("DragEnd"))this.onDragEnd(this._createMouseEvent("DragEnd",l));13>g.isFirefox&&(this._fixCaret(),"none"===l.dataTransfer.dropEffect&&!l.dataTransfer.mozUserCancelled&&this._fixCaret())}},_handleDragEnter:function(l){if(!this._ignoreEvent(l)){var a=!0;this._dropTarget=!0;this.isListening("DragEnter")&&(a=!1,this.onDragEnter(this._createMouseEvent("DragEnter",l)));if(g.isWebkit||a)return l.preventDefault&&
l.preventDefault(),!1}},_handleDragOver:function(l){if(!this._ignoreEvent(l)){var a=!0;this.isListening("DragOver")&&(a=!1,this.onDragOver(this._createMouseEvent("DragOver",l)));if(g.isWebkit||a)return a&&(l.dataTransfer.dropEffect="none"),l.preventDefault&&l.preventDefault(),!1}},_handleDragLeave:function(l){if(!this._ignoreEvent(l)&&(this._dropTarget=!1,this.isListening("DragLeave")))this.onDragLeave(this._createMouseEvent("DragLeave",l))},_handleDrop:function(l){if(!this._ignoreEvent(l)){this._dropTarget=
!1;if(this.isListening("Drop"))this.onDrop(this._createMouseEvent("Drop",l));l.preventDefault&&l.preventDefault();return!1}},_handleFocus:function(l){this._hasFocus=!0;g.isIOS&&void 0!==this._lastTouchOffset?(this.setCaretOffset(this._lastTouchOffset,!0),this._lastTouchOffset=void 0):this._updateDOMSelection();this._cursorDiv&&(this._cursorDiv.style.display="block");this._selDiv1&&(l=this._highlightRGB,this._selDiv1.style.background=l,this._selDiv2.style.background=l,this._selDiv3.style.background=
l);if(!this._ignoreFocus)this.onFocus({type:"Focus"})},_handleKeyDown:function(l){this._cancelCheckSelection();if(!this._ignoreEvent(l)){if(this.isListening("KeyDown")){var a=this._createKeyEvent("KeyDown",l);this.onKeyDown(a);if(a.defaultPrevented){g.isFirefox&&(this._keyDownPrevented=!0);l.preventDefault();return}}a=!1;switch(l.keyCode){case 16:case 17:case 18:case 91:a=!0;break;default:this._setLinksVisible(!1)}if(229===l.keyCode){if(this._readonly)return l.preventDefault&&l.preventDefault(),!1;
a=!0;g.isSafari&&g.isMac&&l.ctrlKey&&(a=!1,l.keyCode=129);a&&this._startIME()}else a||this._commitIME();if((g.isMac||g.isLinux)&&4>g.isFirefox||12.16>g.isOpera)return this._keyDownEvent=l,!0;if(this._doAction(l))return l.preventDefault?(l.preventDefault(),l.stopPropagation()):(l.cancelBubble=!0,l.returnValue=!1,l.keyCode=0),!1}},_handleKeyPress:function(l){if(!this._ignoreEvent(l))if(this._keyDownPrevented)l.preventDefault&&(l.preventDefault(),l.stopPropagation()),this._keyDownPrevented=void 0;else{if(g.isMac&&
g.isWebkit&&(63232<=l.keyCode&&63487>=l.keyCode||13===l.keyCode||8===l.keyCode)||((g.isMac||g.isLinux)&&4>g.isFirefox||12.16>g.isOpera)&&this._doAction(this._keyDownEvent))return l.preventDefault&&l.preventDefault(),!1;var a=g.isMac?l.metaKey:l.ctrlKey;if(void 0!==l.charCode&&a)switch(l.charCode){case 99:case 118:case 120:return!0}if(this.isListening("KeyPress")&&(a=this._createKeyEvent("KeyPress",l),this.onKeyPress(a),a.defaultPrevented)){l.preventDefault();return}if(this._doAction(l))return l.preventDefault?
(l.preventDefault(),l.stopPropagation()):(l.cancelBubble=!0,l.returnValue=!1,l.keyCode=0),!1;a=!1;if(g.isMac){if(l.ctrlKey||l.metaKey)a=!0}else if(g.isFirefox){if(l.ctrlKey||l.altKey)a=!0}else l.ctrlKey^l.altKey&&(a=!0);if(!a&&(a=g.isOpera?l.which:void 0!==l.charCode?l.charCode:l.keyCode,31<a))return this._doContent(String.fromCharCode(a)),l.preventDefault&&l.preventDefault(),!1}},_handleDocKeyUp:function(l){(g.isMac?l.metaKey:l.ctrlKey)||this._setLinksVisible(!1)},_handleKeyUp:function(l){if(!this._ignoreEvent(l)){if(this.isListening("KeyUp")){var a=
this._createKeyEvent("KeyUp",l);this.onKeyUp(a);if(a.defaultPrevented){l.preventDefault();return}}this._handleDocKeyUp(l);13===l.keyCode&&this._commitIME()}},_handleLinkClick:function(l){if(!(g.isMac?l.metaKey:l.ctrlKey))return l.preventDefault&&l.preventDefault(),!1},_handleMouse:function(l){var a=this._getWindow(),c=!0,d=a;if(g.isIE||g.isFirefox&&!this._overlayDiv)d=this._clientDiv;if(this._overlayDiv){this._hasFocus&&(this._ignoreFocus=!0);var e=this;a.setTimeout(function(){e.focus();e._ignoreFocus=
!1},0)}1===this._clickCount?(c=this._setSelectionTo(l.clientX,l.clientY,l.shiftKey,(!g.isOpera||12.16<=g.isOpera)&&this._hasFocus&&this.isListening("DragStart")))&&this._setGrab(d):(this._isW3CEvents&&this._setGrab(d),this._doubleClickSelection=null,this._setSelectionTo(l.clientX,l.clientY,l.shiftKey),this._doubleClickSelection=this._getSelection());return c},_handleMouseDown:function(l){if(!this._ignoreEvent(l)){if(this._linksVisible)if("A"!==(l.target||l.srcElement).tagName)this._setLinksVisible(!1);
else return;this._commitIME();var a=l.which;a||(4===l.button&&(a=2),2===l.button&&(a=3),1===l.button&&(a=1));var c=2!==a&&l.timeStamp?l.timeStamp:(new Date).getTime(),d=c-this._lastMouseTime,e=Math.abs(this._lastMouseX-l.clientX),b=Math.abs(this._lastMouseY-l.clientY),p=this._lastMouseButton===a;this._lastMouseX=l.clientX;this._lastMouseY=l.clientY;this._lastMouseTime=c;this._lastMouseButton=a;1===a&&(this._isMouseDown=!0,p&&d<=this._clickTime&&e<=this._clickDist&&b<=this._clickDist?this._clickCount++:
this._clickCount=1);if(this.isListening("MouseDown")&&(c=this._createMouseEvent("MouseDown",l),this.onMouseDown(c),c.defaultPrevented)){l.preventDefault();return}if(1===a&&this._handleMouse(l)&&(9<=g.isIE||g.isOpera||g.isChrome||g.isSafari||g.isFirefox&&!this._overlayDiv))this._hasFocus||this.focus(),l.preventDefault();g.isFirefox&&3===this._lastMouseButton&&this._updateDOMSelection()}},_handleMouseOver:function(l){if(!this._ignoreEvent(l)&&!this._animation&&this.isListening("MouseOver"))this.onMouseOver(this._createMouseEvent("MouseOver",
l))},_handleMouseOut:function(l){if(!this._ignoreEvent(l)&&!this._animation&&this.isListening("MouseOut"))this.onMouseOut(this._createMouseEvent("MouseOut",l))},_handleMouseMove:function(l){if(!this._animation){var a=this._isClientDiv(l);if(this.isListening("MouseMove")&&a)this.onMouseMove(this._createMouseEvent("MouseMove",l));if(!this._dropTarget){var c=this._linksVisible||this._lastMouseMoveX!==l.clientX||this._lastMouseMoveY!==l.clientY;this._lastMouseMoveX=l.clientX;this._lastMouseMoveY=l.clientY;
this._setLinksVisible(c&&!this._isMouseDown&&(g.isMac?l.metaKey:l.ctrlKey));if(!this._isW3CEvents){if(0===l.button)return this._setGrab(null),!0;if(!this._isMouseDown&&1===l.button&&0!==(this._clickCount&1)&&a)return this._clickCount=2,this._handleMouse(l,this._clickCount)}if(this._isMouseDown&&-1===this._dragOffset){a=l.clientX;l=l.clientY;var d=this._getViewPadding(),e=this._viewDiv.getBoundingClientRect(),b=this._getClientWidth(),p=this._getClientHeight(),c=e.left+d.left,f=e.top+d.top,b=e.left+
d.left+b,d=e.top+d.top+p;l<f?this._doAutoScroll("up",a,l-f):l>d?this._doAutoScroll("down",a,l-d):a<c&&!this._wrapMode?this._doAutoScroll("left",a-c,l):a>b&&!this._wrapMode?this._doAutoScroll("right",a-b,l):(this._endAutoScroll(),this._setSelectionTo(a,l,!0))}}}},_isClientDiv:function(l){var a=this._overlayDiv||this._clientDiv;for(l=l.target?l.target:l.srcElement;l;){if(a===l)return!0;l=l.parentNode}return!1},_createKeyEvent:function(l,a){return{type:l,event:a,preventDefault:function(){this.defaultPrevented=
!0}}},_createMouseEvent:function(l,a){var c=this.convert({x:a.clientX,y:a.clientY},"page","document");return{type:l,event:a,clickCount:this._clickCount,x:c.x,y:c.y,preventDefault:function(){this.defaultPrevented=!0}}},_handleMouseUp:function(l){var a=l.which?0===l.button:1===l.button;if(this.isListening("MouseUp")&&(this._isClientDiv(l)||a&&this._isMouseDown))this.onMouseUp(this._createMouseEvent("MouseUp",l));if(!this._linksVisible){if(a&&this._isMouseDown){if(-1!==this._dragOffset){var c=this._getSelection();
c.extend(this._dragOffset);c.collapse();this._setSelection(c,!0,!0);this._dragOffset=-1}this._isMouseDown=!1;this._endAutoScroll();this._isW3CEvents&&this._setGrab(null)}a&&g.isFirefox&&(this._updateDOMSelection(),l.preventDefault())}},_handleMouseWheel:function(l){var a=this._getLineHeight(),c=0,d=0;g.isIE||g.isOpera?d=-l.wheelDelta/40*a:g.isFirefox?"wheel"===l.type?l.deltaMode?(c=Math.max(-256,Math.min(256,l.deltaX))*a,d=Math.max(-256,Math.min(256,l.deltaY))*a):(c=l.deltaX,d=l.deltaY):(a=g.isMac?
3*l.detail:Math.max(-256,Math.min(256,l.detail))*a,l.axis===l.HORIZONTAL_AXIS?c=a:d=a):g.isMac?(d=l.timeStamp-this._wheelTimeStamp,this._wheelTimeStamp=l.timeStamp,c=0!==l.wheelDeltaX%120?1:40>d?40/(40-d):40,d=0!==l.wheelDeltaY%120?1:40>d?40/(40-d):40,c=Math.ceil(-l.wheelDeltaX/c),-1<c&&0>c&&(c=-1),0<c&&1>c&&(c=1),d=Math.ceil(-l.wheelDeltaY/d),-1<d&&0>d&&(d=-1),0<d&&1>d&&(d=1)):(c=-l.wheelDeltaX,d=8*(-l.wheelDeltaY/120)*a);if(g.isSafari||g.isChrome&&g.isMac){for(a=l.target;a&&void 0===a.lineIndex;)a=
a.parentNode;this._mouseWheelLine=a}a=this._getScroll();this._scrollView(c,d);c=this._getScroll();if(a.x!==c.x||a.y!==c.y)return l.preventDefault&&l.preventDefault(),!1},_handlePaste:function(a){this._cancelCheckSelection();if(!this._ignoreEvent(a)&&!this._ignorePaste&&this._doPaste(a)){if(g.isIE){var c=this;this._ignoreFocus=!0;this._getWindow().setTimeout(function(){c._updateDOMSelection();c._ignoreFocus=!1},0)}a.preventDefault&&a.preventDefault();return!1}},_handleResize:function(l){l=this._rootDiv.clientWidth;
var c=this._rootDiv.clientHeight;if(this._rootWidth!==l||this._rootHeight!==c)this._rootWidth!==l&&this._wrapMode&&this._resetLineHeight(),this._rootWidth=l,this._rootHeight=c,l=9>g.isIE,c=this._calculateMetrics(),a(c,this._metrics)||(this._variableLineHeight&&(this._variableLineHeight=!1,this._resetLineHeight()),this._metrics=c,l=!0),l?this._queueUpdate():this._update()},_handleRulerEvent:function(a){for(var c=a.target?a.target:a.srcElement,d=c.lineIndex;c&&!c._ruler;)void 0===d&&void 0!==c.lineIndex&&
(d=c.lineIndex),c=c.parentNode;var e=c?c._ruler:null;if(void 0===d&&e&&"document"===e.getOverview()){var d=this._getClientHeight(),b=this._model.getLineCount(),g=this._getViewPadding(),p=this._viewDiv.getBoundingClientRect(),d=Math.floor((a.clientY-p.top-this._metrics.scrollWidth)*b/(d+g.top+g.bottom-2*this._metrics.scrollWidth));0<=d&&d<b||(d=void 0)}if(e)switch(a.type){case "click":if(e.onClick)e.onClick(d,a);break;case "dblclick":if(e.onDblClick)e.onDblClick(d,a);break;case "mousemove":if(e.onMouseMove)e.onMouseMove(d,
a);break;case "mouseover":if(e.onMouseOver)e.onMouseOver(d,a);break;case "mouseout":if(e.onMouseOut){for(b=a.relatedTarget;b&&b!==this._rootDiv;){if(b===c)return;b=b.parentNode}e.onMouseOut(d,a)}}},_handleScroll:function(){var a=this._getScroll(!1),c=this._hScroll,d=this._vScroll;if(c!==a.x||d!==a.y)this._hScroll=a.x,this._vScroll=a.y,this._commitIME(),this._update(d===a.y),this.onScroll({type:"Scroll",oldValue:{x:c,y:d},newValue:a})},_handleSelectStart:function(a){var c=this._contextMenuOpen;this._contextMenuOpen=
!1;if(c)this._checkSelectionChange=!0;else if(this._ignoreSelect)return a&&a.preventDefault&&a.preventDefault(),!1},_getModelOffset:function(a,c){if(a){var d;d="DIV"===a.tagName?a:a.parentNode.parentNode;return!d._line?0:d._line.getModelOffset(a,c)}},_updateSelectionFromDOM:function(){if(!g.isOS&&!g.isAndroid&&!this._checkSelectionChange)return!1;var a=this._getWindow().getSelection(),c=this._getModelOffset(a.anchorNode,a.anchorOffset),d=this._getModelOffset(a.focusNode,a.focusOffset),e=this._getSelection();
if(void 0===c||void 0===d||e.start===c&&e.end===d)return!1;if(this._checkSelectionChange){var e=this._getLineNext(),b=this._getLinePrevious();if(a.anchorNode===e.firstChild.firstChild&&0===a.anchorOffset&&a.focusNode===b.firstChild.firstChild&&0===a.focusOffset)return!1;if(a.anchorNode===e.firstChild.firstChild&&0===a.anchorOffset&&a.focusNode===b.lastChild.firstChild||a.anchorNode===this._clientDiv&&a.focusNode===this._clientDiv)c=0,d=this.getModel().getCharCount()}this._setSelection(new u(c,d),
!1,!1);this._checkSelectionChange=!1;return!0},_cancelCheckSelection:function(){this._checkSelectionChange&&(this._checkSelectionChange=!1,this._cancelPollSelectionChange())},_cancelPollSelectionChange:function(){this._selPollTimer&&(this._getWindow().clearTimeout(this._selPollTimer),this._selPollTimer=null)},_pollSelectionChange:function(a){var c=this,d=this._getWindow();this._cancelPollSelectionChange();this._selPollTimer=d.setTimeout(function(){c._selPollTimer=null;c._clientDiv&&!c._updateSelectionFromDOM()&&
a&&c._pollSelectionChange(a)},100)},_handleSelectionChange:function(a){-1===this._imeOffset&&(g.isAndroid?this._pollSelectionChange():this._updateSelectionFromDOM())},_handleTextInput:function(a){if(!this._ignoreEvent(a)){this._imeOffset=-1;var c=this._getWindow().getSelection();if(c.anchorNode!==this._anchorNode||c.focusNode!==this._focusNode||c.anchorOffset!==this._anchorOffset||c.focusOffset!==this._focusOffset){for(var d=c.anchorNode;d&&void 0===d.lineIndex;)d=d.parentNode;if(d){var e=this._model,
b=d.lineIndex,g=e.getLine(b),p=g,f=0,e=e.getLineStart(b);0<c.rangeCount&&(c.getRangeAt(0).deleteContents(),b=d.ownerDocument.createTextNode(a.data),c.getRangeAt(0).insertNode(b),f=this._getDOMText(d,b),p=f.text,f=f.offset,b.parentNode.removeChild(b));d.lineRemoved=!0;for(d=0;g.charCodeAt(d)===p.charCodeAt(d)&&d<f;)d++;c=g.length-1;for(b=p.length-g.length;g.charCodeAt(c)===p.charCodeAt(c+b)&&c+b>=f+a.data.length;)c--;c++;g=p.substring(d,c+b);this._modifyContent({text:g,start:d+e,end:c+e,_ignoreDOMSelection:!0},
!0)}}else this._doContent(a.data);a.preventDefault()}},_handleTouchStart:function(a){this._commitIME();var c=this._getWindow();this._touchScrollTimer&&(this._vScrollDiv.style.display="none",this._hScrollDiv.style.display="none",c.clearInterval(this._touchScrollTimer),this._touchScrollTimer=null);var d=a.touches;if(1===d.length){var d=d[0],e=d.clientX,b=d.clientY;this._touchStartX=e;this._touchStartY=b;if(g.isAndroid&&(b<d.pageY-c.pageYOffset||e<d.pageX-c.pageXOffset))e=d.pageX-c.pageXOffset,b=d.pageY-
c.pageYOffset;c=this.convert({x:e,y:b},"page","document");this._lastTouchOffset=this.getOffsetAtLocation(c.x,c.y);this._touchStartTime=a.timeStamp;this._touching=!0}},_handleTouchMove:function(a){var c=a.touches;if(1===c.length){c=c[0];this._touchCurrentX=c.clientX;this._touchCurrentY=c.clientY;if(!this._touchScrollTimer&&200>a.timeStamp-this._touchStartTime){this._vScrollDiv.style.display="block";this._wrapMode||(this._hScrollDiv.style.display="block");var d=this,e=this._getWindow();this._touchScrollTimer=
e.setInterval(function(){var a=0,l=0;if(d._touching)a=d._touchStartX-d._touchCurrentX,l=d._touchStartY-d._touchCurrentY,d._touchSpeedX=a/10,d._touchSpeedY=l/10,d._touchStartX=d._touchCurrentX,d._touchStartY=d._touchCurrentY;else{if(0.1>Math.abs(d._touchSpeedX)&&0.1>Math.abs(d._touchSpeedY)){d._vScrollDiv.style.display="none";d._hScrollDiv.style.display="none";e.clearInterval(d._touchScrollTimer);d._touchScrollTimer=null;return}a=10*d._touchSpeedX;l=10*d._touchSpeedY;d._touchSpeedX*=0.95;d._touchSpeedY*=
0.95}d._scrollView(a,l)},10)}this._touchScrollTimer&&a.preventDefault()}},_handleTouchEnd:function(a){0===a.touches.length&&(this._touching=!1)},_doAction:function(a){var c,d,e=this._keyModes;for(d=e.length-1;0<=d;d--)if(c=e[d],"function"===typeof c.match&&(c=c.match(a),void 0!==c))return this.invokeAction(c);return!1},_doMove:function(a,c){var d=this._model,e=c.getCaret(),b=d.getLineAtOffset(e);a.count||(a.count=1);for(;0!==a.count;){var g=d.getLineStart(b);if(0>a.count&&e===g)if(0<b)"character"===
a.unit&&a.count++,b--,c.extend(d.getLineEnd(b));else break;else if(0<a.count&&e===d.getLineEnd(b))if(b+1<d.getLineCount())"character"===a.unit&&a.count--,b++,c.extend(d.getLineStart(b));else break;else{var p=!1;a.expandTab&&("character"===a.unit&&0===(e-g)%this._tabSize)&&(g=d.getText(g,e),p=!/[^ ]/.test(g));p?(c.extend(e-this._tabSize),a.count+=0>a.count?1:-1):(g=this._getLine(b),c.extend(g.getNextOffset(e,a)),g.destroy())}e=c.getCaret()}return c},_doBackspace:function(a){var c=this._getSelection();
c.isEmpty()&&(a.count||(a.count=1),a.count*=-1,a.expandTab=this._expandTab,this._doMove(a,c));this._modifyContent({text:"",start:c.start,end:c.end},!0);return!0},_doCase:function(a){var c=this._getSelection();this._doMove(a,c);var d=this.getText(c.start,c.end);this._setSelection(c,!0);switch(a.type){case "lower":d=d.toLowerCase();break;case "capitalize":d=d.replace(/(?:^|\s)\S/g,function(a){return a.toUpperCase()});break;case "reverse":a="";for(c=0;c<d.length;c++){var e=d[c],b=e.toLowerCase(),e=b!==
e?b:e.toUpperCase();a+=e}d=a;break;default:d=d.toUpperCase()}this._doContent(d);return!0},_doContent:function(a){var c=this._getSelection();if(this._overwriteMode&&c.isEmpty()){var d=this._model,e=d.getLineAtOffset(c.end);c.end<d.getLineEnd(e)&&(d=this._getLine(e),c.extend(d.getNextOffset(c.getCaret(),{unit:"character",count:1})),d.destroy())}this._modifyContent({text:a,start:c.start,end:c.end,_ignoreDOMSelection:!0},!0)},_doCopy:function(a){var c=this._getSelection();return!c.isEmpty()?(c=this._getBaseText(c.start,
c.end),this._setClipboardText(c,a)):!0},_doCursorNext:function(a){var c=this._getSelection();!c.isEmpty()&&!a.select?c.start=c.end:this._doMove(a,c);a.select||c.collapse();this._setSelection(c,!0);return!0},_doCursorPrevious:function(a){var c=this._getSelection();!c.isEmpty()&&!a.select?c.end=c.start:(a.count||(a.count=1),a.count*=-1,this._doMove(a,c));a.select||c.collapse();this._setSelection(c,!0);return!0},_doCut:function(a){var c=this._getSelection();return!c.isEmpty()?(c=this._getBaseText(c.start,
c.end),this._doContent(""),this._setClipboardText(c,a)):!0},_doDelete:function(a){var c=this._getSelection();c.isEmpty()&&this._doMove(a,c);this._modifyContent({text:"",start:c.start,end:c.end},!0);return!0},_doEnd:function(a){var c=this._getSelection(),d=this._model,e;if(a.ctrl)c.extend(d.getCharCount()),e=function(){};else{var b=c.getCaret(),g=d.getLineAtOffset(b);if(this._wrapMode){var p=this._getLine(g),b=p.getLineIndex(b),b=b===p.getLineCount()-1?d.getLineEnd(g):p.getLineStart(b+1)-1;p.destroy()}else a.count&&
0<a.count&&(g=Math.min(g+a.count-1,d.getLineCount()-1)),b=d.getLineEnd(g);c.extend(b)}a.select||c.collapse();this._setSelection(c,!0,!0,e);return!0},_doEnter:function(a){var c=this._model,d=this._getSelection();this._doContent(c.getLineDelimiter());a&&a.noCursor&&(d.end=d.start,this._setSelection(d,!0));return!0},_doHome:function(a){var c=this._getSelection(),d=this._model,e;if(a.ctrl)c.extend(0),e=function(){};else{var b=c.getCaret(),g=d.getLineAtOffset(b);this._wrapMode?(d=this._getLine(g),b=d.getLineIndex(b),
b=d.getLineStart(b),d.destroy()):b=d.getLineStart(g);c.extend(b)}a.select||c.collapse();this._setSelection(c,!0,!0,e);return!0},_doLineDown:function(a){var c=this._model,d=this._getSelection(),e=d.getCaret(),b=c.getLineAtOffset(e),p=this._getLine(b),f=this._columnX,s=1,m=!1;if(-1===f||a.wholeLine||a.select&&g.isIE)f=a.wholeLine?c.getLineEnd(b+1):e,f=p.getBoundingClientRect(f).left;(e=p.getLineIndex(e))<p.getLineCount()-1?s=p.getClientRects(e+1).top+1:(e=c.getLineCount()-1,m=b===e,a.count&&0<a.count?
b=Math.min(b+a.count,e):b++);e=!1;if(m){if(a.select||g.isMac||g.isLinux)d.extend(c.getCharCount()),e=!0}else p.lineIndex!==b&&(p.destroy(),p=this._getLine(b)),d.extend(p.getOffset(f,s)),e=!0;e&&(a.select||d.collapse(),this._setSelection(d,!0,!0));this._columnX=f;p.destroy();return!0},_doLineUp:function(a){var c=this._model,d=this._getSelection(),e=d.getCaret(),b=c.getLineAtOffset(e),p=this._getLine(b),f=this._columnX,s=!1,m;if(-1===f||a.wholeLine||a.select&&g.isIE)f=a.wholeLine?c.getLineStart(b-1):
e,f=p.getBoundingClientRect(f).left;0<(e=p.getLineIndex(e))?m=p.getClientRects(e-1).top+1:(s=0===b,s||(a.count&&0<a.count?b=Math.max(b-a.count,0):b--,m=this._getLineHeight(b)-1));e=!1;if(s){if(a.select||g.isMac||g.isLinux)d.extend(0),e=!0}else p.lineIndex!==b&&(p.destroy(),p=this._getLine(b)),d.extend(p.getOffset(f,m)),e=!0;e&&(a.select||d.collapse(),this._setSelection(d,!0,!0));this._columnX=f;p.destroy();return!0},_doNoop:function(){return!0},_doPageDown:function(a){var c=this,d=this._model,e=this._getSelection(),
b=e.getCaret(),p=d.getLineAtOffset(b),f=d.getLineCount(),s=this._getScroll(),d=this._getClientHeight(),m,h;if(this._lineHeight){m=this._columnX;s=this._getBoundsAtOffset(b);if(-1===m||a.select&&g.isIE)m=s.left;b=this._getLineIndex(s.top+d);h=this._getLine(b);p=this._getLinePixel(b);b=h.getOffset(m,s.top+d-p);d=h.getBoundingClientRect(b);h.destroy();e.extend(b);a.select||e.collapse();this._setSelection(e,!0,!0,function(){c._columnX=m},d.top+p-s.top);return!0}if(p<f-1){var u=this._getLineHeight(),k=
Math.min(f-p-1,Math.floor(d/u)),k=Math.max(1,k);m=this._columnX;if(-1===m||a.select&&g.isIE)h=this._getLine(p),m=h.getBoundingClientRect(b).left,h.destroy();h=this._getLine(p+k);e.extend(h.getOffset(m,0));h.destroy();a.select||e.collapse();a=f*u;b=s.y+k*u;b+d>a&&(b=a-d);this._setSelection(e,!0,!0,function(){c._columnX=m},b-s.y)}return!0},_doPageUp:function(a){var c=this,d=this._model,e=this._getSelection(),b=e.getCaret(),p=d.getLineAtOffset(b),f=this._getScroll(),s=this._getClientHeight(),m;if(this._lineHeight){m=
this._columnX;f=this._getBoundsAtOffset(b);if(-1===m||a.select&&g.isIE)m=f.left;b=this._getLineIndex(f.bottom-s);d=this._getLine(b);p=this._getLinePixel(b);b=d.getOffset(m,f.bottom-s-p);s=d.getBoundingClientRect(b);d.destroy();e.extend(b);a.select||e.collapse();this._setSelection(e,!0,!0,function(){c._columnX=m},s.top+p-f.top);return!0}if(0<p){var h=this._getLineHeight(),s=Math.max(1,Math.min(p,Math.floor(s/h)));m=this._columnX;if(-1===m||a.select&&g.isIE)d=this._getLine(p),m=d.getBoundingClientRect(b).left,
d.destroy();d=this._getLine(p-s);e.extend(d.getOffset(m,this._getLineHeight(p-s)-1));d.destroy();a.select||e.collapse();a=Math.max(0,f.y-s*h);this._setSelection(e,!0,!0,function(){c._columnX=m},a-f.y)}return!0},_doPaste:function(a){var c=this;return null!==this._getClipboardText(a,function(a){a&&(g.isLinux&&2===c._lastMouseButton&&(new Date).getTime()-c._lastMouseTime<=c._clickTime&&c._setSelectionTo(c._lastMouseX,c._lastMouseY),c._doContent(a))})},_doScroll:function(a){var c=a.type,d=this._model,
e=d.getLineCount();a=this._getClientHeight();var b=this._getLineHeight(),e=e*b,g=this._getScroll().y,p;switch(c){case "textStart":p=0;break;case "textEnd":p=e-a;break;case "pageDown":p=g+a;break;case "pageUp":p=g-a;break;case "lineDown":p=g+b;break;case "lineUp":p=g-b;break;case "centerLine":c=this._getSelection(),p=d.getLineAtOffset(c.start),d=(d.getLineAtOffset(c.end)-p+1)*b,p=p*b-a/2+d/2}void 0!==p&&(p=Math.min(Math.max(0,p),e-a),this._scrollViewAnimated(0,p-g,function(){}));return!0},_doSelectAll:function(a){a=
this._model;var c=this._getSelection();c.setCaret(0);c.extend(a.getCharCount());this._setSelection(c,!1);return!0},_doTab:function(a){if(this._tabMode&&!this._readonly){a="\t";if(this._expandTab){var c=this._model;a=this._getSelection().getCaret();var d=c.getLineAtOffset(a),c=c.getLineStart(d);a=Array(this._tabSize-(a-c)%this._tabSize+1).join(" ")}this._doContent(a);return!0}},_doShiftTab:function(a){if(this._tabMode&&!this._readonly)return!0},_doOverwriteMode:function(a){if(!this._readonly)return this.setOptions({overwriteMode:!this.getOptions("overwriteMode")}),
!0},_doTabMode:function(a){this._tabMode=!this._tabMode;return!0},_doWrapMode:function(a){this.setOptions({wrapMode:!this.getOptions("wrapMode")});return!0},_autoScroll:function(){var a=this._model,c=this._getSelection(),d=this.convert({x:this._autoScrollX,y:this._autoScrollY},"page","document"),e=c.getCaret(),b=a.getLineCount(),p=a.getLineAtOffset(e),f;if("up"===this._autoScrollDir||"down"===this._autoScrollDir)e=this._autoScrollY/this._getLineHeight(),e=0>e?Math.floor(e):Math.ceil(e),f=Math.max(0,
Math.min(b-1,p+e));else if("left"===this._autoScrollDir||"right"===this._autoScrollDir)f=this._getLineIndex(d.y),p=this._getLine(p),d.x+=p.getBoundingClientRect(e,!1).left,p.destroy();0===f&&(g.isMac||g.isLinux)?c.extend(0):f===b-1&&(g.isMac||g.isLinux)?c.extend(a.getCharCount()):(p=this._getLine(f),c.extend(p.getOffset(d.x,d.y-this._getLinePixel(f))),p.destroy());this._setSelection(c,!0)},_autoScrollTimer:function(){this._autoScroll();var a=this;this._autoScrollTimerID=this._getWindow().setTimeout(function(){a._autoScrollTimer()},
this._AUTO_SCROLL_RATE)},_calculateLineHeightTimer:function(a){if(this._lineHeight&&!this._calculateLHTimer){var c=this._model.getLineCount(),d=0;if(a){a=0;for(var e=(new Date).getTime(),b=0;d<c&&!(this._lineHeight[d]||(a++,b||(b=d),this._lineHeight[d]=this._calculateLineHeight(d)),d++,100<(new Date).getTime()-e););this.redrawRulers(0,c);this._queueUpdate()}a=this._getWindow();if(d!==c){var p=this;this._calculateLHTimer=a.setTimeout(function(){p._calculateLHTimer=null;p._calculateLineHeightTimer(!0)},
0)}else this._calculateLHTimer&&(a.clearTimeout(this._calculateLHTimer),this._calculateLHTimer=void 0)}},_calculateLineHeight:function(a){a=this._getLine(a);var c=a.getBoundingClientRect();a.destroy();return Math.max(1,c.bottom-c.top)},_calculateMetrics:function(){var a=this._clientDiv,c=a.ownerDocument,e=g.createElement(c,"div");e.style.lineHeight="normal";var b={type:"LineStyle",textView:this,0:0,lineText:this._model.getLine(0),lineStart:0};this.onLineStyle(b);m(b.style,e);e.style.position="fixed";
e.style.left="-1000px";var p=g.createElement(c,"span");p.appendChild(c.createTextNode(" "));e.appendChild(p);var f=g.createElement(c,"span");f.style.fontStyle="italic";f.appendChild(c.createTextNode(" "));e.appendChild(f);var h=g.createElement(c,"span");h.style.fontWeight="bold";h.appendChild(c.createTextNode(" "));e.appendChild(h);b=g.createElement(c,"span");b.style.fontWeight="bold";b.style.fontStyle="italic";b.appendChild(c.createTextNode(" "));e.appendChild(b);a.appendChild(e);var u=e.getBoundingClientRect(),
p=p.getBoundingClientRect(),f=f.getBoundingClientRect(),h=h.getBoundingClientRect(),b=b.getBoundingClientRect(),p=p.bottom-p.top,f=f.bottom-f.top,h=h.bottom-h.top,k=b.bottom-b.top,t=0,b=0>=u.bottom-u.top,u=Math.max(1,u.bottom-u.top);f>p&&(t=1);h>f&&(t=2);k>h&&(t=3);var w;0!==t&&(w={style:{}},0!==(t&1)&&(w.style.fontStyle="italic"),0!==(t&2)&&(w.style.fontWeight="bold"));p=s(e);a.removeChild(e);k=d(this._viewDiv);e=g.createElement(c,"div");e.style.position="fixed";e.style.left="-1000px";e.style.paddingLeft=
k.left+"px";e.style.paddingTop=k.top+"px";e.style.paddingRight=k.right+"px";e.style.paddingBottom=k.bottom+"px";e.style.width="100px";e.style.height="100px";k=g.createElement(c,"div");k.style.width="100%";k.style.height="100%";e.appendChild(k);a.appendChild(e);t=e.getBoundingClientRect();f=k.getBoundingClientRect();h=0;this._singleMode||(e.style.overflow="hidden",k.style.height="200px",h=e.clientWidth,e.style.overflow="scroll",h-=e.clientWidth);a.removeChild(e);k={left:f.left-t.left,top:f.top-t.top,
right:t.right-f.right,bottom:t.bottom-f.bottom};f=t=0;if(!b&&(this._wrapOffset||this._marginOffset))e=g.createElement(c,"div"),e.style.position="fixed",e.style.left="-1000px",e.innerHTML=Array(this._wrapOffset+1+(g.isWebkit?0:1)).join(" "),a.appendChild(e),t=e.getBoundingClientRect(),t=Math.ceil(t.right-t.left),e.innerHTML=Array(this._marginOffset+1).join(" "),f=e.getBoundingClientRect(),f=Math.ceil(f.right-f.left),a.removeChild(e);return{lineHeight:u,largestFontStyle:w,lineTrim:p,viewPadding:k,scrollWidth:h,
wrapWidth:t,marginWidth:f,invalid:b}},_cancelAnimation:function(){this._animation&&(this._animation.stop(),this._animation=null)},_clearSelection:function(a){var c=this._getSelection();if(c.isEmpty())return!1;"next"===a?c.start=c.end:c.end=c.start;this._setSelection(c,!0);return!0},_commitIME:function(){if(-1!==this._imeOffset){this._scrollDiv.focus();this._clientDiv.focus();var a=this._model,c=a.getLineAtOffset(this._imeOffset),d=a.getLineStart(c),e=this._getDOMText(this._getLineNode(c)).text,a=
a.getLine(c),d=this._imeOffset-d,a=d+e.length-a.length;d!==a&&(e=e.substring(d,a),this._doContent(e));this._imeOffset=-1}},_createActions:function(){this.addKeyMode(new q.DefaultKeyMode(this));var a=this;this._actions={noop:{defaultHandler:function(){return a._doNoop()}},lineUp:{defaultHandler:function(c){return a._doLineUp(e(c,{select:!1}))},actionDescription:{name:n.lineUp}},lineDown:{defaultHandler:function(c){return a._doLineDown(e(c,{select:!1}))},actionDescription:{name:n.lineDown}},lineStart:{defaultHandler:function(c){return a._doHome(e(c,
{select:!1,ctrl:!1}))},actionDescription:{name:n.lineStart}},lineEnd:{defaultHandler:function(c){return a._doEnd(e(c,{select:!1,ctrl:!1}))},actionDescription:{name:n.lineEnd}},charPrevious:{defaultHandler:function(c){return a._doCursorPrevious(e(c,{select:!1,unit:"character"}))},actionDescription:{name:n.charPrevious}},charNext:{defaultHandler:function(c){return a._doCursorNext(e(c,{select:!1,unit:"character"}))},actionDescription:{name:n.charNext}},pageUp:{defaultHandler:function(c){return a._doPageUp(e(c,
{select:!1}))},actionDescription:{name:n.pageUp}},pageDown:{defaultHandler:function(c){return a._doPageDown(e(c,{select:!1}))},actionDescription:{name:n.pageDown}},scrollPageUp:{defaultHandler:function(c){return a._doScroll(e(c,{type:"pageUp"}))},actionDescription:{name:n.scrollPageUp}},scrollPageDown:{defaultHandler:function(c){return a._doScroll(e(c,{type:"pageDown"}))},actionDescription:{name:n.scrollPageDown}},scrollLineUp:{defaultHandler:function(c){return a._doScroll(e(c,{type:"lineUp"}))},
actionDescription:{name:n.scrollLineUp}},scrollLineDown:{defaultHandler:function(c){return a._doScroll(e(c,{type:"lineDown"}))},actionDescription:{name:n.scrollLineDown}},wordPrevious:{defaultHandler:function(c){return a._doCursorPrevious(e(c,{select:!1,unit:"word"}))},actionDescription:{name:n.wordPrevious}},wordNext:{defaultHandler:function(c){return a._doCursorNext(e(c,{select:!1,unit:"word"}))},actionDescription:{name:n.wordNext}},textStart:{defaultHandler:function(c){return a._doHome(e(c,{select:!1,
ctrl:!0}))},actionDescription:{name:n.textStart}},textEnd:{defaultHandler:function(c){return a._doEnd(e(c,{select:!1,ctrl:!0}))},actionDescription:{name:n.textEnd}},scrollTextStart:{defaultHandler:function(c){return a._doScroll(e(c,{type:"textStart"}))},actionDescription:{name:n.scrollTextStart}},scrollTextEnd:{defaultHandler:function(c){return a._doScroll(e(c,{type:"textEnd"}))},actionDescription:{name:n.scrollTextEnd}},centerLine:{defaultHandler:function(c){return a._doScroll(e(c,{type:"centerLine"}))},
actionDescription:{name:n.centerLine}},selectLineUp:{defaultHandler:function(c){return a._doLineUp(e(c,{select:!0}))},actionDescription:{name:n.selectLineUp}},selectLineDown:{defaultHandler:function(c){return a._doLineDown(e(c,{select:!0}))},actionDescription:{name:n.selectLineDown}},selectWholeLineUp:{defaultHandler:function(c){return a._doLineUp(e(c,{select:!0,wholeLine:!0}))},actionDescription:{name:n.selectWholeLineUp}},selectWholeLineDown:{defaultHandler:function(c){return a._doLineDown(e(c,
{select:!0,wholeLine:!0}))},actionDescription:{name:n.selectWholeLineDown}},selectLineStart:{defaultHandler:function(c){return a._doHome(e(c,{select:!0,ctrl:!1}))},actionDescription:{name:n.selectLineStart}},selectLineEnd:{defaultHandler:function(c){return a._doEnd(e(c,{select:!0,ctrl:!1}))},actionDescription:{name:n.selectLineEnd}},selectCharPrevious:{defaultHandler:function(c){return a._doCursorPrevious(e(c,{select:!0,unit:"character"}))},actionDescription:{name:n.selectCharPrevious}},selectCharNext:{defaultHandler:function(c){return a._doCursorNext(e(c,
{select:!0,unit:"character"}))},actionDescription:{name:n.selectCharNext}},selectPageUp:{defaultHandler:function(c){return a._doPageUp(e(c,{select:!0}))},actionDescription:{name:n.selectPageUp}},selectPageDown:{defaultHandler:function(c){return a._doPageDown(e(c,{select:!0}))},actionDescription:{name:n.selectPageDown}},selectWordPrevious:{defaultHandler:function(c){return a._doCursorPrevious(e(c,{select:!0,unit:"word"}))},actionDescription:{name:n.selectWordPrevious}},selectWordNext:{defaultHandler:function(c){return a._doCursorNext(e(c,
{select:!0,unit:"word"}))},actionDescription:{name:n.selectWordNext}},selectTextStart:{defaultHandler:function(c){return a._doHome(e(c,{select:!0,ctrl:!0}))},actionDescription:{name:n.selectTextStart}},selectTextEnd:{defaultHandler:function(c){return a._doEnd(e(c,{select:!0,ctrl:!0}))},actionDescription:{name:n.selectTextEnd}},deletePrevious:{defaultHandler:function(c){return a._doBackspace(e(c,{unit:"character"}))},actionDescription:{name:n.deletePrevious}},deleteNext:{defaultHandler:function(c){return a._doDelete(e(c,
{unit:"character"}))},actionDescription:{name:n.deleteNext}},deleteWordPrevious:{defaultHandler:function(c){return a._doBackspace(e(c,{unit:"word"}))},actionDescription:{name:n.deleteWordPrevious}},deleteWordNext:{defaultHandler:function(c){return a._doDelete(e(c,{unit:"word"}))},actionDescription:{name:n.deleteWordNext}},deleteLineStart:{defaultHandler:function(c){return a._doBackspace(e(c,{unit:"line"}))},actionDescription:{name:n.deleteLineStart}},deleteLineEnd:{defaultHandler:function(c){return a._doDelete(e(c,
{unit:"line"}))},actionDescription:{name:n.deleteLineEnd}},tab:{defaultHandler:function(c){return a._doTab()},actionDescription:{name:n.tab}},shiftTab:{defaultHandler:function(c){return a._doShiftTab()},actionDescription:{name:n.shiftTab}},enter:{defaultHandler:function(c){return a._doEnter()},actionDescription:{name:n.enter}},enterNoCursor:{defaultHandler:function(c){return a._doEnter(e(c,{noCursor:!0}))},actionDescription:{name:n.enterNoCursor}},selectAll:{defaultHandler:function(c){return a._doSelectAll()},
actionDescription:{name:n.selectAll}},copy:{defaultHandler:function(c){return a._doCopy()},actionDescription:{name:n.copy}},cut:{defaultHandler:function(c){return a._doCut()},actionDescription:{name:n.cut}},paste:{defaultHandler:function(c){return a._doPaste()},actionDescription:{name:n.paste}},uppercase:{defaultHandler:function(c){return a._doCase(e(c,{type:"upper"}))},actionDescription:{name:n.uppercase}},lowercase:{defaultHandler:function(c){return a._doCase(e(c,{type:"lower"}))},actionDescription:{name:n.lowercase}},
capitalize:{defaultHandler:function(c){return a._doCase(e(c,{unit:"word",type:"capitalize"}))},actionDescription:{name:n.capitalize}},reversecase:{defaultHandler:function(c){return a._doCase(e(c,{type:"reverse"}))},actionDescription:{name:n.reversecase}},toggleOverwriteMode:{defaultHandler:function(c){return a._doOverwriteMode()},actionDescription:{name:n.toggleOverwriteMode}},toggleTabMode:{defaultHandler:function(c){return a._doTabMode()},actionDescription:{name:n.toggleTabMode}},toggleWrapMode:{defaultHandler:function(c){return a._doWrapMode()},
actionDescription:{name:n.toggleWrapMode}}}},_createRulerParent:function(a,c){var d=g.createElement(a,"div");d.className=c;d.tabIndex=-1;d.style.overflow="hidden";d.style.MozUserSelect="none";d.style.WebkitUserSelect="none";d.style.position="absolute";d.style.top="0px";d.style.bottom="0px";d.style.cursor="default";d.style.display="none";d.setAttribute("aria-hidden","true");this._rootDiv.appendChild(d);return d},_createRuler:function(a,c){if(this._clientDiv){var d=this._getRulerParent(a);if(d){if(d!==
this._marginDiv||this._marginOffset)d.style.display="block";var e=g.createElement(d.ownerDocument,"div");e._ruler=a;e.rulerChanged=!0;e.style.position="relative";e.style.cssFloat="left";e.style.styleFloat="left";e.style.outline="none";if(void 0===c||0>c||c>=d.children.length)d.appendChild(e);else{for(var b=d.firstChild;b&&0<c--;)b=b.nextSibling;d.insertBefore(e,b)}}}},_createView:function(){function a(){f._rootDiv&&(f.update(!0),f._metrics.invalid&&f._getWindow().setTimeout(function(){a()},100))}
if(!this._clientDiv){for(var c=this._parent;c.hasChildNodes();)c.removeChild(c.lastChild);var d=c.ownerDocument,e=g.createElement(d,"div");this._rootDiv=e;e.tabIndex=-1;e.style.position="relative";e.style.overflow="hidden";e.style.width="100%";e.style.height="100%";e.style.overflow="hidden";e.style.WebkitTextSizeAdjust="100%";e.setAttribute("role","application");c.appendChild(e);this._leftDiv=this._createRulerParent(d,"textviewLeftRuler");c=g.createElement(d,"div");c.className="textviewScroll";this._viewDiv=
c;c.tabIndex=-1;c.style.position="absolute";c.style.top="0px";c.style.bottom="0px";c.style.borderWidth="0px";c.style.margin="0px";c.style.outline="none";c.style.background="transparent";g.isMac&&g.isWebkit&&(c.style.pointerEvents="none",c.style.zIndex="2");e.appendChild(c);var b=this._createRulerParent(d,"textviewRightRuler");this._rightDiv=b;b.style.right="0px";this._scrollDiv=b=g.createElement(d,"div");b.style.margin="0px";b.style.borderWidth="0px";b.style.padding="0px";c.appendChild(b);(this._marginDiv=
this._createRulerParent(d,"textviewMarginRuler")).style.zIndex="4";!g.isIE&&!g.isIOS&&(this._clipDiv=c=g.createElement(d,"div"),c.style.position="absolute",c.style.overflow="hidden",c.style.margin="0px",c.style.borderWidth="0px",c.style.padding="0px",c.style.background="transparent",e.appendChild(c),this._clipScrollDiv=b=g.createElement(d,"div"),b.style.position="absolute",b.style.height="1px",b.style.top="-1000px",b.style.background="transparent",c.appendChild(b));this._setFullSelection(this._fullSelection,
!0);c=g.createElement(d,"div");c.className="textviewContent";this._clientDiv=c;c.tabIndex=0;c.style.position="absolute";c.style.borderWidth="0px";c.style.margin="0px";c.style.padding="0px";c.style.outline="none";c.style.zIndex="1";c.style.WebkitUserSelect="text";c.setAttribute("spellcheck","false");if(g.isIOS||g.isAndroid)c.style.WebkitTapHighlightColor="transparent";(this._clipDiv||e).appendChild(c);if(g.isIOS||g.isAndroid)this._vScrollDiv=b=g.createElement(d,"div"),b.style.position="absolute",b.style.borderWidth=
"1px",b.style.borderColor="white",b.style.borderStyle="solid",b.style.borderRadius="4px",b.style.backgroundColor="black",b.style.opacity="0.5",b.style.margin="0px",b.style.padding="0px",b.style.outline="none",b.style.zIndex="3",b.style.width="8px",b.style.display="none",e.appendChild(b),this._hScrollDiv=b=g.createElement(d,"div"),b.style.position="absolute",b.style.borderWidth="1px",b.style.borderColor="white",b.style.borderStyle="solid",b.style.borderRadius="4px",b.style.backgroundColor="black",
b.style.opacity="0.5",b.style.margin="0px",b.style.padding="0px",b.style.outline="none",b.style.zIndex="3",b.style.height="8px",b.style.display="none",e.appendChild(b);g.isFirefox&&!c.setCapture&&(this._overlayDiv=b=g.createElement(d,"div"),b.style.position=c.style.position,b.style.borderWidth=c.style.borderWidth,b.style.margin=c.style.margin,b.style.padding=c.style.padding,b.style.cursor="text",b.style.zIndex="2",(this._clipDiv||e).appendChild(b));c.contentEditable="true";c.setAttribute("role","textbox");
c.setAttribute("aria-multiline","true");this._setWrapMode(this._wrapMode,!0);this._setReadOnly(this._readonly);this._setThemeClass(this._themeClass,!0);this._setTabSize(this._tabSize,!0);this._setMarginOffset(this._marginOffset,!0);this._hookEvents();c=this._rulers;for(b=0;b<c.length;b++)this._createRuler(c[b]);this._update();var f=this;p(d,e,"textview",a)}},_defaultOptions:function(){return{parent:{value:void 0,update:null},model:{value:void 0,update:this.setModel},scrollAnimation:{value:0,update:null},
readonly:{value:!1,update:this._setReadOnly},fullSelection:{value:!0,update:this._setFullSelection},tabMode:{value:!0,update:null},tabSize:{value:8,update:this._setTabSize},expandTab:{value:!1,update:null},singleMode:{value:!1,update:this._setSingleMode},overwriteMode:{value:!1,update:this._setOverwriteMode},blockCursorVisible:{value:!1,update:this._setBlockCursor},marginOffset:{value:0,update:this._setMarginOffset},wrapOffset:{value:0,update:this._setWrapOffset},wrapMode:{value:!1,update:this._setWrapMode},
wrappable:{value:!1,update:null},theme:{value:b.TextTheme.getTheme(),update:this._setTheme},themeClass:{value:void 0,update:this._setThemeClass}}},_destroyRuler:function(a){var c=this._getRulerParent(a);if(c)for(var d=c.firstChild;d;){if(d._ruler===a){d._ruler=void 0;c.removeChild(d);if(0===c.children.length&&(c!==this._marginDiv||!this._marginOffset))c.style.display="none";break}d=d.nextSibling}},_destroyView:function(){if(this._clientDiv){this._setGrab(null);this._unhookEvents();var a=this._getWindow();
this._autoScrollTimerID&&(a.clearTimeout(this._autoScrollTimerID),this._autoScrollTimerID=null);this._updateTimer&&(a.clearTimeout(this._updateTimer),this._updateTimer=null);a=this._rootDiv;a.parentNode.removeChild(a);this._hScrollDiv=this._vScrollDiv=this._cursorDiv=this._marginDiv=this._rightDiv=this._leftDiv=this._overlayDiv=this._clientDiv=this._clipScrollDiv=this._clipDiv=this._viewDiv=this._scrollDiv=this._rootDiv=this._clipboardDiv=this._selDiv3=this._selDiv2=this._selDiv1=null}},_doAutoScroll:function(a,
c,d){this._autoScrollDir=a;this._autoScrollX=c;this._autoScrollY=d;this._autoScrollTimerID||this._autoScrollTimer()},_endAutoScroll:function(){this._autoScrollTimerID&&this._getWindow().clearTimeout(this._autoScrollTimerID);this._autoScrollTimerID=this._autoScrollDir=void 0},_fixCaret:function(){var a=this._clientDiv;if(a){var c=this._hasFocus;this._ignoreFocus=!0;c&&a.blur();a.contentEditable=!1;a.contentEditable=!0;c&&a.focus();this._ignoreFocus=!1}},_getBaseText:function(a,c){var d=this._model;
d.getBaseModel&&(a=d.mapOffset(a),c=d.mapOffset(c),d=d.getBaseModel());return d.getText(a,c)},_getBottomIndex:function(a){var c=this._bottomChild;if(a&&this._getClientHeight()>this._getLineHeight()){a=c.getBoundingClientRect();var d=this._clientDiv.getBoundingClientRect();a.bottom>d.bottom&&(c=this._getLinePrevious(c)||c)}return c.lineIndex},_getBoundsAtOffset:function(a){var c=this._getLine(this._model.getLineAtOffset(a));a=c.getBoundingClientRect(a);var d=this._getLinePixel(c.lineIndex);a.top+=
d;a.bottom+=d;c.destroy();return a},_getClientHeight:function(){var a=this._getViewPadding();return Math.max(0,this._viewDiv.clientHeight-a.top-a.bottom)},_getClientWidth:function(){var a=this._getViewPadding();return Math.max(0,this._viewDiv.clientWidth-a.left-a.right)},_getClipboardText:function(a,d){var e=this._model.getLineDelimiter(),b,p,f=this._getWindow(),s=f.clipboardData;!s&&a&&(s=a.clipboardData);if(s)return b=[],p=s.getData(g.isIE?"Text":"text/plain"),c(p,function(a){b.push(a)},function(){b.push(e)}),
p=b.join(""),d&&d(p),p;if(g.isFirefox){this._ignoreFocus=!0;var m=this._clipboardDiv,s=this._rootDiv.ownerDocument;m||(this._clipboardDiv=m=g.createElement(s,"div"),m.style.position="fixed",m.style.whiteSpace="pre",m.style.left="-1000px",this._rootDiv.appendChild(m));m.innerHTML="\x3cpre contenteditable\x3d''\x3e\x3c/pre\x3e";m.firstChild.focus();var h=this,u=function(){var a=h._getTextFromElement(m);m.innerHTML="";b=[];c(a,function(a){b.push(a)},function(){b.push(e)});return b.join("")},k=!1;this._ignorePaste=
!0;if(!g.isLinux||2!==this._lastMouseButton)try{k=s.execCommand("paste",!1,null)}catch(t){k=1<m.childNodes.length||m.firstChild&&0<m.firstChild.childNodes.length}this._ignorePaste=!1;if(!k){if(a)return f.setTimeout(function(){h.focus();(p=u())&&d&&d(p);h._ignoreFocus=!1},0),null;this.focus();this._ignoreFocus=!1;return""}this.focus();this._ignoreFocus=!1;(p=u())&&d&&d(p);return p}return""},_getDOMText:function(a,c){return a._line.getText(c)},_getTextFromElement:function(a){var c=a.ownerDocument,d=
c.defaultView;if(!d.getSelection)return a.innerText||a.textContent;c=c.createRange();c.selectNode(a);a=d.getSelection();var d=[],e;for(e=0;e<a.rangeCount;e++)d.push(a.getRangeAt(e));this._ignoreSelect=!0;a.removeAllRanges();a.addRange(c);c=a.toString();a.removeAllRanges();for(e=0;e<d.length;e++)a.addRange(d[e]);this._ignoreSelect=!1;return c},_getViewPadding:function(){return this._metrics.viewPadding},_getLine:function(a){var c=this._getLineNode(a);return c&&!c.lineChanged&&!c.lineRemoved?c._line:
new v(this,a)},_getLineHeight:function(a,c){if(void 0!==a&&this._lineHeight){var d=this._lineHeight[a];if(d)return d;if(c||void 0===c)return this._lineHeight[a]=this._calculateLineHeight(a)}return this._metrics.lineHeight},_getLineNode:function(a){for(var c=this._clientDiv.firstChild;c;){if(a===c.lineIndex)return c;c=c.nextSibling}},_getLineNext:function(a){for(a=a?a.nextSibling:this._clientDiv.firstChild;a&&-1===a.lineIndex;)a=a.nextSibling;return a},_getLinePrevious:function(a){for(a=a?a.previousSibling:
this._clientDiv.lastChild;a&&-1===a.lineIndex;)a=a.previousSibling;return a},_getLinePixel:function(a){a=Math.min(Math.max(0,a),this._model.getLineCount());if(this._lineHeight){var c=this._getTopIndex(),d=-this._topIndexY+this._getScroll().y;if(a>c)for(;c<a;c++)d+=this._getLineHeight(c);else for(c-=1;c>=a;c--)d-=this._getLineHeight(c);return d}return this._getLineHeight()*a},_getLineIndex:function(a){var c,d=0,e=this._model.getLineCount();if(this._lineHeight){var d=this._getTopIndex(),b=-this._topIndexY+
this._getScroll().y;if(a!==b)if(a<b)for(;a<b&&0<d;)a+=this._getLineHeight(--d);else for(c=this._getLineHeight(d);a-c>=b&&d<e-1;)a-=c,c=this._getLineHeight(++d)}else c=this._getLineHeight(),d=Math.floor(a/c);return Math.max(0,Math.min(e-1,d))},_getRulerParent:function(a){switch(a.getLocation()){case "left":return this._leftDiv;case "right":return this._rightDiv;case "margin":return this._marginDiv}return null},_getScroll:function(a){(void 0===a||a)&&this._cancelAnimation();a=this._viewDiv;return{x:a.scrollLeft,
y:a.scrollTop}},_getSelection:function(){return this._selection.clone()},_getTopIndex:function(a){var c=this._topChild;if(a&&this._getClientHeight()>this._getLineHeight()){a=c.getBoundingClientRect();var d=this._getViewPadding(),e=this._viewDiv.getBoundingClientRect();a.top<e.top+d.top&&(c=this._getLineNext(c)||c)}return c.lineIndex},_hookEvents:function(){var a=this;this._modelListener={onChanging:function(c){a._onModelChanging(c)},onChanged:function(c){a._onModelChanged(c)}};this._model.addEventListener("preChanging",
this._modelListener.onChanging);this._model.addEventListener("postChanged",this._modelListener.onChanged);this._themeListener={onChanged:function(c){a._setThemeClass(a._themeClass)}};this._theme.addEventListener("ThemeChanged",this._themeListener.onChanged);var c=this._handlers=[],d=this._clientDiv,e=this._viewDiv,b=this._rootDiv,p=this._overlayDiv||d,f=d.ownerDocument,s=this._getWindow(),m=g.isIE?f:s;c.push({target:s,type:"resize",handler:function(c){return a._handleResize(c?c:s.event)}});c.push({target:d,
type:"blur",handler:function(c){return a._handleBlur(c?c:s.event)}});c.push({target:d,type:"focus",handler:function(c){return a._handleFocus(c?c:s.event)}});c.push({target:e,type:"focus",handler:function(a){d.focus()}});c.push({target:e,type:"scroll",handler:function(c){return a._handleScroll(c?c:s.event)}});c.push({target:d,type:"textInput",handler:function(c){return a._handleTextInput(c?c:s.event)}});c.push({target:d,type:"keydown",handler:function(c){return a._handleKeyDown(c?c:s.event)}});c.push({target:d,
type:"keypress",handler:function(c){return a._handleKeyPress(c?c:s.event)}});c.push({target:d,type:"keyup",handler:function(c){return a._handleKeyUp(c?c:s.event)}});g.isIE&&c.push({target:f,type:"keyup",handler:function(c){return a._handleDocKeyUp(c?c:s.event)}});c.push({target:d,type:"contextmenu",handler:function(c){return a._handleContextMenu(c?c:s.event)}});c.push({target:d,type:"copy",handler:function(c){return a._handleCopy(c?c:s.event)}});c.push({target:d,type:"cut",handler:function(c){return a._handleCut(c?
c:s.event)}});c.push({target:d,type:"paste",handler:function(c){return a._handlePaste(c?c:s.event)}});c.push({target:f,type:"selectionchange",handler:function(c){return a._handleSelectionChange(c?c:s.event)}});if(g.isIOS||g.isAndroid)c.push({target:d,type:"touchstart",handler:function(c){return a._handleTouchStart(c?c:s.event)}}),c.push({target:d,type:"touchmove",handler:function(c){return a._handleTouchMove(c?c:s.event)}}),c.push({target:d,type:"touchend",handler:function(c){return a._handleTouchEnd(c?
c:s.event)}});else{c.push({target:d,type:"selectstart",handler:function(c){return a._handleSelectStart(c?c:s.event)}});c.push({target:d,type:"mousedown",handler:function(c){return a._handleMouseDown(c?c:s.event)}});c.push({target:d,type:"mouseover",handler:function(c){return a._handleMouseOver(c?c:s.event)}});c.push({target:d,type:"mouseout",handler:function(c){return a._handleMouseOut(c?c:s.event)}});c.push({target:m,type:"mouseup",handler:function(c){return a._handleMouseUp(c?c:s.event)}});c.push({target:m,
type:"mousemove",handler:function(c){return a._handleMouseMove(c?c:s.event)}});c.push({target:b,type:"mousedown",handler:function(c){return a._handleRootMouseDown(c?c:s.event)}});c.push({target:b,type:"mouseup",handler:function(c){return a._handleRootMouseUp(c?c:s.event)}});c.push({target:p,type:"dragstart",handler:function(c){return a._handleDragStart(c?c:s.event)}});c.push({target:p,type:"drag",handler:function(c){return a._handleDrag(c?c:s.event)}});c.push({target:p,type:"dragend",handler:function(c){return a._handleDragEnd(c?
c:s.event)}});c.push({target:p,type:"dragenter",handler:function(c){return a._handleDragEnter(c?c:s.event)}});c.push({target:p,type:"dragover",handler:function(c){return a._handleDragOver(c?c:s.event)}});c.push({target:p,type:"dragleave",handler:function(c){return a._handleDragLeave(c?c:s.event)}});c.push({target:p,type:"drop",handler:function(c){return a._handleDrop(c?c:s.event)}});c.push({target:this._clientDiv,type:26<g.isFirefox?"wheel":g.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(c){return a._handleMouseWheel(c?
c:s.event)}});this._clipDiv&&c.push({target:this._clipDiv,type:26<g.isFirefox?"wheel":g.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(c){return a._handleMouseWheel(c?c:s.event)}});if(g.isFirefox&&(!g.isWindows||15<=g.isFirefox))(e=s.MutationObserver||s.MozMutationObserver)?(this._mutationObserver=new e(function(c){a._handleDataModified(c)}),this._mutationObserver.observe(d,{subtree:!0,characterData:!0})):c.push({target:this._clientDiv,type:"DOMCharacterDataModified",handler:function(c){return a._handleDataModified(c?
c:s.event)}});this._overlayDiv&&(c.push({target:this._overlayDiv,type:"mousedown",handler:function(c){return a._handleMouseDown(c?c:s.event)}}),c.push({target:this._overlayDiv,type:"mouseover",handler:function(c){return a._handleMouseOver(c?c:s.event)}}),c.push({target:this._overlayDiv,type:"mouseout",handler:function(c){return a._handleMouseOut(c?c:s.event)}}),c.push({target:this._overlayDiv,type:"contextmenu",handler:function(c){return a._handleContextMenu(c?c:s.event)}}));this._isW3CEvents||c.push({target:this._clientDiv,
type:"dblclick",handler:function(c){return a._handleDblclick(c?c:s.event)}})}this._hookRulerEvents(this._leftDiv,c);this._hookRulerEvents(this._rightDiv,c);this._hookRulerEvents(this._marginDiv,c);for(e=0;e<c.length;e++)b=c[e],A(b.target,b.type,b.handler,b.capture)},_hookRulerEvents:function(a,c){if(a){var d=this,e=this._getWindow();g.isIE&&c.push({target:a,type:"selectstart",handler:function(){return!1}});c.push({target:a,type:26<g.isFirefox?"wheel":g.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(a){return d._handleMouseWheel(a?
a:e.event)}});c.push({target:a,type:"click",handler:function(a){d._handleRulerEvent(a?a:e.event)}});c.push({target:a,type:"dblclick",handler:function(a){d._handleRulerEvent(a?a:e.event)}});c.push({target:a,type:"mousemove",handler:function(a){d._handleRulerEvent(a?a:e.event)}});c.push({target:a,type:"mouseover",handler:function(a){d._handleRulerEvent(a?a:e.event)}});c.push({target:a,type:"mouseout",handler:function(a){d._handleRulerEvent(a?a:e.event)}})}},_getWindow:function(){return this._parent.ownerDocument.defaultView||
this._parent.ownerDocument.parentWindow},_ignoreEvent:function(a){for(a=a.target;a&&a!==this._clientDiv;){if(a.ignore)return!0;a=a.parentNode}return!1},_init:function(a){var c=a.parent;"string"===typeof c&&(c=(a.document||document).getElementById(c));if(!c)throw"no parent";a.parent=c;a.model=a.model||new r.TextModel;var d=this._defaultOptions(),e;for(e in d)d.hasOwnProperty(e)&&(this["_"+e]=void 0!==a[e]?a[e]:d[e].value);this._keyModes=[];this._rulers=[];this._selection=new u(0,0,!1);this._linksVisible=
!1;this._maxLineWidth=this._redrawCount=0;this._maxLineIndex=-1;this._ignoreSelect=!0;this._hasFocus=this._ignoreFocus=!1;this._dragOffset=this._columnX=-1;this._isRangeRects=(!g.isIE||9<=g.isIE)&&"function"===typeof c.ownerDocument.createRange().getBoundingClientRect;this._isW3CEvents=c.addEventListener;this._autoScrollTimerID=this._autoScrollY=this._autoScrollX=null;this._AUTO_SCROLL_RATE=50;this._mouseUpClosure=this._moseMoveClosure=this._grabControl=null;this._clickCount=this._lastMouseTime=this._lastMouseY=
this._lastMouseX=0;this._clickTime=250;this._clickDist=5;this._isMouseDown=!1;this._doubleClickSelection=null;this._vScroll=this._hScroll=0;this._imeOffset=-1;this._createActions();this._createView()},_modifyContent:function(a,c){if(!this._readonly||a._code)if(a.type="Verify",this.onVerify(a),!(null===a.text||void 0===a.text)){var d=this._model;try{a._ignoreDOMSelection&&(this._ignoreDOMSelection=!0),d.setText(a.text,a.start,a.end)}finally{a._ignoreDOMSelection&&(this._ignoreDOMSelection=!1)}c&&(d=
this._getSelection(),d.setCaret(a.start+a.text.length),this._setSelection(d,!0));this.onModify({type:"Modify"})}},_onModelChanged:function(a){a.type="ModelChanged";this.onModelChanged(a);a.type="Changed";var c=a.start,d=a.addedCharCount,e=a.removedCharCount,b=a.addedLineCount,p=a.removedLineCount,g=this._getSelection();g.end>c&&(g.end>c&&g.start<c+e?g.setCaret(c+d):(g.start+=d-e,g.end+=d-e),this._setSelection(g,!1,!1));c=this._model.getLineAtOffset(c);for(d=this._getLineNext();d;)e=d.lineIndex,c<=
e&&e<=c+p&&(c===e&&!d.modelChangedEvent&&!d.lineRemoved?(d.modelChangedEvent=a,d.lineChanged=!0):(d.lineRemoved=!0,d.lineChanged=!1,d.modelChangedEvent=null)),e>c+p&&(d.lineIndex=e+b-p,d._line.lineIndex=d.lineIndex),d=this._getLineNext(d);this._lineHeight&&(a=[c,p].concat(Array(b)),Array.prototype.splice.apply(this._lineHeight,a));!this._wrapMode&&(c<=this._maxLineIndex&&this._maxLineIndex<=c+p)&&(this._checkMaxLineIndex=this._maxLineIndex,this._maxLineIndex=-1,this._maxLineWidth=0);this._update()},
_onModelChanging:function(a){a.type="ModelChanging";this.onModelChanging(a);a.type="Changing"},_queueUpdate:function(){if(!this._updateTimer&&!this._ignoreQueueUpdate){var a=this;this._updateTimer=this._getWindow().setTimeout(function(){a._updateTimer=null;a._update()},0)}},_resetLineHeight:function(a,c){if(this._wrapMode||this._variableLineHeight){if(void 0!==a&&void 0!==c)for(var d=a;d<c;d++)this._lineHeight[d]=void 0;else this._lineHeight=Array(this._model.getLineCount());this._calculateLineHeightTimer()}else this._lineHeight=
null},_resetLineWidth:function(){var a=this._clientDiv;if(a)for(a=a.firstChild;a;)a.lineWidth=void 0,a=a.nextSibling},_reset:function(){this._maxLineIndex=-1;this._maxLineWidth=0;this._columnX=-1;this._bottomChild=this._topChild=null;this._topIndexY=0;this._variableLineHeight=!1;this._resetLineHeight();this._setSelection(new u(0,0,!1),!1,!1);this._viewDiv&&(this._viewDiv.scrollLeft=0,this._viewDiv.scrollTop=0);var a=this._clientDiv;if(a){for(a=a.firstChild;a;)a.lineRemoved=!0,a=a.nextSibling;13>g.isFirefox&&
this._fixCaret()}},_scrollViewAnimated:function(a,c,d){var e=this._getWindow();if(d&&this._scrollAnimation){var b=this;this._animation=new B({window:e,duration:this._scrollAnimation,curve:[c,0],onAnimate:function(a){a=c-Math.floor(a);b._scrollView(0,a);c-=a},onEnd:function(){b._animation=null;b._scrollView(a,c);d&&e.setTimeout(d,0)}});this._animation.play()}else this._scrollView(a,c),d&&e.setTimeout(d,0)},_scrollView:function(a,c){this._ensureCaretVisible=!1;var d=this._viewDiv;a&&(d.scrollLeft+=
a);c&&(d.scrollTop+=c)},_setClipboardText:function(a,d){var e,b=this._getWindow(),p=b.clipboardData;!p&&d&&(p=d.clipboardData);if(p&&(e=[],c(a,function(a){e.push(a)},function(){e.push(g.platformDelimiter)}),p.setData(g.isIE?"Text":"text/plain",e.join(""))||21<g.isFirefox))return!0;var f=this._parent.ownerDocument,s=g.createElement(f,"pre");s.style.position="fixed";s.style.left="-1000px";c(a,function(a){s.appendChild(f.createTextNode(a))},function(){s.appendChild(g.createElement(f,"br"))});s.appendChild(f.createTextNode(" "));
this._clientDiv.appendChild(s);p=f.createRange();p.setStart(s.firstChild,0);p.setEndBefore(s.lastChild);var m=b.getSelection();0<m.rangeCount&&m.removeAllRanges();m.addRange(p);var h=this,p=function(){s&&s.parentNode===h._clientDiv&&h._clientDiv.removeChild(s);h._updateDOMSelection()},m=!1;this._ignoreCopy=!0;try{m=f.execCommand("copy",!1,null)}catch(u){}this._ignoreCopy=!1;if(!m&&d)return b.setTimeout(p,0),!1;p();return!0},_setDOMSelection:function(a,c,d,e,b){this._setDOMFullSelection(a,c,d,e);a=
a._line.getNodeOffset(c);d=d._line.getNodeOffset(e);e=this._getWindow();c=this._parent.ownerDocument;if(e.getSelection){var p=e.getSelection();e=c.createRange();e.setStart(a.node,a.offset);e.setEnd(d.node,d.offset);if(this._hasFocus&&(p.anchorNode!==a.node||p.anchorOffset!==a.offset||p.focusNode!==d.node||p.focusOffset!==d.offset||p.anchorNode!==d.node||p.anchorOffset!==d.offset||p.focusNode!==a.node||p.focusOffset!==a.offset))this._anchorNode=a.node,this._anchorOffset=a.offset,this._focusNode=d.node,
this._focusOffset=d.offset,this._ignoreSelect=!1,0<p.rangeCount&&p.removeAllRanges(),p.addRange(e),this._ignoreSelect=!0;this._cursorDiv&&(e=c.createRange(),b?(e.setStart(a.node,a.offset),e.setEnd(a.node,a.offset)):(e.setStart(d.node,d.offset),e.setEnd(d.node,d.offset)),b=e.getClientRects()[0],a=this._cursorDiv.parentNode,d=a.getBoundingClientRect(),b&&d&&(this._cursorDiv.style.top=b.top-d.top+a.scrollTop+"px",this._cursorDiv.style.left=b.left-d.left+a.scrollLeft+"px"))}else c.selection&&this._hasFocus&&
(b=c.body,e=g.createElement(c,"div"),b.appendChild(e),b.removeChild(e),e=b.createTextRange(),e.moveToElementText(a.node.parentNode),e.moveStart("character",a.offset),b=b.createTextRange(),b.moveToElementText(d.node.parentNode),b.moveStart("character",d.offset),e.setEndPoint("EndToStart",b),this._ignoreSelect=!1,e.select(),this._ignoreSelect=!0)},_setDOMFullSelection:function(a,c,d,e){if(this._selDiv1){var b=this._selDiv1;b.style.width="0px";b.style.height="0px";b=this._selDiv2;b.style.width="0px";
b.style.height="0px";b=this._selDiv3;b.style.width="0px";b.style.height="0px";if(!(a===d&&c===e)){var p=this._getViewPadding(),g=this._clientDiv.getBoundingClientRect(),f=this._viewDiv.getBoundingClientRect(),b=f.left+p.left,s=g.right,p=f.top+p.top,m=g.bottom,f=g=0;this._clipDiv?(f=this._clipDiv.getBoundingClientRect(),g=f.left-this._clipDiv.scrollLeft):(f=this._rootDiv.getBoundingClientRect(),g=f.left);f=f.top;this._ignoreDOMSelection=!0;var h=(new v(this,a.lineIndex,a)).getBoundingClientRect(c,
!1),u=h.left;c=(new v(this,d.lineIndex,d)).getBoundingClientRect(e,!1);var k=c.left;this._ignoreDOMSelection=!1;var t=this._selDiv1,u=Math.min(s,Math.max(b,u)),w=Math.min(m,Math.max(p,h.top)),n=s;e=Math.min(m,Math.max(p,h.bottom));t.style.left=u-g+"px";t.style.top=w-f+"px";t.style.width=Math.max(0,n-u)+"px";t.style.height=Math.max(0,e-w)+"px";a.lineIndex===d.lineIndex?(n=Math.min(k,s),t.style.width=Math.max(0,n-u)+"px"):(h=Math.min(m,Math.max(p,c.top)),k=Math.min(s,Math.max(b,k)),p=Math.min(m,Math.max(p,
c.bottom)),m=this._selDiv3,m.style.left=b-g+"px",m.style.top=h-f+"px",m.style.width=Math.max(0,k-b)+"px",m.style.height=Math.max(0,p-h)+"px",1<Math.abs(a.lineIndex-d.lineIndex)&&(a=this._selDiv2,a.style.left=b-g+"px",a.style.top=e-f+"px",a.style.width=Math.max(0,s-b)+"px",a.style.height=Math.max(0,h-e)+"px"))}}},_setGrab:function(a){a!==this._grabControl&&(a?(a.setCapture&&a.setCapture(),this._grabControl=a):(this._grabControl.releaseCapture&&this._grabControl.releaseCapture(),this._grabControl=null))},
_setLinksVisible:function(a){if(this._linksVisible!==a){this._linksVisible=a;g.isIE&&a&&(this._hadFocus=this._hasFocus);var c=this._clientDiv;c.contentEditable=!a;this._hadFocus&&!a&&c.focus();this._overlayDiv&&(this._overlayDiv.style.zIndex=a?"-1":"1");for(a=this._getLineNext();a;)a._line.updateLinks(),a=this._getLineNext(a);this._updateDOMSelection()}},_setSelection:function(a,c,d,e,b){if(a){this._columnX=-1;void 0===d&&(d=!0);var p=this._selection;this._selection=a;!1!==c&&this._showCaret(!1,e,
c,b);d&&this._updateDOMSelection();if(!p.equals(a))this.onSelection({type:"Selection",oldValue:{start:p.start,end:p.end},newValue:{start:a.start,end:a.end}})}},_setSelectionTo:function(a,c,d,e){var b=this._model,p=this._getSelection();c=this.convert({x:a,y:c},"page","document");a=this._getLineIndex(c.y);if(1===this._clickCount){b=this._getLine(a);a=b.getOffset(c.x,c.y-this._getLinePixel(a));b.destroy();if(e&&!d&&p.start<=a&&a<p.end)return this._dragOffset=a,!1;p.extend(a);d||p.collapse()}else 0===
(this._clickCount&1)?(b=this._getLine(a),a=b.getOffset(c.x,c.y-this._getLinePixel(a)),this._doubleClickSelection?a>=this._doubleClickSelection.start?(d=this._doubleClickSelection.start,e=b.getNextOffset(a,{unit:"wordend",count:1})):(d=b.getNextOffset(a,{unit:"word",count:-1}),e=this._doubleClickSelection.end):(d=b.getNextOffset(a,{unit:"word",count:-1}),e=b.getNextOffset(d,{unit:"wordend",count:1})),b.destroy()):this._doubleClickSelection?(e=b.getLineAtOffset(this._doubleClickSelection.start),a>=
e?(d=b.getLineStart(e),e=b.getLineEnd(a)):(d=b.getLineStart(a),e=b.getLineEnd(e))):(d=b.getLineStart(a),e=b.getLineEnd(a)),p.setCaret(d),p.extend(e);this._setSelection(p,!0,!0);return!0},_setFullSelection:function(a,c){this._fullSelection=a;g.isWebkit&&(this._fullSelection=!0);var d=this._clipDiv||this._rootDiv;if(d)if(this._fullSelection){if(!this._selDiv1&&this._fullSelection&&!g.isIOS){var e=d.ownerDocument;this._highlightRGB=g.isWebkit?"transparent":"Highlight";var b=g.createElement(e,"div");
this._selDiv1=b;b.style.position="absolute";b.style.borderWidth="0px";b.style.margin="0px";b.style.padding="0px";b.style.outline="none";b.style.background=this._highlightRGB;b.style.width="0px";b.style.height="0px";b.style.zIndex="0";d.appendChild(b);var p=g.createElement(e,"div");this._selDiv2=p;p.style.position="absolute";p.style.borderWidth="0px";p.style.margin="0px";p.style.padding="0px";p.style.outline="none";p.style.background=this._highlightRGB;p.style.width="0px";p.style.height="0px";p.style.zIndex=
"0";d.appendChild(p);this._selDiv3=e=g.createElement(e,"div");e.style.position="absolute";e.style.borderWidth="0px";e.style.margin="0px";e.style.padding="0px";e.style.outline="none";e.style.background=this._highlightRGB;e.style.width="0px";e.style.height="0px";e.style.zIndex="0";d.appendChild(e);if(g.isFirefox&&g.isMac){d=this._getWindow().getComputedStyle(e,null).getPropertyValue("background-color");switch(d){case "rgb(119, 141, 168)":d="rgb(199, 208, 218)";break;case "rgb(127, 127, 127)":d="rgb(198, 198, 198)";
break;case "rgb(255, 193, 31)":d="rgb(250, 236, 115)";break;case "rgb(243, 70, 72)":d="rgb(255, 176, 139)";break;case "rgb(255, 138, 34)":d="rgb(255, 209, 129)";break;case "rgb(102, 197, 71)":d="rgb(194, 249, 144)";break;case "rgb(140, 78, 184)":d="rgb(232, 184, 255)";break;default:d="rgb(180, 213, 255)"}this._highlightRGB=d;b.style.background=d;p.style.background=d;e.style.background=d}c||this._updateDOMSelection()}}else this._selDiv1&&(d.removeChild(this._selDiv1),this._selDiv1=null),this._selDiv2&&
(d.removeChild(this._selDiv2),this._selDiv2=null),this._selDiv3&&(d.removeChild(this._selDiv3),this._selDiv3=null)},_setBlockCursor:function(a){this._blockCursorVisible=a;this._updateBlockCursorVisible()},_setOverwriteMode:function(a){this._overwriteMode=a;this._updateBlockCursorVisible()},_updateBlockCursorVisible:function(){if(this._blockCursorVisible||this._overwriteMode){if(!this._cursorDiv){var a=this._viewDiv,c=g.createElement(a.ownerDocument,"div");c.className="textviewBlockCursor";this._cursorDiv=
c;c.tabIndex=-1;c.style.zIndex="2";c.style.color="transparent";c.style.position="absolute";c.style.pointerEvents="none";c.innerHTML="\x26nbsp;";a.appendChild(c);this._updateDOMSelection()}}else this._cursorDiv&&(this._cursorDiv.parentNode.removeChild(this._cursorDiv),this._cursorDiv=null)},_setMarginOffset:function(a,c){this._marginOffset=a;this._marginDiv.style.display=a?"block":"none";c||(this._metrics=this._calculateMetrics(),this._queueUpdate())},_setWrapOffset:function(a,c){this._wrapOffset=
a;c||(this._metrics=this._calculateMetrics(),this._queueUpdate())},_setReadOnly:function(a){this._readonly=a;this._clientDiv.setAttribute("aria-readonly",a?"true":"false")},_setSingleMode:function(a,c){this._singleMode=a;this._updateOverflow();this._updateStyle(c)},_setTabSize:function(a,c){this._tabSize=a;this._customTabSize=void 0;var d=this._clientDiv;g.isOpera?d&&(d.style.OTabSize=this._tabSize+""):537.1<=g.isWebkit?d&&(d.style.tabSize=this._tabSize+""):4<=g.isFirefox?d&&(d.style.MozTabSize=this._tabSize+
""):8!==this._tabSize&&(this._customTabSize=this._tabSize);c||(this.redrawLines(),this._resetLineWidth())},_setTheme:function(a){this._theme&&this._theme.removeEventListener("ThemeChanged",this._themeListener.onChanged);(this._theme=a)&&this._theme.addEventListener("ThemeChanged",this._themeListener.onChanged);this._setThemeClass(this._themeClass)},_setThemeClass:function(a,c){this._themeClass=a;var d="textview",e=this._theme.getThemeClass();e&&(d+=" "+e);this._themeClass&&e!==this._themeClass&&(d+=
" "+this._themeClass);this._rootDiv.className=d;this._updateStyle(c)},_setWrapMode:function(a,c){this._wrapMode=a&&this._wrappable;var d=this._clientDiv;this._wrapMode?(d.style.whiteSpace="pre-wrap",d.style.wordWrap="break-word"):(d.style.whiteSpace="pre",d.style.wordWrap="normal");this._updateOverflow();c||(this.redraw(),this._resetLineWidth());this._resetLineHeight()},_showCaret:function(a,c,d,e){if(this._clientDiv){var b=this._model,p=this._getSelection(),g=this._getScroll(),f=p.getCaret(),s=p.start,
m=p.end,h=b.getLineAtOffset(s),u=b.getLineAtOffset(m),k=Math.max(Math.max(s,b.getLineStart(u)),m-1),b=this._getClientWidth(),t=this._getClientHeight(),w=b/4,v=this._getBoundsAtOffset(f===s?s:k),n=v.left,y=v.right,q=v.top,B=v.bottom,r=0,A="object"===typeof d;if((a||A)&&!p.isEmpty())v=this._getBoundsAtOffset(f===m?s:k),r=(v.bottom>B?v.bottom:B)-(v.top<q?v.top:q),a&&(v.top===q?f===s?y=n+Math.min(v.right-n,b):n=y-Math.min(y-v.left,b):f===s?B=q+Math.min(v.bottom-q,t):q=B-Math.min(B-v.top,t));a=0;n<g.x&&
(a=Math.min(n-g.x,-w));y>g.x+b&&(a=Math.max(y-g.x-b,w));p=0;q<g.y?p=q-g.y:B>g.y+t&&(p=B-g.y-t);e&&(0<e?0<p&&(p=Math.max(p,e)):0>p&&(p=Math.min(p,e)));e=A&&"always"===d.scrollPolicy;if(0!==a||0!==p||e)return A?(e=0<p,0===p&&(p=q-g.y),g=d.viewAnchor,q=d.selectionAnchor,d=Math.min(Math.max(0,d.viewAnchorOffset||0)),p="top"===g?p+Math.floor(e?(1-d)*t:-d*t):"bottom"===g?p+Math.floor(e?d*t:-(1-d)*t):"center"===g?p+Math.floor(e?t/2+d*t:t/2-(1-d)*t):p+Math.floor(e?d*t:-d*t),h!==u&&("top"===q&&f!==s?p+=Math.floor(-r):
"bottom"===q&&f!==m?p+=Math.floor(r):"center"===q&&(p+=Math.floor(r/2)))):0!==p&&"number"===typeof d&&(0>d&&(d=0),1<d&&(d=1),p+=Math.floor(0<p?d*t:-d*t)),this._scrollViewAnimated(a,p,c),t!==this._getClientHeight()||b!==this._getClientWidth()?this._showCaret():this._ensureCaretVisible=!0,!0;c&&c();return!1}},_startIME:function(){if(-1===this._imeOffset){var a=this._getSelection();a.isEmpty()||this._modifyContent({text:"",start:a.start,end:a.end},!0);this._imeOffset=a.start}},_unhookEvents:function(){this._model.removeEventListener("preChanging",
this._modelListener.onChanging);this._model.removeEventListener("postChanged",this._modelListener.onChanged);this._theme.removeEventListener("ThemeChanged",this._themeListener.onChanged);this._modelListener=null;for(var a=0;a<this._handlers.length;a++){var c=this._handlers[a];w(c.target,c.type,c.handler)}this._handlers=null;this._mutationObserver&&(this._mutationObserver.disconnect(),this._mutationObserver=null)},_updateDOMSelection:function(){if(!(0<this._redrawCount)&&!this._ignoreDOMSelection&&
this._clientDiv){var a=this._getSelection(),c=this._model,d=c.getLineAtOffset(a.start),e=c.getLineAtOffset(a.end),b=this._getLineNext();if(b){var p=this._getLinePrevious(),g;d<b.lineIndex?(d=b,g=c.getLineStart(b.lineIndex)):d>p.lineIndex?(d=p,g=c.getLineStart(p.lineIndex)):(d=this._getLineNode(d),g=a.start);e<b.lineIndex?(e=b,c=c.getLineStart(b.lineIndex)):e>p.lineIndex?(e=p,c=c.getLineStart(p.lineIndex)):(e=this._getLineNode(e),c=a.end);this._setDOMSelection(d,g,e,c,a.caret)}}},_update:function(a){if(!(0<
this._redrawCount)){this._updateTimer&&(this._getWindow().clearTimeout(this._updateTimer),this._updateTimer=null,a=!1);var c=this._clientDiv,d=this._viewDiv;if(c){this._metrics.invalid&&(this._ignoreQueueUpdate=!0,this._updateStyle(),this._ignoreQueueUpdate=!1);var e=this._model,b=this._getScroll(!1),p=this._getViewPadding(),f=e.getLineCount(),s=this._getLineHeight(),m=!1,h=!1,u=!1,k=this._metrics.scrollWidth;this._wrapMode&&(c.style.width=(this._metrics.wrapWidth||this._getClientWidth())+"px");var t,
w,n,y,q=0,B=0,r;if(this._lineHeight){for(;B<f;){r=this._getLineHeight(B);if(q+r>b.y)break;q+=r;B++}t=B;w=Math.max(0,t-1);n=e=b.y-q;0<t&&(e+=this._getLineHeight(t-1))}else y=Math.max(0,b.y)/s,t=Math.floor(y),w=Math.max(0,t-1),e=Math.round((y-w)*s),n=Math.round((y-t)*s);this._topIndexY=n;y=this._rootDiv;var A=y.clientWidth,J=y.clientHeight;if(a){s=0;this._leftDiv&&(t=this._leftDiv.getBoundingClientRect(),s=t.right-t.left);t=this._getClientWidth();y=this._getClientHeight();h=t;this._wrapMode?this._metrics.wrapWidth&&
(h=this._metrics.wrapWidth):h=Math.max(this._maxLineWidth,h);for(;B<f;)r=this._getLineHeight(B,!1),q+=r,B++;f=q}else{y=this._getClientHeight();n=Math.min(t+Math.floor((y+n)/s),f-1);var b=Math.min(n+1,f-1),D;for(r=c.firstChild;r;){D=r.lineIndex;var E=r.nextSibling;if(!(w<=D&&D<=b)||r.lineRemoved||-1===r.lineIndex)this._mouseWheelLine===r?(r.style.display="none",r.lineIndex=-1):c.removeChild(r);r=E}r=this._getLineNext();var E=d.ownerDocument,I=E.createDocumentFragment();for(D=w;D<=b;D++)!r||r.lineIndex>
D?(new v(this,D)).create(I,null):(I.firstChild&&(c.insertBefore(I,r),I=E.createDocumentFragment()),r&&r.lineChanged&&(r=(new v(this,D)).create(I,r),r.lineChanged=!1),r=this._getLineNext(r));I.firstChild&&c.insertBefore(I,r);g.isWebkit&&!this._wrapMode&&(c.style.width="0x7fffffffpx");r=this._getLineNext();D=y+e;for(I=!1;r;)w=r.lineWidth,void 0===w&&(E=r._line.getBoundingClientRect(),w=r.lineWidth=Math.ceil(E.right-E.left),E=E.bottom-E.top,this._lineHeight?this._lineHeight[r.lineIndex]=E:0!==s&&(0!==
E&&Math.ceil(s)!==Math.ceil(E))&&(this._variableLineHeight=!0,this._lineHeight=[],this._lineHeight[r.lineIndex]=E)),this._lineHeight&&!I&&(D-=this._lineHeight[r.lineIndex],0>D&&(n=r.lineIndex,I=!0)),this._wrapMode||(w>=this._maxLineWidth&&(this._maxLineWidth=w,this._maxLineIndex=r.lineIndex),this._checkMaxLineIndex===r.lineIndex&&(this._checkMaxLineIndex=-1)),r.lineIndex===t&&(this._topChild=r),r.lineIndex===n&&(this._bottomChild=r),r=this._getLineNext(r);-1!==this._checkMaxLineIndex&&(D=this._checkMaxLineIndex,
this._checkMaxLineIndex=-1,0<=D&&D<f&&(s=new v(this,D),E=s.getBoundingClientRect(),w=E.right-E.left,w>=this._maxLineWidth&&(this._maxLineWidth=w,this._maxLineIndex=D),s.destroy()));for(;B<f;)r=this._getLineHeight(B,B<=n),q+=r,B++;f=q;this._updateRuler(this._leftDiv,t,b,J);this._updateRuler(this._rightDiv,t,b,J);this._updateRuler(this._marginDiv,t,b,J);s=0;this._leftDiv&&(t=this._leftDiv.getBoundingClientRect(),s=t.right-t.left);b=0;this._rightDiv&&(b=this._rightDiv.getBoundingClientRect(),b=b.right-
b.left);d.style.left=s+"px";d.style.right=b+"px";b=this._scrollDiv;b.style.height=f+"px";t=this._getClientWidth();!this._singleMode&&!this._wrapMode&&(q=m=y,(B="scroll"===d.style.overflowX)?m+=k:q-=k,r=n=t,(w="scroll"===d.style.overflowY)?n+=k:r-=k,y=m,t=n,f>y&&(u=!0,t=r),this._maxLineWidth>t&&(h=!0,y=q,f>y&&(u=!0,t=r)),B!==h&&(d.style.overflowX=h?"scroll":"hidden"),w!==u&&(d.style.overflowY=u?"scroll":"hidden"),m=B!==h||w!==u);u=t;this._wrapMode?this._metrics.wrapWidth&&(u=this._metrics.wrapWidth):
u=Math.max(this._maxLineWidth,u);h=u;if((!g.isIE||9<=g.isIE)&&this._maxLineWidth>t)u+=p.right+p.left;b.style.width=u+"px";this._clipScrollDiv&&(this._clipScrollDiv.style.width=u+"px");b=this._getScroll(!1)}this._vScrollDiv&&(u=y-8,q=Math.max(15,Math.ceil(Math.min(1,u/(f+p.top+p.bottom))*u)),this._vScrollDiv.style.left=s+t-8+"px",this._vScrollDiv.style.top=Math.floor(Math.max(0,b.y*u/f))+"px",this._vScrollDiv.style.height=q+"px");!this._wrapMode&&this._hScrollDiv&&(u=t-8,q=Math.max(15,Math.ceil(Math.min(1,
u/(this._maxLineWidth+p.left+p.right))*u)),this._hScrollDiv.style.left=s+Math.floor(Math.max(0,Math.floor(b.x*u/this._maxLineWidth)))+"px",this._hScrollDiv.style.top=y-9+"px",this._hScrollDiv.style.width=q+"px");B=b.x;q=this._clipDiv;u=this._overlayDiv;if(n=this._marginDiv)n.style.left=-B+s+this._metrics.marginWidth+p.left+"px",n.style.bottom=("scroll"===d.style.overflowX?k:0)+"px";q?(q.scrollLeft=B,q.scrollTop=0,d=s+p.left,k=p.top,a=t,s=y,B=0,n=-e,0===b.x&&(d-=p.left,a+=p.left,B=p.left),b.x+t===
h&&(a+=p.right),0===b.y&&(k-=p.top,s+=p.top,n+=p.top),b.y+y===f&&(s+=p.bottom),q.style.left=d+"px",q.style.top=k+"px",q.style.right=A-a-d+"px",q.style.bottom=J-s-k+"px",c.style.left=B+"px",c.style.top=n+"px",c.style.width=h+"px",c.style.height=y+e+"px",u&&(u.style.left=c.style.left,u.style.top=c.style.top,u.style.width=c.style.width,u.style.height=c.style.height)):(d=B,k=e,A=B+t,J=e+y,0===d&&(d-=p.left),0===k&&(k-=p.top),A===h&&(A+=p.right),b.y+y===f&&(J+=p.bottom),c.style.clip="rect("+k+"px,"+A+
"px,"+J+"px,"+d+"px)",c.style.left=-B+s+p.left+"px",c.style.width=(this._wrapMode||g.isWebkit?h:t+B)+"px",a||(c.style.top=-e+p.top+"px",c.style.height=y+e+"px"),u&&(u.style.clip=c.style.clip,u.style.left=c.style.left,u.style.width=c.style.width,a||(u.style.top=c.style.top,u.style.height=c.style.height)));this._updateDOMSelection();m&&(c=this._ensureCaretVisible,this._ensureCaretVisible=!1,c&&this._showCaret(),this._queueUpdate())}}},_updateOverflow:function(){var a=this._viewDiv;this._wrapMode?(a.style.overflowX=
"hidden",a.style.overflowY="scroll"):a.style.overflow="hidden"},_updateRuler:function(a,c,d,e){if(a){var b=this._parent.ownerDocument,p=this._getLineHeight(),f=this._getViewPadding();for(a=a.firstChild;a;){var s=a._ruler,h=p,u=s.getOverview();"page"===u&&(h+=this._topIndexY);a.style.top=-h+"px";a.style.height=e+h+"px";a.rulerChanged&&m(s.getRulerStyle(),a);var t,k=a.firstChild;k?(t=k,k=k.nextSibling):(t=g.createElement(b,"div"),t.style.visibility="hidden",a.appendChild(t));var w;if(a.rulerChanged&&
t){h=-1;if(w=s.getWidestAnnotation())m(w.style,t),w.html&&(t.innerHTML=w.html);t.lineIndex=h;t.style.height=p+f.top+"px"}var v;if("page"===u){for(s=s.getAnnotations(c,d+1);k;)h=k.lineIndex,w=k.nextSibling,(!(c<=h&&h<=d)||k.lineChanged)&&a.removeChild(k),k=w;k=a.firstChild.nextSibling;v=b.createDocumentFragment();for(h=c;h<=d;h++)if(!k||k.lineIndex>h){t=g.createElement(b,"div");if(w=s[h])m(w.style,t),w.html&&(t.innerHTML=w.html),t.annotation=w;t.lineIndex=h;t.style.height=this._getLineHeight(h)+"px";
v.appendChild(t)}else v.firstChild&&(a.insertBefore(v,k),v=b.createDocumentFragment()),k&&(k=k.nextSibling);v.firstChild&&a.insertBefore(v,k)}else{w=this._getClientHeight();h=this._model.getLineCount();k=w+f.top+f.bottom-2*this._metrics.scrollWidth;u=p*h<k?p:k/h;if(a.rulerChanged){for(w=a.childNodes.length;1<w;)a.removeChild(a.lastChild),w--;s=s.getAnnotations(0,h);v=b.createDocumentFragment();for(var n in s)h=n>>>0,0>h||(t=g.createElement(b,"div"),w=s[n],m(w.style,t),t.style.position="absolute",
t.style.top=this._metrics.scrollWidth+p+Math.floor(h*u)+"px",w.html&&(t.innerHTML=w.html),t.annotation=w,t.lineIndex=h,v.appendChild(t));a.appendChild(v)}else if(a._oldTrackHeight!==k)for(t=a.firstChild?a.firstChild.nextSibling:null;t;)t.style.top=this._metrics.scrollWidth+p+Math.floor(t.lineIndex*u)+"px",t=t.nextSibling;a._oldTrackHeight=k}a.rulerChanged=!1;a=a.nextSibling}}},_updateStyleSheet:function(){var a="";g.isWebkit&&0<this._metrics.scrollWidth&&(a+="\n.textview ::-webkit-scrollbar-corner {background: #eeeeee;}");
g.isFirefox&&(g.isMac&&this._highlightRGB&&"Highlight"!==this._highlightRGB)&&(a+="\n.textview ::-moz-selection {background: "+this._highlightRGB+";}");if(a){var c=this._clientDiv.ownerDocument,d=c.getElementById("_textviewStyle");if(d)d.removeChild(d.firstChild),d.appendChild(c.createTextNode(a));else{d=g.createElement(c,"style");d.id="_textviewStyle";var e=c.getElementsByTagName("head")[0]||c.documentElement;d.appendChild(c.createTextNode(a));e.insertBefore(d,e.firstChild)}}},_updateStyle:function(a){!a&&
g.isIE&&(this._rootDiv.style.lineHeight="normal");var c=this._metrics=this._calculateMetrics();this._variableLineHeight&&(this._variableLineHeight=!1,this._resetLineHeight());this._rootDiv.style.lineHeight=g.isIE?c.lineHeight-(c.lineTrim.top+c.lineTrim.bottom)+"px":"normal";this._updateStyleSheet();a||(this.redraw(),this._resetLineWidth())}};k.EventTarget.addMixin(y.prototype);return{TextView:y}});
define("orion/editor/projectionTextModel",["orion/editor/textModel","orion/editor/eventTarget"],function(n,r){function q(k){this._model=k;this._projections=[];var b=this;this._listener={onChanged:function(f){b._onChanged(f)},onChanging:function(f){b._onChanging(f)}};k.addEventListener("postChanged",this._listener.onChanged);k.addEventListener("preChanging",this._listener.onChanging)}q.prototype={destroy:function(){this._model&&(this._model.removeEventListener("postChanged",this._listener.onChanged),
this._model.removeEventListener("preChanging",this._listener.onChanging),this._model=null)},addProjection:function(k){if(k){var b=this._model,f=this._projections;k._lineIndex=b.getLineAtOffset(k.start);k._lineCount=b.getLineAtOffset(k.end)-k._lineIndex;var g=k.text;g||(g="");k._model="string"===typeof g?new n.TextModel(g,b.getLineDelimiter()):g;var b=this.mapOffset(k.start,!0),g=k.end-k.start,m=k._lineCount,h=k._model.getCharCount(),e=k._model.getLineCount()-1,a={type:"Changing",text:k._model.getText(),
start:b,removedCharCount:g,addedCharCount:h,removedLineCount:m,addedLineCount:e};this.onChanging(a);a=this._binarySearch(f,k.start);f.splice(a,0,k);this.onChanged({type:"Changed",start:b,removedCharCount:g,addedCharCount:h,removedLineCount:m,addedLineCount:e})}},getProjections:function(){return this._projections.slice(0)},getBaseModel:function(){return this._model},mapOffset:function(k,b){var f=this._projections,g=0,m,h;if(b){for(m=0;m<f.length;m++){h=f[m];if(h.start>k)break;if(h.end>k)return-1;g+=
h._model.getCharCount()-(h.end-h.start)}return k+g}for(m=0;m<f.length;m++){h=f[m];if(h.start>k-g)break;var e=h._model.getCharCount();if(h.start+e>k-g)return-1;g+=e-(h.end-h.start)}return k-g},removeProjection:function(k){var b,f=0;for(b=0;b<this._projections.length;b++){var g=this._projections[b];if(g===k){k=g;break}f+=g._model.getCharCount()-(g.end-g.start)}if(b<this._projections.length){var g=this._model,f=k.start+f,m=k.end-k.start,h=k._lineCount,e=k._model.getCharCount(),a=k._model.getLineCount()-
1;k={type:"Changing",text:g.getText(k.start,k.end),start:f,removedCharCount:e,addedCharCount:m,removedLineCount:a,addedLineCount:h};this.onChanging(k);this._projections.splice(b,1);this.onChanged({type:"Changed",start:f,removedCharCount:e,addedCharCount:m,removedLineCount:a,addedLineCount:h})}},_binarySearch:function(k,b){for(var f=k.length,g=-1,m;1<f-g;)m=Math.floor((f+g)/2),b<=k[m].start?f=m:g=m;return f},getCharCount:function(){for(var k=this._model.getCharCount(),b=this._projections,f=0;f<b.length;f++)var g=
b[f],k=k+(g._model.getCharCount()-(g.end-g.start));return k},getLine:function(k,b){if(0>k)return null;var f=this._model,g=this._projections,m=0,h=[],e=0,a,c,d;for(a=0;a<g.length;a++){d=g[a];if(d._lineIndex>=k-m)break;c=d._model.getLineCount()-1;if(d._lineIndex+c>=k-m){e=k-(d._lineIndex+m);if(e<c)return d._model.getLine(e,b);h.push(d._model.getLine(c))}e=d.end;m+=c-d._lineCount}for(e=Math.max(e,f.getLineStart(k-m));a<g.length;a++){d=g[a];if(d._lineIndex>k-m)break;h.push(f.getText(e,d.start));c=d._model.getLineCount()-
1;if(d._lineIndex+c>k-m)return h.push(d._model.getLine(0,b)),h.join("");h.push(d._model.getText());e=d.end;m+=c-d._lineCount}g=f.getLineEnd(k-m,b);e<g&&h.push(f.getText(e,g));return h.join("")},getLineAtOffset:function(k){for(var b=this._model,f=this._projections,g=0,m=0,h=0;h<f.length;h++){var e=f[h];if(e.start>k-g)break;var a=e._model.getCharCount();if(e.start+a>k-g){f=k-(e.start+g);m+=e._model.getLineAtOffset(f);g+=f;break}m+=e._model.getLineCount()-1-e._lineCount;g+=a-(e.end-e.start)}return b.getLineAtOffset(k-
g)+m},getLineCount:function(){for(var k=this._projections,b=this._model.getLineCount(),f=0;f<k.length;f++)var g=k[f],b=b+(g._model.getLineCount()-1-g._lineCount);return b},getLineDelimiter:function(){return this._model.getLineDelimiter()},getLineEnd:function(k,b){if(0>k)return-1;for(var f=this._model,g=this._projections,m=0,h=0,e=0;e<g.length;e++){var a=g[e];if(a._lineIndex>k-m)break;var c=a._model.getLineCount()-1;if(a._lineIndex+c>k-m)return a._model.getLineEnd(k-(a._lineIndex+m),b)+a.start+h;h+=
a._model.getCharCount()-(a.end-a.start);m+=c-a._lineCount}return f.getLineEnd(k-m,b)+h},getLineStart:function(k){if(0>k)return-1;for(var b=this._model,f=this._projections,g=0,m=0,h=0;h<f.length;h++){var e=f[h];if(e._lineIndex>=k-g)break;var a=e._model.getLineCount()-1;if(e._lineIndex+a>=k-g)return e._model.getLineStart(k-(e._lineIndex+g))+e.start+m;m+=e._model.getCharCount()-(e.end-e.start);g+=a-e._lineCount}return b.getLineStart(k-g)+m},getText:function(k,b){void 0===k&&(k=0);var f=this._model,g=
this._projections,m=0,h=[],e,a,c;for(e=0;e<g.length;e++){a=g[e];if(a.start>k-m)break;c=a._model.getCharCount();if(a.start+c>k-m){if(void 0!==b&&a.start+c>b-m)return a._model.getText(k-(a.start+m),b-(a.start+m));h.push(a._model.getText(k-(a.start+m)));k=a.end+m+c-(a.end-a.start)}m+=c-(a.end-a.start)}var d=k-m;if(void 0!==b){for(;e<g.length;e++){a=g[e];if(a.start>b-m)break;h.push(f.getText(d,a.start));c=a._model.getCharCount();if(a.start+c>b-m)return h.push(a._model.getText(0,b-(a.start+m))),h.join("");
h.push(a._model.getText());d=a.end;m+=c-(a.end-a.start)}h.push(f.getText(d,b-m))}else{for(;e<g.length;e++)a=g[e],h.push(f.getText(d,a.start)),h.push(a._model.getText()),d=a.end;h.push(f.getText(d))}return h.join("")},_onChanged:function(k){k=this._change;var b=k.baseStart,f=k.baseEnd,g,m,h=this._projections;for(g=0;g<h.length&&!(m=h[g],m.end>b);g++);var e=g;for(g=0;g<h.length&&!(m=h[g],m.start>=f);g++);var a=g,c=this._model,b=k.baseText.length-(f-b);for(g=a;g<h.length;g++)m=h[g],m.start+=b,m.end+=
b,m._lineIndex=c.getLineAtOffset(m.start);m=h.splice(e,a-e);for(g=0;g<m.length;g++)m[g].annotation&&m[g].annotation._expand();this.onChanged({type:"Changed",start:k.start,removedCharCount:k.removedCharCount,addedCharCount:k.addedCharCount,removedLineCount:k.removedLineCount,addedLineCount:k.addedLineCount});this._change=void 0},_onChanging:function(k){var b=!!this._change,f=this._change||{},g=k.start,m=g+k.removedCharCount;f.baseStart=g;f.baseEnd=m;f.baseText=k.text;f.addedLineCount=k.addedLineCount;
if(!b){this._change=f;f.text=k.text;var h=this._projections,e,a,c;k=function(d){for(e=a=0;a<h.length;a++){c=h[a];if(c.start>d)break;if(c.end>d)return-1;e+=c._model.getCharCount()-(c.end-c.start)}return d+e};f.start=k(g);-1===f.start&&(f.text=this._model.getText(c.start,g)+f.text,f.addedLineCount+=this._model.getLineAtOffset(g)-this._model.getLineAtOffset(c.start),f.start=c.start+e);f.end=k(m);-1===f.end&&(f.text+=this._model.getText(m,c.end),f.addedLineCount+=this._model.getLineAtOffset(c.end)-this._model.getLineAtOffset(m),
f.end=c.start+e)}f.addedCharCount=f.text.length;f.removedCharCount=f.end-f.start;f.removedLineCount=this.getLineAtOffset(f.end)-this.getLineAtOffset(f.start);this.onChanging({type:"Changing",text:f.text,start:f.start,removedCharCount:f.removedCharCount,addedCharCount:f.addedCharCount,removedLineCount:f.removedLineCount,addedLineCount:f.addedLineCount})},onChanging:function(k){return this.dispatchEvent(k)},onChanged:function(k){return this.dispatchEvent(k)},setLineDelimiter:function(k){this._model.setLineDelimiter(k)},
setText:function(k,b,f){function g(c){for(h=e=0;e<m.length;e++){a=m[e];if(a.start>c-h)break;var d=a._model.getCharCount();if(a.start+d>c-h)return-1;h+=d-(a.end-a.start)}return c-h}this._change={text:k||"",start:b||0,end:void 0===f?this.getCharCount():f};var m=this._projections,h,e,a,c,d;k=g(this._change.start);-1===k&&(c={projection:a,start:this._change.start-(a.start+h)},k=a.end);b=g(this._change.end);-1===b&&(d={projection:a,end:this._change.end-(a.start+h)},b=a.start);c&&d&&c.projection===d.projection?
a._model.setText(this._change.text,c.start,d.end):(this._model.setText(this._change.text,k,b),c&&(a=c.projection,a._model.setText("",c.start)),d&&(a=d.projection,a._model.setText("",0,d.end),a.start=a.end,a._lineCount=0));this._change=void 0}};r.EventTarget.addMixin(q.prototype);return{ProjectionTextModel:q}});
define("orion/editor/annotations",["i18n!orion/editor/nls/messages","orion/editor/eventTarget"],function(n,r){function q(){}function k(a,c,d){this.start=a;this.end=c;this._projectionModel=d;this.html=this._expandedHTML;this.style=this._expandedStyle;this.expanded=!0}function b(a,c){var d=a.lastIndexOf("."),d=a.substring(d+1),e={title:n[d],style:{styleClass:"annotation "+d},html:"\x3cdiv class\x3d'annotationHTML "+d+"'\x3e\x3c/div\x3e",overviewStyle:{styleClass:"annotationOverview "+d}};c?e.lineStyle=
{styleClass:"annotationLine "+d}:e.rangeStyle={styleClass:"annotationRange "+d};q.registerType(a,e)}function f(){}function g(a,c){for(var d=a.length,e=-1,b;1<d-e;)b=Math.floor((d+e)/2),c<=a[b].start?d=b:e=b;return d}function m(a){this._annotations=[];var c=this;this._listener={onChanged:function(a){c._onChanged(a)}};this.setTextModel(a)}function h(a,c){this._view=a;this._annotationModel=c;var d=this;this._listener={onDestroy:function(a){d._onDestroy(a)},onLineStyle:function(a){d._onLineStyle(a)},
onChanged:function(a){d._onAnnotationModelChanged(a)}};a.addEventListener("Destroy",this._listener.onDestroy);a.addEventListener("postLineStyle",this._listener.onLineStyle);c.addEventListener("Changed",this._listener.onChanged)}k.prototype={_expandedHTML:"\x3cdiv class\x3d'annotationHTML expanded'\x3e\x3c/div\x3e",_expandedStyle:{styleClass:"annotation expanded"},_collapsedHTML:"\x3cdiv class\x3d'annotationHTML collapsed'\x3e\x3c/div\x3e",_collapsedStyle:{styleClass:"annotation collapsed"},_collapse:function(){if(!this.expanded)return!1;
this.expanded=!1;this.html=this._collapsedHTML;this.style=this._collapsedStyle;this._annotationModel&&this._annotationModel.modifyAnnotation(this);return!0},_expand:function(){if(this.expanded)return!1;this.expanded=!0;this.html=this._expandedHTML;this.style=this._expandedStyle;this._annotationModel&&this._annotationModel.modifyAnnotation(this);return!0},_collapseImpl:function(a){if(this._collapse()){a&&this._forEachOverlaping(function(a){a.expanded||(a._expandImpl(!1),a._recollapse=!0)});a=this._projectionModel;
var c=a.getBaseModel();this._projection={annotation:this,start:c.getLineStart(c.getLineAtOffset(this.start)+1),end:c.getLineEnd(c.getLineAtOffset(this.end),!0)};a.addProjection(this._projection)}},_expandImpl:function(a){this._expand()&&(this._projectionModel.removeProjection(this._projection),a&&this._forEachOverlaping(function(a){a._recollapse&&(a._collapseImpl(!1),a._recollapse=!1)}))},_forEachOverlaping:function(a){if(this._annotationModel)for(var c=this._annotationModel.getAnnotations(this.start,
this.end);c.hasNext();){var d=c.next();d!==this&&d.type===q.ANNOTATION_FOLDING&&a.call(this,d)}},collapse:function(){this._recollapse=!1;this._collapseImpl(!0)},expand:function(){this._recollapse=!1;this._expandImpl(!0)}};q.ANNOTATION_ERROR="orion.annotation.error";q.ANNOTATION_WARNING="orion.annotation.warning";q.ANNOTATION_TASK="orion.annotation.task";q.ANNOTATION_BREAKPOINT="orion.annotation.breakpoint";q.ANNOTATION_BOOKMARK="orion.annotation.bookmark";q.ANNOTATION_FOLDING="orion.annotation.folding";
q.ANNOTATION_CURRENT_BRACKET="orion.annotation.currentBracket";q.ANNOTATION_MATCHING_BRACKET="orion.annotation.matchingBracket";q.ANNOTATION_CURRENT_LINE="orion.annotation.currentLine";q.ANNOTATION_CURRENT_SEARCH="orion.annotation.currentSearch";q.ANNOTATION_MATCHING_SEARCH="orion.annotation.matchingSearch";q.ANNOTATION_READ_OCCURRENCE="orion.annotation.readOccurrence";q.ANNOTATION_WRITE_OCCURRENCE="orion.annotation.writeOccurrence";q.ANNOTATION_SELECTED_LINKED_GROUP="orion.annotation.selectedLinkedGroup";
q.ANNOTATION_CURRENT_LINKED_GROUP="orion.annotation.currentLinkedGroup";q.ANNOTATION_LINKED_GROUP="orion.annotation.linkedGroup";q.ANNOTATION_BLAME="orion.annotation.blame";q.ANNOTATION_CURRENT_BLAME="orion.annotation.currentBlame";var e={};q.registerType=function(a,c){var d=c;"function"!==typeof d&&(d=function(a,c,d){this.start=a;this.end=c;void 0!==d&&(this.title=d)},d.prototype=c);d.prototype.type=a;e[a]=d;return a};q.createAnnotation=function(a,c,d,e){return new (this.getType(a))(c,d,e)};q.getType=
function(a){return e[a]};b(q.ANNOTATION_ERROR);b(q.ANNOTATION_WARNING);b(q.ANNOTATION_TASK);b(q.ANNOTATION_BREAKPOINT);b(q.ANNOTATION_BOOKMARK);b(q.ANNOTATION_CURRENT_BRACKET);b(q.ANNOTATION_MATCHING_BRACKET);b(q.ANNOTATION_CURRENT_SEARCH);b(q.ANNOTATION_MATCHING_SEARCH);b(q.ANNOTATION_READ_OCCURRENCE);b(q.ANNOTATION_WRITE_OCCURRENCE);b(q.ANNOTATION_SELECTED_LINKED_GROUP);b(q.ANNOTATION_CURRENT_LINKED_GROUP);b(q.ANNOTATION_LINKED_GROUP);b(q.ANNOTATION_CURRENT_LINE,!0);b(q.ANNOTATION_BLAME,!0);b(q.ANNOTATION_CURRENT_BLAME,
!0);q.registerType(q.ANNOTATION_FOLDING,k);f.addMixin=function(a){var c=f.prototype,d;for(d in c)c.hasOwnProperty(d)&&(a[d]=c[d])};f.prototype={addAnnotationType:function(a,c){this._annotationTypes||(this._annotationTypes=[]);var d=c-1;void 0==c||!(0<=d&&d<this._annotationTypes.length)?this._annotationTypes.push(a):this._annotationTypes.splice(d,0,a)},getAnnotationTypePriority:function(a){if(this._annotationTypes)for(var c=0;c<this._annotationTypes.length;c++)if(this._annotationTypes[c]===a)return c+
1;return 0},getAnnotationsByType:function(a,c,d){a=a.getAnnotations(c,d);for(d=[];a.hasNext();)c=a.next(),0!==this.getAnnotationTypePriority(c.type)&&d.push(c);var e=this;d.sort(function(a,c){return e.getAnnotationTypePriority(a.type)-e.getAnnotationTypePriority(c.type)});return d},isAnnotationTypeVisible:function(a){return 0!==this.getAnnotationTypePriority(a)},removeAnnotationType:function(a){if(this._annotationTypes)for(var c=0;c<this._annotationTypes.length;c++)if(this._annotationTypes[c]===a){this._annotationTypes.splice(c,
1);break}}};m.prototype={addAnnotation:function(a){if(a){var c=this._annotations,d=g(c,a.start);c.splice(d,0,a);a._annotationModel=this;this.onChanged({type:"Changed",added:[a],removed:[],changed:[]})}},getTextModel:function(){return this._model},getAnnotations:function(a,c){var d=this._annotations,e,b=0,g;g=void 0===a&&void 0===c?function(){return b<d.length?d[b++]:null}:function(){for(;b<d.length;){var e=d[b++];if(a===e.start||(a>e.start?a<e.end:e.start<c))return e;if(e.start>=c)break}return null};
e=g();return{next:function(){var a=e;a&&(e=g());return a},hasNext:function(){return null!==e}}},modifyAnnotation:function(a){if(a&&!(0>this._getAnnotationIndex(a)))this.onChanged({type:"Changed",added:[],removed:[],changed:[a]})},onChanged:function(a){return this.dispatchEvent(a)},removeAnnotations:function(a){var c=this._annotations,d,e;if(a){d=[];for(e=c.length-1;0<=e;e--){var b=c[e];b.type===a&&(c.splice(e,1),d.splice(0,0,b),b._annotationModel=null)}}else d=c;this.onChanged({type:"Changed",removed:d,
added:[],changed:[]})},removeAnnotation:function(a){if(a){var c=this._getAnnotationIndex(a);0>c||(a._annotationModel=null,a={type:"Changed",removed:this._annotations.splice(c,1),added:[],changed:[]},this.onChanged(a))}},replaceAnnotations:function(a,c){var d=this._annotations,e,b,f,h=[];if(a)for(e=a.length-1;0<=e;e--)f=a[e],b=this._getAnnotationIndex(f),0>b||(f._annotationModel=null,d.splice(b,1),h.splice(0,0,f));c||(c=[]);for(e=0;e<c.length;e++)f=c[e],b=g(d,f.start),f._annotationModel=this,d.splice(b,
0,f);this.onChanged({type:"Changed",removed:h,added:c,changed:[]})},setTextModel:function(a){this._model&&this._model.removeEventListener("Changed",this._listener.onChanged);(this._model=a)&&this._model.addEventListener("Changed",this._listener.onChanged)},_getAnnotationIndex:function(a){for(var c=this._annotations,d=g(c,a.start);d<c.length&&c[d].start===a.start;){if(c[d]===a)return d;d++}return-1},_onChanged:function(a){var c=a.start,d=a.addedCharCount,e=a.removedCharCount,b=this._annotations,g=
c+e;if(0<b.length){a={type:"Changed",added:[],removed:[],changed:[],textModelChangedEvent:a};d-=e;for(e=0;e<b.length;e++){var f=b[e];f.start>=g?(f._oldStart=f.start,f._oldEnd=f.end,f.start+=d,f.end+=d,a.changed.push(f)):f.end<=c||(f.start<c&&g<f.end?(f._oldStart=f.start,f._oldEnd=f.end,f.end+=d,a.changed.push(f)):(b.splice(e,1),a.removed.push(f),f._annotationModel=null,f.expand&&f.expand(),e--))}if(0<a.added.length||0<a.removed.length||0<a.changed.length)this.onChanged(a)}}};r.EventTarget.addMixin(m.prototype);
h.prototype={destroy:function(){var a=this._view;a&&(a.removeEventListener("Destroy",this._listener.onDestroy),a.removeEventListener("LineStyle",this._listener.onLineStyle),this.view=null);(a=this._annotationModel)&&a.removeEventListener("Changed",this._listener.onChanged)},_mergeStyle:function(a,c){if(c){a||(a={});a.styleClass=a.styleClass&&c.styleClass&&a.styleClass!==c.styleClass?a.styleClass+(" "+c.styleClass):c.styleClass;var d;c.tagName&&!a.tagName&&(a.tagName=c.tagName);if(c.style)for(d in a.style||
(a.style={}),c.style)a.style[d]||(a.style[d]=c.style[d]);if(c.attributes)for(d in a.attributes||(a.attributes={}),c.attributes)a.attributes[d]||(a.attributes[d]=c.attributes[d])}return a},_mergeStyleRanges:function(a,c){a||(a=[]);for(var d,e=g(a,c.start);e<a.length&&c;e++){var b=a[e];if(c.end<=b.start)break;if(!(c.start>=b.end)){d=this._mergeStyle({},b.style);d=this._mergeStyle(d,c.style);var f=[];f.push(e,1);c.start<b.start&&f.push({start:c.start,end:b.start,style:c.style});c.start>b.start&&f.push({start:b.start,
end:c.start,style:b.style});f.push({start:Math.max(b.start,c.start),end:Math.min(b.end,c.end),style:d});c.end<b.end&&f.push({start:c.end,end:b.end,style:b.style});c=c.end>b.end?{start:b.end,end:c.end,style:c.style}:null;Array.prototype.splice.apply(a,f)}}c&&(d=this._mergeStyle({},c.style),a.splice(e,0,{start:c.start,end:c.end,style:d}));return a},_onAnnotationModelChanged:function(a){function c(a,c){f.getBaseModel&&(a=f.mapOffset(a,!0),c=f.mapOffset(c,!0));-1!==a&&-1!==c&&e.redrawRange(a,c)}function d(a,
d){for(var e=0;e<a.length;e++)if(b.isAnnotationTypeVisible(a[e].type)){var f=a[e];c(f.start,f.end);d&&(void 0!==f._oldStart&&f._oldEnd)&&c(f._oldStart,f._oldEnd)}}var e=this._view;if(e){var b=this,f=e.getModel();d(a.added);d(a.removed);d(a.changed,!0)}},_onDestroy:function(a){this.destroy()},_onLineStyle:function(a){var c=this._annotationModel,d=a.textView.getModel(),e=c.getTextModel(),b=a.lineStart,f=a.lineStart+a.lineText.length;e!==d&&(b=d.mapOffset(b),f=d.mapOffset(f));for(c=c.getAnnotations(b,
f);c.hasNext();)if(b=c.next(),this.isAnnotationTypeVisible(b.type)){if(b.rangeStyle){var f=b.start,g=b.end;e!==d&&(f=d.mapOffset(f,!0),g=d.mapOffset(g,!0));a.ranges=this._mergeStyleRanges(a.ranges,{start:f,end:g,style:b.rangeStyle})}b.lineStyle&&(a.style=this._mergeStyle({},a.style),a.style=this._mergeStyle(a.style,b.lineStyle))}}};f.addMixin(h.prototype);return{FoldingAnnotation:k,AnnotationType:q,AnnotationTypeList:f,AnnotationModel:m,AnnotationStyler:h}});
define("orion/editor/tooltip","i18n!orion/editor/nls/messages orion/editor/textView orion/editor/textModel orion/editor/projectionTextModel orion/editor/util orion/util".split(" "),function(n,r,q,k,b,f){function g(b){this._view=b;this._fadeDelay=500;this._hideDelay=200;this._showDelay=500;this._autoHideDelay=5E3;this._create(b.getOptions("parent").ownerDocument)}g.getTooltip=function(b){b._tooltip||(b._tooltip=new g(b));return b._tooltip};g.prototype={_create:function(g){if(!this._tooltipDiv){var h=
this._tooltipDiv=f.createElement(g,"div");h.tabIndex=0;h.className="textviewTooltip";h.setAttribute("aria-live","assertive");h.setAttribute("aria-atomic","true");var e=this._tooltipContents=f.createElement(g,"div");h.appendChild(e);g.body.appendChild(h);var a=this;b.addEventListener(h,"mouseover",function(c){a._hideDelay&&(c=a._getWindow(),a._delayedHideTimeout&&(c.clearTimeout(a._delayedHideTimeout),a._delayedHideTimeout=null),a._hideTimeout&&(c.clearTimeout(a._hideTimeout),a._hideTimeout=null),
a._nextTarget=null)},!1);b.addEventListener(h,"mouseout",function(c){c=c.relatedTarget||c.toElement;!(c===h||a._hasFocus())&&(!c||!b.contains(h,c))&&a._hide()},!1);b.addEventListener(h,"keydown",function(c){27===c.keyCode&&a._hide()},!1);b.addEventListener(g,"mousedown",this._mouseDownHandler=function(c){a.isVisible()&&(b.contains(h,c.target||c.srcElement)||a._hide())},!0);this._view.addEventListener("Destroy",function(){a.destroy()});this._hide()}},_getWindow:function(){var b=this._tooltipDiv.ownerDocument;
return b.defaultView||b.parentWindow},destroy:function(){if(this._tooltipDiv){this._hide();var f=this._tooltipDiv.parentNode;f&&f.removeChild(this._tooltipDiv);b.removeEventListener(this._tooltipDiv.ownerDocument,"mousedown",this._mouseDownHandler,!0);this._tooltipDiv=null}},_hasFocus:function(){var f=this._tooltipDiv;return!f?!1:b.contains(f,f.ownerDocument.activeElement)},hide:function(b){void 0===b&&(b=this._hideDelay);var f=this._getWindow();this._delayedHideTimeout&&(f.clearTimeout(this._delayedHideTimeout),
this._delayedHideTimeout=null);var e=this;b?e._delayedHideTimeout=f.setTimeout(function(){e._delayedHideTimeout=null;e._hide();e.setTarget(e._nextTarget,0)},b):(e._hide(),e.setTarget(e._nextTarget,0))},_hide:function(){var b=this._tooltipDiv;b&&(this._hasFocus()&&this._view.focus(),this._contentsView&&(this._contentsView.destroy(),this._contentsView=null),this._tooltipContents&&(this._tooltipContents.innerHTML=""),b.style.visibility="hidden",b=this._getWindow(),this._showTimeout&&(b.clearTimeout(this._showTimeout),
this._showTimeout=null),this._delayedHideTimeout&&(b.clearTimeout(this._delayedHideTimeout),this._delayedHideTimeout=null),this._hideTimeout&&(b.clearTimeout(this._hideTimeout),this._hideTimeout=null),this._fadeTimeout&&(b.clearInterval(this._fadeTimeout),this._fadeTimeout=null))},isVisible:function(){return this._tooltipDiv&&"visible"===this._tooltipDiv.style.visibility},setTarget:function(b,f,e){if(this.isVisible())this._hasFocus()||(this._nextTarget=b,this.hide(e));else if(this._target=b){var a=
this;b=a._getWindow();a._showTimeout&&(b.clearTimeout(a._showTimeout),a._showTimeout=null);0===f?a.show(!0):a._showTimeout=b.setTimeout(function(){a._showTimeout=null;a.show(!0)},f?f:a._showDelay)}},show:function(b){if(this._target){var f=this._target.getTooltipInfo();if(f){var e=this._tooltipDiv,a=this._tooltipContents;e.style.left=e.style.right=e.style.width=e.style.height=a.style.width=a.style.height="auto";var c=f.contents;c instanceof Array&&(c=this._getAnnotationContents(c));if("string"===typeof c)a.innerHTML=
c;else if(this._isNode(c))a.appendChild(c);else if(c instanceof k.ProjectionTextModel){var d=this._view,g=d.getOptions();g.wrapMode=!1;g.parent=a;var p=g.themeClass;p?((p=p.replace("tooltipTheme",""))&&(p=" "+p),p="tooltipTheme"+p):p="tooltipTheme";g.themeClass=p;g=this._contentsView=new r.TextView(g);g.addEventListener("LineStyle",function(a){d.onLineStyle(a)});g.setModel(c);c=g.computeSize();a.style.width=c.width+"px";a.style.height=c.height+"px";g.resize()}else return;a=e.ownerDocument.documentElement;
"right"===f.anchor?(c=a.clientWidth-f.x,e.style.right=c+"px"):(c=parseInt(this._getNodeStyle(e,"padding-left","0"),10),c+=parseInt(this._getNodeStyle(e,"border-left-width","0"),10),c=f.x-c,e.style.left=c+"px");e.style.maxWidth=a.clientWidth-c-10+"px";c=parseInt(this._getNodeStyle(e,"padding-top","0"),10);c+=parseInt(this._getNodeStyle(e,"border-top-width","0"),10);c=f.y-c;e.style.top=c+"px";e.style.maxHeight=a.clientHeight-c-10+"px";e.style.opacity="1";e.style.visibility="visible";if(b){var u=this,
t=this._getWindow();u._hideTimeout=t.setTimeout(function(){u._hideTimeout=null;var a=parseFloat(u._getNodeStyle(e,"opacity","1"));u._fadeTimeout=t.setInterval(function(){"visible"===e.style.visibility&&0<a?(a-=0.1,e.style.opacity=a):u._hide()},u._fadeDelay/10)},u._autoHideDelay)}}}},_getAnnotationContents:function(g){function h(a,c){var d=v.getLineStart(v.getLineAtOffset(a)),e=v.getLineEnd(v.getLineAtOffset(c),!0);return v.getText(d,e)}function e(a){var c=a.title,d=f.createElement(p,"div");d.className=
"tooltipRow";a.html&&(d.innerHTML=a.html,d.lastChild&&b.addEventListener(d.lastChild,"click",function(c){c=a.start;var d=a.end;t.getBaseModel&&(c=t.mapOffset(c,!0),d=t.mapOffset(d,!0));u.setSelection(c,d,1/3,function(){s._hide()})},!1),d.appendChild(p.createTextNode("\u00a0")));c||(c=h(a.start,a.end));"function"===typeof c&&(c=a.title());if("string"===typeof c){var e=f.createElement(p,"span");e.appendChild(p.createTextNode(c));c=e}d.appendChild(c);return d}for(var a,c=[],d=0;d<g.length;d++)a=g[d],
""!==a.title&&!a.groupAnnotation&&c.push(a);g=c;if(0===g.length)return null;var s=this,p=this._tooltipDiv.ownerDocument,u=this._view,t=u.getModel(),v=t.getBaseModel?t.getBaseModel():t;if(1===g.length){a=g[0];if(void 0!==a.title)return a=e(a),a.firstChild&&((g=a.firstChild.className)&&(g+=" "),a.firstChild.className=g+"single"),a;g=new k.ProjectionTextModel(v);c=v.getLineStart(v.getLineAtOffset(a.start));d=v.getCharCount();a.end!==d&&g.addProjection({start:a.end,end:d});0<c&&g.addProjection({start:0,
end:c});return g}c=f.createElement(p,"div");a=f.createElement(p,"em");a.appendChild(p.createTextNode(n.multipleAnnotations));c.appendChild(a);for(d=0;d<g.length;d++)a=g[d],(a=e(a))&&c.appendChild(a);return c},_getNodeStyle:function(b,f,e){var a;if(b&&(a=b.style[f],!a))if(b.currentStyle){for(a=0;-1!==(a=f.indexOf("-",a));)f=f.substring(0,a)+f.substring(a+1,a+2).toUpperCase()+f.substring(a+2);a=b.currentStyle[f]}else a=(b=b.ownerDocument.defaultView.getComputedStyle(b,null))?b.getPropertyValue(f):null;
return a||e},_isNode:function(b){return"object"===typeof Node?b instanceof Node:b&&"object"===typeof b&&"number"===typeof b.nodeType&&"string"===typeof b.nodeName}};return{Tooltip:g}});
define("orion/editor/rulers",["i18n!orion/editor/nls/messages","orion/editor/annotations","orion/editor/tooltip","orion/util"],function(n,r,q,k){function b(e,a,c,d){this._location=a||"left";this._overview=c||"page";this._rulerStyle=d;this._view=null;var b=this;this._listener={onTextModelChanged:function(a){b._onTextModelChanged(a)},onAnnotationModelChanged:function(a){b._onAnnotationModelChanged(a)}};this.setAnnotationModel(e)}function f(e,a,c,d,f){b.call(this,e,a,"page",c);this._oddStyle=d||{style:{backgroundColor:"white"}};
this._evenStyle=f||{style:{backgroundColor:"white"}};this._numOfDigits=0;this._firstLine=1}function g(e,a,c){b.call(this,e,a,"page",c)}function m(e,a,c){b.call(this,e,a,"document",c)}function h(e,a,c){g.call(this,e,a,c)}b.prototype={getAnnotations:function(e,a){var c=this._annotationModel;if(!c)return[];var d=this._view.getModel(),b=d.getLineStart(e),p=d.getLineEnd(a-1),f=d;d.getBaseModel&&(f=d.getBaseModel(),b=d.mapOffset(b),p=d.mapOffset(p));for(var g=[],c=this.getAnnotationsByType(c,b,p),b=0;b<
c.length;b++)for(var p=c[b],h=f.getLineAtOffset(p.start),m=f.getLineAtOffset(Math.max(p.start,p.end-1)),k=h;k<=m;k++){var w=k;if(d!==f){w=f.getLineStart(k);w=d.mapOffset(w,!0);if(-1===w)continue;w=d.getLineAtOffset(w)}if(e<=w&&w<a){var n=this._mergeAnnotation(g[w],p,k-h,m-h+1);n&&(g[w]=n)}}if(!this._multiAnnotation&&this._multiAnnotationOverlay)for(var l in g)g[l]._multiple&&(g[l].html+=this._multiAnnotationOverlay.html);return g},getAnnotationModel:function(){return this._annotationModel},getLocation:function(){return this._location},
getOverview:function(){return this._overview},getRulerStyle:function(){return this._rulerStyle},getView:function(){return this._view},getWidestAnnotation:function(){return null},setAnnotationModel:function(e){this._annotationModel&&this._annotationModel.removEventListener("Changed",this._listener.onAnnotationModelChanged);(this._annotationModel=e)&&this._annotationModel.addEventListener("Changed",this._listener.onAnnotationModelChanged)},setMultiAnnotation:function(e){this._multiAnnotation=e},setMultiAnnotationOverlay:function(e){this._multiAnnotationOverlay=
e},setView:function(e){this._onTextModelChanged&&this._view&&this._view.removeEventListener("ModelChanged",this._listener.onTextModelChanged);this._view=e;this._onTextModelChanged&&this._view&&this._view.addEventListener("ModelChanged",this._listener.onTextModelChanged)},onClick:function(e,a){if(void 0!==e){var c=this._view,d=c.getModel(),b=d,f=d.getLineStart(e),g=f,h=f,m=this._annotationModel;if(m){c=c.getSelection();h=d.getLineEnd(e,!0);f<=c.start&&c.start<h&&(f=c.start);d.getBaseModel&&(f=d.mapOffset(f),
h=d.mapOffset(h),b=d.getBaseModel());for(var k,h=m.getAnnotations(f,h),m=null;!k&&h.hasNext();)c=h.next(),this.isAnnotationTypeVisible(c.type)&&(m=c,c.start<=f||(k=c));m&&void 0!==m.groupId&&(this._currentClickGroup=this._currentClickGroup===m.groupId?null:m.groupId,this._setCurrentGroup(e));k&&b.getLineAtOffset(k.start)===b.getLineAtOffset(f)?(f=k.start,h=k.end):h=f=g;d.getBaseModel&&(f=d.mapOffset(f,!0),h=d.mapOffset(h,!0))}(d=q.Tooltip.getTooltip(this._view))&&d.setTarget(null);this._view.setSelection(h,
f,1/3,function(){})}},onDblClick:function(e,a){},onMouseMove:function(e,a){var c=q.Tooltip.getTooltip(this._view);if(c&&!(c.isVisible()&&this._tooltipLineIndex===e)){this._tooltipLineIndex=e;var d=this;c.setTarget({y:a.clientY,getTooltipInfo:function(){return d._getTooltipInfo(d._tooltipLineIndex,this.y)}})}},onMouseOver:function(e,a){this.onMouseMove(e,a);this._currentClickGroup||this._setCurrentGroup(e)},onMouseOut:function(e,a){this._currentClickGroup||this._setCurrentGroup(-1);var c=q.Tooltip.getTooltip(this._view);
c&&c.setTarget(null)},_getTooltipInfo:function(e,a){if(void 0!==e){var c=this._view,d=c.getModel(),b=this._annotationModel,f=[];if(b){var f=d.getLineStart(e),g=d.getLineEnd(e);d.getBaseModel&&(f=d.mapOffset(f),g=d.mapOffset(g));f=this.getAnnotationsByType(b,f,g)}b=this._getTooltipContents(e,f);if(!b)return null;b={contents:b,anchor:this.getLocation()};f=c.getClientArea();"document"===this.getOverview()?f.y=c.convert({y:a},"view","document").y:f.y=c.getLocationAtOffset(d.getLineStart(e)).y;c.convert(f,
"document","page");b.x=f.x;b.y=f.y;"right"===b.anchor&&(b.x+=f.width);return b}},_getTooltipContents:function(e,a){return a},_onAnnotationModelChanged:function(e){function a(a){for(var e=0;e<a.length;e++)if(b.isAnnotationTypeVisible(a[e].type)){var f=a[e].start,g=a[e].end;d.getBaseModel&&(f=d.mapOffset(f,!0),g=d.mapOffset(g,!0));-1!==f&&-1!==g&&c.redrawLines(d.getLineAtOffset(f),d.getLineAtOffset(Math.max(f,g-1))+1,b)}}var c=this._view;if(c){var d=c.getModel(),b=this,f=d.getLineCount();e.textModelChangedEvent?
(e=e.textModelChangedEvent.start,d.getBaseModel&&(e=d.mapOffset(e,!0)),e=d.getLineAtOffset(e),c.redrawLines(e,f,b)):(a(e.added),a(e.removed),a(e.changed))}},_mergeAnnotation:function(e,a,c,d){e||(e={});0===c&&(e.html&&a.html?(a.html!==e.html&&(!e._multiple&&this._multiAnnotation)&&(e.html=this._multiAnnotation.html),e._multiple=!0):e.html=a.html);e.style=this._mergeStyle(e.style,a.style);return e},_mergeStyle:function(e,a){if(a){e||(e={});e.styleClass=e.styleClass&&a.styleClass&&e.styleClass!==a.styleClass?
e.styleClass+(" "+a.styleClass):a.styleClass;var c;if(a.style)for(c in e.style||(e.style={}),a.style)void 0===e.style[c]&&(e.style[c]=a.style[c]);if(a.attributes)for(c in e.attributes||(e.attributes={}),a.attributes)void 0===e.attributes[c]&&(e.attributes[c]=a.attributes[c])}return e},_setCurrentGroup:function(e){var a=this._annotationModel,c=null,d=a.getTextModel(),b,f=this._currentGroupAnnotation;if(-1!==e){var g=d.getLineStart(e),h=d.getLineEnd(e);d.getBaseModel&&(g=d.mapOffset(g),h=d.mapOffset(h));
for(b=a.getAnnotations(g,h);b.hasNext();)if(d=b.next(),this.isAnnotationTypeVisible(d.type)&&d.start<=g&&d.end>=h&&void 0!==d.groupId){c=d;break}if(f&&c&&f.groupId===c.groupId)return}this._currentGroupAnnotation=null;f&&a.removeAnnotations(f.groupType);if(c&&-1!==e){this._currentGroupAnnotation=c;b=a.getAnnotations();for(e=[];b.hasNext();)d=b.next(),delete d.groupAnnotation,d.groupId===c.groupId&&(d=d.createGroupAnnotation(),e.push(d));a.replaceAnnotations(null,e)}}};r.AnnotationTypeList.addMixin(b.prototype);
f.prototype=new b;f.prototype.getAnnotations=function(e,a){for(var c=b.prototype.getAnnotations.call(this,e,a),d=this._view.getModel(),f=e;f<a;f++){var g=f&1?this._oddStyle:this._evenStyle,h=f;d.getBaseModel&&(h=d.getLineStart(h),h=d.getBaseModel().getLineAtOffset(d.mapOffset(h)));c[f]||(c[f]={});c[f].html=this._firstLine+h+"";c[f].style||(c[f].style=g)}return c};f.prototype.getWidestAnnotation=function(){var e=this._view.getModel().getLineCount();return this.getAnnotations(e-1,e)[e-1]};f.prototype.setFirstLine=
function(e){this._firstLine=void 0!==e?e:1};f.prototype._onTextModelChanged=function(e){var a=e.start;e=this._view.getModel();var c=e.getBaseModel?e.getBaseModel().getLineCount():e.getLineCount(),c=(this._firstLine+c-1+"").length;this._numOfDigits!==c&&(this._numOfDigits=c,a=e.getLineAtOffset(a),this._view.redrawLines(a,e.getLineCount(),this))};g.prototype=new b;m.prototype=new b;m.prototype.getRulerStyle=function(){var e={style:{lineHeight:"1px",fontSize:"1px"}};return e=this._mergeStyle(e,this._rulerStyle)};
m.prototype._getTooltipContents=function(e,a){if(0===a.length){var c=this._view.getModel(),d=e;c.getBaseModel&&(d=c.getLineStart(d),d=c.getBaseModel().getLineAtOffset(c.mapOffset(d)));return k.formatMessage(n.line,d+1)}return b.prototype._getTooltipContents.call(this,e,a)};m.prototype._mergeAnnotation=function(e,a,c,d){if(0===c)return e||(e={html:"\x26nbsp;",style:{style:{height:3*d+"px"}}},e.style=this._mergeStyle(e.style,a.overviewStyle)),e};h.prototype=new g;h.prototype.onClick=function(e,a){if(void 0!==
e){var c=this._annotationModel;if(c){var d=this._view.getModel(),b=d.getLineStart(e),f=d.getLineEnd(e,!0);d.getBaseModel&&(b=d.mapOffset(b),f=d.mapOffset(f),d=d.getBaseModel());for(var g,c=c.getAnnotations(b,f);!g&&c.hasNext();)f=c.next(),this.isAnnotationTypeVisible(f.type)&&d.getLineAtOffset(f.start)===d.getLineAtOffset(b)&&(g=f);g&&((d=q.Tooltip.getTooltip(this._view))&&d.setTarget(null),g.expanded?g.collapse():g.expand())}}};h.prototype._getTooltipContents=function(e,a){if(0<a.length){var c=this._view.getModel(),
d=c.getLineStart(e);c.getBaseModel&&(d=c.mapOffset(d),c=c.getBaseModel());for(var d=c.getLineAtOffset(d),b=0;b<a.length;b++){var f=a[b];if(this.isAnnotationTypeVisible(f.type)&&c.getLineAtOffset(f.start)===d){if(a[b].expanded)break;return g.prototype._getTooltipContents.call(this,e,[f])}}}return null};h.prototype._onAnnotationModelChanged=function(e){function a(a){for(f=0;f<a.length;f++)if(b.isAnnotationTypeVisible(a[f].type)){var c=a[f].start;d.getBaseModel&&(c=d.mapOffset(c,!0));-1!==c&&(m=Math.min(m,
d.getLineAtOffset(c)))}}if(e.textModelChangedEvent)g.prototype._onAnnotationModelChanged.call(this,e);else{var c=this._view;if(c){var d=c.getModel(),b=this,f,h=d.getLineCount(),m=h;a(e.added);a(e.removed);a(e.changed);e=c.getRulers();for(f=0;f<e.length;f++)c.redrawLines(m,h,e[f])}}};return{Ruler:b,AnnotationRuler:g,LineNumberRuler:f,OverviewRuler:m,FoldingRuler:h}});
define("orion/editor/undoStack",[],function(){function n(k,b,f,g,m){this.model=k;this.offset=b;this.text=f;this.previousText=g;this.type=m}function r(k){this.owner=k;this.changes=[]}function q(k,b){this.size=void 0!==b?b:100;this.reset();var f=this;this._listener={onChanging:function(b){f._onChanging(b)},onDestroy:function(b){f._onDestroy(b)}};if(k.getModel){var g=k.getModel();g.getBaseModel&&(g=g.getBaseModel());this.model=g;this.setView(k)}else this.shared=!0,this.model=k;this.model.addEventListener("Changing",
this._listener.onChanging)}n.prototype={getRedoChanges:function(){return[{start:this.offset,end:this.offset+this.previousText.length,text:this.text}]},getUndoChanges:function(){return[{start:this.offset,end:this.offset+this.text.length,text:this.previousText}]},undo:function(k,b){this._doUndoRedo(this.offset,this.previousText,this.text,k,b);return!0},redo:function(k,b){this._doUndoRedo(this.offset,this.text,this.previousText,k,b);return!0},merge:function(k,b,f,g,m){if(g===this.type){if(1===g&&k===
this.offset+this.text.length)return this.text+=b,!0;if(-1===g&&m===this.offset)return this.offset=k,this.previousText=f+this.previousText,!0;if(-1===g&&k===this.offset)return this.previousText+=f,!0}return!1},_doUndoRedo:function(k,b,f,g,m){this.model.setText(b,k,k+f.length);m&&g&&(f=g.getModel(),f!==this.model&&(k=f.mapOffset(k,!0)),g.setSelection(k,k+b.length))}};r.prototype={getRedoChanges:function(){for(var k=[],b=0;b<this.changes.length;b++)k=k.concat(this.changes[b].getRedoChanges());return k},
getUndoChanges:function(){for(var k=[],b=this.changes.length-1;0<=b;b--)k=k.concat(this.changes[b].getUndoChanges());return k},add:function(k){this.changes.push(k)},end:function(k){k&&(this.endSelection=k.getSelection(),this.endCaret=k.getCaretOffset());(k=this.owner)&&k.end&&k.end()},undo:function(k,b){1<this.changes.length&&k&&k.setRedraw(!1);for(var f=this.changes.length-1;0<=f;f--)this.changes[f].undo(k,!1);1<this.changes.length&&k&&k.setRedraw(!0);if(b&&k){var f=this.startSelection.start,g=this.startSelection.end;
k.setSelection(this.startCaret?f:g,this.startCaret?g:f)}(f=this.owner)&&f.undo&&f.undo();return 0<this.changes.length},redo:function(k,b){1<this.changes.length&&k&&k.setRedraw(!1);for(var f=0;f<this.changes.length;f++)this.changes[f].redo(k,!1);(1<this.changes.length,k)&&k.setRedraw(!0);if(b&&k){var f=this.endSelection.start,g=this.endSelection.end;k.setSelection(this.endCaret?f:g,this.endCaret?g:f)}(f=this.owner)&&f.redo&&f.redo();return 0<this.changes.length},merge:function(k,b,f,g,m){var h=this.changes.length;
return 0<h?this.changes[h-1].merge(k,b,f,g,m):!1},start:function(k){k&&(this.startSelection=k.getSelection(),this.startCaret=k.getCaretOffset());(k=this.owner)&&k.start&&k.start()}};q.prototype={destroy:function(){this._onDestroy()},add:function(k){this.compoundChange?this.compoundChange.add(k):(this.stack.splice(this.index,this.stack.length-this.index,k),this.index++,this.stack.length>this.size&&(this.stack.shift(),this.index--))},markClean:function(){this._commitUndo();if(this.cleanChange=this.stack[this.index-
1])this.cleanChange.type=2},isClean:function(){return this.cleanChange===this.stack[this.index-1]},canUndo:function(){return 0<this.index},canRedo:function(){return 0<this.stack.length-this.index},endCompoundChange:function(){this.compoundChange&&this.compoundChange.end(this.view);this.compoundChange=void 0},getSize:function(){return{undo:this.index,redo:this.stack.length-this.index}},getRedoChanges:function(){this._commitUndo();for(var k=[],b=this.index;b<this.stack.length;b++)k=k.concat(this.stack[b].getRedoChanges());
return k},getUndoChanges:function(){this._commitUndo();for(var k=[],b=this.index;0<=b;b--)k=k.concat(this.stack[b].getUndoChanges());return k},undo:function(){this._commitUndo();var k;k=!1;this._ignoreUndo=!0;do{if(0>=this.index)break;k=this.stack[--this.index]}while(!(k=k.undo(this.view,!0)));this._ignoreUndo=!1;return k},redo:function(){this._commitUndo();var k;this._ignoreUndo=!0;do{if(this.index>=this.stack.length)break;k=this.stack[this.index++]}while(!k.redo(this.view,!0));this._ignoreUndo=
!1;return!0},reset:function(){this.index=0;this.cleanChange=void 0;this.stack=[];this._ignoreUndo=!1;this._compoundChange=void 0},setView:function(k){this.view!==k&&(this.view&&k.removeEventListener("Destroy",this._listener.onDestroy),(this.view=k)&&k.addEventListener("Destroy",this._listener.onDestroy))},startCompoundChange:function(k){this._commitUndo();k=new r(k);this.add(k);this.compoundChange=k;this.compoundChange.start(this.view);return this.compoundChange},_commitUndo:function(){this.endCompoundChange()},
_onDestroy:function(k){(!k||!this.shared)&&this.model.removeEventListener("Changing",this._listener.onChanging);this.view&&(this.view.removeEventListener("Destroy",this._listener.onDestroy),this.view=null)},_onChanging:function(k){if(!this._ignoreUndo){var b=k.text,f=k.start,g=k.addedCharCount,m=k.removedCharCount;k=f+m;var h=0;0===g&&1===m?h=-1:1===g&&0===m&&(h=1);g=this.stack.length;m=this.model.getText(f,k);(!(0<g&&this.index===g)||!this.stack[g-1].merge(f,b,m,h,k))&&this.add(new n(this.model,
f,b,m,h))}}};return{UndoStack:q}});
define("orion/editor/textDND",["orion/util"],function(n){function r(n,k){this._view=n;this._undoStack=k;this._dragSelection=null;this._dropOffset=-1;this._dropText=null;var b=this;this._listener={onDragStart:function(f){b._onDragStart(f)},onDragEnd:function(f){b._onDragEnd(f)},onDragEnter:function(f){b._onDragEnter(f)},onDragOver:function(f){b._onDragOver(f)},onDrop:function(f){b._onDrop(f)},onDestroy:function(f){b._onDestroy(f)}};n.addEventListener("DragStart",this._listener.onDragStart);n.addEventListener("DragEnd",
this._listener.onDragEnd);n.addEventListener("DragEnter",this._listener.onDragEnter);n.addEventListener("DragOver",this._listener.onDragOver);n.addEventListener("Drop",this._listener.onDrop);n.addEventListener("Destroy",this._listener.onDestroy)}r.prototype={destroy:function(){var n=this._view;n&&(n.removeEventListener("DragStart",this._listener.onDragStart),n.removeEventListener("DragEnd",this._listener.onDragEnd),n.removeEventListener("DragEnter",this._listener.onDragEnter),n.removeEventListener("DragOver",
this._listener.onDragOver),n.removeEventListener("Drop",this._listener.onDrop),n.removeEventListener("Destroy",this._listener.onDestroy),this._view=null)},_onDestroy:function(n){this.destroy()},_onDragStart:function(n){var k=this._view,b=k.getSelection(),k=k.getModel();k.getBaseModel&&(b.start=k.mapOffset(b.start),b.end=k.mapOffset(b.end),k=k.getBaseModel());if(k=k.getText(b.start,b.end))this._dragSelection=b,n.event.dataTransfer.effectAllowed="copyMove",n.event.dataTransfer.setData("Text",k)},_onDragEnd:function(q){if(this._dragSelection){var k=
this._view,b=q.event.dataTransfer.dropEffect;if(!n.isFirefox&&("none"!==b||this._dropText))b=q.event.dataTransfer.dropEffect=this._dropEffect;this._undoStack&&this._undoStack.startCompoundChange();(q="move"===b)&&k.setText("",this._dragSelection.start,this._dragSelection.end);if(this._dropText){var b=this._dropText,f=this._dropOffset;q&&(f>=this._dragSelection.end?f-=this._dragSelection.end-this._dragSelection.start:f>=this._dragSelection.start&&(f=this._dragSelection.start));k.setText(b,f,f);k.setSelection(f,
f+b.length);this._dropText=null;this._dropOffset=-1}this._undoStack&&this._undoStack.endCompoundChange()}this._dragSelection=null},_onDragEnter:function(n){this._onDragOver(n)},_onDragOver:function(q){var k=q.event.dataTransfer.types,b=!this._view.getOptions("readonly");b&&k&&(b=k.contains?k.contains("text/plain")||k.contains("Text"):-1!==k.indexOf("text/plain")||-1!==k.indexOf("Text"));b?n.isFirefox||(this._dropEffect=q.event.dataTransfer.dropEffect=(n.isMac?q.event.altKey:q.event.ctrlKey)?"copy":
"move"):q.event.dataTransfer.dropEffect="none"},_onDrop:function(q){var k=this._view,b=q.event.dataTransfer.getData("Text");b&&(n.isFirefox||(q.event.dataTransfer.dropEffect=this._dropEffect),q=k.getOffsetAtLocation(q.x,q.y),this._dragSelection?(this._dropOffset=q,this._dropText=b):(k.setText(b,q,q),k.setSelection(q,q+b.length)))}};return{TextDND:r}});
define("orion/objects",[],function(){function n(n){for(var q=1;q<arguments.length;q++){var k=arguments[q],b;for(b in k)Object.prototype.hasOwnProperty.call(k,b)&&(n[b]=k[b])}return n}return{clone:function(r){if(Array.isArray(r))return Array.prototype.slice.call(r);var q=Object.create(Object.getPrototypeOf(r));n(q,r);return q},mixin:n,toArray:function(n){return Array.isArray(n)?n:[n]}}});
define("orion/editor/editor","i18n!orion/editor/nls/messages orion/editor/eventTarget orion/editor/tooltip orion/editor/annotations orion/objects orion/util".split(" "),function(n,r,q,k,b,f){function g(e){e=e||{};this._domNode=e.domNode;this._model=e.model;this._undoStack=e.undoStack;this._statusReporter=e.statusReporter;this._title=null;var a=this;this._listener={onChanged:function(c){a.onChanged(c)}};this._model&&this._model.addEventListener("Changed",this._listener.onChanged);this.checkDirty()}
function m(e){e=e||{};g.call(this,e);this._textViewFactory=e.textViewFactory;this._undoStackFactory=e.undoStackFactory;this._textDNDFactory=e.textDNDFactory;this._annotationFactory=e.annotationFactory;this._foldingRulerFactory=e.foldingRulerFactory;this._lineNumberRulerFactory=e.lineNumberRulerFactory;this._contentAssistFactory=e.contentAssistFactory;this._keyBindingFactory=e.keyBindingFactory;this._contentAssist=this._foldingRuler=this._overviewRuler=this._lineNumberRuler=this._annotationRuler=this._annotationModel=
this._annotationStyler=null}var h=k.AnnotationType;g.prototype={destroy:function(){this.uninstall();this._statusReporter=this._domNode=null;this._model&&this._model.removeEventListener("Changed",this._listener.onChanged)},checkDirty:function(){this.setDirty(this._undoStack&&!this._undoStack.isClean())},focus:function(){},getModel:function(){return this._model},getText:function(e,a){return this.getModel().getText(e,a)},getTitle:function(){return this._title},getUndoStack:function(){return this._undoStack},
install:function(){this.installed=!0},isDirty:function(){return this._dirty},markClean:function(){this.getUndoStack().markClean();this.setDirty(!1)},onDirtyChanged:function(e){return this.dispatchEvent(e)},onInputChanged:function(e){return this.dispatchEvent(e)},onChanged:function(e){this.checkDirty()},reportStatus:function(e,a,c){this._statusReporter&&this._statusReporter(e,a,c)},resize:function(){},setDirty:function(e){this._dirty!==e&&(this._dirty=e,this.onDirtyChanged({type:"DirtyChanged"}))},
_setModelText:function(e){this._model&&this._model.setText(e)},setInput:function(e,a,c,d){this._title=e;d||(a?this.reportStatus(a,"error"):null!==c&&(void 0!==c&&"string"===typeof c)&&this._setModelText(c),this._undoStack&&this._undoStack.reset());this.checkDirty();this.onInputChanged({type:"InputChanged",title:e,message:a,contents:c,contentsSaved:d})},setText:function(e,a,c){this.getModel().setText(e,a,c)},uninstall:function(){this.installed=!1}};r.EventTarget.addMixin(g.prototype);m.prototype=new g;
b.mixin(m.prototype,{destroy:function(){g.prototype.destroy.call(this);this._textViewFactory=this._undoStackFactory=this._textDNDFactory=this._annotationFactory=this._foldingRulerFactory=this._lineNumberRulerFactory=this._contentAssistFactory=this._keyBindingFactory=null},getAnnotationModel:function(){return this._annotationModel},getAnnotationRuler:function(){return this._annotationRuler},getAnnotationStyler:function(){return this._annotationStyler},getContentAssist:function(){return this._contentAssist},
getFoldingRuler:function(){return this._foldingRuler},getLineNumberRuler:function(){return this._lineNumberRuler},getModel:function(){if(!this._textView)return null;var e=this._textView.getModel();e.getBaseModel&&(e=e.getBaseModel());return e},getOverviewRuler:function(){return this._overviewRuler},getTextView:function(){return this._textView},getKeyModes:function(){return this._textView.getKeyModes()},getSourceCodeActions:function(){return this._sourceCodeActions},getLinkedMode:function(){return this._linkedMode},
getTextActions:function(){return this._textActions},focus:function(){this._textView&&this._textView.focus()},resize:function(){this._textView&&this._textView.resize()},setAnnotationRulerVisible:function(e,a){if(this._annotationRulerVisible!==e||a)if(this._annotationRulerVisible=e,this._annotationRuler){var c=this._textView;e?c.addRuler(this._annotationRuler,0):c.removeRuler(this._annotationRuler)}},setFoldingRulerVisible:function(e,a){if(this._foldingRulerVisible!==e||a)if(this._foldingRulerVisible=
e,this._foldingRuler){var c=this._textView;c.getModel().getBaseModel&&(e?c.addRuler(this._foldingRuler):c.removeRuler(this._foldingRuler))}},setLineNumberRulerVisible:function(e,a){if(this._lineNumberRulerVisible!==e||a)if(this._lineNumberRulerVisible=e,this._lineNumberRuler){var c=this._textView;e?c.addRuler(this._lineNumberRuler,!this._annotationRulerVisible?0:1):c.removeRuler(this._lineNumberRuler)}},setOverviewRulerVisible:function(e,a){if(this._overviewRulerVisible!==e||a)if(this._overviewRulerVisible=
e,this._overviewRuler){var c=this._textView;e?c.addRuler(this._overviewRuler):c.removeRuler(this._overviewRuler)}},mapOffset:function(e,a){var c=this._textView.getModel();c.getBaseModel&&(e=c.mapOffset(e,a));return e},getLineAtOffset:function(e){return this.getModel().getLineAtOffset(this.mapOffset(e))},getLineStart:function(e){return this.getModel().getLineStart(e)},getCaretOffset:function(){return this.mapOffset(this._textView.getCaretOffset())},getSelection:function(){var e=this._textView,a=e.getSelection(),
e=e.getModel();e.getBaseModel&&(a.start=e.mapOffset(a.start),a.end=e.mapOffset(a.end));return a},_expandOffset:function(e){var a=this._textView.getModel(),c=this._annotationModel;if(c&&a.getBaseModel)for(e=c.getAnnotations(e,e+1);e.hasNext();)a=e.next(),a.type===h.ANNOTATION_FOLDING&&a.expand&&a.expand()},setCaretOffset:function(e,a,c){var d=this._textView,b=d.getModel();b.getBaseModel&&(this._expandOffset(e),e=b.mapOffset(e,!0));d.setCaretOffset(e,a,c)},setText:function(e,a,c){var d=this._textView,
b=d.getModel();b.getBaseModel&&(void 0!==a&&(this._expandOffset(a),a=b.mapOffset(a,!0)),void 0!==c&&(this._expandOffset(c),c=b.mapOffset(c,!0)));d.setText(e,a,c)},setSelection:function(e,a,c,d){var b=this._textView,f=b.getModel();f.getBaseModel&&(this._expandOffset(e),this._expandOffset(a),e=f.mapOffset(e,!0),a=f.mapOffset(a,!0));b.setSelection(e,a,c,d)},moveSelection:function(e,a,c,d){var b=this._textView;this.setSelection(e,a||e,1/3,function(){(void 0===d||d)&&b.focus();c&&c()})},_getTooltipInfo:function(e,
a){var c=this._textView,d=this.getAnnotationModel();if(!d)return null;var b=this._annotationStyler;if(!b)return null;var f=c.getOffsetAtLocation(e,a);if(-1===f)return null;f=this.mapOffset(f);b=b.getAnnotationsByType(d,f,f+1);d=[];for(f=0;f<b.length;f++)b[f].rangeStyle&&d.push(b[f]);if(0===d.length)return null;c=c.convert({x:e,y:a},"document","page");return{contents:d,anchor:"left",x:c.x+10,y:c.y+20}},_highlightCurrentLine:function(e,a){var c=this._annotationModel;if(c){var d=this._textView;if(!d.getOptions("singleMode")){var b=
d.getModel(),f=a?b.getLineAtOffset(a.start):-1,g=b.getLineAtOffset(e.start),d=e.start===e.end,m=!a||a.start===a.end,k=b.getLineStart(g),n=b.getLineEnd(g);b.getBaseModel&&(k=b.mapOffset(k),n=b.mapOffset(n));b=this._currentLineAnnotation;if(!(f===g&&m&&d&&b&&b.start===k&&b.end===n)){var f=b?[b]:null,q;d&&(b=h.createAnnotation(h.ANNOTATION_CURRENT_LINE,k,n),q=[b]);this._currentLineAnnotation=b;c.replaceAnnotations(f,q)}}}},installTextView:function(){this.install()},install:function(){if(!this._textView){this._textView=
this._textViewFactory();this._undoStackFactory&&(this._undoStack=this._undoStackFactory.createUndoStack(this),this.checkDirty());this._textDNDFactory&&(this._textDND=this._textDNDFactory.createTextDND(this,this._undoStack));this._contentAssistFactory&&(this._contentAssist=this._contentAssistFactory.createContentAssistMode(this).getContentAssist());var e=this,a=this._textView,c=this;this._listener={onModelChanged:function(a){c.checkDirty()},onMouseOver:function(a){c._listener.onMouseMove(a)},onMouseMove:function(d){var e=
q.Tooltip.getTooltip(a);e&&!(c._listener.lastMouseX===d.event.clientX&&c._listener.lastMouseY===d.event.clientY)&&(c._listener.lastMouseX=d.event.clientX,c._listener.lastMouseY=d.event.clientY,e.setTarget({x:d.x,y:d.y,getTooltipInfo:function(){return c._getTooltipInfo(this.x,this.y)}}))},onMouseOut:function(d){var e=q.Tooltip.getTooltip(a);e&&!(c._listener.lastMouseX===d.event.clientX&&c._listener.lastMouseY===d.event.clientY)&&(c._listener.lastMouseX=d.event.clientX,c._listener.lastMouseY=d.event.clientY,
e.setTarget(null))},onScroll:function(c){(c=q.Tooltip.getTooltip(a))&&c.setTarget(null,0,0)},onSelection:function(a){c._updateCursorStatus();c._highlightCurrentLine(a.newValue,a.oldValue)}};a.addEventListener("ModelChanged",this._listener.onModelChanged);a.addEventListener("Selection",this._listener.onSelection);a.addEventListener("MouseOver",this._listener.onMouseOver);a.addEventListener("MouseOut",this._listener.onMouseOut);a.addEventListener("MouseMove",this._listener.onMouseMove);a.addEventListener("Scroll",
this._listener.onScroll);if(this._keyBindingFactory){var d;if(d="function"===typeof this._keyBindingFactory?this._keyBindingFactory(this,this.getKeyModes(),this._undoStack,this._contentAssist):this._keyBindingFactory.createKeyBindings(e,this._undoStack,this._contentAssist))this._textActions=d.textActions,this._linkedMode=d.linkedMode,this._sourceCodeActions=d.sourceCodeActions}d=function(a,c){if(void 0!==a&&-1!==a){for(var d=this.getView().getModel(),b=this.getAnnotationModel(),f=e.mapOffset(d.getLineStart(a)),
d=e.mapOffset(d.getLineEnd(a)),g=b.getAnnotations(f,d),p=null;g.hasNext();){var l=g.next();if(l.type===h.ANNOTATION_BOOKMARK){p=l;break}}p?b.removeAnnotation(p):(p=h.createAnnotation(h.ANNOTATION_BOOKMARK,f,d),p.title=void 0,b.addAnnotation(p))}};if(this._annotationFactory){var b=a.getModel();b.getBaseModel&&(b=b.getBaseModel());if(this._annotationModel=this._annotationFactory.createAnnotationModel(b))if(b=this._annotationStyler=this._annotationFactory.createAnnotationStyler(a,this._annotationModel))b.addAnnotationType(h.ANNOTATION_CURRENT_SEARCH),
b.addAnnotationType(h.ANNOTATION_MATCHING_SEARCH),b.addAnnotationType(h.ANNOTATION_ERROR),b.addAnnotationType(h.ANNOTATION_WARNING),b.addAnnotationType(h.ANNOTATION_MATCHING_BRACKET),b.addAnnotationType(h.ANNOTATION_CURRENT_BRACKET),b.addAnnotationType(h.ANNOTATION_CURRENT_LINE),b.addAnnotationType(h.ANNOTATION_READ_OCCURRENCE),b.addAnnotationType(h.ANNOTATION_WRITE_OCCURRENCE),b.addAnnotationType(h.ANNOTATION_SELECTED_LINKED_GROUP),b.addAnnotationType(h.ANNOTATION_CURRENT_LINKED_GROUP),b.addAnnotationType(h.ANNOTATION_LINKED_GROUP),
b.addAnnotationType("orion.annotation.highlightError");var b=this._annotationFactory.createAnnotationRulers(this._annotationModel),f=this._annotationRuler=b.annotationRuler;f&&(f.onDblClick=d,f.setMultiAnnotationOverlay({html:"\x3cdiv class\x3d'annotationHTML overlay'\x3e\x3c/div\x3e"}),f.addAnnotationType(h.ANNOTATION_ERROR),f.addAnnotationType(h.ANNOTATION_WARNING),f.addAnnotationType(h.ANNOTATION_TASK),f.addAnnotationType(h.ANNOTATION_BOOKMARK));this.setAnnotationRulerVisible(this._annotationRulerVisible||
void 0===this._annotationRulerVisible,!0);if(f=this._overviewRuler=b.overviewRuler)f.addAnnotationType(h.ANNOTATION_CURRENT_SEARCH),f.addAnnotationType(h.ANNOTATION_MATCHING_SEARCH),f.addAnnotationType(h.ANNOTATION_READ_OCCURRENCE),f.addAnnotationType(h.ANNOTATION_WRITE_OCCURRENCE),f.addAnnotationType(h.ANNOTATION_CURRENT_BLAME),f.addAnnotationType(h.ANNOTATION_ERROR),f.addAnnotationType(h.ANNOTATION_WARNING),f.addAnnotationType(h.ANNOTATION_TASK),f.addAnnotationType(h.ANNOTATION_BOOKMARK),f.addAnnotationType(h.ANNOTATION_MATCHING_BRACKET),
f.addAnnotationType(h.ANNOTATION_CURRENT_BRACKET),f.addAnnotationType(h.ANNOTATION_CURRENT_LINE);this.setOverviewRulerVisible(this._overviewRulerVisible||void 0===this._overviewRulerVisible,!0)}this._lineNumberRulerFactory&&(this._lineNumberRuler=this._lineNumberRulerFactory.createLineNumberRuler(this._annotationModel),this._lineNumberRuler.addAnnotationType(h.ANNOTATION_CURRENT_BLAME),this._lineNumberRuler.addAnnotationType(h.ANNOTATION_BLAME),this._lineNumberRuler.onDblClick=d,this.setLineNumberRulerVisible(this._lineNumberRulerVisible||
void 0===this._lineNumberRulerVisible,!0));this._foldingRulerFactory&&(this._foldingRuler=this._foldingRulerFactory.createFoldingRuler(this._annotationModel),this._foldingRuler.addAnnotationType(h.ANNOTATION_FOLDING),this.setFoldingRulerVisible(this._foldingRulerVisible||void 0===this._foldingRulerVisible,!0));this.dispatchEvent({type:"TextViewInstalled",textView:a});g.prototype.install.call(this)}},uninstallTextView:function(){this.uninstall()},uninstall:function(){var e=this._textView;e&&(e.destroy(),
this._textView=this._undoStack=this._textDND=this._contentAssist=this._listener=this._annotationModel=this._annotationStyler=this._annotationRuler=this._overviewRuler=this._lineNumberRuler=this._foldingRuler=this._currentLineAnnotation=this._title=null,this._dirty=!1,this._foldingRulerVisible=this._overviewRulerVisible=this._lineNumberRulerVisible=this._annotationRulerVisible=void 0,this.dispatchEvent({type:"TextViewUninstalled",textView:e}),g.prototype.uninstall.call(this))},_updateCursorStatus:function(){for(var e=
this.getModel(),a=this.getCaretOffset(),c=e.getLineAtOffset(a),e=e.getLineStart(c),a=a-e,e=this.getKeyModes(),d=0;d<e.length;d++){var b=e[d];if(b.isActive()&&b.isStatusActive&&b.isStatusActive())return}this.reportStatus(f.formatMessage(n.lineColumn,c+1,a+1))},showAnnotations:function(e,a,c,d){var b=this._annotationModel;if(b){for(var f=[],g=[],m=b.getTextModel(),k=b.getAnnotations(),n;k.hasNext();)n=k.next(),-1!==a.indexOf(n.type)&&n.creatorID===this&&f.push(n);if(e)for(a=0;a<e.length;a++)if(n=e[a]){if(c)n=
c(n);else{var q;"number"===typeof n.line?(q=m.getLineStart(n.line-1),k=q+n.start-1,q=q+n.end-1):(k=n.start,q=n.end);var w=d(n);if(!w)continue;n=h.createAnnotation(w,k,q,n.description)}n.creatorID=this;g.push(n)}b.replaceAnnotations(f,g)}},showProblems:function(e){this.showAnnotations(e,[h.ANNOTATION_ERROR,h.ANNOTATION_WARNING,h.ANNOTATION_TASK],null,function(a){switch(a.severity){case "error":return h.ANNOTATION_ERROR;case "warning":return h.ANNOTATION_WARNING;case "task":return h.ANNOTATION_TASK}return null})},
showOccurrences:function(e){this.showAnnotations(e,[h.ANNOTATION_READ_OCCURRENCE,h.ANNOTATION_WRITE_OCCURRENCE],null,function(a){return a.readAccess?h.ANNOTATION_READ_OCCURRENCE:h.ANNOTATION_WRITE_OCCURRENCE})},showBlame:function(e){var a=this._blameRGB,c=this.getTextView().getOptions("parent").ownerDocument;if(!a){var d=f.createElement(c,"div");d.className="annotation blame";c.body.appendChild(d);var g=(c.defaultView||c.parentWindow).getComputedStyle(d).getPropertyValue("background-color");d.parentNode.removeChild(d);
var d=g.indexOf("("),p=g.indexOf(")"),g=g.substring(d+1,p);this._blameRGB=a=g.split(",").slice(0,3)}var m=function(){var a=k.AnnotationType.createAnnotation(this.groupType,this.start,this.end,this.title);a.style=b.mixin({},a.style);a.style.style=b.mixin({},a.style.style);a.style.style.backgroundColor="";this.groupAnnotation=a;a.blame=this.blame;a.html=this.html;a.creatorID=this.creatorID;return a},t=function(){var a=f.createElement(c,"div");a.className="tooltipTitle";var d=this.blame.Message.indexOf("\n");
-1===d&&(d=this.blame.Message.length);var e=f.createElement(c,"a");e.href=this.blame.CommitLink;e.appendChild(c.createTextNode(this.blame.Message.substring(0,d)));a.appendChild(e);a.appendChild(f.createElement(c,"br"));a.appendChild(c.createTextNode(f.formatMessage(n.committerOnTime,this.blame.AuthorName,this.blame.Time)));return a},v=this.getModel();this.showAnnotations(e,[h.ANNOTATION_BLAME,h.ANNOTATION_CURRENT_BLAME],function(c){var d=v.getLineStart(c.Start-1),e=v.getLineEnd(c.End-1,!0),d=k.AnnotationType.createAnnotation(h.ANNOTATION_BLAME,
d,e,t),e=a.slice(0);e.push(c.Shade);d.style=b.mixin({},d.style);d.style.style=b.mixin({},d.style.style);d.style.style.backgroundColor="rgba("+e.join()+")";d.groupId=c.Name;d.groupType=h.ANNOTATION_CURRENT_BLAME;d.createGroupAnnotation=m;d.html='\x3cimg class\x3d"annotationHTML blame" src\x3d"'+c.AuthorImage+'"/\x3e';d.blame=c;return d})},showSelection:function(e,a,c,d,b){"number"===typeof e?("number"!==typeof a&&(a=e),this.moveSelection(e,a)):"number"===typeof c&&(e=this.getModel().getLineStart(c-
1),"number"===typeof d&&(e+=d),"number"!==typeof b&&(b=0),this.moveSelection(e,e+b))},_setModelText:function(e){this._textView&&(this._textView.setText(e),this._textView.getModel().setLineDelimiter("auto"),this._highlightCurrentLine(this._textView.getSelection()))},setInput:function(e,a,c,d,b){g.prototype.setInput.call(this,e,a,c,d);this._textView&&(!d&&!b)&&this._textView.focus()},onGotoLine:function(e,a,c,d){if(this._textView){var b=this.getModel();e=Math.max(0,Math.min(e,b.getLineCount()-1));var f=
b.getLineStart(e),g=0;void 0===c&&(c=0);"string"===typeof a?(e=b.getLine(e).indexOf(a),-1!==e&&(g=e,c=g+a.length)):(g=a,a=b.getLineEnd(e)-f,g=Math.min(g,a),c=Math.min(c,a));this.moveSelection(f+g,f+c,d)}}});return{BaseEditor:g,Editor:m}});
define("orion/editor/find","i18n!orion/editor/nls/messages orion/keyBinding orion/editor/keyModes orion/editor/annotations orion/regex orion/objects orion/util".split(" "),function(n,r,q,k,b,f,g){function m(a){var c=a.getTextView();q.KeyMode.call(this,c);this.editor=a;this._active=!1;this._success=!0;this._ignoreSelection=!1;this._prefix="";c.setAction("incrementalFindCancel",function(){this.setActive(!1);return!0}.bind(this));c.setAction("incrementalFindBackspace",function(){return this._backspace()}.bind(this));
var d=this;this._listener={onVerify:function(a){var c=d.editor,e=c.getModel(),f=c.mapOffset(a.start),c=c.mapOffset(a.end),e=e.getText(f,c);if((e=d._prefix.match(RegExp("^"+b.escape(e),"i")))&&0<e.length)d._prefix+=a.text,d._success=!0,d._status(),d.find(d._forward,!0),a.text=null},onSelection:function(){d._ignoreSelection||d.setActive(!1)}}}function h(a,c,d){if(a){this._editor=a;this._undoStack=c;this._showAll=!0;this._visible=!1;this._wrap=this._caseInsensitive=!0;this._wholeWord=!1;this._incremental=
!0;this._regex=!1;this._findAfterReplace=!0;this._reverse=this._hideAfterFind=!1;this._timer=this._end=this._start=void 0;this._lastString="";var e=this;this._listeners={onEditorFocus:function(a){e._removeCurrentAnnotation(a)}};this.setOptions(d)}}var e={};m.prototype=new q.KeyMode;f.mixin(m.prototype,{createKeyBindings:function(){var a=r.KeyBinding,c=[];c.push({actionID:"incrementalFindBackspace",keyBinding:new a(8)});c.push({actionID:"incrementalFindCancel",keyBinding:new a(13)});c.push({actionID:"incrementalFindCancel",
keyBinding:new a(27)});c.push({actionID:"incrementalFindReverse",keyBinding:new a(38)});c.push({actionID:"incrementalFind",keyBinding:new a(40)});c.push({actionID:"incrementalFindReverse",keyBinding:new a("k",!0,!0)});c.push({actionID:"incrementalFind",keyBinding:new a("k",!0)});return c},find:function(a,c){this._forward=a;if(!this.isActive())return this.setActive(!0),!1;var d=this._prefix;if(0===d.length)return!1;var e=this.editor,b=e.getModel(),b=a?this._success?c?this._start:e.getCaretOffset()+
1:0:this._success?c?this._start:e.getCaretOffset():b.getCharCount()-1;(d=e.getModel().find({string:d,start:b,reverse:!a,caseInsensitive:d.toLowerCase()===d}).next())?(c||(this._start=b),this._ignoreSelection=this._success=!0,e.moveSelection(a?d.start:d.end,a?d.end:d.start),this._ignoreSelection=!1):this._success=!1;this._status();return!0},isActive:function(){return this._active},isStatusActive:function(){return this.isActive()},setActive:function(a){this._active!==a&&(this._active=a,this._prefix=
"",this._success=!0,a=this.editor.getTextView(),this._start=this.editor.getCaretOffset(),this.editor.setCaretOffset(this._start),this._active?(a.addEventListener("Verify",this._listener.onVerify),a.addEventListener("Selection",this._listener.onSelection),a.addKeyMode(this)):(a.removeEventListener("Verify",this._listener.onVerify),a.removeEventListener("Selection",this._listener.onSelection),a.removeKeyMode(this)),this._status())},_backspace:function(){var a=this._prefix,a=this._prefix=a.substring(0,
a.length-1);return 0===a.length?(this._ignoreSelection=this._success=!0,this.editor.setCaretOffset(this.editor.getSelection().start),this._ignoreSelection=!1,this._status(),!0):this.find(this._forward,!0)},_status:function(){if(this.isActive()){var a;a=this._forward?this._success?n.incrementalFindStr:n.incrementalFindStrNotFound:this._success?n.incrementalFindReverseStr:n.incrementalFindReverseStrNotFound;a=g.formatMessage(a,this._prefix);this.editor.reportStatus(a,this._success?"":"error")}else this.editor.reportStatus("")}});
e.IncrementalFind=m;h.prototype={find:function(a,c,d){this.setOptions({reverse:!a});var e=this.getFindString(),b;c&&(e=c.findString||e,b=c.count);a=this.getOptions();this.setOptions(c);c=d?this._startOffset:this.getStartOffset();if((b=this._doFind(e,c,b))&&!d)this._startOffset=b.start;this.setOptions(a);this._hideAfterFind&&this.hide();return b},getStartOffset:function(){return void 0!==this._start?this._start:this._reverse?this._editor.getSelection().start-1:this._editor.getCaretOffset()},getFindString:function(){var a=
this._editor.getSelection(),a=this._editor.getText(a.start,a.end);this._regex&&(a=b.escape(a));return a||this._lastString},getOptions:function(){return{showAll:this._showAll,caseInsensitive:this._caseInsensitive,wrap:this._wrap,wholeWord:this._wholeWord,incremental:this._incremental,regex:this._regex,findAfterReplace:this._findAfterReplace,hideAfterFind:this._hideAfterFind,reverse:this._reverse,findCallback:this._findCallback,start:this._start,end:this._end}},getReplaceString:function(){return""},
hide:function(){this._visible=!1;this._savedOptions&&(this.setOptions(this._savedOptions.pop()),0===this._savedOptions.length&&(this._savedOptions=null));this._removeAllAnnotations();var a=this._editor.getTextView();a&&(a.removeEventListener("Focus",this._listeners.onEditorFocus),a.focus())},_processReplaceString:function(a){var c=a;if(this._regex){for(var c="",d=!1,e=this._editor.getModel().getLineDelimiter(),b=0;b<a.length;b++){var f=a.substring(b,b+1);if(d){switch(f){case "R":c+=e;break;case "r":c+=
"\r";break;case "n":c+="\n";break;case "t":c+="\t";break;case "\\":c+="\\";break;default:c+="\\"+f}d=!1}else"\\"===f?d=!0:c+=f}d&&(c+="\\")}return c},isVisible:function(){return this._visible},replace:function(){var a=this.getFindString();if(a){var c=this._editor,d=this._processReplaceString(this.getReplaceString()),e=c.getSelection().start;if(c=c.getModel().find({string:a,start:e,reverse:!1,wrap:this._wrap,regex:this._regex,wholeWord:this._wholeWord,caseInsensitive:this._caseInsensitive}).next())this.startUndo(),
this._doReplace(c.start,c.end,a,d),this.endUndo()}this._findAfterReplace&&a&&this._doFind(a,this.getStartOffset())},replaceAll:function(){var a=this.getFindString();if(a){this._replacingAll=!0;var c=this._editor,d=c.getTextView();c.reportStatus(n.replaceAll);var e=this._processReplaceString(this.getReplaceString()),b=this;window.setTimeout(function(){for(var f=0,h=0;;){var m=b._doFind(a,f,null,!0);if(!m)break;h++;1===h&&(d.setRedraw(!1),b.startUndo());b._doReplace(m.start,m.end,a,e);f=b.getStartOffset()}0<
h&&(b.endUndo(),d.setRedraw(!0));0<f?c.reportStatus(g.formatMessage(n.replacedMatches,h)):c.reportStatus(n.nothingReplaced,"error");b._replacingAll=!1},100)}},setOptions:function(a){if(a){if((!0===a.showAll||!1===a.showAll)&&this._showAll!==a.showAll)if(this._showAll=a.showAll,this.isVisible())if(this._showAll)this._markAllOccurrences();else{var c=this._editor.getAnnotationModel();c&&c.removeAnnotations(k.AnnotationType.ANNOTATION_MATCHING_SEARCH)}if(!0===a.caseInsensitive||!1===a.caseInsensitive)this._caseInsensitive=
a.caseInsensitive;if(!0===a.wrap||!1===a.wrap)this._wrap=a.wrap;if(!0===a.wholeWord||!1===a.wholeWord)this._wholeWord=a.wholeWord;if(!0===a.incremental||!1===a.incremental)this._incremental=a.incremental;if(!0===a.regex||!1===a.regex)this._regex=a.regex;if(!0===a.findAfterReplace||!1===a.findAfterReplace)this._findAfterReplace=a.findAfterReplace;if(!0===a.hideAfterFind||!1===a.hideAfterFind)this._hideAfterFind=a.hideAfterFind;if(!0===a.reverse||!1===a.reverse)this._reverse=a.reverse;a.hasOwnProperty("findCallback")&&
(this._findCallback=a.findCallback);a.hasOwnProperty("start")&&(this._start=a.start);a.hasOwnProperty("end")&&(this._end=a.end)}},show:function(a){this._visible=!0;a&&(this._savedOptions||(this._savedOptions=[]),this._savedOptions.push(this.getOptions()),this.setOptions(a));this._startOffset=this._editor.getSelection().start;this._editor.getTextView().addEventListener("Focus",this._listeners.onEditorFocus);var c=this;window.setTimeout(function(){c._incremental&&c.find(!0,null,!0)},0)},startUndo:function(){this._undoStack&&
this._undoStack.startCompoundChange()},endUndo:function(){this._undoStack&&this._undoStack.endCompoundChange()},_find:function(a,c,d){return this._editor.getModel().find({string:a,start:c,end:this._end,reverse:this._reverse,wrap:d?!1:this._wrap,regex:this._regex,wholeWord:this._wholeWord,caseInsensitive:this._caseInsensitive})},_doFind:function(a,c,d,e){d=d||1;var b=this._editor;if(!a)return this._removeAllAnnotations(),null;this._lastString=a;var f,g;if(this._regex)try{g=this._find(a,c,e)}catch(h){b.reportStatus(h.message,
"error");return}else g=this._find(a,c,e);for(a=0;a<d&&g.hasNext();a++)f=g.next();if(!this._replacingAll){f?this._editor.reportStatus(""):this._editor.reportStatus(n.notFound,"error");if(this.isVisible()){d=k.AnnotationType.ANNOTATION_CURRENT_SEARCH;if(g=b.getAnnotationModel())g.removeAnnotations(d),f&&g.addAnnotation(k.AnnotationType.createAnnotation(d,f.start,f.end));if(this._showAll){this._timer&&window.clearTimeout(this._timer);var m=this;this._timer=window.setTimeout(function(){m._markAllOccurrences();
m._timer=null},500)}}this._findCallback?this._findCallback(f):f&&b.moveSelection(f.start,f.end,null,!1)}return f},_doReplace:function(a,c,d,b){var e=this._editor;if(this._regex&&(b=e.getText(a,c).replace(RegExp(d,this._caseInsensitive?"i":""),b),!b))return;e.setText(b,a,c);e.setSelection(a,a+b.length,!0)},_markAllOccurrences:function(){var a=this._editor.getAnnotationModel();if(a){for(var c=k.AnnotationType.ANNOTATION_MATCHING_SEARCH,d=a.getAnnotations(),b=[],e;d.hasNext();){var f=d.next();f.type===
c&&b.push(f)}if(this.isVisible()){d=this.getFindString();d=this._editor.getModel().find({string:d,regex:this._regex,wholeWord:this._wholeWord,caseInsensitive:this._caseInsensitive});for(e=[];d.hasNext();)f=d.next(),e.push(k.AnnotationType.createAnnotation(c,f.start,f.end))}a.replaceAnnotations(b,e)}},_removeAllAnnotations:function(){var a=this._editor.getAnnotationModel();a&&(a.removeAnnotations(k.AnnotationType.ANNOTATION_CURRENT_SEARCH),a.removeAnnotations(k.AnnotationType.ANNOTATION_MATCHING_SEARCH))},
_removeCurrentAnnotation:function(a){(a=this._editor.getAnnotationModel())&&a.removeAnnotations(k.AnnotationType.ANNOTATION_CURRENT_SEARCH)}};e.Find=h;return e});
define("orion/editor/actions","i18n!orion/editor/nls/messages orion/keyBinding orion/editor/annotations orion/editor/tooltip orion/editor/find orion/util".split(" "),function(n,r,q,k,b,f){function g(a,c,d){this.editor=a;this.undoStack=c;this._incrementalFind=new b.IncrementalFind(a);this._find=d?d:new b.Find(a,c);this._lastEditLocation=null;this.init()}function m(a,c,d,b){this.editor=a;this.undoStack=c;this.contentAssist=d;this.linkedMode=b;this.contentAssist&&this.contentAssist.addEventListener("ProposalApplied",
this.contentAssistProposalApplied.bind(this));this.init()}var h=q.AnnotationType,e={};g.prototype={init:function(){var a=this.editor.getTextView();this._lastEditListener={onModelChanged:function(a){this.editor.isDirty()&&(this._lastEditLocation=a.start+a.addedCharCount)}.bind(this)};a.addEventListener("ModelChanged",this._lastEditListener.onModelChanged);a.setAction("undo",function(a){if(this.undoStack){var d=1;a&&a.count&&(d=a.count);for(;0<d;)this.undoStack.undo(),--d;return!0}return!1}.bind(this),
{name:n.undo});a.setAction("redo",function(a){if(this.undoStack){var d=1;a&&a.count&&(d=a.count);for(;0<d;)this.undoStack.redo(),--d;return!0}return!1}.bind(this),{name:n.redo});a.setKeyBinding(new r.KeyBinding("f",!0),"find");a.setAction("find",function(){if(this._find){var a=this.editor.getSelection();(a=prompt(n.find,this.editor.getText(a.start,a.end)))&&this._find.find(!0,{findString:a})}}.bind(this),{name:n.find});a.setKeyBinding(new r.KeyBinding("k",!0),"findNext");a.setAction("findNext",function(a){return this._find?
(this._find.find(!0,a),!0):!1}.bind(this),{name:n.findNext});a.setKeyBinding(new r.KeyBinding("k",!0,!0),"findPrevious");a.setAction("findPrevious",function(a){return this._find?(this._find.find(!1,a),!0):!1}.bind(this),{name:n.findPrevious});a.setKeyBinding(new r.KeyBinding("j",!0),"incrementalFind");a.setAction("incrementalFind",function(){this._incrementalFind&&this._incrementalFind.find(!0);return!0}.bind(this),{name:n.incrementalFind});a.setKeyBinding(new r.KeyBinding("j",!0,!0),"incrementalFindReverse");
a.setAction("incrementalFindReverse",function(){this._incrementalFind&&this._incrementalFind.find(!1);return!0}.bind(this),{name:n.incrementalFindReverse});a.setAction("tab",function(){return this.indentLines()}.bind(this));a.setAction("shiftTab",function(){return this.unindentLines()}.bind(this),{name:n.unindentLines});a.setKeyBinding(new r.KeyBinding(38,!1,!1,!0),"moveLinesUp");a.setAction("moveLinesUp",function(){return this.moveLinesUp()}.bind(this),{name:n.moveLinesUp});a.setKeyBinding(new r.KeyBinding(40,
!1,!1,!0),"moveLinesDown");a.setAction("moveLinesDown",function(){return this.moveLinesDown()}.bind(this),{name:n.moveLinesDown});a.setKeyBinding(new r.KeyBinding(38,!0,!1,!0),"copyLinesUp");a.setAction("copyLinesUp",function(){return this.copyLinesUp()}.bind(this),{name:n.copyLinesUp});a.setKeyBinding(new r.KeyBinding(40,!0,!1,!0),"copyLinesDown");a.setAction("copyLinesDown",function(){return this.copyLinesDown()}.bind(this),{name:n.copyLinesDown});a.setKeyBinding(new r.KeyBinding("d",!0,!1,!1),
"deleteLines");a.setAction("deleteLines",function(a){return this.deleteLines(a)}.bind(this),{name:n.deleteLines});a.setKeyBinding(new r.KeyBinding("l",!f.isMac,!1,!1,f.isMac),"gotoLine");a.setAction("gotoLine",function(){return this.gotoLine()}.bind(this),{name:n.gotoLine});a.setKeyBinding(new r.KeyBinding(190,!0),"nextAnnotation");a.setAction("nextAnnotation",function(){return this.nextAnnotation(!0)}.bind(this),{name:n.nextAnnotation});a.setKeyBinding(new r.KeyBinding(188,!0),"previousAnnotation");
a.setAction("previousAnnotation",function(){return this.nextAnnotation(!1)}.bind(this),{name:n.prevAnnotation});a.setKeyBinding(new r.KeyBinding("e",!0,!1,!0,!1),"expand");a.setAction("expand",function(){return this.expandAnnotation(!0)}.bind(this),{name:n.expand});a.setKeyBinding(new r.KeyBinding("c",!0,!1,!0,!1),"collapse");a.setAction("collapse",function(){return this.expandAnnotation(!1)}.bind(this),{name:n.collapse});a.setKeyBinding(new r.KeyBinding("e",!0,!0,!0,!1),"expandAll");a.setAction("expandAll",
function(){return this.expandAnnotations(!0)}.bind(this),{name:n.expandAll});a.setKeyBinding(new r.KeyBinding("c",!0,!0,!0,!1),"collapseAll");a.setAction("collapseAll",function(){return this.expandAnnotations(!1)}.bind(this),{name:n.collapseAll});a.setKeyBinding(new r.KeyBinding("q",!f.isMac,!1,!1,f.isMac),"lastEdit");a.setAction("lastEdit",function(){return this.gotoLastEdit()}.bind(this),{name:n.lastEdit})},copyLinesDown:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;
var c=a.getModel(),d=a.getSelection(),b=c.getLineAtOffset(d.start),d=c.getLineAtOffset(d.end>d.start?d.end-1:d.end),e=c.getLineStart(b),b=c.getLineEnd(d,!0),f=c.getLineCount(),g="",e=c.getText(e,b);d===f-1&&(e=(g=c.getLineDelimiter())+e);a.setText(e,b,b);a.setSelection(b+g.length,b+e.length);return!0},copyLinesUp:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var c=a.getModel(),d=a.getSelection(),b=c.getLineAtOffset(d.start),d=c.getLineAtOffset(d.end>d.start?d.end-
1:d.end),b=c.getLineStart(b),e=c.getLineEnd(d,!0),f=c.getLineCount(),g="",e=c.getText(b,e);d===f-1&&(e+=g=c.getLineDelimiter());a.setText(e,b,b);a.setSelection(b,b+e.length-g.length);return!0},deleteLines:function(a){var c=this.editor;if(c.getTextView().getOptions("readonly"))return!1;var d=1;a&&a.count&&(d=a.count);var b=c.getSelection(),e=c.getModel(),f=e.getLineAtOffset(b.start);a=e.getLineStart(f);d=b.start!==b.end||1===d?e.getLineAtOffset(b.end>b.start?b.end-1:b.end):Math.min(f+d-1,e.getLineCount()-
1);d=e.getLineEnd(d,!0);c.setText("",a,d);return!0},expandAnnotation:function(a){var c=this.editor,d=c.getAnnotationModel();if(!d)return!0;var b=c.getModel(),e=c.getCaretOffset(),f=b.getLineAtOffset(e),e=b.getLineStart(f),f=b.getLineEnd(f,!0);b.getBaseModel&&(e=b.mapOffset(e),f=b.mapOffset(f),b.getBaseModel());for(var g,d=d.getAnnotations(e,f);!g&&d.hasNext();)b=d.next(),b.type===q.AnnotationType.ANNOTATION_FOLDING&&(g=b);g&&a!==g.expanded&&(a?g.expand():(c.setCaretOffset(g.start),g.collapse()));
return!0},expandAnnotations:function(a){var c=this.editor,d=c.getTextView(),c=c.getAnnotationModel();if(!c)return!0;var b=c.getAnnotations();for(d.setRedraw(!1);b.hasNext();)c=b.next(),c.type===q.AnnotationType.ANNOTATION_FOLDING&&a!==c.expanded&&(a?c.expand():c.collapse());d.setRedraw(!0);return!0},indentLines:function(){var a=this.editor,c=a.getTextView();if(c.getOptions("readonly"))return!1;if(c.getOptions("tabMode")){var d=a.getModel(),b=a.getSelection(),e=d.getLineAtOffset(b.start),f=d.getLineAtOffset(b.end>
b.start?b.end-1:b.end);if(e!==f){var g=[];g.push("");for(var h=e;h<=f;h++)g.push(d.getLine(h,!0));h=d.getLineStart(e);d=d.getLineEnd(f,!0);c=c.getOptions("tabSize","expandTab");c=c.expandTab?Array(c.tabSize+1).join(" "):"\t";a.setText(g.join(c),h,d);a.setSelection(h===b.start?b.start:b.start+c.length,b.end+(f-e+1)*c.length);return!0}return!1}},gotoLastEdit:function(){"number"===typeof this._lastEditLocation&&this.editor.showSelection(this._lastEditLocation);return!0},gotoLine:function(){var a=this.editor,
c=a.getModel().getLineAtOffset(a.getCaretOffset());if(c=prompt(n.gotoLinePrompty,c+1))c=parseInt(c,10),a.onGotoLine(c-1,0);return!0},moveLinesDown:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var c=a.getModel(),d=a.getSelection(),b=c.getLineAtOffset(d.start),e=c.getLineAtOffset(d.end>d.start?d.end-1:d.end),f=c.getLineCount();if(e===f-1)return!0;var b=c.getLineStart(b),d=c.getLineEnd(e,!0),g=c.getLineEnd(e+1,!0)-(d-b),h=0;e!==f-2?c=c.getText(b,d):(e=c.getLineEnd(e),
c=c.getText(e,d)+c.getText(b,e),h+=d-e);this.startUndo();a.setText("",b,d);a.setText(c,g,g);a.setSelection(g+h,g+h+c.length);this.endUndo();return!0},moveLinesUp:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var c=a.getModel(),d=a.getSelection(),b=c.getLineAtOffset(d.start);if(0===b)return!0;var e=c.getLineAtOffset(d.end>d.start?d.end-1:d.end),f=c.getLineCount(),d=c.getLineStart(b-1),g=c.getLineStart(b),h=c.getLineEnd(e,!0),m=c.getText(g,h),k=0;e===f-1&&(e=c.getLineEnd(b-
1),b=c.getLineEnd(b-1,!0),m+=c.getText(e,b),g=e,k=b-e);this.startUndo();a.setText("",g,h);a.setText(m,d,d);a.setSelection(d,d+m.length-k);this.endUndo();return!0},nextAnnotation:function(a){function c(a){return!!a.lineStyle||a.type===h.ANNOTATION_MATCHING_BRACKET||a.type===h.ANNOTATION_CURRENT_BRACKET||!e.isAnnotationTypeVisible(a.type)}var d=this.editor,b=d.getAnnotationModel();if(!b)return!0;var e=d.getOverviewRuler()||d.getAnnotationStyler();if(!e)return!0;for(var f=d.getModel(),g=d.getCaretOffset(),
m=b.getAnnotations(a?g:0,a?f.getCharCount():g),n=null;m.hasNext();){var q=m.next();if(a){if(q.start<=g)continue}else if(q.start>=g)continue;if(!c(q)&&(n=q,a))break}if(n){for(var w=[n],m=b.getAnnotations(n.start,n.start);m.hasNext();)q=m.next(),q!==n&&!c(q)&&w.push(q);var r=d.getTextView(),l=f.getLineAtOffset(n.start),z=k.Tooltip.getTooltip(r);if(!z)return d.moveSelection(n.start),!0;d.moveSelection(n.start,n.start,function(){z.setTarget({getTooltipInfo:function(){var a=r.convert({x:r.getLocationAtOffset(n.start).x,
y:r.getLocationAtOffset(f.getLineStart(l)).y},"document","page");return{contents:w,x:a.x,y:a.y+Math.floor(1.33*r.getLineHeight(l))}}},0)})}return!0},unindentLines:function(){var a=this.editor,c=a.getTextView();if(c.getOptions("readonly"))return!1;if(c.getOptions("tabMode")){for(var d=a.getModel(),b=a.getSelection(),e=d.getLineAtOffset(b.start),f=d.getLineAtOffset(b.end>b.start?b.end-1:b.end),g=c.getOptions("tabSize"),h=Array(g+1).join(" "),m=[],k=c=0,n=e;n<=f;n++){var q=d.getLine(n,!0);if(d.getLineStart(n)!==
d.getLineEnd(n))if(0===q.indexOf("\t"))q=q.substring(1),c++;else if(0===q.indexOf(h))q=q.substring(g),c+=g;else return!0;n===e&&(k=c);m.push(q)}e=d.getLineStart(e);g=d.getLineEnd(f,!0);d=d.getLineStart(f);a.setText(m.join(""),e,g);f=e===b.start?b.start:b.start-k;b=Math.max(f,b.end-c+(b.end===d+1&&b.start!==b.end?1:0));a.setSelection(f,b);return!0}},startUndo:function(){this.undoStack&&this.undoStack.startCompoundChange()},endUndo:function(){this.undoStack&&this.undoStack.endCompoundChange()}};e.TextActions=
g;m.prototype={init:function(){var a=this.editor.getTextView();a.setAction("lineStart",function(){return this.lineStart()}.bind(this));a.setAction("enter",function(){return this.autoIndent()}.bind(this));a.setKeyBinding(new r.KeyBinding("t",!0,!1,!0),"trimTrailingWhitespaces");a.setAction("trimTrailingWhitespaces",function(){return this.trimTrailingWhitespaces()}.bind(this),{name:n.trimTrailingWhitespaces});a.setKeyBinding(new r.KeyBinding(191,!0),"toggleLineComment");a.setAction("toggleLineComment",
function(){return this.toggleLineComment()}.bind(this),{name:n.toggleLineComment});a.setKeyBinding(new r.KeyBinding(191,!0,!f.isMac,!1,f.isMac),"addBlockComment");a.setAction("addBlockComment",function(){return this.addBlockComment()}.bind(this),{name:n.addBlockComment});a.setKeyBinding(new r.KeyBinding(220,!0,!f.isMac,!1,f.isMac),"removeBlockComment");a.setAction("removeBlockComment",function(){return this.removeBlockComment()}.bind(this),{name:n.removeBlockComment});a.setKeyBinding(new r.KeyBinding("[",
!1,!1,!1,!1,"keypress"),"autoPairSquareBracket");a.setAction("autoPairSquareBracket",function(){return this.autoPairBrackets("[","]")}.bind(this));a.setKeyBinding(new r.KeyBinding("]",!1,!1,!1,!1,"keypress"),"skipClosingSquareBracket");a.setAction("skipClosingSquareBracket",function(){return this.skipClosingBracket("]")}.bind(this));a.setKeyBinding(new r.KeyBinding("\x3c",!1,!1,!1,!1,"keypress"),"autoPairAngleBracket");a.setAction("autoPairAngleBracket",function(){return this.autoPairBrackets("\x3c",
"\x3e")}.bind(this));a.setKeyBinding(new r.KeyBinding("\x3e",!1,!1,!1,!1,"keypress"),"skipClosingAngleBracket");a.setAction("skipClosingAngleBracket",function(){return this.skipClosingBracket("\x3e")}.bind(this));a.setKeyBinding(new r.KeyBinding("(",!1,!1,!1,!1,"keypress"),"autoPairParentheses");a.setAction("autoPairParentheses",function(){return this.autoPairBrackets("(",")")}.bind(this));a.setKeyBinding(new r.KeyBinding(")",!1,!1,!1,!1,"keypress"),"skipClosingParenthesis");a.setAction("skipClosingParenthesis",
function(){return this.skipClosingBracket(")")}.bind(this));a.setKeyBinding(new r.KeyBinding("{",!1,!1,!1,!1,"keypress"),"autoPairBraces");a.setAction("autoPairBraces",function(){return this.autoPairBrackets("{","}")}.bind(this));a.setKeyBinding(new r.KeyBinding("}",!1,!1,!1,!1,"keypress"),"skipClosingBrace");a.setAction("skipClosingBrace",function(){return this.skipClosingBracket("}")}.bind(this));a.setKeyBinding(new r.KeyBinding("'",!1,!1,!1,!1,"keypress"),"autoPairSingleQuotation");a.setAction("autoPairSingleQuotation",
function(){return this.autoPairQuotations("'")}.bind(this));a.setKeyBinding(new r.KeyBinding('"',!1,!1,!1,!1,"keypress"),"autoPairDblQuotation");a.setAction("autoPairDblQuotation",function(){return this.autoPairQuotations('"')}.bind(this));a.setAction("deletePrevious",function(){return this.deletePrevious()}.bind(this))},autoIndent:function(){var a=this.editor,c=a.getTextView();if(c.getOptions("readonly"))return!1;var d=a.getSelection();if(d.start===d.end){for(var b=a.getModel(),e=b.getLineAtOffset(d.start),
f=b.getLine(e,!1),g=b.getLineStart(e),h=0,m=d.start-g,k;h<m&&(32===(k=f.charCodeAt(h))||9===k);)h++;var g=f.substring(0,h),c=c.getOptions("tabSize","expandTab"),n=c.expandTab?Array(c.tabSize+1).join(" "):"\t",c=b.getLineDelimiter(),q=/^[\s]*\/\*[\*]*[\s]*$/,l=/^[\s]*\*/,z=/\*\/[\s]*$/,r=f.substring(0,m),C=f.substring(m),F;if(this.smartIndentation&&123===f.charCodeAt(F=r.trimRight().length-1))return b=m-F-1,C=C.length-C.trimLeft().length,f=125===f.charCodeAt(m+C)?c+g+n+c+g:c+g+n,a.setText(f,d.start-
b,d.end+C),a.setCaretOffset(d.start+c.length+g.length+n.length-b),!0;if(this.autoCompleteComments&&!z.test(r)&&(q.test(r)||l.test(r))){if(h=q.exec(r)){f=c+g+" * ";f=z.test(C)?f+C.substring(0,C.length-2).trim():f+C.trim();if(b.getLineCount()===e+1||!l.test(b.getLine(e+1)))f+=c+g+" */";a.setText(f,d.start,d.end+C.length);a.setCaretOffset(d.start+c.length+g.length+3);return!0}if(h=l.exec(r))for(e-=1;0<=e;e--){h=b.getLine(e,!1);if(q.test(h))return z.test(C)||47===f.charCodeAt(m)?(f=c+g+"*"+C,g=d.start+
c.length+g.length+1):(f=c+g+"* "+C,g=d.start+c.length+g.length+2),a.setText(f,d.start,d.end+C.length),a.setCaretOffset(g),!0;if(!l.test(h))break}}else{if(z.test(r)&&32===g.charCodeAt(g.length-1))return f=c+g.substring(0,g.length-1),a.setText(f,d.start,d.end),a.setCaretOffset(d.start+f.length),!0;if(0<h){for(h=m;h<f.length&&(32===(k=f.charCodeAt(h++))||9===k);)d.end++;a.setText(b.getLineDelimiter()+g,d.start,d.end);return!0}}}return!1},addBlockComment:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;
var c=a.getModel(),d=a.getSelection(),b=this._findEnclosingComment(c,d.start,d.end);if(void 0!==b.commentStart&&void 0!==b.commentEnd)return!0;c=c.getText(d.start,d.end);if(0===c.length)return!0;var b=c.length,c=c.replace(/\/\*|\*\//g,""),e=c.length;a.setText("/*"+c+"*/",d.start,d.end);a.setSelection(d.start+2,d.end+2+(e-b));return!0},autoPairBrackets:function(a,c){if("["===a&&!this.autoPairSquareBrackets||"{"===a&&!this.autoPairBraces||"("===a&&!this.autoPairParentheses||"\x3c"===a&&!this.autoPairAngleBrackets)return!1;
var d=this.editor;if(d.getTextView().getOptions("readonly"))return!1;var b=d.getSelection(),e=d.getModel(),f=d.getCaretOffset()===e.getCharCount()?"":e.getText(b.start,b.start+1).trim(),g=/^$|[)}\]>]/;return b.start===b.end&&g.test(f)?(d.setText(a+c,b.start,b.start),d.setCaretOffset(b.start+1),!0):b.start!==b.end?(e=e.getText(b.start,b.end),d.setText(a+e+c,b.start,b.end),d.setSelection(b.start+1,b.end+1),!0):!1},autoPairQuotations:function(a){if(!this.autoPairQuotation)return!1;var c=this.editor;
if(c.getTextView().getOptions("readonly"))return!1;var d=c.getSelection(),b=c.getModel(),e=c.getCaretOffset(),f=0===e?"":b.getText(d.start-1,d.start).trim(),g=e===b.getCharCount()?"":b.getText(d.start,d.start+1).trim(),e=/^"$|^'$/,h=/\w/,m=/^$|[)}\]>]/;if(d.start!==d.end){b=b.getText(d.start,d.end);if(e.test(b))return!1;c.setText(a+b+a,d.start,d.end);c.setSelection(d.start+1,d.end+1)}else{if(g!==a){if(f===a||e.test(g)||h.test(f)||!m.test(g))return!1;c.setText(a+a,d.start,d.start)}c.setCaretOffset(d.start+
1)}return!0},contentAssistProposalApplied:function(a){a=a.data.proposal;if(a.positions&&0<a.positions.length&&this.linkedMode){for(var c=[],d=0;d<a.positions.length;++d)c[d]={positions:[{offset:a.positions[d].offset,length:a.positions[d].length}]};this.linkedMode.enterLinkedMode({groups:c,escapePosition:a.escapePosition})}else a.groups&&0<a.groups.length&&this.linkedMode?this.linkedMode.enterLinkedMode({groups:a.groups,escapePosition:a.escapePosition}):a.escapePosition&&this.editor.getTextView().setCaretOffset(a.escapePosition);
return!0},deletePrevious:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var c=a.getSelection();if(c.start!==c.end)return!1;var d=a.getModel(),b=a.getCaretOffset(),e=0===b?"":d.getText(c.start-1,c.start),d=b===d.getCharCount()?"":d.getText(c.start,c.start+1);("("===e&&")"===d||"["===e&&"]"===d||"{"===e&&"}"===d||"\x3c"===e&&"\x3e"===d||'"'===e&&'"'===d||"'"===e&&"'"===d)&&a.setText("",c.start,c.start+1);return!1},_findEnclosingComment:function(a,c,d){var b=a.getLineAtOffset(c),
e=a.getLineAtOffset(d),f,g,h,m,k,n;for(f=b;0<=f&&!(g=a.getLine(f),h=f===b?c-a.getLineStart(b):g.length,m=g.lastIndexOf("/*",h),g=g.lastIndexOf("*/",h),g>m);f--)if(-1!==m){k=a.getLineStart(f)+m;break}for(f=e;f<a.getLineCount()&&!(g=a.getLine(f),h=f===e?d-a.getLineStart(e):0,m=g.indexOf("/*",h),g=g.indexOf("*/",h),-1!==m&&m<g);f++)if(-1!==g){n=a.getLineStart(f)+g;break}return{commentStart:k,commentEnd:n}},lineStart:function(){for(var a=this.editor,c=a.getModel(),d=a.getCaretOffset(),b=c.getLineAtOffset(d),
e=c.getLineStart(b),c=c.getLine(b),b=0;b<c.length;b++){var f=c.charCodeAt(b);if(!(32===f||9===f))break}b+=e;return d!==b?(a.setSelection(b,b),!0):!1},removeBlockComment:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var c=a.getModel(),d=a.getSelection(),b=c.getText(d.start,d.end),e,f,g;for(g=0;g<b.length;g++)if("/*"===b.substring(g,g+2)){e=d.start+g;break}for(;g<b.length;g++)if("*/"===b.substring(g,g+2)){f=d.start+g;break}if(void 0!==e&&void 0!==f)a.setText(c.getText(e+
2,f),e,f+2),a.setSelection(e,f);else{b=this._findEnclosingComment(c,d.start,d.end);if(void 0===b.commentStart||void 0===b.commentEnd)return!0;c=c.getText(b.commentStart+2,b.commentEnd);a.setText(c,b.commentStart,b.commentEnd+2);a.setSelection(d.start-2,d.end-2)}return!0},toggleLineComment:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;for(var c=this.lineComment||"//",d=a.getModel(),b=a.getSelection(),e=d.getLineAtOffset(b.start),f=d.getLineAtOffset(b.end>b.start?b.end-
1:b.end),g=!0,h=[],m,k,n=e;n<=f;n++)if(m=d.getLine(n,!0),h.push(m),!g||-1===(k=m.indexOf(c)))g=!1;else if(0!==k){var q;for(q=0;q<k;q++){var l=m.charCodeAt(q);if(!(32===l||9===l))break}g=q===k}l=c.length;n=d.getLineStart(e);q=d.getLineEnd(f,!0);if(g){for(g=0;g<h.length;g++)m=h[g],k=m.indexOf(c),h[g]=m.substring(0,k)+m.substring(k+l);c=h.join("");h=d.getLineStart(f);d=n===b.start?b.start:b.start-l;b=b.end-l*(f-e+1)+(b.end===h+1?l:0)}else h.splice(0,0,""),c=h.join(c),d=n===b.start?b.start:b.start+l,
b=b.end+l*(f-e+1);a.setText(c,n,q);a.setSelection(d,b);return!0},trimTrailingWhitespaces:function(){var a=this.editor,c=a.getModel(),d=a.getSelection();a.getTextView().setRedraw(!1);a.getUndoStack().startCompoundChange();for(var b=/(\s+$)/,e=c.getLineCount(),f=0;f<e;f++){var g=c.getLine(f),h=b.exec(g);if(h){var m=c.getLineStart(f),g=h[0].length,h=m+h.index;c.setText("",h,h+g);d.start>h&&(d.start=Math.max(h,d.start-g));d.start!==d.end&&d.end>h&&(d.end=Math.max(h,d.end-g))}}a.getUndoStack().endCompoundChange();
a.getTextView().setRedraw(!0);a.setSelection(d.start,d.end,!1)},startUndo:function(){this.undoStack&&this.undoStack.startCompoundChange()},skipClosingBracket:function(a){var c=this.editor;if(c.getTextView().getOptions("readonly"))return!1;var d=c.getSelection(),b=c.getModel();return(c.getCaretOffset()===b.getCharCount()?"":b.getText(d.start,d.start+1))===a?(c.setCaretOffset(d.start+1),!0):!1},endUndo:function(){this.undoStack&&this.undoStack.endCompoundChange()},setAutoPairParentheses:function(a){this.autoPairParentheses=
a},setAutoPairBraces:function(a){this.autoPairBraces=a},setAutoPairSquareBrackets:function(a){this.autoPairSquareBrackets=a},setAutoPairAngleBrackets:function(a){this.autoPairAngleBrackets=a},setAutoPairQuotations:function(a){this.autoPairQuotation=a},setAutoCompleteComments:function(a){this.autoCompleteComments=a},setLineComment:function(a){this.lineComment=a},setSmartIndentation:function(a){this.smartIndentation=a}};e.SourceCodeActions=m;String.prototype.trimLeft||(String.prototype.trimLeft=function(){return this.replace(/^\s+/g,
"")});String.prototype.trimRight||(String.prototype.trimRight=function(){return this.replace(/\s+$/g,"")});return e});
define("orion/editor/templates",[],function(){function n(n,k,b,f){this.prefix=n;this.description=k;this.template=b;this.name=f;this._parse()}function r(n,k){this._keywords=n||[];this._templates=[];this.addTemplates(k||[])}n.prototype={getProposal:function(n,k,b){n=k-n.length;k={};var f,g=void 0!==b.delimiter?b.delimiter:"\n";b.indentation&&(g+=b.indentation);var m=void 0!==b.tab?b.tab:"\t",h=0,e=this.variables,a=this.segments;b=[];for(var c=0;c<a.length;c++){var d=a[c],s=e[d];if(void 0!==s)switch(d){case "${tab}":d=
m;break;case "${delimiter}":d=g;break;case "${cursor}":d="";f=h;break;default:var p=k[d];p||(p=k[d]={data:s.data,positions:[]});d=s.substitution;p.data&&p.data.values&&(d=p.data.values[0]);p.positions.push({offset:n+h,length:d.length})}b.push(d);h+=d.length}var g=[],u;for(u in k)k.hasOwnProperty(u)&&g.push(k[u]);b=b.join("");void 0===f&&(f=b.length);return{proposal:b,name:this.name,description:this.description,groups:g,escapePosition:n+f,style:"noemphasis"}},match:function(n){return 0===this.prefix.indexOf(n)},
_parse:function(){var n=this.template,k=[],b={},f,g=0,n=n.replace(/\n/g,"${delimiter}"),n=n.replace(/\t/g,"${tab}");n.replace(/\$\{((?:[^\\}]+|\\.))*\}/g,function(m,h,e){var a=m.substring(2,m.length-1);h=m;var c=a,d=null,s=c.indexOf(":");-1!==s&&(c=c.substring(0,s),h="${"+c+"}",d=JSON.parse(a.substring(s+1).replace("\\}","}").trim()));(a=b[h])||(a=b[h]={});a.substitution=c;d&&(a.data=d);(f=n.substring(g,e))&&k.push(f);k.push(h);g=e+m.length;return c});(f=n.substring(g,n.length))&&k.push(f);this.segments=
k;this.variables=b}};r.prototype={addTemplates:function(q){for(var k=this.getTemplates(),b=0;b<q.length;b++)k.push(new n(q[b].prefix,q[b].description,q[b].template,q[b].name))},computeProposals:function(n,k,b){var f=this.getPrefix(n,k,b),g=[];this.isValid(f,n,k,b)&&(g=g.concat(this.getTemplateProposals(f,k,b)),g=g.concat(this.getKeywordProposals(f)));return g},getKeywords:function(){return this._keywords},getKeywordProposals:function(n){var k=[],b=this.getKeywords();if(b){for(var f=0;f<b.length;f++)0===
b[f].indexOf(n)&&k.push({proposal:b[f].substring(n.length),description:b[f],style:"noemphasis_keyword"});0<k.length&&k.splice(0,0,{proposal:"",description:"Keywords",style:"noemphasis_title_keywords",unselectable:!0})}return k},getPrefix:function(n,k,b){return b.prefix},getTemplates:function(){return this._templates},getTemplateProposals:function(n,k,b){for(var f=[],g=this.getTemplates(),m=0;m<g.length;m++){var h=g[m];h.match(n)&&(h=h.getProposal(n,k,b),this.removePrefix(n,h),f.push(h))}0<f.length&&
(f.sort(function(b,a){return b.name<a.name?-1:b.name>a.name?1:0}),f.splice(0,0,{proposal:"",description:"Templates",style:"noemphasis_title",unselectable:!0}));return f},removePrefix:function(n,k){if(!(k.overwrite=k.proposal.substring(0,n.length)!==n))k.proposal=k.proposal.substring(n.length)},isValid:function(n,k,b,f){return!0}};return{Template:n,TemplateContentAssist:r}});
define("orion/editor/linkedMode","i18n!orion/editor/nls/messages orion/keyBinding orion/editor/keyModes orion/editor/annotations orion/editor/templates orion/objects orion/util".split(" "),function(n,r,q,k,b,f){function g(b,e,a){var c=b.getTextView();q.KeyMode.call(this,c);this.editor=b;this.undoStack=e;this.contentAssist=a;this.linkedModeModel=null;c.setAction("linkedModeEnter",function(){this.exitLinkedMode(!0);return!0}.bind(this));c.setAction("linkedModeCancel",function(){this.exitLinkedMode(!1);
return!0}.bind(this));c.setAction("linkedModeNextGroup",function(){var a=this.linkedModeModel;this.selectLinkedGroup((a.selectedGroupIndex+1)%a.groups.length);return!0}.bind(this));c.setAction("linkedModePreviousGroup",function(){var a=this.linkedModeModel;this.selectLinkedGroup(0<a.selectedGroupIndex?a.selectedGroupIndex-1:a.groups.length-1);return!0}.bind(this));this.linkedModeListener={onActivating:function(a){this._groupContentAssistProvider&&(this.contentAssist.setProviders([this._groupContentAssistProvider]),
this.contentAssist.setProgress(null))}.bind(this),onModelChanged:function(a){if(!this.ignoreVerify){for(var c=this.editor.mapOffset(a.start),b=this.linkedModeModel,e,f;b;)if(e=this._getPositionChanged(b,c,c+a.removedCharCount),f=e.position,void 0===f||f.model!==b)this.exitLinkedMode(!1),b=this.linkedModeModel;else break;if(b){b=0;a=a.addedCharCount-a.removedCharCount;e=e.positions;for(var g,h=0;h<e.length;++h){g=e[h];f=g.position;var m=f.offset<=c&&c<=f.offset+f.length;m&&!g.ansestor?(f.offset+=b,
f.length+=a,b+=a):(f.offset+=b,g.ansestor&&m&&(f.length+=a));g.escape&&(g.model.escapePosition=f.offset)}this._updateAnnotations(e)}}}.bind(this),onVerify:function(a){if(!this.ignoreVerify){for(var c=this.editor,b=c.mapOffset(a.start),e=this.editor.mapOffset(a.end),f=this.linkedModeModel,g,h;f;)if(g=this._getPositionChanged(f,b,e),h=g.position,void 0===h||h.model!==f)this.exitLinkedMode(!1),f=this.linkedModeModel;else break;if(f){var m=this._compoundChange;m?m.owner.model===f&&m.owner.group===h.group||
(this.endUndo(),this.startUndo()):this.startUndo();f.selectedGroupIndex=h.group;var m=0,k=a.text.length-(e-b);g=g.positions;for(var n,b=b-h.position.offset,l=e-h.position.offset,q=0;q<g.length;++q)n=g[q],e=n.position,n.oldOffset=e.offset,n.model===f&&n.group===h.group?(e.offset+=m,e.length+=k,m+=k):(e.offset+=m,n.ansestor&&(e.length+=h.count*k)),n.escape&&(n.model.escapePosition=e.offset);this.ignoreVerify=!0;for(q=g.length-1;0<=q;q--)n=g[q],n.model===f&&n.group===h.group&&c.setText(a.text,n.oldOffset+
b,n.oldOffset+l);this.ignoreVerify=!1;a.text=null;this._updateAnnotations(g)}}}.bind(this)}}var m={};g.prototype=new q.KeyMode;f.mixin(g.prototype,{createKeyBindings:function(){var b=r.KeyBinding,e=[];e.push({actionID:"linkedModeEnter",keyBinding:new b(13)});e.push({actionID:"linkedModeCancel",keyBinding:new b(27)});e.push({actionID:"linkedModeNextGroup",keyBinding:new b(9)});e.push({actionID:"linkedModePreviousGroup",keyBinding:new b(9,!1,!0)});return e},enterLinkedMode:function(b){if(!this.linkedModeModel){var e=
this.editor.getTextView();e.addKeyMode(this);e.addEventListener("Verify",this.linkedModeListener.onVerify);e.addEventListener("ModelChanged",this.linkedModeListener.onModelChanged);this.contentAssist.addEventListener("Activating",this.linkedModeListener.onActivating);this.editor.reportStatus(n.linkedModeEntered,null,!0)}this._sortedPositions=null;this.linkedModeModel&&(b.previousModel=this.linkedModeModel,b.parentGroup=this.linkedModeModel.selectedGroupIndex,this.linkedModeModel.nextModel=b);this.linkedModeModel=
b;this.selectLinkedGroup(0)},exitLinkedMode:function(b){if(this.isActive()){this._compoundChange&&(this.endUndo(),this._compoundChange=null);this._sortedPositions=null;var e=this.linkedModeModel;this.linkedModeModel=e.previousModel;e.parentGroup=e.previousModel=void 0;this.linkedModeModel&&(this.linkedModeModel.nextModel=void 0);if(!this.linkedModeModel){var a=this.editor,c=a.getTextView();c.removeKeyMode(this);c.removeEventListener("Verify",this.linkedModeListener.onVerify);c.removeEventListener("ModelChanged",
this.linkedModeListener.onModelChanged);c=this.contentAssist;c.removeEventListener("Activating",this.linkedModeListener.onActivating);c.offset=void 0;this.editor.reportStatus(n.linkedModeExited,null,!0);b&&a.setCaretOffset(e.escapePosition,!1)}this.selectLinkedGroup(0)}},startUndo:function(){if(this.undoStack){var b=this,e=this.linkedModeModel;this._compoundChange=this.undoStack.startCompoundChange({model:e,group:e.selectedGroupIndex,end:function(){b._compoundChange=null}})}},endUndo:function(){this.undoStack&&
this.undoStack.endCompoundChange()},isActive:function(){return!!this.linkedModeModel},isStatusActive:function(){return!!this.linkedModeModel},selectLinkedGroup:function(f){var e=this.linkedModeModel;if(e){e.selectedGroupIndex=f;f=e.groups[f];var a=f.positions[0],c=this.editor;c.setSelection(a.offset,a.offset+a.length);if(e=this.contentAssist)e.offset=void 0,f.data&&"link"===f.data.type&&f.data.values?((this._groupContentAssistProvider=new b.TemplateContentAssist(f.data.values)).getPrefix=function(){var b=
c.getSelection();return b.start===b.end&&(b=c.getCaretOffset(),a.offset<=b&&b<=a.offset+a.length)?c.getText(a.offset,b):""},e.offset=a.offset,e.deactivate(),e.activate()):this._groupContentAssistProvider&&(this._groupContentAssistProvider=null,e.deactivate())}this._updateAnnotations()},_getModelPositions:function(b,e,a){for(var c=e.groups,d=0;d<c.length;d++)for(var f=c[d].positions,g=0;g<f.length;g++){var m=f[g];a&&(m={offset:m.offset+a,length:m.length});m={index:g,group:d,count:f.length,model:e,
position:m};b.push(m);e.nextModel&&e.nextModel.parentGroup===d&&(m.ansestor=!0,this._getModelPositions(b,e.nextModel,(a||0)+f[g].offset-f[0].offset))}},_getSortedPositions:function(b){var e=this._sortedPositions;if(!e){for(e=[];b.previousModel;)b=b.previousModel;for(this._getModelPositions(e,b);b;)void 0!==b.escapePosition&&e.push({escape:!0,model:b,position:{offset:b.escapePosition,length:0}}),b=b.nextModel;e.sort(function(a,c){return a.position.offset-c.position.offset});this._sortedPositions=e}return e},
_getPositionChanged:function(b,e,a){var c;b=this._getSortedPositions(b);for(var d=b.length-1;0<=d;d--){var f=b[d].position;if(f.offset<=e&&a<=f.offset+f.length){c=b[d];break}}return{position:c,positions:b}},_updateAnnotations:function(b){var e=this.editor.getAnnotationModel();if(e){var a=[],c=[];e.getTextModel();for(var d=e.getAnnotations(),f;d.hasNext();)switch(f=d.next(),f.type){case k.AnnotationType.ANNOTATION_LINKED_GROUP:case k.AnnotationType.ANNOTATION_CURRENT_LINKED_GROUP:case k.AnnotationType.ANNOTATION_SELECTED_LINKED_GROUP:a.push(f)}if(d=
this.linkedModeModel){b=b||this._getSortedPositions(d);for(var g=0;g<b.length;g++)if(f=b[g],f.model===d){var m=k.AnnotationType.ANNOTATION_LINKED_GROUP;f.group===d.selectedGroupIndex&&(m=0===f.index?k.AnnotationType.ANNOTATION_SELECTED_LINKED_GROUP:k.AnnotationType.ANNOTATION_CURRENT_LINKED_GROUP);f=f.position;f=k.AnnotationType.createAnnotation(m,f.offset,f.offset+f.length,"");c.push(f)}}e.replaceAnnotations(a,c)}}});m.LinkedMode=g;return m});
define("orion/editor/factories","orion/editor/actions orion/editor/undoStack orion/editor/rulers orion/editor/annotations orion/editor/textDND orion/editor/linkedMode".split(" "),function(n,r,q,k,b,f){function g(){}function m(){}function h(){}function e(){}function a(){}function c(){}var d={};g.prototype={createKeyBindings:function(a,c,b,d){d=new n.TextActions(a,c,d);var e=new f.LinkedMode(a,c,b);a=new n.SourceCodeActions(a,c,b,e);return{textActions:d,linkedMode:e,sourceCodeActions:a}}};d.KeyBindingsFactory=
g;m.prototype={createUndoStack:function(a){a=a.getTextView();return new r.UndoStack(a,200)}};d.UndoFactory=m;h.prototype={createLineNumberRuler:function(a){return new q.LineNumberRuler(a,"left",{styleClass:"ruler lines"},{styleClass:"rulerLines odd"},{styleClass:"rulerLines even"})}};d.LineNumberRulerFactory=h;e.prototype={createFoldingRuler:function(a){return new q.FoldingRuler(a,"left",{styleClass:"ruler folding"})}};d.FoldingRulerFactory=e;a.prototype={createAnnotationModel:function(a){return new k.AnnotationModel(a)},
createAnnotationStyler:function(a,c){return new k.AnnotationStyler(a,c)},createAnnotationRulers:function(a){var c=new q.AnnotationRuler(a,"left",{styleClass:"ruler annotations"});a=new q.OverviewRuler(a,"right",{styleClass:"ruler overview"});return{annotationRuler:c,overviewRuler:a}}};d.AnnotationFactory=a;c.prototype={createTextDND:function(a,c){return new b.TextDND(a.getTextView(),c)}};d.TextDNDFactory=c;return d});
define("orion/editor/editorFeatures",["orion/editor/factories","orion/editor/actions","orion/editor/linkedMode","orion/objects"],function(n,r,q,k){return k.mixin({},n,r,q)});
(function(n,r){"function"===typeof define&&define.amd?define("orion/Deferred",r):"object"===typeof exports?module.exports=r():(n.orion=n.orion||{},n.orion.Deferred=r())})(this,function(){function n(){for(var g;g=b.shift();)g();f=!1}function r(m){b.push(m);f||(f=!0,g())}function q(b){return function(f){b(f)}}function k(){function b(){for(var a;a=g.shift();){var e=a.deferred,f="fulfilled"===d?"resolve":"reject";a=a[f];if("function"===typeof a)try{var h=a(c),p=h&&("object"===typeof h||"function"===typeof h)&&
h.then;if("function"===typeof p)if(h===e.promise)e.reject(new TypeError);else{var m=h.cancel;"function"===typeof m?e._parentCancel=m.bind(h):delete e._parentCancel;p.call(h,q(e.resolve),q(e.reject),q(e.progress))}else e.resolve(h)}catch(k){e.reject(k)}else e[f](c)}}function f(a){delete p._parentCancel;d="rejected";c=a;g.length&&r(b)}function e(a){function n(a){return function(c){(!d||"assumed"===d)&&a(c)}}delete p._parentCancel;try{var q=a&&("object"===typeof a||"function"===typeof a)&&a.then;if("function"===
typeof q)if(a===p)f(new TypeError);else{d="assumed";var y=a&&a.cancel;if("function"!==typeof y){var A=new k;a=A.promise;try{q(A.resolve,A.reject,A.progress)}catch(w){A.reject(w)}y=a.cancel;q=a.then}c=a;q.call(a,n(e),n(f));p._parentCancel=y.bind(a)}else d="fulfilled",c=a,g.length&&r(b)}catch(B){n(f)(B)}}function a(){var a=p._parentCancel;a?(delete p._parentCancel,a()):d||(a=Error("Cancel"),a.name="Cancel",f(a))}var c,d,g=[],p=this;this.resolve=function(a){d||e(a);return p};this.reject=function(a){d||
f(a);return p};this.progress=function(a){d||g.forEach(function(c){if(c.progress)try{c.progress(a)}catch(b){}});return p.promise};this.cancel=function(){p._parentCancel?setTimeout(a,0):a();return p};this.then=function(a,c,e){var f=new k;f._parentCancel=p.promise.cancel;g.push({resolve:a,reject:c,progress:e,deferred:f});("fulfilled"===d||"rejected"===d)&&r(b);return f.promise};this.promise={then:p.then,cancel:p.cancel}}var b=[],f=!1,g=function(){if("undefined"!==typeof process&&"function"===typeof process.nextTick){var b=
process.nextTick;return function(){b(n)}}if("function"===typeof MutationObserver){var f=document.createElement("div");(new MutationObserver(n)).observe(f,{attributes:!0});return function(){f.setAttribute("class","_tick")}}return function(){setTimeout(n,0)}}();k.all=function(b,f){function e(a,b){g||(d[a]=b,0===--c&&p.resolve(d))}function a(a,c){if(!g){if(f)try{e(a,f(c));return}catch(b){c=b}p.reject(c)}}var c=b.length,d=[],g=!1,p=new k;p.then(void 0,function(){g=!0;b.forEach(function(a){a.cancel&&a.cancel()})});
0===c?p.resolve(d):b.forEach(function(c,b){c.then(e.bind(void 0,b),a.bind(void 0,b))});return p.promise};k.when=function(b,f,e,a){var c;b&&"function"===typeof b.then||(c=new k,c.resolve(b),b=c.promise);return b.then(f,e,a)};return k});
define("orion/webui/littlelib",["orion/util"],function(n){function r(b,e){e||(e=document);return e.querySelectorAll(b)}function q(b){var e=b.tabIndex;0===e&&n.isIE&&!{a:!0,body:!0,button:!0,frame:!0,iframe:!0,img:!0,input:!0,isindex:!0,object:!0,select:!0,textarea:!0}[b.nodeName.toLowerCase()]&&!b.attributes.tabIndex&&(e=-1);return e}function k(b){if(0<=q(b))return b;if(b.hasChildNodes())for(var e=0;e<b.childNodes.length;e++){var a=k(b.childNodes[e]);if(a)return a}return null}function b(f){if(0<=
q(f))return f;if(f.hasChildNodes())for(var e=f.childNodes.length-1;0<=e;e--){var a=b(f.childNodes[e]);if(a)return a}return null}function f(b,e){if(3===b.nodeType){var a=g.exec(b.nodeValue);a&&1<a.length&&e(b,a)}if(b.hasChildNodes())for(a=0;a<b.childNodes.length;a++)f(b.childNodes[a],e)}var g=/\$\{([^\}]+)\}/,m=null;return{$:function(b,e){e||(e=document);return e.querySelector(b)},$$:r,$$array:function(b,e){return Array.prototype.slice.call(r(b,e))},node:function(b){var e=b;"string"===typeof b&&(e=
document.getElementById(b));return e},contains:function(b,e){if(!b||!e)return!1;if(b===e)return!0;var a=b.compareDocumentPosition(e);return Boolean(a&16)},bounds:function(b){b=b.getBoundingClientRect();return{left:b.left+document.documentElement.scrollLeft,top:b.top+document.documentElement.scrollTop,width:b.width,height:b.height}},empty:function(b){for(;b.hasChildNodes();)b.removeChild(b.firstChild)},firstTabbable:k,lastTabbable:b,stop:function(b){window.document.all&&(b.keyCode=0);b.preventDefault&&
(b.preventDefault(),b.stopPropagation())},processTextNodes:function(b,e){f(b,function(a,c){a.parentNode.replaceChild(document.createTextNode(e[c[1]]||c[1]),a)})},processDOMNodes:function(b,e){f(b,function(a,c){var b=e[c[1]];if(b){var f=document.createRange(),g=c.index;f.setStart(a,g);f.setEnd(a,g+c[0].length);f.deleteContents();f.insertNode(b)}})},addAutoDismiss:function(b,e){function a(a){m.forEach(function(b){var e=!1,f=b.excludeNodes.some(function(b){return document.body.contains(b)?(e=!0,b.contains(a.target)):
!1});if(e&&!f)try{b.dismiss(a)}catch(g){"undefined"!==typeof console&&console&&console.error(g&&g.message)}});m=m.filter(function(a){return a.excludeNodes.some(function(a){return document.body.contains(a)})})}null===m&&(m=[],document.addEventListener("click",a,!0),n.isIOS&&document.addEventListener("touchend",function(a){function b(){a.target.removeEventListener("click",b)}0===a.touches.length&&a.target.addEventListener("click",b)},!1));m.push({excludeNodes:b,dismiss:e})},setFramesEnabled:function(b){for(var e=
document.getElementsByTagName("iframe"),a=0;a<e.length;a++)e[a].parentNode.style.pointerEvents=b?"":"none"},removeAutoDismiss:function(b){m=m.filter(function(e){return b!==e.dismiss})},KEY:{BKSPC:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DEL:46}}});
define("orion/editor/contentAssist","i18n!orion/editor/nls/messages orion/keyBinding orion/editor/keyModes orion/editor/eventTarget orion/Deferred orion/objects orion/editor/util orion/util orion/webui/littlelib".split(" "),function(n,r,q,k,b,f,g,m,h){function e(a){this.textView=a;this.state=d.INACTIVE;this.resetProviderInfoArray();var c=this;this.contentAssistListener={onModelChanging:function(a){this._latestModelChangingEvent=a}.bind(this),onSelection:function(a){this.isDeactivatingChange(this._latestModelChangingEvent,
a)?this.setState(d.INACTIVE):this.isActive()&&(this.state===d.ACTIVE&&this.setState(d.FILTERING),this.filterProposals(a));this._latestModelChangingEvent=null}.bind(this),onScroll:function(a){this.setState(d.INACTIVE)}.bind(this)};a.setKeyBinding(m.isMac?new r.KeyBinding(" ",!1,!1,!1,!0):new r.KeyBinding(" ",!0),"contentAssist");a.setKeyBinding(m.isMac?new r.KeyBinding(" ",!1,!1,!0,!0):new r.KeyBinding(" ",!0,!1,!0),"contentAssist");a.setAction("contentAssist",function(){a.getOptions("readonly")||
c.activate();return!0},{name:n.contentAssist})}function a(a,c){var b=a.textView;q.KeyMode.call(this,b);this.contentAssist=a;this.widget=c;this.proposals=[];var d=this;this.contentAssist.addEventListener("ProposalsComputed",function(a){d.proposals=a.data.proposals;if(0===d.proposals.length)d.selectedIndex=-1,d.cancel();else{for(d.selectedIndex=0;d.proposals[d.selectedIndex]&&d.proposals[d.selectedIndex].unselectable;)d.selectedIndex++;if(d.proposals[d.selectedIndex]){if(d.widget){var c=!0;if(a.autoApply){for(a=
d.selectedIndex+1;d.proposals[a]&&d.proposals[a].unselectable;)a++;d.proposals[a]||(c=!1,d.contentAssist.apply(d.proposals[d.selectedIndex]))}c&&(d.widget.show(),d.widget.selectNode(d.selectedIndex))}}else d.selectedIndex=-1,d.cancel()}});b.setAction("contentAssistApply",function(){return this.enter()}.bind(this));b.setAction("contentAssistCancel",function(){return this.cancel()}.bind(this));b.setAction("contentAssistNextProposal",function(){return this.lineDown()}.bind(this));b.setAction("contentAssistPreviousProposal",
function(){return this.lineUp()}.bind(this));b.setAction("contentAssistNextPage",function(){return this.pageDown()}.bind(this));b.setAction("contentAssistPreviousPage",function(){return this.pageUp()}.bind(this));b.setAction("contentAssistHome",function(){this.widget&&this.widget.scrollIndex(0,!0);return this.lineDown(0)}.bind(this));b.setAction("contentAssistEnd",function(){return this.lineUp(this.proposals.length-1)}.bind(this));b.setAction("contentAssistTab",function(){return this.tab()}.bind(this));
this.widget&&(this.widget.setContentAssistMode(this),this.widget.createAccessible())}function c(a,c){this.contentAssist=a;this.textView=this.contentAssist.getTextView();this.isShowing=this.textViewListenerAdded=!1;var b=this.textView.getOptions("parent").ownerDocument;this.parentNode="string"===typeof c?b.getElementById(c):c;if(!this.parentNode){this.parentNode=m.createElement(b,"div");this.parentNode.className="contentassist";var d=b.getElementsByTagName("body")[0];if(d)d.appendChild(this.parentNode);
else throw Error("parentNode is required");}this.parentNode.addEventListener("scroll",this.onScroll.bind(this));var e=this;this.textViewListener={onMouseDown:function(a){(a.event.target||a.event.srcElement).parentElement!==e.parentNode&&e.contentAssist.deactivate()}};this.contentAssist.addEventListener("Deactivating",function(a){e.hide()});this.scrollListener=function(a){e.isShowing&&e.position()};g.addEventListener(b,"scroll",this.scrollListener)}var d={INACTIVE:1,ACTIVE:2,FILTERING:3},s={selected:"selected",
hr:"proposal-hr",emphasis:"proposal-emphasis",noemphasis:"proposal-noemphasis",noemphasis_keyword:"proposal-noemphasis-keyword",noemphasis_title:"proposal-noemphasis-title",noemphasis_title_keywords:"proposal-noemphasis-title-keywords",dfault:"proposal-default"};e.prototype={apply:function(a){if(!a)return!1;var c=this.textView,b=c.getSelection(),e=this._initialCaretOffset,f=e,g=b=Math.max(b.start,b.end),m=c.getModel();m.getBaseModel&&(f=m.mapOffset(f),g=m.mapOffset(g),m=m.getBaseModel());a.overwrite&&
(e=this.getPrefixStart(m,f));f={proposal:a,start:f,end:g};this.setState(d.INACTIVE);c.setText("string"===typeof a?a:a.proposal,e,b);this.dispatchEvent({type:"ProposalApplied",data:f});return!0},activate:function(a,c){this.state===d.INACTIVE&&(this._autoTriggered=c?!0:!1,this.setState(d.ACTIVE,a))},deactivate:function(){this.setState(d.INACTIVE)},getTextView:function(){return this.textView},isActive:function(){return this.state===d.ACTIVE||this.state===d.FILTERING},isDeactivatingChange:function(a,
c){var b=!1;c.newValue.start<this._initialCaretOffset?b=!0:a&&(b=0<a.removedLineCount||0<a.addedLineCount);return b},setState:function(a,c){var b;a===d.ACTIVE?(this._filterText="",b="Activating",this._mode&&this._mode.setActive(!0)):a===d.INACTIVE&&(b="Deactivating",this._mode&&this._mode.setActive(!1),this._initialCaretOffset=-1,this._filterText="");b&&this.dispatchEvent({type:b,providerInfoArray:c});this.state=a;this.onStateChange(a)},setMode:function(a){this._mode=a},onStateChange:function(a){a===
d.INACTIVE?this.listenerAdded&&(this._latestModelChangingEvent=null,this.textView.removeEventListener("ModelChanging",this.contentAssistListener.onModelChanging),this.textView.removeEventListener("Scroll",this.contentAssistListener.onScroll),this.textView.removeEventListener("Selection",this.contentAssistListener.onSelection),this.listenerAdded=!1):a===d.ACTIVE&&(this.listenerAdded||(this.textView.addEventListener("ModelChanging",this.contentAssistListener.onModelChanging),this.textView.addEventListener("Scroll",
this.contentAssistListener.onScroll),this.textView.addEventListener("Selection",this.contentAssistListener.onSelection),this.listenerAdded=!0),this.computeProposals())},computeProposals:function(){var a=this,c=this.textView.getCaretOffset(),b=this.textView.getSelection(),b=Math.min(b.start,b.end);this._initialCaretOffset=Math.min(c,b);this._computeProposals(this._initialCaretOffset).then(function(c){a._computedProposals=c;a.isActive()&&(c=a._flatten(c),a.dispatchEvent({type:"ProposalsComputed",data:{proposals:c},
autoApply:!a._autoTriggered}))})},getPrefixStart:function(a,c){for(var b=c;0<b&&/[A-Za-z0-9_]/.test(a.getText(b-1,b));)b--;return b},handleError:function(a){"undefined"!==typeof console&&(console.log("Error retrieving content assist proposals"),console.log(a&&a.stack))},_computeProposals:function(a){var c=this._providerInfoArray,d=this.textView,e=d.getSelection(),g=d.getModel(),m=a;g.getBaseModel&&(m=g.mapOffset(m),e.start=g.mapOffset(e.start),e.end=g.mapOffset(e.end),g=g.getBaseModel());a=g.getLine(g.getLineAtOffset(m));
for(var h=0;h<a.length&&/\s/.test(a.charAt(h));)h++;var h=a.substring(0,h),d=d.getOptions("tabSize","expandTab"),d=d.expandTab?Array(d.tabSize+1).join(" "):"\t",k={line:a,offset:m,prefix:g.getText(this.getPrefixStart(g,m),m),selection:e,delimiter:g.getLineDelimiter(),tab:d,indentation:h},l=this,c=c.map(function(a){a=a.provider;var c;try{var d,e;if(d=a.computeContentAssist){var h=l.editorContextProvider,p=h.getEditorContext();k=f.mixin(k,h.getOptions());e=d.apply(a,[p,k])}else if(d=a.getProposals||
a.computeProposals)e=d.apply(a,[g.getText(),m,k]);c=l.progress?l.progress.progress(e,"Generating content assist proposal"):e}catch(n){l.handleError(n)}return b.when(c)});return b.all(c,this.handleError)},filterProposals:function(a){a="";var c=0;if(this._latestModelChangingEvent){a=this._latestModelChangingEvent.text;if(c=this._latestModelChangingEvent.removedCharCount)this._filterText=this._filterText.substring(0,this._filterText.length-c);a&&(this._filterText=this._filterText.concat(a));a=this.textView.getModel();
a.getBaseModel&&(a=a.getBaseModel());a=this.getPrefixStart(a,this._initialCaretOffset);var b=this.textView.getText(a,this._initialCaretOffset),d=[];this._computedProposals.forEach(function(a){a=a.filter(function(a){if(s[a.style]===s.hr||s[a.style]===s.noemphasis_title)return!0;var c="";if(a.overwrite){if(a.name)c=a.name;else if(a.proposal)c=a.proposal;else return!1;return 0===c.indexOf(b+this._filterText)}return a.name||a.proposal?(c=!1,a.name&&(c=0===a.name.indexOf(b+this._filterText)),!c&&a.proposal&&
(c=0===a.proposal.indexOf(this._filterText)),c):"string"===typeof a?0===a.indexOf(this._filterText):!1},this);0<a.length&&d.push(a)},this);d=this._removeExtraUnselectableElements(d);a=this._flatten(d);this.dispatchEvent({type:"ProposalsComputed",data:{proposals:a},autoApply:!1})}},_removeExtraUnselectableElements:function(a){return a.map(function(a){return a.filter(function(c,b){var d=!0;if(s[c.style]===s.hr)0===b||a.length-1===b?d=!1:s.hr===s[a[b-1].style]&&(d=!1);else if(s[c.style]===s.noemphasis_title){var e=
a[b+1];e?s[e.style]===s.noemphasis_title&&(d=!1):d=!1}return d})})},setEditorContextProvider:function(a){this.editorContextProvider=a},_generateProviderId:function(){this._uniqueProviderIdCounter?this._uniqueProviderIdCounter++:this._uniqueProviderIdCounter=0;return"ContentAssistGeneratedID_"+this._uniqueProviderIdCounter},setAutoTriggerEnabled:function(a){this._autoTriggerEnabled=a;this._updateAutoTriggerListenerState()},setProviders:function(a){a=a.map(function(a){return{provider:a,id:this._generateProviderId()}},
this);this.setProviderInfoArray(a)},setProviderInfoArray:function(a){this.resetProviderInfoArray();this._providerInfoArray=a;this._charTriggersInstalled=a.some(function(a){return a.charTriggers});this._updateAutoTriggerListenerState()},resetProviderInfoArray:function(){this._providerInfoArray=[];this._charTriggersInstalled=!1;this._updateAutoTriggerListenerState()},setProgress:function(a){this.progress=a},setStyleAccessor:function(a){this._styleAccessor=a},_flatten:function(a){return a.reduce(function(a,
c){var b=a;if(Array.isArray(c)&&0<c.length){var b=c,d=a;c[0].style&&0===s[c[0].style].indexOf(s.noemphasis)&&(b=a,d=c);0<b.length&&b[b.length-1].style&&s.hr!==s[b[b.length-1].style]&&(b=b.concat({proposal:"",name:"",description:"---------------------------------",style:"hr",unselectable:!0}));b=b.concat(d)}return b},[])},_triggerListener:function(a){if(this._styleAccessor){var c=this.textView.getCaretOffset(),b=null,d=[];if(this._charTriggersInstalled){var e=this.textView.getText(c-1,c);this._providerInfoArray.forEach(function(a){var f=
a.charTriggers;if(f&&f.test(e)){var f=!1,g=a.excludedStyles;g&&(b||(b=this._styleAccessor.getStyles(c-1)),f=b.some(function(a){return g.test(a.style)}));f||d.push(a)}},this);0<d.length&&this.activate(d,!0)}}},_updateAutoTriggerListenerState:function(){this._boundTriggerListener||(this._boundTriggerListener=this._triggerListener.bind(this));if(this._triggerListenerInstalled){if(!this._autoTriggerEnabled||!this._charTriggersInstalled)this.textView.removeEventListener("Modify",this._boundTriggerListener),
this._triggerListenerInstalled=!1}else this._autoTriggerEnabled&&this._charTriggersInstalled&&(this.textView.addEventListener("Modify",this._boundTriggerListener),this._triggerListenerInstalled=!0)}};k.EventTarget.addMixin(e.prototype);a.prototype=new q.KeyMode;f.mixin(a.prototype,{createKeyBindings:function(){var a=r.KeyBinding,c=[];c.push({actionID:"contentAssistApply",keyBinding:new a(13)});c.push({actionID:"contentAssistCancel",keyBinding:new a(27)});c.push({actionID:"contentAssistNextProposal",
keyBinding:new a(40)});c.push({actionID:"contentAssistPreviousProposal",keyBinding:new a(38)});c.push({actionID:"contentAssistNextPage",keyBinding:new a(34)});c.push({actionID:"contentAssistPreviousPage",keyBinding:new a(33)});c.push({actionID:"contentAssistHome",keyBinding:new a(h.KEY.HOME)});c.push({actionID:"contentAssistEnd",keyBinding:new a(h.KEY.END)});c.push({actionID:"contentAssistTab",keyBinding:new a(9)});return c},cancel:function(){this.getContentAssist().deactivate()},getContentAssist:function(){return this.contentAssist},
getProposals:function(){return this.proposals},isActive:function(){return this.getContentAssist().isActive()},setActive:function(a){a?this.contentAssist.textView.addKeyMode(this):this.contentAssist.textView.removeKeyMode(this)},lineUp:function(a,c){return this.selectNew(a,c,!1)},lineDown:function(a,c){return this.selectNew(a,c,!0)},selectNew:function(a,c,b){if(b){if(void 0===a&&(a=this.selectedIndex+1),a>=this.proposals.length){if(c)return!0;a=0}}else if(void 0===a&&(a=this.selectedIndex-1),0>a){if(c)return!0;
a=this.proposals.length-1}for(var d=a;this.proposals[a]&&this.proposals[a].unselectable;){if(b){if(a++,a>=this.proposals.length){if(c)return!0;a=0}}else if(a--,0>a){if(c)return!0;a=this.proposals.length-1}if(a===d){a=-1;break}}this.selectedIndex=a;this.widget&&this.widget.selectNode(a);return!0},pageUp:function(){if(this.widget){var a=this.widget.getTopIndex();a===this.selectedIndex&&(this.widget.scrollIndex(a,!1),a=this.widget.getTopIndex());return 0===a?this.lineDown(a,!0):this.lineUp(a,!0)}return this.lineUp()},
pageDown:function(){if(this.widget){var a=this.widget.getBottomIndex();a===this.selectedIndex&&(this.widget.scrollIndex(a,!0),a=this.widget.getBottomIndex());return this.lineDown(a,!0)}return this.lineDown()},enter:function(){return this.contentAssist.apply(this.proposals[this.selectedIndex]||null)},tab:function(){return this.widget?(this.widget.parentNode.focus(),!0):!1}});c.prototype={onClick:function(a){a||(a=window.event);this.contentAssist.apply(this.getProposal(a.target||a.srcElement));this.textView.focus()},
onScroll:function(a){this.previousCloneNode&&!this.preserveCloneThroughScroll&&(this._removeCloneNode(),this.previousSelectedNode.classList.add(s.selected));this.preserveCloneThroughScroll=!1},createDiv:function(a,c,b){var d=c.ownerDocument,e=m.createElement(d,"div");e.id="contentoption"+b;e.setAttribute("role","option");e.className=s[a.style]?s[a.style]:s.dfault;"hr"===a.style?a=m.createElement(d,"hr"):(a=this._createDisplayNode(e,a,b),e.contentAssistProposalIndex=b);e.appendChild(a);c.appendChild(e)},
createAccessible:function(){var a=this._contentAssistMode,c=this;this.parentNode.addEventListener("keydown",function(b){b||(b=window.event);b.preventDefault&&b.preventDefault();return b.keyCode===h.KEY.ESCAPE?a.cancel():b.keyCode===h.KEY.UP?a.lineUp():b.keyCode===h.KEY.DOWN?a.lineDown():b.keyCode===h.KEY.ENTER?a.enter():b.keyCode===h.KEY.PAGEDOWN?a.pageDown():b.keyCode===h.KEY.PAGEUP?a.pageUp():b.keyCode===h.KEY.HOME?(c.scrollIndex(0,!0),a.lineDown(0)):b.keyCode===h.KEY.END?a.lineUp(a.getProposals().length-
1):!1})},_createDisplayNode:function(a,c,b){var d=null,e=null;if("string"===typeof c)e=c;else if(c.description&&"string"===typeof c.description)if(c.name&&"string"===typeof c.name){var f=this._createNameNode(c.name);f.contentAssistProposalIndex=b;d=document.createElement("span");d.appendChild(f);f=document.createTextNode(c.description);d.appendChild(f);a.setAttribute("title",c.name+c.description)}else e=c.description;else e=c.proposal;e&&(d=this._createNameNode(e),a.setAttribute("title",e));d.contentAssistProposalIndex=
b;return d},_createNameNode:function(a){var c=document.createElement("span");c.classList.add("proposal-name");c.appendChild(document.createTextNode(a));return c},getProposal:function(a){var c=null;a=a.contentAssistProposalIndex;void 0!==a&&(c=this._contentAssistMode.getProposals()[a]||null);return c},getTopIndex:function(){for(var a=this.parentNode.childNodes,c=0;c<a.length;c++)if(a[c].offsetTop>=this.parentNode.scrollTop)return c;return 0},getBottomIndex:function(){for(var a=this.parentNode.childNodes,
c=0;c<a.length;c++){var b=a[c];if(b.offsetTop+b.offsetHeight>this.parentNode.scrollTop+this.parentNode.clientHeight)return Math.max(0,c-1)}return a.length-1},scrollIndex:function(a,c){this.parentNode.childNodes[a].scrollIntoView(c);this.preserveCloneThroughScroll=!0},selectNode:function(a){var c=null;this.previousSelectedNode&&(this.previousSelectedNode.classList.remove(s.selected),this.previousSelectedNode=null,this.previousCloneNode&&this._removeCloneNode());if(-1!==a){c=this.parentNode.childNodes[a];
c.classList.add(s.selected);this.parentNode.setAttribute("aria-activedescendant",c.id);c.focus();c.offsetTop<this.parentNode.scrollTop?(c.scrollIntoView(!0),this.preserveCloneThroughScroll=!0):c.offsetTop+c.offsetHeight>this.parentNode.scrollTop+this.parentNode.clientHeight&&(c.scrollIntoView(!1),this.preserveCloneThroughScroll=!0);var b=h.bounds(c.firstChild||c),d=h.bounds(this.parentNode);a=window.getComputedStyle(this.parentNode);var e=window.getComputedStyle(c),e=parseInt(a.paddingLeft)+parseInt(a.paddingRight)+
parseInt(e.paddingLeft)+parseInt(e.paddingRight);if(b.width>=d.width-e){e=parseInt(a.top);d=c.cloneNode(!0);d.classList.add("cloneProposal");d.style.top=e+c.offsetTop-this.parentNode.scrollTop+"px";d.style.left=a.left;d.setAttribute("id",d.id+"_clone");b=b.left+b.width-parseInt(document.documentElement.clientWidth);0<b&&(a=parseInt(a.left)-b,0>a&&(a=0),d.style.left=a+"px");a=document.createElement("div");a.id="clone_contentassist";a.classList.add("contentassist");a.classList.add("cloneWrapper");a.appendChild(d);
a.onclick=this.parentNode.onclick;this.parentNode.parentNode.insertBefore(a,this.parentNode);var f=function(a){a.contentAssistProposalIndex=c.contentAssistProposalIndex;if(a.hasChildNodes())for(var b=0;b<a.childNodes.length;b++)f(a.childNodes[b])};f(a);c.classList.remove(s.selected);this.previousCloneNode=a}}this.previousSelectedNode=c},setContentAssistMode:function(a){this._contentAssistMode=a},show:function(){var a=this._contentAssistMode.getProposals();if(0===a.length)this.hide();else{this.parentNode.innerHTML=
"";for(var c=0;c<a.length;c++)this.createDiv(a[c],this.parentNode,c);this.position();this.parentNode.onclick=this.onClick.bind(this);this.isShowing=!0;this.textViewListenerAdded||(this.textView.addEventListener("MouseDown",this.textViewListener.onMouseDown),this.textViewListenerAdded=!0)}},hide:function(){this.parentNode.ownerDocument.activeElement===this.parentNode&&this.textView.focus();this.parentNode.style.display="none";this.parentNode.onclick=null;this.isShowing=!1;this.textViewListenerAdded&&
(this.textView.removeEventListener("MouseDown",this.textViewListener.onMouseDown),this.textViewListenerAdded=!1);this.previousSelectedNode&&(this.previousSelectedNode=null,this.previousCloneNode&&this._removeCloneNode())},position:function(){var a=this.contentAssist,c=this.textView;if(void 0!==a.offset){var a=a.offset,b=c.getModel();b.getBaseModel&&(a=b.mapOffset(a,!0))}else a=this.textView.getCaretOffset();a=c.getLocationAtOffset(a);a.y+=c.getLineHeight();this.textView.convert(a,"document","page");
this.parentNode.style.position="fixed";this.parentNode.style.left=a.x+"px";this.parentNode.style.top=a.y+"px";this.parentNode.style.display="block";this.parentNode.scrollTop=0;c=this.parentNode.ownerDocument;b=c.documentElement.clientWidth;a.y+this.parentNode.offsetHeight>c.documentElement.clientHeight&&(this.parentNode.style.top=a.y-this.parentNode.offsetHeight-this.textView.getLineHeight()+"px");a.x+this.parentNode.offsetWidth>b&&(this.parentNode.style.left=b-this.parentNode.offsetWidth+"px")},
_removeCloneNode:function(){this.parentNode.parentNode.contains(this.previousCloneNode)&&this.parentNode.parentNode.removeChild(this.previousCloneNode);this.previousCloneNode=null}};return{ContentAssist:e,ContentAssistMode:a,ContentAssistWidget:c}});
define("orion/editor/stylers/lib/syntax",[],function(){return{id:"orion.lib",grammars:[{id:"orion.lib",repository:{brace_open:{match:"{",name:"punctuation.section.block.begin"},brace_close:{match:"}",name:"punctuation.section.block.end"},bracket_open:{match:"\\[",name:"punctuation.section.bracket.begin"},bracket_close:{match:"\\]",name:"punctuation.section.bracket.end"},parenthesis_open:{match:"\\(",name:"punctuation.section.parens.begin"},parenthesis_close:{match:"\\)",name:"punctuation.section.parens.end"},
doc_block:{begin:{match:"/\\*\\*",literal:"/**"},end:{match:"\\*/",literal:"*/"},name:"comment.block.documentation",patterns:[{match:"@(?:(?!\\*/)\\S)*",name:"keyword.other.documentation.tag"},{match:"\\\x3c\\S*\\\x3e",name:"keyword.other.documentation.markup"},{match:"(\\b)(TODO)(\\b)(((?!\\*/).)*)",name:"meta.annotation.task.todo",captures:{2:{name:"keyword.other.documentation.task"},4:{name:"comment.block"}}}]},number_decimal:{match:"\\b-?(?:\\.\\d+|\\d+\\.?\\d*)(?:[eE][+-]?\\d+)?\\b",name:"constant.numeric.number"},
number_hex:{match:"\\b0[xX][0-9A-Fa-f]+\\b",name:"constant.numeric.hex"},string_doubleQuote:{match:'"(?:\\\\.|[^"])*"?',name:"string.quoted.double"},string_singleQuote:{match:"'(?:\\\\.|[^'])*'?",name:"string.quoted.single"},todo_comment_singleLine:{match:"(\\b)(TODO)(\\b)(.*)",name:"meta.annotation.task.todo",captures:{2:{name:"keyword.other.documentation.task"},4:{name:"comment.line"}}}}},{id:"orion.c-like",repository:{comment_singleLine:{match:{match:"//.*",literal:"//"},name:"comment.line.double-slash",
patterns:[{include:"orion.lib#todo_comment_singleLine"}]},comment_block:{begin:{match:"/\\*",literal:"/*"},end:{match:"\\*/",literal:"*/"},name:"comment.block",patterns:[{match:"(\\b)(TODO)(\\b)(((?!\\*/).)*)",name:"meta.annotation.task.todo",captures:{2:{name:"keyword.other.documentation.task"},4:{name:"comment.block"}}}]}}}],keywords:[]}});
define("orion/editor/stylers/text_css/syntax",["orion/editor/stylers/lib/syntax"],function(n){var r="alignment-adjust alignment-baseline animation-delay animation-direction animation-duration animation-iteration-count animation-name animation-play-state animation-timing-function animation appearance azimuth backface-visibility background-attachment background-clip background-color background-image background-origin background-position background-repeat background-size background baseline-shift binding bleed bookmark-label bookmark-level bookmark-state bookmark-target border-bottom-color border-bottom-left-radius border-bottom-right-radius border-bottom-style border-bottom-width border-bottom border-collapse border-color border-image-outset border-image-repeat border-image-slice border-image-source border-image-width border-image border-left-color border-left-style border-left-width border-left border-radius border-right-color border-right-style border-right-width border-right border-spacing border-style border-top-color border-top-left-radius border-top-right-radius border-top-style border-top-width border-top border-width border bottom box-align box-decoration-break box-direction box-flex-group box-flex box-lines box-ordinal-group box-orient box-pack box-shadow box-sizing break-after break-before break-inside caption-side clear clip color-profile color column-count column-fill column-gap column-rule-color column-rule-style column-rule-width column-rule column-span column-width columns content counter-increment counter-reset crop cue-after cue-before cue cursor direction display dominant-baseline drop-initial-after-adjust drop-initial-after-align drop-initial-before-adjust drop-initial-before-align drop-initial-size drop-initial-value elevation empty-cells fit-position fit flex-align flex-flow flex-inline-pack flex-order flex-pack float-offset float font-family font-size font-size-adjust font-stretch font-style font-variant font-weight font grid-columns grid-rows hanging-punctuation height hyphenate-after hyphenate-before hyphenate-character hyphenate-lines hyphenate-resource hyphens icon image-orientation image-rendering image-resolution inline-box-align left letter-spacing line-height line-stacking-ruby line-stacking-shift line-stacking-strategy line-stacking list-style-image list-style-position list-style-type list-style margin-bottom margin-left margin-right margin-top margin mark-after mark-before mark marker-offset marks marquee-direction marquee-loop marquee-play-count marquee-speed marquee-style max-height max-width min-height min-width move-to nav-down nav-index nav-left nav-right nav-up opacity orphans outline-color outline-offset outline-style outline-width outline overflow-style overflow-x overflow-y overflow padding-bottom padding-left padding-right padding-top padding page-break-after page-break-before page-break-inside page-policy page pause-after pause-before pause perspective-origin perspective phonemes pitch-range pitch play-during position presentation-level punctuation-trim quotes rendering-intent resize rest-after rest-before rest richness right rotation-point rotation ruby-align ruby-overhang ruby-position ruby-span size speak-header speak-numeral speak-punctuation speak speech-rate stress string-set table-layout target-name target-new target-position target text-align-last text-align text-decoration text-emphasis text-height text-indent text-justify text-outline text-shadow text-transform text-wrap top transform-origin transform-style transform transition-delay transition-duration transition-property transition-timing-function transition unicode-bidi vertical-align visibility voice-balance voice-duration voice-family voice-pitch-range voice-pitch voice-rate voice-stress voice-volume volume white-space-collapse white-space widows width word-break word-spacing word-wrap z-index".split(" ");n=
n.grammars;n.push({id:"orion.css",contentTypes:["text/css"],patterns:[{begin:"'(?:\\\\.|[^\\\\'])*\\\\$",end:"^(?:$|(?:\\\\.|[^\\\\'])*('|[^\\\\]$))",name:"string.quoted.single.css"},{begin:'"(?:\\\\.|[^\\\\"])*\\\\$',end:'^(?:$|(?:\\\\.|[^\\\\"])*("|[^\\\\]$))',name:"string.quoted.double.css"},{include:"orion.lib#string_doubleQuote"},{include:"orion.lib#string_singleQuote"},{include:"orion.c-like#comment_block"},{include:"orion.lib#brace_open"},{include:"orion.lib#brace_close"},{include:"orion.lib#bracket_open"},
{include:"orion.lib#bracket_close"},{include:"orion.lib#parenthesis_open"},{include:"orion.lib#parenthesis_close"},{include:"orion.lib#number_decimal"},{include:"#number_hex"},{match:"(?i)\\b-?(?:\\.\\d+|\\d+\\.?\\d*)(?:%|em|ex|ch|rem|vw|vh|vmin|vmax|in|cm|mm|pt|pc|px|deg|grad|rad|turn|s|ms|Hz|kHz|dpi|dpcm|dppx)?\\b",name:"constant.numeric.value.css"},{match:"(?:-webkit-|-moz-|-ms-|\\b)(?:"+r.join("|")+")\\b",name:"keyword.control.css"}],repository:{number_hex:{match:"#[0-9A-Fa-f]+\\b",name:"constant.numeric.hex.css"}}});
return{id:n[n.length-1].id,grammars:n,keywords:r}});
define("orion/editor/cssContentAssist",["orion/editor/templates","orion/editor/stylers/text_css/syntax"],function(n,r){function q(a){return JSON.stringify(a).replace("}","\\}")}function k(){}for(var b={type:"link",values:"visible hidden scroll auto no-display no-content".split(" ")},f={type:"link",values:"solid dashed dotted double groove ridge inset outset".split(" ")},g={type:"link",values:[]},m=0;10>m;m++)g.values.push(m.toString());for(var h={type:"link",values:"black white red green blue magenta yellow cyan grey darkred darkgreen darkblue darkmagenta darkcyan darkyellow darkgray lightgray".split(" ")},
e=[{prefix:"rule",description:"rule - class selector rule",template:".${class} {\n\t${cursor}\n}"},{prefix:"rule",description:"rule - id selector rule",template:"#${id} {\n\t${cursor}\n}"},{prefix:"outline",description:"outline - outline style",template:"outline: ${color:"+q(h)+"} ${style:"+q(f)+"} ${width:"+q(g)+"}px;"},{prefix:"background-image",description:"background-image - image style",template:'background-image: url("${uri}");'},{prefix:"url",description:"url - url image",template:'url("${uri}");'},
{prefix:"rgb",description:"rgb - rgb color",template:"rgb(${red},${green},${blue});"},{prefix:"@",description:"import - import style sheet",template:'@import "${uri}";'}],a=[{prop:"display",values:{type:"link",values:"none block box flex inline inline-block inline-flex inline-table list-item table table-caption table-cell table-column table-column-group table-footer-group table-header-group table-row table-row-group inherit".split(" ")}},{prop:"overflow",values:b},{prop:"overflow-x",values:b},{prop:"overflow-y",
values:b},{prop:"float",values:{type:"link",values:["left","right","none","inherit"]}},{prop:"position",values:{type:"link",values:["absolute","fixed","relative","static","inherit"]}},{prop:"cursor",values:{type:"link",values:"auto crosshair default e-resize help move n-resize ne-resize nw-resize pointer progress s-resize se-resize sw-resize text w-resize wait inherit".split(" ")}},{prop:"color",values:h},{prop:"border-top-color",values:h},{prop:"border-bottom-color",values:h},{prop:"border-right-color",
values:h},{prop:"border-left-color",values:h},{prop:"background-color",values:h},{prop:"font-style",values:{type:"link",values:["italic","normal","oblique","inherit"]}},{prop:"font-weight",values:{type:"link",values:"bold normal bolder lighter 100 200 300 400 500 600 700 800 900 inherit".split(" ")}},{prop:"white-space",values:{type:"link",values:"pre pre-line pre-wrap nowrap normal inherit".split(" ")}},{prop:"word-wrap",values:{type:"link",values:["normal","break-word"]}},{prop:"visibility",values:{type:"link",
values:["hidden","visible","collapse","inherit"]}}],m=0;m<a.length;m++)b=a[m],e.push({prefix:b.prop,description:b.prop+" - "+b.prop+" style",template:b.prop+": ${value:"+q(b.values)+"};"});a="width height top bottom left right min-width min-height max-width max-height margin padding padding-left padding-right padding-top padding-bottom margin-left margin-top margin-bottom margin-right".split(" ");for(m=0;m<a.length;m++)b=a[m],e.push({prefix:b,description:b+" - "+b+" pixel style",template:b+": ${value}px;"});
a=["padding","margin"];for(m=0;m<a.length;m++)b=a[m],e.push({prefix:b,description:b+" - "+b+" top right bottom left style",template:b+": ${top}px ${left}px ${bottom}px ${right}px;"}),e.push({prefix:b,description:b+" - "+b+" top right,left bottom style",template:b+": ${top}px ${right_left}px ${bottom}px;"}),e.push({prefix:b,description:b+" - "+b+" top,bottom right,left style",template:b+": ${top_bottom}px ${right_left}px"});a=["border","border-top","border-bottom","border-left","border-right"];for(m=
0;m<a.length;m++)b=a[m],e.push({prefix:b,description:b+" - "+b+" style",template:b+": ${width:"+q(g)+"}px ${style:"+q(f)+"} ${color:"+q(h)+"};"});k.prototype=new n.TemplateContentAssist(r.keywords,e);k.prototype.getPrefix=function(a,b,e){for(e=b;e&&/[A-Za-z\-\@]/.test(a.charAt(e-1));)e--;return e?a.substring(e,b):""};return{CssContentAssistProvider:k}});
define("orion/editor/htmlContentAssist",["orion/editor/templates"],function(n){function r(){}var q=new n.Template("","Simple HTML document",'\x3c!DOCTYPE html\x3e\n\x3chtml lang\x3d"en"\x3e\n\t\x3chead\x3e\n\t\t\x3cmeta charset\x3dutf-8\x3e\n\t\t\x3ctitle\x3e${title}\x3c/title\x3e\n\t\x3c/head\x3e\n\t\x3cbody\x3e\n\t\t\x3ch1\x3e${header}\x3c/h1\x3e\n\t\t\x3cp\x3e\n\t\t\t${cursor}\n\t\t\x3c/p\x3e\n\t\x3c/body\x3e\n\x3c/html\x3e'),k=[{prefix:"\x3cimg",name:"\x3cimg\x3e",description:" - HTML image element",
template:'\x3cimg src\x3d"${cursor}" alt\x3d"${Image}"/\x3e'},{prefix:"\x3ca",name:"\x3ca\x3e",description:" - HTML anchor element",template:'\x3ca href\x3d"${cursor}"\x3e\x3c/a\x3e'},{prefix:"\x3cul",name:"\x3cul\x3e",description:" - HTML unordered list",template:"\x3cul\x3e\n\t\x3cli\x3e${cursor}\x3c/li\x3e\n\x3c/ul\x3e"},{prefix:"\x3col",name:"\x3col\x3e",description:" - HTML ordered list",template:"\x3col\x3e\n\t\x3cli\x3e${cursor}\x3c/li\x3e\n\x3c/ol\x3e"},{prefix:"\x3cdl",name:"\x3cdl\x3e",
description:" - HTML definition list",template:"\x3cdl\x3e\n\t\x3cdt\x3e${cursor}\x3c/dt\x3e\n\t\x3cdd\x3e\x3c/dd\x3e\n\x3c/dl\x3e"},{prefix:"\x3ctable",name:"\x3ctable\x3e",description:" - basic HTML table",template:"\x3ctable\x3e\n\t\x3ctr\x3e\n\t\t\x3ctd\x3e${cursor}\x3c/td\x3e\n\t\x3c/tr\x3e\n\x3c/table\x3e"},{prefix:"\x3c!--",name:"\x3c!-- --\x3e",description:" - HTML comment",template:"\x3c!-- ${cursor} --\x3e"}],b,f,g,m,h="abbr b button canvas cite command dd del dfn dt em embed font h1 h2 h3 h4 h5 h6 i ins kbd label li mark meter object option output progress q rp rt samp small strong sub sup td time title tt u var".split(" ");
for(m=0;m<h.length;m++)b=h[m],g="\x3c"+b+"\x3e\x3c/"+b+"\x3e",f="\x3c"+b+"\x3e${cursor}\x3c/"+b+"\x3e",k.push({prefix:"\x3c"+b,description:g,template:f});h="address article aside audio bdo blockquote body caption code colgroup datalist details div fieldset figure footer form head header hgroup iframe legend map menu nav noframes noscript optgroup p pre ruby script section select span style tbody textarea tfoot th thead tr video".split(" ");for(m=0;m<h.length;m++)b=h[m],g="\x3c"+b+"\x3e\x3c/"+b+"\x3e",
f="\x3c"+b+"\x3e\n\t${cursor}\n\x3c/"+b+"\x3e",k.push({prefix:"\x3c"+b,description:g,template:f});h="area base br col hr input link meta param keygen source".split(" ");for(m=0;m<h.length;m++)b=h[m],f=g="\x3c"+b+"/\x3e",k.push({prefix:"\x3c"+b,description:g,template:f});r.prototype=new n.TemplateContentAssist([],k);r.prototype.getPrefix=function(b,a,c){c="";for(var d=a;d&&/[A-Za-z0-9<!-]/.test(b.charAt(d-1));)if(d--,"\x3c"===b.charAt(d)){c=b.substring(d,a);break}return c};r.prototype.computeProposals=
function(b,a,c){return 0===b.length?[q.getProposal("",a,c)]:n.TemplateContentAssist.prototype.computeProposals.call(this,b,a,c).sort(function(a,c){var b=a.prefix||a.proposal,e=c.prefix||c.proposal;if(b){if(!e)return 1}else return-1;return b.toLowerCase().localeCompare(e.toLowerCase())})};return{HTMLContentAssistProvider:r}});
define("orion/editor/stylers/application_javascript/syntax",["orion/editor/stylers/lib/syntax"],function(n){var r="break case class catch continue const debugger default delete do else enum export extends false finally for function if implements import in instanceof interface let new null package private protected public return static super switch this throw true try typeof undefined var void while with yield".split(" ");n=n.grammars;n.push({id:"orion.js",contentTypes:["application/javascript"],patterns:[{begin:"'(?:\\\\.|[^\\\\'])*\\\\$",
end:"^(?:$|(?:\\\\.|[^\\\\'])*('|[^\\\\]$))",name:"string.quoted.single.js"},{begin:'"(?:\\\\.|[^\\\\"])*\\\\$',end:'^(?:$|(?:\\\\.|[^\\\\"])*("|[^\\\\]$))',name:"string.quoted.double.js"},{include:"orion.lib#string_doubleQuote"},{include:"orion.lib#string_singleQuote"},{include:"orion.c-like#comment_singleLine"},{match:"/(?![\\s\\*])(?:\\\\.|[^/])+/(?:[gim]{0,3})",name:"string.regexp.js"},{include:"orion.lib#doc_block"},{include:"orion.c-like#comment_block"},{include:"orion.lib#brace_open"},{include:"orion.lib#brace_close"},
{include:"orion.lib#bracket_open"},{include:"orion.lib#bracket_close"},{include:"orion.lib#parenthesis_open"},{include:"orion.lib#parenthesis_close"},{include:"orion.lib#number_decimal"},{include:"orion.lib#number_hex"},{match:"\\b(?:"+r.join("|")+")\\b",name:"keyword.control.js"}]});return{id:n[n.length-1].id,grammars:n,keywords:r}});
define("orion/editor/jsTemplateContentAssist",["orion/editor/templates","orion/editor/stylers/application_javascript/syntax"],function(n,r){function q(){}var k=[{prefix:"if",name:"if",description:" - if statement",template:"if (${condition}) {\n\t${cursor}\n}"},{prefix:"if",name:"if",description:" - if else statement",template:"if (${condition}) {\n\t${cursor}\n} else {\n\t\n}"},{prefix:"for",name:"for",description:" - iterate over array",template:"for (var ${i}\x3d0; ${i}\x3c${array}.length; ${i}++) {\n\t${cursor}\n}"},
{prefix:"for",name:"for",description:" - iterate over array with local var",template:"for (var ${i}\x3d0; ${i}\x3c${array}.length; ${i}++) {\n\tvar ${value} \x3d ${array}[${i}];\n\t${cursor}\n}"},{prefix:"for",name:"for..in",description:" - iterate over properties of an object",template:"for (var ${property} in ${object}) {\n\tif (${object}.hasOwnProperty(${property})) {\n\t\t${cursor}\n\t}\n}"},{prefix:"while",name:"while",description:" - while loop with condition",template:"while (${condition}) {\n\t${cursor}\n}"},
{prefix:"do",name:"do",description:" - do while loop with condition",template:"do {\n\t${cursor}\n} while (${condition});"},{prefix:"switch",name:"switch",description:" - switch case statement",template:"switch (${expression}) {\n\tcase ${value1}:\n\t\t${cursor}\n\t\tbreak;\n\tdefault:\n}"},{prefix:"case",name:"case",description:" - case statement",template:"case ${value}:\n\t${cursor}\n\tbreak;"},{prefix:"try",name:"try",description:" - try..catch statement",template:"try {\n\t${cursor}\n} catch (${err}) {\n}"},
{prefix:"try",name:"try",description:" - try..catch statement with finally block",template:"try {\n\t${cursor}\n} catch (${err}) {\n} finally {\n}"},{prefix:"typeof",name:"typeof",description:" - typeof statement",template:'typeof ${object} \x3d\x3d\x3d "${type:'+JSON.stringify({type:"link",values:"undefined object boolean number string function xml".split(" ")}).replace("}","\\}")+'}"'},{prefix:"instanceof",name:"instanceof",description:" - instanceof statement",template:"${object} instanceof ${type}"},
{prefix:"with",name:"with",description:" - with statement",template:"with (${object}) {\n\t${cursor}\n}"},{prefix:"function",name:"function",description:" - function declaration",template:"/**\n * @name ${name}\n * @param ${parameter}\n */\nfunction ${name} (${parameter}) {\n\t${cursor}\n}"},{prefix:"function",name:"function",description:" - function expression",template:"/**\n * @name ${name}\n * @function\n * @param ${parameter}\n */\n${name}: function(${parameter}) {\n\t${cursor}\n}"},{prefix:"define",
name:"define",description:" - define function call",template:"/* global define */\ndefine('${name}',[\n'${import}'\n], function(${importname}) {\n\t${cursor}\n});"},{prefix:"nls",name:"nls",description:" - non NLS string",template:"${cursor} //$NON-NLS-${0}$"},{prefix:"log",name:"log",description:" - console log",template:"console.log(${object});"},{prefix:"mongodb",name:"mongodb",description:" - Node.js require statement for MongoDB",template:"var ${name} \x3d require('mongodb');\n"},{prefix:"mongodb",
name:"mongodb client",description:" - create a new MongoDB client",template:"var MongoClient \x3d require('mongodb').MongoClient;\nvar Server \x3d require('mongodb').Server;\n${cursor}"},{prefix:"mongodb",name:"mongodb open",description:" - create a new MongoDB client and open a connection",template:"var MongoClient \x3d require('mongodb').MongoClient;\nvar Server \x3d require('mongodb').Server;\nvar ${client} \x3d new MongoClient(new Server(${host}, ${port}));\ntry {\n\t${client}.open(function(error, ${client}) {\n\t\tvar ${db} \x3d ${client}.db(${name});\n\t\t${cursor}\n\t});\n} finally {\n\t${client}.close();\n};"},
{prefix:"mongodb",name:"mongodb connect",description:" - connect to an existing MongoDB database",template:"var MongoClient \x3d require('mongodb').MongoClient;\nMongoClient.connect(${url}, function(error, db) {\n\t${cursor}\n});\n"},{prefix:"mongodb",name:"mongodb connect (Cloud Foundry)",description:" - connect to an existing MongoDB database using Cloud Foundry",template:"if (${process}.env.VCAP_SERVICES) {\n\tvar env \x3d JSON.parse(${process}.env.VCAP_SERVICES);\n\tvar mongo \x3d env['${mongo-version}'][0].credentials;\n} else {\n\tvar mongo \x3d {\n\t\tusername : 'username',\n\t\tpassword : 'password',\n\t\turl : 'mongodb://username:password@localhost:27017/database'\n\t};\n}\nvar MongoClient \x3d require('mongodb').MongoClient;\nMongoClient.connect(mongo.url, function(error, db) {\n\t${cursor}\n});\n"},
{prefix:"mongodb",name:"mongodb collection",description:" - create a MongoDB database collection",template:"${db}.collection(${id}, function(${error}, collection) {\n\t${cursor}\n});"},{prefix:"mongodb",name:"mongodb strict collection",description:" - create a MongoDB database strict collection",template:"${db}.collection(${id}, {strict:true}, function(${error}, collection) {\n\t${cursor}\n});"},{prefix:"redis",name:"redis",description:" - Node.js require statement for Redis",template:"var ${name} \x3d require('redis');\n"},
{prefix:"redis",name:"redis client",description:" - create a new Redis client",template:"var ${name} \x3d require('redis');\nvar ${client} \x3d ${name}.createClient(${port}, ${host}, ${options});\n"},{prefix:"redis",name:"redis connect",description:" - create a new Redis client and connect",template:"var ${name} \x3d require('redis');\nvar ${client} \x3d ${name}.createClient(${port}, ${host}, ${options});\ntry {\n\t${cursor}\n} finally {\n\t${client}.close();\n}\n"},{prefix:"redis",name:"redis set",
description:" - create a new Redis client set call",template:"client.set(${key}, ${value});\n"},{prefix:"redis",name:"redis get",description:" - create a new Redis client get call",template:"client.get(${key}, function(${error}, ${reply}) {\n\t${cursor}\n});\n"},{prefix:"redis",name:"redis on",description:" - create a new Redis client event handler",template:"client.on(${event}, function(${arg}) {\n\t${cursor}});\n"},{prefix:"pg",name:"postgres",description:" - Node.js require statement for Postgres DB",
template:"var pg \x3d require('pg');\n"},{prefix:"pg",name:"postgres client",description:" - create a new Postgres DB client",template:"var pg \x3d require('pg');\nvar url \x3d \"postgres://postgres:${port}@${host}/${database}\";\nvar ${client} \x3d new pg.Client(url);\n"},{prefix:"pg",name:"postgres connect",description:" - create a new Postgres DB client and connect",template:"var pg \x3d require('pg');\nvar url \x3d \"postgres://postgres:${port}@${host}/${database}\";\nvar ${client} \x3d new pg.Client(url);\n${client}.connect(function(error) {\n\t${cursor}\n});\n"},
{prefix:"pg",name:"postgres query",description:" - create a new Postgres DB query statement",template:"${client}.query(${sql}, function(error, result) {\n\t${cursor}\n});\n"},{prefix:"mysql",name:"mysql",description:" - Node.js require statement for MySQL DB",template:"var mysql \x3d require('mysql');\n"},{prefix:"mysql",name:"mysql connection",description:" - create a new MySQL DB connection",template:"var mysql \x3d require('mysql');\nvar ${connection} \x3d mysql.createConnection({\n\thost : ${host},\n\tuser : ${username},\n\tpassword : ${password}\n});\ntry {\n\t${connection}.connect();\n\t${cursor}\n} finally {\n\t${connection}.end();\n}"},
{prefix:"mysql",name:"mysql query",description:" - create a new MySQL DB query statement",template:"${connection}.query(${sql}, function(error, rows, fields) {\n\t${cursor}\n});\n"},{prefix:"express",name:"express",description:" - Node.js require statement for Express",template:"var ${name} \x3d require('express');"},{prefix:"express",name:"express app",description:" - create a new Express app",template:"var express \x3d require('express');\nvar ${app} \x3d express();\n${cursor}\napp.listen(${timeout});\n"},
{prefix:"express",name:"express configure",description:" - create an Express app configure statement",template:"app.configure(function() {\n\tapp.set(${id}, ${value});\n});"},{prefix:"express",name:"express specific configure",description:" - create a specific Express app configure statement",template:"app.configure(${name}, function() {\n\tapp.set(${id}, ${value});\n});"},{prefix:"express",name:"express app get",description:" - create a new Express app.get call",template:"var value \x3d app.get(${id}, function(request, result){\n\t${cursor}\n});\n"},
{prefix:"express",name:"express app set",description:" - create a new Express app set call",template:"app.set(${id}, ${value});\n"},{prefix:"express",name:"express app use",description:" - create a new Express app use statement",template:"app.use(${fnOrObject});\n"},{prefix:"express",name:"express app engine",description:" - create a new Express app engine statement",template:"app.engine(${fnOrObject});\n"},{prefix:"express",name:"express app param",description:" - create a new Express app param statement",
template:"app.param(${id}, ${value});\n"},{prefix:"express",name:"express app error use",description:" - create a new Express app error handling use statement",template:"app.use(function(error, request, result, next) {\n\tresult.send(${code}, ${message});\n});\n"},{prefix:"amqp",name:"amqp",description:" - Node.js require statement for AMQP framework",template:"var amqp \x3d require('amqp');\n"},{prefix:"amqp",name:"amqp connection",description:" - create a new AMQP connection ",template:"var amqp \x3d require('amqp');\nvar ${connection} \x3d amqp.createConnection({\n\thost: ${host},\n\tport: ${port},\n\tlogin: ${login},\n\tpassword: ${password}\n});\n"},
{prefix:"amqp",name:"amqp on",description:" - create a new AMQP connection on statement",template:"${connection}.on(${event}, function() {\n\t${cursor}\n});\n"},{prefix:"amqp",name:"amqp queue",description:" - create a new AMQP connection queue statement",template:"${connection}.queue(${id}, function(queue) {\n\tqueue.bind('#'); //catch all messages\n\tqueue.subscribe(function (message, headers, deliveryInfo) {\n\t\t// Receive messages\n\t});\n\t${cursor}\n});\n"},{prefix:"amqp",name:"amqp exchange",
description:" - create a new AMQP connection exchange",template:"var exchange \x3d ${connection}.exchange(${id}, {type: 'topic'}, function(exchange) {\n\t${cursor}\n});\n"}];q.prototype=new n.TemplateContentAssist(r.keywords,k);q.prototype.isValid=function(b,f,g,m){b=f.charAt(g-b.length-1);return!b||-1===":!@#$^\x26*.?\x3c\x3e".indexOf(b)};return{JSTemplateContentAssistProvider:q}});
define("orion/editor/AsyncStyler",["i18n!orion/editor/nls/messages","orion/editor/annotations"],function(n,r){function q(f){return-1!==f.getProperty("objectClass").indexOf(b)&&"highlighter"===f.getProperty("type")}function k(b,f,h){this.initialize(b,f,h);this.lineStyles=[]}var b="orion.edit.highlighter",f=b+" service must be an event emitter";r.AnnotationType.registerType("orion.annotation.highlightError",{title:n.syntaxError,html:"\x3cdiv class\x3d'annotationHTML error'\x3e\x3c/div\x3e",rangeStyle:{styleClass:"annotationRange error"}});
k.prototype={initialize:function(f,m,h){this.textView=f;this.serviceRegistry=m;this.annotationModel=h;this.services=[];var e=this;this.listener={onModelChanging:function(a){e.onModelChanging(a)},onModelChanged:function(a){e.onModelChanged(a)},onDestroy:function(a){e.onDestroy(a)},onLineStyle:function(a){e.onLineStyle(a)},onStyleReady:function(a){e.onStyleReady(a)},onServiceAdded:function(a){e.onServiceAdded(a.serviceReference,e.serviceRegistry.getService(a.serviceReference))},onServiceRemoved:function(a){e.onServiceRemoved(a.serviceReference,
e.serviceRegistry.getService(a.serviceReference))}};f.addEventListener("ModelChanging",this.listener.onModelChanging);f.addEventListener("ModelChanged",this.listener.onModelChanged);f.addEventListener("Destroy",this.listener.onDestroy);f.addEventListener("LineStyle",this.listener.onLineStyle);m.addEventListener("registered",this.listener.onServiceAdded);m.addEventListener("unregistering",this.listener.onServiceRemoved);f=m.getServiceReferences(b);for(h=0;h<f.length;h++){var a=f[h];q(a)&&this.addServiceListener(m.getService(a))}},
onDestroy:function(b){this.destroy()},destroy:function(){this.textView&&(this.textView.removeEventListener("ModelChanging",this.listener.onModelChanging),this.textView.removeEventListener("ModelChanged",this.listener.onModelChanged),this.textView.removeEventListener("Destroy",this.listener.onDestroy),this.textView.removeEventListener("LineStyle",this.listener.onLineStyle),this.textView=null);if(this.services){for(var b=0;b<this.services.length;b++)this.removeServiceListener(this.services[b]);this.services=
null}this.serviceRegistry&&(this.serviceRegistry.removeEventListener("registered",this.listener.onServiceAdded),this.serviceRegistry.removeEventListener("unregistering",this.listener.onServiceRemoved),this.serviceRegistry=null);this.lineStyles=this.listener=null},onModelChanging:function(b){this.startLine=this.textView.getModel().getLineAtOffset(b.start)},onModelChanged:function(b){var f=this.startLine;(b.addedLineCount||b.removedLineCount)&&Array.prototype.splice.apply(this.lineStyles,[f,b.removedLineCount].concat(this._getEmptyStyle(b.addedLineCount)))},
onStyleReady:function(b){var f=b.lineStyles||b.style;b=Number.MAX_VALUE;var h=-1,e=this.textView.getModel(),a;for(a in f)Object.prototype.hasOwnProperty.call(f,a)&&(this.lineStyles[a]=f[a],b=Math.min(b,a),h=Math.max(h,a));b=Math.max(b,0);h=Math.min(h,e.getLineCount());if(f=this.annotationModel){for(var c=f.getAnnotations(e.getLineStart(b),e.getLineEnd(h)),d=[];c.hasNext();){var k=c.next();"orion.annotation.highlightError"===k.type&&d.push(k)}c=[];for(k=b;k<=h;k++){a=k;var p=this.lineStyles[a],p=p&&
p.errors;a=e.getLineStart(a);if(p)for(var n=0;n<p.length;n++){var q=p[n];c.push(r.AnnotationType.createAnnotation("orion.annotation.highlightError",q.start+a,q.end+a))}}f.replaceAnnotations(d,c)}this.textView.redrawLines(b,h+1)},onLineStyle:function(b){var f=this.lineStyles[b.lineIndex];if(f)if(f.ranges){for(var f=f.ranges,h=b.lineStart,e=f.length,a=[],c=0;c<e;c++){var d=f[c];a.push({start:d.start+h,end:d.end+h,style:d.style})}b.ranges=a}else f.style&&(b.style=f.style)},_getEmptyStyle:function(b){for(var f=
[],h=0;h<b;h++)f.push(null);return f},setContentType:function(b){this.contentType=b;if(this.services)for(b=0;b<this.services.length;b++){var f=this.services[b];if(f.setContentType){var h=this.serviceRegistry.getService("orion.page.progress");h?h.progress(f.setContentType(this.contentType),"Styling content type: "+this.contentType.id?this.contentType.id:this.contentType):f.setContentType(this.contentType)}}},onServiceAdded:function(b,f){q(b)&&this.addServiceListener(f)},onServiceRemoved:function(b,
f){-1!==this.services.indexOf(f)&&this.removeServiceListener(f)},addServiceListener:function(b){if("function"===typeof b.addEventListener){if(b.addEventListener("orion.edit.highlighter.styleReady",this.listener.onStyleReady),this.services.push(b),b.setContentType&&this.contentType){var m=this.serviceRegistry.getService("orion.page.progress");m?m.progress(b.setContentType(this.contentType),"Styling content type: "+this.contentType.id?this.contentType.id:this.contentType):b.setContentType(this.contentType)}}else"undefined"!==
typeof console&&console.log(Error(f))},removeServiceListener:function(b){"function"===typeof b.removeEventListener?(b.removeEventListener("orion.edit.highlighter.styleReady",this.listener.onStyleReady),b=this.services.indexOf(b),-1!==b&&this.services.splice(b,1)):"undefined"!==typeof console&&console.log(Error(f))}};return k});
define("orion/editor/mirror",["i18n!orion/editor/nls/messages","orion/editor/eventTarget","orion/editor/annotations"],function(n,r,q){function k(b){this.string=b;this.tokenStart=this.pos=0}function b(b,a){return{token:function(a,b){return a.skipToEnd()}}}function f(e){this._modes={};this.mimeModes={};this.options={};this.StringStream=k;this.defineMode("null",b);this.defineMIME("text/plain","null")}function g(b){var a=[],c;for(c in b)Object.prototype.hasOwnProperty.call(b,c)&&a.push(c);return a}function m(b,
a,c){c=c||{};this.model=b;this.codeMirror=a;this.isWhitespaceVisible="undefined"===typeof c.whitespacesVisible?!1:c.whitespacesVisible;this.mode=null;this.isModeLoaded=!1;this.lines=[];this.dirtyLines=[];this.startLine=Number.MAX_VALUE;this.endLine=-1;this.timer=null;this.initialize(b)}function h(b,a,c){this.init(b,a,c)}k.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return 0===this.pos},peek:function(){return this.string[this.pos]},next:function(){return this.string[this.pos++]},
eat:function(b){var a=this.string[this.pos];return"string"===typeof a&&(a===b||b.test&&b.test(a)||"function"===typeof b&&b(a))?this.string[this.pos++]:void 0},eatWhile:function(b){for(var a=!1;void 0!==this.eat(b);)a=!0;return a},eatSpace:function(){return this.eatWhile(/\s/)},skipToEnd:function(){this.pos=this.string.length},skipTo:function(b){b=this.string.indexOf(b,this.pos);return-1!==b?(this.pos=b,!0):!1},match:function(b,a,c){a=!0===a||"undefined"===typeof a;if("string"===typeof b){var d=c?
this.string.toLowerCase():this.string;b=c?b.toLowerCase():b;c=d.indexOf(b,this.pos);-1!==c&&a&&(this.pos=c+b.length);return-1!==c}if((b=this.string.substring(this.pos).match(b))&&a&&"string"===typeof b[0])this.pos+=b.index+b[0].length;return b},backUp:function(b){this.pos-=b},column:function(){for(var b=0,a=0;a<this.tokenStart;)b+="\t"===this.string[a++]?4:1;return b},indentation:function(){for(var b=this.string.search(/\S/),a=0,c=0;c<b;)a+="\t"===this.string[c++]?4:1;return a},current:function(){return this.string.substring(this.tokenStart,
this.pos)},advance:function(){this.tokenStart=this.pos}};f.prototype={options:{},setOption:function(b,a){this.options[b]=a},getOption:function(b){return this.options[b]},copyState:function(b,a){if("function"===typeof b.copyState)return b.copyState(a);var c={},d;for(d in a){var f=a[d];c[d]=f instanceof Array?f.slice():f}return c},startState:function(b,a){return b.startState(a)},defineMode:function(b,a){this._modes[b]=a},defineMIME:function(b,a){this.mimeModes[b]=a},getMode:function(b,a){var c={},d;
"string"===typeof a&&this.mimeModes[a]&&(a=this.mimeModes[a]);"object"===typeof a&&(c=a,d=this._modes[a.name]);d=d||this._modes[a];return"function"!==typeof d?("undefined"!==typeof console&&console&&console.log("Mode not found: "+a),this.getMode(b,"null")):d(b,c)},listModes:function(){return g(this._modes)},listMIMEs:function(){return g(this.mimeModes)},_getModeName:function(b){b=this.mimeModes[b];"object"===typeof b&&(b=b.name);return b}};m.prototype={initialize:function(b){var a=this;this.listener=
{onModelChanging:function(c){a._onModelChanging(c)},onModelChanged:function(c){a._onModelChanged(c)},onDestroy:function(c){a._onDestroy(c)}};this.model.addEventListener("Changing",this.listener.onModelChanging);this.model.addEventListener("Changed",this.listener.onModelChanged);this.model.addEventListener("Destroy",this.listener.onDestroy)},destroy:function(){this.model&&(this.model.removeEventListener("Changing",this.listener.onModelChanging),this.model.removeEventListener("Changed",this.listener.onModelChanged),
this.model.removeEventListener("Destroy",this.listener.onDestroy));this.dirtyLines=this.lines=this.mode=this.codeMirror=this.model=null;clearTimeout(this.timer);this.timer=null},_onModelChanging:function(b){this.startLine=this.model.getLineAtOffset(b.start)},_onModelChanged:function(b){this._dbgEvent(b);var a=this.startLine;(b.removedLineCount||b.addedLineCount)&&Array.prototype.splice.apply(this.lines,[a+1,b.removedLineCount].concat(this._newLines(b.addedLineCount)));this.mode&&(b=Math.max(b.addedLineCount,
b.removedLineCount),b=a+Math.min(b,500),this.highlight(a,b),this.highlightLater(b+1))},_onDestroy:function(b){this.destroy()},setViewportIndex:function(b){this.viewportIndex=b},_dbgEvent:function(b){},_dbgStyle:function(){},_newLines:function(b,a){for(var c=[],d=0;d<b;d++)c.push({style:null,eolState:null});return c},setMode:function(b,a){b&&(this.mode=this.codeMirror.getMode(this.codeMirror.options,b),this.lines=this._newLines(this.model.getLineCount()),a&&this.highlight())},highlight:function(b,
a,c){if(this.mode){var d=this.model.getLineCount();b="undefined"===typeof b?0:b;a="undefined"===typeof a?d-1:Math.min(a,d-1);for(var d=this.mode,f=this.getState(b),g=b;g<=a;g++){var h=this.lines[g];this.highlightLine(g,h,f);h.eolState=this.codeMirror.copyState(d,f)}this._expandRange(b,a);if(!c)this.onHighlightDone()}},highlightLater:function(b){this.dirtyLines.push(b);var a=this;this.timer=setTimeout(function(){a._highlightJob()},50)},_highlightJob:function(){for(var b=+new Date+30,a=this.mode.compareStates,
c=this.model.getLineCount();this.dirtyLines.length;){var d=this.viewportIndex,f=this.lines[d],d=f&&!f.eolState?d:this.dirtyLines.pop();if(d>=c)break;this._expandRange(d,d);for(var f=this._getResumeLineIndex(d),d=f+1,f=(f=0<=f&&this.lines[f].eolState)?this.codeMirror.copyState(this.mode,f):this.mode.startState(),g=0,h=d;h<c;h++){var m=this.lines[h],k=m.eolState,n=this.highlightLine(h,m,f);m.eolState=this.codeMirror.copyState(this.mode,f);n&&this._expandRange(d,h+1);var m=a&&k&&a(k,m.eolState),q=!a&&
!n&&3<g++;if(m||q)break;else if(!k||n)g=0;k=h<c||this.dirtyLines.length;if(+new Date>b&&k){this.highlightLater(h+1);this.onHighlightDone();return}}}this.onHighlightDone()},onHighlightDone:function(){this.startLine!==Number.MAX_VALUE&&-1!==this.endLine&&this.dispatchEvent({type:"Highlight",start:this.startLine,end:this.endLine});this.startLine=Number.MAX_VALUE;this.endLine=-1},_getResumeLineIndex:function(b){for(var a=this.lines,c=b-1;0<=c;c--)if(a[c].eolState||40<b-c)return c;return-1},getState:function(b){var a=
this.mode,c=this.lines,d,f;for(d=b-1;0<=d&&!(f=c[d],f.eolState||40<b-d);d--);var g=0<=d&&c[d].eolState;if(g){g=this.codeMirror.copyState(a,g);for(d=Math.max(0,d);d<b-1;d++)f=c[d],this.highlightLine(d,f,g),f.eolState=this.codeMirror.copyState(a,g);return g}return a.startState()},highlightLine:function(b,a,c){if(this.mode){var d=this.model;d.getLineStart(b)===d.getLineEnd(b)&&this.mode.blankLine&&this.mode.blankLine(c);var f=a.style||[];b=d.getLine(b);b=new k(b);for(var d=!a.style,g=[],h=0;!b.eol();h++){var m=
this.mode.token(b,c)||null,n=b.current();this._whitespaceStyle(m,n,b.tokenStart);m=[b.tokenStart,b.pos,m];n=f[h];g.push(m);d=d||!n||n[0]!==m[0]||n[1]!==m[1]||n[2]!==m[2];b.advance()}if(d=d||g.length!==f.length)a.style=g.length?g:null;return d}},_whitespaceStyle:function(b,a,c){if(!b&&this.isWhitespaceVisible&&/\s+/.test(a)){b=[];for(var d,f,g=0;g<a.length;g++){var h=a[g];h!==f&&(f&&b.push([c+d,c+g,"\t"===f?"punctuation separator tab":"punctuation separator space"]),d=g,f=h)}b.push([c+d,c+g,"\t"===
f?"punctuation separator tab":"punctuation separator space"]);return b}return null},_expandRange:function(b,a){this.startLine=Math.min(this.startLine,b);this.endLine=Math.max(this.endLine,a)},toStyleRangesAndErrors:function(b,a){var c=b.style;if(!c)return null;for(var d=[],f=[],g="undefined"===typeof a?0:this.model.getLineStart(a),h=0;h<c.length;h++){var m=c[h],k;k=(k=m[2])?"punctuation separator tab"===k||"punctuation separator space"===k?k:"cm-"+k:null;k&&(m={start:g+m[0],end:g+m[1],style:{styleClass:k}},
d.push(m),"cm-error"===k&&f.push(m))}return[d,f]},getLineStyle:function(b){return this.lines[b]},getLineStyles:function(){return this.lines}};r.EventTarget.addMixin(m.prototype);q.AnnotationType.registerType("orion.annotation.highlightError",{title:n.syntaxError,html:"\x3cdiv class\x3d'annotationHTML error'\x3e\x3c/div\x3e",rangeStyle:{styleClass:"annotationRange error"}});h.prototype={init:function(b,a,c){this.textView=b;this.annotationModel=c;this.modeApplier=new m(b.getModel(),a);var d=this;this.listener=
{onLineStyle:function(a){d.onLineStyle(a)},onDestroy:function(a){d.onDestroy(a)},onHighlight:function(a){d.onHighlight(a)}};b.addEventListener("LineStyle",this.listener.onLineStyle);b.addEventListener("Destroy",this.listener.onDestroy);this.modeApplier.addEventListener("Highlight",this.listener.onHighlight)},destroy:function(){this.modeApplier&&(this.modeApplier.removeEventListener("Highlight",this.listener.onHighlight),this.modeApplier.destroy());this.textView&&(this.textView.removeEventListener("LineStyle",
this.listener.onLineStyle),this.textView.removeEventListener("Destroy",this.listener.onDestroy));this.listener=this.modeApplier=this.annotationModel=this.textView=null},setMode:function(b){this.modeApplier.setMode(b)},onLineStyle:function(b){var a=b.lineIndex,c=this.modeApplier,d=c.getLineStyle(a);if(!d||!d.eolState){var f=this.textView.getModel().getLineCount();c.highlight(a,Math.min(a+20,f-1),!0);d=c.getLineStyle(a)}f=this.textView.getModel();if(d){var g=c.toStyleRangesAndErrors(d,a);if(g&&(b.ranges=
g[0],b=this.annotationModel)){c=[];d=[];if(g=g[1])for(var h=0;h<g.length;h++){var m=g[h];"cm-error"===m.style.styleClass&&d.push(q.AnnotationType.createAnnotation("orion.annotation.highlightError",m.start,m.end))}for(a=b.getAnnotations(f.getLineStart(a),f.getLineEnd(a));a.hasNext();)f=a.next(),"orion.annotation.highlightError"===f.type&&c.push(f);b.replaceAnnotations(c,d)}}},onHighlight:function(b){this.textView.redrawLines(b.start,b.end)},onDestroy:function(b){this.destroy()}};return{Mirror:f,ModeApplier:m,
CodeMirrorStyler:h}});
define("orion/editor/textMateStyler",["orion/regex"],function(n){function r(b){var f;if(b instanceof Array){f=Array(b.length);for(var g=0;g<b.length;g++)f[g]=r(b[g])}else for(g in f={},b)if(Object.prototype.hasOwnProperty.call(b,g)){var m=b[g];f[g]="object"===typeof m&&null!==m?r(m):m}return f}function q(b,f,g){this.initialize(b);this.grammar=r(f);this.externalGrammars=g?r(g):[];this._styles={};this._tree=null;this._allGrammars={};this.preprocess(this.grammar)}var k={unsupported:[{regex:/\(\?[ims\-]:/,func:function(b){return"option on/off for subexp"}},
{regex:/\(\?<([=!])/,func:function(b){return"\x3d"===b[1]?"lookbehind":"negative lookbehind"}},{regex:/\(\?>/,func:function(b){return"atomic group"}}],toRegExp:function(b){function f(b,a){throw Error('Unsupported regex feature "'+b+'": "'+a[0]+'" at index: '+a.index+" in "+a.input);}var g="",m;b=k.processGlobalFlag("x",b,function(b){for(var a="",c=!1,d=b.length,f=0;f<d;){var g=b.charAt(f);if(!c&&"#"===g)for(;f<d&&"\r"!==g&&"\n"!==g;)g=b.charAt(++f);else if(!c&&/\s/.test(g))for(;f<d&&/\s/.test(g);)g=
b.charAt(++f);else"\\"===g?(a+=g,/\s/.test(b.charAt(f+1))||(a+=b.charAt(f+1),f+=1)):("["===g?c=!0:"]"===g&&(c=!1),a+=g),f+=1}return a});b=k.processGlobalFlag("i",b,function(b){g+="i";return b});for(m=0;m<this.unsupported.length;m++){var h;(h=this.unsupported[m].regex.exec(b))&&f(this.unsupported[m].func(h),h)}return RegExp(b,g)},processGlobalFlag:function(b,f,g){var m="(?"+b+")";b="(?"+b+":";if(f.substring(0,m.length)===m)return g(f.substring(m.length));if(f.substring(0,b.length)===b){for(var m=0,
h=f.length,e=-1,a=0;a<h&&-1===e;a++)switch(f.charAt(a)){case "\\":a++;break;case "(":m++;break;case ")":m--,0===m&&(e=a)}m=e;if(m<f.length-1)throw Error("Only a "+b+") group that encloses the entire regex is supported in: "+f);return g(f.substring(b.length,m))}return f},hasBackReference:function(b){return/\\\d+/.test(b.source)},getSubstitutedRegex:function(b,f,g){g="undefined"===typeof g?!0:!1;b=b.source.split(/(\\\d+)/g);for(var m=[],h=0;h<b.length;h++){var e=b[h],a=/\\(\d+)/.exec(e);a?(e=f[a[1]]||
"",m.push(g?n.escape(e):e)):m.push(e)}return RegExp(m.join(""))},groupify:function(b,f){for(var g=b.source,m=g.length,h=[],e=0,a=[],c=1,d=1,k=[],n={},q={},r=0;r<m;r++){var v=h[h.length-1],y=g.charAt(r);switch(y){case "(":4===v&&(h.pop(),k.push(")"),a[a.length-1].end=r);var A=r+2<m?g.charAt(r+1)+""+g.charAt(r+2):null;if("?:"===A||"?\x3d"===A||"?!"===A){var w;"?:"===A?w=1:(w=3,e++);h.push(w);a.push({start:r,end:-1,type:w});k.push(y);k.push(A);r+=A.length}else h.push(2),a.push({start:r,end:-1,type:2,
oldNum:c,num:d}),k.push(y),0===e&&(q[d]=null),n[c]=d,c++,d++;break;case ")":v=h.pop();3===v&&e--;a[a.length-1].end=r;k.push(y);break;case "*":case "+":case "?":case "}":var B=y,l=g.charAt(r-1),A=r-1;if("}"===y){for(w=r-1;"{"!==g.charAt(w)&&0<=w;w--);l=g.charAt(w-1);A=w-1;B=g.substring(w,r+1)}w=a[a.length-1];if(")"===l&&(2===w.type||4===w.type)){k.splice(w.start,0,"(");k.push(B);k.push(")");y={start:w.start,end:k.length-1,type:4,num:w.num};for(l=0;l<a.length;l++)if(v=a[l],(2===v.type||4===v.type)&&
v.start>=w.start&&v.end<=A)v.start+=1,v.end+=1,v.num+=1,2===v.type&&(n[v.oldNum]=v.num);a.push(y);d++;break}default:"|"!==y&&(2!==v&&4!==v)&&0===e&&(h.push(4),a.push({start:r,end:-1,type:4,num:d}),k.push("("),q[d]=null,d++),k.push(y),"\\"===y&&(y=g.charAt(r+1),k.push(y),r+=1)}}for(;h.length;)h.pop(),k.push(")");g=RegExp(k.join(""));m={};f=f||n;for(var z in f)f.hasOwnProperty(z)&&(m[z]="\\"+f[z]);g=this.getSubstitutedRegex(g,m,!1);return[g,n,q]},complexCaptures:function(b){if(!b)return!1;for(var f in b)if(b.hasOwnProperty(f)&&
"0"!==f)return!0;return!1}};q.prototype={initialize:function(b){this.textView=b;this.textView.stylerOptions=this;var f=this;this._listener={onModelChanged:function(b){f.onModelChanged(b)},onDestroy:function(b){f.onDestroy(b)},onLineStyle:function(b){f.onLineStyle(b)},onStorage:function(b){f.onStorage(b)}};b.addEventListener("ModelChanged",this._listener.onModelChanged);b.addEventListener("Destroy",this._listener.onDestroy);b.addEventListener("LineStyle",this._listener.onLineStyle);b.redrawLines()},
onDestroy:function(b){this.destroy()},destroy:function(){this.textView&&(this.textView.removeEventListener("ModelChanged",this._listener.onModelChanged),this.textView.removeEventListener("Destroy",this._listener.onDestroy),this.textView.removeEventListener("LineStyle",this._listener.onLineStyle),this.textView=null);this._listener=this._tree=this._styles=this.grammar=null},preprocess:function(b){for(b=[b];0!==b.length;){var f=b.pop();if(!f._resolvedRule||!f._typedRule)if(f._resolvedRule=this._resolve(f),
f._typedRule=this._createTypedRule(f),this.addStyles(f.name),this.addStyles(f.contentName),this.addStylesForCaptures(f.captures),this.addStylesForCaptures(f.beginCaptures),this.addStylesForCaptures(f.endCaptures),f._resolvedRule!==f&&b.push(f._resolvedRule),f.patterns)for(var g=0;g<f.patterns.length;g++)b.push(f.patterns[g])}},addStyles:function(b){if(b&&!this._styles[b]){this._styles[b]=[];for(var f=b.split("."),g=0;g<f.length;g++)this._styles[b].push(f.slice(0,g+1).join("-"))}},addStylesForCaptures:function(b){for(var f in b)b.hasOwnProperty(f)&&
this.addStyles(b[f].name)},ContainerRule:function(){function b(b){this.rule=b;this.subrules=b.patterns}b.prototype.valueOf=function(){return"aa"};return b}(),BeginEndRule:function(){function b(b){this.rule=b;this.beginRegex=k.toRegExp(b.begin);this.endRegex=k.toRegExp(b.end);this.subrules=b.patterns||[];this.endRegexHasBackRef=k.hasBackReference(this.endRegex);var g=k.complexCaptures(b.captures);b=k.complexCaptures(b.beginCaptures)||k.complexCaptures(b.endCaptures);if(this.isComplex=g||b)g=k.groupify(this.beginRegex),
this.beginRegex=g[0],this.beginOld2New=g[1],this.beginConsuming=g[2],g=k.groupify(this.endRegex,this.beginOld2New),this.endRegex=g[0],this.endOld2New=g[1],this.endConsuming=g[2]}b.prototype.valueOf=function(){return this.beginRegex};return b}(),MatchRule:function(){function b(b){this.rule=b;this.matchRegex=k.toRegExp(b.match);if(this.isComplex=k.complexCaptures(b.captures))b=k.groupify(this.matchRegex),this.matchRegex=b[0],this.matchOld2New=b[1],this.matchConsuming=b[2]}b.prototype.valueOf=function(){return this.matchRegex};
return b}(),_createTypedRule:function(b){return b.match?new this.MatchRule(b):b.begin?new this.BeginEndRule(b):new this.ContainerRule(b)},_resolve:function(b){var f=b;if(b.include){if(b.begin||b.end||b.match)throw Error('Unexpected regex pattern in "include" rule '+b.include);b=b.include;if("#"===b.charAt(0)){if(f=this.grammar.repository&&this.grammar.repository[b.substring(1)],!f)throw Error("Couldn't find included rule "+b+" in grammar repository");}else if("$self"===b)f=this.grammar;else{if("$base"===
b)throw Error('Include "$base" is not supported');f=this._allGrammars[b];if(!f)for(var g=0;g<this.externalGrammars.length;g++){var m=this.externalGrammars[g];if(m.scopeName===b){this.preprocess(m);f=this._allGrammars[b]=m;break}}}}return f},ContainerNode:function(){function b(b,g){this.parent=b;this.rule=g;this.children=[];this.end=this.start=null}b.prototype.addChild=function(b){this.children.push(b)};b.prototype.valueOf=function(){var b=this.rule;return"ContainerNode { "+(b.include||"")+" "+(b.name||
"")+(b.comment||"")+"}"};return b}(),BeginEndNode:function(){function b(b,g,m){this.parent=b;this.rule=g;this.children=[];this.setStart(m);this.endMatch=this.end=null;this.endRegexSubstituted=g.endRegexHasBackRef?k.getSubstitutedRegex(g.endRegex,m):null}b.prototype.addChild=function(b){this.children.push(b)};b.prototype.getIndexInParent=function(b){return this.parent?this.parent.children.indexOf(this):-1};b.prototype.setStart=function(b){this.start=b.index;this.beginMatch=b};b.prototype.setEnd=function(b){b&&
"object"===typeof b?(this.endMatch=b,this.end=b.index+b[0].length):(this.endMatch=null,this.end=b)};b.prototype.shiftStart=function(b){this.start+=b;this.beginMatch.index+=b};b.prototype.shiftEnd=function(b){this.end+=b;this.endMatch&&(this.endMatch.index+=b)};b.prototype.valueOf=function(){return"{"+this.rule.beginRegex+" range\x3d"+this.start+".."+this.end+"}"};return b}(),push:function(b,f){if(f)for(var g=f.length;0<g;)b.push(f[--g])},exec:function(b,f,g){if(f=b.exec(f))f.index+=g;b.lastIndex=
0;return f},afterMatch:function(b){return b.index+b[0].length},getEndMatch:function(b,f,g){if(b instanceof this.BeginEndNode){var m=b.rule;b=b.endRegexSubstituted||m.endRegex;return!b?null:this.exec(b,f,g)}return null},initialParse:function(){this.textView.getModel().getCharCount();this._tree=new this.ContainerNode(null,this.grammar._typedRule);this.parse(this._tree,!1,0)},onModelChanged:function(b){var f=b.addedCharCount,g=b.removedCharCount;b=b.start;if(this._tree){var m=this.textView.getModel(),
h=m.getCharCount(),m=m.getLineEnd(m.getLineAtOffset(b)-1),e=this.getFirstDamaged(m,m),m=-1===m?0:m,f=e?this.parse(e,!0,m,b,f,g):h;this.textView.redrawRange(m,f)}else this.initialParse()},getFirstDamaged:function(b,f){if(0>b)return this._tree;for(var g=[this._tree],m=null;g.length;){var h=g.pop();if(!h.parent||this.isDamaged(h,b,f)){h instanceof this.BeginEndNode&&(m=h);for(var e=0;e<h.children.length;e++)g.push(h.children[e])}}return m||this._tree},isDamaged:function(b,f,g){return b.start<=g&&b.end>
f},parse:function(b,f,g,m,h,e){var a=this.textView.getModel(),c=a.getLineStart(a.getLineCount()-1),d=a.getCharCount(),k=this.getInitialExpected(b,g),n=-1;f&&(b.repaired=!0,b.endNeedsUpdate=!0,n=(n=b.children[b.children.length-1])?a.getLineEnd(a.getLineAtOffset(n.end+(h-e))):-1,m=a.getLineEnd(a.getLineAtOffset(m+e)),n=Math.max(n,m));n=-1===n?d:n;m=k;for(var q=b,r=!1,v=g,y=-1;q&&(!f||v<n);){var A=this.getNextMatch(a,q,v);A||(v=v>=c?d:a.getLineStart(a.getLineAtOffset(v)+1));var w=A&&A.match,B=A&&A.rule,
l=A&&A.isEnd;if(A&&A.isSub)v=this.afterMatch(w),B instanceof this.BeginEndRule&&(r=!0,f&&B===m.rule&&q===m.parent?(q=m,q.setStart(w),q.repaired=!0,q.endNeedsUpdate=!0,m=this.getNextExpected(m,"begin")):(f&&(this.prune(q,m),f=!1),w=new this.BeginEndNode(q,B,w),q.addChild(w),q=w));else if(l||v===d)q instanceof this.BeginEndNode&&(w?(r=!0,y=Math.max(y,q.end),q.setEnd(w),v=this.afterMatch(w),f&&q===m&&q.parent===m.parent?(q.repaired=!0,delete q.endNeedsUpdate,m=this.getNextExpected(m,"end")):f&&(this.prune(q,
m),f=!1)):(q.setEnd(d),delete q.endNeedsUpdate)),q=q.parent;f&&(v>=n&&!r)&&(this.prune(b,k),f=!1)}this.removeUnrepairedChildren(b,f,g);this.cleanup(f,b,g,n,d,h,e);return f?Math.max(y,v):v},removeUnrepairedChildren:function(b,f,g){if(f){f=b.children;for(var m=-1,h=0;h<f.length;h++){var e=f[h];if(!e.repaired&&this.isDamaged(e,g,Number.MAX_VALUE)){m=h;break}}-1!==m&&(b.children.length=m)}},cleanup:function(b,f,g,m,h,e,a){if(b){b=e-a;h=this.getIntersecting(m-b+1,h);f=this.getIntersecting(g,m);for(g=0;g<
h.length;g++)m=h[g],!m.repaired&&m instanceof this.BeginEndNode&&(m.shiftEnd(b),m.shiftStart(b));for(g=0;g<f.length;g++)m=f[g],m.repaired&&m.endNeedsUpdate&&m.shiftEnd(b),delete m.endNeedsUpdate,delete m.repaired}else{f=this.getIntersecting(g,m);for(g=0;g<f.length;g++)delete f[g].repaired}},getNextMatch:function(b,f,g,m){var h=b.getLineAtOffset(g),h=b.getLineEnd(h),e=b.getText(g,h),a=[],c=[];b=[];h=[];for(this.push(a,f.rule.subrules);a.length;){var d=a.length?a.pop():null,d=d&&d._resolvedRule._typedRule;
if(d instanceof this.ContainerRule&&-1===c.indexOf(d))c.push(d),this.push(a,d.subrules);else if(!d||!m||d.matchRegex){var k=d&&this.exec(d.matchRegex||d.beginRegex,e,g);k&&(b.push(k),h.push(d))}}a=Number.MAX_VALUE;c=-1;for(d=0;d<b.length;d++)k=b[d],k.index<a&&(a=k.index,c=d);if(!m&&(g=this.getEndMatch(f,e,g)))if(m=f.rule.applyEndPatternLast,-1===c||g.index<a||!m&&g.index===a)return{isEnd:!0,rule:f.rule,match:g};return-1===c?null:{isSub:!0,rule:h[c],match:b[c]}},getInitialExpected:function(b,f){var g,
m;if(b===this._tree)for(g=0;g<b.children.length;g++){if(m=b.children[g],m.start>=f)return m}else if(b instanceof this.BeginEndNode&&b.endMatch){var h=b.endMatch.index;for(g=0;g<b.children.length&&!(m=b.children[g],m.start>=f);g++);if(m&&m.start<h)return m}return b},getNextExpected:function(b,f){if("begin"===f){var g=b.children[0];return g?g:b}if("end"===f&&(g=b.parent)){var m=g.children[g.children.indexOf(b)+1];return m?m:g}return null},prune:function(b,f){f.parent===b?b.children.length=f.getIndexInParent():
b instanceof this.BeginEndNode&&(b.endMatch=null,b.end=null);b.parent&&(b.parent.children.length=b.getIndexInParent()+1)},onLineStyle:function(b){this._tree||this.initialParse();var f=b.lineStart,g=this.textView.getModel(),m=g.getLineEnd(b.lineIndex),h=g.getLineEnd(g.getLineAtOffset(f)-1),h=this.getFirstDamaged(h,h),f=this.getLineScope(g,h,f,m);b.ranges=this.toStyleRanges(f);b.ranges.sort(function(b,a){return b.start-a.start})},getLineScope:function(b,f,g,m){for(var h=g,e=this.getInitialExpected(f,
g),a=[],c=[];f&&h<m;){var d=this.getNextMatch(b,f,h);if(!d)break;var k=d&&d.match,n=d&&d.rule,q=d&&d.isSub,d=d&&d.isEnd;k.index!==h&&c.push({start:h,end:k.index,node:f});q?(h=this.afterMatch(k),n instanceof this.BeginEndRule?(this.addBeginScope(a,k,n),f=e,e=this.getNextExpected(e,"begin")):this.addMatchScope(a,k,n)):d&&(h=this.afterMatch(k),this.addEndScope(a,k,n),e=this.getNextExpected(e,"end"),f=f.parent)}h<m&&c.push({start:h,end:m,node:f});b=this.getInheritedLineScope(c,g,m);return a.concat(b)},
getInheritedLineScope:function(b,f,g){f=[];for(g=0;g<b.length;g++)for(var k=b[g],h=k.node;h;){var e=h.rule.rule,a=e.name;if(e=e.contentName||a){this.addScopeRange(f,k.start,k.end,e);break}h=h.parent}return f},addBeginScope:function(b,f,g){var k=g.rule;this.addCapturesScope(b,f,k.beginCaptures||k.captures,g.isComplex,g.beginOld2New,g.beginConsuming)},addEndScope:function(b,f,g){var k=g.rule;this.addCapturesScope(b,f,k.endCaptures||k.captures,g.isComplex,g.endOld2New,g.endConsuming)},addMatchScope:function(b,
f,g){var k=g.rule,h=k.name;(k=k.captures)?this.addCapturesScope(b,f,k,g.isComplex,g.matchOld2New,g.matchConsuming):this.addScope(b,f,h)},addScope:function(b,f,g){g&&b.push({start:f.index,end:this.afterMatch(f),scope:g})},addScopeRange:function(b,f,g,k){k&&b.push({start:f,end:g,scope:k})},addCapturesScope:function(b,f,g,k,h,e){if(g)if(k){k={1:0};for(var a=0,c=1;void 0!==f[c];c++)void 0!==e[c]&&(a+=f[c].length),void 0!==f[c+1]&&(k[c+1]=a);e=f.index;for(a=1;g[a];a++){var c=g[a].name,d=h[a],n=e+k[d];
"undefined"!==typeof f[d]&&this.addScopeRange(b,n,n+f[d].length,c)}}else this.addScope(b,f,g[0]&&g[0].name)},getIntersecting:function(b,f){for(var g=[],k=this._tree?[this._tree]:[];k.length;){var h=k.pop(),e=!1;h instanceof this.ContainerNode?e=!0:this.isDamaged(h,b,f)&&(e=!0,g.push(h));if(e)for(var e=h.children.length,a=0;a<e;a++)k.push(h.children[a])}return g.reverse()},toStyleRanges:function(b){for(var f=[],g=0;g<b.length;g++){var k=b[g],h=this._styles[k.scope];if(!h)throw Error("styles not found for "+
k.scope);h=h.join(" ");f.push({start:k.start,end:k.end,style:{styleClass:h}})}return f}};return{RegexUtil:k,TextMateStyler:q}});
define("orion/editor/htmlGrammar",[],function(){return{HtmlGrammar:function(){return{scopeName:"source.html",uuid:"3B5C76FB-EBB5-D930-F40C-047D082CE99B",patterns:[{begin:"\x3c!(doctype|DOCTYPE)",end:"\x3e",contentName:"entity.name.tag.doctype.html",beginCaptures:{0:{name:"entity.name.tag.doctype.html"}},endCaptures:{0:{name:"entity.name.tag.doctype.html"}}},{begin:"\x3c!--",end:"--\x3e",beginCaptures:{0:{name:"punctuation.definition.comment.html"}},endCaptures:{0:{name:"punctuation.definition.comment.html"}},
patterns:[{match:"--",name:"invalid.illegal.badcomment.html"}],contentName:"comment.block.html"},{match:"\x3c[A-Za-z0-9_\\-:]+(?\x3d ?)",name:"entity.name.tag.html"},{include:"#attrName"},{include:"#qString"},{include:"#qqString"},{include:"#entity"},{match:"\x3c/[A-Za-z0-9_\\-:]+\x3e",name:"entity.name.tag.html"},{match:"\x3e",name:"entity.name.tag.html"}],repository:{attrName:{match:"[A-Za-z\\-:]+(?\x3d\\s*\x3d\\s*['\"])",name:"entity.other.attribute.name.html"},qqString:{match:'(")[^"]+(")',name:"string.quoted.double.html"},
qString:{match:"(')[^']+(')",name:"string.quoted.single.html"},entity:{match:"\x26[A-Za-z0-9]+;",name:"constant.character.entity.html"}}}}}});
define("orion/editor/textStyler",["orion/editor/annotations"],function(n){function r(a,b){this._unnamedCounter=0;this._patterns=[];this._rootId=b;a.forEach(function(a){this._addRepositoryPatterns(a.repository||{},a.id);this._addPatterns(a.patterns||[],a.id)}.bind(this))}function q(a,b,c,d,e){this.start=a.start;this.end=a.end;this.contentStart=a.contentStart;this.contentEnd=a.contentEnd;this.pattern=b;this._styler=c;this._parent=e;this._linePatterns=[];this._blockPatterns=[];this._enclosurePatterns=
{};d&&(this._initPatterns(),this._subBlocks=y(d,d.getText(this.start,this.end),this,this.start))}function k(a){this._styler=a}function b(a,b,c,d){this.highlightCaretLine=this.whitespacesVisible=this.spacesVisible=this.tabsVisible=!1;this.detectTasks=this.foldingEnabled=!0;this.view=a;this.annotationModel=b;this.patternManager=new r(c,d);this._accessor=new k(this);this._bracketAnnotations=void 0;var e=this;this._listener={onChanged:function(a){e._onModelChanged(a)},onDestroy:function(a){e._onDestroy(a)},
onLineStyle:function(a){e._onLineStyle(a)},onMouseDown:function(a){e._onMouseDown(a)},onSelection:function(a){e._onSelection(a)}};c=a.getModel();c.getBaseModel&&(c=c.getBaseModel());c.addEventListener("Changed",this._listener.onChanged);a.addEventListener("MouseDown",this._listener.onMouseDown);a.addEventListener("Selection",this._listener.onSelection);a.addEventListener("Destroy",this._listener.onDestroy);a.addEventListener("LineStyle",this._listener.onLineStyle);d=c.getCharCount();this._rootBlock=
new q({start:0,contentStart:0,end:d,contentEnd:d},null,this,c);this._computeFolding(this._rootBlock.getBlocks());b&&this.detectTasks&&(d=[],A(this._rootBlock,c,d),b.replaceAnnotations([],d));a.redrawLines()}var f={styleClass:"meta annotation currentLine"},g=/$/,m=/\\(\d)/g,h=/^\(\?i\)\s*/,e=/(.*)(?:[\r\n]|$)/g,a={regex:/[ ]/g,style:{styleClass:"punctuation separator space",unmergeable:!0}},c={regex:/\t/g,style:{styleClass:"punctuation separator tab",unmergeable:!0}},d=function(a,b,c,d){var f=c,g=
a.lastIndex;e.lastIndex=c;c=e.exec(b);var k,h;a.lastIndex=0;if(c){for(h=c.index;0<=--h&&!(k=b.charAt(h),"\n"===k||"\r"===k););k=b.substring(h+1,c.index+c[1].length);a.lastIndex=h=c.index-h-1}for(;c&&c.index<b.length;){var m;if(d){var n=a.lastIndex;a.test(k)&&(a.lastIndex=n,m=a.exec(k))}else m=a.exec(k);if(m)return m.index+=f,m.index-=h,a.lastIndex=g,m;h=0;f+=c[0].length;if(c=e.exec(b))k=c[1],a.lastIndex=0}a.lastIndex=g;return null},s=function(a,b){var c=a.toString();m.lastIndex=0;if(!m.test(c))return a;
m.lastIndex=0;for(var d=m.exec(c);d;)c=c.replace(d[0],b[d[1]]||""),m.lastIndex=0,d=m.exec(c);return RegExp(c.substring(1,c.length-1-1),"g")},p=function(a,b,c,e){if(b=d(a.pattern.regex?a.pattern.regex:a.pattern.regexBegin,b,e,!0)){a.result=b;for(e=0;e<c.length;e++)if(b.index<c[e].result.index||b.index===c[e].result.index&&a.pattern.pattern.index<c[e].pattern.pattern.index){c.splice(e,0,a);return}c.push(a)}},u=function(a,b,c,d){if(b[0])d.push({start:c,end:c+a[0].length,style:b[0].name});else for(var e=
0,f=1;f<a.length;f++)if(a[f]){var g=b[f];if(g){var k=c+e;d.push({start:k,end:k+a[f].length,style:g.name})}e+=a[f].length}},t=function(a,b,c){var d=a.start;b.forEach(function(b){d<=b.start&&c.push({start:d,end:b.start,style:a.style});c.push(b);d=b.end});d<a.end&&c.push({start:d,end:a.end,style:a.style})},v=function(a,b,c,e,f){if(a&&(c=c.getLinePatterns())){var k=[];c.forEach(function(b){var c=b.regex||b.regexBegin;c.oldLastIndex=c.lastIndex;(c=d(c,a,0))&&k.push({result:c,pattern:b})});k.sort(function(a,
b){return a.result.index<b.result.index?-1:a.result.index>b.result.index?1:a.pattern.pattern.index<b.pattern.pattern.index?-1:1});for(var h=0;0<k.length;){var m=k[0];k.splice(0,1);if(!(m.result.index<h)){var n=m.result.index,q,r=[];if(m.pattern.regex){h=m.result;q=n+h[0].length;q={start:b+n,end:b+q,style:m.pattern.pattern.name};if(!f){m.pattern.pattern.captures&&u(h,m.pattern.pattern.captures,b+n,r);r.sort(function(a,b){return a.start<b.start?-1:a.start>b.start?1:0});for(n=0;n<r.length-1;n++)if(r[n+
1].start<r[n].end){var v={start:r[n+1].end,end:r[n].end,style:r[n].style};r[n].end=r[n+1].start;r.splice(n+2,0,v)}}t(q,r,e)}else h=m.pattern.regexEnd,h=s(h,m.result),h=d(h,a,m.result.index+m.result[0].length),h||(g.lastIndex=0,h=g.exec(a)),q=h.index+h[0].length,e.push({start:b+n,end:b+q,style:m.pattern.pattern.name});h=h.index+h[0].length}p(m,a,k,h)}c.forEach(function(a){a=a.regex||a.regexBegin;a.lastIndex=a.oldLastIndex})}},y=function(a,b,c,e){if(!b)return[];var f=[],k=[];c.getBlockPatterns().forEach(function(a){var c=
d(a.regexBegin||a.regex,b,0);c&&k.push({result:c,pattern:a})}.bind(this));if(!k.length)return f;k.sort(function(a,b){return a.result.index<b.result.index?-1:a.result.index>b.result.index?1:a.pattern.pattern.index<b.pattern.pattern.index?-1:1});for(var h=0;0<k.length;){var m=k[0];k.splice(0,1);if(!(m.result.index<h)){var h=e+m.result.index,n=m.result.index,r=null,t=m.pattern.regexEnd;if(t){var n=n+m.result[0].length,u=m.pattern,v=s(t,m.result);v!==t&&(u={pattern:u.pattern,regexBegin:u.regexBegin,regexEnd:v},
t=v);for(v=n;!r;){v=d(t,b,v);v||(g.lastIndex=0,v=g.exec(b));var y=new q({start:h,end:e+v.index+v[0].length,contentStart:e+n,contentEnd:e+v.index},u,c.getStyler(),a,c),A=y.getBlocks();if(!A.length||A[A.length-1].end<=v.index+e)r=y;v=v.index+v[0].length}}else r=new q({start:h,end:h+m.result[0].length,contentStart:h,contentEnd:h+m.result[0].length},m.pattern,c.getStyler(),a,c);f.push(r);h=r.end-e}p(m,b,k,h)}return f},A=function(a,b,c){if(a.getAnnotationModel()){var d=n.AnnotationType.ANNOTATION_TASK;
if(a.getLinePatterns().length&&a.pattern&&a.pattern.pattern.name&&0===a.pattern.pattern.name.indexOf("comment")){var e=[];v(b.getText(a.contentStart,a.end),a.contentStart,a,e,!0);for(var f=0;f<e.length;f++)"meta.annotation.task.todo"===e[f].style&&c.push(n.AnnotationType.createAnnotation(d,e[f].start,e[f].end,b.getText(e[f].start,e[f].end)))}a.getBlocks().forEach(function(a){A(a,b,c)}.bind(this))}};r.prototype={getPatterns:function(a){a?(a="string"===typeof a?a:a.qualifiedId,a+="#"):a=this._rootId+
"#"+this._NO_ID;var b=[0],c={},d=RegExp("^"+a+"[^#]+$");this._patterns.forEach(function(a){d.test(a.qualifiedId)&&(a.include?this._processInclude(a,b,c):(a.index=b[0]++,c[a.id]=a))}.bind(this));var e=[];Object.keys(c).forEach(function(a){e.push(c[a])});return e},_addPatterns:function(a,b){a.forEach(function(a){this._addPattern(a,this._NO_ID+this._unnamedCounter++,b)}.bind(this))},_addRepositoryPatterns:function(a,b){Object.keys(a).forEach(function(c){this._addPattern(a[c],c,b)}.bind(this))},_addPattern:function(a,
b,c){a.parentId=c;a.id=b;a.qualifiedId=a.parentId+"#"+a.id;this._patterns.push(a);a.patterns&&!a.include&&this._addPatterns(a.patterns,a.qualifiedId)},_processInclude:function(a,b,c){var d,e=a.include.indexOf("#");d=0===e?RegExp("^"+a.qualifiedId.substring(0,a.qualifiedId.indexOf("#"))+a.include+"$"):-1===e?RegExp("^"+a.include+"#"+this._NO_ID+"[^#]+$"):RegExp("^"+a.include+"$");this._patterns.forEach(function(a){d.test(a.qualifiedId)&&(a.include?this._processInclude(a,b,c):c[a.id]||(a.index=b[0]++,
c[a.id]=a))}.bind(this))},_NO_ID:"NoID"};q.prototype={adjustEnd:function(a){this.end+=a;this.contentEnd+=a;this._subBlocks.forEach(function(b){b.adjustEnd(a)})},adjustStart:function(a){this.start+=a;this.contentStart+=a;this._subBlocks.forEach(function(b){b.adjustStart(a)})},computeStyle:function(a,b){if(!this.pattern||!(this.start<=b&&b<this.end))return null;var c={start:this.start,end:this.end,style:this.pattern.pattern.name};if(this.contentStart<=b&&b<this.contentEnd)return this.pattern.pattern.contentName?
{start:this.contentStart,end:this.contentEnd,style:this.pattern.pattern.contentName}:c;var d,e,f,g;if(b<this.contentStart){e=this.pattern.pattern.beginCaptures||this.pattern.pattern.captures;if(!e)return c;d=this.pattern.regexBegin;f=a.getText(this.start,this.contentStart);g=this.start}else{e=this.pattern.pattern.endCaptures||this.pattern.pattern.captures;if(!e)return c;d=this.pattern.regexEnd;f=a.getText(this.contentEnd,this.end);g=this.contentEnd}d.lastIndex=0;if(f=d.exec(f)){d=[];u(f,e,g,d);for(e=
0;e<d.length;e++)if(d[e].start<=b&&b<d[e].end)return d[e]}return c},getAnnotationModel:function(){return this._styler._getAnnotationModel()},getBlockPatterns:function(){return this._blockPatterns},getBlocks:function(){return this._subBlocks},getEnclosurePatterns:function(){return this._enclosurePatterns},getLinePatterns:function(){return this._linePatterns},getParent:function(){return this._parent},getPatternManager:function(){return this._styler._getPatternManager()},getPatterns:function(){return this.getLinePatterns()},
getStyler:function(){return this._styler},isRenderingWhitespace:function(){return this._styler._isRenderingWhitespace()},_initPatterns:function(){if(this.pattern&&this.pattern.pattern._linePatterns)this._linePatterns=this.pattern.pattern._linePatterns,this._blockPatterns=this.pattern.pattern._blockPatterns,this._enclosurePatterns=this.pattern.pattern._enclosurePatterns;else{var a=function(a){a="string"===typeof a?a:a.match;var b=h.exec(a),c="g";b&&(a=a.substring(b[0].length),c+="i");return RegExp(a,
c)},b=-1,c=0;this.getPatternManager().getPatterns(this.pattern?this.pattern.pattern:null).forEach(function(d){var e;if(d.match&&!d.begin&&!d.end){if(e={regex:a(d.match),pattern:d},this._linePatterns.push(e),d.name&&0===d.name.indexOf("punctuation.section")&&(-1!==d.name.indexOf(".begin")||-1!==d.name.indexOf(".end")))this._enclosurePatterns[d.name]=e}else!d.match&&(d.begin&&d.end)&&(b=c,e={regexBegin:a(d.begin),regexEnd:a(d.end),pattern:d},this._linePatterns.push(e));c++}.bind(this));this._blockPatterns=
this._linePatterns.slice(0,b+1);this.pattern&&(this.pattern.pattern._enclosurePatterns=this._enclosurePatterns,this.pattern.pattern._linePatterns=this._linePatterns,this.pattern.pattern._blockPatterns=this._blockPatterns)}}};k.prototype={getPatterns:function(a){return this._styler.getPatterns(a)},getStyles:function(a){return this._styler.getStyles(a)}};b.prototype={destroy:function(){var a=this.view;if(a){var b=a.getModel();b.getBaseModel&&(b=b.getBaseModel());b.removeEventListener("Changed",this._listener.onChanged);
a.removeEventListener("MouseDown",this._listener.onMouseDown);a.removeEventListener("Selection",this._listener.onSelection);a.removeEventListener("Destroy",this._listener.onDestroy);a.removeEventListener("LineStyle",this._listener.onLineStyle);this.view=null}},getPatterns:function(a){return this._findBlock(this._rootBlock,a).getPatterns()},getStyleAccessor:function(){return this._accessor},getStyles:function(a){var b=[],c=this.view.getModel();c.getBaseModel&&(c=c.getBaseModel());var d=this._findBlock(this._rootBlock,
a),e=c.getLineAtOffset(a),f=c.getLine(e),g=[];v(f,c.getLineStart(e),d,g);for(e=0;e<g.length&&!(a<g[e].start);e++)if(g[e].start<=a&&a<g[e].end){b.push(g[e]);break}for(;d;)(g=d.computeStyle(c,a))&&b.splice(0,0,g),d=d.getParent();return b},setHighlightCaretLine:function(a){this.highlightCaretLine=a},setWhitespacesVisible:function(a,b){this.whitespacesVisible!==a&&(this.whitespacesVisible=a,b&&this.view.redraw())},setTabsVisible:function(a){this.tabsVisible!==a&&(this.tabsVisible=a,this.setWhitespacesVisible(this.tabsVisible||
this.spacesVisible,!1),this.view.redraw())},setSpacesVisible:function(a){this.spacesVisible!==a&&(this.spacesVisible=a,this.setWhitespacesVisible(this.tabsVisible||this.spacesVisible,!1),this.view.redraw())},setDetectHyperlinks:function(a){},setFoldingEnabled:function(a){this.foldingEnabled=a},setDetectTasks:function(a){this.detectTasks=a},_binarySearch:function(a,b,c,d,e){var f;void 0===d&&(d=-1);void 0===e&&(e=a.length);for(;1<e-d;)if(f=Math.floor((e+d)/2),b<=a[f].start)e=f;else if(c&&b<a[f].end){e=
f;break}else d=f;return e},_computeFolding:function(a){if(this.foldingEnabled){var b=this.view.getModel();if(b.getBaseModel){var c=this.annotationModel;if(c){c.removeAnnotations(n.AnnotationType.ANNOTATION_FOLDING);for(var d=[],e=b.getBaseModel(),f=0;f<a.length;f++){var g=a[f];(g=this._createFoldingAnnotation(b,e,g.start,g.end))&&d.push(g)}c.replaceAnnotations(null,d)}}}},_createFoldingAnnotation:function(a,b,c,d){var e=b.getLineAtOffset(c);b=b.getLineAtOffset(d);return e===b?null:new (n.AnnotationType.getType(n.AnnotationType.ANNOTATION_FOLDING))(c,
d,a)},_findBlock:function(a,b){var c=a.getBlocks();if(!c.length)return a;var d=this._binarySearch(c,b,!0);return d<c.length&&c[d].start<=b&&b<c[d].end?this._findBlock(c[d],b):a},_findBrackets:function(a,b,c,d,e,f){for(var g=[],k=[],h=e,m=c.getBlocks(),n=this._binarySearch(m,e,!0);n<m.length&&!(m[n].start>=f);n++){var p=m[n].start,q=m[n].end;h<p&&(v(d.substring(h-e,p-e),h,c,k),k.forEach(function(c){0===c.style.indexOf(a.pattern.name)?g.push(c.start+1):0===c.style.indexOf(b.pattern.name)&&g.push(-(c.start+
1))}),k=[]);h=q}h<f&&(v(d.substring(h-e,f-e),h,c,k),k.forEach(function(c){c.style&&(0===c.style.indexOf(a.pattern.name)?g.push(c.start+1):0===c.style.indexOf(b.pattern.name)&&g.push(-(c.start+1)))}));return g},_findMatchingBracket:function(a,b,c){for(var e=a.getLineAtOffset(c),f=a.getLineEnd(e),g=a.getText(c,f),k,h=b.getEnclosurePatterns(),m=Object.keys(h),n=0;n<m.length;n++){var p=h[m[n]],q=d(p.regex,g,0);if(q&&0===q.index){k=p;break}}if(!k)return-1;g=!1;-1!==k.pattern.name.indexOf(".begin")?(g=
!0,n=k.pattern.name.replace(".begin",".end")):n=k.pattern.name.replace(".end",".begin");h=h[n];if(!h)return-1;m=a.getLine(e);p=a.getLineStart(e);f=this._findBrackets(k,h,b,m,p,f);for(n=0;n<f.length;n++)if(m=0<=f[n]?1:-1,f[n]*m-1===c){c=1;if(g){for(n++;n<f.length;n++)if(m=0<=f[n]?1:-1,c+=m,0===c)return f[n]*m-1;e+=1;for(n=a.getLineCount();e<n;){m=a.getLine(e);p=a.getLineStart(e);f=a.getLineEnd(e);f=this._findBrackets(k,h,b,m,p,f);for(g=0;g<f.length;g++)if(m=0<=f[g]?1:-1,c+=m,0===c)return f[g]*m-1;
e++}}else{for(n--;0<=n;n--)if(m=0<=f[n]?1:-1,c+=m,0===c)return f[n]*m-1;for(e-=1;0<=e;){m=a.getLine(e);p=a.getLineStart(e);f=a.getLineEnd(e);f=this._findBrackets(k,h,b,m,p,f);for(n=f.length-1;0<=n;n--)if(m=0<=f[n]?1:-1,c+=m,0===c)return f[n]*m-1;e--}}break}return-1},_getAnnotationModel:function(){return this.annotationModel},_getLineStyle:function(a){if(this.highlightCaretLine){var b=this.view,c=b.getModel(),b=b.getSelection();if(b.start===b.end&&c.getLineAtOffset(b.start)===a)return f}return null},
_getPatternManager:function(){return this.patternManager},_getStyles:function(a,b,c,e){b.getBaseModel&&(e=b.mapOffset(e));for(var f=e+c.length,g=[],k=e,h=a.getBlocks(),m=this._binarySearch(h,e,!0);m<h.length&&!(h[m].start>=f);m++){var n=h[m].start,p=h[m].end;k<n&&v(c.substring(k-e,n-e),k,a,g);var q=Math.max(k,n);if(q===n&&h[m].pattern.regexBegin){var r=d(h[m].pattern.regexBegin,c.substring(q-e),0);if(r){var s=h[m].pattern.pattern.beginCaptures||h[m].pattern.pattern.captures;s?u(r,s,q,g):g.push({start:q,
end:q+r[0].length,style:h[m].pattern.pattern.name});q+=r[0].length}}var n=Math.min(f,p),t=[];if(n===p&&h[m].pattern.regexEnd&&(k=c.substring(n-k-(h[m].end-h[m].contentEnd)),r=d(h[m].pattern.regexEnd,k,0)))(s=h[m].pattern.pattern.endCaptures||h[m].pattern.pattern.captures)?u(r,s,n-r[0].length,t):h[m].pattern.pattern.name&&t.push({start:n-r[0].length,end:n,style:h[m].pattern.pattern.name}),n-=r[0].length;var k=this._getStyles(h[m],b,c.substring(q-e,n-e),q),y=h[m].pattern.pattern.contentName||h[m].pattern.pattern.name;
if(y){var H=q;k.forEach(function(a){a.start-H&&g.push({start:H,end:a.start,style:y});g.push(a);H=a.end});n-H&&g.push({start:H,end:n,style:y})}else g=g.concat(k);g=g.concat(t);k=p}k<f&&v(c.substring(k-e,f-e),k,a,g);if(b.getBaseModel)for(a=0;a<g.length;a++)c=g[a].end-g[a].start,g[a].start=b.mapOffset(g[a].start,!0),g[a].end=g[a].start+c;return g},_isRenderingWhitespace:function(){return this.whitespacesVisible&&(this.tabsVisible||this.spacesVisible)},_onDestroy:function(a){this.destroy()},_onLineStyle:function(b){b.textView===
this.view&&(b.style=this._getLineStyle(b.lineIndex));b.ranges=this._getStyles(this._rootBlock,b.textView.getModel(),b.lineText,b.lineStart);b.ranges.forEach(function(a){a.style&&(a.style={styleClass:a.style.replace(/\./g," ")})});this._isRenderingWhitespace()&&(this.spacesVisible&&this._spliceStyles(a,b.ranges,b.lineText,b.lineStart),this.tabsVisible&&this._spliceStyles(c,b.ranges,b.lineText,b.lineStart))},_onSelection:function(a){var b=a.oldValue,c=a.newValue,d=this.view;a=d.getModel();var e;if(this.highlightCaretLine){var f=
a.getLineAtOffset(b.start);e=a.getLineAtOffset(c.start);var g=c.start===c.end,b=b.start===b.end;f===e&&b&&g||(b&&d.redrawLines(f,f+1),(f!==e||!b)&&g&&d.redrawLines(e,e+1))}if(this.annotationModel){var b=this._bracketAnnotations,k,h;if(c.start===c.end&&0<(h=d.getCaretOffset()))h-=1,a.getBaseModel&&(h=a.mapOffset(h),a=a.getBaseModel()),c=this._findBlock(this._rootBlock,h),a=this._findMatchingBracket(a,c,h),-1!==a&&(k=[n.AnnotationType.createAnnotation(n.AnnotationType.ANNOTATION_MATCHING_BRACKET,a,
a+1),n.AnnotationType.createAnnotation(n.AnnotationType.ANNOTATION_CURRENT_BRACKET,h,h+1)]);this._bracketAnnotations=k;this.annotationModel.replaceAnnotations(b,k)}},_onMouseDown:function(a){if(2===a.clickCount){var b=this.view,c=b.getModel(),d=b.getOffsetAtLocation(a.x,a.y);if(0<d){var e=d-1,f=c;c.getBaseModel&&(e=c.mapOffset(e),f=c.getBaseModel());var g=this._findBlock(this._rootBlock,e),e=this._findMatchingBracket(f,g,e);-1!==e&&(a.preventDefault(),a=e,c.getBaseModel&&(a=c.mapOffset(a,!0)),d>a&&
(d--,a++),b.setSelection(a,d))}}},_onModelChanged:function(a){var b=a.start,c=a.removedCharCount;a=a.addedCharCount-c;var d=this.view,e=d.getModel(),f=e.getBaseModel?e.getBaseModel():e,c=b+c,g=f.getCharCount(),k=this._rootBlock.getBlocks(),h=k.length,m=f.getLineStart(f.getLineAtOffset(b)),p=this._binarySearch(k,m,!0),q=this._binarySearch(k,c,!1,p-1,h),r;p<h&&k[p].start<=m&&m<k[p].end?(r=k[p].start,r>b&&(r+=a)):r=p===h&&0<h&&g-a===k[h-1].end?k[h-1].start:m;var s;do q<h?(s=k[q].end,s>b&&(s+=a),q+=1):
(q=h,s=g),m=f.getText(r,s),m=y(f,m,this._rootBlock,r);while(m.length&&k.length&&q<h&&m[m.length-1].pattern.pattern.id!==k[q-1].pattern.pattern.id);for(g=p;g<k.length;g++)h=k[g],h.start>b&&h.adjustStart(a),h.start>b&&h.adjustEnd(a);var t=q-p!==m.length;if(!t)for(g=0;g<m.length;g++){var h=k[p+g],u=m[g];if(h.start!==u.start||h.end!==u.end||h.type!==u.type){t=!0;break}}g=[p,q-p].concat(m);Array.prototype.splice.apply(k,g);t&&(g=r,h=s,e!==f&&(g=e.mapOffset(g,!0),h=e.mapOffset(h,!0)),d.redrawRange(g,h));
if(this.annotationModel){d=[];k=[];p=[];r=this.annotationModel.getAnnotations(r,s);for(s=this.foldingEnabled&&f!==e;r.hasNext();)if(h=r.next(),s&&h.type===n.AnnotationType.ANNOTATION_FOLDING){p.push(h);for(g=0;g<m.length&&!(h.start===m[g].start&&h.end===m[g].end);g++);g===m.length?(d.push(h),h.expand()):(g=h.start,q=h.end,g>b&&(g-=a),q>b&&(q-=a),g<=b&&(b<q&&g<=c&&c<q)&&(g=f.getLineAtOffset(h.start),q=f.getLineAtOffset(h.end),g!==q?h.expanded||h.expand():this.annotationModel.removeAnnotation(h)));
for(g=0;g<m.length;g++){h=m[g];for(q=0;q<p.length&&!(p[q].start===h.start&&p[q].end===h.end);q++);q===p.length&&(h=this._createFoldingAnnotation(e,f,h.start,h.end))&&k.push(h)}}else h.type===n.AnnotationType.ANNOTATION_TASK&&d.push(h);if(this.detectTasks)for(g=0;g<m.length;g++)A(m[g],f,k);this.annotationModel.replaceAnnotations(d,k)}},_spliceStyles:function(a,b,c,d){for(var e=a.regex,f=e.lastIndex=0,g=e.exec(c);g;){for(g=d+g.index;f<b.length&&!(g<b[f].end);)f++;var h={start:g,end:g+1,style:a.style};
if(f<b.length&&b[f].start<=g){var k={start:g+1,end:b[f].end,style:b[f].style};b[f].end=g;b.splice(f+1,0,k);b.splice(f+1,0,h);f+=2}else b.splice(f,0,h),f++;g=e.exec(c)}}};return{TextStyler:b}});
define("orion/editor/stylers/application_xml/syntax",["orion/editor/stylers/lib/syntax"],function(n){n=n.grammars;n.push({id:"orion.xml",contentTypes:["application/xml","application/xhtml+xml"],patterns:[{include:"#comment"},{include:"#doctype"},{include:"#xmlDeclaration"},{include:"#tag"},{include:"#ampersandEscape"}],repository:{ampersandEscape:{match:"\x26lt;|\x26gt;|\x26amp;",name:"constant.character"},comment:{begin:{match:"\x3c!--",literal:"\x3c!--"},end:{match:"--\x3e",literal:"--\x3e"},name:"comment.block.xml",
patterns:[{match:"(\\b)(TODO)(\\b)(((?!--\x3e).)*)",name:"meta.annotation.task.todo",captures:{2:{name:"keyword.other.documentation.task"},4:{name:"comment.line"}}}]},doctype:{begin:"\x3c!(?:doctype|DOCTYPE)",end:"\x3e",name:"meta.tag.doctype.xml",captures:{0:{name:"entity.name.tag.doctype.xml"}},patterns:[{include:"#comment"},{include:"orion.lib#string_doubleQuote"},{include:"orion.lib#string_singleQuote"}]},tag:{begin:"\x3c/?[A-Za-z0-9]+",end:"/?\x3e",captures:{0:{name:"entity.name.tag.xml"}},name:"meta.tag.xml",
patterns:[{include:"#comment"},{include:"orion.lib#string_doubleQuote"},{include:"orion.lib#string_singleQuote"}]},xmlDeclaration:{begin:"\x3c\\?xml",end:"\\?\x3e",captures:{0:{name:"entity.name.tag.declaration.xml"}},patterns:[{include:"#comment"},{include:"orion.lib#string_doubleQuote"},{include:"orion.lib#string_singleQuote"}],name:"meta.tag.declaration.xml"}}});return{id:n[n.length-1].id,grammars:n,keywords:[]}});
define("orion/editor/stylers/text_html/syntax",["orion/editor/stylers/lib/syntax","orion/editor/stylers/application_javascript/syntax","orion/editor/stylers/text_css/syntax","orion/editor/stylers/application_xml/syntax"],function(n,r,q,k){n=n.grammars.concat(r.grammars).concat(q.grammars).concat(k.grammars);n.push({id:"orion.html",contentTypes:["text/html"],patterns:[{begin:"(?i)(\x3cstyle)([^\x3e]*)(\x3e)",end:"(?i)(\x3c/style\x3e)",captures:{1:{name:"entity.name.tag.html"},3:{name:"entity.name.tag.html"}},
contentName:"source.css.embedded.html",patterns:[{include:"orion.css"}]},{begin:"(?i)\x3cscript\\s*\x3e|\x3cscript\\s.*?(?:language\\s*\x3d\\s*(['\"])javascript\\1|type\\s*\x3d\\s*(['\"])(?:text|application)/(?:javascript|ecmascript)\\2).*?\x3e",end:"(?i)\x3c/script\x3e",captures:{0:{name:"entity.name.tag.html"}},contentName:"source.js.embedded.html",patterns:[{include:"orion.js"}]},{include:"orion.xml#comment"},{include:"orion.xml#doctype"},{include:"orion.xml#tag"},{include:"orion.xml#ampersandEscape"}]});
return{id:n[n.length-1].id,grammars:n,keywords:[]}});
define("orion/editor/edit","require orion/editor/shim orion/editor/textView orion/editor/textModel orion/editor/textTheme orion/editor/projectionTextModel orion/editor/eventTarget orion/keyBinding orion/editor/rulers orion/editor/annotations orion/editor/tooltip orion/editor/undoStack orion/editor/textDND orion/editor/editor orion/editor/editorFeatures orion/editor/contentAssist orion/editor/cssContentAssist orion/editor/htmlContentAssist orion/editor/jsTemplateContentAssist orion/editor/AsyncStyler orion/editor/mirror orion/editor/textMateStyler orion/editor/htmlGrammar orion/editor/textStyler orion/editor/stylers/application_javascript/syntax orion/editor/stylers/text_css/syntax orion/editor/stylers/text_html/syntax".split(" "),function(n,
r,q,k,b,f,g,m,h,e,a,c,d,s,p,u,t,v,y,A,w,B,l,z,x,C,F){function N(a,b,c){for(var d;c&&c!==b&&"none"!==d;)d=a.getComputedStyle?a.getComputedStyle(c,null).getPropertyValue("display"):c.currentStyle.display,c=c.parentNode;return!c||!d?"none":d}function P(a){var b=a.firstChild;if(b&&"TEXTAREA"===b.tagName)return b.value;var c=a.ownerDocument,d=c.defaultView||c.parentWindow;if(!d.getSelection||1===a.childNodes.length&&b.nodeType===Node.TEXT_NODE||"none"===N(d,c,a))return a.innerText||a.textContent;b=c.createRange();
b.selectNode(a);a=d.getSelection();d=[];for(c=0;c<a.rangeCount;c++)d.push(a.getRangeAt(c));a.removeAllRanges();a.addRange(b);b=a.toString();a.removeAllRanges();for(c=0;c<d.length;c++)a.addRange(d[c]);return b}function Q(a){if("data-editor-"===a.substring(0,12))return a=a.substring(12),a=a.replace(/-([a-z])/ig,function(a,b){return b.toUpperCase()})}function G(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}function R(a,b){var c={};G(c,b);for(var d,e=0,f=a.attributes,g=f.length;e<g;e++){d=f.item(e);
var h=Q(d.nodeName);if(h){d=d.nodeValue;if("true"===d||"false"===d)d="true"===d;c[h]=d}}return c}function S(a,b){if(a.getElementsByClassName)return a.getElementsByClassName(b);b=b.replace(/ *$/,"");return a.querySelectorAll?a.querySelectorAll((" "+b).replace(/ +/g,".")):null}function O(a){var c=a.document||document,d=a.parent;d||(d="editor");"string"===typeof d&&(d=c.getElementById(d));if(!d&&a.className){var e=S(c,a.className);if(e){a.className=void 0;1<e.length&&void 0===a.noFocus&&(a.noFocus=!0);
for(var c=[],g=e.length-1;0<=g;g--)a.parent=e[g],c.push(O(a));return c}}if(!d)throw"no parent";a=R(d,a);if("string"===typeof a.theme){var e=b.TextTheme.getTheme(a.theme),h=a.theme.lastIndexOf("/"),l=a.theme;-1!==h&&(l=l.substring(h+1));".css"===l.substring(l.length-4)&&(l=l.substring(0,l.length-4));e.setThemeClass(l,{href:a.theme});a.theme=e}var m;a.readonly||(g={createContentAssistMode:function(a){m=new u.ContentAssist(a.getTextView());a=new u.ContentAssistWidget(m);a=new u.ContentAssistMode(m,a);
m.setMode(a);return a}});var r=new s.Editor({textViewFactory:function(){return new q.TextView({parent:d,model:new f.ProjectionTextModel(a.model?a.model:new k.TextModel("")),tabSize:a.tabSize?a.tabSize:4,readonly:a.readonly,fullSelection:a.fullSelection,tabMode:a.tabMode,expandTab:a.expandTab,singleMode:a.singleMode,themeClass:a.themeClass,theme:a.theme,wrapMode:a.wrapMode,wrappable:a.wrappable})},undoStackFactory:new p.UndoFactory,annotationFactory:new p.AnnotationFactory,lineNumberRulerFactory:new p.LineNumberRulerFactory,
foldingRulerFactory:new p.FoldingRulerFactory,textDNDFactory:new p.TextDNDFactory,contentAssistFactory:g,keyBindingFactory:new p.KeyBindingsFactory,statusReporter:a.statusReporter,domNode:d});r.addEventListener("TextViewInstalled",function(){var b=r.getLineNumberRuler();b&&void 0!==a.firstLineIndex&&b.setFirstLine(a.firstLineIndex);if(b=r.getSourceCodeActions())b.setAutoPairParentheses(a.autoPairParentheses),b.setAutoPairBraces(a.autoPairBraces),b.setAutoPairSquareBrackets(a.autoPairSquareBrackets),
b.setAutoPairAngleBrackets(a.autoPairAngleBrackets),b.setAutoPairQuotations(a.autoPairQuotations),b.setAutoCompleteComments(a.autoCompleteComments),b.setSmartIndentation(a.smartIndentation)});g=a.contents;void 0===g&&(g=P(d));g||(g="");r.installTextView();r.setLineNumberRulerVisible(void 0===a.showLinesRuler||a.showLinesRuler);r.setAnnotationRulerVisible(void 0===a.showAnnotationRuler||a.showFoldingRuler);r.setOverviewRulerVisible(void 0===a.showOverviewRuler||a.showOverviewRuler);r.setFoldingRulerVisible(void 0===
a.showFoldingRuler||a.showFoldingRuler);r.setInput(a.title,null,g,!1,a.noFocus);({styler:null,highlight:function(b,c){this.styler&&this.styler.destroy&&this.styler.destroy();this.styler=null;"js"===b?b="application/javascript":"css"===b?b="text/css":"html"===b?b="text/html":"java"===b&&(b="text/x-java-source");var d=c.getTextView(),e=c.getAnnotationModel();b&&(b=b.replace(/[*|:/".<>?+]/g,"_"),n(["./stylers/"+b+"/syntax"],function(a){this.styler=new z.TextStyler(d,e,a.grammars,a.id)}));"text/css"===
b&&c.setFoldingRulerVisible(void 0===a.showFoldingRuler||a.showFoldingRuler)}}).highlight(a.contentType||a.lang,r);if(m){var w=new t.CssContentAssistProvider,x=new v.HTMLContentAssistProvider,A=new y.JSTemplateContentAssistProvider;m.addEventListener("Activating",function(){/css$/.test(a.lang)?m.setProviders([w]):/js$/.test(a.lang)?m.setProviders([A]):/html$/.test(a.lang)&&m.setProviders([x])})}g=c.defaultView||c.parentWindow;!a.noComputeSize&&("none"!==N(g,c,d)&&50>=d.clientHeight)&&(c=r.getTextView().computeSize().height,
d.style.height=c+"px");return r}var K=this.orion?this.orion.editor:void 0;if(K)for(var L=0;L<arguments.length;L++)G(K,arguments[L]);return O});var orion=this.orion||(this.orion={}),editor=orion.editor||(orion.editor={});editor.edit=require("orion/editor/edit");