/*

 Copyright (c) 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2013,2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made
 available under the terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation
  Mihai Sucan (Mozilla Foundation) - fix for Bug#334583 Bug#348471 Bug#349485 Bug#350595 Bug#360726 Bug#361180 Bug#362835 Bug#362428 Bug#362286 Bug#354270 Bug#361474 Bug#363945 Bug#366312 Bug#370584

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2009, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2014 IBM Corporation and others. All rights reserved.
 This program and the accompanying materials are made available under the
 terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors: 
 IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made
 available under the terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation 

 Copyright (c) 2011, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation 

 Copyright (c) 2011, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation 

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made
 available under the terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors: IBM Corporation - initial API and implementation
               Alex Lakatos - fix for bug#369781

 Copyright (c) 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation
 RequireJS i18n 2.0.2 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/requirejs/i18n for details

 Copyright (c) 2011, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation
*/
var requirejs,require,define;
(function(p){function s(a,b){var f,e,n,q,C,y,d,h,g,c=b&&b.split("/"),v=t.map,k=v&&v["*"]||{};if(a&&"."===a.charAt(0))if(b){c=c.slice(0,c.length-1);a=c.concat(a.split("/"));for(h=0;h<a.length;h+=1)if(f=a[h],"."===f)a.splice(h,1),h-=1;else if(".."===f)if(1===h&&(".."===a[2]||".."===a[0]))break;else 0<h&&(a.splice(h-1,2),h-=2);a=a.join("/")}else 0===a.indexOf("./")&&(a=a.substring(2));if((c||k)&&v){f=a.split("/");for(h=f.length;0<h;h-=1){e=f.slice(0,h).join("/");if(c)for(g=c.length;0<g;g-=1)if(n=v[c.slice(0,
g).join("/")])if(n=n[e]){q=n;C=h;break}if(q)break;!y&&(k&&k[e])&&(y=k[e],d=h)}!q&&y&&(q=y,C=d);q&&(f.splice(0,C,q),a=f.join("/"))}return a}function r(a,b){return function(){return d.apply(p,u.call(arguments,0).concat([a,b]))}}function m(a){return function(b){return s(b,a)}}function c(a){return function(b){f[a]=b}}function k(a){if(v.call(n,a)){var b=n[a];delete n[a];e[a]=!0;g.apply(p,b)}if(!v.call(f,a)&&!v.call(e,a))throw Error("No "+a);return f[a]}function h(a){var b,f=a?a.indexOf("!"):-1;-1<f&&(b=
a.substring(0,f),a=a.substring(f+1,a.length));return[b,a]}function l(a){return function(){return t&&t.config&&t.config[a]||{}}}var g,d,a,b,f={},n={},t={},e={},v=Object.prototype.hasOwnProperty,u=[].slice;a=function(a,b){var f,e=h(a),n=e[0];a=e[1];n&&(n=s(n,b),f=k(n));n?a=f&&f.normalize?f.normalize(a,m(b)):s(a,b):(a=s(a,b),e=h(a),n=e[0],a=e[1],n&&(f=k(n)));return{f:n?n+"!"+a:a,n:a,pr:n,p:f}};b={require:function(a){return r(a)},exports:function(a){var b=f[a];return"undefined"!==typeof b?b:f[a]={}},
module:function(a){return{id:a,uri:"",exports:f[a],config:l(a)}}};g=function(h,d,g,t){var l,q,C,y,A=[],G;t=t||h;if("function"===typeof g){d=!d.length&&g.length?["require","exports","module"]:d;for(y=0;y<d.length;y+=1)if(C=a(d[y],t),q=C.f,"require"===q)A[y]=b.require(h);else if("exports"===q)A[y]=b.exports(h),G=!0;else if("module"===q)l=A[y]=b.module(h);else if(v.call(f,q)||v.call(n,q)||v.call(e,q))A[y]=k(q);else if(C.p)C.p.load(C.n,r(t,!0),c(q),{}),A[y]=f[q];else throw Error(h+" missing "+q);d=g.apply(f[h],
A);if(h)if(l&&l.exports!==p&&l.exports!==f[h])f[h]=l.exports;else if(d!==p||!G)f[h]=d}else h&&(f[h]=g)};requirejs=require=d=function(f,e,n,h,c){if("string"===typeof f)return b[f]?b[f](e):k(a(f,e).f);f.splice||(t=f,e.splice?(f=e,e=n,n=null):f=p);e=e||function(){};"function"===typeof n&&(n=h,h=c);h?g(p,f,e,n):setTimeout(function(){g(p,f,e,n)},4);return d};d.config=function(a){t=a;return d};define=function(a,b,e){b.splice||(e=b,b=[]);!v.call(f,a)&&!v.call(n,a)&&(n[a]=[a,b,e])};define.amd={jQuery:!0}})();
define("almond",function(){});define("orion/editor/config",[],function(){return{languages:{}}});
define("orion/editor/shim",[],function(){Object.create||(Object.create=function(p,s){function r(){}r.prototype=p;var m=new r;if(s)for(var c in s)s.hasOwnProperty(c)&&(s[c].hasOwnProperty("value")?m[c]=s[c].value:m[c]=function(){if(0<arguments.length)return s[c].get();s[c].set(arguments)});return m});Object.keys||(Object.keys=function(p){var s=Object.prototype.hasOwnProperty,r=[],m;for(m in p)s.call(p,m)&&r.push(m);return r});Function.prototype.bind||(Function.prototype.bind=function(p){var s=this,
r=Array.prototype.slice.call(arguments,1);return r.length?function(){return arguments.length?s.apply(p,r.concat(Array.prototype.slice.call(arguments))):s.apply(p,r)}:function(){return arguments.length?s.apply(p,arguments):s.call(p)}});Array.isArray||(Array.isArray=function(p){return"[object Array]"===Object.prototype.toString.call(p)});Array.prototype.indexOf||(Array.prototype.indexOf=function(p){for(var s=0;s<this.length;s++)if(this[s]===p)return s;return-1});Array.prototype.forEach||(Array.prototype.forEach=
function(p){for(var s=0;s<this.length;s++)p(this[s],s)});Array.prototype.map||(Array.prototype.map=function(p){for(var s=Array(this.length),r=0;r<this.length;r++)s[r]=p(this[r]);return s});Array.prototype.reduce||(Array.prototype.reduce=function(p,s){var r,m=!1;1<arguments.length&&(r=s,m=!0);for(var c=0;this.length>c;++c)m?r=p(r,this[c],c,this):(r=this[c],m=!0);return r});String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});String.prototype.trimLeft||(String.prototype.trimLeft=
function(){return this.replace(/^\s+/g,"")});String.prototype.trimRight||(String.prototype.trimRight=function(){return this.replace(/\s+$/g,"")});return{}});
(function(){function p(c,k,h,l,g,d){k[c]&&(h.push(c),(!0===k[c]||1===k[c])&&l.push(g+c+"/"+d))}function s(c,k,h,l,g){k=l+k+"/"+g;require._fileExists(c.toUrl(k+".js"))&&h.push(k)}function r(c,k,h){for(var l in k)k.hasOwnProperty(l)&&(!c.hasOwnProperty(l)||h)?c[l]=k[l]:"object"===typeof k[l]&&r(c[l],k[l],h)}var m=/(^.*(^|\/)nls(\/|$))([^\/]*)\/?([^\/]*)/;define("i18n",["module"],function(c){var k=c.config?c.config():{},k=k||{};return{version:"2.0.1+",load:function(h,c,g,d){d=d||{};d.locale&&(k.locale=
d.locale);var a=m.exec(h),b=a[1],f=a[4],n=a[5],t=f.split("-"),e=[],v={},u,x="";a[5]?(b=a[1],h=b+n):(n=a[4],f=k.locale,f||(f=k.locale="undefined"===typeof navigator?"root":(navigator.language||navigator.userLanguage||"root").toLowerCase()),t=f.split("-"));if(d.isBuild){e.push(h);s(c,"root",e,b,n);for(u=0;u<t.length;u++)d=t[u],x+=(x?"-":"")+d,s(c,x,e,b,n);c(e,function(){g()})}else c([h],function(a){var f=[],h;p("root",a,f,e,b,n);for(u=0;u<t.length;u++)h=t[u],x+=(x?"-":"")+h,p(x,a,f,e,b,n);c(e,function(){var e,
q,C;for(e=f.length-1;-1<e&&f[e];e--){C=f[e];q=a[C];if(!0===q||1===q)q=c(b+C+"/"+n);r(v,q)}g(v)})})}}})})();define("orion/editor/i18n",{load:function(p,s,r,m){s.specified&&s.specified("orion/bootstrap")?s(["orion/i18n!"+p],function(c){r(c)}):s(["orion/editor/config"],function(c){r(c&&c.languages||{})})}});
define("orion/editor/nls/root/messages",{multipleAnnotations:"Multiple annotations:",line:"Line: ${0}",breakpoint:"Breakpoint",bookmark:"Bookmark",task:"Task",error:"Error",warning:"Warning",matchingSearch:"Matching Search",currentSearch:"Current Search",currentLine:"Current Line",matchingBracket:"Matching Bracket",currentBracket:"Current Bracket",lineUp:"Line Up",lineDown:"Line Down",lineStart:"Line Start",lineEnd:"Line End",charPrevious:"Previous Character",charNext:"Next Character",pageUp:"Page Up",
pageDown:"Page Down",scrollPageUp:"Scroll Page Up",scrollPageDown:"Scroll Page Down",scrollLineUp:"Scroll Line Up",scrollLineDown:"Scroll Line Down",wordPrevious:"Previous Word",wordNext:"Next Word",textStart:"Document Start",textEnd:"Document End",scrollTextStart:"Scroll Document Start",scrollTextEnd:"Scroll Document End",centerLine:"Center Line",selectLineUp:"Select Line Up",selectLineDown:"Select Line Down",selectWholeLineUp:" Select Whole Line Up",selectWholeLineDown:"Select Whole Line Down",
selectLineStart:"Select Line Start",selectLineEnd:"Select Line End",selectCharPrevious:"Select Previous Character",selectCharNext:"Select Next Character",selectPageUp:"Select Page Up",selectPageDown:"Select Page Down",selectWordPrevious:"Select Previous Word",selectWordNext:"Select Next Word",selectTextStart:"Select Document Start",selectTextEnd:"Select Document End",deletePrevious:"Delete Previous Character",deleteNext:"Delete Next Character",deleteWordPrevious:"Delete Previous Word",deleteWordNext:"Delete Next Word",
deleteLineStart:"Delete Line Start",deleteLineEnd:"Delete Line End",tab:"Insert Tab",enter:"Insert Line Delimiter",enterNoCursor:"Insert Line Delimiter",selectAll:"Select All",copy:"Copy",cut:"Cut",paste:"Paste",uppercase:"To Upper Case",lowercase:"To Lower Case",capitalize:"Capitalize",reversecase:"Reverse Case",toggleWrapMode:"Toggle Wrap Mode",toggleTabMode:"Toggle Tab Mode",toggleOverwriteMode:"Toggle Overwrite Mode",committerOnTime:"${0} on ${1}",emacs:"Emacs",exchangeMarkPoint:"Exchange Mark and Point",
setMarkCommand:"Set Mark",clearMark:"Clear Mark",digitArgument:"Digit Argument ${0}",negativeArgument:"Negative Argument",Comment:"Comment","Flat outline":"Flat outline",incrementalFindStr:"Incremental find: ${0}",incrementalFindStrNotFound:"Incremental find: ${0} (not found)",incrementalFindReverseStr:"Reverse Incremental find: ${0}",incrementalFindReverseStrNotFound:"Reverse Incremental find: ${0} (not found)",find:"Find...",undo:"Undo",redo:"Redo",cancelMode:"Cancel Current Mode",findNext:"Find Next Occurrence",
findPrevious:"Find Previous Occurrence",incrementalFind:"Incremental Find",incrementalFindReverse:"Incremental Find Reverse",indentLines:"Indent Lines",unindentLines:"Unindent Lines",moveLinesUp:"Move Lines Up",moveLinesDown:"Move Lines Down",copyLinesUp:"Copy Lines Up",copyLinesDown:"Copy Lines Down",deleteLines:"Delete Lines",gotoLine:"Goto Line...",gotoLinePrompty:"Goto Line:",nextAnnotation:"Next Annotation",prevAnnotation:"Previous Annotation",expand:"Expand",collapse:"Collapse",expandAll:"Expand All",
collapseAll:"Collapse All",lastEdit:"Last Edit Location",trimTrailingWhitespaces:"Trim Trailing Whitespaces",toggleLineComment:"Toggle Line Comment",addBlockComment:"Add Block Comment",removeBlockComment:"Remove Block Comment",linkedModeEntered:"Linked Mode entered",linkedModeExited:"Linked Mode exited",syntaxError:"Syntax Error",contentAssist:"Content Assist",lineColumn:"Line ${0} : Col ${1}",vi:"vi",vimove:"(Move)",viyank:"(Yank)",videlete:"(Delete)",vichange:"(Change)",viLeft:"${0} Left",viRight:"${0} Right",
viUp:"${0} Up",viDown:"${0} Down",viw:"${0} Next Word",vib:"${0} Beginning of Word",viW:"${0} Next Word (ws stop)",viB:"${0} Beginning of Word (ws stop)",vie:"${0} End of Word",viE:"${0} End of Word (ws stop)",vi$:"${0} End of the line","vi^_":"${0} First non-blank Char Current Line","vi+":"${0} First Char Next Line","vi-":"${0} First Char Previous Line","vi|":"${0} nth Column in Line",viH:"${0} Top of Page",viM:"${0} Middle of Page",viL:"${0} Bottom of Page","vi/":"${0} Search Forward","vi?":"${0} Search Backward",
vin:"${0} Next Search",viN:"${0} Previous Search",vif:"${0} Search Char Fwd",viF:"${0} Search Char Bckwd",vit:"${0} Search Before Char Fwd",viT:"${0} Search Before Char Bckwd","vi,":"${0} Repeat Reverse Char Search","vi;":"${0} Repeat Char Search",viG:"${0} Go to Line",viycd:"${0} Current Line",via:"Append After Cursor",viA:"Append to End of Line",vii:"Insert Before Cursor",viI:"Insert at Beginning of Line",viO:"Insert Line Above",vio:"Insert Line Below",viR:"Begin Overwriting Text",vis:"Substitute a Character",
viS:"Substitute Entire Line",viC:"Change Text Until Line End",vip:"Paste After Char or Line",viP:"Paste Before Char or Line",viStar:"Search Word Under Cursor",next:"Next",previous:"Previous",replace:"Replace",replaceAll:"Replace All",findWith:"Find With",replaceWith:"Replace With",caseInsensitive:"Aa",regex:"/.*/",wholeWord:"\\b",caseInsensitiveTooltip:"Toggle Case Insensitive",regexTooltip:"Toggle Regex",wholeWordTooltip:"Toggle Whole Word",closeTooltip:"Close",replacingAll:"Replacing all...",replacedMatches:"Replaced ${0} matches",
nothingReplaced:"Nothing replaced",notFound:"Not found"});define("orion/editor/nls/messages",["orion/editor/i18n!orion/editor/nls/messages","orion/editor/nls/root/messages"],function(p,s){var r={root:s},m;for(m in p)p.hasOwnProperty(m)&&"undefined"===typeof r[m]&&(r[m]=p[m]);return r});
define("orion/editor/eventTarget",[],function(){function p(){}p.addMixin=function(s){var r=p.prototype,m;for(m in r)r.hasOwnProperty(m)&&(s[m]=r[m])};p.prototype={addEventListener:function(p,r,m){this._eventTypes||(this._eventTypes={});var c=this._eventTypes[p];c||(c=this._eventTypes[p]={level:0,listeners:[]});c.listeners.push({listener:r,useCapture:m})},dispatchEvent:function(p){var r=p.type;this._dispatchEvent("pre"+r,p);this._dispatchEvent(r,p);this._dispatchEvent("post"+r,p)},_dispatchEvent:function(p,
r){var m=this._eventTypes?this._eventTypes[p]:null;if(m){var c=m.listeners;try{if(m.level++,c)for(var k=0,h=c.length;k<h;k++)if(c[k]){var l=c[k].listener;"function"===typeof l?l.call(this,r):l.handleEvent&&"function"===typeof l.handleEvent&&l.handleEvent(r)}}finally{if(m.level--,m.compact&&0===m.level){for(k=c.length-1;0<=k;k--)c[k]||c.splice(k,1);0===c.length&&delete this._eventTypes[p];m.compact=!1}}}},isListening:function(p){return!this._eventTypes?!1:void 0!==this._eventTypes[p]},removeEventListener:function(p,
r,m){if(this._eventTypes){var c=this._eventTypes[p];if(c){for(var k=c.listeners,h=0,l=k.length;h<l;h++){var g=k[h];if(g&&g.listener===r&&g.useCapture===m){0!==c.level?(k[h]=null,c.compact=!0):k.splice(h,1);break}}0===k.length&&delete this._eventTypes[p]}}}};return{EventTarget:p}});define("orion/regex",[],function(){return{escape:function(p){return p.replace(/([\\$\^*\/+?\.\(\)|{}\[\]])/g,"\\$\x26")},parse:function(p){return(p=/^\s*\/(.+)\/([gim]{0,3})\s*$/.exec(p))?{pattern:p[1],flags:p[2]}:null}}});
define("orion/util",[],function(){var p=navigator.userAgent,s=-1!==p.indexOf("MSIE")||-1!==p.indexOf("Trident")?document.documentMode:void 0,r=parseFloat(p.split("Firefox/")[1]||p.split("Minefield/")[1])||void 0,m=-1!==p.indexOf("Opera")?parseFloat(p.split("Version/")[1]):void 0,c=parseFloat(p.split("Chrome/")[1])||void 0,k=-1!==p.indexOf("Safari")&&!c,h=parseFloat(p.split("WebKit/")[1])||void 0,l=-1!==p.indexOf("Android"),g=-1!==p.indexOf("iPad"),p=-1!==p.indexOf("iPhone"),d=g||p,a=-1!==navigator.platform.indexOf("Mac"),
b=-1!==navigator.platform.indexOf("Win"),f=-1!==navigator.platform.indexOf("Linux"),n="undefined"!==typeof document&&"ontouchstart"in document.createElement("input");return{formatMessage:function(a){var b=arguments;return a.replace(/\$\{([^\}]+)\}/g,function(a,f){return b[(f<<0)+1]})},createElement:function(a,b){return a.createElementNS?a.createElementNS("http://www.w3.org/1999/xhtml",b):a.createElement(b)},isIE:s,isFirefox:r,isOpera:m,isChrome:c,isSafari:k,isWebkit:h,isAndroid:l,isIPad:g,isIPhone:p,
isIOS:d,isMac:a,isWindows:b,isLinux:f,isTouch:n,platformDelimiter:b?"\r\n":"\n"}});
define("orion/editor/textModel",["orion/editor/eventTarget","orion/regex","orion/util"],function(p,s,r){function m(c,k){this._lastLineIndex=-1;this._text=[""];this._lineOffsets=[0];this.setText(c);this.setLineDelimiter(k)}m.prototype={destroy:function(){},find:function(c){1<this._text.length&&(this._text=[this._text.join("")]);var k=c.string,h=c.regex,l=k,g="",d=c.caseInsensitive;if(l)if(h){if(k=s.parse(l))l=k.pattern,g=k.flags}else l=k.replace(/([\\$\^*\/+?\.\(\)|{}\[\]])/g,"\\$\x26"),d&&(l=l.replace(/[iI\u0130\u0131]/g,
"[Ii\u0130\u0131]"));var a=null,b;if(l){var k=c.reverse,f=c.wrap,h=c.wholeWord,n=c.start||0;c=c.end;var t=null!==c&&void 0!==c;-1===g.indexOf("g")&&(g+="g");-1===g.indexOf("m")&&(g+="m");d&&-1===g.indexOf("i")&&(g+="i");h&&(l="\\b"+l+"\\b");var e=this._text[0],v,u,m=0;t&&(d=n<c?n:c,e=e.substring(d,n<c?c:n),m=d);var w=RegExp(l,g);k?b=function(){var a=null;for(w.lastIndex=0;;){u=w.lastIndex;v=w.exec(e);if(u===w.lastIndex)return null;if(v){if(!(v.index+m<n)){if(!f||a)break;n=e.length+m}a={start:v.index+
m,end:w.lastIndex+m}}else break}a&&(n=a.start);return a}:(t||(w.lastIndex=n),b=function(){for(;;){u=w.lastIndex;v=w.exec(e);if(u===w.lastIndex)break;if(v)return{start:v.index+m,end:w.lastIndex+m};if(!(0!==u&&f))break}return null});a=b()}return{next:function(){var f=a;f&&(a=b());return f},hasNext:function(){return null!==a}}},getCharCount:function(){for(var c=0,k=0;k<this._text.length;k++)c+=this._text[k].length;return c},getLine:function(c,k){var h=this.getLineCount();if(!(0<=c&&c<h))return null;
var l=this._lineOffsets[c];if(c+1<h){h=this.getText(l,this._lineOffsets[c+1]);if(k)return h;for(var l=h.length,g;10===(g=h.charCodeAt(l-1))||13===g;)l--;return h.substring(0,l)}return this.getText(l)},getLineAtOffset:function(c){var k=this.getCharCount();if(!(0<=c&&c<=k))return-1;var h=this.getLineCount();if(c===k)return h-1;var l,g,d=this._lastLineIndex;if(0<=d&&d<h&&(l=this._lineOffsets[d],g=d+1<h?this._lineOffsets[d+1]:k,l<=c&&c<g))return d;for(var a=h,b=-1;1<a-b;)if(d=Math.floor((a+b)/2),l=this._lineOffsets[d],
g=d+1<h?this._lineOffsets[d+1]:k,c<=l)a=d;else if(c<g){a=d;break}else b=d;return this._lastLineIndex=a},getLineCount:function(){return this._lineOffsets.length},getLineDelimiter:function(){return this._lineDelimiter},getLineEnd:function(c,k){var h=this.getLineCount();if(!(0<=c&&c<h))return-1;if(c+1<h){h=this._lineOffsets[c+1];if(k)return h;for(var l=this.getText(Math.max(this._lineOffsets[c],h-2),h),g=l.length,d;10===(d=l.charCodeAt(g-1))||13===d;)g--;return h-(l.length-g)}return this.getCharCount()},
getLineStart:function(c){return!(0<=c&&c<this.getLineCount())?-1:this._lineOffsets[c]},getText:function(c,k){void 0===c&&(c=0);void 0===k&&(k=this.getCharCount());if(c===k)return"";for(var h=0,l=0,g;l<this._text.length;){g=this._text[l].length;if(c<=h+g)break;h+=g;l++}for(var d=h,a=l;l<this._text.length;){g=this._text[l].length;if(k<=h+g)break;h+=g;l++}if(a===l)return this._text[a].substring(c-d,k-h);d=this._text[a].substring(c-d);h=this._text[l].substring(0,k-h);return d+this._text.slice(a+1,l).join("")+
h},onChanging:function(c){return this.dispatchEvent(c)},onChanged:function(c){return this.dispatchEvent(c)},setLineDelimiter:function(c,k){"auto"===c&&(c=void 0,1<this.getLineCount()&&(c=this.getText(this.getLineEnd(0),this.getLineEnd(0,!0))));this._lineDelimiter=c?c:r.platformDelimiter;if(k){var h=this.getLineCount();if(1<h){for(var l=Array(h),g=0;g<h;g++)l[g]=this.getLine(g);this.setText(l.join(this._lineDelimiter))}}},setText:function(c,k,h){void 0===c&&(c="");void 0===k&&(k=0);void 0===h&&(h=
this.getCharCount());if(!(k===h&&""===c)){for(var l=this.getLineAtOffset(k),g=this.getLineAtOffset(h),d=k,a=h-k,b=g-l,f=c.length,n=0,t=this.getLineCount(),e=0,v=0,u=0,m=[];;){-1!==e&&e<=u&&(e=c.indexOf("\r",u));-1!==v&&v<=u&&(v=c.indexOf("\n",u));if(-1===v&&-1===e)break;u=-1!==e&&-1!==v?e+1===v?v+1:(e<v?e:v)+1:-1!==e?e+1:v+1;m.push(k+u);n++}this.onChanging({type:"Changing",text:c,start:d,removedCharCount:a,addedCharCount:f,removedLineCount:b,addedLineCount:n});0===m.length&&(u=this.getLineStart(l),
g=g+1<t?this.getLineStart(g+1):this.getCharCount(),k!==u&&(c=this.getText(u,k)+c,k=u),h!==g&&(c+=this.getText(h,g),h=g));u=f-a;for(g=l+b+1;g<t;g++)this._lineOffsets[g]+=u;if(5E4>m.length)l=[l+1,b].concat(m),Array.prototype.splice.apply(this._lineOffsets,l);else{u=l+1;this._lineOffsets.splice(u,b);for(t=0;t<m.length;t+=5E4)l=[u,0].concat(m.slice(t,Math.min(m.length,t+5E4))),Array.prototype.splice.apply(this._lineOffsets,l),u+=5E4}for(u=t=0;u<this._text.length;){g=this._text[u].length;if(k<=t+g)break;
t+=g;u++}l=t;for(m=u;u<this._text.length;){g=this._text[u].length;if(h<=t+g)break;t+=g;u++}g=this._text[u];k=this._text[m].substring(0,k-l);h=g.substring(h-t);m=[m,u-m+1];k&&m.push(k);c&&m.push(c);h&&m.push(h);Array.prototype.splice.apply(this._text,m);0===this._text.length&&(this._text=[""]);this.onChanged({type:"Changed",start:d,removedCharCount:a,addedCharCount:f,removedLineCount:b,addedLineCount:n})}}};p.EventTarget.addMixin(m.prototype);return{TextModel:m}});
define("orion/keyBinding",["orion/util"],function(p){function s(m,c,k,h,l,g){this.type=g||"keydown";this.keyCode="string"===typeof m&&"keydown"===this.type?m.toUpperCase().charCodeAt(0):m;this.mod1=void 0!==c&&null!==c?c:!1;this.mod2=void 0!==k&&null!==k?k:!1;this.mod3=void 0!==h&&null!==h?h:!1;this.mod4=void 0!==l&&null!==l?l:!1}function r(m){this.keys=m}s.prototype={getKeys:function(){return[this]},match:function(m,c){if(void 0!==c){if(0!==c)return!1}else if(m instanceof Array){if(1<m.length)return!1;
m=m[0]}return m.type!==this.type?!1:this.keyCode===m.keyCode||this.keyCode===String.fromCharCode(p.isOpera?m.which:void 0!==m.charCode?m.charCode:m.keyCode)?this.mod1!==(p.isMac?m.metaKey:m.ctrlKey)||"keydown"===this.type&&this.mod2!==m.shiftKey||this.mod3!==m.altKey||p.isMac&&this.mod4!==m.ctrlKey?!1:!0:!1},equals:function(m){return!m||this.keyCode!==m.keyCode||this.mod1!==m.mod1||this.mod2!==m.mod2||this.mod3!==m.mod3||this.mod4!==m.mod4||this.type!==m.type?!1:!0}};r.prototype={getKeys:function(){return this.keys.slice(0)},
match:function(m,c){var k=this.keys;if(void 0!==c)return c>k.length?!1:k[c].match(m)?c===k.length-1?!0:c+1:!1;m instanceof Array||(m=[m]);if(m.length>k.length)return!1;var h;for(h=0;h<m.length;h++)if(!k[h].match(m[h]))return!1;return h===k.length?!0:h},equals:function(m){if(!m.keys||m.keys.length!==this.keys.length)return!1;for(var c=0;c<m.keys.length;c++)if(!m.keys[c].equals(this.keys[c]))return!1;return!0}};return{KeyBinding:s,KeyStroke:s,KeySequence:r}});
define("orion/editor/keyModes",["orion/keyBinding","orion/util"],function(p,s){function r(c){c&&(this._view=c,this._keyBindings=this.createKeyBindings(),this._keyBindingIndex=0)}function m(c){r.call(this,c)}r.prototype={createKeyBindings:function(){return[]},getKeyBindings:function(c){for(var k=[],h=this._keyBindings,l=0;l<h.length;l++)h[l].actionID===c&&k.push(h[l].keyBinding);return k},getView:function(){return this._view},isActive:function(){return-1!==this._view.getKeyModes().indexOf(this)},match:function(c){if("keydown"===
c.type)switch(c.keyCode){case 16:case 17:case 18:case 91:return}for(var k=this._keyBindingIndex,h=this._matchingKeyBindings||this._keyBindings,l=[],g=0;g<h.length;g++){var d=h[g],a=d.keyBinding.match(c,k);if(!0===a)return this._keyBindingIndex=0,this._matchingKeyBindings=null,d.actionID;"number"===typeof a&&l.push(d)}if(0===l.length)this._keyBindingIndex=0,this._matchingKeyBindings=null;else return this._keyBindingIndex++,this._matchingKeyBindings=l,"noop"},setKeyBinding:function(c,k){for(var h=this._keyBindings,
l=0;l<h.length;l++){var g=h[l];if(g.keyBinding.equals(c)){k?g.actionID=k:g.predefined?g.actionID="noop":h.splice(l,1);return}}k&&h.push({keyBinding:c,actionID:k})},setView:function(c){this._view=c}};m.prototype=new r;m.prototype.createKeyBindings=function(){var c=p.KeyBinding,k=[];k.push({actionID:"lineUp",keyBinding:new c(38),predefined:!0});k.push({actionID:"lineDown",keyBinding:new c(40),predefined:!0});k.push({actionID:"charPrevious",keyBinding:new c(37),predefined:!0});k.push({actionID:"charNext",
keyBinding:new c(39),predefined:!0});s.isMac?(k.push({actionID:"scrollPageUp",keyBinding:new c(33),predefined:!0}),k.push({actionID:"scrollPageDown",keyBinding:new c(34),predefined:!0}),k.push({actionID:"pageUp",keyBinding:new c(33,null,null,!0),predefined:!0}),k.push({actionID:"pageDown",keyBinding:new c(34,null,null,!0),predefined:!0}),k.push({actionID:"lineStart",keyBinding:new c(37,!0),predefined:!0}),k.push({actionID:"lineEnd",keyBinding:new c(39,!0),predefined:!0}),k.push({actionID:"wordPrevious",
keyBinding:new c(37,null,null,!0),predefined:!0}),k.push({actionID:"wordNext",keyBinding:new c(39,null,null,!0),predefined:!0}),k.push({actionID:"scrollTextStart",keyBinding:new c(36),predefined:!0}),k.push({actionID:"scrollTextEnd",keyBinding:new c(35),predefined:!0}),k.push({actionID:"textStart",keyBinding:new c(38,!0),predefined:!0}),k.push({actionID:"textEnd",keyBinding:new c(40,!0),predefined:!0}),k.push({actionID:"scrollPageUp",keyBinding:new c(38,null,null,null,!0),predefined:!0}),k.push({actionID:"scrollPageDown",
keyBinding:new c(40,null,null,null,!0),predefined:!0}),k.push({actionID:"lineStart",keyBinding:new c(37,null,null,null,!0),predefined:!0}),k.push({actionID:"lineEnd",keyBinding:new c(39,null,null,null,!0),predefined:!0}),k.push({actionID:"lineStart",keyBinding:new c(38,null,null,!0),predefined:!0}),k.push({actionID:"lineEnd",keyBinding:new c(40,null,null,!0),predefined:!0})):(k.push({actionID:"pageUp",keyBinding:new c(33),predefined:!0}),k.push({actionID:"pageDown",keyBinding:new c(34),predefined:!0}),
k.push({actionID:"lineStart",keyBinding:new c(36),predefined:!0}),k.push({actionID:"lineEnd",keyBinding:new c(35),predefined:!0}),k.push({actionID:"wordPrevious",keyBinding:new c(37,!0),predefined:!0}),k.push({actionID:"wordNext",keyBinding:new c(39,!0),predefined:!0}),k.push({actionID:"textStart",keyBinding:new c(36,!0),predefined:!0}),k.push({actionID:"textEnd",keyBinding:new c(35,!0),predefined:!0}));s.isFirefox&&s.isLinux&&(k.push({actionID:"lineUp",keyBinding:new c(38,!0),predefined:!0}),k.push({actionID:"lineDown",
keyBinding:new c(40,!0),predefined:!0}));s.isWindows&&(k.push({actionID:"scrollLineUp",keyBinding:new c(38,!0),predefined:!0}),k.push({actionID:"scrollLineDown",keyBinding:new c(40,!0),predefined:!0}));k.push({actionID:"selectLineUp",keyBinding:new c(38,null,!0),predefined:!0});k.push({actionID:"selectLineDown",keyBinding:new c(40,null,!0),predefined:!0});k.push({actionID:"selectCharPrevious",keyBinding:new c(37,null,!0),predefined:!0});k.push({actionID:"selectCharNext",keyBinding:new c(39,null,!0),
predefined:!0});k.push({actionID:"selectPageUp",keyBinding:new c(33,null,!0),predefined:!0});k.push({actionID:"selectPageDown",keyBinding:new c(34,null,!0),predefined:!0});s.isMac?(k.push({actionID:"selectLineStart",keyBinding:new c(37,!0,!0),predefined:!0}),k.push({actionID:"selectLineEnd",keyBinding:new c(39,!0,!0),predefined:!0}),k.push({actionID:"selectWordPrevious",keyBinding:new c(37,null,!0,!0),predefined:!0}),k.push({actionID:"selectWordNext",keyBinding:new c(39,null,!0,!0),predefined:!0}),
k.push({actionID:"selectTextStart",keyBinding:new c(36,null,!0),predefined:!0}),k.push({actionID:"selectTextEnd",keyBinding:new c(35,null,!0),predefined:!0}),k.push({actionID:"selectTextStart",keyBinding:new c(38,!0,!0),predefined:!0}),k.push({actionID:"selectTextEnd",keyBinding:new c(40,!0,!0),predefined:!0}),k.push({actionID:"selectLineStart",keyBinding:new c(37,null,!0,null,!0),predefined:!0}),k.push({actionID:"selectLineEnd",keyBinding:new c(39,null,!0,null,!0),predefined:!0}),k.push({actionID:"selectLineStart",
keyBinding:new c(38,null,!0,!0),predefined:!0}),k.push({actionID:"selectLineEnd",keyBinding:new c(40,null,!0,!0),predefined:!0})):(s.isLinux&&(k.push({actionID:"selectWholeLineUp",keyBinding:new c(38,!0,!0),predefined:!0}),k.push({actionID:"selectWholeLineDown",keyBinding:new c(40,!0,!0),predefined:!0})),k.push({actionID:"selectLineStart",keyBinding:new c(36,null,!0),predefined:!0}),k.push({actionID:"selectLineEnd",keyBinding:new c(35,null,!0),predefined:!0}),k.push({actionID:"selectWordPrevious",
keyBinding:new c(37,!0,!0),predefined:!0}),k.push({actionID:"selectWordNext",keyBinding:new c(39,!0,!0),predefined:!0}),k.push({actionID:"selectTextStart",keyBinding:new c(36,!0,!0),predefined:!0}),k.push({actionID:"selectTextEnd",keyBinding:new c(35,!0,!0),predefined:!0}));k.push({actionID:"undo",keyBinding:new p.KeyBinding("z",!0),predefined:!0});s.isMac?k.push({actionID:"redo",keyBinding:new p.KeyBinding("z",!0,!0),predefined:!0}):k.push({actionID:"redo",keyBinding:new p.KeyBinding("y",!0),predefined:!0});
k.push({actionID:"deletePrevious",keyBinding:new c(8),predefined:!0});k.push({actionID:"deletePrevious",keyBinding:new c(8,null,!0),predefined:!0});k.push({actionID:"deleteNext",keyBinding:new c(46),predefined:!0});k.push({actionID:"deleteWordPrevious",keyBinding:new c(8,!0),predefined:!0});k.push({actionID:"deleteWordPrevious",keyBinding:new c(8,!0,!0),predefined:!0});k.push({actionID:"deleteWordNext",keyBinding:new c(46,!0),predefined:!0});k.push({actionID:"tab",keyBinding:new c(9),predefined:!0});
k.push({actionID:"shiftTab",keyBinding:new c(9,null,!0),predefined:!0});k.push({actionID:"enter",keyBinding:new c(13),predefined:!0});k.push({actionID:"enter",keyBinding:new c(13,null,!0),predefined:!0});k.push({actionID:"selectAll",keyBinding:new c("a",!0),predefined:!0});k.push({actionID:"toggleTabMode",keyBinding:new c("m",!0),predefined:!0});s.isMac&&(k.push({actionID:"deleteNext",keyBinding:new c(46,null,!0),predefined:!0}),k.push({actionID:"deleteWordPrevious",keyBinding:new c(8,null,null,!0),
predefined:!0}),k.push({actionID:"deleteWordNext",keyBinding:new c(46,null,null,!0),predefined:!0}));k.push({actionID:"toggleWrapMode",keyBinding:new p.KeyBinding("w",!0,!1,!0)});k.push({actionID:"toggleOverwriteMode",keyBinding:new p.KeyBinding(45)});if(!s.isFirefox){var h=s.isMac&&s.isChrome;k.push({actionID:"noop",keyBinding:new c("u",!h,!1,!1,h),predefined:!0});k.push({actionID:"noop",keyBinding:new c("i",!h,!1,!1,h),predefined:!0});k.push({actionID:"noop",keyBinding:new c("b",!h,!1,!1,h),predefined:!0})}s.isFirefox&&
(k.push({actionID:"copy",keyBinding:new c(45,!0),predefined:!0}),k.push({actionID:"paste",keyBinding:new c(45,null,!0),predefined:!0}),k.push({actionID:"cut",keyBinding:new c(46,null,!0),predefined:!0}));s.isMac&&(k.push({actionID:"lineStart",keyBinding:new c("a",!1,!1,!1,!0),predefined:!0}),k.push({actionID:"lineEnd",keyBinding:new c("e",!1,!1,!1,!0),predefined:!0}),k.push({actionID:"lineUp",keyBinding:new c("p",!1,!1,!1,!0),predefined:!0}),k.push({actionID:"lineDown",keyBinding:new c("n",!1,!1,
!1,!0),predefined:!0}),k.push({actionID:"charPrevious",keyBinding:new c("b",!1,!1,!1,!0),predefined:!0}),k.push({actionID:"charNext",keyBinding:new c("f",!1,!1,!1,!0),predefined:!0}),k.push({actionID:"deletePrevious",keyBinding:new c("h",!1,!1,!1,!0),predefined:!0}),k.push({actionID:"deleteNext",keyBinding:new c("d",!1,!1,!1,!0),predefined:!0}),k.push({actionID:"deleteLineEnd",keyBinding:new c("k",!1,!1,!1,!0),predefined:!0}),s.isFirefox?(k.push({actionID:"scrollPageDown",keyBinding:new c("v",!1,
!1,!1,!0),predefined:!0}),k.push({actionID:"deleteLineStart",keyBinding:new c("u",!1,!1,!1,!0),predefined:!0}),k.push({actionID:"deleteWordPrevious",keyBinding:new c("w",!1,!1,!1,!0),predefined:!0})):(k.push({actionID:"pageDown",keyBinding:new c("v",!1,!1,!1,!0),predefined:!0}),k.push({actionID:"centerLine",keyBinding:new c("l",!1,!1,!1,!0),predefined:!0}),k.push({actionID:"enterNoCursor",keyBinding:new c("o",!1,!1,!1,!0),predefined:!0})));return k};return{KeyMode:r,DefaultKeyMode:m}});
define("orion/editor/textTheme",["require","orion/editor/eventTarget","orion/util"],function(p,s,r){function m(c){c=c||{};this._document=c.document||document}var c={};m.getTheme=function(k){k=k||"default";var h=c[k];h||(h=c[k]=new m);return h};m.prototype={getThemeClass:function(){return this._themeClass},setThemeClass:function(c,h){var l=this,g=l._themeClass;l._themeClass=c;this._load(c,h,function(){l.onThemeChanged({type:"ThemeChanged",oldValue:g,newValue:l.getThemeClass()})})},onThemeChanged:function(c){return this.dispatchEvent(c)},
buildStyleSheet:function(c,h){var l=function(a){return a.replace(this._capitalRegEx,function(a){return"-"+a}.bind(this)).toLowerCase()}.bind(this),g=function(a,b,f,n,h){var e=[];Object.keys(a).forEach(function(d){var c=a[d];"string"===typeof c?e.push("\t"+l(d)+": "+c+";"):g(c,f===d?b:b+(n?" .":".")+d,f,!1,h)});e.length&&(h.push(b+(n?".textview":"")+" {"),h.push.apply(h,e),h.push("}"))},d=[""];g(h.styles,"."+c,h.className,!0,d);return d.join("\n")},_createStyle:function(c,h,l,g){var d=this._document;
c="orion-theme-"+c;var a=d.getElementById(c);if(a){if(g||a.firstChild.data===h)return;a.removeChild(a.firstChild);a.appendChild(d.createTextNode(h))}else g?(a=r.createElement(d,"link"),a.rel="stylesheet",a.type="text/css",a.href=h,a.addEventListener("load",function(){l()})):(a=r.createElement(d,"style"),a.appendChild(d.createTextNode(h))),a.id=c,(d.getElementsByTagName("head")[0]||d.documentElement).appendChild(a);g||l()},_load:function(c,h,l){if(c)if("string"===typeof h)this._createStyle(c,h,l);
else if(h=h.href,".css"!==h.substring(h.length-4)&&(h+=".css"),/^\//.test(h)||/[a-zA-Z0-9]+:\/\//i.test(h)||!p.toUrl)this._createStyle(c,h,l,!0);else{var g=this;p(["text!"+h],function(h){g._createStyle(c,h,l,!1)})}else l()},_capitalRegEx:/[A-Z]/g};s.EventTarget.addMixin(m.prototype);return{TextTheme:m}});
define("orion/editor/util",[],function(){return{contains:function(p,s){if(!s)return!1;if(!p.compareDocumentPosition){for(var r=s;r;){if(p===r)return!0;r=r.parentNode}return!1}return p===s||0!==(p.compareDocumentPosition(s)&16)},getNodeStyle:function(p,s,r){var m;if(p&&(m=p.style[s],!m))if(p.currentStyle){for(m=0;-1!==(m=s.indexOf("-",m));)s=s.substring(0,m)+s.substring(m+1,m+2).toUpperCase()+s.substring(m+2);m=p.currentStyle[s]}else m=(p=p.ownerDocument.defaultView.getComputedStyle(p,null))?p.getPropertyValue(s):
null;return m||r},addEventListener:function(p,s,r,m){"function"===typeof p.addEventListener?p.addEventListener(s,r,!0===m):p.attachEvent("on"+s,r)},removeEventListener:function(p,s,r,m){"function"===typeof p.removeEventListener?p.removeEventListener(s,r,!0===m):p.detachEvent("on"+s,r)},Animation:function(){function p(p){this.options=p}p.prototype.play=function(){var p="number"===typeof this.options.duration?this.options.duration:350,r=this.options.easing||this.defaultEasing,m=this.options.onAnimate||
function(){},c=this.options.curve[0],k=this.options.curve[1],h=k-c,l=-1,g,d=this;this.interval=this.options.window.setInterval(function(){l=-1===l?(new Date).getTime():l;var a=((new Date).getTime()-l)/p;1>a?(a=r(a),g=c+a*h,m(g)):(m(k),d.stop())},"number"===typeof this.options.rate?this.options.rate:20)};p.prototype.stop=function(){this.options.window.clearInterval(this.interval);(this.options.onEnd||function(){})()};p.prototype.defaultEasing=function(p){return Math.sin(p*(Math.PI/2))};return p}()}});
define("orion/metrics",[],function(){return{init:function(p){-1!==window.location.host.indexOf("orion.eclipse.org")&&(function(p,r,m,c,k,h,l){p.GoogleAnalyticsObject=k;p[k]=p[k]||function(){(p[k].q=p[k].q||[]).push(arguments)};p[k].l=1*new Date;h=r.createElement(m);l=r.getElementsByTagName(m)[0];h.async=1;h.src=c;l.parentNode.insertBefore(h,l)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),p=p||{},p.siteSpeedSampleRate=50,window.ga("create","UA-55945995-1",p),window.ga("send",
"pageview"))},logEvent:function(p,s,r,m){window.ga&&window.ga("send","event",p,s,r,m)}}});
define("orion/editor/textView","i18n!orion/editor/nls/messages orion/editor/textModel orion/editor/keyModes orion/editor/eventTarget orion/editor/textTheme orion/editor/util orion/util orion/metrics".split(" "),function(p,s,r,m,c,k,h,l){function g(q,a,b){if(b){a.className="";b=a.attributes;for(var f=b.length;0<f--;)(!h.isIE||9<=h.isIE||9>h.isIE&&b[f].specified)&&a.removeAttribute(b[f].name)}if(q){q.styleClass&&(a.className=q.styleClass);if(b=q.style)for(var e in b)b.hasOwnProperty(e)&&(a.style[e]=
b[e]);if(q=q.attributes)for(var n in q)q.hasOwnProperty(n)&&a.setAttribute(n,q[n])}}function d(q){return q instanceof Array?q.slice(0):q}function a(q,a){if(!q)return a;if(!a)return q;for(var b in a)a.hasOwnProperty(b)&&(q.hasOwnProperty(b)||(q[b]=a[b]));return q}function b(q,a){if(q===a)return!0;if(q&&!a||!q&&a||q&&q.constructor===String||a&&a.constructor===String)return!1;if(q instanceof Array||a instanceof Array){if(!(q instanceof Array&&a instanceof Array)||q.length!==a.length)return!1;for(var f=
0;f<q.length;f++)if(!b(q[f],a[f]))return!1;return!0}if(!(q instanceof Object)||!(a instanceof Object))return!1;for(f in q)if(q.hasOwnProperty(f)&&(!a.hasOwnProperty(f)||!b(q[f],a[f])))return!1;for(f in a)if(!q.hasOwnProperty(f))return!1;return!0}function f(q,a,b){for(var f=0,e=0,n=0,h=q.length;n<h;){-1!==f&&f<=n&&(f=q.indexOf("\r",n));-1!==e&&e<=n&&(e=q.indexOf("\n",n));var d=n,g;if(-1===e&&-1===f){a(q.substring(n));break}-1!==f&&-1!==e?f+1===e?(g=f,n=e+1):(g=f<e?f:e,n=(f<e?f:e)+1):-1!==f?(g=f,n=
f+1):(g=e,n=e+1);a(q.substring(d,g));b()}}function n(q){var a,b,f,e,n=q.ownerDocument.defaultView||q.ownerDocument.parentWindow;n.getComputedStyle?(q=n.getComputedStyle(q,null),a=q.getPropertyValue("padding-left"),b=q.getPropertyValue("padding-top"),f=q.getPropertyValue("padding-right"),e=q.getPropertyValue("padding-bottom")):q.currentStyle&&(a=q.currentStyle.paddingLeft,b=q.currentStyle.paddingTop,f=q.currentStyle.paddingRight,e=q.currentStyle.paddingBottom);return{left:parseInt(a,10)||0,top:parseInt(b,
10)||0,right:parseInt(f,10)||0,bottom:parseInt(e,10)||0}}function t(q){var a,b,f,e,h=q._trim;if(!h){var h=n(q),d=q.ownerDocument.defaultView||q.ownerDocument.parentWindow;d.getComputedStyle?(e=d.getComputedStyle(q,null),a=e.getPropertyValue("border-left-width"),b=e.getPropertyValue("border-top-width"),f=e.getPropertyValue("border-right-width"),e=e.getPropertyValue("border-bottom-width")):q.currentStyle&&(a=q.currentStyle.borderLeftWidth,b=q.currentStyle.borderTopWidth,f=q.currentStyle.borderRightWidth,
e=q.currentStyle.borderBottomWidth);a=parseInt(a,10)||0;b=parseInt(b,10)||0;f=parseInt(f,10)||0;e=parseInt(e,10)||0;h.left+=a;h.top+=b;h.right+=f;h.bottom+=e;q._trim=h}return h}function e(q,a,b,f){function e(a){if(a.animationName===h){var C=a.target;"function"===typeof C.__DOMReady&&(q.defaultView||q.parentWindow).setTimeout(function(){C.__DOMReady()},0)}}function n(q,a){for(var C=["","-webkit-","-moz-","-ms-","-o-"],b="",f="body ."+q+" {\n",e=0;e<C.length;e++)b+="@"+C[e]+"keyframes "+a+" {\nfrom { opacity: 0.99; }\nto { opacity: 1; }\n}\n",
f+=C[e]+"animation-duration: 0.001s;\n"+C[e]+"animation-name: "+a+";\n";return b+(f+"}")}b="_"+b+"DOMReady";a.className=a.className?a.className+" "+b:b;a.__DOMReady=f;f=b+"Style";if(!q.getElementById(f)){var h=b+"Animation";z(q,"animationstart",e,!1);z(q,"MSAnimationStart",e,!1);z(q,"webkitAnimationStart",e,!1);a=q.createElement("style");a.id=f;f=q.getElementsByTagName("head")[0]||q.documentElement;a.appendChild(q.createTextNode(n(b,h)));f.insertBefore(a,f.firstChild)}}function v(q,a,b){this.start=
q;this.end=a;this.caret=b}function u(q){this.left=q.left;this.top=q.top;this.right=q.right;this.bottom=q.bottom}function x(q,a,b){this.view=q;this.lineIndex=a;this._lineDiv=b}function w(q){this._init(q||{})}var z=k.addEventListener,D=k.removeEventListener,B=k.Animation;v.prototype={clone:function(){return new v(this.start,this.end,this.caret)},collapse:function(){this.caret?this.end=this.start:this.start=this.end},extend:function(q){this.caret?this.start=q:this.end=q;this.start>this.end&&(q=this.start,
this.start=this.end,this.end=q,this.caret=!this.caret)},setCaret:function(q){this.end=this.start=q;this.caret=!1},getCaret:function(){return this.caret?this.start:this.end},toString:function(){return"start\x3d"+this.start+" end\x3d"+this.end+(this.caret?" caret is at start":" caret is at end")},isEmpty:function(){return this.start===this.end},equals:function(q){return this.caret===q.caret&&this.start===q.start&&this.end===q.end}};u.prototype={toString:function(){return"{l\x3d"+this.left+", t\x3d"+
this.top+", r\x3d"+this.right+", b\x3d"+this.bottom+"}"}};x.prototype={create:function(q,a){if(!this._lineDiv){var b=this._lineDiv=this._createLine(q,a,this.lineIndex);b._line=this;return b}},_createLine:function(q,a,f){var e=this.view,n=e._model,d=n.getLine(f),c=n.getLineStart(f),t={type:"LineStyle",textView:e,lineIndex:f,lineText:d,lineStart:c};e.onLineStyle(t);var v=q.ownerDocument,n=a||h.createElement(v,"div");if(!a||!b(a.viewStyle,t.style))g(t.style,n,a),a&&(a._trim=null),n.viewStyle=t.style,
n.setAttribute("role","presentation");n.lineIndex=f;if(a&&n.viewLineText===d&&b(t.ranges,n.viewRanges))return n;n.viewRanges=t.ranges;n.viewLineText=d;f=[];this._createRanges(t.ranges,d,0,d.length,c,{tabOffset:0,ranges:f});t=" ";!e._fullSelection&&9>h.isIE&&(t="\ufeff");e={text:t,style:e._metrics.largestFontStyle,ignoreChars:1};0===f.length||!f[f.length-1].style||"div"!==f[f.length-1].style.tagName?f.push(e):f.splice(f.length-1,0,e);var k,l,u,m=t=0;if(h.isFirefox&&2E3<d.length){a&&(n.innerHTML="",
a.lineWidth=void 0);a=v.createDocumentFragment();for(d=0;d<f.length;d++)e=f[d],c=e.text,k=e.style,k=this._createSpan(n,c,k,e.ignoreChars),a.appendChild(k);n.appendChild(a)}else{var x,p;if(a){if(l=a.modelChangedEvent)0===l.removedLineCount&&0===l.addedLineCount?(p=l.start-c,x=l.addedCharCount-l.removedCharCount):p=-1,a.modelChangedEvent=void 0;l=a.firstChild}for(d=0;d<f.length;d++){e=f[d];c=e.text;t+=c.length;k=e.style;if(l)if(u=l.firstChild.data,v=l.viewStyle,u===c&&b(k,v)){m+=u.length;l._rectsCache=
void 0;k=l=l.nextSibling;continue}else for(;l;){if(-1!==p){v=t;v>=p&&(v-=x);u=(u=l.firstChild.data)?u.length:0;if(m+u>v)break;m+=u}v=l.nextSibling;n.removeChild(l);l=v}k=this._createSpan(n,c,k,e.ignoreChars);l?n.insertBefore(k,l):n.appendChild(k);a&&(a.lineWidth=void 0)}if(a)for(x=k?k.nextSibling:null;x;)v=x.nextSibling,a.removeChild(x),x=v}n.parentNode||q.appendChild(n);return n},_createRanges:function(q,a,f,e,n,h){if(!(f>e)){if(q)for(var d=0;d<q.length;d++){var g=q[d];if(!(g.end<n+f)){var c=Math.max(n+
f,g.start)-n;if(c>e)break;var t=Math.min(n+e,g.end)-n;if(c<=t){c=Math.max(f,c);t=Math.min(e,t);f<c&&this._createRange(a,f,c,null,h);if(!g.style||!g.style.unmergeable)for(;d+1<q.length&&q[d+1].start-n===t&&b(g.style,q[d+1].style);)g=q[d+1],t=Math.min(n+e,g.end)-n,d++;this._createRange(a,c,t,g.style,h);f=t}}}f<e&&this._createRange(a,f,e,null,h)}},_createRange:function(q,a,b,f,e){if(!(a>b)){var n=this.view._customTabSize;if(n&&8!==n)for(var h=q.indexOf("\t",a);-1!==h&&h<b;){a<h&&(a={text:q.substring(a,
h),style:f},e.ranges.push(a),e.tabOffset+=a.text.length);a=n-e.tabOffset%n;if(0<a){for(var d="\u00a0",g=1;g<a;g++)d+=" ";a={text:d,style:f,ignoreChars:a-1};e.ranges.push(a);e.tabOffset+=a.text.length}a=h+1;if(a===b)return;h=q.indexOf("\t",a)}a<=b&&(a={text:q.substring(a,b),style:f},e.ranges.push(a),e.tabOffset+=a.text.length)}},_createSpan:function(q,a,b,f){var e=this.view,n="span";b&&b.tagName&&(n=b.tagName.toLowerCase());var d="a"===n;d&&(this.hasLink=!0);d&&!e._linksVisible&&(n="span");d=q.ownerDocument;
q=h.createElement(q.ownerDocument,n);q.appendChild(d.createTextNode(b&&b.text?b.text:a));b&&b.html?(q.innerHTML=b.html,q.ignore=!0):b&&b.node&&(q.appendChild(b.node),q.ignore=!0);g(b,q);if("a"===n){var c=e._getWindow();z(q,"click",function(q){return e._handleLinkClick(q?q:c.event)},!1)}q.viewStyle=b;f&&(q.ignoreChars=f);return q},_ensureCreated:function(){return this._lineDiv?this._lineDiv:this._createdDiv=this.create(this.view._clientDiv,null)},getBoundingClientRect:function(q,a){var b=this._ensureCreated(),
f=this.view;if(void 0===q)return this._getLineBoundingClientRect(b,!0);var e=f._model,n=b.ownerDocument,d=this.lineIndex,g=null;if(q<e.getLineEnd(d)){var c=e.getLineStart(d);this.forEach(function(a){var C=a.firstChild,e=this._nodeLength(a);if(c+e>q){var d=q-c;if(1===C.length)g=new u(a.getBoundingClientRect());else if(f._isRangeRects)e=n.createRange(),e.setStart(C,d),e.setEnd(C,d+1),g=new u(e.getBoundingClientRect());else if(h.isIE)e=n.body.createTextRange(),e.moveToElementText(a),e.collapse(),(C=
0===d&&8===h.isIE)&&(d=1),e.moveEnd("character",d+1),e.moveStart("character",d),g=new u(e.getBoundingClientRect()),C&&(g.left=a.getClientRects()[0].left);else{var t=C.data;a.removeChild(C);a.appendChild(n.createTextNode(t.substring(0,d)));var v=h.createElement(n,"span");v.appendChild(n.createTextNode(t.substring(d,d+1)));a.appendChild(v);a.appendChild(n.createTextNode(t.substring(d+1)));g=new u(v.getBoundingClientRect());a.innerHTML="";a.appendChild(C);this._createdDiv||(a=f._getSelection(),(c<=a.start&&
a.start<c+e||c<=a.end&&a.end<c+e)&&f._updateDOMSelection())}h.isIE&&(d=b.ownerDocument.defaultView||b.ownerDocument.parentWindow,a=d.screen.logicalXDPI/d.screen.deviceXDPI,d=d.screen.logicalYDPI/d.screen.deviceYDPI,g.left*=a,g.right*=a,g.top*=d,g.bottom*=d);return!1}c+=e;return!0})}e=this.getBoundingClientRect();g||(f._wrapMode?(d=this.getClientRects(),g=d[d.length-1],g.left=g.right,g.left+=e.left,g.top+=e.top,g.right+=e.left,g.bottom+=e.top):(g=new u(e),g.left=g.right));if(a||void 0===a)g.left-=
e.left,g.top-=e.top,g.right-=e.left,g.bottom-=e.top;return g},forEach:function(q){for(var a=this._ensureCreated().firstChild;a;){var b=a.nextSibling;if(!a.ignore&&!q.call(this,a))break;a=b}},_getClientRects:function(q,a){var b,f,e,n;if(!q._rectsCache){b=q.getClientRects();f=Array(b.length);for(n=0;n<b.length;n++)e=f[n]=new u(b[n]),e.left-=a.left,e.top-=a.top,e.right-=a.left,e.bottom-=a.top;q._rectsCache=f}b=q._rectsCache;f=[b.length];for(n=0;n<b.length;n++)f[n]=new u(b[n]);return f},getClientRects:function(q){if(!this.view._wrapMode)return[this.getBoundingClientRect()];
var a=[],b=this._ensureCreated().getBoundingClientRect();this.forEach(function(q){q=this._getClientRects(q,b);for(var f=0;f<q.length;f++){var e=q[f],n,d;if(e.top!==e.bottom){var h=e.top+(e.bottom-e.top)/2;for(n=0;n<a.length&&!(d=a[n],d.top<=h&&h<d.bottom);n++);n===a.length?a.push(e):(e.left<d.left&&(d.left=e.left),e.top<d.top&&(d.top=e.top),e.right>d.right&&(d.right=e.right),e.bottom>d.bottom&&(d.bottom=e.bottom))}}return!0});return void 0!==q?a[q]:a},_getLineBoundingClientRect:function(q,a){var b=
new u(q.getBoundingClientRect());if(!this.view._wrapMode){b.right=b.left;for(var e=q.lastChild;e&&e.ignoreChars===e.firstChild.length;)e=e.previousSibling;e&&(e=e.getBoundingClientRect(),b.right=e.right+t(q).right)}a&&(e=t(q),b.left+=e.left,b.right-=e.right);return b},getLineCount:function(){return!this.view._wrapMode?1:this.getClientRects().length},getLineIndex:function(q){if(!this.view._wrapMode)return 0;var a=this.getClientRects();q=this.getBoundingClientRect(q);q=q.top+(q.bottom-q.top)/2;for(var b=
0;b<a.length;b++)if(a[b].top<=q&&q<a[b].bottom)return b;return a.length-1},getLineStart:function(q){if(!this.view._wrapMode||0===q)return this.view._model.getLineStart(this.lineIndex);var a=this.getClientRects();return this.getOffset(a[q].left+1,a[q].top+1)},_nodeLength:function(q){if(!q||q.ignore)return 0;var a=q.firstChild.length;q.ignoreChars&&(a-=q.ignoreChars);return a},getModelOffset:function(q,a){if(!q)return 0;var b=0;this.forEach(function(e){var f=e.firstChild;if(f===q)return e.ignoreChars&&
(b-=e.ignoreChars),b+=a,!1;e.ignoreChars&&(b-=e.ignoreChars);b+=f.data.length;return!0});return Math.max(0,b)+this.view._model.getLineStart(this.lineIndex)},getNodeOffset:function(q){var a=0,b,e,f=this.view._model,n=f.getLineStart(this.lineIndex),d=q-n,h=f.getLineEnd(this.lineIndex)-n;this.forEach(function(q){var f=q.firstChild,n=this._nodeLength(q);if(n+a>d||a+n>=h)return b=f,e=d-a,q.ignoreChars&&(0<n&&e===n)&&(e+=q.ignoreChars),!1;a+=n;return!0});return{node:b,offset:e}},getText:function(q){var a=
"",b=0;this.forEach(function(e){var f;if(e.ignoreChars){f=e.lastChild;for(var n=0,d=[],h=-1;f;){var g=f.data;if(g)for(var c=g.length-1;0<=c;c--){var t=g.substring(c,c+1);n<e.ignoreChars&&(" "===t||"\ufeff"===t)?n++:d.push("\u00a0"===t?"\t":t)}q===f&&(h=d.length);f=f.previousSibling}d=d.reverse().join("");-1!==h&&(b=a.length+d.length-h);a+=d}else for(f=e.firstChild;f;)q===f&&(b=a.length),a+=f.data,f=f.nextSibling;return!0});return{text:a,offset:b}},getOffset:function(q,a){function b(e,c,y){var l=e.firstChild,
A=k._nodeLength(e),u=t.ownerDocument,m=u.defaultView||u.parentWindow,x=h.isIE?m.screen.logicalXDPI/m.screen.deviceXDPI:1,p=h.isIE?m.screen.logicalYDPI/m.screen.deviceYDPI:1,w,r,z,m=y.left+v.left,s,D;if(h.isIE||f._isRangeRects){for(var u=f._isRangeRects?u.createRange():u.body.createTextRange(),N=A,B=-1;1<N-B;){var I=Math.floor((N+B)/2);y=B+1;w=I===A-1&&e.ignoreChars?l.length:I+1;s=0===y&&8===h.isIE;f._isRangeRects?(u.setStart(l,y),u.setEnd(l,w)):(s&&(y=1),u.moveToElementText(e),u.move("character",
y),u.moveEnd("character",w-y));D=u.getClientRects();for(var Q=!1,M=0;M<D.length;M++)if(y=D[M],w=(s?m:y.left)*x-v.left,z=y.right*x-v.left,r=y.top*p-v.top,y=y.bottom*p-v.top,w<=q&&q<z&&(!f._wrapMode||r<=a&&a<y)){Q=!0;break}Q?N=I:B=I}c+=N;y=N;w=N===A-1&&e.ignoreChars?l.length:Math.min(N+1,l.length);f._isRangeRects?(u.setStart(l,y),u.setEnd(l,w)):(u.moveToElementText(e),u.move("character",y),u.moveEnd("character",w-y));D=u.getClientRects();A=!1;0<D.length&&(y=D[0],w=(s?m:y.left)*x-v.left,z=y.right*x-
v.left,A=q>w+(z-w)/2);e=c-g;l=n.getLine(d);x=l.charCodeAt(e);55296<=x&&56319>=x&&A?e<l.length&&(x=l.charCodeAt(e+1),56320<=x&&57343>=x&&(c+=1)):56320<=x&&(57343>=x&&!A)&&0<e&&(x=l.charCodeAt(e-1),55296<=x&&56319>=x&&(c-=1));A&&c++}else{x=[];for(s=0;s<A;s++)x.push("\x3cspan\x3e"),s===A-1?x.push(l.data.substring(s)):x.push(l.data.substring(s,s+1)),x.push("\x3c/span\x3e");e.innerHTML=x.join("");for(x=e.firstChild;x;){y=x.getBoundingClientRect();w=y.left-v.left;z=y.right-v.left;if(w<=q&&q<z){q>w+(z-w)/
2&&c++;break}c++;x=x.nextSibling}k._createdDiv||(e.innerHTML="",e.appendChild(l),e=f._getSelection(),(c<=e.start&&e.start<c+A||c<=e.end&&e.end<c+A)&&f._updateDOMSelection())}return c}function e(b){if(b.ignore)return null;b=k._getClientRects(b,v);for(var n=0;n<b.length;n++){var d=b[n];if(d.left<=q&&q<d.right&&(!f._wrapMode||d.top<=a&&a<d.bottom))return d}return null}var f=this.view,n=f._model,d=this.lineIndex,g=n.getLineStart(d),c=n.getLineEnd(d);if(g===c)return g;var t=this._ensureCreated(),v=this.getBoundingClientRect(),
k=this,l,u;if(f._wrapMode){l=this.getClientRects();a<l[0].top&&(a=l[0].top);for(var m=0;m<l.length&&!(u=l[m],u.top<=a&&a<u.bottom);m++);q<u.left&&(q=u.left);q>u.right&&(q=u.right-1)}else 0>q&&(q=0),q>v.right-v.left&&(q=v.right-v.left);var x,p;if(this._lastHitChild&&this._lastHitChild.parentNode){if(x=this._lastHitOffset,p=this._lastHitChild,u=e(p),!u){l=x;for(var m=x+this._nodeLength(p),w=p.previousSibling,r=p.nextSibling;w||r;){if(w){l-=this._nodeLength(w);if(u=e(w)){p=w;x=l;break}w=w.previousSibling}if(r){if(u=
e(r)){p=r;x=m;break}m+=this._nodeLength(r);r=r.nextSibling}}}}else x=g,this.forEach(function(q){p=q;if(u=e(p))return!1;x+=this._nodeLength(p);return!0});p&&u&&(this._lastHitChild=p,this._lastHitOffset=x,x=b(p,x,u));return Math.min(c,Math.max(g,x))},getNextOffset:function(q,a){if("line"===a.unit){var b=this.view._model,e=b.getLineAtOffset(q);if(0<a.count)return a.count--,b.getLineEnd(e);a.count++;return b.getLineStart(e)}return"wordend"===a.unit||"wordWS"===a.unit||"wordendWS"===a.unit?this._getNextOffset_W3C(q,
a):h.isIE?this._getNextOffset_IE(q,a):this._getNextOffset_W3C(q,a)},_getNextOffset_W3C:function(q,a){function b(q){return 33<=q&&47>=q||58<=q&&64>=q||91<=q&&94>=q||96===q||123<=q&&126>=q}function e(q){return 32===q||9===q}var f=this.view._model,n=f.getLineAtOffset(q),d=f.getLine(n),h=f.getLineStart(n),f=f.getLineEnd(n),n=d.length,g=q-h,c,t=0>a.count?-1:1;if("word"===a.unit||"wordend"===a.unit||"wordWS"===a.unit||"wordendWS"===a.unit)for(var v,k,l;0!==a.count;){if(0<a.count){if(g===n)return f;c=d.charCodeAt(g);
v=b(c);k=!v&&!e(c);for(g++;g<n;){c=d.charCodeAt(g);if("wordWS"!==a.unit&&"wordendWS"!==a.unit){l=b(c);if("wordend"===a.unit){if(!l&&v)break}else if(l&&!v)break;c=!l&&!e(c)}else c=!e(c);if("wordend"===a.unit||"wordendWS"===a.unit){if(!c&&k)break}else if(c&&!k)break;k=c;v=l;g++}}else{if(0===g)return h;g--;c=d.charCodeAt(g);v=b(c);for(k=!v&&!e(c);0<g;){c=d.charCodeAt(g-1);if("wordWS"!==a.unit&&"wordendWS"!==a.unit){l=b(c);if("wordend"===a.unit){if(l&&!v)break}else if(!l&&v)break;c=!l&&!e(c)}else c=!e(c);
if("wordend"===a.unit||"wordendWS"===a.unit){if(c&&!k)break}else if(!c&&k)break;k=c;v=l;g--}}a.count-=t}else for(;0!==a.count&&0<=g+t&&g+t<=n;)g+=t,c=d.charCodeAt(g),56320<=c&&57343>=c&&0<g&&(c=d.charCodeAt(g-1),55296<=c&&56319>=c&&(g+=t)),a.count-=t;return h+g},_getNextOffset_IE:function(q,a){var b=this._ensureCreated(),e=this.view._model,f=this.lineIndex,n=0,d;d=e.getLineStart(f);var h=e.getLine(f),g=e.getLineStart(f),c=b.ownerDocument,t=0>a.count?-1:1;if(q===e.getLineEnd(f)){for(b=b.lastChild;b&&
b.ignoreChars===b.firstChild.length;)b=b.previousSibling;if(!b)return d;n=c.body.createTextRange();n.moveToElementText(b);d=n.text.length;n.moveEnd(a.unit,t);n=q+n.text.length-d}else if(q===d&&0>a.count)n=d;else for(b=b.firstChild;b;){e=this._nodeLength(b);if(d+e>q){n=c.body.createTextRange();if(q===d&&0>a.count){for(d=b.previousSibling;d&&(!d.firstChild||!d.firstChild.length);)d=d.previousSibling;n.moveToElementText(d?d:b.previousSibling)}else n.moveToElementText(b),n.collapse(),n.moveEnd("character",
q-d);d=n.text.length;n.moveEnd(a.unit,t);n=q+n.text.length-d;break}d=e+d;b=b.nextSibling}d=n-g;n=h.charCodeAt(d);56320<=n&&57343>=n&&0<d&&(n=h.charCodeAt(d-1),55296<=n&&56319>=n&&(d+=t));a.count-=t;return d+g},updateLinks:function(){var q=this._ensureCreated();if(this.hasLink){var a=this;this.forEach(function(b){var e=b.viewStyle;e&&(e.tagName&&"a"===e.tagName.toLowerCase())&&q.replaceChild(a._createSpan(q,b.firstChild.data,e),b);return!0})}},destroy:function(){var q=this._createdDiv;q&&(q.parentNode.removeChild(q),
this._createdDiv=null)}};w.prototype={addKeyMode:function(q,a){var b=this._keyModes;void 0!==a?b.splice(a,0,q):b.push(q);q._modeAdded&&q._modeAdded()},addRuler:function(q,a){var b=this._rulers;if(void 0!==a){var e,f;for(f=e=0;e<b.length&&f<a;e++)q.getLocation()===b[e].getLocation()&&f++;b.splice(f,0,q);a=f}else b.push(q);this._createRuler(q,a);q.setView(this);this._update()},computeSize:function(){var q=0,a=0,b=this._model,e=this._clientDiv;if(!e)return{width:q,height:a};var f=e.style.width;h.isWebkit&&
(e.style.width="0x7fffffffpx");for(var b=b.getLineCount(),n=0;n<b;n++){var d=this._getLine(n),g=d.getBoundingClientRect(),q=Math.max(q,g.right-g.left),a=a+(g.bottom-g.top);d.destroy()}h.isWebkit&&(e.style.width=f);e=this._getViewPadding();q+=e.right+e.left+this._metrics.scrollWidth;a+=e.bottom+e.top+this._metrics.scrollWidth;return{width:q,height:a}},convert:function(q,a,b){if(!this._clientDiv)return q;var e=this._getScroll(),f=this._getViewPadding(),n=this._viewDiv.getBoundingClientRect();"document"===
a&&(void 0!==q.x&&(q.x+=-e.x+n.left+f.left),void 0!==q.y&&(q.y+=-e.y+n.top+f.top));"document"===b&&(void 0!==q.x&&(q.x+=e.x-n.left-f.left),void 0!==q.y&&(q.y+=e.y-n.top-f.top));return q},destroy:function(){for(var q=0;q<this._rulers.length;q++)this._rulers[q].setView(null);this.rulers=null;this._destroyView();this.onDestroy({type:"Destroy"});this._parent=null;this._model&&this._model.destroy&&this._model.destroy();this._actions=this._keyModes=this._doubleClickSelection=this._selection=this._theme=
this._model=null},focus:function(){this._clientDiv&&(this._updateDOMSelection(),this._clientDiv.focus(),this._updateDOMSelection())},hasFocus:function(){return this._hasFocus},getActionDescription:function(q){if(q=this._actions[q])return q.actionDescription},getActions:function(q){var a=[],b=this._actions,e;for(e in b)b.hasOwnProperty(e)&&(q||!b[e].defaultHandler)&&a.push(e);return a},getBottomIndex:function(q){return!this._clientDiv?0:this._getBottomIndex(q)},getBottomPixel:function(){return!this._clientDiv?
0:this._getScroll().y+this._getClientHeight()},getCaretOffset:function(){return this._getSelection().getCaret()},getClientArea:function(){if(!this._clientDiv)return{x:0,y:0,width:0,height:0};var q=this._getScroll();return{x:q.x,y:q.y,width:this._getClientWidth(),height:this._getClientHeight()}},getHorizontalPixel:function(){return!this._clientDiv?0:this._getScroll().x},getKeyBindings:function(q){for(var a=[],b=this._keyModes,e=0;e<b.length;e++)a=a.concat(b[e].getKeyBindings(q));return a},getKeyModes:function(){return this._keyModes.slice(0)},
getLineHeight:function(q){return!this._clientDiv?0:this._getLineHeight(q)},getLineIndex:function(q){return!this._clientDiv?0:this._getLineIndex(q)},getLinePixel:function(q){return!this._clientDiv?0:this._getLinePixel(q)},getLocationAtOffset:function(q){if(!this._clientDiv)return{x:0,y:0};var a=this._model;q=Math.min(Math.max(0,q),a.getCharCount());var a=a.getLineAtOffset(q),b=this._getLine(a);q=b.getBoundingClientRect(q);b.destroy();b=q.left;a=this._getLinePixel(a)+q.top;return{x:b,y:a}},getNextOffset:function(q,
a){var b=new v(q,q,!1);this._doMove(a,b);return b.getCaret()},getOptions:function(){var q;if(0===arguments.length)q=this._defaultOptions();else if(1===arguments.length){if(q=arguments[0],"string"===typeof q)return d(this["_"+q])}else{q={};for(var a in arguments)arguments.hasOwnProperty(a)&&(q[arguments[a]]=void 0)}for(var b in q)q.hasOwnProperty(b)&&(q[b]=d(this["_"+b]));return q},getModel:function(){return this._model},getOffsetAtLocation:function(q,a){if(!this._clientDiv)return 0;var b=this._getLineIndex(a),
e=this._getLine(b),b=e.getOffset(q,a-this._getLinePixel(b));e.destroy();return b},getLineAtOffset:function(q){return this.getModel().getLineAtOffset(q)},getLineStart:function(q){this.getModel().getLineStart(q)},getRulers:function(){return this._rulers.slice(0)},getSelection:function(){var q=this._getSelection();return{start:q.start,end:q.end}},getText:function(q,a){return this._model.getText(q,a)},getTopIndex:function(q){return!this._clientDiv?0:this._getTopIndex(q)},getTopPixel:function(){return!this._clientDiv?
0:this._getScroll().y},invokeAction:function(q,a,b){if(this._clientDiv){if(q=this._actions[q]){q.actionDescription&&q.actionDescription.track&&l.logEvent("editor","action invoked",q.actionDescription.id);if(!a&&q.handler&&q.handler(b))return!0;if(q.defaultHandler)return"boolean"===typeof q.defaultHandler(b)}return!1}},isDestroyed:function(){return!this._clientDiv},onContextMenu:function(q){return this.dispatchEvent(q)},onDragStart:function(q){return this.dispatchEvent(q)},onDrag:function(q){return this.dispatchEvent(q)},
onDragEnd:function(q){return this.dispatchEvent(q)},onDragEnter:function(q){return this.dispatchEvent(q)},onDragOver:function(q){return this.dispatchEvent(q)},onDragLeave:function(q){return this.dispatchEvent(q)},onDrop:function(q){return this.dispatchEvent(q)},onDestroy:function(q){return this.dispatchEvent(q)},onLineStyle:function(q){return this.dispatchEvent(q)},onKeyDown:function(q){return this.dispatchEvent(q)},onKeyPress:function(q){return this.dispatchEvent(q)},onKeyUp:function(q){return this.dispatchEvent(q)},
onModelChanged:function(q){return this.dispatchEvent(q)},onModelChanging:function(q){return this.dispatchEvent(q)},onModify:function(q){return this.dispatchEvent(q)},onMouseDown:function(q){return this.dispatchEvent(q)},onMouseUp:function(q){return this.dispatchEvent(q)},onMouseMove:function(q){return this.dispatchEvent(q)},onMouseOver:function(q){return this.dispatchEvent(q)},onMouseOut:function(q){return this.dispatchEvent(q)},onTouchStart:function(q){return this.dispatchEvent(q)},onTouchMove:function(q){return this.dispatchEvent(q)},
onTouchEnd:function(q){return this.dispatchEvent(q)},onOptions:function(q){return this.dispatchEvent(q)},onSelection:function(q){return this.dispatchEvent(q)},onScroll:function(q){return this.dispatchEvent(q)},onVerify:function(q){return this.dispatchEvent(q)},onFocus:function(q){return this.dispatchEvent(q)},onBlur:function(q){return this.dispatchEvent(q)},redraw:function(){if(!(0<this._redrawCount)){var q=this._model.getLineCount();this.redrawRulers(0,q);this.redrawLines(0,q)}},redrawRulers:function(q,
a){if(!(0<this._redrawCount))for(var b=this.getRulers(),e=0;e<b.length;e++)this.redrawLines(q,a,b[e])},redrawLines:function(q,a,b){if(!(0<this._redrawCount)&&(void 0===q&&(q=0),void 0===a&&(a=this._model.getLineCount()),q!==a)){var e=this._clientDiv;if(e){if(b)for(e=this._getRulerParent(b).firstChild;e&&e._ruler!==b;)e=e.nextSibling;b?e.rulerChanged=!0:this._lineHeight&&this._resetLineHeight(q,a);if(!b||"page"===b.getOverview())for(e=e.firstChild;e;){var f=e.lineIndex;q<=f&&f<a&&(e.lineChanged=!0);
e=e.nextSibling}!b&&(!this._wrapMode&&q<=this._maxLineIndex&&this._maxLineIndex<a)&&(this._checkMaxLineIndex=this._maxLineIndex,this._maxLineIndex=-1,this._maxLineWidth=0);this.dispatchEvent({type:"Redraw",startLine:q,endLine:a,ruler:b});this._queueUpdate()}}},redrawRange:function(a,b){if(!(0<this._redrawCount)){var e=this._model;void 0===a&&(a=0);void 0===b&&(b=e.getCharCount());var f=e.getLineAtOffset(a),e=e.getLineAtOffset(Math.max(a,b-1))+1;this.redrawLines(f,e)}},removeKeyMode:function(a){for(var b=
this._keyModes,e=0;e<b.length;e++)if(b[e]===a){b.splice(e,1);break}a._modeRemoved&&a._modeRemoved()},removeRuler:function(a){for(var b=this._rulers,e=0;e<b.length;e++)if(b[e]===a){b.splice(e,1);a.setView(null);this._destroyRuler(a);this._update();break}},resize:function(){this._clientDiv&&this._handleResize(null)},setAction:function(a,b,e){if(a){var f=this._actions,n=f[a];n||(n=f[a]={});n.handler=b;void 0!==e&&(n.actionDescription=e)}},setKeyBinding:function(a,b){this._keyModes[0].setKeyBinding(a,
b)},setCaretOffset:function(a,b,e){var f=this._model.getCharCount();a=Math.max(0,Math.min(a,f));a=new v(a,a,!1);this._setSelection(a,void 0===b||b,!0,e)},setHorizontalPixel:function(a){this._clientDiv&&(a=Math.max(0,a),this._scrollView(a-this._getScroll().x,0))},setRedraw:function(a){a?0===--this._redrawCount&&this.redraw():this._redrawCount++},setModel:function(a){if(a!==this._model){a=a||new s.TextModel;this._model.removeEventListener("preChanging",this._modelListener.onChanging);this._model.removeEventListener("postChanged",
this._modelListener.onChanged);var b=this._model.getLineCount(),e=this._model.getCharCount(),f=a.getLineCount(),n=a.getCharCount(),d={type:"ModelChanging",text:a.getText(),start:0,removedCharCount:e,addedCharCount:n,removedLineCount:b,addedLineCount:f};this.onModelChanging(d);this._model=a;d={type:"ModelChanged",start:0,removedCharCount:e,addedCharCount:n,removedLineCount:b,addedLineCount:f};this.onModelChanged(d);this._model.addEventListener("preChanging",this._modelListener.onChanging);this._model.addEventListener("postChanged",
this._modelListener.onChanged);this._reset();this._update()}},setOptions:function(a){var e=this._defaultOptions(),f;for(f in a)if(a.hasOwnProperty(f)){var n=a[f];if(!b(this["_"+f],n)){var h=e[f]?e[f].update:null;h?h.call(this,n):this["_"+f]=d(n)}}this.onOptions({type:"Options",options:a})},setSelection:function(a,b,e,f){var n=a>b;if(n){var d=a;a=b;b=d}d=this._model.getCharCount();a=Math.max(0,Math.min(a,d));b=Math.max(0,Math.min(b,d));a=new v(a,b,n);this._setSelection(a,void 0===e||e,!0,f)},setText:function(a,
b,e){var f=void 0===b&&void 0===e;void 0===b&&(b=0);void 0===e&&(e=this._model.getCharCount());f&&(this._variableLineHeight=!1);this._modifyContent({text:a,start:b,end:e,_code:!0},!f);f&&(this._columnX=-1,this._setSelection(new v(0,0,!1),!0),13>h.isFirefox&&this._fixCaret())},setTopIndex:function(a,b){this._clientDiv&&this._scrollViewAnimated(0,this._getLinePixel(Math.max(0,a))-this._getScroll().y,b)},setTopPixel:function(a,b){this._clientDiv&&this._scrollViewAnimated(0,Math.max(0,a)-this._getScroll().y,
b)},showSelection:function(a,b){return this._showCaret(a?!1:!0,b,a)},update:function(a,b){this._clientDiv&&((a||this._metrics.invalid)&&this._updateStyle(),void 0===b||b?this._update():this._queueUpdate())},_handleRootMouseDown:function(a){this._cancelCheckSelection();if(!this._ignoreEvent(a)){13>h.isFirefox&&1===a.which&&(this._clientDiv.contentEditable=!1,this._ignoreBlur=(this._overlayDiv||this._clientDiv).draggable=!0);var b=this._overlayDiv||this._clientDiv;9>h.isIE&&(b=this._viewDiv);for(var e=
a.target?a.target:a.srcElement;e;){if(b===e||e.className&&-1!==e.className.indexOf("textViewFind"))return;e=e.parentNode}a.preventDefault&&a.preventDefault();a.stopPropagation&&a.stopPropagation();if(!this._isW3CEvents){var f=this;this._getWindow().setTimeout(function(){f._clientDiv.focus()},0)}}},_handleRootMouseUp:function(a){this._ignoreEvent(a)||(13>h.isFirefox&&1===a.which&&(this._clientDiv.contentEditable=!0,(this._overlayDiv||this._clientDiv).draggable=!1),h.isFirefox&&1===a.which&&(this._fixCaret(),
this._ignoreBlur=!1))},_handleBlur:function(){this._cancelCheckSelection();if(!this._ignoreBlur){this._commitIME();this._hasFocus=!1;if(9>h.isIE&&!this._getSelection().isEmpty()){var a=this._rootDiv,b=h.createElement(a.ownerDocument,"div");a.appendChild(b);a.removeChild(b)}this._cursorDiv&&(this._cursorDiv.style.display="none");if(this._selDiv1)if(this._selDiv1.style.background="lightgray",this._selDiv2.style.background="lightgray",this._selDiv3.style.background="lightgray",a=this._getWindow(),b=
this._selDiv1.ownerDocument,a.getSelection){b=a.getSelection();for(a=b.anchorNode;a;){if(a===this._clientDiv){0<b.rangeCount&&b.removeAllRanges();break}a=a.parentNode}}else if(b.selection){this._ignoreSelect=!1;for(a=b.selection.createRange().parentElement();a;){if(a===this._clientDiv){b.selection.empty();break}a=a.parentNode}this._ignoreSelect=!0}if(!this._ignoreFocus)this.onBlur({type:"Blur"})}},_handleCompositionStart:function(a){this._ignoreEvent(a)||(this._startIME(),this._mutationObserver&&
(this._mutationObserver.disconnect(),this._mutationObserver=null))},_handleCompositionEnd:function(a){this._ignoreEvent(a)||this._commitIME(a.data)},_handleContextMenu:function(a){if(!this._ignoreEvent(a)){h.isIE&&3===this._lastMouseButton&&this._updateDOMSelection();var b=!1;this.isListening("ContextMenu")?(b=this._createMouseEvent("ContextMenu",a),b.screenX=a.screenX,b.screenY=a.screenY,this.onContextMenu(b),b=b.defaultPrevented):h.isMac&&(h.isFirefox&&0===a.button)&&(b=!0);if(b)return a.preventDefault&&
a.preventDefault(),!1;this._contextMenuOpen=!0;h.isFirefox&&(this._checkSelectionChange=!0,this._pollSelectionChange(!0))}},_handleCopy:function(a){this._cancelCheckSelection();if(!this._ignoreEvent(a)&&!this._ignoreCopy&&this._doCopy(a))return a.preventDefault&&a.preventDefault(),!1},_handleCut:function(a){this._cancelCheckSelection();if(!this._ignoreEvent(a)&&this._doCut(a))return a.preventDefault&&a.preventDefault(),!1},_handleDataModified:function(a){this._ignoreEvent(a)||this._startIME()},_handleDblclick:function(a){this._ignoreEvent(a)||
(this._lastMouseTime=a.timeStamp?a.timeStamp:(new Date).getTime(),2!==this._clickCount&&(this._clickCount=2,this._handleMouse(a)))},_handleDragStart:function(a){if(!this._ignoreEvent(a)){if(13>h.isFirefox){var b=this;this._getWindow().setTimeout(function(){b._clientDiv.contentEditable=!0;b._clientDiv.draggable=!1;b._ignoreBlur=!1},0)}if(this.isListening("DragStart")&&-1!==this._dragOffset)this._isMouseDown=!1,this.onDragStart(this._createMouseEvent("DragStart",a)),this._dragOffset=-1;else return a.preventDefault&&
a.preventDefault(),!1}},_handleDrag:function(a){if(!this._ignoreEvent(a)&&this.isListening("Drag"))this.onDrag(this._createMouseEvent("Drag",a))},_handleDragEnd:function(a){if(!this._ignoreEvent(a)){this._dropTarget=!1;this._dragOffset=-1;if(this.isListening("DragEnd"))this.onDragEnd(this._createMouseEvent("DragEnd",a));13>h.isFirefox&&(this._fixCaret(),"none"===a.dataTransfer.dropEffect&&!a.dataTransfer.mozUserCancelled&&this._fixCaret())}},_handleDragEnter:function(a){if(!this._ignoreEvent(a)){var b=
!0;this._dropTarget=!0;this.isListening("DragEnter")&&(b=!1,this.onDragEnter(this._createMouseEvent("DragEnter",a)));if(h.isWebkit||b)return a.preventDefault&&a.preventDefault(),!1}},_handleDragOver:function(a){if(!this._ignoreEvent(a)){var b=!0;this.isListening("DragOver")&&(b=!1,this.onDragOver(this._createMouseEvent("DragOver",a)));if(h.isWebkit||b)return b&&(a.dataTransfer.dropEffect="none"),a.preventDefault&&a.preventDefault(),!1}},_handleDragLeave:function(a){if(!this._ignoreEvent(a)&&(this._dropTarget=
!1,this.isListening("DragLeave")))this.onDragLeave(this._createMouseEvent("DragLeave",a))},_handleDrop:function(a){if(!this._ignoreEvent(a)){this._dropTarget=!1;if(this.isListening("Drop"))this.onDrop(this._createMouseEvent("Drop",a));a.preventDefault&&a.preventDefault();return!1}},_handleFocus:function(){this._hasFocus=!0;h.isIOS&&void 0!==this._lastTouchOffset?(this.setCaretOffset(this._lastTouchOffset,!0),this._lastTouchOffset=void 0):this._updateDOMSelection();this._cursorDiv&&(this._cursorDiv.style.display=
"block");if(this._selDiv1){var a=this._highlightRGB;this._selDiv1.style.background=a;this._selDiv2.style.background=a;this._selDiv3.style.background=a}if(!this._ignoreFocus)this.onFocus({type:"Focus"})},_handleKeyDown:function(a){this._cancelCheckSelection();if(!this._ignoreEvent(a)){if(this.isListening("KeyDown")){var b=this._createKeyEvent("KeyDown",a);this.onKeyDown(b);if(b.defaultPrevented){h.isFirefox&&(this._keyDownPrevented=!0);a.preventDefault();return}}b=!1;switch(a.keyCode){case 16:case 17:case 18:case 91:b=
!0;break;default:this._setLinksVisible(!1)}if(229===a.keyCode){if(this._readonly)return a.preventDefault&&a.preventDefault(),!1;b=!0;h.isSafari&&h.isMac&&a.ctrlKey&&(b=!1,a.keyCode=129);b&&this._startIME()}else b||this._commitIME();if((h.isMac||h.isLinux)&&4>h.isFirefox||12.16>h.isOpera)return this._keyDownEvent=a,!0;if(this._doAction(a))return a.preventDefault?(a.preventDefault(),a.stopPropagation()):(a.cancelBubble=!0,a.returnValue=!1,a.keyCode=0),!1}},_handleKeyPress:function(a){if(!this._ignoreEvent(a))if(this._keyDownPrevented)a.preventDefault&&
(a.preventDefault(),a.stopPropagation()),this._keyDownPrevented=void 0;else{if(h.isMac&&h.isWebkit&&(63232<=a.keyCode&&63487>=a.keyCode||13===a.keyCode||8===a.keyCode)||((h.isMac||h.isLinux)&&4>h.isFirefox||12.16>h.isOpera)&&this._doAction(this._keyDownEvent))return a.preventDefault&&a.preventDefault(),!1;var b=h.isMac?a.metaKey:a.ctrlKey;if(void 0!==a.charCode&&b)switch(a.charCode){case 99:case 118:case 120:return!0}if(this.isListening("KeyPress")&&(b=this._createKeyEvent("KeyPress",a),this.onKeyPress(b),
b.defaultPrevented)){a.preventDefault();return}if(this._doAction(a))return a.preventDefault?(a.preventDefault(),a.stopPropagation()):(a.cancelBubble=!0,a.returnValue=!1,a.keyCode=0),!1;b=!1;if(h.isMac){if(a.ctrlKey||a.metaKey)b=!0}else if(h.isFirefox){if(a.ctrlKey||a.altKey)b=!0}else a.ctrlKey^a.altKey&&(b=!0);if(!b&&(b=h.isOpera?a.which:void 0!==a.charCode?a.charCode:a.keyCode,31<b))return this._doContent(String.fromCharCode(b)),a.preventDefault&&a.preventDefault(),!1}},_handleDocKeyUp:function(a){(h.isMac?
a.metaKey:a.ctrlKey)||this._setLinksVisible(!1)},_handleKeyUp:function(a){if(!this._ignoreEvent(a)){if(this.isListening("KeyUp")){var b=this._createKeyEvent("KeyUp",a);this.onKeyUp(b);if(b.defaultPrevented){a.preventDefault();return}}this._handleDocKeyUp(a);13===a.keyCode&&this._commitIME()}},_handleLinkClick:function(a){if(!(h.isMac?a.metaKey:a.ctrlKey))return a.preventDefault&&a.preventDefault(),!1},_handleMouse:function(a){var b=this._getWindow(),e=!0,f=b;if(h.isIE||h.isFirefox&&!this._overlayDiv)f=
this._clientDiv;if(this._overlayDiv){this._hasFocus&&(this._ignoreFocus=!0);var n=this;b.setTimeout(function(){n.focus();n._ignoreFocus=!1},0)}1===this._clickCount?(e=this._setSelectionTo(a.clientX,a.clientY,a.shiftKey,(!h.isOpera||12.16<=h.isOpera)&&this._hasFocus&&this.isListening("DragStart")))&&this._setGrab(f):(this._isW3CEvents&&this._setGrab(f),this._doubleClickSelection=null,this._setSelectionTo(a.clientX,a.clientY,a.shiftKey),this._doubleClickSelection=this._getSelection());return e},_handleMouseDown:function(a){if(!this._ignoreEvent(a)){if(this._linksVisible)if("A"!==
(a.target||a.srcElement).tagName)this._setLinksVisible(!1);else return;this._commitIME();var b=a.which;b||(4===a.button&&(b=2),2===a.button&&(b=3),1===a.button&&(b=1));var e=2!==b&&a.timeStamp?a.timeStamp:(new Date).getTime(),f=e-this._lastMouseTime,n=Math.abs(this._lastMouseX-a.clientX),d=Math.abs(this._lastMouseY-a.clientY),g=this._lastMouseButton===b;this._lastMouseX=a.clientX;this._lastMouseY=a.clientY;this._lastMouseTime=e;this._lastMouseButton=b;1===b&&(this._isMouseDown=!0,g&&f<=this._clickTime&&
n<=this._clickDist&&d<=this._clickDist?this._clickCount++:this._clickCount=1);if(this.isListening("MouseDown")&&(e=this._createMouseEvent("MouseDown",a),this.onMouseDown(e),e.defaultPrevented)){a.preventDefault();return}if(1===b&&this._handleMouse(a)&&(9<=h.isIE||h.isOpera||h.isChrome||h.isSafari||h.isFirefox&&!this._overlayDiv))this._hasFocus||this.focus(),a.preventDefault();h.isFirefox&&3===this._lastMouseButton&&this._updateDOMSelection()}},_handleMouseOver:function(a){if(!this._ignoreEvent(a)&&
!this._animation&&this.isListening("MouseOver"))this.onMouseOver(this._createMouseEvent("MouseOver",a))},_handleMouseOut:function(a){if(!this._ignoreEvent(a)&&!this._animation&&this.isListening("MouseOut"))this.onMouseOut(this._createMouseEvent("MouseOut",a))},_handleMouseMove:function(a){if(!this._animation){var b=this._isClientDiv(a);if(this.isListening("MouseMove")&&(b||this._isMouseDown)){var e=this._createMouseEvent("MouseMove",a);this.onMouseMove(e);if(e.defaultPrevented){a.preventDefault();
return}}if(!this._dropTarget){e=this._linksVisible||this._lastMouseMoveX!==a.clientX||this._lastMouseMoveY!==a.clientY;this._lastMouseMoveX=a.clientX;this._lastMouseMoveY=a.clientY;this._setLinksVisible(e&&!this._isMouseDown&&(h.isMac?a.metaKey:a.ctrlKey));this._checkOverlayScroll();if(!this._isW3CEvents){if(0===a.button)return this._setGrab(null),!0;if(!this._isMouseDown&&1===a.button&&0!==(this._clickCount&1)&&b)return this._clickCount=2,this._handleMouse(a,this._clickCount)}if(this._isMouseDown&&
-1===this._dragOffset){b=a.clientX;a=a.clientY;var f=this._getViewPadding(),n=this._viewDiv.getBoundingClientRect(),d=this._getClientWidth(),g=this._getClientHeight(),e=n.left+f.left,c=n.top+f.top,d=n.left+f.left+d,f=n.top+f.top+g;a<c?this._doAutoScroll("up",b,a-c):a>f?this._doAutoScroll("down",b,a-f):b<e&&!this._wrapMode?this._doAutoScroll("left",b-e,a):b>d&&!this._wrapMode?this._doAutoScroll("right",b-d,a):(this._endAutoScroll(),this._setSelectionTo(b,a,!0))}}}},_isClientDiv:function(a){var b=this._overlayDiv||
this._clientDiv;for(a=a.target?a.target:a.srcElement;a;){if(b===a)return!0;a=a.parentNode}return!1},_createKeyEvent:function(a,b){return{type:a,event:b,preventDefault:function(){this.defaultPrevented=!0}}},_createMouseEvent:function(a,b){var e=this.convert({x:b.clientX,y:b.clientY},"page","document");return{type:a,event:b,clickCount:this._clickCount,x:e.x,y:e.y,preventDefault:function(){this.defaultPrevented=!0}}},_createTouchEvent:function(a,b){var e=b.touches.length?this.convert({x:b.touches[0].clientX,
y:b.touches[0].clientY},"page","document"):{};return{type:a,event:b,touchCount:b.touches.length,x:e.x,y:e.y,preventDefault:function(){this.defaultPrevented=!0}}},_handleMouseUp:function(a){var b=a.which?0===a.button:1===a.button;if(this.isListening("MouseUp")&&(this._isClientDiv(a)||b&&this._isMouseDown)){var e=this._createMouseEvent("MouseUp",a);this.onMouseUp(e);if(e.defaultPrevented){a.preventDefault();this._isMouseDown=!1;return}}this._linksVisible||(b&&this._isMouseDown&&(-1!==this._dragOffset&&
(e=this._getSelection(),e.extend(this._dragOffset),e.collapse(),this._setSelection(e,!0,!0),this._dragOffset=-1),this._isMouseDown=!1,this._endAutoScroll(),this._isW3CEvents&&this._setGrab(null)),b&&h.isFirefox&&(this._updateDOMSelection(),a.preventDefault()))},_handleMouseWheel:function(a){if(!this._noScroll){var b=this._getLineHeight(),e=0,f=0;h.isIE||h.isOpera?f=-a.wheelDelta/40*b:h.isFirefox?"wheel"===a.type?a.deltaMode?(e=Math.max(-256,Math.min(256,a.deltaX))*b,f=Math.max(-256,Math.min(256,a.deltaY))*
b):(e=a.deltaX,f=a.deltaY):(b=h.isMac?3*a.detail:Math.max(-256,Math.min(256,a.detail))*b,a.axis===a.HORIZONTAL_AXIS?e=b:f=b):h.isMac?(f=a.timeStamp-this._wheelTimeStamp,this._wheelTimeStamp=a.timeStamp,e=0!==a.wheelDeltaX%120?1:40>f?40/(40-f):40,f=0!==a.wheelDeltaY%120?1:40>f?40/(40-f):40,e=Math.ceil(-a.wheelDeltaX/e),-1<e&&0>e&&(e=-1),0<e&&1>e&&(e=1),f=Math.ceil(-a.wheelDeltaY/f),-1<f&&0>f&&(f=-1),0<f&&1>f&&(f=1)):(e=-a.wheelDeltaX,f=8*(-a.wheelDeltaY/120)*b);if(h.isSafari||h.isChrome&&h.isMac){for(b=
a.target;b&&void 0===b.lineIndex;)b=b.parentNode;this._mouseWheelLine=b}b=this._getScroll();this._scrollView(e,f);e=this._getScroll();if(b.x!==e.x||b.y!==e.y)return a.preventDefault&&a.preventDefault(),!1}},_handlePaste:function(a){this._cancelCheckSelection();if(!this._ignoreEvent(a)&&!this._ignorePaste&&this._doPaste(a)){if(h.isIE){var b=this;this._ignoreFocus=!0;this._getWindow().setTimeout(function(){b._updateDOMSelection();b._ignoreFocus=!1},0)}a.preventDefault&&a.preventDefault();return!1}},
_handleResize:function(){var a=this._rootDiv.clientWidth,e=this._rootDiv.clientHeight;if(this._rootWidth!==a||this._rootHeight!==e)this._rootWidth!==a&&this._wrapMode&&this._resetLineHeight(),this._rootWidth=a,this._rootHeight=e,a=9>h.isIE,e=this._calculateMetrics(),b(e,this._metrics)||(this._variableLineHeight&&(this._variableLineHeight=!1,this._resetLineHeight()),this._metrics=e,a=!0),a?this._queueUpdate():this._update(),this.dispatchEvent({type:"Resize"})},_handleRulerEvent:function(a){for(var b=
a.target?a.target:a.srcElement,e=b.lineIndex;b&&!b._ruler;)void 0===e&&void 0!==b.lineIndex&&(e=b.lineIndex),b=b.parentNode;var f=b?b._ruler:null;if(void 0===e&&f&&"document"===f.getOverview()){var e=this._getClientHeight(),n=this._model.getLineCount(),d=this._getViewPadding(),h=this._viewDiv.getBoundingClientRect(),e=Math.floor((a.clientY-h.top-this._metrics.scrollWidth)*n/(e+d.top+d.bottom-2*this._metrics.scrollWidth));0<=e&&e<n||(e=void 0)}if(f)switch(a.type){case "click":if(f.onClick)f.onClick(e,
a);break;case "dblclick":if(f.onDblClick)f.onDblClick(e,a);break;case "mousemove":if(f.onMouseMove)f.onMouseMove(e,a);break;case "mouseover":if(f.onMouseOver)f.onMouseOver(e,a);break;case "mouseout":if(f.onMouseOut){for(n=a.relatedTarget;n&&n!==this._rootDiv;){if(n===b)return;n=n.parentNode}f.onMouseOut(e,a)}}},_handleScroll:function(){this._lastScrollTime=(new Date).getTime();var a=this._getScroll(!1),b=this._hScroll,e=this._vScroll;if(b!==a.x||e!==a.y)this._hScroll=a.x,this._vScroll=a.y,this._commitIME(),
this._update(e===a.y),this.onScroll({type:"Scroll",oldValue:{x:b,y:e},newValue:a})},_handleSelectStart:function(a){var b=this._contextMenuOpen;this._contextMenuOpen=!1;if(b)this._checkSelectionChange=!0;else if(this._ignoreSelect)return a&&a.preventDefault&&a.preventDefault(),!1},_getModelOffset:function(a,b){if(a){var e;e="DIV"===a.tagName?a:a.parentNode.parentNode;return!e._line?0:e._line.getModelOffset(a,b)}},_updateSelectionFromDOM:function(){if(!h.isIOS&&!h.isAndroid&&!this._checkSelectionChange)return!1;
var a=this._getWindow().getSelection(),b=this._getModelOffset(a.anchorNode,a.anchorOffset),e=this._getModelOffset(a.focusNode,a.focusOffset),f=this._getSelection();if(void 0===b||void 0===e||f.start===b&&f.end===e)return!1;if(this._checkSelectionChange){var f=this._getLineNext(),n=this._getLinePrevious();if(a.anchorNode===f.firstChild.firstChild&&0===a.anchorOffset&&a.focusNode===n.firstChild.firstChild&&0===a.focusOffset)return!1;if(a.anchorNode===f.firstChild.firstChild&&0===a.anchorOffset&&a.focusNode===
n.lastChild.firstChild||a.anchorNode===this._clientDiv&&a.focusNode===this._clientDiv)b=0,e=this.getModel().getCharCount()}this._setSelection(new v(b,e),!1,!1);this._checkSelectionChange=!1;return!0},_cancelCheckSelection:function(){this._checkSelectionChange&&(this._checkSelectionChange=!1,this._cancelPollSelectionChange())},_cancelPollSelectionChange:function(){this._selPollTimer&&(this._getWindow().clearTimeout(this._selPollTimer),this._selPollTimer=null)},_pollSelectionChange:function(a){var b=
this,e=this._getWindow();this._cancelPollSelectionChange();this._selPollTimer=e.setTimeout(function(){b._selPollTimer=null;b._clientDiv&&!b._updateSelectionFromDOM()&&a&&b._pollSelectionChange(a)},100)},_handleSelectionChange:function(){-1===this._imeOffset&&(h.isAndroid?this._pollSelectionChange():this._updateSelectionFromDOM())},_handleTextInput:function(a){if(!this._ignoreEvent(a)){this._imeOffset=-1;var b=this._getWindow().getSelection();if(b.anchorNode!==this._anchorNode||b.focusNode!==this._focusNode||
b.anchorOffset!==this._anchorOffset||b.focusOffset!==this._focusOffset){for(var e=b.anchorNode;e&&void 0===e.lineIndex;)e=e.parentNode;if(e){var f=this._model,n=e.lineIndex,d=f.getLine(n),g=d,c=0,f=f.getLineStart(n);0<b.rangeCount&&(b.getRangeAt(0).deleteContents(),n=e.ownerDocument.createTextNode(a.data),b.getRangeAt(0).insertNode(n),c=this._getDOMText(e,n),g=c.text,c=c.offset,n.parentNode.removeChild(n));e.lineRemoved=!0;for(e=0;d.charCodeAt(e)===g.charCodeAt(e)&&e<c;)e++;b=d.length-1;for(n=g.length-
d.length;d.charCodeAt(b)===g.charCodeAt(b+n)&&b+n>=c+a.data.length;)b--;b++;d=g.substring(e,b+n);this._ignoreQueueUpdate=h.isSafari;this._modifyContent({text:d,start:e+f,end:b+f,_ignoreDOMSelection:!0,_ignoreDOMSelection1:h.isChrome},!0);this._ignoreQueueUpdate=!1}}else this._doContent(a.data);a.preventDefault()}},_handleTouchStart:function(a){if(this.isListening("TouchStart")){var b=this._createTouchEvent("TouchStart",a);this.onTouchStart(b);if(b.defaultPrevented){a.preventDefault();return}if(this._noScroll)return}this._commitIME();
b=this._getWindow();this._touchScrollTimer&&(this._vScrollDiv.style.display="none",this._hScrollDiv.style.display="none",b.clearInterval(this._touchScrollTimer),this._touchScrollTimer=null);var e=a.touches;if(1===e.length){var e=e[0],f=e.clientX,n=e.clientY;this._touchStartX=f;this._touchStartY=n;if(h.isAndroid&&(n<e.pageY-b.pageYOffset||f<e.pageX-b.pageXOffset))f=e.pageX-b.pageXOffset,n=e.pageY-b.pageYOffset;b=this.convert({x:f,y:n},"page","document");this._lastTouchOffset=this.getOffsetAtLocation(b.x,
b.y);this._touchStartTime=a.timeStamp;this._touching=!0}},_handleTouchMove:function(a){if(this.isListening("TouchMove")){var b=this._createTouchEvent("TouchMove",a);this.onTouchMove(b);if(b.defaultPrevented){a.preventDefault();return}if(this._noScroll)return}b=a.touches;if(1===b.length){b=b[0];this._touchCurrentX=b.clientX;this._touchCurrentY=b.clientY;if(!this._touchScrollTimer&&200>a.timeStamp-this._touchStartTime){this._vScrollDiv.style.display="block";this._wrapMode||(this._hScrollDiv.style.display=
"block");var e=this,f=this._getWindow();this._touchScrollTimer=f.setInterval(function(){var a=0,b=0;if(e._touching)a=e._touchStartX-e._touchCurrentX,b=e._touchStartY-e._touchCurrentY,e._touchSpeedX=a/10,e._touchSpeedY=b/10,e._touchStartX=e._touchCurrentX,e._touchStartY=e._touchCurrentY;else{if(0.1>Math.abs(e._touchSpeedX)&&0.1>Math.abs(e._touchSpeedY)){e._vScrollDiv.style.display="none";e._hScrollDiv.style.display="none";f.clearInterval(e._touchScrollTimer);e._touchScrollTimer=null;return}a=10*e._touchSpeedX;
b=10*e._touchSpeedY;e._touchSpeedX*=0.95;e._touchSpeedY*=0.95}e._scrollView(a,b)},10)}this._touchScrollTimer&&a.preventDefault()}},_handleTouchEnd:function(a){if(this.isListening("TouchEnd")){var b=this._createTouchEvent("TouchEnd",a);this.onTouchEnd(b);if(b.defaultPrevented){a.preventDefault();return}if(this._noScroll)return}0===a.touches.length&&(this._touching=!1)},_doAction:function(a){var b,e,f=this._keyModes;for(e=f.length-1;0<=e;e--)if(b=f[e],"function"===typeof b.match&&(b=b.match(a),void 0!==
b))return this.invokeAction(b);return!1},_doMove:function(a,b){var e=this._model,f=b.getCaret(),n=e.getLineAtOffset(f);a.count||(a.count=1);for(;0!==a.count;){var d=e.getLineStart(n);if(0>a.count&&f===d)if(0<n)"character"===a.unit&&a.count++,n--,b.extend(e.getLineEnd(n));else break;else if(0<a.count&&f===e.getLineEnd(n))if(n+1<e.getLineCount())"character"===a.unit&&a.count--,n++,b.extend(e.getLineStart(n));else break;else{var g=!1;a.expandTab&&("character"===a.unit&&0===(f-d)%this._tabSize)&&(d=e.getText(d,
f),g=!/[^ ]/.test(d));g?(b.extend(f-this._tabSize),a.count+=0>a.count?1:-1):(d=this._getLine(n),b.extend(d.getNextOffset(f,a)),d.destroy())}f=b.getCaret()}return b},_doBackspace:function(a){var b=this._getSelection();b.isEmpty()&&(a.count||(a.count=1),a.count*=-1,a.expandTab=this._expandTab,this._doMove(a,b));this._modifyContent({text:"",start:b.start,end:b.end},!0);return!0},_doCase:function(a){var b=this._getSelection();this._doMove(a,b);var e=this.getText(b.start,b.end);this._setSelection(b,!0);
switch(a.type){case "lower":e=e.toLowerCase();break;case "capitalize":e=e.replace(/(?:^|\s)\S/g,function(a){return a.toUpperCase()});break;case "reverse":a="";for(b=0;b<e.length;b++){var f=e[b],n=f.toLowerCase(),f=n!==f?n:f.toUpperCase();a+=f}e=a;break;default:e=e.toUpperCase()}this._doContent(e);return!0},_doContent:function(a){var b=this._getSelection();if(this._overwriteMode&&b.isEmpty()){var e=this._model,f=e.getLineAtOffset(b.end);b.end<e.getLineEnd(f)&&(e=this._getLine(f),b.extend(e.getNextOffset(b.getCaret(),
{unit:"character",count:1})),e.destroy())}return this._modifyContent({text:a,start:b.start,end:b.end,_ignoreDOMSelection:!0},!0)},_doCopy:function(a){var b=this._getSelection();return!b.isEmpty()?(b=this._getBaseText(b.start,b.end),this._setClipboardText(b,a)):!0},_doCursorNext:function(a){var b=this._getSelection();!b.isEmpty()&&!a.select?b.start=b.end:this._doMove(a,b);a.select||b.collapse();this._setSelection(b,!0);return!0},_doCursorPrevious:function(a){var b=this._getSelection();!b.isEmpty()&&
!a.select?b.end=b.start:(a.count||(a.count=1),a.count*=-1,this._doMove(a,b));a.select||b.collapse();this._setSelection(b,!0);return!0},_doCut:function(a){var b=this._getSelection();return!b.isEmpty()?(b=this._getBaseText(b.start,b.end),this._doContent(""),this._setClipboardText(b,a)):!0},_doDelete:function(a){var b=this._getSelection();b.isEmpty()&&this._doMove(a,b);this._modifyContent({text:"",start:b.start,end:b.end},!0);return!0},_doEnd:function(a){var b=this._getSelection(),e=this._model,f;if(a.ctrl)b.extend(e.getCharCount()),
f=function(){};else{var n=b.getCaret(),d=e.getLineAtOffset(n);if(this._wrapMode){var g=this._getLine(d),n=g.getLineIndex(n),n=n===g.getLineCount()-1?e.getLineEnd(d):g.getLineStart(n+1)-1;g.destroy()}else a.count&&0<a.count&&(d=Math.min(d+a.count-1,e.getLineCount()-1)),n=e.getLineEnd(d);b.extend(n)}a.select||b.collapse();this._setSelection(b,!0,!0,f);return!0},_doEnter:function(a){if(this._singleMode)return!0;var b=this._model,e=this._getSelection();this._doContent(b.getLineDelimiter());a&&a.noCursor&&
(e.end=e.start,this._setSelection(e,!0));return!0},_doHome:function(a){var b=this._getSelection(),e=this._model,f;if(a.ctrl)b.extend(0),f=function(){};else{var n=b.getCaret(),d=e.getLineAtOffset(n);this._wrapMode?(e=this._getLine(d),n=e.getLineIndex(n),n=e.getLineStart(n),e.destroy()):n=e.getLineStart(d);b.extend(n)}a.select||b.collapse();this._setSelection(b,!0,!0,f);return!0},_doLineDown:function(a){var b=this._model,e=this._getSelection(),f=e.getCaret(),n=b.getLineAtOffset(f),d=this._getLine(n),
g=this._columnX,c=1,t=!1;if(-1===g||a.wholeLine||a.select&&h.isIE)g=a.wholeLine?b.getLineEnd(n+1):f,g=d.getBoundingClientRect(g).left;(f=d.getLineIndex(f))<d.getLineCount()-1?c=d.getClientRects(f+1).top+1:(f=b.getLineCount()-1,t=n===f,a.count&&0<a.count?n=Math.min(n+a.count,f):n++);f=!1;if(t){if(a.select||h.isMac||h.isLinux)e.extend(b.getCharCount()),f=!0}else d.lineIndex!==n&&(d.destroy(),d=this._getLine(n)),e.extend(d.getOffset(g,c)),f=!0;f&&(a.select||e.collapse(),this._setSelection(e,!0,!0));
this._columnX=g;d.destroy();return!0},_doLineUp:function(a){var b=this._model,e=this._getSelection(),f=e.getCaret(),n=b.getLineAtOffset(f),d=this._getLine(n),g=this._columnX,c=!1,t;if(-1===g||a.wholeLine||a.select&&h.isIE)g=a.wholeLine?b.getLineStart(n-1):f,g=d.getBoundingClientRect(g).left;0<(f=d.getLineIndex(f))?t=d.getClientRects(f-1).top+1:(c=0===n,c||(a.count&&0<a.count?n=Math.max(n-a.count,0):n--,t=this._getLineHeight(n)-1));f=!1;if(c){if(a.select||h.isMac||h.isLinux)e.extend(0),f=!0}else d.lineIndex!==
n&&(d.destroy(),d=this._getLine(n)),e.extend(d.getOffset(g,t)),f=!0;f&&(a.select||e.collapse(),this._setSelection(e,!0,!0));this._columnX=g;d.destroy();return!0},_doNoop:function(){return!0},_doPageDown:function(a){var b=this,e=this._model,f=this._getSelection(),n=f.getCaret(),d=e.getLineAtOffset(n),g=e.getLineCount(),c=this._getScroll(),e=this._getClientHeight(),t,v;if(this._lineHeight){t=this._columnX;c=this._getBoundsAtOffset(n);if(-1===t||a.select&&h.isIE)t=c.left;n=this._getLineIndex(c.top+e);
v=this._getLine(n);d=this._getLinePixel(n);n=v.getOffset(t,c.top+e-d);e=v.getBoundingClientRect(n);v.destroy();f.extend(n);a.select||f.collapse();this._setSelection(f,!0,!0,function(){b._columnX=t},e.top+d-c.top);return!0}if(d<g-1){var k=this._getLineHeight(),l=Math.min(g-d-1,Math.floor(e/k)),l=Math.max(1,l);t=this._columnX;if(-1===t||a.select&&h.isIE)v=this._getLine(d),t=v.getBoundingClientRect(n).left,v.destroy();v=this._getLine(d+l);f.extend(v.getOffset(t,0));v.destroy();a.select||f.collapse();
a=g*k;n=c.y+l*k;n+e>a&&(n=a-e);this._setSelection(f,!0,!0,function(){b._columnX=t},n-c.y)}return!0},_doPageUp:function(a){var b=this,e=this._model,f=this._getSelection(),n=f.getCaret(),d=e.getLineAtOffset(n),g=this._getScroll(),c=this._getClientHeight(),t;if(this._lineHeight){t=this._columnX;g=this._getBoundsAtOffset(n);if(-1===t||a.select&&h.isIE)t=g.left;n=this._getLineIndex(g.bottom-c);e=this._getLine(n);d=this._getLinePixel(n);n=e.getOffset(t,g.bottom-c-d);c=e.getBoundingClientRect(n);e.destroy();
f.extend(n);a.select||f.collapse();this._setSelection(f,!0,!0,function(){b._columnX=t},c.top+d-g.top);return!0}if(0<d){var v=this._getLineHeight(),c=Math.max(1,Math.min(d,Math.floor(c/v)));t=this._columnX;if(-1===t||a.select&&h.isIE)e=this._getLine(d),t=e.getBoundingClientRect(n).left,e.destroy();e=this._getLine(d-c);f.extend(e.getOffset(t,this._getLineHeight(d-c)-1));e.destroy();a.select||f.collapse();a=Math.max(0,g.y-c*v);this._setSelection(f,!0,!0,function(){b._columnX=t},a-g.y)}return!0},_doPaste:function(a){var b=
this;return null!==this._getClipboardText(a,function(a){a&&(h.isLinux&&2===b._lastMouseButton&&(new Date).getTime()-b._lastMouseTime<=b._clickTime&&b._setSelectionTo(b._lastMouseX,b._lastMouseY),b._doContent(a))})},_doScroll:function(a){var b=a.type,e=this._model,f=e.getLineCount();a=this._getClientHeight();var n=this._getLineHeight(),f=this._lineHeight?this._scrollHeight:f*n,d=this._getScroll().y,g;switch(b){case "textStart":g=0;break;case "textEnd":g=f-a;break;case "pageDown":g=d+a;break;case "pageUp":g=
d-a;break;case "lineDown":g=d+n;break;case "lineUp":g=d-n;break;case "centerLine":b=this._getSelection(),g=e.getLineAtOffset(b.start),e=(e.getLineAtOffset(b.end)-g+1)*n,g=g*n-a/2+e/2}void 0!==g&&(g=Math.min(Math.max(0,g),f-a),this._scrollViewAnimated(0,g-d,function(){}));return!0},_doSelectAll:function(){var a=this._model,b=this._getSelection();b.setCaret(0);b.extend(a.getCharCount());this._setSelection(b,!1);return!0},_doTab:function(){if(this._tabMode&&!this._readonly){var a="\t";if(this._expandTab)var b=
this._model,a=this._getSelection().getCaret(),e=b.getLineAtOffset(a),b=b.getLineStart(e),a=Array(this._tabSize-(a-b)%this._tabSize+1).join(" ");this._doContent(a);return!0}},_doShiftTab:function(){if(this._tabMode&&!this._readonly)return!0},_doOverwriteMode:function(){if(!this._readonly)return this.setOptions({overwriteMode:!this.getOptions("overwriteMode")}),!0},_doTabMode:function(){this._tabMode=!this._tabMode;return!0},_doWrapMode:function(){this.setOptions({wrapMode:!this.getOptions("wrapMode")});
return!0},_autoScroll:function(){var a=this._model,b=this._getSelection(),e=this.convert({x:this._autoScrollX,y:this._autoScrollY},"page","document"),f=b.getCaret(),n=a.getLineCount(),d=a.getLineAtOffset(f),g;if("up"===this._autoScrollDir||"down"===this._autoScrollDir)f=this._autoScrollY/this._getLineHeight(),f=0>f?Math.floor(f):Math.ceil(f),g=Math.max(0,Math.min(n-1,d+f));else if("left"===this._autoScrollDir||"right"===this._autoScrollDir)g=this._getLineIndex(e.y),d=this._getLine(d),e.x+=d.getBoundingClientRect(f,
!1).left,d.destroy();0===g&&(h.isMac||h.isLinux)?b.extend(0):g===n-1&&(h.isMac||h.isLinux)?b.extend(a.getCharCount()):(d=this._getLine(g),b.extend(d.getOffset(e.x,e.y-this._getLinePixel(g))),d.destroy());this._setSelection(b,!0)},_autoScrollTimer:function(){this._autoScroll();var a=this;this._autoScrollTimerID=this._getWindow().setTimeout(function(){a._autoScrollTimer()},this._AUTO_SCROLL_RATE)},_calculateLineHeightTimer:function(a){if(this._lineHeight&&!this._calculateLHTimer){var b=this._model.getLineCount(),
e=0;if(a){a=0;for(var f=(new Date).getTime(),n=0;e<b&&!(this._lineHeight[e]||(a++,n||(n=e),this._lineHeight[e]=this._calculateLineHeight(e)),e++,100<(new Date).getTime()-f););this.redrawRulers(0,b);this._queueUpdate()}a=this._getWindow();if(e!==b){var d=this;this._calculateLHTimer=a.setTimeout(function(){d._calculateLHTimer=null;d._calculateLineHeightTimer(!0)},0)}else this._calculateLHTimer&&(a.clearTimeout(this._calculateLHTimer),this._calculateLHTimer=void 0)}},_calculateLineHeight:function(a){a=
this._getLine(a);var b=a.getBoundingClientRect();a.destroy();return Math.max(1,b.bottom-b.top)},_calculateMetrics:function(){var a=this._clientDiv,b=a.ownerDocument,e=h.createElement(b,"div");e.style.lineHeight="normal";var f={type:"LineStyle",textView:this,0:0,lineText:this._model.getLine(0),lineStart:0};this.onLineStyle(f);g(f.style,e);e.style.position="fixed";e.style.left="-1000px";var d=h.createElement(b,"span");d.appendChild(b.createTextNode(" "));e.appendChild(d);var c=h.createElement(b,"span");
c.style.fontStyle="italic";c.appendChild(b.createTextNode(" "));e.appendChild(c);var v=h.createElement(b,"span");v.style.fontWeight="bold";v.appendChild(b.createTextNode(" "));e.appendChild(v);f=h.createElement(b,"span");f.style.fontWeight="bold";f.style.fontStyle="italic";f.appendChild(b.createTextNode(" "));e.appendChild(f);a.appendChild(e);var k=e.getBoundingClientRect(),d=d.getBoundingClientRect(),c=c.getBoundingClientRect(),v=v.getBoundingClientRect(),f=f.getBoundingClientRect(),d=d.bottom-d.top,
c=c.bottom-c.top,v=v.bottom-v.top,l=f.bottom-f.top,u=0,f=0>=k.bottom-k.top,k=Math.max(1,k.bottom-k.top);c>d&&(u=1);v>c&&(u=2);l>v&&(u=3);var m;0!==u&&(m={style:{}},0!==(u&1)&&(m.style.fontStyle="italic"),0!==(u&2)&&(m.style.fontWeight="bold"));d=t(e);a.removeChild(e);u=n(this._viewDiv);e=h.createElement(b,"div");e.style.position="fixed";e.style.left="-1000px";e.style.paddingLeft=u.left+"px";e.style.paddingTop=u.top+"px";e.style.paddingRight=u.right+"px";e.style.paddingBottom=u.bottom+"px";e.style.width=
"100px";e.style.height="100px";u=h.createElement(b,"div");u.style.width="100%";u.style.height="100%";e.appendChild(u);a.appendChild(e);c=e.getBoundingClientRect();v=u.getBoundingClientRect();l=0;!this._singleMode&&!this._noScroll&&(e.style.overflow="hidden",u.style.height="200px",l=e.clientWidth,e.style.overflow="scroll",l-=e.clientWidth);a.removeChild(e);var u={left:v.left-c.left,top:v.top-c.top,right:c.right-v.right,bottom:c.bottom-v.bottom},x=0,p=v=0;if(!f){e=h.createElement(b,"div");e.style.position=
"fixed";e.style.left="-1000px";a.appendChild(e);e.innerHTML=Array(2).join("a");c=e.getBoundingClientRect();p=Math.ceil(c.right-c.left);if(this._wrapOffset||this._marginOffset)e.innerHTML=Array(this._wrapOffset+1+(h.isWebkit?0:1)).join(" "),c=e.getBoundingClientRect(),x=Math.ceil(c.right-c.left),e.innerHTML=Array(this._marginOffset+1).join(" "),v=e.getBoundingClientRect(),v=Math.ceil(v.right-v.left);a.removeChild(e)}return{lineHeight:k,largestFontStyle:m,lineTrim:d,viewPadding:u,scrollWidth:l,wrapWidth:x,
marginWidth:v,charWidth:p,invalid:f}},_cancelAnimation:function(){this._animation&&(this._animation.stop(),this._animation=null)},_clearSelection:function(a){var b=this._getSelection();if(b.isEmpty())return!1;"next"===a?b.start=b.end:b.end=b.start;this._setSelection(b,!0);return!0},_commitIME:function(a){if(-1!==this._imeOffset){var b=this._model,e=b.getLineAtOffset(this._imeOffset),f=b.getLineStart(e),n=this._getLineNode(e);if(!a){this._scrollDiv.focus();this._clientDiv.focus();var d=this._getDOMText(n).text,
b=b.getLine(e),f=this._imeOffset-f,b=f+d.length-b.length;f!==b&&(a=d.substring(f,b))}a&&(!this._doContent(a)&&!h.isWebkit)&&(n.lineRemoved=!0,this._queueUpdate());this._imeOffset=-1}},_createActions:function(){this.addKeyMode(new r.DefaultKeyMode(this));var b=this;this._actions={noop:{defaultHandler:function(){return b._doNoop()}},lineUp:{defaultHandler:function(e){return b._doLineUp(a(e,{select:!1}))},actionDescription:{name:p.lineUp}},lineDown:{defaultHandler:function(e){return b._doLineDown(a(e,
{select:!1}))},actionDescription:{name:p.lineDown}},lineStart:{defaultHandler:function(e){return b._doHome(a(e,{select:!1,ctrl:!1}))},actionDescription:{name:p.lineStart}},lineEnd:{defaultHandler:function(e){return b._doEnd(a(e,{select:!1,ctrl:!1}))},actionDescription:{name:p.lineEnd}},charPrevious:{defaultHandler:function(e){return b._doCursorPrevious(a(e,{select:!1,unit:"character"}))},actionDescription:{name:p.charPrevious}},charNext:{defaultHandler:function(e){return b._doCursorNext(a(e,{select:!1,
unit:"character"}))},actionDescription:{name:p.charNext}},pageUp:{defaultHandler:function(e){return b._doPageUp(a(e,{select:!1}))},actionDescription:{name:p.pageUp}},pageDown:{defaultHandler:function(e){return b._doPageDown(a(e,{select:!1}))},actionDescription:{name:p.pageDown}},scrollPageUp:{defaultHandler:function(e){return b._doScroll(a(e,{type:"pageUp"}))},actionDescription:{name:p.scrollPageUp}},scrollPageDown:{defaultHandler:function(e){return b._doScroll(a(e,{type:"pageDown"}))},actionDescription:{name:p.scrollPageDown}},
scrollLineUp:{defaultHandler:function(e){return b._doScroll(a(e,{type:"lineUp"}))},actionDescription:{name:p.scrollLineUp}},scrollLineDown:{defaultHandler:function(e){return b._doScroll(a(e,{type:"lineDown"}))},actionDescription:{name:p.scrollLineDown}},wordPrevious:{defaultHandler:function(e){return b._doCursorPrevious(a(e,{select:!1,unit:"word"}))},actionDescription:{name:p.wordPrevious}},wordNext:{defaultHandler:function(e){return b._doCursorNext(a(e,{select:!1,unit:"word"}))},actionDescription:{name:p.wordNext}},
textStart:{defaultHandler:function(e){return b._doHome(a(e,{select:!1,ctrl:!0}))},actionDescription:{name:p.textStart}},textEnd:{defaultHandler:function(e){return b._doEnd(a(e,{select:!1,ctrl:!0}))},actionDescription:{name:p.textEnd}},scrollTextStart:{defaultHandler:function(e){return b._doScroll(a(e,{type:"textStart"}))},actionDescription:{name:p.scrollTextStart}},scrollTextEnd:{defaultHandler:function(e){return b._doScroll(a(e,{type:"textEnd"}))},actionDescription:{name:p.scrollTextEnd}},centerLine:{defaultHandler:function(e){return b._doScroll(a(e,
{type:"centerLine"}))},actionDescription:{name:p.centerLine}},selectLineUp:{defaultHandler:function(e){return b._doLineUp(a(e,{select:!0}))},actionDescription:{name:p.selectLineUp}},selectLineDown:{defaultHandler:function(e){return b._doLineDown(a(e,{select:!0}))},actionDescription:{name:p.selectLineDown}},selectWholeLineUp:{defaultHandler:function(e){return b._doLineUp(a(e,{select:!0,wholeLine:!0}))},actionDescription:{name:p.selectWholeLineUp}},selectWholeLineDown:{defaultHandler:function(e){return b._doLineDown(a(e,
{select:!0,wholeLine:!0}))},actionDescription:{name:p.selectWholeLineDown}},selectLineStart:{defaultHandler:function(e){return b._doHome(a(e,{select:!0,ctrl:!1}))},actionDescription:{name:p.selectLineStart}},selectLineEnd:{defaultHandler:function(e){return b._doEnd(a(e,{select:!0,ctrl:!1}))},actionDescription:{name:p.selectLineEnd}},selectCharPrevious:{defaultHandler:function(e){return b._doCursorPrevious(a(e,{select:!0,unit:"character"}))},actionDescription:{name:p.selectCharPrevious}},selectCharNext:{defaultHandler:function(e){return b._doCursorNext(a(e,
{select:!0,unit:"character"}))},actionDescription:{name:p.selectCharNext}},selectPageUp:{defaultHandler:function(e){return b._doPageUp(a(e,{select:!0}))},actionDescription:{name:p.selectPageUp}},selectPageDown:{defaultHandler:function(e){return b._doPageDown(a(e,{select:!0}))},actionDescription:{name:p.selectPageDown}},selectWordPrevious:{defaultHandler:function(e){return b._doCursorPrevious(a(e,{select:!0,unit:"word"}))},actionDescription:{name:p.selectWordPrevious}},selectWordNext:{defaultHandler:function(e){return b._doCursorNext(a(e,
{select:!0,unit:"word"}))},actionDescription:{name:p.selectWordNext}},selectTextStart:{defaultHandler:function(e){return b._doHome(a(e,{select:!0,ctrl:!0}))},actionDescription:{name:p.selectTextStart}},selectTextEnd:{defaultHandler:function(e){return b._doEnd(a(e,{select:!0,ctrl:!0}))},actionDescription:{name:p.selectTextEnd}},deletePrevious:{defaultHandler:function(e){return b._doBackspace(a(e,{unit:"character"}))},actionDescription:{name:p.deletePrevious}},deleteNext:{defaultHandler:function(e){return b._doDelete(a(e,
{unit:"character"}))},actionDescription:{name:p.deleteNext}},deleteWordPrevious:{defaultHandler:function(e){return b._doBackspace(a(e,{unit:"word"}))},actionDescription:{name:p.deleteWordPrevious}},deleteWordNext:{defaultHandler:function(e){return b._doDelete(a(e,{unit:"word"}))},actionDescription:{name:p.deleteWordNext}},deleteLineStart:{defaultHandler:function(e){return b._doBackspace(a(e,{unit:"line"}))},actionDescription:{name:p.deleteLineStart}},deleteLineEnd:{defaultHandler:function(e){return b._doDelete(a(e,
{unit:"line"}))},actionDescription:{name:p.deleteLineEnd}},tab:{defaultHandler:function(e){return b._doTab(a(e,{}))},actionDescription:{name:p.tab}},shiftTab:{defaultHandler:function(e){return b._doShiftTab(a(e,{}))},actionDescription:{name:p.shiftTab}},enter:{defaultHandler:function(e){return b._doEnter(a(e,{}))},actionDescription:{name:p.enter}},enterNoCursor:{defaultHandler:function(e){return b._doEnter(a(e,{noCursor:!0}))},actionDescription:{name:p.enterNoCursor}},selectAll:{defaultHandler:function(e){return b._doSelectAll(a(e,
{}))},actionDescription:{name:p.selectAll}},copy:{defaultHandler:function(e){return b._doCopy(a(e,{}))},actionDescription:{name:p.copy}},cut:{defaultHandler:function(e){return b._doCut(a(e,{}))},actionDescription:{name:p.cut}},paste:{defaultHandler:function(e){return b._doPaste(a(e,{}))},actionDescription:{name:p.paste}},uppercase:{defaultHandler:function(e){return b._doCase(a(e,{type:"upper"}))},actionDescription:{name:p.uppercase}},lowercase:{defaultHandler:function(e){return b._doCase(a(e,{type:"lower"}))},
actionDescription:{name:p.lowercase}},capitalize:{defaultHandler:function(e){return b._doCase(a(e,{unit:"word",type:"capitalize"}))},actionDescription:{name:p.capitalize}},reversecase:{defaultHandler:function(e){return b._doCase(a(e,{type:"reverse"}))},actionDescription:{name:p.reversecase}},toggleOverwriteMode:{defaultHandler:function(e){return b._doOverwriteMode(a(e,{}))},actionDescription:{name:p.toggleOverwriteMode}},toggleTabMode:{defaultHandler:function(e){return b._doTabMode(a(e,{}))},actionDescription:{name:p.toggleTabMode}},
toggleWrapMode:{defaultHandler:function(e){return b._doWrapMode(a(e,{}))},actionDescription:{name:p.toggleWrapMode}}}},_createRulerParent:function(a,b){var e=h.createElement(a,"div");e.className=b;e.tabIndex=-1;e.style.overflow="hidden";e.style.MozUserSelect="none";e.style.WebkitUserSelect="none";e.style.position="absolute";e.style.top="0px";e.style.bottom="0px";e.style.cursor="default";e.style.display="none";e.setAttribute("aria-hidden","true");this._rootDiv.appendChild(e);return e},_createRuler:function(a,
b){if(this._clientDiv){var e=this._getRulerParent(a);if(e){if(e!==this._marginDiv||this._marginOffset)e.style.display="block";e.rulerWidth=void 0;var f=h.createElement(e.ownerDocument,"div");f._ruler=a;a.node=f;f.rulerChanged=!0;f.style.position="relative";f.style.cssFloat="left";f.style.styleFloat="left";f.style.outline="none";if(void 0===b||0>b||b>=e.children.length)e.appendChild(f);else{for(var n=e.firstChild;n&&0<b--;)n=n.nextSibling;e.insertBefore(f,n)}}}},_createView:function(){function a(){g._rootDiv&&
(g.update(!0),g._metrics.invalid&&g._getWindow().setTimeout(function(){a()},100))}if(!this._clientDiv){for(var b=this._parent;b.hasChildNodes();)b.removeChild(b.lastChild);var f=b.ownerDocument,n=h.createElement(f,"div");this._rootDiv=n;n.tabIndex=-1;n.style.position="relative";n.style.overflow="hidden";n.style.width="100%";n.style.height="100%";n.style.overflow="hidden";n.style.WebkitTextSizeAdjust="100%";n.setAttribute("role","application");b.appendChild(n);this._leftDiv=this._createRulerParent(f,
"textviewLeftRuler");b=h.createElement(f,"div");b.className="textviewScroll";this._viewDiv=b;b.tabIndex=-1;b.style.position="absolute";b.style.top="0px";b.style.bottom="0px";b.style.borderWidth="0px";b.style.margin="0px";b.style.outline="none";b.style.background="transparent";n.appendChild(b);var d=this._createRulerParent(f,"textviewRightRuler");this._rightDiv=d;d.style.right="0px";this._innerRightDiv=d=this._createRulerParent(f,"textviewInnerRightRuler");d.style.zIndex="1";this._scrollDiv=d=h.createElement(f,
"div");d.style.margin="0px";d.style.borderWidth="0px";d.style.padding="0px";b.appendChild(d);(this._marginDiv=this._createRulerParent(f,"textviewMarginRuler")).style.zIndex="4";!h.isIE&&!h.isIOS&&(this._clipDiv=b=h.createElement(f,"div"),b.style.position="absolute",b.style.overflow="hidden",b.style.margin="0px",b.style.borderWidth="0px",b.style.padding="0px",b.style.background="transparent",n.appendChild(b),this._clipScrollDiv=d=h.createElement(f,"div"),d.style.position="absolute",d.style.height=
"1px",d.style.top="-1000px",d.style.background="transparent",b.appendChild(d));this._setFullSelection(this._fullSelection,!0);b=h.createElement(f,"div");b.className="textviewContent";this._clientDiv=b;b.tabIndex=0;b.style.position="absolute";b.style.borderWidth="0px";b.style.margin="0px";b.style.padding="0px";b.style.outline="none";b.style.zIndex="1";b.style.WebkitUserSelect="text";b.setAttribute("spellcheck","false");if(h.isIOS||h.isAndroid)b.style.WebkitTapHighlightColor="transparent";(this._clipDiv||
n).appendChild(b);if(h.isIOS||h.isAndroid)this._vScrollDiv=d=h.createElement(f,"div"),d.style.position="absolute",d.style.borderWidth="1px",d.style.borderColor="white",d.style.borderStyle="solid",d.style.borderRadius="4px",d.style.backgroundColor="black",d.style.opacity="0.5",d.style.margin="0px",d.style.padding="0px",d.style.outline="none",d.style.zIndex="3",d.style.width="8px",d.style.display="none",n.appendChild(d),this._hScrollDiv=d=h.createElement(f,"div"),d.style.position="absolute",d.style.borderWidth=
"1px",d.style.borderColor="white",d.style.borderStyle="solid",d.style.borderRadius="4px",d.style.backgroundColor="black",d.style.opacity="0.5",d.style.margin="0px",d.style.padding="0px",d.style.outline="none",d.style.zIndex="3",d.style.height="8px",d.style.display="none",n.appendChild(d);h.isFirefox&&!b.setCapture&&(this._overlayDiv=d=h.createElement(f,"div"),d.style.position=b.style.position,d.style.borderWidth=b.style.borderWidth,d.style.margin=b.style.margin,d.style.padding=b.style.padding,d.style.cursor=
"text",d.style.zIndex="2",(this._clipDiv||n).appendChild(d));b.contentEditable="true";b.setAttribute("role","textbox");b.setAttribute("aria-multiline","true");this._setWrapMode(this._wrapMode,!0);this._setReadOnly(this._readonly);this._setThemeClass(this._themeClass,!0);this._setTabSize(this._tabSize,!0);this._setMarginOffset(this._marginOffset,!0);this._hookEvents();b=this._rulers;for(d=0;d<b.length;d++)this._createRuler(b[d]);this._update();var g=this;e(f,n,"textview",a)}},_defaultOptions:function(){return{parent:{value:void 0,
update:null},model:{value:void 0,update:this.setModel},scrollAnimation:{value:0,update:null},readonly:{value:!1,update:this._setReadOnly},fullSelection:{value:!0,update:this._setFullSelection},tabMode:{value:!0,update:null},tabSize:{value:8,update:this._setTabSize},expandTab:{value:!1,update:null},singleMode:{value:!1,update:this._setSingleMode},noScroll:{value:!1,update:this._setNoScroll},overwriteMode:{value:!1,update:this._setOverwriteMode},blockCursorVisible:{value:!1,update:this._setBlockCursor},
marginOffset:{value:0,update:this._setMarginOffset},wrapOffset:{value:0,update:this._setWrapOffset},wrapMode:{value:!1,update:this._setWrapMode},wrappable:{value:!1,update:null},theme:{value:c.TextTheme.getTheme(),update:this._setTheme},themeClass:{value:void 0,update:this._setThemeClass}}},_destroyRuler:function(a){var b=this._getRulerParent(a);if(b)for(var e=b.firstChild;e;){if(e._ruler===a){e._ruler=void 0;b.removeChild(e);if(0===b.children.length&&(b!==this._marginDiv||!this._marginOffset))b.style.display=
"none";b.rulerWidth=void 0;break}e=e.nextSibling}},_destroyView:function(){if(this._clientDiv){this._setGrab(null);this._unhookEvents();var a=this._getWindow();this._autoScrollTimerID&&(a.clearTimeout(this._autoScrollTimerID),this._autoScrollTimerID=null);this._updateTimer&&(a.clearTimeout(this._updateTimer),this._updateTimer=null);this._calculateLHTimer&&(a.clearTimeout(this._calculateLHTimer),this._calculateLHTimer=null);a=this._rootDiv;a.parentNode.removeChild(a);this._hScrollDiv=this._vScrollDiv=
this._cursorDiv=this._marginDiv=this._innerRightDiv=this._rightDiv=this._leftDiv=this._overlayDiv=this._clientDiv=this._clipScrollDiv=this._clipDiv=this._viewDiv=this._scrollDiv=this._rootDiv=this._clipboardDiv=this._selDiv3=this._selDiv2=this._selDiv1=null}},_doAutoScroll:function(a,b,e){this._autoScrollDir=a;this._autoScrollX=b;this._autoScrollY=e;this._autoScrollTimerID||this._autoScrollTimer()},_endAutoScroll:function(){this._autoScrollTimerID&&this._getWindow().clearTimeout(this._autoScrollTimerID);
this._autoScrollTimerID=this._autoScrollDir=void 0},_fixCaret:function(){var a=this._clientDiv;if(a){var b=this._hasFocus;this._ignoreFocus=!0;b&&a.blur();a.contentEditable=!1;a.contentEditable=!0;b&&a.focus();this._ignoreFocus=!1}},_getBaseText:function(a,b){var e=this._model;e.getBaseModel&&(a=e.mapOffset(a),b=e.mapOffset(b),e=e.getBaseModel());return e.getText(a,b)},_getBottomIndex:function(a){var b=this._bottomChild;if(a&&this._getClientHeight()>this._getLineHeight()){a=b.getBoundingClientRect();
var e=this._clientDiv.getBoundingClientRect();a.bottom>e.bottom&&(b=this._getLinePrevious(b)||b)}return b.lineIndex},_getBoundsAtOffset:function(a){var b=this._getLine(this._model.getLineAtOffset(a));a=b.getBoundingClientRect(a);var e=this._getLinePixel(b.lineIndex);a.top+=e;a.bottom+=e;b.destroy();return a},_getClientHeight:function(){var a=this._getViewPadding();return Math.max(0,this._viewDiv.clientHeight-a.top-a.bottom)},_getInnerRightWidth:function(){var a=this._innerRightDiv.rulerWidth;void 0===
a&&(a=this._innerRightDiv.getBoundingClientRect(),this._innerRightDiv.rulerWidth=a=a.right-a.left);return a},_getClientWidth:function(){var a=this._getViewPadding(),b=this._getInnerRightWidth();return Math.max(0,this._viewDiv.clientWidth-a.left-a.right-b)},_getClipboardText:function(a,b){var e=this._singleMode?"":this._model.getLineDelimiter(),n,d,g=this._getWindow(),c=g.clipboardData;!c&&a&&(c=a.clipboardData);if(c)return n=[],d=c.getData(h.isIE?"Text":"text/plain"),f(d,function(a){n.push(a)},function(){n.push(e)}),
d=n.join(""),b&&b(d),d;if(h.isFirefox){this._ignoreFocus=!0;var t=this._clipboardDiv,c=this._rootDiv.ownerDocument;t||(this._clipboardDiv=t=h.createElement(c,"div"),t.style.position="fixed",t.style.whiteSpace="pre",t.style.left="-1000px",this._rootDiv.appendChild(t));t.innerHTML="\x3cpre contenteditable\x3d''\x3e\x3c/pre\x3e";t.firstChild.focus();var v=this,k=function(){var a=v._getTextFromElement(t);t.innerHTML="";n=[];f(a,function(a){n.push(a)},function(){n.push(e)});return n.join("")},l=!1;this._ignorePaste=
!0;if(!h.isLinux||2!==this._lastMouseButton)try{l=c.execCommand("paste",!1,null)}catch(u){l=1<t.childNodes.length||t.firstChild&&0<t.firstChild.childNodes.length}this._ignorePaste=!1;if(!l){if(a)return g.setTimeout(function(){v.focus();(d=k())&&b&&b(d);v._ignoreFocus=!1},0),null;this.focus();this._ignoreFocus=!1;return""}this.focus();this._ignoreFocus=!1;(d=k())&&b&&b(d);return d}return""},_getDOMText:function(a,b){return a._line.getText(b)},_getTextFromElement:function(a){var b=a.ownerDocument,e=
b.defaultView;if(!e.getSelection)return a.innerText||a.textContent;b=b.createRange();b.selectNode(a);a=e.getSelection();var e=[],f;for(f=0;f<a.rangeCount;f++)e.push(a.getRangeAt(f));this._ignoreSelect=!0;a.removeAllRanges();a.addRange(b);b=a.toString();a.removeAllRanges();for(f=0;f<e.length;f++)a.addRange(e[f]);this._ignoreSelect=!1;return b},_getViewPadding:function(){return this._metrics.viewPadding},_getLine:function(a){var b=this._getLineNode(a);return b&&!b.lineChanged&&!b.lineRemoved?b._line:
new x(this,a)},_getLineHeight:function(a,b){if(void 0!==a&&this._lineHeight){var e=this._lineHeight[a];if(e)return e;if(b||void 0===b)return this._lineHeight[a]=this._calculateLineHeight(a)}return this._metrics.lineHeight},_getLineNode:function(a){for(var b=this._clientDiv.firstChild;b;){if(a===b.lineIndex)return b;b=b.nextSibling}},_getLineNext:function(a){for(a=a?a.nextSibling:this._clientDiv.firstChild;a&&(-1===a.lineIndex||!a._line);)a=a.nextSibling;return a},_getLinePrevious:function(a){for(a=
a?a.previousSibling:this._clientDiv.lastChild;a&&(-1===a.lineIndex||!a._line);)a=a.previousSibling;return a},_getLinePixel:function(a){a=Math.min(Math.max(0,a),this._model.getLineCount());if(this._lineHeight){var b=this._getTopIndex(),e=-this._topIndexY+this._getScroll().y;if(a>b)for(;b<a;b++)e+=this._getLineHeight(b);else for(b-=1;b>=a;b--)e-=this._getLineHeight(b);return e}return this._getLineHeight()*a},_getLineIndex:function(a){var b,e=0,f=this._model.getLineCount();if(this._lineHeight){var e=
this._getTopIndex(),n=-this._topIndexY+this._getScroll().y;if(a!==n)if(a<n)for(;a<n&&0<e;)a+=this._getLineHeight(--e);else for(b=this._getLineHeight(e);a-b>=n&&e<f-1;)a-=b,b=this._getLineHeight(++e)}else b=this._getLineHeight(),e=Math.floor(a/b);return Math.max(0,Math.min(f-1,e))},_getRulerParent:function(a){switch(a.getLocation()){case "left":return this._leftDiv;case "right":return this._rightDiv;case "innerRight":return this._innerRightDiv;case "margin":return this._marginDiv}return null},_getScroll:function(a){(void 0===
a||a)&&this._cancelAnimation();a=this._viewDiv;return{x:a.scrollLeft,y:a.scrollTop}},_getSelection:function(){return this._selection.clone()},_getTopIndex:function(a){var b=this._topChild;if(a&&this._getClientHeight()>this._getLineHeight()){a=b.getBoundingClientRect();var e=this._getViewPadding(),f=this._viewDiv.getBoundingClientRect();a.top<f.top+e.top&&(b=this._getLineNext(b)||b)}return b.lineIndex},_hookEvents:function(){var a=this;this._modelListener={onChanging:function(b){a._onModelChanging(b)},
onChanged:function(b){a._onModelChanged(b)}};this._model.addEventListener("preChanging",this._modelListener.onChanging);this._model.addEventListener("postChanged",this._modelListener.onChanged);this._themeListener={onChanged:function(){a._setThemeClass(a._themeClass)}};this._theme.addEventListener("ThemeChanged",this._themeListener.onChanged);var b=this._handlers=[],e=this._clientDiv,f=this._viewDiv,n=this._rootDiv,d=this._overlayDiv||e,g=e.ownerDocument,c=this._getWindow(),t=h.isIE?g:c;b.push({target:c,
type:"resize",handler:function(b){return a._handleResize(b?b:c.event)}});b.push({target:e,type:"blur",handler:function(b){return a._handleBlur(b?b:c.event)}});b.push({target:e,type:"focus",handler:function(b){return a._handleFocus(b?b:c.event)}});b.push({target:f,type:"focus",handler:function(){e.focus()}});b.push({target:f,type:"scroll",handler:function(b){return a._handleScroll(b?b:c.event)}});b.push({target:e,type:"textInput",handler:function(b){return a._handleTextInput(b?b:c.event)}});b.push({target:e,
type:"keydown",handler:function(b){return a._handleKeyDown(b?b:c.event)}});b.push({target:e,type:"keypress",handler:function(b){return a._handleKeyPress(b?b:c.event)}});b.push({target:e,type:"keyup",handler:function(b){return a._handleKeyUp(b?b:c.event)}});h.isIE&&b.push({target:g,type:"keyup",handler:function(b){return a._handleDocKeyUp(b?b:c.event)}});b.push({target:e,type:"contextmenu",handler:function(b){return a._handleContextMenu(b?b:c.event)}});b.push({target:e,type:"copy",handler:function(b){return a._handleCopy(b?
b:c.event)}});b.push({target:e,type:"cut",handler:function(b){return a._handleCut(b?b:c.event)}});b.push({target:e,type:"paste",handler:function(b){return a._handlePaste(b?b:c.event)}});b.push({target:g,type:"selectionchange",handler:function(b){return a._handleSelectionChange(b?b:c.event)}});if(h.isIOS||h.isAndroid)b.push({target:e,type:"touchstart",handler:function(b){return a._handleTouchStart(b?b:c.event)}}),b.push({target:e,type:"touchmove",handler:function(b){return a._handleTouchMove(b?b:c.event)}}),
b.push({target:e,type:"touchend",handler:function(b){return a._handleTouchEnd(b?b:c.event)}});else{b.push({target:e,type:"selectstart",handler:function(b){return a._handleSelectStart(b?b:c.event)}});b.push({target:e,type:"mousedown",handler:function(b){return a._handleMouseDown(b?b:c.event)}});b.push({target:e,type:"mouseover",handler:function(b){return a._handleMouseOver(b?b:c.event)}});b.push({target:e,type:"mouseout",handler:function(b){return a._handleMouseOut(b?b:c.event)}});b.push({target:t,
type:"mouseup",handler:function(b){return a._handleMouseUp(b?b:c.event)}});b.push({target:t,type:"mousemove",handler:function(b){return a._handleMouseMove(b?b:c.event)}});b.push({target:n,type:"mousedown",handler:function(b){return a._handleRootMouseDown(b?b:c.event)}});b.push({target:n,type:"mouseup",handler:function(b){return a._handleRootMouseUp(b?b:c.event)}});b.push({target:d,type:"dragstart",handler:function(b){return a._handleDragStart(b?b:c.event)}});b.push({target:d,type:"drag",handler:function(b){return a._handleDrag(b?
b:c.event)}});b.push({target:d,type:"dragend",handler:function(b){return a._handleDragEnd(b?b:c.event)}});b.push({target:d,type:"dragenter",handler:function(b){return a._handleDragEnter(b?b:c.event)}});b.push({target:d,type:"dragover",handler:function(b){return a._handleDragOver(b?b:c.event)}});b.push({target:d,type:"dragleave",handler:function(b){return a._handleDragLeave(b?b:c.event)}});b.push({target:d,type:"drop",handler:function(b){return a._handleDrop(b?b:c.event)}});b.push({target:this._clientDiv,
type:26<h.isFirefox?"wheel":h.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(b){return a._handleMouseWheel(b?b:c.event)}});this._clipDiv&&b.push({target:this._clipDiv,type:26<h.isFirefox?"wheel":h.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(b){return a._handleMouseWheel(b?b:c.event)}});if(h.isFirefox&&(!h.isWindows||15<=h.isFirefox))(f=c.MutationObserver||c.MozMutationObserver)?(this._mutationObserver=new f(function(b){a._handleDataModified(b)}),this._mutationObserver.observe(e,
{subtree:!0,characterData:!0})):b.push({target:this._clientDiv,type:"DOMCharacterDataModified",handler:function(b){return a._handleDataModified(b?b:c.event)}});if(h.isFirefox&&(!h.isWindows||15<=h.isFirefox)||h.isIE)b.push({target:this._clientDiv,type:"compositionstart",handler:function(b){return a._handleCompositionStart(b?b:c.event)}}),b.push({target:this._clientDiv,type:"compositionend",handler:function(b){return a._handleCompositionEnd(b?b:c.event)}});this._overlayDiv&&(b.push({target:this._overlayDiv,
type:"mousedown",handler:function(b){return a._handleMouseDown(b?b:c.event)}}),b.push({target:this._overlayDiv,type:"mouseover",handler:function(b){return a._handleMouseOver(b?b:c.event)}}),b.push({target:this._overlayDiv,type:"mouseout",handler:function(b){return a._handleMouseOut(b?b:c.event)}}),b.push({target:this._overlayDiv,type:"contextmenu",handler:function(b){return a._handleContextMenu(b?b:c.event)}}));this._isW3CEvents||b.push({target:this._clientDiv,type:"dblclick",handler:function(b){return a._handleDblclick(b?
b:c.event)}})}this._hookRulerEvents(this._leftDiv,b);this._hookRulerEvents(this._rightDiv,b);this._hookRulerEvents(this._innerRightDiv,b);this._hookRulerEvents(this._marginDiv,b);for(f=0;f<b.length;f++)n=b[f],z(n.target,n.type,n.handler,n.capture)},_hookRulerEvents:function(a,b){if(a){var e=this,f=this._getWindow();h.isIE&&b.push({target:a,type:"selectstart",handler:function(){return!1}});b.push({target:a,type:26<h.isFirefox?"wheel":h.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(a){return e._handleMouseWheel(a?
a:f.event)}});b.push({target:a,type:"click",handler:function(a){e._handleRulerEvent(a?a:f.event)}});b.push({target:a,type:"dblclick",handler:function(a){e._handleRulerEvent(a?a:f.event)}});b.push({target:a,type:"mousemove",handler:function(a){e._handleRulerEvent(a?a:f.event)}});b.push({target:a,type:"mouseover",handler:function(a){e._handleRulerEvent(a?a:f.event)}});b.push({target:a,type:"mouseout",handler:function(a){e._handleRulerEvent(a?a:f.event)}})}},_getWindow:function(){return this._parent.ownerDocument.defaultView||
this._parent.ownerDocument.parentWindow},_ignoreEvent:function(a){for(a=a.target;a&&a!==this._clientDiv;){if(a.ignore)return!0;a=a.parentNode}return!1},_init:function(a){var b=a.parent;"string"===typeof b&&(b=(a.document||document).getElementById(b));if(!b)throw Error("no parent");a.parent=b;a.model=a.model||new s.TextModel;var e=this._defaultOptions(),f;for(f in e)e.hasOwnProperty(f)&&(this["_"+f]=void 0!==a[f]?a[f]:e[f].value);this._keyModes=[];this._rulers=[];this._selection=new v(0,0,!1);this._linksVisible=
!1;this._maxLineWidth=this._redrawCount=0;this._maxLineIndex=-1;this._ignoreSelect=!0;this._hasFocus=this._ignoreFocus=!1;this._dragOffset=this._columnX=-1;this._isRangeRects=(!h.isIE||9<=h.isIE)&&"function"===typeof b.ownerDocument.createRange().getBoundingClientRect;this._isW3CEvents=b.addEventListener;this._autoScrollTimerID=this._autoScrollY=this._autoScrollX=null;this._AUTO_SCROLL_RATE=50;this._mouseUpClosure=this._moseMoveClosure=this._grabControl=null;this._clickCount=this._lastMouseTime=this._lastMouseY=
this._lastMouseX=0;this._clickTime=250;this._clickDist=5;this._isMouseDown=!1;this._doubleClickSelection=null;this._vScroll=this._hScroll=0;this._imeOffset=-1;this._createActions();this._createView()},_checkOverlayScroll:function(){if(h.isMac&&h.isWebkit&&!this._metrics.invalid&&0===this._metrics.scrollWidth){var a=this._viewDiv,b=this._isOverOverlayScroll();a.style.pointerEvents=b.vertical||b.horizontal?"":"none"}},_isOverOverlayScroll:function(){if(!(200>(new Date).getTime()-this._lastScrollTime))return{};
var a=this._viewDiv.getBoundingClientRect(),b=this._lastMouseMoveX,e=this._lastMouseMoveY;return{vertical:a.top<=e&&e<a.bottom&&a.right-15<=b&&b<a.right,horizontal:a.bottom-15<=e&&e<a.bottom&&a.left<=b&&b<a.right}},_modifyContent:function(a,b){if(this._readonly&&!a._code)return!1;a.type="Verify";this.onVerify(a);if(null===a.text||void 0===a.text)return!1;var e=this._model;try{a._ignoreDOMSelection&&(this._ignoreDOMSelection=!0),e.setText(a.text,a.start,a.end)}finally{a._ignoreDOMSelection&&(this._ignoreDOMSelection=
!1)}if(b){e=this._getSelection();e.setCaret(a.start+a.text.length);try{a._ignoreDOMSelection1&&(this._ignoreDOMSelection=!0),this._setSelection(e,!0)}finally{a._ignoreDOMSelection1&&(this._ignoreDOMSelection=!1)}}this.onModify({type:"Modify"});return!0},_onModelChanged:function(a){a.type="ModelChanged";this.onModelChanged(a);a.type="Changed";var b=a.start,e=a.addedCharCount,f=a.removedCharCount,n=a.addedLineCount,d=a.removedLineCount,g=this._getSelection();g.end>b&&(g.end>b&&g.start<b+f?g.setCaret(b+
e):(g.start+=e-f,g.end+=e-f),this._setSelection(g,!1,!1));b=this._model.getLineAtOffset(b);for(e=this._getLineNext();e;)f=e.lineIndex,b<=f&&f<=b+d&&(b===f&&!e.modelChangedEvent&&!e.lineRemoved?(e.modelChangedEvent=a,e.lineChanged=!0):(e.lineRemoved=!0,e.lineChanged=!1,e.modelChangedEvent=null)),f>b+d&&(e.lineIndex=f+n-d,e._line.lineIndex=e.lineIndex),e=this._getLineNext(e);this._lineHeight&&(a=[b,d].concat(Array(n)),Array.prototype.splice.apply(this._lineHeight,a));!this._wrapMode&&(b<=this._maxLineIndex&&
this._maxLineIndex<=b+d)&&(this._checkMaxLineIndex=this._maxLineIndex,this._maxLineIndex=-1,this._maxLineWidth=0);this._update()},_onModelChanging:function(a){a.type="ModelChanging";this.onModelChanging(a);a.type="Changing"},_queueUpdate:function(){if(!this._updateTimer&&!this._ignoreQueueUpdate){var a=this;this._updateTimer=this._getWindow().setTimeout(function(){a._updateTimer=null;a._update()},0)}},_resetLineHeight:function(a,b){if(this._wrapMode||this._variableLineHeight){if(void 0!==a&&void 0!==
b)for(var e=a;e<b;e++)this._lineHeight[e]=void 0;else e=this._model.getLineCount(),this._lineHeight=Array(e);this._calculateLineHeightTimer()}else this._lineHeight=null},_resetLineWidth:function(){var a=this._clientDiv;if(a)for(a=a.firstChild;a;)a.lineWidth=void 0,a=a.nextSibling},_reset:function(){this._maxLineIndex=-1;this._maxLineWidth=0;this._columnX=-1;this._bottomChild=this._topChild=null;this._topIndexY=0;this._variableLineHeight=!1;this._resetLineHeight();this._setSelection(new v(0,0,!1),
!1,!1);this._viewDiv&&(this._viewDiv.scrollLeft=0,this._viewDiv.scrollTop=0);var a=this._clientDiv;if(a){for(a=a.firstChild;a;)a.lineRemoved=!0,a=a.nextSibling;13>h.isFirefox&&this._fixCaret()}},_scrollViewAnimated:function(a,b,e){var f=this._getWindow();if(e&&this._scrollAnimation){var n=this;this._animation=new B({window:f,duration:this._scrollAnimation,curve:[b,0],onAnimate:function(a){a=b-Math.floor(a);n._scrollView(0,a);b-=a},onEnd:function(){n._animation=null;n._scrollView(a,b);e&&f.setTimeout(e,
0)}});this._animation.play()}else this._scrollView(a,b),e&&f.setTimeout(e,0)},_scrollView:function(a,b){this._ensureCaretVisible=!1;var e=this._viewDiv;a&&(e.scrollLeft+=a);b&&(e.scrollTop+=b)},_setClipboardText:function(a,b){var e,n=this._getWindow(),d=n.clipboardData;!d&&b&&(d=b.clipboardData);if(d&&(e=[],f(a,function(a){e.push(a)},function(){e.push(h.platformDelimiter)}),d.setData(h.isIE?"Text":"text/plain",e.join(""))||21<h.isFirefox))return!0;var g=this._parent.ownerDocument,c=h.createElement(g,
"pre");c.style.position="fixed";c.style.left="-1000px";f(a,function(a){c.appendChild(g.createTextNode(a))},function(){c.appendChild(h.createElement(g,"br"))});c.appendChild(g.createTextNode(" "));this._clientDiv.appendChild(c);d=g.createRange();d.setStart(c.firstChild,0);d.setEndBefore(c.lastChild);var t=n.getSelection();0<t.rangeCount&&t.removeAllRanges();t.addRange(d);var v=this,d=function(){c&&c.parentNode===v._clientDiv&&v._clientDiv.removeChild(c);v._updateDOMSelection()},t=!1;this._ignoreCopy=
!0;try{t=g.execCommand("copy",!1,null)}catch(k){}this._ignoreCopy=!1;if(!t&&b)return n.setTimeout(d,0),!1;d();return!0},_setDOMSelection:function(a,b,e,f,n){this._setDOMFullSelection(a,b,e,f);a=a._line.getNodeOffset(b);e=e._line.getNodeOffset(f);f=this._getWindow();b=this._parent.ownerDocument;if(f.getSelection){var d=f.getSelection();f=b.createRange();f.setStart(a.node,a.offset);f.setEnd(e.node,e.offset);if(this._hasFocus&&(d.anchorNode!==a.node||d.anchorOffset!==a.offset||d.focusNode!==e.node||
d.focusOffset!==e.offset||d.anchorNode!==e.node||d.anchorOffset!==e.offset||d.focusNode!==a.node||d.focusOffset!==a.offset))this._anchorNode=a.node,this._anchorOffset=a.offset,this._focusNode=e.node,this._focusOffset=e.offset,this._ignoreSelect=!1,0<d.rangeCount&&d.removeAllRanges(),d.addRange(f),this._ignoreSelect=!0;this._cursorDiv&&(f=b.createRange(),n?(f.setStart(a.node,a.offset),f.setEnd(a.node,a.offset)):(f.setStart(e.node,e.offset),f.setEnd(e.node,e.offset)),n=f.getClientRects()[0],a=this._cursorDiv.parentNode,
e=a.getBoundingClientRect(),n&&e&&(this._cursorDiv.style.top=n.top-e.top+a.scrollTop+"px",this._cursorDiv.style.left=n.left-e.left+a.scrollLeft+"px"))}else b.selection&&this._hasFocus&&(n=b.body,f=h.createElement(b,"div"),n.appendChild(f),n.removeChild(f),f=n.createTextRange(),f.moveToElementText(a.node.parentNode),f.moveStart("character",a.offset),n=n.createTextRange(),n.moveToElementText(e.node.parentNode),n.moveStart("character",e.offset),f.setEndPoint("EndToStart",n),this._ignoreSelect=!1,f.select(),
this._ignoreSelect=!0)},_setDOMFullSelection:function(a,b,e,f){if(this._selDiv1){var n=this._selDiv1;n.style.width="0px";n.style.height="0px";n=this._selDiv2;n.style.width="0px";n.style.height="0px";n=this._selDiv3;n.style.width="0px";n.style.height="0px";if(!(a===e&&b===f)){var d=this._getViewPadding(),g=this._clientDiv.getBoundingClientRect(),c=this._viewDiv.getBoundingClientRect(),n=c.left+d.left,h=g.right,d=c.top+d.top,t=g.bottom,c=g=0;this._clipDiv?(c=this._clipDiv.getBoundingClientRect(),g=
c.left-this._clipDiv.scrollLeft):(c=this._rootDiv.getBoundingClientRect(),g=c.left);c=c.top;this._ignoreDOMSelection=!0;var v=(new x(this,a.lineIndex,a)).getBoundingClientRect(b,!1),k=v.left;b=(new x(this,e.lineIndex,e)).getBoundingClientRect(f,!1);var l=b.left;this._ignoreDOMSelection=!1;var u=this._selDiv1,k=Math.min(h,Math.max(n,k)),m=Math.min(t,Math.max(d,v.top)),p=h;f=Math.min(t,Math.max(d,v.bottom));u.style.left=k-g+"px";u.style.top=m-c+"px";u.style.width=Math.max(0,p-k)+"px";u.style.height=
Math.max(0,f-m)+"px";a.lineIndex===e.lineIndex?(p=Math.min(l,h),u.style.width=Math.max(0,p-k)+"px"):(v=Math.min(t,Math.max(d,b.top)),l=Math.min(h,Math.max(n,l)),d=Math.min(t,Math.max(d,b.bottom)),t=this._selDiv3,t.style.left=n-g+"px",t.style.top=v-c+"px",t.style.width=Math.max(0,l-n)+"px",t.style.height=Math.max(0,d-v)+"px",1<Math.abs(a.lineIndex-e.lineIndex)&&(a=this._selDiv2,a.style.left=n-g+"px",a.style.top=f-c+"px",a.style.width=Math.max(0,h-n)+"px",a.style.height=Math.max(0,v-f)+"px"))}}},_setGrab:function(a){a!==
this._grabControl&&(a?(a.setCapture&&a.setCapture(),this._grabControl=a):(this._grabControl.releaseCapture&&this._grabControl.releaseCapture(),this._grabControl=null))},_setLinksVisible:function(a){if(this._linksVisible!==a){this._linksVisible=a;h.isIE&&a&&(this._hadFocus=this._hasFocus);var b=this._clientDiv;b.contentEditable=!a;this._hadFocus&&!a&&b.focus();this._overlayDiv&&(this._overlayDiv.style.zIndex=a?"-1":"1");for(a=this._getLineNext();a;)a._line.updateLinks(),a=this._getLineNext(a);this._updateDOMSelection()}},
_setSelection:function(a,b,e,f,n){if(a){this._columnX=-1;void 0===e&&(e=!0);var d=this._selection;this._selection=a;!1!==b&&this._showCaret(!1,f,b,n);e&&this._updateDOMSelection();if(!d.equals(a))this.onSelection({type:"Selection",oldValue:{start:d.start,end:d.end},newValue:{start:a.start,end:a.end}})}},_setSelectionTo:function(a,b,e,f){var n=this._model,d=this._getSelection();b=this.convert({x:a,y:b},"page","document");a=this._getLineIndex(b.y);if(1===this._clickCount){n=this._getLine(a);a=n.getOffset(b.x,
b.y-this._getLinePixel(a));n.destroy();if(f&&!e&&d.start<=a&&a<d.end)return this._dragOffset=a,!1;d.extend(a);e||d.collapse()}else 0===(this._clickCount&1)?(n=this._getLine(a),a=n.getOffset(b.x,b.y-this._getLinePixel(a)),this._doubleClickSelection?a>=this._doubleClickSelection.start?(e=this._doubleClickSelection.start,f=n.getNextOffset(a,{unit:"wordend",count:1})):(e=n.getNextOffset(a,{unit:"word",count:-1}),f=this._doubleClickSelection.end):(e=n.getNextOffset(a,{unit:"word",count:-1}),f=n.getNextOffset(e,
{unit:"wordend",count:1})),n.destroy()):this._doubleClickSelection?(f=n.getLineAtOffset(this._doubleClickSelection.start),a>=f?(e=n.getLineStart(f),f=n.getLineEnd(a)):(e=n.getLineStart(a),f=n.getLineEnd(f))):(e=n.getLineStart(a),f=n.getLineEnd(a)),d.setCaret(e),d.extend(f);this._setSelection(d,!0,!0);return!0},_setFullSelection:function(a,b){this._fullSelection=a;h.isWebkit&&(this._fullSelection=!0);var e=this._clipDiv||this._rootDiv;if(e)if(this._fullSelection){if(!this._selDiv1&&this._fullSelection&&
!h.isIOS){var f=e.ownerDocument;this._highlightRGB=h.isWebkit?"transparent":"Highlight";var n=h.createElement(f,"div");this._selDiv1=n;n.style.position="absolute";n.style.borderWidth="0px";n.style.margin="0px";n.style.padding="0px";n.style.outline="none";n.style.background=this._highlightRGB;n.style.width="0px";n.style.height="0px";n.style.zIndex="0";e.appendChild(n);var d=h.createElement(f,"div");this._selDiv2=d;d.style.position="absolute";d.style.borderWidth="0px";d.style.margin="0px";d.style.padding=
"0px";d.style.outline="none";d.style.background=this._highlightRGB;d.style.width="0px";d.style.height="0px";d.style.zIndex="0";e.appendChild(d);this._selDiv3=f=h.createElement(f,"div");f.style.position="absolute";f.style.borderWidth="0px";f.style.margin="0px";f.style.padding="0px";f.style.outline="none";f.style.background=this._highlightRGB;f.style.width="0px";f.style.height="0px";f.style.zIndex="0";e.appendChild(f);if(h.isFirefox&&h.isMac){e=this._getWindow().getComputedStyle(f,null).getPropertyValue("background-color");
switch(e){case "rgb(119, 141, 168)":e="rgb(199, 208, 218)";break;case "rgb(127, 127, 127)":e="rgb(198, 198, 198)";break;case "rgb(255, 193, 31)":e="rgb(250, 236, 115)";break;case "rgb(243, 70, 72)":e="rgb(255, 176, 139)";break;case "rgb(255, 138, 34)":e="rgb(255, 209, 129)";break;case "rgb(102, 197, 71)":e="rgb(194, 249, 144)";break;case "rgb(140, 78, 184)":e="rgb(232, 184, 255)";break;default:e="rgb(180, 213, 255)"}this._highlightRGB=e;n.style.background=e;d.style.background=e;f.style.background=
e}b||this._updateDOMSelection()}}else this._selDiv1&&(e.removeChild(this._selDiv1),this._selDiv1=null),this._selDiv2&&(e.removeChild(this._selDiv2),this._selDiv2=null),this._selDiv3&&(e.removeChild(this._selDiv3),this._selDiv3=null)},_setBlockCursor:function(a){this._blockCursorVisible=a;this._updateBlockCursorVisible()},_setOverwriteMode:function(a){this._overwriteMode=a;this._updateBlockCursorVisible()},_updateBlockCursorVisible:function(){if(this._blockCursorVisible||this._overwriteMode){if(!this._cursorDiv){var a=
this._viewDiv,b=h.createElement(a.ownerDocument,"div");b.className="textviewBlockCursor";this._cursorDiv=b;b.tabIndex=-1;b.style.zIndex="2";b.style.color="transparent";b.style.position="absolute";b.style.pointerEvents="none";b.innerHTML="\x26nbsp;";a.appendChild(b);this._updateDOMSelection()}}else this._cursorDiv&&(this._cursorDiv.parentNode.removeChild(this._cursorDiv),this._cursorDiv=null)},_setMarginOffset:function(a,b){this._marginOffset=a;this._marginDiv.style.display=a?"block":"none";b||(this._metrics=
this._calculateMetrics(),this._queueUpdate())},_setWrapOffset:function(a,b){this._wrapOffset=a;b||(this._metrics=this._calculateMetrics(),this._queueUpdate())},_setReadOnly:function(a){this._readonly=a;this._clientDiv.setAttribute("aria-readonly",a?"true":"false")},_setSingleMode:function(a,b){this._singleMode=a;this._updateOverflow();this._updateStyle(b)},_setNoScroll:function(a,b){this._noScroll=a;this._updateOverflow();this._updateStyle(b)},_setTabSize:function(a,b){this._tabSize=a;this._customTabSize=
void 0;var e=this._clientDiv;h.isOpera?e&&(e.style.OTabSize=this._tabSize+""):537.1<=h.isWebkit?e&&(e.style.tabSize=this._tabSize+""):4<=h.isFirefox?e&&(e.style.MozTabSize=this._tabSize+""):8!==this._tabSize&&(this._customTabSize=this._tabSize);b||(this.redrawLines(),this._resetLineWidth())},_setTheme:function(a){this._theme&&this._theme.removeEventListener("ThemeChanged",this._themeListener.onChanged);(this._theme=a)&&this._theme.addEventListener("ThemeChanged",this._themeListener.onChanged);this._setThemeClass(this._themeClass)},
_setThemeClass:function(a,b){this._themeClass=a;var e="textview",f=this._theme.getThemeClass();f&&(e+=" "+f);this._themeClass&&f!==this._themeClass&&(e+=" "+this._themeClass);this._rootDiv.className=e;this._updateStyle(b)},_setWrapMode:function(a,b){this._wrapMode=a&&this._wrappable;var e=this._clientDiv;this._wrapMode?(e.style.whiteSpace="pre-wrap",e.style.wordWrap="break-word"):(e.style.whiteSpace="pre",e.style.wordWrap="normal");this._updateOverflow();b||(this.redraw(),this._resetLineWidth());
this._resetLineHeight()},_showCaret:function(a,b,e,f){if(this._clientDiv&&!(0<this._redrawCount)&&!this._ignoreDOMSelection){var n=this._model,d=this._getSelection(),g=this._getScroll(),c=d.getCaret(),h=d.start,t=d.end,v=n.getLineAtOffset(h),k=n.getLineAtOffset(t),l=Math.max(Math.max(h,n.getLineStart(k)),t-1),n=this._getClientWidth(),u=this._getClientHeight(),m=n/4,x=this._getBoundsAtOffset(c===h?h:l),p=x.left,w=x.right,r=x.top,z=x.bottom,s=0,D="object"===typeof e;if((a||D)&&!d.isEmpty())x=this._getBoundsAtOffset(c===
t?h:l),s=(x.bottom>z?x.bottom:z)-(x.top<r?x.top:r),a&&(x.top===r?c===h?w=p+Math.min(x.right-p,n):p=w-Math.min(w-x.left,n):c===h?z=r+Math.min(x.bottom-r,u):r=z-Math.min(z-x.top,u));a=0;p<g.x&&(a=Math.min(p-g.x,-m));w>g.x+n&&(a=Math.max(w-g.x-n,m));d=0;r<g.y?d=r-g.y:z>g.y+u&&(d=z-g.y-u);f&&(0<f?0<d&&(d=Math.max(d,f)):0>d&&(d=Math.min(d,f)));f=D&&"always"===e.scrollPolicy;if(0!==a||0!==d||f)return D?(f=0<d,0===d&&(d=r-g.y),g=e.viewAnchor,r=e.selectionAnchor,e=Math.min(Math.max(0,e.viewAnchorOffset||
0)),d="top"===g?d+Math.floor(f?(1-e)*u:-e*u):"bottom"===g?d+Math.floor(f?e*u:-(1-e)*u):"center"===g?d+Math.floor(f?u/2+e*u:u/2-(1-e)*u):d+Math.floor(f?e*u:-e*u),v!==k&&("top"===r&&c!==h?d+=Math.floor(-s):"bottom"===r&&c!==t?d+=Math.floor(s):"center"===r&&(d+=Math.floor(s/2)))):0!==d&&"number"===typeof e&&(0>e&&(e=0),1<e&&(e=1),d+=Math.floor(0<d?e*u:-e*u)),this._scrollViewAnimated(a,d,b),u!==this._getClientHeight()||n!==this._getClientWidth()?this._showCaret():this._ensureCaretVisible=!0,!0;b&&b();
return!1}},_startIME:function(){if(-1===this._imeOffset){var a=this._getSelection();a.isEmpty()||this._modifyContent({text:"",start:a.start,end:a.end},!0);this._imeOffset=a.start}},_unhookEvents:function(){this._model.removeEventListener("preChanging",this._modelListener.onChanging);this._model.removeEventListener("postChanged",this._modelListener.onChanged);this._theme.removeEventListener("ThemeChanged",this._themeListener.onChanged);this._modelListener=null;for(var a=0;a<this._handlers.length;a++){var b=
this._handlers[a];D(b.target,b.type,b.handler)}this._handlers=null;this._mutationObserver&&(this._mutationObserver.disconnect(),this._mutationObserver=null)},_updateDOMSelection:function(){if(!(0<this._redrawCount)&&!this._ignoreDOMSelection&&this._clientDiv){var a=this._getSelection(),b=this._model,e=b.getLineAtOffset(a.start),f=b.getLineAtOffset(a.end),n=this._getLineNext();if(n){var d=this._getLinePrevious(),g;e<n.lineIndex?(e=n,g=b.getLineStart(n.lineIndex)):e>d.lineIndex?(e=d,g=b.getLineStart(d.lineIndex)):
(e=this._getLineNode(e),g=a.start);f<n.lineIndex?(f=n,b=b.getLineStart(n.lineIndex)):f>d.lineIndex?(f=d,b=b.getLineStart(d.lineIndex)):(f=this._getLineNode(f),b=a.end);this._setDOMSelection(e,g,f,b,a.caret)}}},_update:function(a){if(!(0<this._redrawCount)){this._updateTimer&&(this._getWindow().clearTimeout(this._updateTimer),this._updateTimer=null,a=!1);var b=this._clientDiv,e=this._viewDiv;if(b){this._metrics.invalid&&(this._ignoreQueueUpdate=!0,this._updateStyle(),this._ignoreQueueUpdate=!1);var f=
this._model,n=this._getScroll(!1),d=this._getViewPadding(),g=f.getLineCount(),c=this._getLineHeight(),t=!1,v=!1,k=!1,l=this._metrics.scrollWidth;this._wrapMode&&(b.style.width=(this._metrics.wrapWidth||this._getClientWidth())+"px");var u,m,p,w,r=0,z=0,s;if(this._lineHeight){for(;z<g;){s=this._getLineHeight(z);if(r+s>n.y)break;r+=s;z++}u=z;m=Math.max(0,u-1);p=f=n.y-r;0<u&&(f+=this._getLineHeight(u-1))}else w=Math.max(0,n.y)/c,u=Math.floor(w),m=Math.max(0,u-1),f=Math.round((w-m)*c),p=Math.round((w-
u)*c);this._topIndexY=p;w=this._rootDiv;var D=w.clientWidth,B=w.clientHeight;if(a){c=0;this._leftDiv&&(u=this._leftDiv.getBoundingClientRect(),c=u.right-u.left);u=this._getClientWidth();w=this._getClientHeight();v=u;this._wrapMode?this._metrics.wrapWidth&&(v=this._metrics.wrapWidth):v=Math.max(this._maxLineWidth,v);for(;z<g;)s=this._getLineHeight(z,!1),r+=s,z++;g=r}else{w=this._getClientHeight();p=Math.min(u+Math.floor((w+p)/c),g-1);var n=Math.min(p+1,g-1),E;for(s=b.firstChild;s;){E=s.lineIndex;var F=
s.nextSibling;if(!(m<=E&&E<=n)||s.lineRemoved||-1===s.lineIndex)this._mouseWheelLine===s?(s.style.display="none",s.lineIndex=-1):b.removeChild(s);s=F}s=this._getLineNext();var F=e.ownerDocument,H=F.createDocumentFragment();for(E=m;E<=n;E++)!s||s.lineIndex>E?(new x(this,E)).create(H,null):(H.firstChild&&(b.insertBefore(H,s),H=F.createDocumentFragment()),s&&s.lineChanged&&(s=(new x(this,E)).create(H,s),s.lineChanged=!1),s=this._getLineNext(s));H.firstChild&&b.insertBefore(H,s);h.isWebkit&&!this._wrapMode&&
(b.style.width="0x7fffffffpx");s=this._getLineNext();E=w+f;for(H=!1;s;)m=s.lineWidth,void 0===m&&(F=s._line.getBoundingClientRect(),m=s.lineWidth=Math.ceil(F.right-F.left),F=F.bottom-F.top,this._lineHeight?this._lineHeight[s.lineIndex]=F:0!==c&&(0!==F&&Math.ceil(c)!==Math.ceil(F))&&(this._variableLineHeight=!0,this._lineHeight=[],this._lineHeight[s.lineIndex]=F)),this._lineHeight&&!H&&(E-=this._lineHeight[s.lineIndex],0>E&&(p=s.lineIndex,H=!0)),this._wrapMode||(m>=this._maxLineWidth&&(this._maxLineWidth=
m,this._maxLineIndex=s.lineIndex),this._checkMaxLineIndex===s.lineIndex&&(this._checkMaxLineIndex=-1)),s.lineIndex===u&&(this._topChild=s),s.lineIndex===p&&(this._bottomChild=s),s=this._getLineNext(s);-1!==this._checkMaxLineIndex&&(E=this._checkMaxLineIndex,this._checkMaxLineIndex=-1,0<=E&&E<g&&(c=new x(this,E),F=c.getBoundingClientRect(),m=F.right-F.left,m>=this._maxLineWidth&&(this._maxLineWidth=m,this._maxLineIndex=E),c.destroy()));for(;z<g;)s=this._getLineHeight(z,z<=p),r+=s,z++;g=r;this._updateRuler(this._leftDiv,
u,n,B);this._updateRuler(this._rightDiv,u,n,B);this._updateRuler(this._innerRightDiv,u,n,B);this._updateRuler(this._marginDiv,u,n,B);c=0;this._leftDiv&&(u=this._leftDiv.getBoundingClientRect(),c=u.right-u.left);r=0;this._rightDiv&&(n=this._rightDiv.getBoundingClientRect(),r=n.right-n.left);e.style.left=c+"px";e.style.right=r+"px";n=this._scrollDiv;n.style.height=g+"px";u=this._getClientWidth();!this._singleMode&&(!this._wrapMode&&!this._noScroll)&&(z=t=w,(p="scroll"===e.style.overflowX)?t+=l:z-=l,
m=s=u,(E="scroll"===e.style.overflowY)?s+=l:m-=l,w=t,u=s,g>w&&(k=!0,u=m),this._maxLineWidth>u&&(v=!0,w=z,g>w&&(k=!0,u=m)),p!==v&&(e.style.overflowX=v?"scroll":"hidden"),E!==k&&(e.style.overflowY=k?"scroll":"hidden"),t=p!==v||E!==k);k=u;this._wrapMode?this._metrics.wrapWidth&&(k=this._metrics.wrapWidth):k=Math.max(this._maxLineWidth+this._getInnerRightWidth(),k);v=k;if((!h.isIE||9<=h.isIE)&&this._maxLineWidth>u)k+=d.right+d.left;n.style.width=k+"px";this._clipScrollDiv&&(this._clipScrollDiv.style.width=
k+"px");n=this._getScroll(!1);if(k=this._innerRightDiv)k.style.right=r+("scroll"===e.style.overflowY?this._metrics.scrollWidth:0)+"px",k.style.bottom=("scroll"===e.style.overflowX?l:0)+"px"}this._scrollHeight=g;this._vScrollDiv&&(k=w-8,r=Math.max(15,Math.ceil(Math.min(1,k/(g+d.top+d.bottom))*k)),this._vScrollDiv.style.left=c+u-8+"px",this._vScrollDiv.style.top=Math.floor(Math.max(0,n.y*k/g))+"px",this._vScrollDiv.style.height=r+"px");!this._wrapMode&&this._hScrollDiv&&(k=u-8,r=Math.max(15,Math.ceil(Math.min(1,
k/(this._maxLineWidth+d.left+d.right))*k)),this._hScrollDiv.style.left=c+Math.floor(Math.max(0,Math.floor(n.x*k/this._maxLineWidth)))+"px",this._hScrollDiv.style.top=w-9+"px",this._hScrollDiv.style.width=r+"px");z=n.x;r=this._clipDiv;k=this._overlayDiv;if(p=this._marginDiv)p.style.left=-z+c+this._metrics.marginWidth+d.left+"px",p.style.bottom=("scroll"===e.style.overflowX?l:0)+"px";r?(r.scrollLeft=z,r.scrollTop=0,e=c+d.left,l=d.top,a=u,c=w,z=0,p=-f,0===n.x&&(e-=d.left,a+=d.left,z=d.left),n.x+u===
v&&(a+=d.right),0===n.y&&(l-=d.top,c+=d.top,p+=d.top),n.y+w===g&&(c+=d.bottom),r.style.left=e+"px",r.style.top=l+"px",r.style.right=D-a-e+"px",r.style.bottom=B-c-l+"px",b.style.left=z+"px",b.style.top=p+"px",b.style.width=v+"px",b.style.height=w+f+"px",k&&(k.style.left=b.style.left,k.style.top=b.style.top,k.style.width=b.style.width,k.style.height=b.style.height)):(e=z,l=f,D=z+u,B=f+w,0===e&&(e-=d.left),0===l&&(l-=d.top),D===v&&(D+=d.right),n.y+w===g&&(B+=d.bottom),b.style.clip="rect("+l+"px,"+D+
"px,"+B+"px,"+e+"px)",b.style.left=-z+c+d.left+"px",b.style.width=(this._wrapMode||h.isWebkit?v:u+z)+"px",a||(b.style.top=-f+d.top+"px",b.style.height=w+f+"px"),k&&(k.style.clip=b.style.clip,k.style.left=b.style.left,k.style.width=b.style.width,a||(k.style.top=b.style.top,k.style.height=b.style.height)));this._updateDOMSelection();t&&(b=this._ensureCaretVisible,this._ensureCaretVisible=!1,b&&this._showCaret(),this._queueUpdate())}}},_updateOverflow:function(){var a=this._viewDiv;this._noScroll?a.style.overflow=
"hidden":this._wrapMode?(a.style.overflowX="hidden",a.style.overflowY="scroll"):a.style.overflow="hidden"},_updateRuler:function(a,b,e,f){if(a)for(var n=this._parent.ownerDocument,d=this._getLineHeight(),c=this._getViewPadding(),t=a.firstChild;t;){var v=t._ruler,k=v.getOverview();t.rulerChanged&&(g(v.getRulerStyle(),t),a.rulerWidth=void 0);if("fixed"!==k){var l=d;"page"===k&&(l+=this._topIndexY);t.style.top=-l+"px";t.style.height=f+l+"px";var u,m=t.firstChild;m?(u=m,m=m.nextSibling):(u=h.createElement(n,
"div"),u.style.visibility="hidden",t.appendChild(u));var x;if(t.rulerChanged&&u){l=-1;if(x=v.getWidestAnnotation())g(x.style,u),x.html&&(u.innerHTML=x.html);u.lineIndex=l;u.style.height=d+c.top+"px"}var p;if("page"===k){for(v=v.getAnnotations(b,e+1);m;)l=m.lineIndex,x=m.nextSibling,(!(b<=l&&l<=e)||m.lineChanged)&&t.removeChild(m),m=x;m=t.firstChild.nextSibling;p=n.createDocumentFragment();for(l=b;l<=e;l++)if(!m||m.lineIndex>l){u=h.createElement(n,"div");if(x=v[l])g(x.style,u),x.html&&(u.innerHTML=
x.html),u.annotation=x;u.lineIndex=l;u.style.height=this._getLineHeight(l)+"px";p.appendChild(u)}else p.firstChild&&(t.insertBefore(p,m),p=n.createDocumentFragment()),m&&(m=m.nextSibling);p.firstChild&&t.insertBefore(p,m)}else{x=this._getClientHeight();l=this._model.getLineCount();m=x+c.top+c.bottom-2*this._metrics.scrollWidth;k=d*l<m?d:m/l;if(t.rulerChanged){for(x=t.childNodes.length;1<x;)t.removeChild(t.lastChild),x--;v=v.getAnnotations(0,l);p=n.createDocumentFragment();for(var w in v)l=w>>>0,0>
l||(u=h.createElement(n,"div"),x=v[w],g(x.style,u),u.style.position="absolute",u.style.top=this._metrics.scrollWidth+d+Math.floor(l*k)+"px",x.html&&(u.innerHTML=x.html),u.annotation=x,u.lineIndex=l,p.appendChild(u));t.appendChild(p)}else if(t._oldTrackHeight!==m)for(u=t.firstChild?t.firstChild.nextSibling:null;u;)u.style.top=this._metrics.scrollWidth+d+Math.floor(u.lineIndex*k)+"px",u=u.nextSibling;t._oldTrackHeight=m}}t.rulerChanged=!1;t=t.nextSibling}},_updateStyleSheet:function(){var a="";h.isWebkit&&
0<this._metrics.scrollWidth&&(a+="\n.textview ::-webkit-scrollbar-corner {background: #eeeeee;}");h.isFirefox&&(h.isMac&&this._highlightRGB&&"Highlight"!==this._highlightRGB)&&(a+="\n.textview ::-moz-selection {background: "+this._highlightRGB+";}");if(a){var b=this._clientDiv.ownerDocument,e=b.getElementById("_textviewStyle");if(e)e.removeChild(e.firstChild),e.appendChild(b.createTextNode(a));else{e=h.createElement(b,"style");e.id="_textviewStyle";var f=b.getElementsByTagName("head")[0]||b.documentElement;
e.appendChild(b.createTextNode(a));f.insertBefore(e,f.firstChild)}}},_updateStyle:function(a){!a&&h.isIE&&(this._rootDiv.style.lineHeight="normal");var b=this._metrics=this._calculateMetrics();this._variableLineHeight&&(this._variableLineHeight=!1,this._resetLineHeight());this._rootDiv.style.lineHeight=h.isIE?b.lineHeight-(b.lineTrim.top+b.lineTrim.bottom)+"px":"normal";this._updateStyleSheet();if(h.isMac&&h.isWebkit){var e=this._viewDiv;!b.invalid&&0===b.scrollWidth?(e.style.pointerEvents="none",
e.style.zIndex="2"):(e.style.pointerEvents="",e.style.zIndex="")}a||(this.redraw(),this._resetLineWidth())}};m.EventTarget.addMixin(w.prototype);return{TextView:w}});
define("orion/editor/projectionTextModel",["orion/editor/textModel","orion/editor/eventTarget"],function(p,s){function r(m){this._model=m;this._projections=[];var c=this;this._listener={onChanged:function(k){c._onChanged(k)},onChanging:function(k){c._onChanging(k)}};m.addEventListener("postChanged",this._listener.onChanged);m.addEventListener("preChanging",this._listener.onChanging)}r.prototype={destroy:function(){this._model&&(this._model.removeEventListener("postChanged",this._listener.onChanged),
this._model.removeEventListener("preChanging",this._listener.onChanging),this._model=null)},addProjection:function(m){if(m){var c=this._model,k=this._projections;m._lineIndex=c.getLineAtOffset(m.start);m._lineCount=c.getLineAtOffset(m.end)-m._lineIndex;var h=m.text;h||(h="");m._model="string"===typeof h?new p.TextModel(h,c.getLineDelimiter()):h;var c=this.mapOffset(m.start,!0),h=m.end-m.start,l=m._lineCount,g=m._model.getCharCount(),d=m._model.getLineCount()-1,a={type:"Changing",text:m._model.getText(),
start:c,removedCharCount:h,addedCharCount:g,removedLineCount:l,addedLineCount:d};this.onChanging(a);a=this._binarySearch(k,m.start);k.splice(a,0,m);this.onChanged({type:"Changed",start:c,removedCharCount:h,addedCharCount:g,removedLineCount:l,addedLineCount:d})}},getProjections:function(){return this._projections.slice(0)},getBaseModel:function(){return this._model},mapOffset:function(m,c){var k=this._projections,h=0,l,g;if(c){for(l=0;l<k.length;l++){g=k[l];if(g.start>m)break;if(g.end>m)return-1;h+=
g._model.getCharCount()-(g.end-g.start)}return m+h}for(l=0;l<k.length;l++){g=k[l];if(g.start>m-h)break;var d=g._model.getCharCount();if(g.start+d>m-h)return-1;h+=d-(g.end-g.start)}return m-h},removeProjection:function(m){this._removeProjection(m)},_removeProjection:function(m,c){var k,h=0;for(k=0;k<this._projections.length;k++){var l=this._projections[k];if(l===m){m=l;break}h+=l._model.getCharCount()-(l.end-l.start)}if(k<this._projections.length){var l=this._model,h=m.start+h,g=m.end-m.start,d=m._lineCount,
a=m._model.getCharCount(),b=m._model.getLineCount()-1;c||(l={type:"Changing",text:l.getText(m.start,m.end),start:h,removedCharCount:a,addedCharCount:g,removedLineCount:b,addedLineCount:d},this.onChanging(l));this._projections.splice(k,1);if(!c)this.onChanged({type:"Changed",start:h,removedCharCount:a,addedCharCount:g,removedLineCount:b,addedLineCount:d})}},_binarySearch:function(m,c){for(var k=m.length,h=-1,l;1<k-h;)l=Math.floor((k+h)/2),c<=m[l].start?k=l:h=l;return k},getCharCount:function(){for(var m=
this._model.getCharCount(),c=this._projections,k=0;k<c.length;k++)var h=c[k],m=m+(h._model.getCharCount()-(h.end-h.start));return m},getLine:function(m,c){if(0>m)return null;var k=this._model,h=this._projections,l=0,g=[],d=0,a,b,f;for(a=0;a<h.length;a++){f=h[a];if(f._lineIndex>=m-l)break;b=f._model.getLineCount()-1;if(f._lineIndex+b>=m-l){d=m-(f._lineIndex+l);if(d<b)return f._model.getLine(d,c);g.push(f._model.getLine(b))}d=f.end;l+=b-f._lineCount}for(d=Math.max(d,k.getLineStart(m-l));a<h.length;a++){f=
h[a];if(f._lineIndex>m-l)break;g.push(k.getText(d,f.start));b=f._model.getLineCount()-1;if(f._lineIndex+b>m-l)return g.push(f._model.getLine(0,c)),g.join("");g.push(f._model.getText());d=f.end;l+=b-f._lineCount}h=k.getLineEnd(m-l,c);d<h&&g.push(k.getText(d,h));return g.join("")},getLineAtOffset:function(m){for(var c=this._model,k=this._projections,h=0,l=0,g=0;g<k.length;g++){var d=k[g];if(d.start>m-h)break;var a=d._model.getCharCount();if(d.start+a>m-h){k=m-(d.start+h);l+=d._model.getLineAtOffset(k);
h+=k;break}l+=d._model.getLineCount()-1-d._lineCount;h+=a-(d.end-d.start)}return c.getLineAtOffset(m-h)+l},getLineCount:function(){for(var m=this._projections,c=this._model.getLineCount(),k=0;k<m.length;k++)var h=m[k],c=c+(h._model.getLineCount()-1-h._lineCount);return c},getLineDelimiter:function(){return this._model.getLineDelimiter()},getLineEnd:function(m,c){if(0>m)return-1;for(var k=this._model,h=this._projections,l=0,g=0,d=0;d<h.length;d++){var a=h[d];if(a._lineIndex>m-l)break;var b=a._model.getLineCount()-
1;if(a._lineIndex+b>m-l)return a._model.getLineEnd(m-(a._lineIndex+l),c)+a.start+g;g+=a._model.getCharCount()-(a.end-a.start);l+=b-a._lineCount}return k.getLineEnd(m-l,c)+g},getLineStart:function(m){if(0>m)return-1;for(var c=this._model,k=this._projections,h=0,l=0,g=0;g<k.length;g++){var d=k[g];if(d._lineIndex>=m-h)break;var a=d._model.getLineCount()-1;if(d._lineIndex+a>=m-h)return d._model.getLineStart(m-(d._lineIndex+h))+d.start+l;l+=d._model.getCharCount()-(d.end-d.start);h+=a-d._lineCount}return c.getLineStart(m-
h)+l},getText:function(m,c){void 0===m&&(m=0);var k=this._model,h=this._projections,l=0,g=[],d,a,b;for(d=0;d<h.length;d++){a=h[d];if(a.start>m-l)break;b=a._model.getCharCount();if(a.start+b>m-l){if(void 0!==c&&a.start+b>c-l)return a._model.getText(m-(a.start+l),c-(a.start+l));g.push(a._model.getText(m-(a.start+l)));m=a.end+l+b-(a.end-a.start)}l+=b-(a.end-a.start)}var f=m-l;if(void 0!==c){for(;d<h.length;d++){a=h[d];if(a.start>c-l)break;g.push(k.getText(f,a.start));b=a._model.getCharCount();if(a.start+
b>c-l)return g.push(a._model.getText(0,c-(a.start+l))),g.join("");g.push(a._model.getText());f=a.end;l+=b-(a.end-a.start)}g.push(k.getText(f,c-l))}else{for(;d<h.length;d++)a=h[d],g.push(k.getText(f,a.start)),g.push(a._model.getText()),f=a.end;g.push(k.getText(f))}return g.join("")},_onChanged:function(m){m=this._change;var c=m.baseStart,k=m.baseEnd,h,l,g=this._projections;for(h=0;h<g.length&&!(l=g[h],l.end>c);h++);var d=h;for(h=0;h<g.length&&!(l=g[h],l.start>=k);h++);var a=h,b=this._model,c=m.baseText.length-
(k-c);for(h=a;h<g.length;h++)l=g[h],l.start+=c,l.end+=c,l._lineIndex=b.getLineAtOffset(l.start);l=g.splice(d,a-d);for(h=0;h<l.length;h++)l[h].annotation&&l[h].annotation._expand();this.onChanged({type:"Changed",start:m.start,removedCharCount:m.removedCharCount,addedCharCount:m.addedCharCount,removedLineCount:m.removedLineCount,addedLineCount:m.addedLineCount});this._change=void 0},_onChanging:function(m){var c=!!this._change,k=this._change||{},h=m.start,l=h+m.removedCharCount;k.baseStart=h;k.baseEnd=
l;k.baseText=m.text;k.addedLineCount=m.addedLineCount;if(!c){this._change=k;k.text=m.text;var g=this._projections,d,a,b;m=function(f){for(d=a=0;a<g.length;a++){b=g[a];if(b.start>f)break;if(b.end>f)return-1;d+=b._model.getCharCount()-(b.end-b.start)}return f+d};k.start=m(h);-1===k.start&&(k.text=this._model.getText(b.start,h)+k.text,k.addedLineCount+=this._model.getLineAtOffset(h)-this._model.getLineAtOffset(b.start),k.start=b.start+d);k.end=m(l);-1===k.end&&(k.text+=this._model.getText(l,b.end),k.addedLineCount+=
this._model.getLineAtOffset(b.end)-this._model.getLineAtOffset(l),k.end=b.start+d)}k.addedCharCount=k.text.length;k.removedCharCount=k.end-k.start;k.removedLineCount=this.getLineAtOffset(k.end)-this.getLineAtOffset(k.start);this.onChanging({type:"Changing",text:k.text,start:k.start,removedCharCount:k.removedCharCount,addedCharCount:k.addedCharCount,removedLineCount:k.removedLineCount,addedLineCount:k.addedLineCount})},onChanging:function(m){return this.dispatchEvent(m)},onChanged:function(m){return this.dispatchEvent(m)},
setLineDelimiter:function(m){this._model.setLineDelimiter(m)},setText:function(m,c,k){function h(b){for(g=d=0;d<l.length;d++){a=l[d];if(a.start>b-g)break;var f=a._model.getCharCount();if(a.start+f>b-g)return-1;g+=f-(a.end-a.start)}return b-g}this._change={text:m||"",start:c||0,end:void 0===k?this.getCharCount():k};var l=this._projections,g,d,a,b,f;m=h(this._change.start);-1===m&&(b={projection:a,start:this._change.start-(a.start+g)},m=a.end);c=h(this._change.end);-1===c&&(f={projection:a,end:this._change.end-
(a.start+g)},c=a.start);b&&f&&b.projection===f.projection?a._model.setText(this._change.text,b.start,f.end):(this._model.setText(this._change.text,m,c),b&&(a=b.projection,a._model.setText("",b.start)),f&&(a=f.projection,a._model.setText("",0,f.end),a.start=a.end,a._lineCount=0));this._change=void 0}};s.EventTarget.addMixin(r.prototype);return{ProjectionTextModel:r}});
define("orion/editor/annotations",["i18n!orion/editor/nls/messages","orion/editor/eventTarget"],function(p,s){function r(){}function m(a,b,f){this.start=a;this.end=b;this._projectionModel=f;this.html=this._expandedHTML;this.style=this._expandedStyle;this.expanded=!0}function c(a,b){var f=a.lastIndexOf("."),f=a.substring(f+1),n={title:p[f],style:{styleClass:"annotation "+f},html:"\x3cdiv class\x3d'annotationHTML "+f+"'\x3e\x3c/div\x3e",overviewStyle:{styleClass:"annotationOverview "+f}};b?n.lineStyle=
{styleClass:"annotationLine "+f}:n.rangeStyle={styleClass:"annotationRange "+f};r.registerType(a,n)}function k(){}function h(a,b,f,n,d){var e;void 0===n&&(n=-1);void 0===d&&(d=a.length);for(;1<d-n;)if(e=Math.floor((d+n)/2),b<=a[e].start)d=e;else if(f&&b<a[e].end){d=e;break}else n=e;return d}function l(a){this._annotations=[];var b=this;this._listener={onChanged:function(a){b._onChanged(a)}};this.setTextModel(a)}function g(a,b){this._view=a;this._annotationModel=b;var f=this;this._listener={onDestroy:function(a){f._onDestroy(a)},
onLineStyle:function(a){f._onLineStyle(a)},onChanged:function(a){f._onAnnotationModelChanged(a)}};a.addEventListener("Destroy",this._listener.onDestroy);a.addEventListener("postLineStyle",this._listener.onLineStyle);b.addEventListener("Changed",this._listener.onChanged)}m.prototype={_expandedHTML:"\x3cdiv class\x3d'annotationHTML expanded'\x3e\x3c/div\x3e",_expandedStyle:{styleClass:"annotation expanded"},_collapsedHTML:"\x3cdiv class\x3d'annotationHTML collapsed'\x3e\x3c/div\x3e",_collapsedStyle:{styleClass:"annotation collapsed"},
_collapse:function(){if(!this.expanded)return!1;this.expanded=!1;this.html=this._collapsedHTML;this.style=this._collapsedStyle;this._annotationModel&&this._annotationModel.modifyAnnotation(this);return!0},_expand:function(){if(this.expanded)return!1;this.expanded=!0;this.html=this._expandedHTML;this.style=this._expandedStyle;this._annotationModel&&this._annotationModel.modifyAnnotation(this);return!0},_collapseImpl:function(a){if(this._collapse()){a&&this._forEachOverlaping(function(a){a.expanded||
(a._expandImpl(!1),a._recollapse=!0)});a=this._projectionModel;var b=a.getBaseModel();this._projection={annotation:this,start:b.getLineStart(b.getLineAtOffset(this.start)+1),end:b.getLineEnd(b.getLineAtOffset(this.end),!0)};a.addProjection(this._projection)}},_expandImpl:function(a){this._expand()&&(this._projectionModel._removeProjection(this._projection,!this._annotationModel),a&&this._forEachOverlaping(function(a){a._recollapse&&(a._collapseImpl(!1),a._recollapse=!1)}))},_forEachOverlaping:function(a){if(this._annotationModel)for(var b=
this._annotationModel.getAnnotations(this.start,this.end);b.hasNext();){var f=b.next();f!==this&&f.type===r.ANNOTATION_FOLDING&&a.call(this,f)}},collapse:function(){this._recollapse=!1;this._collapseImpl(!0)},expand:function(){this._recollapse=!1;this._expandImpl(!0)}};r.ANNOTATION_ERROR="orion.annotation.error";r.ANNOTATION_WARNING="orion.annotation.warning";r.ANNOTATION_TASK="orion.annotation.task";r.ANNOTATION_BREAKPOINT="orion.annotation.breakpoint";r.ANNOTATION_BOOKMARK="orion.annotation.bookmark";
r.ANNOTATION_FOLDING="orion.annotation.folding";r.ANNOTATION_CURRENT_BRACKET="orion.annotation.currentBracket";r.ANNOTATION_MATCHING_BRACKET="orion.annotation.matchingBracket";r.ANNOTATION_CURRENT_LINE="orion.annotation.currentLine";r.ANNOTATION_CURRENT_SEARCH="orion.annotation.currentSearch";r.ANNOTATION_MATCHING_SEARCH="orion.annotation.matchingSearch";r.ANNOTATION_READ_OCCURRENCE="orion.annotation.readOccurrence";r.ANNOTATION_WRITE_OCCURRENCE="orion.annotation.writeOccurrence";r.ANNOTATION_SELECTED_LINKED_GROUP=
"orion.annotation.selectedLinkedGroup";r.ANNOTATION_CURRENT_LINKED_GROUP="orion.annotation.currentLinkedGroup";r.ANNOTATION_LINKED_GROUP="orion.annotation.linkedGroup";r.ANNOTATION_BLAME="orion.annotation.blame";r.ANNOTATION_CURRENT_BLAME="orion.annotation.currentBlame";var d={};r.registerType=function(a,b){var f=b;"function"!==typeof f&&(f=function(a,b,e){this.start=a;this.end=b;void 0!==e&&(this.title=e)},f.prototype=b);f.prototype.type=a;d[a]=f;return a};r.createAnnotation=function(a,b,f,n){return new (this.getType(a))(b,
f,n)};r.getType=function(a){return d[a]};c(r.ANNOTATION_ERROR);c(r.ANNOTATION_WARNING);c(r.ANNOTATION_TASK);c(r.ANNOTATION_BREAKPOINT);c(r.ANNOTATION_BOOKMARK);c(r.ANNOTATION_CURRENT_BRACKET);c(r.ANNOTATION_MATCHING_BRACKET);c(r.ANNOTATION_CURRENT_SEARCH);c(r.ANNOTATION_MATCHING_SEARCH);c(r.ANNOTATION_READ_OCCURRENCE);c(r.ANNOTATION_WRITE_OCCURRENCE);c(r.ANNOTATION_SELECTED_LINKED_GROUP);c(r.ANNOTATION_CURRENT_LINKED_GROUP);c(r.ANNOTATION_LINKED_GROUP);c(r.ANNOTATION_CURRENT_LINE,!0);c(r.ANNOTATION_BLAME,
!0);c(r.ANNOTATION_CURRENT_BLAME,!0);r.registerType(r.ANNOTATION_FOLDING,m);k.addMixin=function(a){var b=k.prototype,f;for(f in b)b.hasOwnProperty(f)&&(a[f]=b[f])};k.prototype={addAnnotationType:function(a,b){this._annotationTypes||(this._annotationTypes=[]);var f=b-1;void 0==b||!(0<=f&&f<this._annotationTypes.length)?this._annotationTypes.push(a):this._annotationTypes.splice(f,0,a)},getAnnotationTypePriority:function(a){if(this._annotationTypes)for(var b=0;b<this._annotationTypes.length;b++)if(this._annotationTypes[b]===
a)return b+1;return 0},getAnnotationsByType:function(a,b,f){a=a.getAnnotations(b,f);for(f=[];a.hasNext();)b=a.next(),0!==this.getAnnotationTypePriority(b.type)&&f.push(b);var n=this;f.sort(function(a,b){return n.getAnnotationTypePriority(a.type)-n.getAnnotationTypePriority(b.type)});return f},isAnnotationTypeVisible:function(a){return 0!==this.getAnnotationTypePriority(a)},removeAnnotationType:function(a){if(this._annotationTypes)for(var b=0;b<this._annotationTypes.length;b++)if(this._annotationTypes[b]===
a){this._annotationTypes.splice(b,1);break}}};l.prototype={addAnnotation:function(a){if(a){var b=this._annotations,f=h(b,a.start);b.splice(f,0,a);a._annotationModel=this;this.onChanged({type:"Changed",added:[a],removed:[],changed:[]})}},getTextModel:function(){return this._model},getAnnotations:function(a,b){var f=this._annotations,n,d=0,e;e=void 0===a&&void 0===b?function(){return d<f.length?f[d++]:null}:function(){for(;d<f.length;){var e=f[d++];if(a===e.start||(a>e.start?a<e.end:e.start<b))return e;
if(e.start>=b)break}return null};n=e();return{next:function(){var a=n;a&&(n=e());return a},hasNext:function(){return null!==n}}},modifyAnnotation:function(a){if(a&&!(0>this._getAnnotationIndex(a)))this.onChanged({type:"Changed",added:[],removed:[],changed:[a]})},onChanged:function(a){return this.dispatchEvent(a)},removeAnnotations:function(a){var b=this._annotations,f,n;if(a){f=[];for(n=b.length-1;0<=n;n--){var d=b[n];d.type===a&&(b.splice(n,1),f.splice(0,0,d),d._annotationModel=null)}}else f=b;this.onChanged({type:"Changed",
removed:f,added:[],changed:[]})},removeAnnotation:function(a){if(a){var b=this._getAnnotationIndex(a);0>b||(a._annotationModel=null,a={type:"Changed",removed:this._annotations.splice(b,1),added:[],changed:[]},this.onChanged(a))}},replaceAnnotations:function(a,b){var f=this._annotations,n,d,e,g=[];if(a)for(n=a.length-1;0<=n;n--)e=a[n],d=this._getAnnotationIndex(e),0>d||(e._annotationModel=null,f.splice(d,1),g.splice(0,0,e));b||(b=[]);for(n=0;n<b.length;n++)e=b[n],d=h(f,e.start),e._annotationModel=
this,f.splice(d,0,e);this.onChanged({type:"Changed",removed:g,added:b,changed:[]})},setTextModel:function(a){this._model&&this._model.removeEventListener("Changed",this._listener.onChanged);(this._model=a)&&this._model.addEventListener("Changed",this._listener.onChanged)},_getAnnotationIndex:function(a){for(var b=this._annotations,f=h(b,a.start);f<b.length&&b[f].start===a.start;){if(b[f]===a)return f;f++}return-1},_onChanged:function(a){var b=a.start,f=a.addedCharCount,d=a.removedCharCount,g=this._annotations,
e=b+d;if(0<g.length){a={type:"Changed",added:[],removed:[],changed:[],textModelChangedEvent:a};f-=d;for(d=0;d<g.length;d++){var c=g[d];c.start>=e?(c._oldStart=c.start,c._oldEnd=c.end,c.start+=f,c.end+=f,a.changed.push(c)):c.end<=b||(c.start<b&&e<c.end?(c._oldStart=c.start,c._oldEnd=c.end,c.end+=f,a.changed.push(c)):(g.splice(d,1),a.removed.push(c),c._annotationModel=null,c.expand&&c.expand(),d--))}if(0<a.added.length||0<a.removed.length||0<a.changed.length)this.onChanged(a)}}};s.EventTarget.addMixin(l.prototype);
g.prototype={destroy:function(){var a=this._view;a&&(a.removeEventListener("Destroy",this._listener.onDestroy),a.removeEventListener("LineStyle",this._listener.onLineStyle),this.view=null);(a=this._annotationModel)&&a.removeEventListener("Changed",this._listener.onChanged)},_mergeStyle:function(a,b){if(b){a||(a={});a.styleClass=a.styleClass&&b.styleClass&&a.styleClass!==b.styleClass?a.styleClass+(" "+b.styleClass):b.styleClass;var f;b.tagName&&!a.tagName&&(a.tagName=b.tagName);if(b.style)for(f in a.style||
(a.style={}),b.style)a.style[f]||(a.style[f]=b.style[f]);if(b.attributes)for(f in a.attributes||(a.attributes={}),b.attributes)a.attributes[f]||(a.attributes[f]=b.attributes[f])}return a},_mergeStyleRanges:function(a,b){a||(a=[]);for(var f,d=h(a,b.start,!0);d<a.length&&b;d++){var g=a[d];if(b.end<=g.start)break;if(!(b.start>=g.end)){f=this._mergeStyle({},g.style);f=this._mergeStyle(f,b.style);var e=[];e.push(d,1);b.start<g.start&&e.push({start:b.start,end:g.start,style:b.style});b.start>g.start&&e.push({start:g.start,
end:b.start,style:g.style});e.push({start:Math.max(g.start,b.start),end:Math.min(g.end,b.end),style:f});b.end<g.end&&e.push({start:b.end,end:g.end,style:g.style});b=b.end>g.end?{start:g.end,end:b.end,style:b.style}:null;Array.prototype.splice.apply(a,e)}}b&&(f=this._mergeStyle({},b.style),a.splice(d,0,{start:b.start,end:b.end,style:f}));return a},_onAnnotationModelChanged:function(a){function b(a,b){e.getBaseModel&&(a=e.mapOffset(a,!0),b=e.mapOffset(b,!0));-1!==a&&-1!==b&&d.redrawRange(a,b)}function f(a,
e){for(var f=0;f<a.length;f++)if(g.isAnnotationTypeVisible(a[f].type)){var d=a[f];b(d.start,d.end);e&&(void 0!==d._oldStart&&d._oldEnd)&&b(d._oldStart,d._oldEnd)}}var d=this._view;if(d){var g=this,e=d.getModel();f(a.added);f(a.removed);f(a.changed,!0)}},_onDestroy:function(a){this.destroy()},_onLineStyle:function(a){var b=this._annotationModel,f=a.textView.getModel(),d=b.getTextModel(),g=a.lineStart,e=a.lineStart+a.lineText.length;d!==f&&(g=f.mapOffset(g),e=f.mapOffset(e));for(b=b.getAnnotations(g,
e);b.hasNext();)if(g=b.next(),this.isAnnotationTypeVisible(g.type)){if(g.rangeStyle){var e=g.start,c=g.end;d!==f&&(e=f.mapOffset(e,!0),c=f.mapOffset(c,!0));a.ranges=this._mergeStyleRanges(a.ranges,{start:e,end:c,style:g.rangeStyle})}g.lineStyle&&(a.style=this._mergeStyle({},a.style),a.style=this._mergeStyle(a.style,g.lineStyle))}}};k.addMixin(g.prototype);return{FoldingAnnotation:m,AnnotationType:r,AnnotationTypeList:k,AnnotationModel:l,AnnotationStyler:g}});
define("orion/editor/tooltip",["i18n!orion/editor/nls/messages","orion/editor/textView","orion/editor/projectionTextModel","orion/editor/util","orion/util"],function(p,s,r,m,c){function k(c){this._view=c;this._fadeDelay=500;this._hideDelay=200;this._showDelay=500;this._autoHideDelay=5E3;this._create(c.getOptions("parent").ownerDocument)}k.getTooltip=function(c){c._tooltip||(c._tooltip=new k(c));return c._tooltip};k.prototype={_create:function(h){if(!this._tooltipDiv){var k=this._tooltipDiv=c.createElement(h,
"div");k.tabIndex=0;k.className="textviewTooltip";k.setAttribute("aria-live","assertive");k.setAttribute("aria-atomic","true");var g=this._tooltipContents=c.createElement(h,"div");k.appendChild(g);h.body.appendChild(k);var d=this;m.addEventListener(k,"mouseover",function(a){d._hideDelay&&(a=d._getWindow(),d._delayedHideTimeout&&(a.clearTimeout(d._delayedHideTimeout),d._delayedHideTimeout=null),d._hideTimeout&&(a.clearTimeout(d._hideTimeout),d._hideTimeout=null),d._nextTarget=null)},!1);m.addEventListener(k,
"mouseout",function(a){a=a.relatedTarget||a.toElement;!(a===k||d._hasFocus())&&(!a||!m.contains(k,a))&&d._hide()},!1);m.addEventListener(k,"keydown",function(a){27===a.keyCode&&d._hide()},!1);m.addEventListener(h,"mousedown",this._mouseDownHandler=function(a){d.isVisible()&&(m.contains(k,a.target||a.srcElement)||d._hide())},!0);this._view.addEventListener("Destroy",function(){d.destroy()});this._hide()}},_getWindow:function(){var c=this._tooltipDiv.ownerDocument;return c.defaultView||c.parentWindow},
destroy:function(){if(this._tooltipDiv){this._hide();var c=this._tooltipDiv.parentNode;c&&c.removeChild(this._tooltipDiv);m.removeEventListener(this._tooltipDiv.ownerDocument,"mousedown",this._mouseDownHandler,!0);this._tooltipDiv=null}},_hasFocus:function(){var c=this._tooltipDiv;return!c?!1:m.contains(c,c.ownerDocument.activeElement)},hide:function(c){void 0===c&&(c=this._hideDelay);var k=this._getWindow();this._delayedHideTimeout&&(k.clearTimeout(this._delayedHideTimeout),this._delayedHideTimeout=
null);var g=this;c?g._delayedHideTimeout=k.setTimeout(function(){g._delayedHideTimeout=null;g._hide();g.setTarget(g._nextTarget,0)},c):(g._hide(),g.setTarget(g._nextTarget,0))},_hide:function(){var c=this._tooltipDiv;c&&(this._hasFocus()&&this._view.focus(),this._contentsView&&(this._contentsView.destroy(),this._contentsView=null),this._tooltipContents&&(this._tooltipContents.innerHTML=""),c.style.visibility="hidden",c=this._getWindow(),this._showTimeout&&(c.clearTimeout(this._showTimeout),this._showTimeout=
null),this._delayedHideTimeout&&(c.clearTimeout(this._delayedHideTimeout),this._delayedHideTimeout=null),this._hideTimeout&&(c.clearTimeout(this._hideTimeout),this._hideTimeout=null),this._fadeTimeout&&(c.clearInterval(this._fadeTimeout),this._fadeTimeout=null))},isVisible:function(){return this._tooltipDiv&&"visible"===this._tooltipDiv.style.visibility},setTarget:function(c,k,g){if(this.isVisible())this._hasFocus()||(this._nextTarget=c,this.hide(g));else if(this._target=c){var d=this;c=d._getWindow();
d._showTimeout&&(c.clearTimeout(d._showTimeout),d._showTimeout=null);0===k?d.show(!0):d._showTimeout=c.setTimeout(function(){d._showTimeout=null;d.show(!0)},k?k:d._showDelay)}},show:function(c){if(this._target){var k=this._target.getTooltipInfo();if(k){var g=this._tooltipDiv,d=this._tooltipContents;g.style.left=g.style.right=g.style.width=g.style.height=d.style.width=d.style.height="auto";var a=g.ownerDocument,b=a.documentElement,f=k.contents;f instanceof Array&&(f=this._getAnnotationContents(f));
if("string"===typeof f)d.innerHTML=f;else if(this._isNode(f))d.appendChild(f);else if(f instanceof r.ProjectionTextModel){var n=this._view,t=n.getOptions();t.wrapMode=!1;t.parent=d;var e=t.themeClass;e?((e=e.replace("tooltipTheme",""))&&(e=" "+e),e="tooltipTheme"+e):e="tooltipTheme";t.themeClass=e;t=this._contentsView=new s.TextView(t);t.addEventListener("LineStyle",function(a){n.onLineStyle(a)});t.setModel(f);e=t.computeSize();d.style.width=e.width+"px";d.style.height=e.height+"px";t.resize()}else if(!k.deferredInfo)return;
if(t=k.deferredInfo){var v=this;t.forEach(function(b){b.promise.then(function(e){e&&(e.content&&v._renderContent(a,d,e,b),g.style.visibility="visible")},function(a){console.error("Problem computing hover tooltip",a)})})}"right"===k.anchor?(t=b.clientWidth-k.x,g.style.right=t+"px"):(t=parseInt(this._getNodeStyle(g,"padding-left","0"),10),t+=parseInt(this._getNodeStyle(g,"border-left-width","0"),10),t=k.x-t,g.style.left=t+"px");g.style.maxWidth=b.clientWidth-t-10+"px";t=parseInt(this._getNodeStyle(g,
"padding-top","0"),10);t+=parseInt(this._getNodeStyle(g,"border-top-width","0"),10);t=k.y-t;g.style.top=t+"px";g.style.maxHeight=b.clientHeight-t-10+"px";g.style.opacity="1";f&&(g.style.visibility="visible");if(c){var v=this,u=this._getWindow();v._hideTimeout=u.setTimeout(function(){v._hideTimeout=null;var a=parseFloat(v._getNodeStyle(g,"opacity","1"));v._fadeTimeout=u.setInterval(function(){"visible"===g.style.visibility&&0<a?(a-=0.1,g.style.opacity=a):v._hide()},v._fadeDelay/10)},v._autoHideDelay)}}}},
_renderContent:function(h,k,g,d){var a=null,b=null;g.title&&(a=c.createElement(h,"div"),a.innerHTML=d.renderMarkDown(g.title),k.appendChild(a));switch(g.type){case "markdown":g.content&&(b=c.createElement(h,"div"),b.innerHTML=d.renderMarkDown(g.content),a.appendChild(b));break;case "proposal":var f=g.content,a=c.createElement(h,"button");a.textContent=f.label;k.appendChild(a);var n=this;a.addEventListener("click",function(){n._view.setText(f.text,f.start,f.end);n._hide()});break;default:g.title&&
(a=c.createElement(h,"div"),a.textContent=g.title),g.content&&(k.appendChild(a),b=c.createElement(h,"div"),b.appendChild(h.createTextNode(g.content)),a.appendChild(b))}},_getAnnotationContents:function(h){function k(a,b){var e=v.getLineStart(v.getLineAtOffset(a)),f=v.getLineEnd(v.getLineAtOffset(b),!0);return v.getText(e,f)}function g(a){var b=a.title,d=c.createElement(n,"div");d.className="tooltipRow";a.html&&(d.innerHTML=a.html,d.lastChild&&m.addEventListener(d.lastChild,"click",function(b){b=a.start;
var d=a.end;e.getBaseModel&&(b=e.mapOffset(b,!0),d=e.mapOffset(d,!0));t.setSelection(b,d,1/3,function(){f._hide()})},!1),d.appendChild(n.createTextNode("\u00a0")));b||(b=k(a.start,a.end));"function"===typeof b&&(b=a.title());if("string"===typeof b){var g=c.createElement(n,"span");g.appendChild(n.createTextNode(b));b=g}d.appendChild(b);return d}for(var d,a=[],b=0;b<h.length;b++)d=h[b],""!==d.title&&!d.groupAnnotation&&a.push(d);h=a;if(0===h.length)return null;var f=this,n=this._tooltipDiv.ownerDocument,
t=this._view,e=t.getModel(),v=e.getBaseModel?e.getBaseModel():e;if(1===h.length){d=h[0];if(void 0!==d.title)return d=g(d),d.firstChild&&((h=d.firstChild.className)&&(h+=" "),d.firstChild.className=h+"single"),d;h=new r.ProjectionTextModel(v);a=v.getLineStart(v.getLineAtOffset(d.start));b=v.getCharCount();d.end!==b&&h.addProjection({start:d.end,end:b});0<a&&h.addProjection({start:0,end:a});return h}a=c.createElement(n,"div");d=c.createElement(n,"em");d.appendChild(n.createTextNode(p.multipleAnnotations));
a.appendChild(d);for(b=0;b<h.length;b++)d=h[b],(d=g(d))&&a.appendChild(d);return a},_getNodeStyle:function(c,k,g){return m.getNodeStyle(c,k,g)},_isNode:function(c){return"object"===typeof Node?c instanceof Node:c&&"object"===typeof c&&"number"===typeof c.nodeType&&"string"===typeof c.nodeName}};return{Tooltip:k}});
define("orion/objects",[],function(){function p(p){for(var r=Object.prototype.hasOwnProperty,m=1,c=arguments.length;m<c;m++){var k=arguments[m],h;for(h in k)r.call(k,h)&&(p[h]=k[h])}return p}return{clone:function(s){if(Array.isArray(s))return Array.prototype.slice.call(s);var r=Object.create(Object.getPrototypeOf(s));p(r,s);return r},mixin:p,toArray:function(p){return Array.isArray(p)?p:[p]}}});
define("orion/editor/rulers","i18n!orion/editor/nls/messages orion/editor/textView orion/editor/annotations orion/editor/tooltip orion/objects orion/editor/util orion/util".split(" "),function(p,s,r,m,c,k,h){function l(a,b,e){this._location=a||"left";this._overview=b||"page";this._rulerStyle=e;this._view=null}function g(a,b,e,f){l.call(this,b,e,f);var d=this;this._listener={onTextModelChanged:function(a){d._onTextModelChanged(a)},onAnnotationModelChanged:function(a){d._onAnnotationModelChanged(a)}};
this.setAnnotationModel(a)}function d(a,b,e,f,d){g.call(this,a,b,"page",e);this._oddStyle=f||{style:{backgroundColor:"white"}};this._evenStyle=d||{style:{backgroundColor:"white"}};this._numOfDigits=0;this._firstLine=1}function a(a,b,e){g.call(this,a,b,"page",e)}function b(a,b,e){g.call(this,a,b,"document",e)}function f(b,f,e){a.call(this,b,f,e)}l.prototype={getLocation:function(){return this._location},getOverview:function(){return this._overview},getRulerStyle:function(){return this._rulerStyle},
getView:function(){return this._view},setView:function(a){this._onTextModelChanged&&this._view&&this._view.removeEventListener("ModelChanged",this._listener.onTextModelChanged);this._view=a;this._onTextModelChanged&&this._view&&this._view.addEventListener("ModelChanged",this._listener.onTextModelChanged)}};g.prototype=c.mixin(new l,{getAnnotations:function(a,b){var e=this._annotationModel;if(!e)return[];var f=this._view.getModel(),d=f.getLineStart(a),g=f.getLineEnd(b-1),c=f;f.getBaseModel&&(c=f.getBaseModel(),
d=f.mapOffset(d),g=f.mapOffset(g));for(var h=[],e=this.getAnnotationsByType(e,d,g),d=0;d<e.length;d++)for(var g=e[d],k=c.getLineAtOffset(g.start),l=c.getLineAtOffset(Math.max(g.start,g.end-1)),m=k;m<=l;m++){var p=m;if(f!==c){p=c.getLineStart(m);p=f.mapOffset(p,!0);if(-1===p)continue;p=f.getLineAtOffset(p)}if(a<=p&&p<b){var r=this._mergeAnnotation(h[p],g,m-k,l-k+1);r&&(h[p]=r)}}if(!this._multiAnnotation&&this._multiAnnotationOverlay)for(var s in h)h[s]._multiple&&(h[s].html+=this._multiAnnotationOverlay.html);
return h},getAnnotationModel:function(){return this._annotationModel},getWidestAnnotation:function(){return null},setAnnotationModel:function(a){this._annotationModel&&this._annotationModel.removEventListener("Changed",this._listener.onAnnotationModelChanged);(this._annotationModel=a)&&this._annotationModel.addEventListener("Changed",this._listener.onAnnotationModelChanged)},setMultiAnnotation:function(a){this._multiAnnotation=a},setMultiAnnotationOverlay:function(a){this._multiAnnotationOverlay=
a},onClick:function(a,b){if(void 0!==a){var e=this._view,f=e.getModel(),d=f,g=f.getLineStart(a),c=g,h=g,k=this._annotationModel;if(k){e=e.getSelection();h=f.getLineEnd(a,!0);g<=e.start&&e.start<h&&(g=e.start);f.getBaseModel&&(g=f.mapOffset(g),h=f.mapOffset(h),d=f.getBaseModel());for(var l,h=k.getAnnotations(g,h),k=null;!l&&h.hasNext();)e=h.next(),this.isAnnotationTypeVisible(e.type)&&(k=e,e.start<=g||(l=e));k&&void 0!==k.groupId&&(this._currentClickGroup=this._currentClickGroup===k.groupId?null:k.groupId,
this._setCurrentGroup(a));l&&d.getLineAtOffset(l.start)===d.getLineAtOffset(g)?(g=l.start,h=l.end):h=g=c;f.getBaseModel&&(g=f.mapOffset(g,!0),h=f.mapOffset(h,!0))}(f=m.Tooltip.getTooltip(this._view))&&f.setTarget(null);this._view.setSelection(h,g,1/3,function(){})}},onDblClick:function(a,b){},onMouseMove:function(a,b){var e=m.Tooltip.getTooltip(this._view);if(e&&!(e.isVisible()&&this._tooltipLineIndex===a)){this._tooltipLineIndex=a;var f=this;e.setTarget({y:b.clientY,getTooltipInfo:function(){return f._getTooltipInfo(f._tooltipLineIndex,
this.y)}})}},onMouseOver:function(a,b){this.onMouseMove(a,b);this._currentClickGroup||this._setCurrentGroup(a)},onMouseOut:function(a,b){this._currentClickGroup||this._setCurrentGroup(-1);var e=m.Tooltip.getTooltip(this._view);e&&e.setTarget(null)},_getTooltipInfo:function(a,b){if(void 0!==a){var e=this._view,f=e.getModel(),d=this._annotationModel,g=[];if(d){var g=f.getLineStart(a),c=f.getLineEnd(a);f.getBaseModel&&(g=f.mapOffset(g),c=f.mapOffset(c));g=this.getAnnotationsByType(d,g,c)}d=this._getTooltipContents(a,
g);if(!d)return null;d={contents:d,anchor:this.getLocation()};g=e.getClientArea();"document"===this.getOverview()?g.y=e.convert({y:b},"view","document").y:g.y=e.getLocationAtOffset(f.getLineStart(a)).y;e.convert(g,"document","page");d.x=g.x;d.y=g.y;"right"===d.anchor&&(d.x+=g.width);return d}},_getTooltipContents:function(a,b){return b},_onAnnotationModelChanged:function(a){function b(a){for(var n=0;n<a.length;n++)if(d.isAnnotationTypeVisible(a[n].type)){var g=a[n].start,c=a[n].end;f.getBaseModel&&
(g=f.mapOffset(g,!0),c=f.mapOffset(c,!0));-1!==g&&-1!==c&&e.redrawLines(f.getLineAtOffset(g),f.getLineAtOffset(Math.max(g,c-1))+1,d)}}var e=this._view;if(e){var f=e.getModel(),d=this,g=f.getLineCount();a.textModelChangedEvent?(a=a.textModelChangedEvent.start,f.getBaseModel&&(a=f.mapOffset(a,!0)),a=f.getLineAtOffset(a),e.redrawLines(a,g,d)):(b(a.added),b(a.removed),b(a.changed))}},_mergeAnnotation:function(a,b,e,f){a||(a={});0===e&&(a.html&&b.html?(b.html!==a.html&&(!a._multiple&&this._multiAnnotation)&&
(a.html=this._multiAnnotation.html),a._multiple=!0):a.html=b.html);a.style=this._mergeStyle(a.style,b.style);return a},_mergeStyle:function(a,b){if(b){a||(a={});a.styleClass=a.styleClass&&b.styleClass&&a.styleClass!==b.styleClass?a.styleClass+(" "+b.styleClass):b.styleClass;var e;if(b.style)for(e in a.style||(a.style={}),b.style)void 0===a.style[e]&&(a.style[e]=b.style[e]);if(b.attributes)for(e in a.attributes||(a.attributes={}),b.attributes)void 0===a.attributes[e]&&(a.attributes[e]=b.attributes[e])}return a},
_setCurrentGroup:function(a){var b=this._annotationModel,e=null,f=b.getTextModel(),d,g=this._currentGroupAnnotation;if(-1!==a){var c=f.getLineStart(a),h=f.getLineEnd(a);f.getBaseModel&&(c=f.mapOffset(c),h=f.mapOffset(h));for(d=b.getAnnotations(c,h);d.hasNext();)if(f=d.next(),this.isAnnotationTypeVisible(f.type)&&f.start<=c&&f.end>=h&&void 0!==f.groupId){e=f;break}if(g&&e&&g.groupId===e.groupId)return}this._currentGroupAnnotation=null;g&&b.removeAnnotations(g.groupType);if(e&&-1!==a){this._currentGroupAnnotation=
e;d=b.getAnnotations();for(a=[];d.hasNext();)f=d.next(),delete f.groupAnnotation,f.groupId===e.groupId&&(f=f.createGroupAnnotation(),a.push(f));b.replaceAnnotations(null,a)}}});r.AnnotationTypeList.addMixin(g.prototype);d.prototype=new g;d.prototype.getAnnotations=function(a,b){for(var e=g.prototype.getAnnotations.call(this,a,b),f=this._view.getModel(),d=a;d<b;d++){var c=d-this._firstLine&1?this._oddStyle:this._evenStyle,h=d;f.getBaseModel&&(h=f.getLineStart(h),h=f.getBaseModel().getLineAtOffset(f.mapOffset(h)));
e[d]||(e[d]={});e[d].html=this._firstLine+h+"";e[d].style||(e[d].style=c)}return e};d.prototype.getWidestAnnotation=function(){var a=this._view.getModel().getLineCount();return this.getAnnotations(a-1,a)[a-1]};d.prototype.setFirstLine=function(a){this._firstLine=void 0!==a?a:1};d.prototype._onTextModelChanged=function(a){var b=a.start;a=this._view.getModel();var e=a.getBaseModel?a.getBaseModel().getLineCount():a.getLineCount(),e=(this._firstLine+e-1+"").length;this._numOfDigits!==e&&(this._numOfDigits=
e,b=a.getLineAtOffset(b),this._view.redrawLines(b,a.getLineCount(),this))};a.prototype=new g;b.prototype=new g;b.prototype.getRulerStyle=function(){var a={style:{lineHeight:"1px",fontSize:"1px"}};return a=this._mergeStyle(a,this._rulerStyle)};b.prototype._getTooltipContents=function(a,b){if(0===b.length){var e=this._view.getModel(),f=a;e.getBaseModel&&(f=e.getLineStart(f),f=e.getBaseModel().getLineAtOffset(e.mapOffset(f)));return h.formatMessage(p.line,f+1)}return g.prototype._getTooltipContents.call(this,
a,b)};b.prototype._mergeAnnotation=function(a,b,e,f){if(0===e)return a||(a={html:"\x26nbsp;",style:{style:{height:3*f+"px"}}},a.style=this._mergeStyle(a.style,b.overviewStyle)),a};f.prototype=new a;f.prototype.onClick=function(a,b){if(void 0!==a){var e=this._annotationModel;if(e){var f=this._view.getModel(),d=f.getLineStart(a),g=f.getLineEnd(a,!0);f.getBaseModel&&(d=f.mapOffset(d),g=f.mapOffset(g),f=f.getBaseModel());for(var c,e=e.getAnnotations(d,g);!c&&e.hasNext();)g=e.next(),this.isAnnotationTypeVisible(g.type)&&
f.getLineAtOffset(g.start)===f.getLineAtOffset(d)&&(c=g);c&&((f=m.Tooltip.getTooltip(this._view))&&f.setTarget(null),c.expanded?c.collapse():c.expand())}}};f.prototype._getTooltipContents=function(b,f){if(0<f.length){var e=this._view.getModel(),d=e.getLineStart(b);e.getBaseModel&&(d=e.mapOffset(d),e=e.getBaseModel());for(var d=e.getLineAtOffset(d),g=0;g<f.length;g++){var c=f[g];if(this.isAnnotationTypeVisible(c.type)&&e.getLineAtOffset(c.start)===d){if(f[g].expanded)break;return a.prototype._getTooltipContents.call(this,
b,[c])}}}return null};f.prototype._onAnnotationModelChanged=function(b){function f(a){for(c=0;c<a.length;c++)if(g.isAnnotationTypeVisible(a[c].type)){var b=a[c].start;d.getBaseModel&&(b=d.mapOffset(b,!0));-1!==b&&(k=Math.min(k,d.getLineAtOffset(b)))}}if(b.textModelChangedEvent)a.prototype._onAnnotationModelChanged.call(this,b);else{var e=this._view;if(e){var d=e.getModel(),g=this,c,h=d.getLineCount(),k=h;f(b.added);f(b.removed);f(b.changed);b=e.getRulers();for(c=0;c<b.length;c++)e.redrawLines(k,h,
b[c])}}};r=function(a,b){l.call(this,a,"fixed",b)};r.prototype=c.mixin(new l,{setView:function(a){this._destroy();l.prototype.setView.call(this,a);this._create()},_create:function(){function a(b){var e=b.themeClass;e?((e=e.replace("textviewZoom",""))&&(e=" "+e),e="textviewZoom"+e):e="textviewZoom";b.themeClass=e;b.noScroll=!0;b.readonly=!0;return b}function b(){var a=c._metrics.viewPadding,e=c._metrics.viewPadding,f=c.getLineHeight(),d=m.getLineHeight(),n=c.getModel().getLineCount(),f=c._lineHeight?
c._scrollHeight:n*f,d=m._lineHeight?m._scrollHeight:n*d,n=d/f,g=c.getClientArea().height+a.top+a.bottom,e=m.getClientArea().height+e.top+e.bottom;return{zoomFactor:n,documentHeight:f,zoomDocumentHeight:d,clientHeight:g,zoomClientHeight:e,scrollWidth:c._metrics.scrollWidth,windowHeight:g*n,padding:a}}function e(a){a=a||{y:c.getTopPixel()};var e=b();m.setTopPixel(a.y*(e.zoomFactor+(e.windowHeight-e.clientHeight-e.scrollWidth)/e.documentHeight));a=a.y*e.zoomFactor;e=e.clientHeight*e.zoomFactor;y.top=
a;y.bottom=a+e;a=m.convert({y:a},"document","page").y;a-=y.node.getBoundingClientRect().top;q.style.top=a+"px";q.style.height=e-r+"px"}function f(a){a.wrapMode&&!a.wrapOffset&&c._metrics.charWidth?(a=h.createElement(p,"div"),a.style.position="fixed",a.style.left="-1000px",m._clientDiv.appendChild(a),a.innerHTML=Array(Math.ceil(c.getClientArea().width/c._metrics.charWidth)+1).join("a"),a=a.getBoundingClientRect(),a=Math.min(150,Math.ceil(a.right-a.left))+"px"):a="";var b=y.node.style.width;y.node.style.width=
a;return b!==a}function d(a,b,e){e||y.top<=a.y&&a.y<=y.bottom?(y.mouseDown=!0,y.delta=b-q.getBoundingClientRect().top+y.node.getBoundingClientRect().top):(a=m.getOffsetAtLocation(a.x,a.y),c.setSelection(a,a,0.5,function(){}))}function g(a){if(y.mouseDown){var e=b();a=Math.min(e.zoomClientHeight-e.windowHeight,Math.max(0,a-y.delta));c.setTopPixel(a*(e.documentHeight-e.clientHeight)/Math.min(e.zoomDocumentHeight,e.zoomClientHeight-e.windowHeight))}}var c=this.getView();if(c){var l=a(c.getOptions());
l.parent=this.node;var m=this._zoomView=new s.TextView(l);m._clientDiv.contentEditable=!1;m.setModel(c.getModel());var p=c.getOptions("parent").ownerDocument,q=this._windowDiv=h.createElement(p,"div");q.className="rulerZoomWindow";this.node.appendChild(q);var r=parseInt(k.getNodeStyle(q,"border-top-width",0))+parseInt(k.getNodeStyle(q,"border-bottom-width",0)),y=this;c.addEventListener("Scroll",this._scrollListener=function(a){e(a.newValue)});c.addEventListener("Resize",this._resizeListener=function(){f(m.getOptions());
e()});c.addEventListener("Redraw",this._redrawListener=function(a){a.ruler||m.redrawLines(a.startLine,a.endLine)});c.addEventListener("Options",this._optionsListener=function(b){b=a(b.options);m.setOptions(b);f(m.getOptions())});m.addEventListener("LineStyle",this._lineListener=function(a){c.onLineStyle(a)});h.isIOS||h.isAndroid?(q.addEventListener("touchstart",function(a){1===a.touches.length&&(d(a,a.touches[0].clientY,!0),a.preventDefault())}),q.addEventListener("touchend",function(a){0===a.touches.length&&
(y.mouseDown=!1)}),q.addEventListener("touchmove",function(a){1===a.touches.length&&g(a.touches[0].clientY)}),m.addEventListener("TouchStart",function(a){1===a.touchCount&&(d(a,a.event.touches[0].clientY),a.preventDefault())})):(q.style.pointerEvents="none",m.addEventListener("MouseDown",function(a){var b=a.event;(b.which?0===b.button:1===b.button)&&d(a,b.clientY);a.preventDefault()}),m.addEventListener("MouseUp",function(a){y.mouseDown=!1;a.preventDefault()}),m.addEventListener("MouseMove",function(a){g(a.event.clientY);
a.preventDefault()}));(p.defaultView||p.parentWindow).setTimeout(function(){e()},0)}},_destroy:function(){var a=this.getView();a&&(a.removeEventListener("Scroll",this._scrollListener),this._scrollListener=null,a.removeEventListener("Resize",this._resizeListener),this._resizeListener=null,a.removeEventListener("Redraw",this._redrawListener),this._redrawListener=null,a.removeEventListener("Options",this._optionsListener),this._optionsListener=null);if(a=this._zoomView)a.removeEventListener("LineStyle",
this._lineListener),a.setModel(null),a.destroy(),this._zoomView=null}});return{BaseRuler:l,Ruler:g,AnnotationRuler:a,LineNumberRuler:d,OverviewRuler:b,FoldingRuler:f,ZoomRuler:r}});
define("orion/editor/undoStack",[],function(){function p(m,c,k,h,l){this.model=m;this.offset=c;this.text=k;this.previousText=h;this.type=l}function s(m){this.owner=m;this.changes=[]}function r(m,c){this.size=void 0!==c?c:100;this.reset();var k=this;this._listener={onChanging:function(c){k._onChanging(c)},onDestroy:function(c){k._onDestroy(c)}};if(m.getModel){var h=m.getModel();h.getBaseModel&&(h=h.getBaseModel());this.model=h;this.setView(m)}else this.shared=!0,this.model=m;this.model.addEventListener("Changing",
this._listener.onChanging)}p.prototype={getRedoChanges:function(){return[{start:this.offset,end:this.offset+this.previousText.length,text:this.text}]},getUndoChanges:function(){return[{start:this.offset,end:this.offset+this.text.length,text:this.previousText}]},undo:function(m,c){this._doUndoRedo(this.offset,this.previousText,this.text,m,c);return!0},redo:function(m,c){this._doUndoRedo(this.offset,this.text,this.previousText,m,c);return!0},merge:function(m,c,k,h,l){if(h===this.type){if(1===h&&m===
this.offset+this.text.length)return this.text+=c,!0;if(-1===h&&l===this.offset)return this.offset=m,this.previousText=k+this.previousText,!0;if(-1===h&&m===this.offset)return this.previousText+=k,!0}return!1},_doUndoRedo:function(m,c,k,h,l){this.model.setText(c,m,m+k.length);l&&h&&(k=h.getModel(),k!==this.model&&(m=k.mapOffset(m,!0)),h.setSelection(m,m+c.length))}};s.prototype={getRedoChanges:function(){for(var m=[],c=0;c<this.changes.length;c++)m=m.concat(this.changes[c].getRedoChanges());return m},
getUndoChanges:function(){for(var m=[],c=this.changes.length-1;0<=c;c--)m=m.concat(this.changes[c].getUndoChanges());return m},add:function(m){this.changes.push(m)},end:function(m){m&&(this.endSelection=m.getSelection(),this.endCaret=m.getCaretOffset());(m=this.owner)&&m.end&&m.end()},undo:function(m,c){1<this.changes.length&&m&&m.setRedraw(!1);for(var k=this.changes.length-1;0<=k;k--)this.changes[k].undo(m,!1);if(c&&m){var k=this.startSelection.start,h=this.startSelection.end;m.setSelection(this.startCaret?
k:h,this.startCaret?h:k)}1<this.changes.length&&m&&m.setRedraw(!0);(k=this.owner)&&k.undo&&k.undo();return 0<this.changes.length},redo:function(m,c){1<this.changes.length&&m&&m.setRedraw(!1);for(var k=0;k<this.changes.length;k++)this.changes[k].redo(m,!1);(1<this.changes.length,m)&&m.setRedraw(!0);if(c&&m){var k=this.endSelection.start,h=this.endSelection.end;m.setSelection(this.endCaret?k:h,this.endCaret?h:k)}(k=this.owner)&&k.redo&&k.redo();return 0<this.changes.length},merge:function(m,c,k,h,l){var g=
this.changes.length;return 0<g?this.changes[g-1].merge(m,c,k,h,l):!1},start:function(m){m&&(this.startSelection=m.getSelection(),this.startCaret=m.getCaretOffset());(m=this.owner)&&m.start&&m.start()}};r.prototype={destroy:function(){this._onDestroy()},add:function(m){this.compoundChange?this.compoundChange.add(m):(this.stack.splice(this.index,this.stack.length-this.index,m),this.index++,this.stack.length>this.size&&(this.stack.shift(),this.index--))},markClean:function(){this._commitUndo();if(this.cleanChange=
this.stack[this.index-1])this.cleanChange.type=2},isClean:function(){return this.cleanChange===this.stack[this.index-1]},canUndo:function(){return 0<this.index},canRedo:function(){return 0<this.stack.length-this.index},endCompoundChange:function(){this.compoundChange&&this.compoundChange.end(this.view);this.compoundChange=void 0},getSize:function(){return{undo:this.index,redo:this.stack.length-this.index}},getRedoChanges:function(){this._commitUndo();for(var m=[],c=this.index;c<this.stack.length;c++)m=
m.concat(this.stack[c].getRedoChanges());return m},getUndoChanges:function(){this._commitUndo();for(var m=[],c=this.index;0<=c;c--)m=m.concat(this.stack[c].getUndoChanges());return m},undo:function(){this._commitUndo();var m;m=!1;this._ignoreUndo=!0;do{if(0>=this.index)break;m=this.stack[--this.index]}while(!(m=m.undo(this.view,!0)));this._ignoreUndo=!1;return m},redo:function(){this._commitUndo();var m;this._ignoreUndo=!0;do{if(this.index>=this.stack.length)break;m=this.stack[this.index++]}while(!m.redo(this.view,
!0));this._ignoreUndo=!1;return!0},reset:function(){this.index=0;this.cleanChange=void 0;this.stack=[];this._ignoreUndo=!1;this._compoundChange=void 0},setView:function(m){this.view!==m&&(this.view&&m.removeEventListener("Destroy",this._listener.onDestroy),(this.view=m)&&m.addEventListener("Destroy",this._listener.onDestroy))},startCompoundChange:function(m){this._commitUndo();m=new s(m);this.add(m);this.compoundChange=m;this.compoundChange.start(this.view);return this.compoundChange},_commitUndo:function(){this.endCompoundChange()},
_onDestroy:function(m){(!m||!this.shared)&&this.model.removeEventListener("Changing",this._listener.onChanging);this.view&&(this.view.removeEventListener("Destroy",this._listener.onDestroy),this.view=null)},_onChanging:function(m){if(!this._ignoreUndo){var c=m.text,k=m.start,h=m.addedCharCount,l=m.removedCharCount;m=k+l;var g=0;0===h&&1===l?g=-1:1===h&&0===l&&(g=1);h=this.stack.length;l=this.model.getText(k,m);(!(0<h&&this.index===h)||!this.stack[h-1].merge(k,c,l,g,m))&&this.add(new p(this.model,
k,c,l,g))}}};return{UndoStack:r}});
define("orion/editor/textDND",["orion/util"],function(p){function s(p,m){this._view=p;this._undoStack=m;this._dragSelection=null;this._dropOffset=-1;this._dropText=null;var c=this;this._listener={onDragStart:function(k){c._onDragStart(k)},onDragEnd:function(k){c._onDragEnd(k)},onDragEnter:function(k){c._onDragEnter(k)},onDragOver:function(k){c._onDragOver(k)},onDrop:function(k){c._onDrop(k)},onDestroy:function(k){c._onDestroy(k)}};p.addEventListener("DragStart",this._listener.onDragStart);p.addEventListener("DragEnd",
this._listener.onDragEnd);p.addEventListener("DragEnter",this._listener.onDragEnter);p.addEventListener("DragOver",this._listener.onDragOver);p.addEventListener("Drop",this._listener.onDrop);p.addEventListener("Destroy",this._listener.onDestroy)}s.prototype={destroy:function(){var p=this._view;p&&(p.removeEventListener("DragStart",this._listener.onDragStart),p.removeEventListener("DragEnd",this._listener.onDragEnd),p.removeEventListener("DragEnter",this._listener.onDragEnter),p.removeEventListener("DragOver",
this._listener.onDragOver),p.removeEventListener("Drop",this._listener.onDrop),p.removeEventListener("Destroy",this._listener.onDestroy),this._view=null)},_onDestroy:function(p){this.destroy()},_onDragStart:function(p){var m=this._view,c=m.getSelection(),m=m.getModel();m.getBaseModel&&(c.start=m.mapOffset(c.start),c.end=m.mapOffset(c.end),m=m.getBaseModel());if(m=m.getText(c.start,c.end))this._dragSelection=c,p.event.dataTransfer.effectAllowed="copyMove",p.event.dataTransfer.setData("Text",m)},_onDragEnd:function(r){if(this._dragSelection){var m=
this._view,c=r.event.dataTransfer.dropEffect;if(!p.isFirefox&&("none"!==c||this._dropText))c=r.event.dataTransfer.dropEffect=this._dropEffect;this._undoStack&&this._undoStack.startCompoundChange();(r="move"===c)&&m.setText("",this._dragSelection.start,this._dragSelection.end);if(this._dropText){var c=this._dropText,k=this._dropOffset;r&&(k>=this._dragSelection.end?k-=this._dragSelection.end-this._dragSelection.start:k>=this._dragSelection.start&&(k=this._dragSelection.start));m.setText(c,k,k);m.setSelection(k,
k+c.length);this._dropText=null;this._dropOffset=-1}this._undoStack&&this._undoStack.endCompoundChange()}this._dragSelection=null},_onDragEnter:function(p){this._onDragOver(p)},_onDragOver:function(r){var m=r.event.dataTransfer.types,c=!this._view.getOptions("readonly");c&&m&&(c=m.contains?m.contains("text/plain")||m.contains("Text"):-1!==m.indexOf("text/plain")||-1!==m.indexOf("Text"));c?p.isFirefox||(this._dropEffect=r.event.dataTransfer.dropEffect=(p.isMac?r.event.altKey:r.event.ctrlKey)?"copy":
"move"):r.event.dataTransfer.dropEffect="none"},_onDrop:function(r){var m=this._view,c=r.event.dataTransfer.getData("Text");c&&(p.isFirefox||(r.event.dataTransfer.dropEffect=this._dropEffect),r=m.getOffsetAtLocation(r.x,r.y),this._dragSelection?(this._dropOffset=r,this._dropText=c):(m.setText(c,r,r),m.setSelection(r,r+c.length)))}};return{TextDND:s}});
define("orion/editor/editor","i18n!orion/editor/nls/messages orion/editor/eventTarget orion/editor/tooltip orion/editor/annotations orion/objects orion/util".split(" "),function(p,s,r,m,c,k){function h(d){d=d||{};this._domNode=d.domNode;this._model=d.model;this._undoStack=d.undoStack;this._statusReporter=d.statusReporter;this._title=null;var a=this;this._listener={onChanged:function(b){a.onChanged(b)}};this._model&&this._model.addEventListener("Changed",this._listener.onChanged);this.checkDirty()}
function l(d){d=d||{};h.call(this,d);this._textViewFactory=d.textViewFactory;this._undoStackFactory=d.undoStackFactory;this._textDNDFactory=d.textDNDFactory;this._annotationFactory=d.annotationFactory;this._zoomRulerFactory=d.zoomRulerFactory;this._foldingRulerFactory=d.foldingRulerFactory;this._lineNumberRulerFactory=d.lineNumberRulerFactory;this._contentAssistFactory=d.contentAssistFactory;this._keyBindingFactory=d.keyBindingFactory;this._hoverFactory=d.hoverFactory;this._contentAssist=this._foldingRuler=
this._zoomRuler=this._overviewRuler=this._lineNumberRuler=this._annotationRuler=this._annotationModel=this._annotationStyler=null}var g=m.AnnotationType;h.prototype={destroy:function(){this.uninstall();this._statusReporter=this._domNode=null;this._model&&this._model.removeEventListener("Changed",this._listener.onChanged)},checkDirty:function(){this.setDirty(this._undoStack&&!this._undoStack.isClean())},focus:function(){},getModel:function(){return this._model},getText:function(d,a){return this.getModel().getText(d,
a)},getTitle:function(){return this._title},getUndoStack:function(){return this._undoStack},install:function(){this.installed=!0},isDirty:function(){return this._dirty},markClean:function(){this.getUndoStack().markClean();this.setDirty(!1)},onDirtyChanged:function(d){return this.dispatchEvent(d)},onInputChanged:function(d){return this.dispatchEvent(d)},onChanged:function(d){this.checkDirty()},reportStatus:function(d,a,b){this._statusReporter&&this._statusReporter(d,a,b)},resize:function(){},setDirty:function(d){this._dirty!==
d&&(this._dirty=d,this.onDirtyChanged({type:"DirtyChanged"}))},_setModelText:function(d){this._model&&this._model.setText(d)},setInput:function(d,a,b,f){this._title=d;f||(a?this.reportStatus(a,"error"):null!==b&&(void 0!==b&&"string"===typeof b)&&this._setModelText(b),this._undoStack&&this._undoStack.reset());this.checkDirty();this.onInputChanged({type:"InputChanged",title:d,message:a,contents:b,contentsSaved:f})},setText:function(d,a,b){this.getModel().setText(d,a,b)},uninstall:function(){this.installed=
!1}};s.EventTarget.addMixin(h.prototype);l.prototype=new h;c.mixin(l.prototype,{destroy:function(){h.prototype.destroy.call(this);this._textViewFactory=this._undoStackFactory=this._textDNDFactory=this._annotationFactory=this._foldingRulerFactory=this._lineNumberRulerFactory=this._contentAssistFactory=this._keyBindingFactory=this._hoverFactory=this._zoomRulerFactory=null},getAnnotationModel:function(){return this._annotationModel},getAnnotationRuler:function(){return this._annotationRuler},getAnnotationStyler:function(){return this._annotationStyler},
getContentAssist:function(){return this._contentAssist},getFoldingRuler:function(){return this._foldingRuler},getLineNumberRuler:function(){return this._lineNumberRuler},getZoomRuler:function(){return this._zoomRuler},getModel:function(){if(!this._textView)return null;var d=this._textView.getModel();d.getBaseModel&&(d=d.getBaseModel());return d},getOverviewRuler:function(){return this._overviewRuler},getTextView:function(){return this._textView},getKeyModes:function(){return this._textView.getKeyModes()},
getSourceCodeActions:function(){return this._sourceCodeActions},getLinkedMode:function(){return this._linkedMode},getTextActions:function(){return this._textActions},focus:function(){this._textView&&this._textView.focus()},resize:function(){this._textView&&this._textView.resize()},setAnnotationRulerVisible:function(d,a){if(this._annotationRulerVisible!==d||a)if(this._annotationRulerVisible=d,this._annotationRuler){var b=this._textView;d?b.addRuler(this._annotationRuler,0):b.removeRuler(this._annotationRuler)}},
setFoldingRulerVisible:function(d,a){if(this._foldingRulerVisible!==d||a)if(this._foldingRulerVisible=d,this._foldingRuler){var b=this._textView;b.getModel().getBaseModel&&(d?b.addRuler(this._foldingRuler):b.removeRuler(this._foldingRuler))}},setLineNumberRulerVisible:function(d,a){if(this._lineNumberRulerVisible!==d||a)if(this._lineNumberRulerVisible=d,this._lineNumberRuler){var b=this._textView;d?b.addRuler(this._lineNumberRuler,!this._annotationRulerVisible?0:1):b.removeRuler(this._lineNumberRuler)}},
setOverviewRulerVisible:function(d,a){if(this._overviewRulerVisible!==d||a)if(this._overviewRulerVisible=d,this._overviewRuler){var b=this._textView;d?b.addRuler(this._overviewRuler):b.removeRuler(this._overviewRuler)}},setZoomRulerVisible:function(d,a){if(this._zoomRulerVisible!==d||a)if(this._zoomRulerVisible=d,this._zoomRuler){var b=this._textView;d?b.addRuler(this._zoomRuler):b.removeRuler(this._zoomRuler)}},mapOffset:function(d,a){var b=this._textView.getModel();b.getBaseModel&&(d=b.mapOffset(d,
a));return d},getLineAtOffset:function(d){return this.getModel().getLineAtOffset(this.mapOffset(d))},getLineStart:function(d){return this.getModel().getLineStart(d)},getCaretOffset:function(){return this.mapOffset(this._textView.getCaretOffset())},getSelection:function(){var d=this._textView,a=d.getSelection(),d=d.getModel();d.getBaseModel&&(a.start=d.mapOffset(a.start),a.end=d.mapOffset(a.end));return a},_expandOffset:function(d){var a=this._textView.getModel(),b=this._annotationModel;if(b&&a.getBaseModel)for(d=
b.getAnnotations(d,d+1);d.hasNext();)a=d.next(),a.type===g.ANNOTATION_FOLDING&&a.expand&&a.expand()},setCaretOffset:function(d,a,b){var f=this._textView,n=f.getModel();n.getBaseModel&&(this._expandOffset(d),d=n.mapOffset(d,!0));f.setCaretOffset(d,a,b)},setText:function(d,a,b){var f=this._textView,n=f.getModel();n.getBaseModel&&(void 0!==a&&(this._expandOffset(a),a=n.mapOffset(a,!0)),void 0!==b&&(this._expandOffset(b),b=n.mapOffset(b,!0)));f.setText(d,a,b)},setSelection:function(d,a,b,f){var n=this._textView,
g=n.getModel();g.getBaseModel&&(this._expandOffset(d),this._expandOffset(a),d=g.mapOffset(d,!0),a=g.mapOffset(a,!0));n.setSelection(d,a,b,f)},moveSelection:function(d,a,b,f){var n=this._textView;this.setSelection(d,a||d,1/3,function(){(void 0===f||f)&&n.focus();b&&b()})},_getTooltipInfo:function(d,a){var b=this._textView,f=this.getAnnotationModel();if(!f)return null;var n=this._annotationStyler;if(!n)return null;var g=b.getOffsetAtLocation(d,a);if(-1===g)return null;for(var g=this.mapOffset(g),e=
n.getAnnotationsByType(f,g,g+1),f=[],n=[],c=0;c<e.length;c++)e[c].rangeStyle&&(f.push(e[c]),n.push(e[c].title));e=[];this._hover&&(e=this._hover.computeHoverInfo({offset:g,annotations:n}));if(0===f.length&&0===e.length)return null;b=b.convert({x:d,y:a},"document","page");return{deferredInfo:e,contents:f,anchor:"left",x:b.x+10,y:b.y+20}},_highlightCurrentLine:function(d,a){var b=this._annotationModel;if(b){var f=this._textView;if(!f.getOptions("singleMode")){var n=f.getModel(),c=a?n.getLineAtOffset(a.start):
-1,e=n.getLineAtOffset(d.start),f=d.start===d.end,h=!a||a.start===a.end,k=n.getLineStart(e),l=n.getLineEnd(e);n.getBaseModel&&(k=n.mapOffset(k),l=n.mapOffset(l));n=this._currentLineAnnotation;if(!(c===e&&h&&f&&n&&n.start===k&&n.end===l)){var c=n?[n]:null,m;f&&(n=g.createAnnotation(g.ANNOTATION_CURRENT_LINE,k,l),m=[n]);this._currentLineAnnotation=n;b.replaceAnnotations(c,m)}}}},installTextView:function(){this.install()},install:function(){if(!this._textView){this._textView=this._textViewFactory();
this._undoStackFactory&&(this._undoStack=this._undoStackFactory.createUndoStack(this),this.checkDirty());this._textDNDFactory&&(this._textDND=this._textDNDFactory.createTextDND(this,this._undoStack));this._contentAssistFactory&&(this._contentAssist=this._contentAssistFactory.createContentAssistMode(this).getContentAssist());this._hoverFactory&&(this._hover=this._hoverFactory.createHover(this));var d=this,a=this._textView,b=this;this._listener={onModelChanged:function(a){b.checkDirty()},onMouseOver:function(a){b._listener.onMouseMove(a)},
onMouseMove:function(e){var f=r.Tooltip.getTooltip(a);f&&!(b._listener.lastMouseX===e.event.clientX&&b._listener.lastMouseY===e.event.clientY)&&(b._listener.lastMouseX=e.event.clientX,b._listener.lastMouseY=e.event.clientY,f.setTarget({x:e.x,y:e.y,getTooltipInfo:function(){return b._getTooltipInfo(this.x,this.y)}}))},onMouseOut:function(e){var f=r.Tooltip.getTooltip(a);f&&!(b._listener.lastMouseX===e.event.clientX&&b._listener.lastMouseY===e.event.clientY)&&(b._listener.lastMouseX=e.event.clientX,
b._listener.lastMouseY=e.event.clientY,f.setTarget(null))},onScroll:function(b){(b=r.Tooltip.getTooltip(a))&&b.setTarget(null,0,0)},onSelection:function(a){b._updateCursorStatus();b._highlightCurrentLine(a.newValue,a.oldValue)}};a.addEventListener("ModelChanged",this._listener.onModelChanged);a.addEventListener("Selection",this._listener.onSelection);a.addEventListener("MouseOver",this._listener.onMouseOver);a.addEventListener("MouseOut",this._listener.onMouseOut);a.addEventListener("MouseMove",this._listener.onMouseMove);
a.addEventListener("Scroll",this._listener.onScroll);if(this._keyBindingFactory){var f;if(f="function"===typeof this._keyBindingFactory?this._keyBindingFactory(this,this.getKeyModes(),this._undoStack,this._contentAssist):this._keyBindingFactory.createKeyBindings(d,this._undoStack,this._contentAssist))this._textActions=f.textActions,this._linkedMode=f.linkedMode,this._sourceCodeActions=f.sourceCodeActions}f=function(a,b){if(void 0!==a&&-1!==a){for(var f=this.getView().getModel(),n=this.getAnnotationModel(),
c=d.mapOffset(f.getLineStart(a)),f=d.mapOffset(f.getLineEnd(a)),h=n.getAnnotations(c,f),k=null;h.hasNext();){var t=h.next();if(t.type===g.ANNOTATION_BOOKMARK){k=t;break}}k?n.removeAnnotation(k):(k=g.createAnnotation(g.ANNOTATION_BOOKMARK,c,f,d.getText(c,f)),n.addAnnotation(k))}};if(this._annotationFactory){var n=a.getModel();n.getBaseModel&&(n=n.getBaseModel());if(this._annotationModel=this._annotationFactory.createAnnotationModel(n))if(n=this._annotationStyler=this._annotationFactory.createAnnotationStyler(a,
this._annotationModel))n.addAnnotationType(g.ANNOTATION_CURRENT_SEARCH),n.addAnnotationType(g.ANNOTATION_MATCHING_SEARCH),n.addAnnotationType(g.ANNOTATION_ERROR),n.addAnnotationType(g.ANNOTATION_WARNING),n.addAnnotationType(g.ANNOTATION_MATCHING_BRACKET),n.addAnnotationType(g.ANNOTATION_CURRENT_BRACKET),n.addAnnotationType(g.ANNOTATION_CURRENT_LINE),n.addAnnotationType(g.ANNOTATION_READ_OCCURRENCE),n.addAnnotationType(g.ANNOTATION_WRITE_OCCURRENCE),n.addAnnotationType(g.ANNOTATION_SELECTED_LINKED_GROUP),
n.addAnnotationType(g.ANNOTATION_CURRENT_LINKED_GROUP),n.addAnnotationType(g.ANNOTATION_LINKED_GROUP),n.addAnnotationType("orion.annotation.highlightError");var n=this._annotationFactory.createAnnotationRulers(this._annotationModel),c=this._annotationRuler=n.annotationRuler;c&&(c.onDblClick=f,c.setMultiAnnotationOverlay({html:"\x3cdiv class\x3d'annotationHTML overlay'\x3e\x3c/div\x3e"}),c.addAnnotationType(g.ANNOTATION_ERROR),c.addAnnotationType(g.ANNOTATION_WARNING),c.addAnnotationType(g.ANNOTATION_TASK),
c.addAnnotationType(g.ANNOTATION_BOOKMARK));this.setAnnotationRulerVisible(this._annotationRulerVisible||void 0===this._annotationRulerVisible,!0);if(c=this._overviewRuler=n.overviewRuler)c.addAnnotationType(g.ANNOTATION_CURRENT_SEARCH),c.addAnnotationType(g.ANNOTATION_MATCHING_SEARCH),c.addAnnotationType(g.ANNOTATION_READ_OCCURRENCE),c.addAnnotationType(g.ANNOTATION_WRITE_OCCURRENCE),c.addAnnotationType(g.ANNOTATION_CURRENT_BLAME),c.addAnnotationType(g.ANNOTATION_ERROR),c.addAnnotationType(g.ANNOTATION_WARNING),
c.addAnnotationType(g.ANNOTATION_TASK),c.addAnnotationType(g.ANNOTATION_BOOKMARK),c.addAnnotationType(g.ANNOTATION_MATCHING_BRACKET),c.addAnnotationType(g.ANNOTATION_CURRENT_BRACKET),c.addAnnotationType(g.ANNOTATION_CURRENT_LINE);this.setOverviewRulerVisible(this._overviewRulerVisible||void 0===this._overviewRulerVisible,!0)}this._zoomRulerFactory&&(this._zoomRuler=this._zoomRulerFactory.createZoomRuler(this._annotationModel),this.setZoomRulerVisible(this._zoomRulerVisible||void 0===this._zoomRulerVisible,
!0));this._lineNumberRulerFactory&&(this._lineNumberRuler=this._lineNumberRulerFactory.createLineNumberRuler(this._annotationModel),this._lineNumberRuler.addAnnotationType(g.ANNOTATION_CURRENT_BLAME),this._lineNumberRuler.addAnnotationType(g.ANNOTATION_BLAME),this._lineNumberRuler.onDblClick=f,this.setLineNumberRulerVisible(this._lineNumberRulerVisible||void 0===this._lineNumberRulerVisible,!0));this._foldingRulerFactory&&(this._foldingRuler=this._foldingRulerFactory.createFoldingRuler(this._annotationModel),
this._foldingRuler.addAnnotationType(g.ANNOTATION_FOLDING),this.setFoldingRulerVisible(this._foldingRulerVisible||void 0===this._foldingRulerVisible,!0));this.dispatchEvent({type:"TextViewInstalled",textView:a});h.prototype.install.call(this)}},uninstallTextView:function(){this.uninstall()},uninstall:function(){var d=this._textView;d&&(d.destroy(),this._annotationModel&&this._annotationModel.setTextModel(null),this._textView=this._undoStack=this._textDND=this._contentAssist=this._listener=this._annotationModel=
this._annotationStyler=this._annotationRuler=this._overviewRuler=this._zoomRuler=this._lineNumberRuler=this._foldingRuler=this._currentLineAnnotation=this._title=null,this._dirty=!1,this._foldingRulerVisible=this._overviewRulerVisible=this._zoomRulerVisible=this._lineNumberRulerVisible=this._annotationRulerVisible=void 0,this.dispatchEvent({type:"TextViewUninstalled",textView:d}),h.prototype.uninstall.call(this))},_updateCursorStatus:function(){for(var d=this.getModel(),a=this.getCaretOffset(),b=
d.getLineAtOffset(a),d=d.getLineStart(b),a=a-d,d=this.getKeyModes(),f=0;f<d.length;f++){var g=d[f];if(g.isActive()&&g.isStatusActive&&g.isStatusActive())return}this.reportStatus(k.formatMessage(p.lineColumn,b+1,a+1))},showAnnotations:function(d,a,b,f){var n=this._annotationModel;if(n){for(var c=[],e=[],h=n.getTextModel(),k=n.getAnnotations(),l;k.hasNext();)l=k.next(),-1!==a.indexOf(l.type)&&l.creatorID===this&&c.push(l);if(d)for(a=0;a<d.length;a++)if(l=d[a]){if(b)l=b(l);else{var m;"number"===typeof l.line?
(m=h.getLineStart(l.line-1),k=m+l.start-1,m=m+l.end-1):(k=l.start,m=l.end);var p=f(l);if(!p)continue;l=g.createAnnotation(p,k,m,l.description)}l.creatorID=this;e.push(l)}n.replaceAnnotations(c,e)}},showProblems:function(d){this.showAnnotations(d,[g.ANNOTATION_ERROR,g.ANNOTATION_WARNING,g.ANNOTATION_TASK],null,function(a){switch(a.severity){case "error":return g.ANNOTATION_ERROR;case "warning":return g.ANNOTATION_WARNING;case "task":return g.ANNOTATION_TASK}return null})},showOccurrences:function(d){this.showAnnotations(d,
[g.ANNOTATION_READ_OCCURRENCE,g.ANNOTATION_WRITE_OCCURRENCE],null,function(a){return a.readAccess?g.ANNOTATION_READ_OCCURRENCE:g.ANNOTATION_WRITE_OCCURRENCE})},showBlame:function(d){var a=this._blameRGB,b=this.getTextView().getOptions("parent").ownerDocument;if(!a){var f=k.createElement(b,"div");f.className="annotation blame";b.body.appendChild(f);var n=(b.defaultView||b.parentWindow).getComputedStyle(f).getPropertyValue("background-color");f.parentNode.removeChild(f);var f=n.indexOf("("),h=n.indexOf(")"),
n=n.substring(f+1,h);this._blameRGB=a=n.split(",").slice(0,3)}var e=function(){var a=m.AnnotationType.createAnnotation(this.groupType,this.start,this.end,this.title);a.style=c.mixin({},a.style);a.style.style=c.mixin({},a.style.style);a.style.style.backgroundColor="";this.groupAnnotation=a;a.blame=this.blame;a.html=this.html;a.creatorID=this.creatorID;return a},l=function(){var a=k.createElement(b,"div");a.className="tooltipTitle";var e=this.blame.Message.indexOf("\n");-1===e&&(e=this.blame.Message.length);
var f=k.createElement(b,"a");f.href=this.blame.CommitLink;f.appendChild(b.createTextNode(this.blame.Message.substring(0,e)));a.appendChild(f);a.appendChild(k.createElement(b,"br"));a.appendChild(b.createTextNode(k.formatMessage(p.committerOnTime,this.blame.AuthorName,this.blame.Time)));return a},u=this.getModel();this.showAnnotations(d,[g.ANNOTATION_BLAME,g.ANNOTATION_CURRENT_BLAME],function(b){var f=u.getLineStart(b.Start-1),d=u.getLineEnd(b.End-1,!0),f=m.AnnotationType.createAnnotation(g.ANNOTATION_BLAME,
f,d,l),d=a.slice(0);d.push(b.Shade);f.style=c.mixin({},f.style);f.style.style=c.mixin({},f.style.style);f.style.style.backgroundColor="rgba("+d.join()+")";f.groupId=b.Name;f.groupType=g.ANNOTATION_CURRENT_BLAME;f.createGroupAnnotation=e;f.html='\x3cimg class\x3d"annotationHTML blame" src\x3d"'+b.AuthorImage+'"/\x3e';f.blame=b;return f})},showSelection:function(d,a,b,f,g){"number"===typeof d?("number"!==typeof a&&(a=d),this.moveSelection(d,a)):"number"===typeof b&&(d=this.getModel().getLineStart(b-
1),"number"===typeof f&&(d+=f),"number"!==typeof g&&(g=0),this.moveSelection(d,d+g))},_setModelText:function(d){this._textView&&(this._textView.setText(d),this._textView.getModel().setLineDelimiter("auto"),this._highlightCurrentLine(this._textView.getSelection()))},setInput:function(d,a,b,f,g){h.prototype.setInput.call(this,d,a,b,f);this._textView&&(!f&&!g)&&this._textView.focus()},onGotoLine:function(d,a,b,f){if(this._textView){var g=this.getModel();d=Math.max(0,Math.min(d,g.getLineCount()-1));var c=
g.getLineStart(d),e=0;void 0===b&&(b=0);"string"===typeof a?(d=g.getLine(d).indexOf(a),-1!==d&&(e=d,b=e+a.length)):(e=a,a=g.getLineEnd(d)-c,e=Math.min(e,a),b=Math.min(b,a));this.moveSelection(c+e,c+b,f)}}});return{BaseEditor:h,Editor:l}});
define("orion/editor/find","i18n!orion/editor/nls/messages orion/keyBinding orion/editor/keyModes orion/editor/annotations orion/regex orion/objects orion/util".split(" "),function(p,s,r,m,c,k,h){function l(a){var b=a.getTextView();r.KeyMode.call(this,b);this.editor=a;this._active=!1;this._success=!0;this._ignoreSelection=!1;this._prefix="";b.setAction("incrementalFindCancel",function(){this.setActive(!1);return!0}.bind(this));b.setAction("incrementalFindBackspace",function(){return this._backspace()}.bind(this));
var f=this;this._listener={onVerify:function(a){var b=f.editor,e=b.getModel(),d=b.mapOffset(a.start),b=b.mapOffset(a.end),e=e.getText(d,b);if((e=f._prefix.match(RegExp("^"+c.escape(e),"i")))&&0<e.length)f._prefix+=a.text,f._success=!0,f._status(),f.find(f._forward,!0),a.text=null},onSelection:function(){f._ignoreSelection||f.setActive(!1)}}}function g(a,b,f){if(a){this._editor=a;this._undoStack=b;this._showAll=!0;this._visible=!1;this._wrap=this._caseInsensitive=!0;this._wholeWord=!1;this._incremental=
!0;this._regex=!1;this._findAfterReplace=!0;this._reverse=this._hideAfterFind=!1;this._timer=this._end=this._start=void 0;this._lastString="";var d=this;this._listeners={onEditorFocus:function(a){d._removeCurrentAnnotation(a)}};this.setOptions(f)}}var d={};l.prototype=new r.KeyMode;k.mixin(l.prototype,{createKeyBindings:function(){var a=s.KeyBinding,b=[];b.push({actionID:"incrementalFindBackspace",keyBinding:new a(8)});b.push({actionID:"incrementalFindCancel",keyBinding:new a(13)});b.push({actionID:"incrementalFindCancel",
keyBinding:new a(27)});b.push({actionID:"incrementalFindReverse",keyBinding:new a(38)});b.push({actionID:"incrementalFind",keyBinding:new a(40)});b.push({actionID:"incrementalFindReverse",keyBinding:new a("k",!0,!0)});b.push({actionID:"incrementalFind",keyBinding:new a("k",!0)});return b},find:function(a,b){this._forward=a;if(!this.isActive())return this.setActive(!0),!1;var f=this._prefix;if(0===f.length)return!1;var d=this.editor,g=d.getModel(),g=a?this._success?b?this._start:d.getCaretOffset()+
1:0:this._success?b?this._start:d.getCaretOffset():g.getCharCount()-1;(f=d.getModel().find({string:f,start:g,reverse:!a,caseInsensitive:f.toLowerCase()===f}).next())?(b||(this._start=g),this._ignoreSelection=this._success=!0,d.moveSelection(a?f.start:f.end,a?f.end:f.start),this._ignoreSelection=!1):this._success=!1;this._status();return!0},isActive:function(){return this._active},isStatusActive:function(){return this.isActive()},setActive:function(a){this._active!==a&&(this._active=a,this._prefix=
"",this._success=!0,a=this.editor.getTextView(),this._start=this.editor.getCaretOffset(),this.editor.setCaretOffset(this._start),this._active?(a.addEventListener("Verify",this._listener.onVerify),a.addEventListener("Selection",this._listener.onSelection),a.addKeyMode(this)):(a.removeEventListener("Verify",this._listener.onVerify),a.removeEventListener("Selection",this._listener.onSelection),a.removeKeyMode(this)),this._status())},_backspace:function(){var a=this._prefix,a=this._prefix=a.substring(0,
a.length-1);return 0===a.length?(this._ignoreSelection=this._success=!0,this.editor.setCaretOffset(this.editor.getSelection().start),this._ignoreSelection=!1,this._status(),!0):this.find(this._forward,!0)},_status:function(){if(this.isActive()){var a;a=this._forward?this._success?p.incrementalFindStr:p.incrementalFindStrNotFound:this._success?p.incrementalFindReverseStr:p.incrementalFindReverseStrNotFound;a=h.formatMessage(a,this._prefix);this.editor.reportStatus(a,this._success?"":"error")}else this.editor.reportStatus("")}});
d.IncrementalFind=l;g.prototype={find:function(a,b,f){this.setOptions({reverse:!a});var d=this.getFindString(),g;b&&(d=b.findString||d,g=b.count);a=this.getOptions();this.setOptions(b);b=f?this._startOffset:this.getStartOffset();if((g=this._doFind(d,b,g))&&!f)this._startOffset=g.start;this.setOptions(a);this._hideAfterFind&&this.hide();return g},getStartOffset:function(){return void 0!==this._start?this._start:this._reverse?this._editor.getSelection().start-1:this._editor.getCaretOffset()},getFindString:function(){var a=
this._editor.getSelection(),a=this._editor.getText(a.start,a.end);this._regex&&(a=c.escape(a));return a||this._lastString},getOptions:function(){return{showAll:this._showAll,caseInsensitive:this._caseInsensitive,wrap:this._wrap,wholeWord:this._wholeWord,incremental:this._incremental,regex:this._regex,findAfterReplace:this._findAfterReplace,hideAfterFind:this._hideAfterFind,reverse:this._reverse,findCallback:this._findCallback,start:this._start,end:this._end}},getReplaceString:function(){return""},
hide:function(){this._visible=!1;this._savedOptions&&(this.setOptions(this._savedOptions.pop()),0===this._savedOptions.length&&(this._savedOptions=null));this._removeAllAnnotations();var a=this._editor.getTextView();a&&(a.removeEventListener("Focus",this._listeners.onEditorFocus),a.focus())},_processReplaceString:function(a){var b=a;if(this._regex){for(var b="",f=!1,d=this._editor.getModel().getLineDelimiter(),g=0;g<a.length;g++){var e=a.substring(g,g+1);if(f){switch(e){case "R":b+=d;break;case "r":b+=
"\r";break;case "n":b+="\n";break;case "t":b+="\t";break;case "\\":b+="\\";break;default:b+="\\"+e}f=!1}else"\\"===e?f=!0:b+=e}f&&(b+="\\")}return b},isVisible:function(){return this._visible},replace:function(){var a=this.getFindString();if(a){var b=this._editor,f=this._processReplaceString(this.getReplaceString()),d=b.getSelection().start;if(b=b.getModel().find({string:a,start:d,reverse:!1,wrap:this._wrap,regex:this._regex,wholeWord:this._wholeWord,caseInsensitive:this._caseInsensitive}).next())this.startUndo(),
this._doReplace(b.start,b.end,a,f),this.endUndo()}this._findAfterReplace&&a&&this._doFind(a,this.getStartOffset())},replaceAll:function(){var a=this.getFindString();if(a){this._replacingAll=!0;var b=this._editor,f=b.getTextView();b.reportStatus(p.replacingAll);var d=this._processReplaceString(this.getReplaceString()),g=this;window.setTimeout(function(){for(var e=0,c=0;;){var k=g._doFind(a,e,null,!0);if(!k)break;c++;1===c&&(f.setRedraw(!1),g.startUndo());g._doReplace(k.start,k.end,a,d);e=g.getStartOffset()}0<
c&&(g.endUndo(),f.setRedraw(!0));0<e?b.reportStatus(h.formatMessage(p.replacedMatches,c)):b.reportStatus(p.nothingReplaced,"error");g._replacingAll=!1},100)}},setOptions:function(a){if(a){if((!0===a.showAll||!1===a.showAll)&&this._showAll!==a.showAll)if(this._showAll=a.showAll,this.isVisible())if(this._showAll)this._markAllOccurrences();else{var b=this._editor.getAnnotationModel();b&&b.removeAnnotations(m.AnnotationType.ANNOTATION_MATCHING_SEARCH)}if(!0===a.caseInsensitive||!1===a.caseInsensitive)this._caseInsensitive=
a.caseInsensitive;if(!0===a.wrap||!1===a.wrap)this._wrap=a.wrap;if(!0===a.wholeWord||!1===a.wholeWord)this._wholeWord=a.wholeWord;if(!0===a.incremental||!1===a.incremental)this._incremental=a.incremental;if(!0===a.regex||!1===a.regex)this._regex=a.regex;if(!0===a.findAfterReplace||!1===a.findAfterReplace)this._findAfterReplace=a.findAfterReplace;if(!0===a.hideAfterFind||!1===a.hideAfterFind)this._hideAfterFind=a.hideAfterFind;if(!0===a.reverse||!1===a.reverse)this._reverse=a.reverse;a.hasOwnProperty("findCallback")&&
(this._findCallback=a.findCallback);a.hasOwnProperty("start")&&(this._start=a.start);a.hasOwnProperty("end")&&(this._end=a.end)}},show:function(a){this._visible=!0;a&&(this._savedOptions||(this._savedOptions=[]),this._savedOptions.push(this.getOptions()),this.setOptions(a));this._startOffset=this._editor.getSelection().start;this._editor.getTextView().addEventListener("Focus",this._listeners.onEditorFocus);var b=this;window.setTimeout(function(){b._incremental&&b.find(!0,null,!0)},0)},startUndo:function(){this._undoStack&&
this._undoStack.startCompoundChange()},endUndo:function(){this._undoStack&&this._undoStack.endCompoundChange()},_find:function(a,b,f){return this._editor.getModel().find({string:a,start:b,end:this._end,reverse:this._reverse,wrap:f?!1:this._wrap,regex:this._regex,wholeWord:this._wholeWord,caseInsensitive:this._caseInsensitive})},_doFind:function(a,b,f,d){f=f||1;var g=this._editor;if(!a)return this._removeAllAnnotations(),null;this._lastString=a;var e,c;if(this._regex)try{c=this._find(a,b,d)}catch(h){g.reportStatus(h.message,
"error");return}else c=this._find(a,b,d);for(a=0;a<f&&c.hasNext();a++)e=c.next();if(!this._replacingAll){e?this._editor.reportStatus(""):this._editor.reportStatus(p.notFound,"error");if(this.isVisible()){f=m.AnnotationType.ANNOTATION_CURRENT_SEARCH;if(c=g.getAnnotationModel())c.removeAnnotations(f),e&&c.addAnnotation(m.AnnotationType.createAnnotation(f,e.start,e.end));if(this._showAll){this._timer&&window.clearTimeout(this._timer);var k=this;this._timer=window.setTimeout(function(){k._markAllOccurrences();
k._timer=null},500)}}this._findCallback?this._findCallback(e):e&&g.moveSelection(e.start,e.end,null,!1)}return e},_doReplace:function(a,b,f,d){var g=this._editor;this._regex&&(d=g.getText(a,b).replace(RegExp(f,this._caseInsensitive?"i":""),d));g.setText(d,a,b);g.setSelection(a,a+d.length,!0)},_markAllOccurrences:function(){var a=this._editor.getAnnotationModel();if(a){for(var b=m.AnnotationType.ANNOTATION_MATCHING_SEARCH,f=a.getAnnotations(),d=[],g;f.hasNext();){var e=f.next();e.type===b&&d.push(e)}if(this.isVisible()){f=
this.getFindString();f=this._editor.getModel().find({string:f,regex:this._regex,wholeWord:this._wholeWord,caseInsensitive:this._caseInsensitive});for(g=[];f.hasNext();)e=f.next(),g.push(m.AnnotationType.createAnnotation(b,e.start,e.end))}a.replaceAnnotations(d,g)}},_removeAllAnnotations:function(){var a=this._editor.getAnnotationModel();a&&(a.removeAnnotations(m.AnnotationType.ANNOTATION_CURRENT_SEARCH),a.removeAnnotations(m.AnnotationType.ANNOTATION_MATCHING_SEARCH))},_removeCurrentAnnotation:function(a){(a=
this._editor.getAnnotationModel())&&a.removeAnnotations(m.AnnotationType.ANNOTATION_CURRENT_SEARCH)}};d.Find=g;return d});
define("orion/editor/findUI",["i18n!orion/editor/nls/messages","orion/editor/find","orion/objects","orion/editor/util","orion/util"],function(p,s,r,m,c){function k(c,k,g){s.Find.call(this,c,k,g)}k.prototype=new s.Find;r.mixin(k.prototype,{getFindString:function(){var c=this._findInput;return!c?s.Find.prototype.getFindString.call(this):c.value},getReplaceString:function(){var c=this._replaceInput;return!c?s.Find.prototype.getReplaceString(this):c.value},hide:function(){var c=this.isVisible();s.Find.prototype.hide.call(this);
c&&(this._rootDiv.className="textViewFind")},show:function(c){s.Find.prototype.show.call(this,c);var k=c.findString;c=c.replaceString;var g=this._findInput;g||(this._create(),g=this._findInput);k&&(g.value=k);c&&(this._replaceInput.value=c);var d=this;window.setTimeout(function(){d._rootDiv.className="textViewFind show";g.select();g.focus()},0)},_create:function(){var h=this,k=this._editor.getTextView(),g=k.getOptions("parent").ownerDocument,d=c.createElement(g,"div");d.className="textViewFind";m.addEventListener(d,
"keydown",function(a){h._handleKeyDown(a)});this._rootDiv=d;this._createContents(g,d);k._rootDiv.insertBefore(d,k._rootDiv.firstChild)},_createContents:function(h,k){var g=this,d=c.createElement(h,"input");d.className="textViewFindInput";this._findInput=d;d.type="text";d.placeholder=p.findWith;m.addEventListener(d,"input",function(a){return g._handleInput(a)});k.appendChild(d);d=c.createElement(h,"span");g._createButton(h,d,p.next,function(){g.find(!0)});g._createButton(h,d,p.previous,function(){g.find(!1)});
k.appendChild(d);g._editor.getTextView().getOptions("readonly")||(d=c.createElement(h,"input"),d.className="textViewReplaceInput",this._replaceInput=d,d.type="text",d.placeholder=p.replaceWith,k.appendChild(d),d=c.createElement(h,"span"),g._createButton(h,d,p.replace,function(){g.replace()}),g._createButton(h,d,p.replaceAll,function(){g.replaceAll()}),k.appendChild(d));d=c.createElement(h,"span");g._createButton(h,d,p.regex,function(a){g._toggle("regex",a.target)},this._regex,p.regexTooltip);g._createButton(h,
d,p.caseInsensitive,function(a){g._toggle("caseInsensitive",a.target)},this._caseInsensitive,p.caseInsensitiveTooltip);g._createButton(h,d,p.wholeWord,function(a){g._toggle("wholeWord",a.target)},this._wholeWord,p.wholeWordTooltip);k.appendChild(d);d=g._createButton(h,k,"",function(){g.hide()});d.className="textViewFindCloseButton";d.title=p.closeTooltip},_createButton:function(c,k,g,d,a,b){var f=c.createElement("button");this._checked(a,f);b&&(f.title=b);m.addEventListener(f,"click",function(a){d.call(this,
a)},!1);g&&f.appendChild(c.createTextNode(g));k.appendChild(f);return f},_toggle:function(c,k){var g={};g[c]=!this["_"+c];this.setOptions(g);this._checked(g[c],k)},_checked:function(c,k){k.className="textViewFindButton";c&&(k.className+=" checked")},_handleInput:function(){this._incremental&&this.find(!0,null,!0);return!0},_handleKeyDown:function(h){var k,g=(c.isMac?h.metaKey:h.ctrlKey)&&!h.altKey&&!h.shiftKey;g&&70===h.keyCode&&(k=!0);if((c.isMac?h.metaKey:h.ctrlKey)&&!h.altKey&&75===h.keyCode||
13===h.keyCode)13===h.keyCode?this.find(this._reverse?h.shiftKey:!h.shiftKey):this.find(!h.shiftKey),k=!0;g&&82===h.keyCode&&(this.replace(),k=!0);27===h.keyCode&&(this.hide(),k=!0);return k?(h.stopPropagation&&h.stopPropagation(),h.preventDefault&&h.preventDefault(),h.cancelBubble=!0,!1):!0}});return{FindUI:k}});
define("orion/editor/actions","i18n!orion/editor/nls/messages orion/keyBinding orion/editor/annotations orion/editor/tooltip orion/editor/find orion/editor/findUI orion/util".split(" "),function(p,s,r,m,c,k,h){function l(a,f,d){this.editor=a;this.undoStack=f;this._incrementalFind=new c.IncrementalFind(a);this._find=d?d:new k.FindUI(a,f);this._lastEditLocation=null;this.init()}function g(a,f,d,g){this.editor=a;this.undoStack=f;this.contentAssist=d;this.linkedMode=g;this.contentAssist&&this.contentAssist.addEventListener("ProposalApplied",
this.contentAssistProposalApplied.bind(this));this.init()}var d=r.AnnotationType,a={};l.prototype={init:function(){var a=this.editor.getTextView();this._lastEditListener={onModelChanged:function(a){this.editor.isDirty()&&(this._lastEditLocation=a.start+a.addedCharCount)}.bind(this)};a.addEventListener("ModelChanged",this._lastEditListener.onModelChanged);a.setAction("undo",function(a){if(this.undoStack){var b=1;a&&a.count&&(b=a.count);for(;0<b;)this.undoStack.undo(),--b;return!0}return!1}.bind(this),
{name:p.undo});a.setAction("redo",function(a){if(this.undoStack){var b=1;a&&a.count&&(b=a.count);for(;0<b;)this.undoStack.redo(),--b;return!0}return!1}.bind(this),{name:p.redo});a.setKeyBinding(new s.KeyBinding("f",!0),"find");a.setAction("find",function(){if(this._find){var a=this.editor.getSelection();this._find.show({findString:this.editor.getText(a.start,a.end)});return!0}return!1}.bind(this),{name:p.find});a.setKeyBinding(new s.KeyBinding("k",!0),"findNext");a.setAction("findNext",function(a){return this._find?
(this._find.find(!0,a),!0):!1}.bind(this),{name:p.findNext});a.setKeyBinding(new s.KeyBinding("k",!0,!0),"findPrevious");a.setAction("findPrevious",function(a){return this._find?(this._find.find(!1,a),!0):!1}.bind(this),{name:p.findPrevious});a.setKeyBinding(new s.KeyBinding("j",!0),"incrementalFind");a.setAction("incrementalFind",function(){this._incrementalFind&&this._incrementalFind.find(!0);return!0}.bind(this),{name:p.incrementalFind});a.setKeyBinding(new s.KeyBinding("j",!0,!0),"incrementalFindReverse");
a.setAction("incrementalFindReverse",function(){this._incrementalFind&&this._incrementalFind.find(!1);return!0}.bind(this),{name:p.incrementalFindReverse});a.setAction("tab",function(){return this.indentLines()}.bind(this));a.setAction("shiftTab",function(){return this.unindentLines()}.bind(this),{name:p.unindentLines});a.setKeyBinding(new s.KeyBinding(38,!1,!1,!0),"moveLinesUp");a.setAction("moveLinesUp",function(){return this.moveLinesUp()}.bind(this),{name:p.moveLinesUp});a.setKeyBinding(new s.KeyBinding(40,
!1,!1,!0),"moveLinesDown");a.setAction("moveLinesDown",function(){return this.moveLinesDown()}.bind(this),{name:p.moveLinesDown});a.setKeyBinding(new s.KeyBinding(38,!0,!1,!0),"copyLinesUp");a.setAction("copyLinesUp",function(){return this.copyLinesUp()}.bind(this),{name:p.copyLinesUp});a.setKeyBinding(new s.KeyBinding(40,!0,!1,!0),"copyLinesDown");a.setAction("copyLinesDown",function(){return this.copyLinesDown()}.bind(this),{name:p.copyLinesDown});a.setKeyBinding(new s.KeyBinding("d",!0,!1,!1),
"deleteLines");a.setAction("deleteLines",function(a){return this.deleteLines(a)}.bind(this),{name:p.deleteLines});a.setKeyBinding(new s.KeyBinding("l",!h.isMac,!1,!1,h.isMac),"gotoLine");a.setAction("gotoLine",function(){return this.gotoLine()}.bind(this),{name:p.gotoLine});a.setKeyBinding(new s.KeyBinding(190,!0),"nextAnnotation");a.setAction("nextAnnotation",function(){return this.nextAnnotation(!0)}.bind(this),{name:p.nextAnnotation});a.setKeyBinding(new s.KeyBinding(188,!0),"previousAnnotation");
a.setAction("previousAnnotation",function(){return this.nextAnnotation(!1)}.bind(this),{name:p.prevAnnotation});a.setKeyBinding(new s.KeyBinding("e",!0,!1,!0,!1),"expand");a.setAction("expand",function(){return this.expandAnnotation(!0)}.bind(this),{name:p.expand});a.setKeyBinding(new s.KeyBinding("c",!0,!1,!0,!1),"collapse");a.setAction("collapse",function(){return this.expandAnnotation(!1)}.bind(this),{name:p.collapse});a.setKeyBinding(new s.KeyBinding("e",!0,!0,!0,!1),"expandAll");a.setAction("expandAll",
function(){return this.expandAnnotations(!0)}.bind(this),{name:p.expandAll});a.setKeyBinding(new s.KeyBinding("c",!0,!0,!0,!1),"collapseAll");a.setAction("collapseAll",function(){return this.expandAnnotations(!1)}.bind(this),{name:p.collapseAll});a.setKeyBinding(new s.KeyBinding("q",!h.isMac,!1,!1,h.isMac),"lastEdit");a.setAction("lastEdit",function(){return this.gotoLastEdit()}.bind(this),{name:p.lastEdit})},copyLinesDown:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;
var f=a.getModel(),d=a.getSelection(),g=f.getLineAtOffset(d.start),d=f.getLineAtOffset(d.end>d.start?d.end-1:d.end),e=f.getLineStart(g),g=f.getLineEnd(d,!0),c=f.getLineCount(),h="",e=f.getText(e,g);d===c-1&&(e=(h=f.getLineDelimiter())+e);a.setText(e,g,g);a.setSelection(g+h.length,g+e.length);return!0},copyLinesUp:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var f=a.getModel(),d=a.getSelection(),g=f.getLineAtOffset(d.start),d=f.getLineAtOffset(d.end>d.start?d.end-
1:d.end),g=f.getLineStart(g),e=f.getLineEnd(d,!0),c=f.getLineCount(),h="",e=f.getText(g,e);d===c-1&&(e+=h=f.getLineDelimiter());a.setText(e,g,g);a.setSelection(g,g+e.length-h.length);return!0},deleteLines:function(a){var f=this.editor;if(f.getTextView().getOptions("readonly"))return!1;var d=1;a&&a.count&&(d=a.count);var g=f.getSelection(),e=f.getModel(),c=e.getLineAtOffset(g.start);a=e.getLineStart(c);d=g.start!==g.end||1===d?e.getLineAtOffset(g.end>g.start?g.end-1:g.end):Math.min(c+d-1,e.getLineCount()-
1);d=e.getLineEnd(d,!0);f.setText("",a,d);return!0},expandAnnotation:function(a){var f=this.editor,d=f.getAnnotationModel();if(!d)return!0;var g=f.getModel(),e=f.getCaretOffset(),c=g.getLineAtOffset(e),e=g.getLineStart(c),c=g.getLineEnd(c,!0);g.getBaseModel&&(e=g.mapOffset(e),c=g.mapOffset(c),g.getBaseModel());for(var h,d=d.getAnnotations(e,c);!h&&d.hasNext();)g=d.next(),g.type===r.AnnotationType.ANNOTATION_FOLDING&&(h=g);h&&a!==h.expanded&&(a?h.expand():(f.setCaretOffset(h.start),h.collapse()));
return!0},expandAnnotations:function(a){var f=this.editor,d=f.getTextView(),f=f.getAnnotationModel();if(!f)return!0;var g=f.getAnnotations();for(d.setRedraw(!1);g.hasNext();)f=g.next(),f.type===r.AnnotationType.ANNOTATION_FOLDING&&a!==f.expanded&&(a?f.expand():f.collapse());d.setRedraw(!0);return!0},indentLines:function(){var a=this.editor,f=a.getTextView();if(f.getOptions("readonly"))return!1;if(f.getOptions("tabMode")){var d=a.getModel(),g=a.getSelection(),e=d.getLineAtOffset(g.start),c=d.getLineAtOffset(g.end>
g.start?g.end-1:g.end);if(e!==c){var h=[];h.push("");for(var k=e;k<=c;k++)h.push(d.getLine(k,!0));k=d.getLineStart(e);d=d.getLineEnd(c,!0);f=f.getOptions("tabSize","expandTab");f=f.expandTab?Array(f.tabSize+1).join(" "):"\t";a.setText(h.join(f),k,d);a.setSelection(k===g.start?g.start:g.start+f.length,g.end+(c-e+1)*f.length);return!0}return!1}},gotoLastEdit:function(){"number"===typeof this._lastEditLocation&&this.editor.showSelection(this._lastEditLocation);return!0},gotoLine:function(){var a=this.editor,
f=a.getModel().getLineAtOffset(a.getCaretOffset());if(f=prompt(p.gotoLinePrompty,f+1))f=parseInt(f,10),a.onGotoLine(f-1,0);return!0},moveLinesDown:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var f=a.getModel(),d=a.getSelection(),g=f.getLineAtOffset(d.start),e=f.getLineAtOffset(d.end>d.start?d.end-1:d.end),c=f.getLineCount();if(e===c-1)return!0;var g=f.getLineStart(g),d=f.getLineEnd(e,!0),h=f.getLineEnd(e+1,!0)-(d-g),k=0;e!==c-2?f=f.getText(g,d):(e=f.getLineEnd(e),
f=f.getText(e,d)+f.getText(g,e),k+=d-e);this.startUndo();a.setText("",g,d);a.setText(f,h,h);a.setSelection(h+k,h+k+f.length);this.endUndo();return!0},moveLinesUp:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var f=a.getModel(),d=a.getSelection(),g=f.getLineAtOffset(d.start);if(0===g)return!0;var e=f.getLineAtOffset(d.end>d.start?d.end-1:d.end),c=f.getLineCount(),d=f.getLineStart(g-1),h=f.getLineStart(g),k=f.getLineEnd(e,!0),l=f.getText(h,k),m=0;e===c-1&&(e=f.getLineEnd(g-
1),g=f.getLineEnd(g-1,!0),l+=f.getText(e,g),h=e,m=g-e);this.startUndo();a.setText("",h,k);a.setText(l,d,d);a.setSelection(d,d+l.length-m);this.endUndo();return!0},nextAnnotation:function(a){function f(a){return!!a.lineStyle||a.type===d.ANNOTATION_MATCHING_BRACKET||a.type===d.ANNOTATION_CURRENT_BRACKET||!e.isAnnotationTypeVisible(a.type)}var g=this.editor,c=g.getAnnotationModel();if(!c)return!0;var e=g.getOverviewRuler()||g.getAnnotationStyler();if(!e)return!0;for(var h=g.getModel(),k=g.getCaretOffset(),
l=c.getAnnotations(a?k:0,a?h.getCharCount():k),p=null;l.hasNext();){var r=l.next();if(a){if(r.start<=k)continue}else if(r.start>=k)continue;if(!f(r)&&(p=r,a))break}if(p){for(var s=[p],l=c.getAnnotations(p.start,p.start);l.hasNext();)r=l.next(),r!==p&&!f(r)&&s.push(r);var B=g.getTextView(),q=h.getLineAtOffset(p.start),C=m.Tooltip.getTooltip(B);if(!C)return g.moveSelection(p.start),!0;g.moveSelection(p.start,p.start,function(){C.setTarget({getTooltipInfo:function(){var a=B.convert({x:B.getLocationAtOffset(p.start).x,
y:B.getLocationAtOffset(h.getLineStart(q)).y},"document","page");return{contents:s,x:a.x,y:a.y+Math.floor(1.33*B.getLineHeight(q))}}},0)})}return!0},unindentLines:function(){var a=this.editor,f=a.getTextView();if(f.getOptions("readonly"))return!1;if(f.getOptions("tabMode")){for(var d=a.getModel(),g=a.getSelection(),e=d.getLineAtOffset(g.start),c=d.getLineAtOffset(g.end>g.start?g.end-1:g.end),h=f.getOptions("tabSize"),k=Array(h+1).join(" "),l=[],m=f=0,p=e;p<=c;p++){var r=d.getLine(p,!0);if(d.getLineStart(p)!==
d.getLineEnd(p))if(0===r.indexOf("\t"))r=r.substring(1),f++;else if(0===r.indexOf(k))r=r.substring(h),f+=h;else return!0;p===e&&(m=f);l.push(r)}e=d.getLineStart(e);h=d.getLineEnd(c,!0);d=d.getLineStart(c);a.setText(l.join(""),e,h);c=e===g.start?g.start:g.start-m;g=Math.max(c,g.end-f+(g.end===d+1&&g.start!==g.end?1:0));a.setSelection(c,g);return!0}},startUndo:function(){this.undoStack&&this.undoStack.startCompoundChange()},endUndo:function(){this.undoStack&&this.undoStack.endCompoundChange()}};a.TextActions=
l;g.prototype={init:function(){var a=this.editor.getTextView();a.setAction("lineStart",function(){return this.lineStart()}.bind(this));a.setAction("enter",function(){return this.autoIndent()}.bind(this));a.setKeyBinding(new s.KeyBinding("t",!0,!1,!0),"trimTrailingWhitespaces");a.setAction("trimTrailingWhitespaces",function(){return this.trimTrailingWhitespaces()}.bind(this),{name:p.trimTrailingWhitespaces});a.setKeyBinding(new s.KeyBinding(191,!0),"toggleLineComment");a.setAction("toggleLineComment",
function(){return this.toggleLineComment()}.bind(this),{name:p.toggleLineComment});a.setKeyBinding(new s.KeyBinding(191,!0,!h.isMac,!1,h.isMac),"addBlockComment");a.setAction("addBlockComment",function(){return this.addBlockComment()}.bind(this),{name:p.addBlockComment});a.setKeyBinding(new s.KeyBinding(220,!0,!h.isMac,!1,h.isMac),"removeBlockComment");a.setAction("removeBlockComment",function(){return this.removeBlockComment()}.bind(this),{name:p.removeBlockComment});a.setKeyBinding(new s.KeyBinding("[",
!1,!1,!1,!1,"keypress"),"autoPairSquareBracket");a.setAction("autoPairSquareBracket",function(){return this.autoPairBrackets("[","]")}.bind(this));a.setKeyBinding(new s.KeyBinding("]",!1,!1,!1,!1,"keypress"),"skipClosingSquareBracket");a.setAction("skipClosingSquareBracket",function(){return this.skipClosingBracket("]")}.bind(this));a.setKeyBinding(new s.KeyBinding("\x3c",!1,!1,!1,!1,"keypress"),"autoPairAngleBracket");a.setAction("autoPairAngleBracket",function(){return this.autoPairBrackets("\x3c",
"\x3e")}.bind(this));a.setKeyBinding(new s.KeyBinding("\x3e",!1,!1,!1,!1,"keypress"),"skipClosingAngleBracket");a.setAction("skipClosingAngleBracket",function(){return this.skipClosingBracket("\x3e")}.bind(this));a.setKeyBinding(new s.KeyBinding("(",!1,!1,!1,!1,"keypress"),"autoPairParentheses");a.setAction("autoPairParentheses",function(){return this.autoPairBrackets("(",")")}.bind(this));a.setKeyBinding(new s.KeyBinding(")",!1,!1,!1,!1,"keypress"),"skipClosingParenthesis");a.setAction("skipClosingParenthesis",
function(){return this.skipClosingBracket(")")}.bind(this));a.setKeyBinding(new s.KeyBinding("{",!1,!1,!1,!1,"keypress"),"autoPairBraces");a.setAction("autoPairBraces",function(){return this.autoPairBrackets("{","}")}.bind(this));a.setKeyBinding(new s.KeyBinding("}",!1,!1,!1,!1,"keypress"),"skipClosingBrace");a.setAction("skipClosingBrace",function(){return this.skipClosingBracket("}")}.bind(this));a.setKeyBinding(new s.KeyBinding("'",!1,!1,!1,!1,"keypress"),"autoPairSingleQuotation");a.setAction("autoPairSingleQuotation",
function(){return this.autoPairQuotations("'")}.bind(this));a.setKeyBinding(new s.KeyBinding('"',!1,!1,!1,!1,"keypress"),"autoPairDblQuotation");a.setAction("autoPairDblQuotation",function(){return this.autoPairQuotations('"')}.bind(this));a.setAction("deletePrevious",function(){return this.deletePrevious()}.bind(this))},autoIndent:function(){var a=this.editor,f=a.getTextView();if(f.getOptions("readonly")||f.getOptions("singleMode"))return!1;var d=a.getSelection();if(d.start===d.end){for(var g=a.getModel(),
e=g.getLineAtOffset(d.start),c=g.getLine(e,!1),h=g.getLineStart(e),k=0,l=d.start-h,m;k<l&&(32===(m=c.charCodeAt(k))||9===m);)k++;var h=c.substring(0,k),f=f.getOptions("tabSize","expandTab"),p=f.expandTab?Array(f.tabSize+1).join(" "):"\t",f=g.getLineDelimiter(),r=/^[\s]*\/\*[\*]*[\s]*$/,q=/^[\s]*\*/,s=/\*\/[\s]*$/,y=c.substring(0,l),A=c.substring(l),G;if(this.smartIndentation&&123===c.charCodeAt(G=y.trimRight().length-1))return g=l-G-1,A=A.length-A.trimLeft().length,c=125===c.charCodeAt(l+A)?f+h+p+
f+h:f+h+p,a.setText(c,d.start-g,d.end+A),a.setCaretOffset(d.start+f.length+h.length+p.length-g),!0;if(this.autoCompleteComments&&!s.test(y)&&(r.test(y)||q.test(y))){if(k=r.exec(y)){c=f+h+" * ";c=s.test(A)?c+A.substring(0,A.length-2).trim():c+A.trim();if(g.getLineCount()===e+1||!q.test(g.getLine(e+1)))c+=f+h+" */";a.setText(c,d.start,d.end+A.length);a.setCaretOffset(d.start+f.length+h.length+3);return!0}if(k=q.exec(y))for(e-=1;0<=e;e--){k=g.getLine(e,!1);if(r.test(k))return s.test(A)||47===c.charCodeAt(l)?
(c=f+h+"*"+A,h=d.start+f.length+h.length+1):(c=f+h+"* "+A,h=d.start+f.length+h.length+2),a.setText(c,d.start,d.end+A.length),a.setCaretOffset(h),!0;if(!q.test(k))break}}else{if(s.test(y)&&32===h.charCodeAt(h.length-1))return c=f+h.substring(0,h.length-1),a.setText(c,d.start,d.end),a.setCaretOffset(d.start+c.length),!0;if(0<k){for(k=l;k<c.length&&(32===(m=c.charCodeAt(k++))||9===m);)d.end++;a.setText(g.getLineDelimiter()+h,d.start,d.end);return!0}}}return!1},addBlockComment:function(){var a=this.editor;
if(a.getTextView().getOptions("readonly"))return!1;var d=a.getModel(),g=a.getSelection(),c=this._findEnclosingComment(d,g.start,g.end);if(void 0!==c.commentStart&&void 0!==c.commentEnd)return!0;d=d.getText(g.start,g.end);if(0===d.length)return!0;var c=d.length,d=d.replace(/\/\*|\*\//g,""),e=d.length;a.setText("/*"+d+"*/",g.start,g.end);a.setSelection(g.start+2,g.end+2+(e-c));return!0},autoPairBrackets:function(a,d){if("["===a&&!this.autoPairSquareBrackets||"{"===a&&!this.autoPairBraces||"("===a&&
!this.autoPairParentheses||"\x3c"===a&&!this.autoPairAngleBrackets)return!1;var g=this.editor;if(g.getTextView().getOptions("readonly"))return!1;var c=g.getSelection(),e=g.getModel(),h=g.getCaretOffset()===e.getCharCount()?"":e.getText(c.start,c.start+1).trim(),k=/^$|[)}\]>]/;return c.start===c.end&&k.test(h)?(g.setText(a+d,c.start,c.start),g.setCaretOffset(c.start+1),!0):c.start!==c.end?(e=e.getText(c.start,c.end),g.setText(a+e+d,c.start,c.end),g.setSelection(c.start+1,c.end+1),!0):!1},autoPairQuotations:function(a){if(!this.autoPairQuotation)return!1;
var d=this.editor;if(d.getTextView().getOptions("readonly"))return!1;var g=d.getSelection(),c=d.getModel(),e=d.getCaretOffset(),h=0===e?"":c.getText(g.start-1,g.start).trim(),k=e===c.getCharCount()?"":c.getText(g.start,g.start+1).trim(),e=/^"$|^'$/,l=/\w/,m=/^$|[)}\]>]/;if(g.start!==g.end){c=c.getText(g.start,g.end);if(e.test(c))return!1;d.setText(a+c+a,g.start,g.end);d.setSelection(g.start+1,g.end+1)}else{if(k!==a){if(h===a||e.test(k)||l.test(h)||!m.test(k))return!1;d.setText(a+a,g.start,g.start)}d.setCaretOffset(g.start+
1)}return!0},contentAssistProposalApplied:function(a){function d(){return"number"===typeof g.escapePosition?g.escapePosition:a.data.start+g.proposal.length}var g=a.data.proposal;if(g.positions&&0<g.positions.length&&this.linkedMode){for(var c=[],e=0;e<g.positions.length;++e)c[e]={positions:[{offset:g.positions[e].offset,length:g.positions[e].length}]};this.linkedMode.enterLinkedMode({groups:c,escapePosition:d()})}else g.groups&&0<g.groups.length&&this.linkedMode?this.linkedMode.enterLinkedMode({groups:g.groups,
escapePosition:d()}):"number"===typeof g.escapePosition&&this.editor.getTextView().setCaretOffset(g.escapePosition);return!0},deletePrevious:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var d=a.getSelection();if(d.start!==d.end)return!1;var g=a.getModel(),c=a.getCaretOffset(),e=0===c?"":g.getText(d.start-1,d.start),g=c===g.getCharCount()?"":g.getText(d.start,d.start+1);("("===e&&")"===g||"["===e&&"]"===g||"{"===e&&"}"===g||"\x3c"===e&&"\x3e"===g||'"'===e&&'"'===
g||"'"===e&&"'"===g)&&a.setText("",d.start,d.start+1);return!1},_findEnclosingComment:function(a,d,g){var c=a.getLineAtOffset(d),e=a.getLineAtOffset(g),h,k,l,m,p,r;for(h=c;0<=h&&!(k=a.getLine(h),l=h===c?d-a.getLineStart(c):k.length,m=k.lastIndexOf("/*",l),k=k.lastIndexOf("*/",l),k>m);h--)if(-1!==m){p=a.getLineStart(h)+m;break}for(h=e;h<a.getLineCount()&&!(k=a.getLine(h),l=h===e?g-a.getLineStart(e):0,m=k.indexOf("/*",l),k=k.indexOf("*/",l),-1!==m&&m<k);h++)if(-1!==k){r=a.getLineStart(h)+k;break}return{commentStart:p,
commentEnd:r}},lineStart:function(){for(var a=this.editor,d=a.getModel(),g=a.getCaretOffset(),c=d.getLineAtOffset(g),e=d.getLineStart(c),d=d.getLine(c),c=0;c<d.length;c++){var h=d.charCodeAt(c);if(!(32===h||9===h))break}c+=e;return g!==c?(a.setSelection(c,c),!0):!1},removeBlockComment:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var d=a.getModel(),g=a.getSelection(),c=d.getText(g.start,g.end),e,h,k;for(k=0;k<c.length;k++)if("/*"===c.substring(k,k+2)){e=g.start+k;
break}for(;k<c.length;k++)if("*/"===c.substring(k,k+2)){h=g.start+k;break}if(void 0!==e&&void 0!==h)a.setText(d.getText(e+2,h),e,h+2),a.setSelection(e,h);else{c=this._findEnclosingComment(d,g.start,g.end);if(void 0===c.commentStart||void 0===c.commentEnd)return!0;d=d.getText(c.commentStart+2,c.commentEnd);a.setText(d,c.commentStart,c.commentEnd+2);a.setSelection(g.start-2,g.end-2)}return!0},toggleLineComment:function(){var a=this.editor,d=a.getTextView();if(d.getOptions("readonly"))return!1;for(var g=
this.lineComment||"//",c=a.getModel(),e=a.getSelection(),h=c.getLineAtOffset(e.start),k=c.getLineAtOffset(e.end>e.start?e.end-1:e.end),l=!0,m=[],p,r=h;r<=k;r++){var s=c.getLine(r,!0);p=s.indexOf(g);m.push(p);if(!l||-1===p)l=!1;else if(0!==p){for(l=0;l<p;l++){var q=s.charCodeAt(l);if(!(32===q||9===q))break}l=l===p}}r=g.length;s=c.getLineStart(h);d.setRedraw(!1);this.startUndo();if(l){for(l=m.length-1;0<=l;l--)p=m[l]+c.getLineStart(h+l),a.setText("",p,p+r);c=c.getLineStart(k);g=s===e.start?e.start:
e.start-r;e=e.end-r*(k-h+1)+(e.end===c+1?r:0)}else{for(l=m.length-1;0<=l;l--)p=c.getLineStart(h+l),a.setText(g,p,p);g=s===e.start?e.start:e.start+r;e=e.end+r*(k-h+1)}this.endUndo();a.setSelection(g,e);d.setRedraw(!0);return!0},trimTrailingWhitespaces:function(){var a=this.editor,d=a.getModel(),g=a.getSelection();a.getTextView().setRedraw(!1);a.getUndoStack().startCompoundChange();for(var c=/(\s+$)/,e=d.getLineCount(),h=0;h<e;h++){var k=d.getLine(h),l=c.exec(k);if(l){var m=d.getLineStart(h),k=l[0].length,
l=m+l.index;d.setText("",l,l+k);g.start>l&&(g.start=Math.max(l,g.start-k));g.start!==g.end&&g.end>l&&(g.end=Math.max(l,g.end-k))}}a.getUndoStack().endCompoundChange();a.setSelection(g.start,g.end,!1);a.getTextView().setRedraw(!0)},startUndo:function(){this.undoStack&&this.undoStack.startCompoundChange()},skipClosingBracket:function(a){var d=this.editor;if(d.getTextView().getOptions("readonly"))return!1;var g=d.getSelection(),c=d.getModel();return(d.getCaretOffset()===c.getCharCount()?"":c.getText(g.start,
g.start+1))===a?(d.setCaretOffset(g.start+1),!0):!1},endUndo:function(){this.undoStack&&this.undoStack.endCompoundChange()},setAutoPairParentheses:function(a){this.autoPairParentheses=a},setAutoPairBraces:function(a){this.autoPairBraces=a},setAutoPairSquareBrackets:function(a){this.autoPairSquareBrackets=a},setAutoPairAngleBrackets:function(a){this.autoPairAngleBrackets=a},setAutoPairQuotations:function(a){this.autoPairQuotation=a},setAutoCompleteComments:function(a){this.autoCompleteComments=a},
setLineComment:function(a){this.lineComment=a},setSmartIndentation:function(a){this.smartIndentation=a}};a.SourceCodeActions=g;String.prototype.trimLeft||(String.prototype.trimLeft=function(){return this.replace(/^\s+/g,"")});String.prototype.trimRight||(String.prototype.trimRight=function(){return this.replace(/\s+$/g,"")});return a});
define("orion/editor/templates",[],function(){function p(p,m,c,k){this.prefix=p;this.description=m;this.template=c;this.name=k;this._parse()}function s(p,m){this._keywords=p||[];this._templates=[];this.addTemplates(m||[])}p.prototype={getProposal:function(p,m,c){p=m-p.length;m={};var k,h=void 0!==c.delimiter?c.delimiter:"\n";c.indentation&&(h+=c.indentation);var l=void 0!==c.tab?c.tab:"\t",g=0,d=this.variables,a=this.segments;c=[];for(var b=0;b<a.length;b++){var f=a[b],n=d[f];if(void 0!==n)switch(f){case "${tab}":f=
l;break;case "${delimiter}":f=h;break;case "${cursor}":f="";k=g;break;default:var t=m[f];t||(t=m[f]={data:n.data,positions:[]});f=n.substitution;t.data&&t.data.values&&(f=t.data.values[0]);t.positions.push({offset:p+g,length:f.length})}c.push(f);g+=f.length}var h=[],e;for(e in m)m.hasOwnProperty(e)&&h.push(m[e]);c=c.join("");void 0===k&&(k=c.length);return{proposal:c,name:this.name,description:this.description,groups:h,escapePosition:p+k,style:"noemphasis"}},match:function(p){return 0===this.prefix.indexOf(p)},
_parse:function(){var p=this.template,m=[],c={},k,h=0,p=p.replace(/\n/g,"${delimiter}"),p=p.replace(/\t/g,"${tab}");p.replace(/\$\{((?:[^\\}]+|\\.))*\}/g,function(l,g,d){var a=l.substring(2,l.length-1);g=l;var b=a,f=null,n=b.indexOf(":");-1!==n&&(b=b.substring(0,n),g="${"+b+"}",f=JSON.parse(a.substring(n+1).replace("\\}","}").trim()));(a=c[g])||(a=c[g]={});a.substitution=b;f&&(a.data=f);(k=p.substring(h,d))&&m.push(k);m.push(g);h=d+l.length;return b});(k=p.substring(h,p.length))&&m.push(k);this.segments=
m;this.variables=c}};s.prototype={addTemplates:function(r){for(var m=this.getTemplates(),c=0;c<r.length;c++)m.push(new p(r[c].prefix,r[c].description,r[c].template,r[c].name))},initialize:function(){},computeProposals:function(p,m,c){var k=this.getPrefix(p,m,c),h=[];this.isValid(k,p,m,c)&&(h=h.concat(this.getTemplateProposals(k,m,c)),h=h.concat(this.getKeywordProposals(k)));return h},getKeywords:function(){return this._keywords},getKeywordProposals:function(p){var m=[],c=this.getKeywords();if(c){for(var k=
0;k<c.length;k++)0===c[k].indexOf(p)&&m.push({proposal:c[k].substring(p.length),description:c[k],style:"noemphasis_keyword"});0<m.length&&m.splice(0,0,{proposal:"",description:"Keywords",style:"noemphasis_title_keywords",unselectable:!0})}return m},getPrefix:function(p,m,c){return c.prefix},getTemplates:function(){return this._templates},getTemplateProposals:function(p,m,c){for(var k=[],h=this.getTemplates(),l=0;l<h.length;l++){var g=h[l];g.match(p)&&(g=g.getProposal(p,m,c),this.removePrefix(p,g),
k.push(g))}0<k.length&&(k.sort(function(d,a){return d.name<a.name?-1:d.name>a.name?1:0}),k.splice(0,0,{proposal:"",description:"Templates",style:"noemphasis_title",unselectable:!0}));return k},removePrefix:function(p,m){if(!(m.overwrite=m.proposal.substring(0,p.length)!==p))m.proposal=m.proposal.substring(p.length)},isValid:function(p,m,c,k){return!0}};return{Template:p,TemplateContentAssist:s}});
define("orion/editor/linkedMode","i18n!orion/editor/nls/messages orion/keyBinding orion/editor/keyModes orion/editor/annotations orion/editor/templates orion/objects orion/util".split(" "),function(p,s,r,m,c,k){function h(g,d,a){var b=g.getTextView();r.KeyMode.call(this,b);this.editor=g;this.undoStack=d;this.contentAssist=a;this.linkedModeModel=null;b.setAction("linkedModeEnter",function(){this.exitLinkedMode(!0);return!0}.bind(this));b.setAction("linkedModeCancel",function(){this.exitLinkedMode(!1);
return!0}.bind(this));b.setAction("linkedModeNextGroup",function(){var a=this.linkedModeModel;this.selectLinkedGroup((a.selectedGroupIndex+1)%a.groups.length);return!0}.bind(this));b.setAction("linkedModePreviousGroup",function(){var a=this.linkedModeModel;this.selectLinkedGroup(0<a.selectedGroupIndex?a.selectedGroupIndex-1:a.groups.length-1);return!0}.bind(this));this.linkedModeListener={onActivating:function(a){this._groupContentAssistProvider&&(this.contentAssist.setProviders([this._groupContentAssistProvider]),
this.contentAssist.setProgress(null))}.bind(this),onModelChanged:function(a){if(!this.ignoreVerify){for(var b=this.editor.mapOffset(a.start),d=this.linkedModeModel,e,g;d;)if(e=this._getPositionChanged(d,b,b+a.removedCharCount),g=e.position,void 0===g||g.model!==d)this.exitLinkedMode(!1),d=this.linkedModeModel;else break;if(d){d=0;a=a.addedCharCount-a.removedCharCount;e=e.positions;for(var c,h=0;h<e.length;++h){c=e[h];g=c.position;var k=g.offset<=b&&b<=g.offset+g.length;k&&!c.ansestor?(g.offset+=d,
g.length+=a,d+=a):(g.offset+=d,c.ansestor&&k&&(g.length+=a));c.escape&&(c.model.escapePosition=g.offset)}this._updateAnnotations(e)}}}.bind(this),onVerify:function(a){if(!this.ignoreVerify){for(var b=this.editor,d=b.mapOffset(a.start),e=this.editor.mapOffset(a.end),g=this.linkedModeModel,c,h;g;)if(c=this._getPositionChanged(g,d,e),h=c.position,void 0===h||h.model!==g)this.exitLinkedMode(!1),g=this.linkedModeModel;else break;if(g){var k=this._compoundChange;k?k.owner.model===g&&k.owner.group===h.group||
(this.endUndo(),this.startUndo()):this.startUndo();g.selectedGroupIndex=h.group;var k=0,l=a.text.length-(e-d);c=c.positions;for(var m,d=d-h.position.offset,p=e-h.position.offset,q=0;q<c.length;++q)m=c[q],e=m.position,m.oldOffset=e.offset,m.model===g&&m.group===h.group?(e.offset+=k,e.length+=l,k+=l):(e.offset+=k,m.ansestor&&(e.length+=h.count*l)),m.escape&&(m.model.escapePosition=e.offset);this.ignoreVerify=!0;for(q=c.length-1;0<=q;q--)m=c[q],m.model===g&&m.group===h.group&&b.setText(a.text,m.oldOffset+
d,m.oldOffset+p);this.ignoreVerify=!1;a.text=null;this._updateAnnotations(c)}}}.bind(this)}}var l={};h.prototype=new r.KeyMode;k.mixin(h.prototype,{createKeyBindings:function(){var g=s.KeyBinding,d=[];d.push({actionID:"linkedModeEnter",keyBinding:new g(13)});d.push({actionID:"linkedModeCancel",keyBinding:new g(27)});d.push({actionID:"linkedModeNextGroup",keyBinding:new g(9)});d.push({actionID:"linkedModePreviousGroup",keyBinding:new g(9,!1,!0)});return d},enterLinkedMode:function(g){if(!this.linkedModeModel){var d=
this.editor.getTextView();d.addKeyMode(this);d.addEventListener("Verify",this.linkedModeListener.onVerify);d.addEventListener("ModelChanged",this.linkedModeListener.onModelChanged);this.contentAssist.addEventListener("Activating",this.linkedModeListener.onActivating);this.editor.reportStatus(p.linkedModeEntered,null,!0)}this._sortedPositions=null;this.linkedModeModel&&(g.previousModel=this.linkedModeModel,g.parentGroup=this.linkedModeModel.selectedGroupIndex,this.linkedModeModel.nextModel=g);this.linkedModeModel=
g;this.selectLinkedGroup(0)},exitLinkedMode:function(g){if(this.isActive()){this._compoundChange&&(this.endUndo(),this._compoundChange=null);this._sortedPositions=null;var d=this.linkedModeModel;this.linkedModeModel=d.previousModel;d.parentGroup=d.previousModel=void 0;this.linkedModeModel&&(this.linkedModeModel.nextModel=void 0);if(!this.linkedModeModel){var a=this.editor,b=a.getTextView();b.removeKeyMode(this);b.removeEventListener("Verify",this.linkedModeListener.onVerify);b.removeEventListener("ModelChanged",
this.linkedModeListener.onModelChanged);b=this.contentAssist;b.removeEventListener("Activating",this.linkedModeListener.onActivating);b.offset=void 0;this.editor.reportStatus(p.linkedModeExited,null,!0);g&&"number"===typeof d.escapePosition&&a.setCaretOffset(d.escapePosition,!1)}this.selectLinkedGroup(0)}},startUndo:function(){if(this.undoStack){var g=this,d=this.linkedModeModel;this._compoundChange=this.undoStack.startCompoundChange({model:d,group:d.selectedGroupIndex,end:function(){g._compoundChange=
null}})}},endUndo:function(){this.undoStack&&this.undoStack.endCompoundChange()},isActive:function(){return!!this.linkedModeModel},isStatusActive:function(){return!!this.linkedModeModel},selectLinkedGroup:function(g){var d=this.linkedModeModel;if(d){d.selectedGroupIndex=g;g=d.groups[g];var a=g.positions[0],b=this.editor;b.setSelection(a.offset,a.offset+a.length);if(d=this.contentAssist)d.offset=void 0,g.data&&"link"===g.data.type&&g.data.values?((this._groupContentAssistProvider=new c.TemplateContentAssist(g.data.values)).getPrefix=
function(){var d=b.getSelection();return d.start===d.end&&(d=b.getCaretOffset(),a.offset<=d&&d<=a.offset+a.length)?b.getText(a.offset,d):""},d.offset=a.offset,d.deactivate(),d.activate()):this._groupContentAssistProvider&&(this._groupContentAssistProvider=null,d.deactivate())}this._updateAnnotations()},_getModelPositions:function(g,d,a){for(var b=d.groups,f=0;f<b.length;f++)for(var c=b[f].positions,h=0;h<c.length;h++){var e=c[h];a&&(e={offset:e.offset+a,length:e.length});e={index:h,group:f,count:c.length,
model:d,position:e};g.push(e);d.nextModel&&d.nextModel.parentGroup===f&&(e.ansestor=!0,this._getModelPositions(g,d.nextModel,(a||0)+c[h].offset-c[0].offset))}},_getSortedPositions:function(g){var d=this._sortedPositions;if(!d){for(d=[];g.previousModel;)g=g.previousModel;for(this._getModelPositions(d,g);g;)"number"===typeof g.escapePosition&&d.push({escape:!0,model:g,position:{offset:g.escapePosition,length:0}}),g=g.nextModel;d.sort(function(a,b){return a.position.offset-b.position.offset});this._sortedPositions=
d}return d},_getPositionChanged:function(g,d,a){var b;g=this._getSortedPositions(g);for(var f=g.length-1;0<=f;f--){var c=g[f].position;if(c.offset<=d&&a<=c.offset+c.length){b=g[f];break}}return{position:b,positions:g}},_updateAnnotations:function(g){var d=this.editor.getAnnotationModel();if(d){for(var a=[],b=[],f=d.getAnnotations(),c;f.hasNext();)switch(c=f.next(),c.type){case m.AnnotationType.ANNOTATION_LINKED_GROUP:case m.AnnotationType.ANNOTATION_CURRENT_LINKED_GROUP:case m.AnnotationType.ANNOTATION_SELECTED_LINKED_GROUP:a.push(c)}if(f=
this.linkedModeModel){g=g||this._getSortedPositions(f);for(var h=0;h<g.length;h++)if(c=g[h],c.model===f&&!c.escape){var e=m.AnnotationType.ANNOTATION_LINKED_GROUP;c.group===f.selectedGroupIndex&&(e=0===c.index?m.AnnotationType.ANNOTATION_SELECTED_LINKED_GROUP:m.AnnotationType.ANNOTATION_CURRENT_LINKED_GROUP);c=c.position;c=m.AnnotationType.createAnnotation(e,c.offset,c.offset+c.length,"");b.push(c)}}d.replaceAnnotations(a,b)}}});l.LinkedMode=h;return l});
define("orion/editor/factories","orion/editor/actions orion/editor/undoStack orion/editor/rulers orion/editor/annotations orion/editor/textDND orion/editor/linkedMode orion/util".split(" "),function(p,s,r,m,c,k,h){function l(){}function g(){}function d(){}function a(){}function b(){}function f(){}function n(){}var t={};l.prototype={createKeyBindings:function(a,b,d,f){f=new p.TextActions(a,b,f);var g=new k.LinkedMode(a,b,d);a=new p.SourceCodeActions(a,b,d,g);return{textActions:f,linkedMode:g,sourceCodeActions:a}}};
t.KeyBindingsFactory=l;g.prototype={createUndoStack:function(a){a=a.getTextView();return new s.UndoStack(a,200)}};t.UndoFactory=g;d.prototype={createLineNumberRuler:function(a){return new r.LineNumberRuler(a,"left",{styleClass:"ruler lines"},{styleClass:"rulerLines odd"},{styleClass:"rulerLines even"})}};t.LineNumberRulerFactory=d;a.prototype={createFoldingRuler:function(a){return new r.FoldingRuler(a,"left",{styleClass:"ruler folding"})}};t.FoldingRulerFactory=a;b.prototype={createZoomRuler:function(a){return new r.ZoomRuler(h.isIOS||
h.isAndroid?"right":"innerRight",{styleClass:"ruler zoom"})}};t.ZoomRulerFactory=b;f.prototype={createAnnotationModel:function(a){return new m.AnnotationModel(a)},createAnnotationStyler:function(a,b){return new m.AnnotationStyler(a,b)},createAnnotationRulers:function(a){var b=new r.AnnotationRuler(a,"left",{styleClass:"ruler annotations"});a=new r.OverviewRuler(a,"right",{styleClass:"ruler overview"});return{annotationRuler:b,overviewRuler:a}}};t.AnnotationFactory=f;n.prototype={createTextDND:function(a,
b){return new c.TextDND(a.getTextView(),b)}};t.TextDNDFactory=n;return t});define("orion/editor/editorFeatures",["orion/editor/factories","orion/editor/actions","orion/editor/linkedMode","orion/objects"],function(p,s,r,m){return m.mixin({},p,s,r)});
(function(p,s){"function"===typeof define&&define.amd?define("orion/Deferred",s):"object"===typeof exports?module.exports=s():(p.orion=p.orion||{},p.orion.Deferred=s())})(this,function(){function p(){for(var h;h=c.shift();)h();k=!1}function s(l){c.push(l);k||(k=!0,h())}function r(c){return function(g){c(g)}}function m(){function c(){for(var a;a=h.shift();){var d=a.deferred,g="fulfilled"===f?"resolve":"reject";a=a[g];if("function"===typeof a)try{var k=a(b),l=k&&("object"===typeof k||"function"===typeof k)&&
k.then;if("function"===typeof l)if(k===d.promise)d.reject(new TypeError);else{var m=k.cancel;"function"===typeof m?d._parentCancel=m.bind(k):delete d._parentCancel;l.call(k,r(d.resolve),r(d.reject),r(d.progress))}else d.resolve(k)}catch(p){d.reject(p)}else d[g](b)}}function g(a){delete k._parentCancel;f="rejected";b=a;h.length&&s(c)}function d(a){function p(a){return function(b){(!f||"assumed"===f)&&a(b)}}delete k._parentCancel;try{var u=a&&("object"===typeof a||"function"===typeof a)&&a.then;if("function"===
typeof u)if(a===k)g(new TypeError);else{f="assumed";var r=a&&a.cancel;if("function"!==typeof r){var w=new m;a=w.promise;try{u(w.resolve,w.reject,w.progress)}catch(z){w.reject(z)}r=a.cancel;u=a.then}b=a;u.call(a,p(d),p(g));k._parentCancel=r.bind(a)}else f="fulfilled",b=a,h.length&&s(c)}catch(D){p(g)(D)}}function a(){var a=k._parentCancel;a?(delete k._parentCancel,a()):f||(a=Error("Cancel"),a.name="Cancel",g(a))}var b,f,h=[],k=this;this.resolve=function(a){f||d(a);return k};this.reject=function(a){f||
g(a);return k};this.progress=function(a){f||h.forEach(function(b){if(b.progress)try{b.progress(a)}catch(d){}});return k.promise};this.cancel=function(){k._parentCancel?setTimeout(a,0):a();return k};this.then=function(a,b,d){var g=new m;g._parentCancel=k.promise.cancel;h.push({resolve:a,reject:b,progress:d,deferred:g});("fulfilled"===f||"rejected"===f)&&s(c);return g.promise};this.promise={then:k.then,cancel:k.cancel}}var c=[],k=!1,h=function(){if("undefined"!==typeof process&&"function"===typeof process.nextTick){var c=
process.nextTick;return function(){c(p)}}if("function"===typeof MutationObserver){var g=document.createElement("div");(new MutationObserver(p)).observe(g,{attributes:!0});return function(){g.setAttribute("class","_tick")}}return function(){setTimeout(p,0)}}();m.all=function(c,g){function d(a,d){h||(f[a]=d,0===--b&&k.resolve(f))}function a(a,b){if(!h){if(g)try{d(a,g(b));return}catch(f){b=f}k.reject(b)}}var b=c.length,f=[],h=!1,k=new m;k.then(void 0,function(){h=!0;c.forEach(function(a){a.cancel&&a.cancel()})});
0===b?k.resolve(f):c.forEach(function(b,f){b.then(d.bind(void 0,f),a.bind(void 0,f))});return k.promise};m.when=function(c,g,d,a){var b;c&&"function"===typeof c.then||(b=new m,b.resolve(c),c=b.promise);return c.then(g,d,a)};return m});
define("orion/webui/littlelib",["orion/util"],function(p){function s(a,b){b||(b=document);return b.querySelectorAll(a)}function r(a){var b=a.tabIndex;0===b&&p.isIE&&!{a:!0,body:!0,button:!0,frame:!0,iframe:!0,img:!0,input:!0,isindex:!0,object:!0,select:!0,textarea:!0}[a.nodeName.toLowerCase()]&&!a.attributes.tabIndex&&(b=-1);return b}function m(a){if(0<=r(a))return a;if(a.hasChildNodes())for(var b=0;b<a.childNodes.length;b++){var d=m(a.childNodes[b]);if(d)return d}return null}function c(a){if(0<=
r(a))return a;if(a.hasChildNodes())for(var b=a.childNodes.length-1;0<=b;b--){var d=c(a.childNodes[b]);if(d)return d}return null}function k(a,b){if(3===a.nodeType){var d=h.exec(a.nodeValue);d&&1<d.length&&b(a,d)}if(a.hasChildNodes())for(d=0;d<a.childNodes.length;d++)k(a.childNodes[d],b)}var h=/\$\{([^\}]+)\}/,l=null,g={BKSPC:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DEL:46},d=Object.create(null);Object.keys(g).forEach(function(a){d[g[a]]=
a});return{$:function(a,b){b||(b=document);return b.querySelector(a)},$$:s,$$array:function(a,b){return Array.prototype.slice.call(s(a,b))},node:function(a){var b=a;"string"===typeof a&&(b=document.getElementById(a));return b},contains:function(a,b){if(!a||!b)return!1;if(a===b)return!0;var d=a.compareDocumentPosition(b);return Boolean(d&16)},bounds:function(a){a=a.getBoundingClientRect();return{left:a.left+document.documentElement.scrollLeft,top:a.top+document.documentElement.scrollTop,width:a.width,
height:a.height}},empty:function(a){for(;a.hasChildNodes();)a.removeChild(a.firstChild)},firstTabbable:m,lastTabbable:c,stop:function(a){window.document.all&&(a.keyCode=0);a.preventDefault&&(a.preventDefault(),a.stopPropagation())},processTextNodes:function(a,b){k(a,function(a,d){a.parentNode.replaceChild(document.createTextNode(b[d[1]]||d[1]),a)})},processDOMNodes:function(a,b){k(a,function(a,d){var g=b[d[1]];if(g){var e=document.createRange(),c=d.index;e.setStart(a,c);e.setEnd(a,c+d[0].length);
e.deleteContents();e.insertNode(g)}})},addAutoDismiss:function(a,b){function d(a){l.forEach(function(b){var e=!1,d=b.excludeNodes.some(function(b){return document.body.contains(b)?(e=!0,b.contains(a.target)):!1});if(e&&!d)try{b.dismiss(a)}catch(f){"undefined"!==typeof console&&console&&console.error(f&&f.message)}});l=l.filter(function(a){return a.excludeNodes.some(function(a){return document.body.contains(a)})})}null===l&&(l=[],document.addEventListener("click",d,!0),p.isIOS&&document.addEventListener("touchend",
function(a){function b(){a.target.removeEventListener("click",b)}0===a.touches.length&&a.target.addEventListener("click",b)},!1));l.push({excludeNodes:a,dismiss:b})},setFramesEnabled:function(a){for(var b=document.getElementsByTagName("iframe"),d=0;d<b.length;d++)b[d].parentNode.style.pointerEvents=a?"":"none"},getOffsetParent:function(a){a=a.parentNode;for(var b=document.documentElement;a&&a!==b;){var d=window.getComputedStyle(a,null);if(!d)break;d=d.getPropertyValue("overflow-y");if("auto"===d||
"scroll"===d)break;a=a.parentNode}return a},removeAutoDismiss:function(a){l=l.filter(function(b){return a!==b.dismiss})},keyName:function(a){return d[a]||null},KEY:g}});
define("orion/editor/contentAssist","i18n!orion/editor/nls/messages orion/keyBinding orion/editor/keyModes orion/editor/eventTarget orion/Deferred orion/objects orion/editor/util orion/util orion/webui/littlelib orion/metrics".split(" "),function(p,s,r,m,c,k,h,l,g,d){function a(a){this.textView=a;this.state=n.INACTIVE;this.clearProviders();var b=this;this._textViewListeners={onModelChanging:function(a){(this._latestModelChangingEvent=a)&&this._updateFilterText(a)}.bind(this),onSelection:function(a){this.isDeactivatingChange(this._latestModelChangingEvent,
a)?this.setState(n.INACTIVE):this.isActive()&&(this.state===n.ACTIVE&&this.setState(n.FILTERING),this.filterProposals());this._latestModelChangingEvent=null}.bind(this),onScroll:function(a){this.setState(n.INACTIVE)}.bind(this)};a.setKeyBinding(l.isMac?new s.KeyBinding(" ",!1,!1,!1,!0):new s.KeyBinding(" ",!0),"contentAssist");a.setKeyBinding(l.isMac?new s.KeyBinding(" ",!1,!1,!0,!0):new s.KeyBinding(" ",!0,!1,!0),"contentAssist");a.setAction("contentAssist",function(){a.getOptions("readonly")||b.activate();
return!0},{name:p.contentAssist,track:!0})}function b(a,b){var d=a.textView;r.KeyMode.call(this,d);this.contentAssist=a;this.widget=b;this.proposals=[];var f=this;this.contentAssist.addEventListener("ProposalsComputed",function(a){f.proposals=a.data.proposals;if(0===f.proposals.length)f.selectedIndex=-1,f.cancel();else{for(f.selectedIndex=0;f.proposals[f.selectedIndex]&&f.proposals[f.selectedIndex].unselectable;)f.selectedIndex++;if(f.proposals[f.selectedIndex]){if(f.widget){var b=!0;if(a.autoApply){for(a=
f.selectedIndex+1;f.proposals[a]&&f.proposals[a].unselectable;)a++;f.proposals[a]||(b=!1,f.contentAssist.apply(f.proposals[f.selectedIndex]))}b&&(f.widget.show(),f.widget.selectNode(f.selectedIndex))}}else f.selectedIndex=-1,f.cancel()}});d.setAction("contentAssistApply",function(){return this.enter()}.bind(this));d.setAction("contentAssistCancel",function(){return this.cancel()}.bind(this));d.setAction("contentAssistNextProposal",function(){return this.lineDown()}.bind(this));d.setAction("contentAssistPreviousProposal",
function(){return this.lineUp()}.bind(this));d.setAction("contentAssistNextPage",function(){return this.pageDown()}.bind(this));d.setAction("contentAssistPreviousPage",function(){return this.pageUp()}.bind(this));d.setAction("contentAssistHome",function(){this.widget&&this.widget.scrollIndex(0,!0);return this.lineDown(0)}.bind(this));d.setAction("contentAssistEnd",function(){return this.lineUp(this.proposals.length-1)}.bind(this));d.setAction("contentAssistTab",function(){return this.tab()}.bind(this));
this.widget&&(this.widget.setContentAssistMode(this),this.widget.createAccessible())}function f(a,b){this.contentAssist=a;this.textView=this.contentAssist.getTextView();this.isShowing=this.textViewListenerAdded=!1;var d=this.textView.getOptions("parent").ownerDocument;this.parentNode="string"===typeof b?d.getElementById(b):b;if(!this.parentNode){this.parentNode=l.createElement(d,"div");this.parentNode.className="contentassist";var f=d.getElementsByTagName("body")[0];if(f)f.appendChild(this.parentNode);
else throw Error("parentNode is required");}h.addEventListener(this.parentNode,"scroll",this.onScroll.bind(this));var g=this;this.textViewListener={onMouseDown:function(a){(a.event.target||a.event.srcElement).parentElement!==g.parentNode&&g.contentAssist.deactivate()}};this.contentAssist.addEventListener("Deactivating",function(a){g.hide()});this.scrollListener=function(a){g.isShowing&&g.position()};h.addEventListener(d,"scroll",this.scrollListener)}var n={INACTIVE:1,ACTIVE:2,FILTERING:3},t={selected:"selected",
hr:"proposal-hr",emphasis:"proposal-emphasis",noemphasis:"proposal-noemphasis",noemphasis_keyword:"proposal-noemphasis-keyword",noemphasis_title:"proposal-noemphasis-title",noemphasis_title_keywords:"proposal-noemphasis-title-keywords",dfault:"proposal-default"};a.prototype={apply:function(a){if(!a)return!1;var b=this.textView,f=b.getSelection(),g=this._initialCaretOffset,c=g,h=f=Math.max(f.start,f.end),k=b.getModel();k.getBaseModel&&(c=k.mapOffset(c),h=k.mapOffset(h),k=k.getBaseModel());a.overwrite&&
(g="string"===typeof a.prefix?c-a.prefix.length:this.getPrefixStart(k,c));c={proposal:a,start:c,end:h};this.setState(n.INACTIVE);b.setText("string"===typeof a?a:a.proposal,g,f);if(a.additionalEdits)for(f=0;f<a.additionalEdits.length;f++)g=a.additionalEdits[f],b.setText(g.text,g.offset,g.offset+g.length);this.dispatchEvent({type:"ProposalApplied",data:c});d.logEvent("editor","content assist proposal applied");return!0},activate:function(a,b){this.state===n.INACTIVE&&(this._autoTriggered=b?!0:!1,this.setState(n.ACTIVE,
a))},deactivate:function(){this.setState(n.INACTIVE)},getTextView:function(){return this.textView},isActive:function(){return this.state===n.ACTIVE||this.state===n.FILTERING},isDeactivatingChange:function(a,b){var d=!1;b.newValue.start<this._initialCaretOffset||!a?d=!0:a&&(d=0<a.removedLineCount||0<a.addedLineCount);return d},setState:function(a,b){var d;a===n.ACTIVE?(d="Activating",this._mode&&this._mode.setActive(!0)):a===n.INACTIVE&&(d="Deactivating",this._mode&&this._mode.setActive(!1));d&&this.dispatchEvent({type:d,
providers:b});this.state=a;this.onStateChange(a)},setMode:function(a){this._mode=a},onStateChange:function(a){a===n.INACTIVE?(this._removeTextViewListeners(),this._filterText="",this._initialCaretOffset=-1,this._computedProposals=null):a===n.ACTIVE&&(this._filterText="",this._addTextViewListeners(),this.computeProposals())},computeProposals:function(){var a=this.textView.getCaretOffset(),b=this.textView.getSelection(),b=Math.min(b.start,b.end);this._initialCaretOffset=Math.min(a,b);this._computedProposals=
null;this._computeProposals(this._initialCaretOffset).then(function(a){if(this.isActive()){var b=this._flatten(a);b&&(Array.isArray(b)&&0<b.length)&&(this._computedProposals=a);this.dispatchEvent({type:"ProposalsComputed",data:{proposals:b},autoApply:!this._autoTriggered});this._computedProposals&&this._filterText&&this.filterProposals(!0)}}.bind(this))},getPrefixStart:function(a,b){for(var d=b;0<d&&/[A-Za-z0-9_]/.test(a.getText(d-1,d));)d--;return d},handleError:function(a){"undefined"!==typeof console&&
(console.log("Error retrieving content assist proposals"),console.log(a&&a.stack))},initialize:function(){this._providers.forEach(function(a){a=a.provider;"function"===typeof a.initialize&&a.initialize()})},_computeProposals:function(a){var b=this._providers,d=this.textView,f=d.getSelection(),g=d.getModel(),h=a;g.getBaseModel&&(h=g.mapOffset(h),f.start=g.mapOffset(f.start),f.end=g.mapOffset(f.end),g=g.getBaseModel());a=g.getLine(g.getLineAtOffset(h));for(var n=0;n<a.length&&/\s/.test(a.charAt(n));)n++;
var n=a.substring(0,n),d=d.getOptions("tabSize","expandTab"),d=d.expandTab?Array(d.tabSize+1).join(" "):"\t",l={line:a,offset:h,prefix:g.getText(this.getPrefixStart(g,h),h),selection:f,delimiter:g.getLineDelimiter(),tab:d,indentation:n},m=this,b=b.map(function(a){a=a.provider;var b;try{var e,d;if(e=a.computeContentAssist){var f=m.editorContextProvider,n=f.getEditorContext();l=k.mixin(l,f.getOptions());d=e.apply(a,[n,l])}else if(e=a.getProposals||a.computeProposals)d=e.apply(a,[g.getText(),h,l]);b=
m.progress?m.progress.progress(d,"Generating content assist proposal"):d}catch(p){return(new c).reject(p)}return c.when(b)});return c.all(b,this.handleError)},filterProposals:function(a){if(this._computedProposals&&(this._latestModelChangingEvent||a)){a=this.textView.getModel();a.getBaseModel&&(a=a.getBaseModel());a=this.getPrefixStart(a,this._initialCaretOffset);var b=this.textView.getText(a,this._initialCaretOffset),d=b,f=[];this._computedProposals.forEach(function(a){a&&Array.isArray(a)&&(a=a.filter(function(a){if(!a)return!1;
d="string"===typeof a.prefix?a.prefix:b;if(t[a.style]===t.hr||t[a.style]===t.noemphasis_title)return!0;var e="";if(a.overwrite){if(a.name)e=a.name;else if(a.proposal)e=a.proposal;else return!1;return 0===e.indexOf(d+this._filterText)}return a.name||a.proposal?(e=!1,a.name&&(e=0===a.name.indexOf(d+this._filterText)),!e&&a.proposal&&(e=0===a.proposal.indexOf(this._filterText)),e):"string"===typeof a?0===a.indexOf(this._filterText):!1},this),0<a.length&&f.push(a))},this);a=[];f&&(f=this._removeExtraUnselectableElements(f),
a=this._flatten(f));this.dispatchEvent({type:"ProposalsComputed",data:{proposals:a},autoApply:!1})}},_removeExtraUnselectableElements:function(a){return a.map(function(a){return a.filter(function(b,e){var d=!0;if(t[b.style]===t.hr)0===e||a.length-1===e?d=!1:t.hr===t[a[e-1].style]&&(d=!1);else if(t[b.style]===t.noemphasis_title){var f=a[e+1];f?t[f.style]===t.noemphasis_title&&(d=!1):d=!1}return d})})},setEditorContextProvider:function(a){this.editorContextProvider=a},_generateProviderId:function(){this._idcount?
this._idcount++:this._idcount=0;return"ContentAssistGeneratedID_"+this._idcount},setAutoTriggerEnabled:function(a){this._autoTriggerEnabled=a;this._updateAutoTriggerListenerState()},setProviders:function(a){var b=this;this.setProviderInfoArray(a.map(function(a){return a.id?a:{provider:a,id:b._generateProviderId()}}))},setProviderInfoArray:function(a){this.clearProviders();this._providers=a;this._charTriggersInstalled=a.some(function(a){return a.charTriggers});this._updateAutoTriggerListenerState()},
getProviders:function(){return this._providers.slice()},clearProviders:function(){this._providers=[];this._charTriggersInstalled=!1;this._updateAutoTriggerListenerState()},setProgress:function(a){this.progress=a},setStyleAccessor:function(a){this._styleAccessor=a},_flatten:function(a){return a.reduce(function(a,b){var e=a,d=null;b&&Array.isArray(b)&&(d=b.filter(function(a){return a}));if(d&&Array.isArray(d)&&0<d.length){var e=d,f=a,g=d[0].style;g&&0===t[g].indexOf(t.noemphasis)&&(e=a,f=d);0<e.length&&
(d=e[e.length-1].style)&&t.hr!==t[d]&&(e=e.concat({proposal:"",name:"",description:"---------------------------------",style:"hr",unselectable:!0}));e=e.concat(f)}return e},[])},_triggerListener:function(){var a=this.textView.getCaretOffset(),b=null,d=[];if(this._charTriggersInstalled){var f=this.textView.getText(a-1,a);this._providers.forEach(function(g){var c=g.charTriggers;if(c&&c.test(f)){var c=!1,h=g.excludedStyles;this._styleAccessor&&h&&(b||(b=this._styleAccessor.getStyles(a-1)),c=b.some(function(a){return h.test(a.style)}));
c||d.push(g)}},this);0<d.length&&this.activate(d,!0)}},_updateAutoTriggerListenerState:function(){this._boundTriggerListener||(this._boundTriggerListener=this._triggerListener.bind(this));if(this._triggerListenerInstalled){if(!this._autoTriggerEnabled||!this._charTriggersInstalled)this.textView.removeEventListener("Modify",this._boundTriggerListener),this._triggerListenerInstalled=!1}else this._autoTriggerEnabled&&this._charTriggersInstalled&&(this.textView.addEventListener("Modify",this._boundTriggerListener),
this._triggerListenerInstalled=!0)},_addTextViewListeners:function(){this._textViewListenersAdded||(this.textView.addEventListener("ModelChanging",this._textViewListeners.onModelChanging),this.textView.addEventListener("Scroll",this._textViewListeners.onScroll),this.textView.addEventListener("Selection",this._textViewListeners.onSelection),this._textViewListenersAdded=!0)},_removeTextViewListeners:function(){this._textViewListenersAdded&&(this._latestModelChangingEvent=null,this.textView.removeEventListener("ModelChanging",
this._textViewListeners.onModelChanging),this.textView.removeEventListener("Scroll",this._textViewListeners.onScroll),this.textView.removeEventListener("Selection",this._textViewListeners.onSelection),this._textViewListenersAdded=!1)},_updateFilterText:function(a){var b=a.removedCharCount;b&&(this._filterText=this._filterText.substring(0,this._filterText.length-b));if(a=a.text)this._filterText=this._filterText.concat(a)}};m.EventTarget.addMixin(a.prototype);b.prototype=new r.KeyMode;k.mixin(b.prototype,
{createKeyBindings:function(){var a=s.KeyBinding,b=[];b.push({actionID:"contentAssistApply",keyBinding:new a(13)});b.push({actionID:"contentAssistCancel",keyBinding:new a(27)});b.push({actionID:"contentAssistNextProposal",keyBinding:new a(40)});b.push({actionID:"contentAssistPreviousProposal",keyBinding:new a(38)});b.push({actionID:"contentAssistNextPage",keyBinding:new a(34)});b.push({actionID:"contentAssistPreviousPage",keyBinding:new a(33)});b.push({actionID:"contentAssistHome",keyBinding:new a(g.KEY.HOME)});
b.push({actionID:"contentAssistEnd",keyBinding:new a(g.KEY.END)});b.push({actionID:"contentAssistTab",keyBinding:new a(9)});return b},cancel:function(){this.getContentAssist().deactivate()},getContentAssist:function(){return this.contentAssist},getProposals:function(){return this.proposals},isActive:function(){return this.getContentAssist().isActive()},setActive:function(a){a?this.contentAssist.textView.addKeyMode(this):this.contentAssist.textView.removeKeyMode(this)},lineUp:function(a,b){return this.selectNew(a,
b,!1)},lineDown:function(a,b){return this.selectNew(a,b,!0)},selectNew:function(a,b,d){if(d){if(void 0===a&&(a=this.selectedIndex+1),a>=this.proposals.length){if(b)return!0;a=0}}else if(void 0===a&&(a=this.selectedIndex-1),0>a){if(b)return!0;a=this.proposals.length-1}for(var f=a;this.proposals[a]&&this.proposals[a].unselectable;){if(d){if(a++,a>=this.proposals.length){if(b)return!0;a=0}}else if(a--,0>a){if(b)return!0;a=this.proposals.length-1}if(a===f){a=-1;break}}this.selectedIndex=a;this.widget&&
this.widget.selectNode(a);return!0},pageUp:function(){if(this.widget){var a=this.widget.getTopIndex();a===this.selectedIndex&&(this.widget.scrollIndex(a,!1),a=this.widget.getTopIndex());return 0===a?this.lineDown(a,!0):this.lineUp(a,!0)}return this.lineUp()},pageDown:function(){if(this.widget){var a=this.widget.getBottomIndex();a===this.selectedIndex&&(this.widget.scrollIndex(a,!0),a=this.widget.getBottomIndex());return this.lineDown(a,!0)}return this.lineDown()},enter:function(){return this.contentAssist.apply(this.proposals[this.selectedIndex]||
null)},tab:function(){return this.widget?(this.widget.parentNode.focus(),!0):!1}});f.prototype={onClick:function(a){a||(a=window.event);this.contentAssist.apply(this.getProposal(a.target||a.srcElement));this.textView.focus()},onScroll:function(a){this.previousCloneNode&&!this.preserveCloneThroughScroll&&(this._removeCloneNode(),this.previousSelectedNode.classList.add(t.selected));this.preserveCloneThroughScroll=!1},createDiv:function(a,b,d){var f=b.ownerDocument,g=l.createElement(f,"div");g.id="contentoption"+
d;g.setAttribute("role","option");g.className=t[a.style]?t[a.style]:t.dfault;"hr"===a.style?a=l.createElement(f,"hr"):(a=this._createDisplayNode(g,a,d),g.contentAssistProposalIndex=d);g.appendChild(a);b.appendChild(g)},createAccessible:function(){var a=this._contentAssistMode,b=this;h.addEventListener(this.parentNode,"keydown",function(d){d||(d=window.event);d.preventDefault&&d.preventDefault();return d.keyCode===g.KEY.ESCAPE?a.cancel():d.keyCode===g.KEY.UP?a.lineUp():d.keyCode===g.KEY.DOWN?a.lineDown():
d.keyCode===g.KEY.ENTER?a.enter():d.keyCode===g.KEY.PAGEDOWN?a.pageDown():d.keyCode===g.KEY.PAGEUP?a.pageUp():d.keyCode===g.KEY.HOME?(b.scrollIndex(0,!0),a.lineDown(0)):d.keyCode===g.KEY.END?a.lineUp(a.getProposals().length-1):!1})},_createDisplayNode:function(a,b,d){var f=null,g=null;if("string"===typeof b)g=b;else if(b.description&&"string"===typeof b.description)if(b.name&&"string"===typeof b.name){var c=this._createNameNode(b.name);c.contentAssistProposalIndex=d;f=document.createElement("span");
f.appendChild(c);c=document.createTextNode(b.description);f.appendChild(c);a.setAttribute("title",b.name+b.description)}else g=b.description;else g=b.proposal;g&&(f=this._createNameNode(g),a.setAttribute("title",g));f.contentAssistProposalIndex=d;return f},_createNameNode:function(a){var b=document.createElement("span");b.classList.add("proposal-name");b.appendChild(document.createTextNode(a));return b},getProposal:function(a){var b=null;a=a.contentAssistProposalIndex;void 0!==a&&(b=this._contentAssistMode.getProposals()[a]||
null);return b},getTopIndex:function(){for(var a=this.parentNode.childNodes,b=0;b<a.length;b++)if(a[b].offsetTop>=this.parentNode.scrollTop)return b;return 0},getBottomIndex:function(){for(var a=this.parentNode.childNodes,b=0;b<a.length;b++){var d=a[b];if(d.offsetTop+d.offsetHeight>this.parentNode.scrollTop+this.parentNode.clientHeight)return Math.max(0,b-1)}return a.length-1},scrollIndex:function(a,b){this.parentNode.childNodes[a].scrollIntoView(b);this.preserveCloneThroughScroll=!0},selectNode:function(a){var b=
null;this.previousSelectedNode&&(this.previousSelectedNode.classList.remove(t.selected),this.previousSelectedNode=null,this.previousCloneNode&&this._removeCloneNode());if(-1!==a){b=this.parentNode.childNodes[a];b.classList.add(t.selected);this.parentNode.setAttribute("aria-activedescendant",b.id);b.focus();b.offsetTop<this.parentNode.scrollTop?(b.scrollIntoView(!0),this.preserveCloneThroughScroll=!0):b.offsetTop+b.offsetHeight>this.parentNode.scrollTop+this.parentNode.clientHeight&&(b.scrollIntoView(!1),
this.preserveCloneThroughScroll=!0);var d=g.bounds(b.firstChild||b),f=g.bounds(this.parentNode);a=window.getComputedStyle(this.parentNode);var c=window.getComputedStyle(b),c=parseInt(a.paddingLeft)+parseInt(a.paddingRight)+parseInt(c.paddingLeft)+parseInt(c.paddingRight);if(d.width>=f.width-c){c=parseInt(a.top);f=b.cloneNode(!0);f.classList.add("cloneProposal");f.style.top=c+b.offsetTop-this.parentNode.scrollTop+"px";f.style.left=a.left;f.setAttribute("id",f.id+"_clone");d=d.left+d.width-parseInt(document.documentElement.clientWidth);
0<d&&(a=parseInt(a.left)-d,0>a&&(a=0),f.style.left=a+"px");a=document.createElement("div");a.id="clone_contentassist";a.classList.add("contentassist");a.classList.add("cloneWrapper");a.appendChild(f);a.onclick=this.parentNode.onclick;this.parentNode.parentNode.insertBefore(a,this.parentNode);var h=function(a){a.contentAssistProposalIndex=b.contentAssistProposalIndex;if(a.hasChildNodes())for(var d=0;d<a.childNodes.length;d++)h(a.childNodes[d])};h(a);b.classList.remove(t.selected);this.previousCloneNode=
a}}this.previousSelectedNode=b},setContentAssistMode:function(a){this._contentAssistMode=a},show:function(){var a=this._contentAssistMode.getProposals();if(0===a.length)this.hide();else{this.parentNode.innerHTML="";for(var b=0;b<a.length;b++)this.createDiv(a[b],this.parentNode,b);this.position();this.parentNode.onclick=this.onClick.bind(this);this.isShowing=!0;this.textViewListenerAdded||(this.textView.addEventListener("MouseDown",this.textViewListener.onMouseDown),this.textViewListenerAdded=!0)}},
hide:function(){this.parentNode.ownerDocument.activeElement===this.parentNode&&this.textView.focus();this.parentNode.style.display="none";this.parentNode.onclick=null;this.isShowing=!1;this.textViewListenerAdded&&(this.textView.removeEventListener("MouseDown",this.textViewListener.onMouseDown),this.textViewListenerAdded=!1);this.previousSelectedNode&&(this.previousSelectedNode=null,this.previousCloneNode&&this._removeCloneNode())},position:function(){var a=this.contentAssist,b=this.textView;if(void 0!==
a.offset){var a=a.offset,d=b.getModel();d.getBaseModel&&(a=d.mapOffset(a,!0))}else a=this.textView.getCaretOffset();a=b.getLocationAtOffset(a);a.y+=b.getLineHeight();this.textView.convert(a,"document","page");this.parentNode.style.position="fixed";this.parentNode.style.left=a.x+"px";this.parentNode.style.top=a.y+"px";this.parentNode.style.display="block";this.parentNode.scrollTop=0;d=this.parentNode.ownerDocument;b=d.documentElement.clientWidth;d=d.documentElement.clientHeight-a.y;if(this.parentNode.offsetHeight>
d){var f=a.y-this.textView.getLineHeight();this.parentNode.offsetHeight>f?d>f?this.parentNode.style.maxHeight=d+"px":(this.parentNode.style.maxHeight=f+"px",this.parentNode.style.top="0"):(this.parentNode.style.top=a.y-this.parentNode.offsetHeight-this.textView.getLineHeight()+"px",this.parentNode.style.maxHeight=f+"px")}else this.parentNode.style.maxHeight=d+"px";a.x+this.parentNode.offsetWidth>b?(a=b-this.parentNode.offsetWidth,0>a&&(a=0),this.parentNode.style.left=a+"px",this.parentNode.style.maxWidth=
b-a):this.parentNode.style.maxWidth=b+a.x+"px"},_removeCloneNode:function(){this.parentNode.parentNode.contains(this.previousCloneNode)&&this.parentNode.parentNode.removeChild(this.previousCloneNode);this.previousCloneNode=null}};return{ContentAssist:a,ContentAssistMode:b,ContentAssistWidget:f}});
define("orion/editor/stylers/lib/syntax",[],function(){return{id:"orion.lib",grammars:[{id:"orion.lib",repository:{brace_open:{match:"{",name:"punctuation.section.block.begin"},brace_close:{match:"}",name:"punctuation.section.block.end"},bracket_open:{match:"\\[",name:"punctuation.section.bracket.begin"},bracket_close:{match:"\\]",name:"punctuation.section.bracket.end"},parenthesis_open:{match:"\\(",name:"punctuation.section.parens.begin"},parenthesis_close:{match:"\\)",name:"punctuation.section.parens.end"},
doc_block:{begin:{match:"/\\*\\*",literal:"/**"},end:{match:"\\*/",literal:"*/"},name:"comment.block.documentation",patterns:[{match:"@(?:(?!\\*/)\\S)*",name:"meta.documentation.annotation"},{match:"\\\x3c\\S*\\\x3e",name:"meta.documentation.tag"},{match:"(\\b)(TODO)(\\b)(((?!\\*/).)*)",name:"meta.annotation.task.todo",captures:{2:{name:"keyword.other.documentation.task"},4:{name:"comment.block"}}}]},number_decimal:{match:"\\b-?(?:\\.\\d+|\\d+\\.?\\d*)(?:[eE][+-]?\\d+)?\\b",name:"constant.numeric.number"},
number_hex:{match:"\\b0[xX][0-9A-Fa-f]+\\b",name:"constant.numeric.hex"},string_doubleQuote:{match:'"(?:\\\\.|[^"])*"?',name:"string.quoted.double"},string_singleQuote:{match:"'(?:\\\\.|[^'])*'?",name:"string.quoted.single"},todo_comment_singleLine:{match:"(\\b)(TODO)(\\b)(.*)",name:"meta.annotation.task.todo",captures:{2:{name:"keyword.other.documentation.task"},4:{name:"comment.line"}}}}},{id:"orion.c-like",repository:{comment_singleLine:{match:{match:"//.*",literal:"//"},name:"comment.line.double-slash",
patterns:[{include:"orion.lib#todo_comment_singleLine"}]},comment_block:{begin:{match:"/\\*",literal:"/*"},end:{match:"\\*/",literal:"*/"},name:"comment.block",patterns:[{match:"(\\b)(TODO)(\\b)(((?!\\*/).)*)",name:"meta.annotation.task.todo",captures:{2:{name:"keyword.other.documentation.task"},4:{name:"comment.block"}}}]}}}],keywords:[]}});
define("orion/editor/stylers/text_css/syntax",["orion/editor/stylers/lib/syntax"],function(p){var s="alignment-adjust alignment-baseline animation-delay animation-direction animation-duration animation-iteration-count animation-name animation-play-state animation-timing-function animation appearance azimuth backface-visibility background-attachment background-clip background-color background-image background-origin background-position background-repeat background-size background baseline-shift binding bleed bookmark-label bookmark-level bookmark-state bookmark-target border-bottom-color border-bottom-left-radius border-bottom-right-radius border-bottom-style border-bottom-width border-bottom border-collapse border-color border-image-outset border-image-repeat border-image-slice border-image-source border-image-width border-image border-left-color border-left-style border-left-width border-left border-radius border-right-color border-right-style border-right-width border-right border-spacing border-style border-top-color border-top-left-radius border-top-right-radius border-top-style border-top-width border-top border-width border bottom box-align box-decoration-break box-direction box-flex-group box-flex box-lines box-ordinal-group box-orient box-pack box-shadow box-sizing break-after break-before break-inside caption-side clear clip color-profile color column-count column-fill column-gap column-rule-color column-rule-style column-rule-width column-rule column-span column-width columns content counter-increment counter-reset crop cue-after cue-before cue cursor direction display dominant-baseline drop-initial-after-adjust drop-initial-after-align drop-initial-before-adjust drop-initial-before-align drop-initial-size drop-initial-value elevation empty-cells fit-position fit flex-align flex-flow flex-inline-pack flex-order flex-pack float-offset float font-family font-size font-size-adjust font-stretch font-style font-variant font-weight font grid-columns grid-rows hanging-punctuation height hyphenate-after hyphenate-before hyphenate-character hyphenate-lines hyphenate-resource hyphens icon image-orientation image-rendering image-resolution inline-box-align left letter-spacing line-height line-stacking-ruby line-stacking-shift line-stacking-strategy line-stacking list-style-image list-style-position list-style-type list-style margin-bottom margin-left margin-right margin-top margin mark-after mark-before mark marker-offset marks marquee-direction marquee-loop marquee-play-count marquee-speed marquee-style max-height max-width min-height min-width move-to nav-down nav-index nav-left nav-right nav-up opacity orphans outline-color outline-offset outline-style outline-width outline overflow-style overflow-x overflow-y overflow padding-bottom padding-left padding-right padding-top padding page-break-after page-break-before page-break-inside page-policy page pause-after pause-before pause perspective-origin perspective phonemes pitch-range pitch play-during position presentation-level punctuation-trim quotes rendering-intent resize rest-after rest-before rest richness right rotation-point rotation ruby-align ruby-overhang ruby-position ruby-span size speak-header speak-numeral speak-punctuation speak speech-rate stress string-set table-layout target-name target-new target-position target text-align-last text-align text-decoration text-emphasis text-height text-indent text-justify text-outline text-shadow text-transform text-wrap top transform-origin transform-style transform transition-delay transition-duration transition-property transition-timing-function transition unicode-bidi vertical-align visibility voice-balance voice-duration voice-family voice-pitch-range voice-pitch voice-rate voice-stress voice-volume volume white-space-collapse white-space widows width word-break word-spacing word-wrap z-index".split(" ");p=
p.grammars;p.push({id:"orion.css",contentTypes:["text/css"],patterns:[{begin:"'(?:\\\\.|[^\\\\'])*\\\\$",end:"^(?:$|(?:\\\\.|[^\\\\'])*('|[^\\\\]$))",name:"string.quoted.single.css"},{begin:'"(?:\\\\.|[^\\\\"])*\\\\$',end:'^(?:$|(?:\\\\.|[^\\\\"])*("|[^\\\\]$))',name:"string.quoted.double.css"},{include:"orion.lib#string_doubleQuote"},{include:"orion.lib#string_singleQuote"},{include:"orion.c-like#comment_block"},{include:"orion.lib#brace_open"},{include:"orion.lib#brace_close"},{include:"orion.lib#bracket_open"},
{include:"orion.lib#bracket_close"},{include:"orion.lib#parenthesis_open"},{include:"orion.lib#parenthesis_close"},{include:"orion.lib#number_decimal"},{include:"#number_hex"},{match:"(?i)\\b-?(?:\\.\\d+|\\d+\\.?\\d*)(?:%|em|ex|ch|rem|vw|vh|vmin|vmax|in|cm|mm|pt|pc|px|deg|grad|rad|turn|s|ms|Hz|kHz|dpi|dpcm|dppx)?\\b",name:"constant.numeric.value.css"},{match:"(?:-webkit-|-moz-|-ms-|-o-|\\b)(?:"+s.join("|")+")\\b",name:"support.type.propertyName.css"}],repository:{number_hex:{match:"#[0-9A-Fa-f]+\\b",
name:"constant.numeric.hex.css"}}});return{id:p[p.length-1].id,grammars:p,keywords:s}});
define("webtools/cssContentAssist",["orion/editor/templates","orion/editor/stylers/text_css/syntax"],function(p,s){function r(a){return JSON.stringify(a).replace("}","\\}")}function m(){}for(var c={type:"link",values:"visible hidden scroll auto no-display no-content".split(" ")},k={type:"link",values:"solid dashed dotted double groove ridge inset outset".split(" ")},h={type:"link",values:[]},l=0;10>l;l++)h.values.push(l.toString());for(var g={type:"link",values:"black white red green blue magenta yellow cyan grey darkred darkgreen darkblue darkmagenta darkcyan darkyellow darkgray lightgray".split(" ")},
d=[{prefix:"rule",description:"rule - class selector rule",template:".${class} {\n\t${cursor}\n}"},{prefix:"rule",description:"rule - id selector rule",template:"#${id} {\n\t${cursor}\n}"},{prefix:"outline",description:"outline - outline style",template:"outline: ${color:"+r(g)+"} ${style:"+r(k)+"} ${width:"+r(h)+"}px;"},{prefix:"background-image",description:"background-image - image style",template:'background-image: url("${uri}");'},{prefix:"url",description:"url - url image",template:'url("${uri}");'},
{prefix:"rgb",description:"rgb - rgb color",template:"rgb(${red},${green},${blue});"},{prefix:"@import",description:"import - import style sheet",template:'@import "${uri}";'},{prefix:"csslint",description:"csslint - add embedded rule severity",template:"/*csslint ${:"+r({type:"link",values:"adjoining-classes box-model box-sizing bulletproof-font-face compatible-vendor-prefixes display-property-grouping duplicate-background-images duplicate-properties empty-rules fallback-colors floats font-faces font-sizes gradients ids import important known-properties outline-none overqualified-elements qualified-headings regex-selectors rules-count selector-max-approaching selector-max shorthand star-property-hack text-indent underscore-property-hack unique-headings universal-selector unqualified-attributes vendor-prefix zero-units".split(" ")})+
"}: ${a:"+r({type:"link",values:["false","true","0","1","2"]})+"} */"}],a=[{prop:"display",values:{type:"link",values:"none block box flex inline inline-block inline-flex inline-table list-item table table-caption table-cell table-column table-column-group table-footer-group table-header-group table-row table-row-group inherit".split(" ")}},{prop:"overflow",values:c},{prop:"overflow-x",values:c},{prop:"overflow-y",values:c},{prop:"float",values:{type:"link",values:["left","right","none","inherit"]}},
{prop:"position",values:{type:"link",values:["absolute","fixed","relative","static","inherit"]}},{prop:"cursor",values:{type:"link",values:"auto crosshair default e-resize help move n-resize ne-resize nw-resize pointer progress s-resize se-resize sw-resize text w-resize wait inherit".split(" ")}},{prop:"color",values:g},{prop:"border-top-color",values:g},{prop:"border-bottom-color",values:g},{prop:"border-right-color",values:g},{prop:"border-left-color",values:g},{prop:"background-color",values:g},
{prop:"font-style",values:{type:"link",values:["italic","normal","oblique","inherit"]}},{prop:"font-weight",values:{type:"link",values:"bold normal bolder lighter 100 200 300 400 500 600 700 800 900 inherit".split(" ")}},{prop:"white-space",values:{type:"link",values:"pre pre-line pre-wrap nowrap normal inherit".split(" ")}},{prop:"word-wrap",values:{type:"link",values:["normal","break-word"]}},{prop:"visibility",values:{type:"link",values:["hidden","visible","collapse","inherit"]}}],l=0;l<a.length;l++)c=
a[l],d.push({prefix:c.prop,description:c.prop+" - "+c.prop+" style",template:c.prop+": ${value:"+r(c.values)+"};"});a="width height top bottom left right min-width min-height max-width max-height margin padding padding-left padding-right padding-top padding-bottom margin-left margin-top margin-bottom margin-right".split(" ");for(l=0;l<a.length;l++)c=a[l],d.push({prefix:c,description:c+" - "+c+" pixel style",template:c+": ${value}px;"});a=["padding","margin"];for(l=0;l<a.length;l++)c=a[l],d.push({prefix:c,
description:c+" - "+c+" top right bottom left style",template:c+": ${top}px ${left}px ${bottom}px ${right}px;"}),d.push({prefix:c,description:c+" - "+c+" top right,left bottom style",template:c+": ${top}px ${right_left}px ${bottom}px;"}),d.push({prefix:c,description:c+" - "+c+" top,bottom right,left style",template:c+": ${top_bottom}px ${right_left}px"});a=["border","border-top","border-bottom","border-left","border-right"];for(l=0;l<a.length;l++)c=a[l],d.push({prefix:c,description:c+" - "+c+" style",
template:c+": ${width:"+r(h)+"}px ${style:"+r(k)+"} ${color:"+r(g)+"};"});m.prototype=new p.TemplateContentAssist(s.keywords,d);m.prototype.getPrefix=function(a,d,g){for(g=d;g&&/[A-Za-z\-\@]/.test(a.charAt(g-1));)g--;return 0<=g?a.substring(g,d):""};return{CssContentAssistProvider:m}});
define("webtools/htmlContentAssist",["orion/editor/templates"],function(p){function s(){}var r=new p.Template("","Simple HTML document",'\x3c!DOCTYPE html\x3e\n\x3chtml lang\x3d"en"\x3e\n\t\x3chead\x3e\n\t\t\x3cmeta charset\x3dutf-8\x3e\n\t\t\x3ctitle\x3e${title}\x3c/title\x3e\n\t\x3c/head\x3e\n\t\x3cbody\x3e\n\t\t\x3ch1\x3e${header}\x3c/h1\x3e\n\t\t\x3cp\x3e\n\t\t\t${cursor}\n\t\t\x3c/p\x3e\n\t\x3c/body\x3e\n\x3c/html\x3e'),m=[{prefix:"\x3cimg",name:"\x3cimg\x3e",description:" - HTML image element",
template:'\x3cimg src\x3d"${URI}" alt\x3d"${Image}"/\x3e'},{prefix:"\x3ca",name:"\x3ca\x3e",description:" - HTML anchor element",template:'\x3ca href\x3d"${cursor}"\x3e\x3c/a\x3e'},{prefix:"\x3cul",name:"\x3cul\x3e",description:" - HTML unordered list",template:"\x3cul\x3e\n\t\x3cli\x3e${cursor}\x3c/li\x3e\n\x3c/ul\x3e"},{prefix:"\x3col",name:"\x3col\x3e",description:" - HTML ordered list",template:"\x3col\x3e\n\t\x3cli\x3e${cursor}\x3c/li\x3e\n\x3c/ol\x3e"},{prefix:"\x3cdl",name:"\x3cdl\x3e",description:" - HTML definition list",
template:"\x3cdl\x3e\n\t\x3cdt\x3e${cursor}\x3c/dt\x3e\n\t\x3cdd\x3e\x3c/dd\x3e\n\x3c/dl\x3e"},{prefix:"\x3ctable",name:"\x3ctable\x3e",description:" - basic HTML table",template:"\x3ctable\x3e\n\t\x3ctr\x3e\n\t\t\x3ctd\x3e${cursor}\x3c/td\x3e\n\t\x3c/tr\x3e\n\x3c/table\x3e"},{prefix:"\x3c!--",name:"\x3c!-- --\x3e",description:" - HTML comment",template:"\x3c!-- ${cursor} --\x3e"}],c,k,h,l,g="abbr b button canvas cite command dd del dfn dt em embed font h1 h2 h3 h4 h5 h6 i ins kbd label li mark meter object option output progress q rp rt samp small strong sub sup td time title tt u var".split(" ");
for(l=0;l<g.length;l++)c=g[l],h="\x3c"+c+"\x3e\x3c/"+c+"\x3e",k="\x3c"+c+"\x3e${cursor}\x3c/"+c+"\x3e",m.push({prefix:"\x3c"+c,description:h,template:k});g="address article aside audio bdo blockquote body caption code colgroup datalist details div fieldset figure footer form head header hgroup iframe legend map menu nav noframes noscript optgroup p pre ruby script section select span style tbody textarea tfoot th thead tr video".split(" ");for(l=0;l<g.length;l++)c=g[l],h="\x3c"+c+"\x3e\x3c/"+c+"\x3e",
k="\x3c"+c+"\x3e\n\t${cursor}\n\x3c/"+c+"\x3e",m.push({prefix:"\x3c"+c,description:h,template:k});g="area base br col hr input link meta param keygen source".split(" ");for(l=0;l<g.length;l++)c=g[l],k=h="\x3c"+c+"/\x3e",m.push({prefix:"\x3c"+c,description:h,template:k});s.prototype=new p.TemplateContentAssist([],m);s.prototype.getPrefix=function(d,a,b){b="";for(var f=a;f&&/[A-Za-z0-9<!-]/.test(d.charAt(f-1));)if(f--,"\x3c"===d.charAt(f)){b=d.substring(f,a);break}return b};s.prototype.computeProposals=
function(d,a,b){return 0===d.length?[r.getProposal("",a,b)]:p.TemplateContentAssist.prototype.computeProposals.call(this,d,a,b).sort(function(a,b){var d=a.prefix||a.proposal,e=b.prefix||b.proposal;if(d){if(!e)return 1}else return-1;return d.toLowerCase().localeCompare(e.toLowerCase())})};return{HTMLContentAssistProvider:s}});
define("orion/editor/AsyncStyler",["i18n!orion/editor/nls/messages","orion/editor/annotations"],function(p,s){function r(h){return-1!==h.getProperty("objectClass").indexOf(c)&&"highlighter"===h.getProperty("type")}function m(c,k,g){this.initialize(c,k,g);this.lineStyles=[]}var c="orion.edit.highlighter",k=c+" service must be an event emitter";s.AnnotationType.registerType("orion.annotation.highlightError",{title:p.syntaxError,html:"\x3cdiv class\x3d'annotationHTML error'\x3e\x3c/div\x3e",rangeStyle:{styleClass:"annotationRange error"}});
m.prototype={initialize:function(h,k,g){this.textView=h;this.serviceRegistry=k;this.annotationModel=g;this.services=[];var d=this;this.listener={onModelChanging:function(a){d.onModelChanging(a)},onModelChanged:function(a){d.onModelChanged(a)},onDestroy:function(a){d.onDestroy(a)},onLineStyle:function(a){d.onLineStyle(a)},onStyleReady:function(a){d.onStyleReady(a)},onServiceAdded:function(a){d.onServiceAdded(a.serviceReference,d.serviceRegistry.getService(a.serviceReference))},onServiceRemoved:function(a){d.onServiceRemoved(a.serviceReference,
d.serviceRegistry.getService(a.serviceReference))}};h.addEventListener("ModelChanging",this.listener.onModelChanging);h.addEventListener("ModelChanged",this.listener.onModelChanged);h.addEventListener("Destroy",this.listener.onDestroy);h.addEventListener("LineStyle",this.listener.onLineStyle);k.addEventListener("registered",this.listener.onServiceAdded);k.addEventListener("unregistering",this.listener.onServiceRemoved);h=k.getServiceReferences(c);for(g=0;g<h.length;g++){var a=h[g];r(a)&&this.addServiceListener(k.getService(a))}},
onDestroy:function(c){this.destroy()},destroy:function(){this.textView&&(this.textView.removeEventListener("ModelChanging",this.listener.onModelChanging),this.textView.removeEventListener("ModelChanged",this.listener.onModelChanged),this.textView.removeEventListener("Destroy",this.listener.onDestroy),this.textView.removeEventListener("LineStyle",this.listener.onLineStyle),this.textView=null);if(this.services){for(var c=0;c<this.services.length;c++)this.removeServiceListener(this.services[c]);this.services=
null}this.serviceRegistry&&(this.serviceRegistry.removeEventListener("registered",this.listener.onServiceAdded),this.serviceRegistry.removeEventListener("unregistering",this.listener.onServiceRemoved),this.serviceRegistry=null);this.lineStyles=this.listener=null},onModelChanging:function(c){this.startLine=this.textView.getModel().getLineAtOffset(c.start)},onModelChanged:function(c){var k=this.startLine;(c.addedLineCount||c.removedLineCount)&&Array.prototype.splice.apply(this.lineStyles,[k,c.removedLineCount].concat(this._getEmptyStyle(c.addedLineCount)))},
onStyleReady:function(c){var k=c.lineStyles||c.style;c=Number.MAX_VALUE;var g=-1,d=this.textView.getModel(),a;for(a in k)Object.prototype.hasOwnProperty.call(k,a)&&(this.lineStyles[a]=k[a],c=Math.min(c,a),g=Math.max(g,a));c=Math.max(c,0);g=Math.min(g,d.getLineCount());if(k=this.annotationModel){for(var b=k.getAnnotations(d.getLineStart(c),d.getLineEnd(g)),f=[];b.hasNext();){var n=b.next();"orion.annotation.highlightError"===n.type&&f.push(n)}b=[];for(n=c;n<=g;n++){a=n;var m=this.lineStyles[a],m=m&&
m.errors;a=d.getLineStart(a);if(m)for(var e=0;e<m.length;e++){var p=m[e];b.push(s.AnnotationType.createAnnotation("orion.annotation.highlightError",p.start+a,p.end+a))}}k.replaceAnnotations(f,b)}this.textView.redrawLines(c,g+1)},onLineStyle:function(c){var k=this.lineStyles[c.lineIndex];if(k)if(k.ranges){for(var k=k.ranges,g=c.lineStart,d=k.length,a=[],b=0;b<d;b++){var f=k[b];a.push({start:f.start+g,end:f.end+g,style:f.style})}c.ranges=a}else k.style&&(c.style=k.style)},_getEmptyStyle:function(c){for(var k=
[],g=0;g<c;g++)k.push(null);return k},setContentType:function(c){this.contentType=c;if(this.services)for(c=0;c<this.services.length;c++){var k=this.services[c];if(k.setContentType){var g=this.serviceRegistry.getService("orion.page.progress");g?g.progress(k.setContentType(this.contentType),"Styling content type: "+this.contentType.id?this.contentType.id:this.contentType):k.setContentType(this.contentType)}}},onServiceAdded:function(c,k){r(c)&&this.addServiceListener(k)},onServiceRemoved:function(c,
k){-1!==this.services.indexOf(k)&&this.removeServiceListener(k)},addServiceListener:function(c){if("function"===typeof c.addEventListener){if(c.addEventListener("orion.edit.highlighter.styleReady",this.listener.onStyleReady),this.services.push(c),c.setContentType&&this.contentType){var l=this.serviceRegistry.getService("orion.page.progress");l?l.progress(c.setContentType(this.contentType),"Styling content type: "+this.contentType.id?this.contentType.id:this.contentType):c.setContentType(this.contentType)}}else"undefined"!==
typeof console&&console.log(Error(k))},removeServiceListener:function(c){"function"===typeof c.removeEventListener?(c.removeEventListener("orion.edit.highlighter.styleReady",this.listener.onStyleReady),c=this.services.indexOf(c),-1!==c&&this.services.splice(c,1)):"undefined"!==typeof console&&console.log(Error(k))}};return m});
define("orion/editor/mirror",["i18n!orion/editor/nls/messages","orion/editor/eventTarget","orion/editor/annotations"],function(p,s,r){function m(d){this.string=d;this.tokenStart=this.pos=0}function c(d,a){return{token:function(a,d){return a.skipToEnd()}}}function k(d){this._modes={};this.mimeModes={};this.options={};this.StringStream=m;this.defineMode("null",c);this.defineMIME("text/plain","null")}function h(d){var a=[],b;for(b in d)Object.prototype.hasOwnProperty.call(d,b)&&a.push(b);return a}function l(d,
a,b){b=b||{};this.model=d;this.codeMirror=a;this.isWhitespaceVisible="undefined"===typeof b.whitespacesVisible?!1:b.whitespacesVisible;this.mode=null;this.isModeLoaded=!1;this.lines=[];this.dirtyLines=[];this.startLine=Number.MAX_VALUE;this.endLine=-1;this.timer=null;this.initialize(d)}function g(d,a,b){this.init(d,a,b)}m.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return 0===this.pos},peek:function(){return this.string[this.pos]},next:function(){return this.string[this.pos++]},
eat:function(d){var a=this.string[this.pos];return"string"===typeof a&&(a===d||d.test&&d.test(a)||"function"===typeof d&&d(a))?this.string[this.pos++]:void 0},eatWhile:function(d){for(var a=!1;void 0!==this.eat(d);)a=!0;return a},eatSpace:function(){return this.eatWhile(/\s/)},skipToEnd:function(){this.pos=this.string.length},skipTo:function(d){d=this.string.indexOf(d,this.pos);return-1!==d?(this.pos=d,!0):!1},match:function(d,a,b){a=!0===a||"undefined"===typeof a;if("string"===typeof d){var f=b?
this.string.toLowerCase():this.string;d=b?d.toLowerCase():d;b=f.indexOf(d,this.pos);-1!==b&&a&&(this.pos=b+d.length);return-1!==b}if((d=this.string.substring(this.pos).match(d))&&a&&"string"===typeof d[0])this.pos+=d.index+d[0].length;return d},backUp:function(d){this.pos-=d},column:function(){for(var d=0,a=0;a<this.tokenStart;)d+="\t"===this.string[a++]?4:1;return d},indentation:function(){for(var d=this.string.search(/\S/),a=0,b=0;b<d;)a+="\t"===this.string[b++]?4:1;return a},current:function(){return this.string.substring(this.tokenStart,
this.pos)},advance:function(){this.tokenStart=this.pos}};k.prototype={options:{},setOption:function(d,a){this.options[d]=a},getOption:function(d){return this.options[d]},copyState:function(d,a){if("function"===typeof d.copyState)return d.copyState(a);var b={},f;for(f in a){var g=a[f];b[f]=g instanceof Array?g.slice():g}return b},startState:function(d,a){return d.startState(a)},defineMode:function(d,a){this._modes[d]=a},defineMIME:function(d,a){this.mimeModes[d]=a},getMode:function(d,a){var b={},f;
"string"===typeof a&&this.mimeModes[a]&&(a=this.mimeModes[a]);"object"===typeof a&&(b=a,f=this._modes[a.name]);f=f||this._modes[a];return"function"!==typeof f?("undefined"!==typeof console&&console&&console.log("Mode not found: "+a),this.getMode(d,"null")):f(d,b)},listModes:function(){return h(this._modes)},listMIMEs:function(){return h(this.mimeModes)},_getModeName:function(d){d=this.mimeModes[d];"object"===typeof d&&(d=d.name);return d}};l.prototype={initialize:function(d){var a=this;this.listener=
{onModelChanging:function(b){a._onModelChanging(b)},onModelChanged:function(b){a._onModelChanged(b)},onDestroy:function(b){a._onDestroy(b)}};this.model.addEventListener("Changing",this.listener.onModelChanging);this.model.addEventListener("Changed",this.listener.onModelChanged);this.model.addEventListener("Destroy",this.listener.onDestroy)},destroy:function(){this.model&&(this.model.removeEventListener("Changing",this.listener.onModelChanging),this.model.removeEventListener("Changed",this.listener.onModelChanged),
this.model.removeEventListener("Destroy",this.listener.onDestroy));this.dirtyLines=this.lines=this.mode=this.codeMirror=this.model=null;clearTimeout(this.timer);this.timer=null},_onModelChanging:function(d){this.startLine=this.model.getLineAtOffset(d.start)},_onModelChanged:function(d){this._dbgEvent(d);var a=this.startLine;(d.removedLineCount||d.addedLineCount)&&Array.prototype.splice.apply(this.lines,[a+1,d.removedLineCount].concat(this._newLines(d.addedLineCount)));this.mode&&(d=Math.max(d.addedLineCount,
d.removedLineCount),d=a+Math.min(d,500),this.highlight(a,d),this.highlightLater(d+1))},_onDestroy:function(d){this.destroy()},setViewportIndex:function(d){this.viewportIndex=d},_dbgEvent:function(d){},_dbgStyle:function(){},_newLines:function(d,a){for(var b=[],f=0;f<d;f++)b.push({style:null,eolState:null});return b},setMode:function(d,a){d&&(this.mode=this.codeMirror.getMode(this.codeMirror.options,d),this.lines=this._newLines(this.model.getLineCount()),a&&this.highlight())},highlight:function(d,
a,b){if(this.mode){var f=this.model.getLineCount();d="undefined"===typeof d?0:d;a="undefined"===typeof a?f-1:Math.min(a,f-1);for(var f=this.mode,g=this.getState(d),c=d;c<=a;c++){var e=this.lines[c];this.highlightLine(c,e,g);e.eolState=this.codeMirror.copyState(f,g)}this._expandRange(d,a);if(!b)this.onHighlightDone()}},highlightLater:function(d){this.dirtyLines.push(d);var a=this;this.timer=setTimeout(function(){a._highlightJob()},50)},_highlightJob:function(){for(var d=+new Date+30,a=this.mode.compareStates,
b=this.model.getLineCount();this.dirtyLines.length;){var f=this.viewportIndex,g=this.lines[f],f=g&&!g.eolState?f:this.dirtyLines.pop();if(f>=b)break;this._expandRange(f,f);for(var g=this._getResumeLineIndex(f),f=g+1,g=(g=0<=g&&this.lines[g].eolState)?this.codeMirror.copyState(this.mode,g):this.mode.startState(),c=0,e=f;e<b;e++){var h=this.lines[e],k=h.eolState,l=this.highlightLine(e,h,g);h.eolState=this.codeMirror.copyState(this.mode,g);l&&this._expandRange(f,e+1);var h=a&&k&&a(k,h.eolState),m=!a&&
!l&&3<c++;if(h||m)break;else if(!k||l)c=0;k=e<b||this.dirtyLines.length;if(+new Date>d&&k){this.highlightLater(e+1);this.onHighlightDone();return}}}this.onHighlightDone()},onHighlightDone:function(){this.startLine!==Number.MAX_VALUE&&-1!==this.endLine&&this.dispatchEvent({type:"Highlight",start:this.startLine,end:this.endLine});this.startLine=Number.MAX_VALUE;this.endLine=-1},_getResumeLineIndex:function(d){for(var a=this.lines,b=d-1;0<=b;b--)if(a[b].eolState||40<d-b)return b;return-1},getState:function(d){var a=
this.mode,b=this.lines,f,g;for(f=d-1;0<=f&&!(g=b[f],g.eolState||40<d-f);f--);var c=0<=f&&b[f].eolState;if(c){c=this.codeMirror.copyState(a,c);for(f=Math.max(0,f);f<d-1;f++)g=b[f],this.highlightLine(f,g,c),g.eolState=this.codeMirror.copyState(a,c);return c}return a.startState()},highlightLine:function(d,a,b){if(this.mode){var g=this.model;g.getLineStart(d)===g.getLineEnd(d)&&this.mode.blankLine&&this.mode.blankLine(b);var c=a.style||[];d=g.getLine(d);d=new m(d);for(var g=!a.style,h=[],e=0;!d.eol();e++){var k=
this.mode.token(d,b)||null,l=d.current();this._whitespaceStyle(k,l,d.tokenStart);k=[d.tokenStart,d.pos,k];l=c[e];h.push(k);g=g||!l||l[0]!==k[0]||l[1]!==k[1]||l[2]!==k[2];d.advance()}if(g=g||h.length!==c.length)a.style=h.length?h:null;return g}},_whitespaceStyle:function(d,a,b){if(!d&&this.isWhitespaceVisible&&/\s+/.test(a)){d=[];for(var g,c,h=0;h<a.length;h++){var e=a[h];e!==c&&(c&&d.push([b+g,b+h,"\t"===c?"punctuation separator tab":"punctuation separator space"]),g=h,c=e)}d.push([b+g,b+h,"\t"===
c?"punctuation separator tab":"punctuation separator space"]);return d}return null},_expandRange:function(d,a){this.startLine=Math.min(this.startLine,d);this.endLine=Math.max(this.endLine,a)},toStyleRangesAndErrors:function(d,a){var b=d.style;if(!b)return null;for(var g=[],c=[],h="undefined"===typeof a?0:this.model.getLineStart(a),e=0;e<b.length;e++){var k=b[e],l;l=(l=k[2])?"punctuation separator tab"===l||"punctuation separator space"===l?l:"cm-"+l:null;l&&(k={start:h+k[0],end:h+k[1],style:{styleClass:l}},
g.push(k),"cm-error"===l&&c.push(k))}return[g,c]},getLineStyle:function(d){return this.lines[d]},getLineStyles:function(){return this.lines}};s.EventTarget.addMixin(l.prototype);r.AnnotationType.registerType("orion.annotation.highlightError",{title:p.syntaxError,html:"\x3cdiv class\x3d'annotationHTML error'\x3e\x3c/div\x3e",rangeStyle:{styleClass:"annotationRange error"}});g.prototype={init:function(d,a,b){this.textView=d;this.annotationModel=b;this.modeApplier=new l(d.getModel(),a);var g=this;this.listener=
{onLineStyle:function(a){g.onLineStyle(a)},onDestroy:function(a){g.onDestroy(a)},onHighlight:function(a){g.onHighlight(a)}};d.addEventListener("LineStyle",this.listener.onLineStyle);d.addEventListener("Destroy",this.listener.onDestroy);this.modeApplier.addEventListener("Highlight",this.listener.onHighlight)},destroy:function(){this.modeApplier&&(this.modeApplier.removeEventListener("Highlight",this.listener.onHighlight),this.modeApplier.destroy());this.textView&&(this.textView.removeEventListener("LineStyle",
this.listener.onLineStyle),this.textView.removeEventListener("Destroy",this.listener.onDestroy));this.listener=this.modeApplier=this.annotationModel=this.textView=null},setMode:function(d){this.modeApplier.setMode(d)},onLineStyle:function(d){var a=d.lineIndex,b=this.modeApplier,g=b.getLineStyle(a);if(!g||!g.eolState){var c=this.textView.getModel().getLineCount();b.highlight(a,Math.min(a+20,c-1),!0);g=b.getLineStyle(a)}c=this.textView.getModel();if(g){var h=b.toStyleRangesAndErrors(g,a);if(h&&(d.ranges=
h[0],d=this.annotationModel)){b=[];g=[];if(h=h[1])for(var e=0;e<h.length;e++){var k=h[e];"cm-error"===k.style.styleClass&&g.push(r.AnnotationType.createAnnotation("orion.annotation.highlightError",k.start,k.end))}for(a=d.getAnnotations(c.getLineStart(a),c.getLineEnd(a));a.hasNext();)c=a.next(),"orion.annotation.highlightError"===c.type&&b.push(c);d.replaceAnnotations(b,g)}}},onHighlight:function(d){this.textView.redrawLines(d.start,d.end)},onDestroy:function(d){this.destroy()}};return{Mirror:k,ModeApplier:l,
CodeMirrorStyler:g}});
define("orion/editor/textMateStyler",["orion/regex"],function(p){function s(c){var k;if(c instanceof Array){k=Array(c.length);for(var h=0;h<c.length;h++)k[h]=s(c[h])}else for(h in k={},c)if(Object.prototype.hasOwnProperty.call(c,h)){var l=c[h];k[h]="object"===typeof l&&null!==l?s(l):l}return k}function r(c,k,h){this.initialize(c);this.grammar=s(k);this.externalGrammars=h?s(h):[];this._styles={};this._tree=null;this._allGrammars={};this.preprocess(this.grammar)}var m={unsupported:[{regex:/\(\?[ims\-]:/,func:function(c){return"option on/off for subexp"}},
{regex:/\(\?<([=!])/,func:function(c){return"\x3d"===c[1]?"lookbehind":"negative lookbehind"}},{regex:/\(\?>/,func:function(c){return"atomic group"}}],toRegExp:function(c){function k(d,a){throw Error('Unsupported regex feature "'+d+'": "'+a[0]+'" at index: '+a.index+" in "+a.input);}var h="",l;c=m.processGlobalFlag("x",c,function(d){for(var a="",b=!1,g=d.length,c=0;c<g;){var h=d.charAt(c);if(!b&&"#"===h)for(;c<g&&"\r"!==h&&"\n"!==h;)h=d.charAt(++c);else if(!b&&/\s/.test(h))for(;c<g&&/\s/.test(h);)h=
d.charAt(++c);else"\\"===h?(a+=h,/\s/.test(d.charAt(c+1))||(a+=d.charAt(c+1),c+=1)):("["===h?b=!0:"]"===h&&(b=!1),a+=h),c+=1}return a});c=m.processGlobalFlag("i",c,function(d){h+="i";return d});for(l=0;l<this.unsupported.length;l++){var g;(g=this.unsupported[l].regex.exec(c))&&k(this.unsupported[l].func(g),g)}return RegExp(c,h)},processGlobalFlag:function(c,k,h){var l="(?"+c+")";c="(?"+c+":";if(k.substring(0,l.length)===l)return h(k.substring(l.length));if(k.substring(0,c.length)===c){for(var l=0,
g=k.length,d=-1,a=0;a<g&&-1===d;a++)switch(k.charAt(a)){case "\\":a++;break;case "(":l++;break;case ")":l--,0===l&&(d=a)}l=d;if(l<k.length-1)throw Error("Only a "+c+") group that encloses the entire regex is supported in: "+k);return h(k.substring(c.length,l))}return k},hasBackReference:function(c){return/\\\d+/.test(c.source)},getSubstitutedRegex:function(c,k,h){h="undefined"===typeof h?!0:!1;c=c.source.split(/(\\\d+)/g);for(var l=[],g=0;g<c.length;g++){var d=c[g],a=/\\(\d+)/.exec(d);a?(d=k[a[1]]||
"",l.push(h?p.escape(d):d)):l.push(d)}return RegExp(l.join(""))},groupify:function(c,k){for(var h=c.source,l=h.length,g=[],d=0,a=[],b=1,f=1,n=[],m={},e={},p=0;p<l;p++){var r=g[g.length-1],s=h.charAt(p);switch(s){case "(":4===r&&(g.pop(),n.push(")"),a[a.length-1].end=p);var w=p+2<l?h.charAt(p+1)+""+h.charAt(p+2):null;if("?:"===w||"?\x3d"===w||"?!"===w){var z;"?:"===w?z=1:(z=3,d++);g.push(z);a.push({start:p,end:-1,type:z});n.push(s);n.push(w);p+=w.length}else g.push(2),a.push({start:p,end:-1,type:2,
oldNum:b,num:f}),n.push(s),0===d&&(e[f]=null),m[b]=f,b++,f++;break;case ")":r=g.pop();3===r&&d--;a[a.length-1].end=p;n.push(s);break;case "*":case "+":case "?":case "}":var D=s,B=h.charAt(p-1),w=p-1;if("}"===s){for(z=p-1;"{"!==h.charAt(z)&&0<=z;z--);B=h.charAt(z-1);w=z-1;D=h.substring(z,p+1)}z=a[a.length-1];if(")"===B&&(2===z.type||4===z.type)){n.splice(z.start,0,"(");n.push(D);n.push(")");s={start:z.start,end:n.length-1,type:4,num:z.num};for(B=0;B<a.length;B++)if(r=a[B],(2===r.type||4===r.type)&&
r.start>=z.start&&r.end<=w)r.start+=1,r.end+=1,r.num+=1,2===r.type&&(m[r.oldNum]=r.num);a.push(s);f++;break}default:"|"!==s&&(2!==r&&4!==r)&&0===d&&(g.push(4),a.push({start:p,end:-1,type:4,num:f}),n.push("("),e[f]=null,f++),n.push(s),"\\"===s&&(s=h.charAt(p+1),n.push(s),p+=1)}}for(;g.length;)g.pop(),n.push(")");h=RegExp(n.join(""));l={};k=k||m;for(var q in k)k.hasOwnProperty(q)&&(l[q]="\\"+k[q]);h=this.getSubstitutedRegex(h,l,!1);return[h,m,e]},complexCaptures:function(c){if(!c)return!1;for(var k in c)if(c.hasOwnProperty(k)&&
"0"!==k)return!0;return!1}};r.prototype={initialize:function(c){this.textView=c;this.textView.stylerOptions=this;var k=this;this._listener={onModelChanged:function(c){k.onModelChanged(c)},onDestroy:function(c){k.onDestroy(c)},onLineStyle:function(c){k.onLineStyle(c)},onStorage:function(c){k.onStorage(c)}};c.addEventListener("ModelChanged",this._listener.onModelChanged);c.addEventListener("Destroy",this._listener.onDestroy);c.addEventListener("LineStyle",this._listener.onLineStyle);c.redrawLines()},
onDestroy:function(c){this.destroy()},destroy:function(){this.textView&&(this.textView.removeEventListener("ModelChanged",this._listener.onModelChanged),this.textView.removeEventListener("Destroy",this._listener.onDestroy),this.textView.removeEventListener("LineStyle",this._listener.onLineStyle),this.textView=null);this._listener=this._tree=this._styles=this.grammar=null},preprocess:function(c){for(c=[c];0!==c.length;){var k=c.pop();if(!k._resolvedRule||!k._typedRule)if(k._resolvedRule=this._resolve(k),
k._typedRule=this._createTypedRule(k),this.addStyles(k.name),this.addStyles(k.contentName),this.addStylesForCaptures(k.captures),this.addStylesForCaptures(k.beginCaptures),this.addStylesForCaptures(k.endCaptures),k._resolvedRule!==k&&c.push(k._resolvedRule),k.patterns)for(var h=0;h<k.patterns.length;h++)c.push(k.patterns[h])}},addStyles:function(c){if(c&&!this._styles[c]){this._styles[c]=[];for(var k=c.split("."),h=0;h<k.length;h++)this._styles[c].push(k.slice(0,h+1).join("-"))}},addStylesForCaptures:function(c){for(var k in c)c.hasOwnProperty(k)&&
this.addStyles(c[k].name)},ContainerRule:function(){function c(c){this.rule=c;this.subrules=c.patterns}c.prototype.valueOf=function(){return"aa"};return c}(),BeginEndRule:function(){function c(c){this.rule=c;this.beginRegex=m.toRegExp(c.begin);this.endRegex=m.toRegExp(c.end);this.subrules=c.patterns||[];this.endRegexHasBackRef=m.hasBackReference(this.endRegex);var h=m.complexCaptures(c.captures);c=m.complexCaptures(c.beginCaptures)||m.complexCaptures(c.endCaptures);if(this.isComplex=h||c)h=m.groupify(this.beginRegex),
this.beginRegex=h[0],this.beginOld2New=h[1],this.beginConsuming=h[2],h=m.groupify(this.endRegex,this.beginOld2New),this.endRegex=h[0],this.endOld2New=h[1],this.endConsuming=h[2]}c.prototype.valueOf=function(){return this.beginRegex};return c}(),MatchRule:function(){function c(c){this.rule=c;this.matchRegex=m.toRegExp(c.match);if(this.isComplex=m.complexCaptures(c.captures))c=m.groupify(this.matchRegex),this.matchRegex=c[0],this.matchOld2New=c[1],this.matchConsuming=c[2]}c.prototype.valueOf=function(){return this.matchRegex};
return c}(),_createTypedRule:function(c){return c.match?new this.MatchRule(c):c.begin?new this.BeginEndRule(c):new this.ContainerRule(c)},_resolve:function(c){var k=c;if(c.include){if(c.begin||c.end||c.match)throw Error('Unexpected regex pattern in "include" rule '+c.include);c=c.include;if("#"===c.charAt(0)){if(k=this.grammar.repository&&this.grammar.repository[c.substring(1)],!k)throw Error("Couldn't find included rule "+c+" in grammar repository");}else if("$self"===c)k=this.grammar;else{if("$base"===
c)throw Error('Include "$base" is not supported');k=this._allGrammars[c];if(!k)for(var h=0;h<this.externalGrammars.length;h++){var l=this.externalGrammars[h];if(l.scopeName===c){this.preprocess(l);k=this._allGrammars[c]=l;break}}}}return k},ContainerNode:function(){function c(c,h){this.parent=c;this.rule=h;this.children=[];this.end=this.start=null}c.prototype.addChild=function(c){this.children.push(c)};c.prototype.valueOf=function(){var c=this.rule;return"ContainerNode { "+(c.include||"")+" "+(c.name||
"")+(c.comment||"")+"}"};return c}(),BeginEndNode:function(){function c(c,h,l){this.parent=c;this.rule=h;this.children=[];this.setStart(l);this.endMatch=this.end=null;this.endRegexSubstituted=h.endRegexHasBackRef?m.getSubstitutedRegex(h.endRegex,l):null}c.prototype.addChild=function(c){this.children.push(c)};c.prototype.getIndexInParent=function(c){return this.parent?this.parent.children.indexOf(this):-1};c.prototype.setStart=function(c){this.start=c.index;this.beginMatch=c};c.prototype.setEnd=function(c){c&&
"object"===typeof c?(this.endMatch=c,this.end=c.index+c[0].length):(this.endMatch=null,this.end=c)};c.prototype.shiftStart=function(c){this.start+=c;this.beginMatch.index+=c};c.prototype.shiftEnd=function(c){this.end+=c;this.endMatch&&(this.endMatch.index+=c)};c.prototype.valueOf=function(){return"{"+this.rule.beginRegex+" range\x3d"+this.start+".."+this.end+"}"};return c}(),push:function(c,k){if(k)for(var h=k.length;0<h;)c.push(k[--h])},exec:function(c,k,h){if(k=c.exec(k))k.index+=h;c.lastIndex=
0;return k},afterMatch:function(c){return c.index+c[0].length},getEndMatch:function(c,k,h){if(c instanceof this.BeginEndNode){var l=c.rule;c=c.endRegexSubstituted||l.endRegex;return!c?null:this.exec(c,k,h)}return null},initialParse:function(){this.textView.getModel().getCharCount();this._tree=new this.ContainerNode(null,this.grammar._typedRule);this.parse(this._tree,!1,0)},onModelChanged:function(c){var k=c.addedCharCount,h=c.removedCharCount;c=c.start;if(this._tree){var l=this.textView.getModel(),
g=l.getCharCount(),l=l.getLineEnd(l.getLineAtOffset(c)-1),d=this.getFirstDamaged(l,l),l=-1===l?0:l,k=d?this.parse(d,!0,l,c,k,h):g;this.textView.redrawRange(l,k)}else this.initialParse()},getFirstDamaged:function(c,k){if(0>c)return this._tree;for(var h=[this._tree],l=null;h.length;){var g=h.pop();if(!g.parent||this.isDamaged(g,c,k)){g instanceof this.BeginEndNode&&(l=g);for(var d=0;d<g.children.length;d++)h.push(g.children[d])}}return l||this._tree},isDamaged:function(c,k,h){return c.start<=h&&c.end>
k},parse:function(c,k,h,l,g,d){var a=this.textView.getModel(),b=a.getLineStart(a.getLineCount()-1),f=a.getCharCount(),n=this.getInitialExpected(c,h),m=-1;k&&(c.repaired=!0,c.endNeedsUpdate=!0,m=(m=c.children[c.children.length-1])?a.getLineEnd(a.getLineAtOffset(m.end+(g-d))):-1,l=a.getLineEnd(a.getLineAtOffset(l+d)),m=Math.max(m,l));m=-1===m?f:m;l=n;for(var e=c,p=!1,r=h,s=-1;e&&(!k||r<m);){var w=this.getNextMatch(a,e,r);w||(r=r>=b?f:a.getLineStart(a.getLineAtOffset(r)+1));var z=w&&w.match,D=w&&w.rule,
B=w&&w.isEnd;if(w&&w.isSub)r=this.afterMatch(z),D instanceof this.BeginEndRule&&(p=!0,k&&D===l.rule&&e===l.parent?(e=l,e.setStart(z),e.repaired=!0,e.endNeedsUpdate=!0,l=this.getNextExpected(l,"begin")):(k&&(this.prune(e,l),k=!1),z=new this.BeginEndNode(e,D,z),e.addChild(z),e=z));else if(B||r===f)e instanceof this.BeginEndNode&&(z?(p=!0,s=Math.max(s,e.end),e.setEnd(z),r=this.afterMatch(z),k&&e===l&&e.parent===l.parent?(e.repaired=!0,delete e.endNeedsUpdate,l=this.getNextExpected(l,"end")):k&&(this.prune(e,
l),k=!1)):(e.setEnd(f),delete e.endNeedsUpdate)),e=e.parent;k&&(r>=m&&!p)&&(this.prune(c,n),k=!1)}this.removeUnrepairedChildren(c,k,h);this.cleanup(k,c,h,m,f,g,d);return k?Math.max(s,r):r},removeUnrepairedChildren:function(c,k,h){if(k){k=c.children;for(var l=-1,g=0;g<k.length;g++){var d=k[g];if(!d.repaired&&this.isDamaged(d,h,Number.MAX_VALUE)){l=g;break}}-1!==l&&(c.children.length=l)}},cleanup:function(c,k,h,l,g,d,a){if(c){c=d-a;g=this.getIntersecting(l-c+1,g);k=this.getIntersecting(h,l);for(h=0;h<
g.length;h++)l=g[h],!l.repaired&&l instanceof this.BeginEndNode&&(l.shiftEnd(c),l.shiftStart(c));for(h=0;h<k.length;h++)l=k[h],l.repaired&&l.endNeedsUpdate&&l.shiftEnd(c),delete l.endNeedsUpdate,delete l.repaired}else{k=this.getIntersecting(h,l);for(h=0;h<k.length;h++)delete k[h].repaired}},getNextMatch:function(c,k,h,l){var g=c.getLineAtOffset(h),g=c.getLineEnd(g),d=c.getText(h,g),a=[],b=[];c=[];g=[];for(this.push(a,k.rule.subrules);a.length;){var f=a.length?a.pop():null,f=f&&f._resolvedRule._typedRule;
if(f instanceof this.ContainerRule&&-1===b.indexOf(f))b.push(f),this.push(a,f.subrules);else if(!f||!l||f.matchRegex){var n=f&&this.exec(f.matchRegex||f.beginRegex,d,h);n&&(c.push(n),g.push(f))}}a=Number.MAX_VALUE;b=-1;for(f=0;f<c.length;f++)n=c[f],n.index<a&&(a=n.index,b=f);if(!l&&(h=this.getEndMatch(k,d,h)))if(l=k.rule.applyEndPatternLast,-1===b||h.index<a||!l&&h.index===a)return{isEnd:!0,rule:k.rule,match:h};return-1===b?null:{isSub:!0,rule:g[b],match:c[b]}},getInitialExpected:function(c,k){var h,
l;if(c===this._tree)for(h=0;h<c.children.length;h++){if(l=c.children[h],l.start>=k)return l}else if(c instanceof this.BeginEndNode&&c.endMatch){var g=c.endMatch.index;for(h=0;h<c.children.length&&!(l=c.children[h],l.start>=k);h++);if(l&&l.start<g)return l}return c},getNextExpected:function(c,k){if("begin"===k){var h=c.children[0];return h?h:c}if("end"===k&&(h=c.parent)){var l=h.children[h.children.indexOf(c)+1];return l?l:h}return null},prune:function(c,k){k.parent===c?c.children.length=k.getIndexInParent():
c instanceof this.BeginEndNode&&(c.endMatch=null,c.end=null);c.parent&&(c.parent.children.length=c.getIndexInParent()+1)},onLineStyle:function(c){this._tree||this.initialParse();var k=c.lineStart,h=this.textView.getModel(),l=h.getLineEnd(c.lineIndex),g=h.getLineEnd(h.getLineAtOffset(k)-1),g=this.getFirstDamaged(g,g),k=this.getLineScope(h,g,k,l);c.ranges=this.toStyleRanges(k);c.ranges.sort(function(d,a){return d.start-a.start})},getLineScope:function(c,k,h,l){for(var g=h,d=this.getInitialExpected(k,
h),a=[],b=[];k&&g<l;){var f=this.getNextMatch(c,k,g);if(!f)break;var n=f&&f.match,m=f&&f.rule,e=f&&f.isSub,f=f&&f.isEnd;n.index!==g&&b.push({start:g,end:n.index,node:k});e?(g=this.afterMatch(n),m instanceof this.BeginEndRule?(this.addBeginScope(a,n,m),k=d,d=this.getNextExpected(d,"begin")):this.addMatchScope(a,n,m)):f&&(g=this.afterMatch(n),this.addEndScope(a,n,m),d=this.getNextExpected(d,"end"),k=k.parent)}g<l&&b.push({start:g,end:l,node:k});c=this.getInheritedLineScope(b,h,l);return a.concat(c)},
getInheritedLineScope:function(c,k,h){k=[];for(h=0;h<c.length;h++)for(var l=c[h],g=l.node;g;){var d=g.rule.rule,a=d.name;if(d=d.contentName||a){this.addScopeRange(k,l.start,l.end,d);break}g=g.parent}return k},addBeginScope:function(c,k,h){var l=h.rule;this.addCapturesScope(c,k,l.beginCaptures||l.captures,h.isComplex,h.beginOld2New,h.beginConsuming)},addEndScope:function(c,k,h){var l=h.rule;this.addCapturesScope(c,k,l.endCaptures||l.captures,h.isComplex,h.endOld2New,h.endConsuming)},addMatchScope:function(c,
k,h){var l=h.rule,g=l.name;(l=l.captures)?this.addCapturesScope(c,k,l,h.isComplex,h.matchOld2New,h.matchConsuming):this.addScope(c,k,g)},addScope:function(c,k,h){h&&c.push({start:k.index,end:this.afterMatch(k),scope:h})},addScopeRange:function(c,k,h,l){l&&c.push({start:k,end:h,scope:l})},addCapturesScope:function(c,k,h,l,g,d){if(h)if(l){l={1:0};for(var a=0,b=1;void 0!==k[b];b++)void 0!==d[b]&&(a+=k[b].length),void 0!==k[b+1]&&(l[b+1]=a);d=k.index;for(a=1;h[a];a++){var b=h[a].name,f=g[a],n=d+l[f];
"undefined"!==typeof k[f]&&this.addScopeRange(c,n,n+k[f].length,b)}}else this.addScope(c,k,h[0]&&h[0].name)},getIntersecting:function(c,k){for(var h=[],l=this._tree?[this._tree]:[];l.length;){var g=l.pop(),d=!1;g instanceof this.ContainerNode?d=!0:this.isDamaged(g,c,k)&&(d=!0,h.push(g));if(d)for(var d=g.children.length,a=0;a<d;a++)l.push(g.children[a])}return h.reverse()},toStyleRanges:function(c){for(var k=[],h=0;h<c.length;h++){var l=c[h],g=this._styles[l.scope];if(!g)throw Error("styles not found for "+
l.scope);g=g.join(" ");k.push({start:l.start,end:l.end,style:{styleClass:g}})}return k}};return{RegexUtil:m,TextMateStyler:r}});
define("orion/editor/htmlGrammar",[],function(){return{HtmlGrammar:function(){return{scopeName:"source.html",uuid:"3B5C76FB-EBB5-D930-F40C-047D082CE99B",patterns:[{begin:"\x3c!(doctype|DOCTYPE)",end:"\x3e",contentName:"entity.name.tag.doctype.html",beginCaptures:{0:{name:"entity.name.tag.doctype.html"}},endCaptures:{0:{name:"entity.name.tag.doctype.html"}}},{begin:"\x3c!--",end:"--\x3e",beginCaptures:{0:{name:"punctuation.definition.comment.html"}},endCaptures:{0:{name:"punctuation.definition.comment.html"}},
patterns:[{match:"--",name:"invalid.illegal.badcomment.html"}],contentName:"comment.block.html"},{match:"\x3c[A-Za-z0-9_\\-:]+(?\x3d ?)",name:"entity.name.tag.html"},{include:"#attrName"},{include:"#qString"},{include:"#qqString"},{include:"#entity"},{match:"\x3c/[A-Za-z0-9_\\-:]+\x3e",name:"entity.name.tag.html"},{match:"\x3e",name:"entity.name.tag.html"}],repository:{attrName:{match:"[A-Za-z\\-:]+(?\x3d\\s*\x3d\\s*['\"])",name:"entity.other.attribute.name.html"},qqString:{match:'(")[^"]+(")',name:"string.quoted.double.html"},
qString:{match:"(')[^']+(')",name:"string.quoted.single.html"},entity:{match:"\x26[A-Za-z0-9]+;",name:"constant.character.entity.html"}}}}}});
define("orion/editor/textStyler",["orion/editor/annotations","orion/editor/eventTarget"],function(p,s){function r(c,d){this._patternManager=new m(c,d)}function m(c,d){this._unnamedCounter=0;this._patterns=[];this._rootId=d;c.forEach(function(a){this._addRepositoryPatterns(a.repository||{},a.id);this._addPatterns(a.patterns||[],a.id)}.bind(this))}function c(c,d,a,b,f,h,k){this.start=c.start;this.end=c.end;this.contentStart=c.contentStart;this.contentEnd=c.contentEnd;this.name=d;this.typeId=a;this.styler=
b;this.parent=h;k&&k(this);this._subBlocks=b.computeBlocks(f,f.getText(this.contentStart,this.end),this,this.contentStart,null,null,null)}function k(c){this._styler=c}function h(c,d,a){this._highlightCaretLine=this._whitespacesVisible=!1;this._detectTasks=this._foldingEnabled=!0;this._view=c;this._annotationModel=d;this._stylerAdapter=a;this._stylerAdapter.setStyler(this);this._accessor=new k(this);this._bracketAnnotations;var b=this;this._listener={onChanged:function(a){b._onModelChanged(a)},onDestroy:function(a){b._onDestroy(a)},
onLineStyle:function(a){b._onLineStyle(a)},onMouseDown:function(a){b._onMouseDown(a)},onSelection:function(a){b._onSelection(a)}};a=c.getModel();a.getBaseModel&&(a=a.getBaseModel());a.addEventListener("Changed",this._listener.onChanged);c.addEventListener("MouseDown",this._listener.onMouseDown);c.addEventListener("Selection",this._listener.onSelection);c.addEventListener("Destroy",this._listener.onDestroy);c.addEventListener("LineStyle",this._listener.onLineStyle);var f=a.getCharCount();this._rootBlock=
this._stylerAdapter.createBlock({start:0,contentStart:0,end:f,contentEnd:f},this,a,null);d&&(f=[],d.removeAnnotations(p.AnnotationType.ANNOTATION_FOLDING),this._computeFolding(this._rootBlock.getBlocks(),c.getModel(),f),this._detectTasks&&(d.removeAnnotations(p.AnnotationType.ANNOTATION_TASK),this._computeTasks(this._rootBlock,a,f)),d.replaceAnnotations([],f));c.redrawLines()}var l=function(c,d,a,b,f){var h;void 0===b&&(b=-1);void 0===f&&(f=c.length);for(;1<f-b;)if(h=Math.floor((f+b)/2),d<=c[h].start)f=
h;else if(a&&d<c[h].end){f=h;break}else b=h;return f};r.prototype={blockSpansBeyondEnd:function(c){return c.pattern.regexEnd===this._eolRegex},computeBlocks:function(c,d,a,b,f,h,k){if(!d)return[];var e=[],l=[];f=f||0;h=h||Infinity;k=k||Infinity;a.blockPatterns.forEach(function(a){var b=this._findMatch(a.regexBegin||a.regex,d,f);b&&l.push({result:b,pattern:a})}.bind(this));if(!l.length)return e;l.sort(function(a,b){return a.result.index<b.result.index?-1:a.result.index>b.result.index?1:a.pattern.pattern.index<
b.pattern.pattern.index?-1:1});for(var m=0;0<l.length;){var p=l[0];l.splice(0,1);if(h<p.result.index)break;if(!(p.result.index<m)){var m=b+p.result.index,r=p.result.index,s=null,D=p.pattern.regexEnd;if(D){var r=r+p.result[0].length,B=p.pattern,q=this._substituteCaptureValues(D,p.result);q!==D&&(B={pattern:B.pattern,regexBegin:B.regexBegin,regexEnd:q},D=q);for(q=r;!s;){q=this._findMatch(D,d,q);q||(this._eolRegex.lastIndex=0,q=this._eolRegex.exec(d),B={pattern:B.pattern,regexBegin:B.regexBegin,regexEnd:this._eolRegex});
var C=this.createBlock({start:m,end:b+q.index+q[0].length,contentStart:b+r,contentEnd:b+q.index},a.styler,c,a,B),y=C.getBlocks();if(!y.length||y[y.length-1].end<=q.index+b)s=C;q=q.index+q[0].length}}else s=this.createBlock({start:m,end:m+p.result[0].length,contentStart:m,contentEnd:m+p.result[0].length},a.styler,c,a,p.pattern);e.push(s);if(e.length===k||h<=s.end)break;m=s.end-b}this._updateMatch(p,d,l,m,h)}return e},computeStyle:function(c,d,a){if(!c.pattern)return null;var b={start:c.start,end:c.end,
style:c.pattern.pattern.name};if(c.contentStart<=a&&a<c.contentEnd)return c.pattern.pattern.contentName?{start:c.contentStart,end:c.contentEnd,style:c.pattern.pattern.contentName}:b;var f,h;if(a<c.contentStart){h=c.pattern.pattern.beginCaptures||c.pattern.pattern.captures;if(!h)return b;f=c.pattern.regexBegin;d=d.getText(c.start,c.contentStart);c=c.start}else{h=c.pattern.pattern.endCaptures||c.pattern.pattern.captures;if(!h)return b;f=c.pattern.regexEnd;d=d.getText(c.contentEnd,c.end);c=c.contentEnd}f.lastIndex=
0;if(f=f.exec(d))if(d=[],this._getCaptureStyles(f,h,c,d),(h=d[l(d,a,!0)])&&h.start<=a&&a<h.end)return h;return b},createBlock:function(g,d,a,b,f){return new c(g,f?f.pattern.name:null,f?f.pattern.id:null,d,a,b,function(a){a.pattern=f;a.linePatterns=[];a.blockPatterns=[];a.enclosurePatterns={};this._initPatterns(this._patternManager,a)}.bind(this))},getBlockContentStyleName:function(c){return c.pattern.pattern.contentName||c.pattern.pattern.name},getBlockEndStyle:function(c,d,a,b){var f;if(c.pattern.regexEnd&&
(f=this._findMatch(c.pattern.regexEnd,d,0)))(d=c.pattern.pattern.endCaptures||c.pattern.pattern.captures)?this._getCaptureStyles(f,d,a-f[0].length,b):c.pattern.pattern.name&&b.push({start:a-f[0].length,end:a,style:c.pattern.pattern.name});return f?f[0]:null},getBlockStartStyle:function(c,d,a,b){var f;if(c.pattern.regexBegin&&(f=this._findMatch(c.pattern.regexBegin,d,0)))(d=c.pattern.pattern.beginCaptures||c.pattern.pattern.captures)?this._getCaptureStyles(f,d,a,b):b.push({start:a,end:a+f[0].length,
style:c.pattern.pattern.name});return f?f[0]:null},getBracketMatch:function(c,d){for(var a,b=Object.keys(c.enclosurePatterns),f=0;f<b.length;f++){var h=c.enclosurePatterns[b[f]],k=this._findMatch(h.regex,d,0);if(k&&0===k.index){a=h;break}}if(!a)return null;f=!1;-1!==a.pattern.name.indexOf(this._PUNCTUATION_SECTION_BEGIN)?(f=!0,b=a.pattern.name.replace(this._PUNCTUATION_SECTION_BEGIN,this._PUNCTUATION_SECTION_END)):b=a.pattern.name.replace(this._PUNCTUATION_SECTION_END,this._PUNCTUATION_SECTION_BEGIN);
return!c.enclosurePatterns[b]?null:{beginName:a.pattern.name,endName:b,atStart:f}},parse:function(c,d,a,b,f){if(c&&(a=a.linePatterns)){var h=[];a.forEach(function(a){var b=a.regex||a.regexBegin;b.oldLastIndex=b.lastIndex;(b=this._findMatch(b,c,0))&&h.push({result:b,pattern:a})}.bind(this));h.sort(function(a,b){return a.result.index<b.result.index?-1:a.result.index>b.result.index?1:a.pattern.pattern.index<b.pattern.pattern.index?-1:1});for(var k=0;0<h.length;){var e=h[0];h.splice(0,1);if(!(e.result.index<
k)){var l=e.result.index,m,p=[];if(e.pattern.regex){k=e.result;m=l+k[0].length;m={start:d+l,end:d+m,style:e.pattern.pattern.name};if(!f){e.pattern.pattern.captures&&this._getCaptureStyles(k,e.pattern.pattern.captures,d+l,p);p.sort(function(a,b){return a.start<b.start?-1:a.start>b.start?1:0});for(l=0;l<p.length-1;l++)if(p[l+1].start<p[l].end){var r={start:p[l+1].end,end:p[l].end,style:p[l].style};p[l].end=p[l+1].start;p.splice(l+2,0,r)}}this._mergeStyles(m,p,b)}else k=e.pattern.regexEnd,k=this._substituteCaptureValues(k,
e.result),k=this._findMatch(k,c,e.result.index+e.result[0].length),k||(this._eolRegex.lastIndex=0,k=this._eolRegex.exec(c)),m=k.index+k[0].length,b.push({start:d+l,end:d+m,style:e.pattern.pattern.name});k=k.index+k[0].length}this._updateMatch(e,c,h,k)}a.forEach(function(a){a=a.regex||a.regexBegin;a.lastIndex=a.oldLastIndex})}},setStyler:function(){},verifyBlock:function(c,d,a,b){var f=null,h=[];a.parent.blockPatterns.forEach(function(a){var b=this._findMatch(a.regexBegin||a.regex,d,0);b&&h.push({result:b,
pattern:a})}.bind(this));h.sort(function(a,b){return!a.result.index&&b.result.index?-1:a.result.index&&!b.result.index?1:!a.result.index&&!b.result.index?a.pattern.pattern.index<b.pattern.pattern.index?-1:1:0});if(!h.length||0!==h[0].result.index||h[0].pattern.pattern.id!==a.pattern.pattern.id)f=!1;else{var k=h[0],e=k.pattern.regexEnd;if(e){for(var e=this._substituteCaptureValues(e,k.result),k=k.result[0].length,l=this._findMatch(e,d,k);null===f&&l&&a.start+l.index!==a.contentEnd+b;){var m=this.computeBlocks(c,
d,a,a.start,k,l.index+1,null);!m.length||m[m.length-1].end<=a.start+l.index?f=!1:m.length?(k=m[m.length-1].end-a.start,l=this._findMatch(e,d,k)):l=null}l||(this._eolRegex.lastIndex=0,l=this._eolRegex.exec(d),f=a.start+l.index===a.end+b)}else f=a.start+k.result[0].length===a.end+b}return null!==f?f:!0},_findMatch:function(c,d,a,b){var f=a,h=c.lastIndex;this._linebreakRegex.lastIndex=a;a=this._linebreakRegex.exec(d);var k,e;c.lastIndex=0;if(a){for(e=a.index;0<=--e&&!(k=d.charAt(e),k===this._NEWLINE||
k===this._CR););k=d.substring(e+1,a.index+a[1].length);c.lastIndex=e=a.index-e-1}for(;a&&a.index<d.length;){var l;if(b){var m=c.lastIndex;c.test(k)&&(c.lastIndex=m,l=c.exec(k))}else l=c.exec(k);if(l)return l.index+=f,l.index-=e,c.lastIndex=h,l;e=0;f+=a[0].length;if(a=this._linebreakRegex.exec(d))k=a[1],c.lastIndex=0}c.lastIndex=h;return null},_getCaptureStyles:function(c,d,a,b){if(d[0])b.push({start:a,end:a+c[0].length,style:d[0].name});else for(var f=0,h=1;h<c.length;h++)if(c[h]){var k=d[h];if(k){var e=
a+f;b.push({start:e,end:e+c[h].length,style:k.name})}f+=c[h].length}},_initPatterns:function(c,d){if(d.pattern&&d.pattern.pattern.linePatterns)d.linePatterns=d.pattern.pattern.linePatterns,d.blockPatterns=d.pattern.pattern.blockPatterns,d.enclosurePatterns=d.pattern.pattern.enclosurePatterns;else{var a=c.getPatterns(d.pattern?d.pattern.pattern:null),b=function(a){a="string"===typeof a?a:a.match;var b=this._ignoreCaseRegex.exec(a),d=this._FLAGS;b&&(a=a.substring(b[0].length),d+="i");return RegExp(a,
d)}.bind(this),f=-1,h=0;a.forEach(function(a){var c;if(a.match&&!a.begin&&!a.end){if(c={regex:b(a.match),pattern:a},d.linePatterns.push(c),a.name&&0===a.name.indexOf("punctuation.section")&&(-1!==a.name.indexOf(this._PUNCTUATION_SECTION_BEGIN)||-1!==a.name.indexOf(this._PUNCTUATION_SECTION_END)))d.enclosurePatterns[a.name]=c}else!a.match&&(a.begin&&a.end)&&(f=h,c={regexBegin:b(a.begin),regexEnd:b(a.end),pattern:a},d.linePatterns.push(c));h++}.bind(this));d.blockPatterns=d.linePatterns.slice(0,f+1);
d.pattern&&(d.pattern.pattern.enclosurePatterns=d.enclosurePatterns,d.pattern.pattern.linePatterns=d.linePatterns,d.pattern.pattern.blockPatterns=d.blockPatterns)}},_mergeStyles:function(c,d,a){var b=c.start;d.forEach(function(d){b<=d.start&&a.push({start:b,end:d.start,style:c.style});a.push(d);b=d.end});b<c.end&&a.push({start:b,end:c.end,style:c.style})},_substituteCaptureValues:function(c,d){var a=c.toString();this._captureReferenceRegex.lastIndex=0;if(!this._captureReferenceRegex.test(a))return c;
this._captureReferenceRegex.lastIndex=0;for(var b=this._captureReferenceRegex.exec(a);b;)a=a.replace(b[0],d[b[1]]||""),this._captureReferenceRegex.lastIndex=0,b=this._captureReferenceRegex.exec(a);return RegExp(a.substring(1,a.length-1-this._FLAGS.length),this._FLAGS)},_updateMatch:function(c,d,a,b,f){var h=c.pattern.regex?c.pattern.regex:c.pattern.regexBegin;f=f||Infinity;if((d=this._findMatch(h,d,b,!0))&&d.index<f){c.result=d;for(f=0;f<a.length;f++)if(d.index<a[f].result.index||d.index===a[f].result.index&&
c.pattern.pattern.index<a[f].pattern.pattern.index){a.splice(f,0,c);return}a.push(c)}},_captureReferenceRegex:/\\(\d)/g,_eolRegex:/$/,_ignoreCaseRegex:/^\(\?i\)\s*/,_linebreakRegex:/(.*)(?:[\r\n]|$)/g,_CR:"\r",_FLAGS:"g",_NEWLINE:"\n",_PUNCTUATION_SECTION_BEGIN:".begin",_PUNCTUATION_SECTION_END:".end"};m.prototype={getPatterns:function(c){c?(c="string"===typeof c?c:c.qualifiedId,c+="#"):c=this._rootId+"#"+this._NO_ID;var d=[0],a={},b=RegExp("^"+c+"[^#]+$");this._patterns.forEach(function(c){b.test(c.qualifiedId)&&
(c.include?this._processInclude(c,d,a):(c.index=d[0]++,a[c.id]=c))}.bind(this));var f=[];Object.keys(a).forEach(function(b){f.push(a[b])});return f},_addPattern:function(c,d,a){c.parentId=a;c.id=d;c.qualifiedId=c.parentId+"#"+c.id;this._patterns.push(c);c.patterns&&!c.include&&this._addPatterns(c.patterns,c.qualifiedId)},_addPatterns:function(c,d){c.forEach(function(a){this._addPattern(a,this._NO_ID+this._unnamedCounter++,d)}.bind(this))},_addRepositoryPatterns:function(c,d){Object.keys(c).forEach(function(a){this._addPattern(c[a],
a,d)}.bind(this))},_processInclude:function(c,d,a){var b,f=c.include.indexOf("#");b=0===f?RegExp("^"+c.qualifiedId.substring(0,c.qualifiedId.indexOf("#"))+c.include+"$"):-1===f?RegExp("^"+c.include+"#"+this._NO_ID+"[^#]+$"):RegExp("^"+c.include+"$");this._patterns.forEach(function(c){b.test(c.qualifiedId)&&(c.include?this._processInclude(c,d,a):a[c.id]||(c.index=d[0]++,a[c.id]=c))}.bind(this))},_NO_ID:"NoID"};c.prototype={adjustBounds:function(c,d){c<this.start&&(this.start+=d);c<this.contentStart&&
(this.contentStart+=d);c<=this.end&&(this.end+=d);c<=this.contentEnd&&(this.contentEnd+=d);this._subBlocks.forEach(function(a){c<=a.end&&a.adjustBounds(c,d)})},getBlocks:function(){return this._subBlocks},getBlockAtIndex:function(c){return l(this.getBlocks(),c,!0)},isRenderingWhitespace:function(){return this.styler._isRenderingWhitespace()}};k.prototype={getStyles:function(c){return this._styler.getStyles(c)}};h.prototype={addAnnotationProvider:function(c){"function"===typeof c&&this._annotationProviders.push(c)},
computeBlocks:function(c,d,a,b,f,h,k){return this._stylerAdapter.computeBlocks(c,d,a,b,f,h,k)},destroy:function(){if(this._view){var c=this._view.getModel();c.getBaseModel&&(c=c.getBaseModel());c.removeEventListener("Changed",this._listener.onChanged);this._view.removeEventListener("MouseDown",this._listener.onMouseDown);this._view.removeEventListener("Selection",this._listener.onSelection);this._view.removeEventListener("Destroy",this._listener.onDestroy);this._view.removeEventListener("LineStyle",
this._listener.onLineStyle);this._view=null}},getAnnotationModel:function(){return this._annotationModel},getBlockAtIndex:function(c){return this._findBlock(this._rootBlock,c)},getRootBlock:function(){return this._rootBlock},getStyleAccessor:function(){return this._accessor},getStyles:function(c){var d=[],a=this._view.getModel();a.getBaseModel&&(a=a.getBaseModel());var b=this._findBlock(this._rootBlock,c),f=a.getLineAtOffset(c),h=a.getLine(f),k=[];this._stylerAdapter.parse(h,a.getLineStart(f),b,k);
for((f=k[l(k,c,!0)])&&(f.start<=c&&c<f.end)&&d.push(f);b;)(f=this._stylerAdapter.computeStyle(b,a,c))&&d.splice(0,0,f),b=b.parent;return d},getTextModel:function(){var c=this._view.getModel();c.getBaseModel&&(c=c.getBaseModel());return c},removeAnnotationProvider:function(c){"function"===typeof c&&(c=this._annotationProviders.indexOf(c),-1!==c&&this._annotationProviders.splice(c,1))},setDetectHyperlinks:function(){},setDetectTasks:function(c){this._detectTasks=c},setFoldingEnabled:function(c){this._foldingEnabled=
c},setHighlightCaretLine:function(c){this._highlightCaretLine=c},setWhitespacesVisible:function(c,d){this._whitespacesVisible!==c&&(this._whitespacesVisible=c,d&&this._view.redraw())},_computeFolding:function(c,d,a){if(d.getBaseModel){var b=d.getBaseModel();c.forEach(function(c){var g=this._createFoldingAnnotation(d,b,c.start,c.end);g&&a.push(g);this._computeFolding(c.getBlocks(),d,a)}.bind(this))}},_computeTasks:function(c,d,a,b,f){b=b||c.start;f=f||c.end;if(c.start<=f&&b<=c.end&&this._annotationModel){var h=
p.AnnotationType.ANNOTATION_TASK;if(c.name&&0===c.name.indexOf("comment")){var k=[];this._stylerAdapter.parse(d.getText(c.contentStart,c.end),c.contentStart,c,k,!0);for(var e=0;e<k.length;e++)"meta.annotation.task.todo"===k[e].style&&(b<=k[e].start&&k[e].end<=f)&&a.push(p.AnnotationType.createAnnotation(h,k[e].start,k[e].end,d.getText(k[e].start,k[e].end)))}c.getBlocks().forEach(function(c){this._computeTasks(c,d,a,b,f)}.bind(this))}},_createFoldingAnnotation:function(c,d,a,b){var f=d.getLineAtOffset(a),
h=d.getLineAtOffset(b);return f===h||f+1===h&&d.getLineStart(h)===d.getLineEnd(h)?null:new (p.AnnotationType.getType(p.AnnotationType.ANNOTATION_FOLDING))(a,b,c)},_findBlock:function(c,d){var a=c.getBlocks();if(!a.length)return c;var b=l(a,d,!0);return b<a.length&&a[b].start<=d&&d<a[b].end?this._findBlock(a[b],d):c},_findBrackets:function(c,d,a,b,f){for(var h=[],k=[],e=b,m=d.getBlocks(),p=l(m,b,!0);p<m.length&&!(m[p].start>=f);p++){var r=m[p].start,s=m[p].end;e<r&&(this._stylerAdapter.parse(a.substring(e-
b,r-b),e,d,k),k.forEach(function(a){a.style&&(0===a.style.indexOf(c.beginName)?h.push(a.start+1):0===a.style.indexOf(c.endName)&&h.push(-(a.start+1)))}),k=[]);e=s}e<f&&(this._stylerAdapter.parse(a.substring(e-b,f-b),e,d,k),k.forEach(function(a){a.style&&(0===a.style.indexOf(c.beginName)?h.push(a.start+1):0===a.style.indexOf(c.endName)&&h.push(-(a.start+1)))}));return h},_findMatchingBracket:function(c,d,a){var b=c.getLineAtOffset(a),f=c.getLineEnd(b),h=c.getText(a,f),h=this._stylerAdapter.getBracketMatch(d,
h);if(!h)return-1;for(var k=c.getLine(b),e=c.getLineStart(b),f=this._findBrackets(h,d,k,e,f),l=0;l<f.length;l++)if(k=0<=f[l]?1:-1,f[l]*k-1===a){a=1;if(h.atStart){for(l++;l<f.length;l++)if(k=0<=f[l]?1:-1,a+=k,0===a)return f[l]*k-1;b+=1;for(l=c.getLineCount();b<l;){k=c.getLine(b);e=c.getLineStart(b);f=c.getLineEnd(b);f=this._findBrackets(h,d,k,e,f);for(e=0;e<f.length;e++)if(k=0<=f[e]?1:-1,a+=k,0===a)return f[e]*k-1;b++}}else{for(l--;0<=l;l--)if(k=0<=f[l]?1:-1,a+=k,0===a)return f[l]*k-1;for(b-=1;0<=
b;){k=c.getLine(b);e=c.getLineStart(b);f=c.getLineEnd(b);f=this._findBrackets(h,d,k,e,f);for(l=f.length-1;0<=l;l--)if(k=0<=f[l]?1:-1,a+=k,0===a)return f[l]*k-1;b--}}break}return-1},_getLineStyle:function(c){if(this._highlightCaretLine){var d=this._view.getModel(),a=this._view.getSelection();if(a.start===a.end&&d.getLineAtOffset(a.start)===c)return this._caretLineStyle}return null},_getStyles:function(c,d,a,b){d.getBaseModel&&(b=d.mapOffset(b));for(var f=b+a.length,h=[],k=b,e=c.getBlocks(),m=l(e,b,
!0);m<e.length&&!(e[m].start>=f);m++){var p=e[m].start,r=e[m].end;k<p&&this._stylerAdapter.parse(a.substring(k-b,p-b),k,c,h);var s=Math.max(k,p);s===p&&(p=this._stylerAdapter.getBlockStartStyle(e[m],a.substring(s-b),s,h))&&(s+=p.length);var p=Math.min(f,r),z=[];p===r&&(k=a.substring(p-k-(e[m].end-e[m].contentEnd)),(k=this._stylerAdapter.getBlockEndStyle(e[m],k,p,z))&&(p-=k.length));var k=this._getStyles(e[m],d,a.substring(s-b,p-b),s),D=this._stylerAdapter.getBlockContentStyleName(e[m]);if(D){var B=
s;k.forEach(function(a){a.start-B&&h.push({start:B,end:a.start,style:D});a.mergeable&&(a.style+=","+D);h.push(a);B=a.end});p-B&&h.push({start:B,end:p,style:D})}else h=h.concat(k);h=h.concat(z);k=r}k<f&&this._stylerAdapter.parse(a.substring(k-b,f-b),k,c,h);if(d.getBaseModel)for(c=0;c<h.length;c++)a=h[c].end-h[c].start,h[c].start=d.mapOffset(h[c].start,!0),h[c].end=h[c].start+a;return h},_isRenderingWhitespace:function(){return this._whitespacesVisible},_onDestroy:function(){this.destroy()},_onLineStyle:function(c){c.textView===
this._view&&(c.style=this._getLineStyle(c.lineIndex));c.ranges=this._getStyles(this._rootBlock,c.textView.getModel(),c.lineText,c.lineStart);c.ranges.forEach(function(c){c.style&&(c.style={styleClass:c.style.replace(/\./g," ")})});this._isRenderingWhitespace()&&(this._spliceStyles(this._spacePattern,c.ranges,c.lineText,c.lineStart),this._spliceStyles(this._tabPattern,c.ranges,c.lineText,c.lineStart))},_onModelChanged:function(c){var d=c.start,a=c.removedCharCount;c=c.addedCharCount-a;var b=this._view.getModel(),
f=b.getBaseModel?b.getBaseModel():b,a=d+a,h=f.getCharCount(),k=f.getLineStart(f.getLineAtOffset(d)),e=this._findBlock(this._rootBlock,d),m,r,s,w,z,D,B;do{s=e.parent;if(!m&&s){if(0>c&&e.end-d<=-c){e=s;continue}z=f.getText(e.start,Math.min(h,e.end+c+1));if(!this._stylerAdapter.verifyBlock(f,z,e,c)){e=s;continue}}r=e.getBlocks();var q=r.length,C=l(r,k,!0),y=l(r,a,!1,C-1,q);m=!1;if(C&&r.length&&r[C-1].end===d){z=f.getText(r[C-1].start,Math.min(h,d+1));var A=this.computeBlocks(f,z,e,r[C-1].start,null,
null,null);A.length&&A[0].end!==r[C-1].end&&(C--,m=!0)}C<q&&r[C].start<=k&&(k<r[C].end||m)?(B=r[C].start,B>d&&(B+=c)):C===q&&0<q&&e.end-c===r[q-1].end?(B=r[--C].start,B>d&&(B+=c)):B=Math.max(k,e.contentStart);D=y<q?r[y].end:e.contentEnd;d<=D&&(D+=c);D=Math.min(D,h-1);z=f.getText(B,D+1);A=this.computeBlocks(f,z,e,B,null,null,null);if(y<q){if(A.length&&A[A.length-1].end===D&&A[A.length-1].typeId===r[y].typeId)break;if(A.length&&this._stylerAdapter.blockSpansBeyondEnd(A[A.length-1])){y++;for(var G=A[A.length-
1].getBlocks(),G=(G.length?G[G.length-1]:A[A.length-1]).typeId;y<q;){if(r[y].typeId===G){var L=r[y].end+c,L=Math.min(L,h-1);z=f.getText(B,L+1);z=this.computeBlocks(f,z,e,B,null,null,null);if(z.length&&z[z.length-1].end===L){D=L;A=z;break}}y++}if(y<q)break}}else if(!A.length||A[A.length-1].end<=e.contentEnd+c)break;if(!s){D=h;y=q;z=f.getText(B,D);A=this.computeBlocks(f,z,e,B,null,null,null);break}e=s;w=!0}while(1);this._rootBlock.adjustBounds(d,c);y=Math.min(y+1,q);w||(w=y-C!==A.length);if(!w)for(q=
0;q<A.length;q++)if(m=r[C+q],h=A[q],m.start!==h.start||m.end!==h.end||m.typeId!==h.typeId){w=!0;break}!r.length&&!A.length?this.dispatchEvent({type:"BlocksChanged",oldBlocks:[e],newBlocks:[e]}):this.dispatchEvent({type:"BlocksChanged",oldBlocks:r.slice(C,y),newBlocks:A});C=[C,y-C].concat(A);Array.prototype.splice.apply(r,C);w&&(r=B,w=D,b!==f&&(r=b.mapOffset(r,!0),w=b.mapOffset(w,!0)),this._view.redrawRange(r,w));if(this._annotationModel){var J=[],K=[],I=[];r=this._annotationModel.getAnnotations(B,
D);w=this._foldingEnabled&&f!==b;for(C=e.parent||e;r.hasNext();)y=r.next(),w&&y.type===p.AnnotationType.ANNOTATION_FOLDING?(I.push(y),m=this._findBlock(C,y.start),!m||!(y.start===m.start&&y.end===m.end)?(J.push(y),y.expand()):(A=y.start,m=y.end,A>d&&(A-=c),m>d&&(m-=c),A<=d&&(d<m&&A<=a&&a<m)&&(A=f.getLineAtOffset(y.start),m=f.getLineAtOffset(y.end),A!==m?y.expanded||y.expand():J.push(y)))):y.type===p.AnnotationType.ANNOTATION_TASK&&e.start<=y.start&&y.end<=e.end&&J.push(y);w&&C.getBlocks().forEach(function(a){this._updateFolding(a,
f,b,I,K,B,D)}.bind(this));this._detectTasks&&this._computeTasks(e,f,K,B,D);this._annotationProviders.forEach(function(a){var b=[],c=[];a(this._annotationModel,f,e,B,D,b,c);J=J.concat(b);K=K.concat(c)}.bind(this));this._annotationModel.replaceAnnotations(J,K)}},_onMouseDown:function(c){if(2===c.clickCount){var d=this._view.getModel(),a=this._view.getOffsetAtLocation(c.x,c.y);if(0<a){var b=a-1,f=d;d.getBaseModel&&(b=d.mapOffset(b),f=d.getBaseModel());var h=this._findBlock(this._rootBlock,b),b=this._findMatchingBracket(f,
h,b);-1!==b&&(c.preventDefault(),c=b,d.getBaseModel&&(c=d.mapOffset(c,!0)),a>c&&(a--,c++),this._view.setSelection(c,a))}}},_onSelection:function(c){var d=c.oldValue,a=c.newValue;c=this._view.getModel();var b;if(this._highlightCaretLine){var f=c.getLineAtOffset(d.start);b=c.getLineAtOffset(a.start);var h=a.start===a.end,d=d.start===d.end;f===b&&d&&h||(d&&this._view.redrawLines(f,f+1),(f!==b||!d)&&h&&this._view.redrawLines(b,b+1))}if(this._annotationModel){var d=this._bracketAnnotations,k,e;if(a.start===
a.end&&0<(e=this._view.getCaretOffset()))e-=1,c.getBaseModel&&(e=c.mapOffset(e),c=c.getBaseModel()),a=this._findBlock(this._rootBlock,e),c=this._findMatchingBracket(c,a,e),-1!==c&&(k=[p.AnnotationType.createAnnotation(p.AnnotationType.ANNOTATION_MATCHING_BRACKET,c,c+1),p.AnnotationType.createAnnotation(p.AnnotationType.ANNOTATION_CURRENT_BRACKET,e,e+1)]);this._bracketAnnotations=k;this._annotationModel.replaceAnnotations(d,k)}},_spliceStyles:function(c,d,a,b){for(var f=c.regex,h=f.lastIndex=0,k=f.exec(a);k;){for(k=
b+k.index;h<d.length&&!(k<d[h].end);)h++;var e={start:k,end:k+1,style:c.style};if(h<d.length&&d[h].start<=k){var l={start:k+1,end:d[h].end,style:d[h].style};d[h].end=k;d.splice(h+1,0,l);d.splice(h+1,0,e);h+=2}else d.splice(h,0,e),h++;k=f.exec(a)}},_updateFolding:function(c,d,a,b,f,h,k){h=h||c.start;k=k||c.end;if(!c.doNotFold&&c.start<=k&&h<=c.end){var e=l(b,c.start,!0);e<b.length&&b[e].start===c.start&&b[e].end===c.end||(e=this._createFoldingAnnotation(a,d,c.start,c.end))&&f.push(e);c.getBlocks().forEach(function(c){this._updateFolding(c,
d,a,b,f,h,k)}.bind(this))}},_annotationProviders:[],_caretLineStyle:{styleClass:"meta annotation currentLine"},_spacePattern:{regex:/[ ]/g,style:{styleClass:"punctuation separator space",unmergeable:!0}},_tabPattern:{regex:/\t/g,style:{styleClass:"punctuation separator tab",unmergeable:!0}}};s.EventTarget.addMixin(h.prototype);return{TextStyler:h,Block:c,createPatternBasedAdapter:function(c,d){return new r(c,d)}}});
define("orion/editor/stylers/application_javascript/syntax",["orion/editor/stylers/lib/syntax"],function(p){var s="class const debugger delete enum export extends function implements import in instanceof interface let new package private protected public static super typeof var void with".split(" "),r="break case catch continue default do else finally for if return switch throw try while yield".split(" ");p=p.grammars;p.push({id:"orion.js",contentTypes:["application/javascript"],patterns:[{begin:"'(?:\\\\.|[^\\\\'])*\\\\$",
end:"^(?:$|(?:\\\\.|[^\\\\'])*('|[^\\\\]$))",name:"string.quoted.single.js"},{begin:'"(?:\\\\.|[^\\\\"])*\\\\$',end:'^(?:$|(?:\\\\.|[^\\\\"])*("|[^\\\\]$))',name:"string.quoted.double.js"},{include:"orion.lib#string_doubleQuote"},{include:"orion.lib#string_singleQuote"},{include:"orion.c-like#comment_singleLine"},{match:"/(?![\\s\\*])(?:\\\\.|[^/])+/(?:[gim]{0,3})",name:"string.regexp.js"},{include:"orion.lib#doc_block"},{include:"orion.c-like#comment_block"},{include:"#jsFunctionDef"},{include:"orion.lib#brace_open"},
{include:"orion.lib#brace_close"},{include:"orion.lib#bracket_open"},{include:"orion.lib#bracket_close"},{include:"orion.lib#parenthesis_open"},{include:"orion.lib#parenthesis_close"},{include:"orion.lib#number_decimal"},{include:"orion.lib#number_hex"},{match:"\\b(?:"+s.join("|")+")\\b",name:"keyword.operator.js"},{match:"\\b(?:"+r.join("|")+")\\b",name:"keyword.control.js"},{match:"\\b(?:false|null|true|undefined)\\b",name:"constant.language.js"},{match:"\\bthis\\b",name:"variable.language.js"}],
repository:{jsFunctionDef:{begin:"(function)(\\s+[_$a-zA-Z\\xA0-\\uFFFF][_$a-zA-Z0-9\u00a0-\uffff]*)?\\s*\\(",end:"\\)",captures:{1:{name:"keyword.operator.js"},2:{name:"entity.name.function.js"}},patterns:[{include:"orion.c-like#comment_singleLine"},{include:"orion.c-like#comment_block"},{match:"[^\\s,]+",name:"variable.parameter.js"}]}}});return{id:p[p.length-1].id,grammars:p,keywords:s.concat(r)}});
define("orion/editor/stylers/application_xml/syntax",["orion/editor/stylers/lib/syntax"],function(p){p=p.grammars;p.push({id:"orion.xml",contentTypes:["application/xml","application/xhtml+xml"],patterns:[{include:"#comment"},{include:"#doctype"},{include:"#xmlDeclaration"},{include:"#tag"},{include:"#ampersandEscape"}],repository:{ampersandEscape:{match:"\x26lt;|\x26gt;|\x26amp;",name:"constant.character"},comment:{begin:{match:"\x3c!--",literal:"\x3c!--"},end:{match:"--\x3e",literal:"--\x3e"},name:"comment.block.xml",
patterns:[{match:"(\\b)(TODO)(\\b)(((?!--\x3e).)*)",name:"meta.annotation.task.todo",captures:{2:{name:"keyword.other.documentation.task"},4:{name:"comment.line"}}}]},doctype:{begin:"\x3c!(?:doctype|DOCTYPE)",end:"\x3e",name:"meta.tag.doctype.xml",captures:{0:{name:"meta.tag.doctype.xml"}},patterns:[{include:"#comment"},{include:"orion.lib#string_doubleQuote"},{include:"orion.lib#string_singleQuote"}]},tag:{begin:"\x3c/?[A-Za-z0-9]+",end:"/?\x3e",captures:{0:{name:"meta.tag.xml"}},name:"meta.tag.xml",
patterns:[{include:"#comment"},{include:"orion.lib#string_doubleQuote"},{include:"orion.lib#string_singleQuote"}]},xmlDeclaration:{begin:"\x3c\\?xml",end:"\\?\x3e",captures:{0:{name:"meta.tag.declaration.xml"}},patterns:[{include:"#comment"},{include:"orion.lib#string_doubleQuote"},{include:"orion.lib#string_singleQuote"}],name:"meta.tag.declaration.xml"}}});return{id:p[p.length-1].id,grammars:p,keywords:[]}});
define("orion/editor/stylers/text_html/syntax",["orion/editor/stylers/lib/syntax","orion/editor/stylers/application_javascript/syntax","orion/editor/stylers/text_css/syntax","orion/editor/stylers/application_xml/syntax"],function(p,s,r,m){p=p.grammars.concat(s.grammars).concat(r.grammars).concat(m.grammars);p.push({id:"orion.html",contentTypes:["text/html"],patterns:[{begin:"(?i)(\x3cstyle)([^\x3e]*)(\x3e)",end:"(?i)(\x3c/style\x3e)",captures:{1:{name:"meta.tag.html"},3:{name:"meta.tag.html"}},contentName:"source.css.embedded.html",
patterns:[{include:"orion.css"}]},{begin:"(?i)\x3cscript\\s*\x3e|\x3cscript\\s.*?(?:language\\s*\x3d\\s*(['\"])javascript\\1|type\\s*\x3d\\s*(['\"])(?:text|application)/(?:javascript|ecmascript)\\2).*?\x3e",end:"(?i)\x3c/script\x3e",captures:{0:{name:"meta.tag.html"}},contentName:"source.js.embedded.html",patterns:[{include:"orion.js"}]},{include:"orion.xml#comment"},{include:"orion.xml#doctype"},{include:"orion.xml#tag"},{include:"orion.xml#ampersandEscape"}]});return{id:p[p.length-1].id,grammars:p,
keywords:[]}});
define("orion/editor/edit","require orion/editor/config orion/editor/shim orion/editor/textView orion/editor/textModel orion/editor/textTheme orion/editor/projectionTextModel orion/editor/eventTarget orion/keyBinding orion/editor/rulers orion/editor/annotations orion/editor/tooltip orion/editor/undoStack orion/editor/textDND orion/editor/editor orion/editor/editorFeatures orion/editor/contentAssist webtools/cssContentAssist webtools/htmlContentAssist orion/editor/AsyncStyler orion/editor/mirror orion/editor/textMateStyler orion/editor/htmlGrammar orion/editor/textStyler orion/editor/stylers/application_javascript/syntax orion/editor/stylers/text_css/syntax orion/editor/stylers/text_html/syntax".split(" "),function(p,
s,r,m,c,k,h,l,g,d,a,b,f,n,t,e,v,u,x,w,z,D,B,q,C,y,A){function G(a,b,c){for(var d;c&&c!==b&&"none"!==d;)d=a.getComputedStyle?a.getComputedStyle(c,null).getPropertyValue("display"):c.currentStyle.display,c=c.parentNode;return!c||!d?"none":d}function L(a){var b=a.firstChild;if(b&&"TEXTAREA"===b.tagName)return b.value;var c=a.ownerDocument,d=c.defaultView||c.parentWindow;if(!d.getSelection||1===a.childNodes.length&&b.nodeType===Node.TEXT_NODE||"none"===G(d,c,a))return a.innerText||a.textContent;b=c.createRange();
b.selectNode(a);a=d.getSelection();d=[];for(c=0;c<a.rangeCount;c++)d.push(a.getRangeAt(c));a.removeAllRanges();a.addRange(b);b=a.toString();a.removeAllRanges();for(c=0;c<d.length;c++)a.addRange(d[c]);return b}function J(a){if("data-editor-"===a.substring(0,12))return a=a.substring(12),a=a.replace(/-([a-z])/ig,function(a,b){return b.toUpperCase()})}function K(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}function I(a,b){var c={};K(c,b);for(var d,e=0,f=a.attributes,g=f.length;e<g;e++){d=f.item(e);
var h=J(d.nodeName);if(h){d=d.nodeValue;if("true"===d||"false"===d)d="true"===d;c[h]=d}}return c}function R(a,b){if(a.getElementsByClassName)return a.getElementsByClassName(b);b=b.replace(/ *$/,"");return a.querySelectorAll?a.querySelectorAll((" "+b).replace(/ +/g,".")):null}function O(a){var b=a.document||document,d=a.parent;d||(d="editor");"string"===typeof d&&(d=b.getElementById(d));if(!d&&a.className){var f=R(b,a.className);if(f){a.className=void 0;1<f.length&&void 0===a.noFocus&&(a.noFocus=!0);
for(var b=[],g=f.length-1;0<=g;g--)a.parent=f[g],b.push(O(a));return b}}if(!d)throw"no parent";a=I(d,a);if("string"===typeof a.theme){var f=k.TextTheme.getTheme(a.theme),l=a.theme.lastIndexOf("/"),n=a.theme;-1!==l&&(n=n.substring(l+1));".css"===n.substring(n.length-4)&&(n=n.substring(0,n.length-4));f.setThemeClass(n,{href:a.theme});a.theme=f}var r;a.readonly||(g={createContentAssistMode:function(a){r=new v.ContentAssist(a.getTextView());a=new v.ContentAssistWidget(r);a=new v.ContentAssistMode(r,a);
r.setMode(a);return a}});var s=new t.Editor({textViewFactory:function(){return new m.TextView({parent:d,model:new h.ProjectionTextModel(a.model?a.model:new c.TextModel("")),tabSize:a.tabSize?a.tabSize:4,readonly:a.readonly,fullSelection:a.fullSelection,tabMode:a.tabMode,expandTab:a.expandTab,singleMode:a.singleMode,themeClass:a.themeClass,theme:a.theme,wrapMode:a.wrapMode,wrappable:a.wrappable})},undoStackFactory:new e.UndoFactory,annotationFactory:new e.AnnotationFactory,lineNumberRulerFactory:new e.LineNumberRulerFactory,
foldingRulerFactory:new e.FoldingRulerFactory,textDNDFactory:new e.TextDNDFactory,contentAssistFactory:g,keyBindingFactory:new e.KeyBindingsFactory,statusReporter:a.statusReporter,domNode:d});s.addEventListener("TextViewInstalled",function(){var b=s.getLineNumberRuler();b&&void 0!==a.firstLineIndex&&b.setFirstLine(a.firstLineIndex);if(b=s.getSourceCodeActions())b.setAutoPairParentheses(a.autoPairParentheses),b.setAutoPairBraces(a.autoPairBraces),b.setAutoPairSquareBrackets(a.autoPairSquareBrackets),
b.setAutoPairAngleBrackets(a.autoPairAngleBrackets),b.setAutoPairQuotations(a.autoPairQuotations),b.setAutoCompleteComments(a.autoCompleteComments),b.setSmartIndentation(a.smartIndentation)});g=a.contents;void 0===g&&(g=L(d));g||(g="");s.installTextView();s.setLineNumberRulerVisible(void 0===a.showLinesRuler||a.showLinesRuler);s.setAnnotationRulerVisible(void 0===a.showAnnotationRuler||a.showFoldingRuler);s.setOverviewRulerVisible(void 0===a.showOverviewRuler||a.showOverviewRuler);s.setZoomRulerVisible(void 0===
a.showZoomRuler||a.showZoomRuler);s.setFoldingRulerVisible(void 0===a.showFoldingRuler||a.showFoldingRuler);s.setInput(a.title,null,g,!1,a.noFocus);({styler:null,highlight:function(b,c){this.styler&&this.styler.destroy&&this.styler.destroy();this.styler=null;"js"===b?b="application/javascript":"css"===b?b="text/css":"html"===b?b="text/html":"java"===b&&(b="text/x-java-source");var d=c.getTextView(),e=c.getAnnotationModel();b&&(b=b.replace(/[*|:/".<>?+]/g,"_"),p(["./stylers/"+b+"/syntax"],function(a){a=
new q.createPatternBasedAdapter(a.grammars,a.id);this.styler=new q.TextStyler(d,e,a)},function(a){}));"text/css"===b&&c.setFoldingRulerVisible(void 0===a.showFoldingRuler||a.showFoldingRuler)}}).highlight(a.contentType||a.lang,s);if(r){var w=new u.CssContentAssistProvider,y=new x.HTMLContentAssistProvider;r.addEventListener("Activating",function(){/css$/.test(a.lang)?r.setProviders([w]):/html$/.test(a.lang)&&r.setProviders([y])})}g=b.defaultView||b.parentWindow;!a.noComputeSize&&("none"!==G(g,b,d)&&
50>=d.clientHeight)&&(b=s.getTextView().computeSize().height,d.style.height=b+"px");return s}var P=this.orion?this.orion.editor:void 0;if(P){for(var M=0;M<arguments.length;M++)K(P,arguments[M]);P.edit=O}return O});var orion=this.orion||(this.orion={}),editor=orion.editor||(orion.editor={});