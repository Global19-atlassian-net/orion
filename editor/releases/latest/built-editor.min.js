/*

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation
  Mihai Sucan (Mozilla Foundation) - fix for Bug#334583 Bug#348471 Bug#349485 Bug#350595 Bug#360726 Bug#361180 Bug#362835 Bug#362428 Bug#362286 Bug#354270 Bug#361474 Bug#363945 Bug#366312 Bug#370584

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2009, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made
 available under the terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2014 IBM Corporation and others.
 Copyright (c) 2012 VMware, Inc.
 All rights reserved. This program and the accompanying materials are made
 available under the terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors:
     IBM Corporation - initial API and implementation
     Andrew Eisenberg - rename to jsTemplateContentAssist.js

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation 

 Copyright (c) 2011, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation 

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation 

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made
 available under the terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors: IBM Corporation - initial API and implementation
               Alex Lakatos - fix for bug#369781

 Copyright (c) 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation
 RequireJS i18n 2.0.2 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/requirejs/i18n for details

 Copyright (c) 2011, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation
*/
var requirejs,require,define;
(function(n){function q(a,d){var b,k,l,z,x,f,c,e,r,p=d&&d.split("/"),v=m.map,h=v&&v["*"]||{};if(a&&"."===a.charAt(0))if(d){p=p.slice(0,p.length-1);a=p.concat(a.split("/"));for(e=0;e<a.length;e+=1)if(b=a[e],"."===b)a.splice(e,1),e-=1;else if(".."===b)if(1===e&&(".."===a[2]||".."===a[0]))break;else 0<e&&(a.splice(e-1,2),e-=2);a=a.join("/")}else 0===a.indexOf("./")&&(a=a.substring(2));if((p||h)&&v){b=a.split("/");for(e=b.length;0<e;e-=1){k=b.slice(0,e).join("/");if(p)for(r=p.length;0<r;r-=1)if(l=v[p.slice(0,
r).join("/")])if(l=l[k]){z=l;x=e;break}if(z)break;!f&&(h&&h[k])&&(f=h[k],c=e)}!z&&f&&(z=f,x=c);z&&(b.splice(0,x,z),a=b.join("/"))}return a}function s(a,d){return function(){return b.apply(n,u.call(arguments,0).concat([a,d]))}}function g(a){return function(d){return q(d,a)}}function c(a){return function(d){k[a]=d}}function e(a){if(t.call(r,a)){var d=r[a];delete r[a];v[a]=!0;h.apply(n,d)}if(!t.call(k,a)&&!t.call(v,a))throw Error("No "+a);return k[a]}function f(a){var d,b=a?a.indexOf("!"):-1;-1<b&&(d=
a.substring(0,b),a=a.substring(b+1,a.length));return[d,a]}function p(a){return function(){return m&&m.config&&m.config[a]||{}}}var h,b,a,d,k={},r={},m={},v={},t=Object.prototype.hasOwnProperty,u=[].slice;a=function(a,d){var b,k=f(a),l=k[0];a=k[1];l&&(l=q(l,d),b=e(l));l?a=b&&b.normalize?b.normalize(a,g(d)):q(a,d):(a=q(a,d),k=f(a),l=k[0],a=k[1],l&&(b=e(l)));return{f:l?l+"!"+a:a,n:a,pr:l,p:b}};d={require:function(a){return s(a)},exports:function(a){var d=k[a];return"undefined"!==typeof d?d:k[a]={}},
module:function(a){return{id:a,uri:"",exports:k[a],config:p(a)}}};h=function(b,f,m,p){var l,z,x,C,F=[],h;p=p||b;if("function"===typeof m){f=!f.length&&m.length?["require","exports","module"]:f;for(C=0;C<f.length;C+=1)if(x=a(f[C],p),z=x.f,"require"===z)F[C]=d.require(b);else if("exports"===z)F[C]=d.exports(b),h=!0;else if("module"===z)l=F[C]=d.module(b);else if(t.call(k,z)||t.call(r,z)||t.call(v,z))F[C]=e(z);else if(x.p)x.p.load(x.n,s(p,!0),c(z),{}),F[C]=k[z];else throw Error(b+" missing "+z);f=m.apply(k[b],
F);if(b)if(l&&l.exports!==n&&l.exports!==k[b])k[b]=l.exports;else if(f!==n||!h)k[b]=f}else b&&(k[b]=m)};requirejs=require=b=function(k,f,c,r,l){if("string"===typeof k)return d[k]?d[k](f):e(a(k,f).f);k.splice||(m=k,f.splice?(k=f,f=c,c=null):k=n);f=f||function(){};"function"===typeof c&&(c=r,r=l);r?h(n,k,f,c):setTimeout(function(){h(n,k,f,c)},4);return b};b.config=function(a){m=a;return b};define=function(a,d,b){d.splice||(b=d,d=[]);!t.call(k,a)&&!t.call(r,a)&&(r[a]=[a,d,b])};define.amd={jQuery:!0}})();
define("almond",function(){});
define("orion/editor/shim",[],function(){Object.create||(Object.create=function(n,q){function s(){}s.prototype=n;var g=new s;if(q)for(var c in q)q.hasOwnProperty(c)&&(q[c].hasOwnProperty("value")?g[c]=q[c].value:g[c]=function(){if(0<arguments.length)return q[c].get();q[c].set(arguments)});return g});Object.keys||(Object.keys=function(n){var q=[],s;for(s in n)n.hasOwnProperty(s)&&q.push(s);return q});Function.prototype.bind||(Function.prototype.bind=function(n){var q=this,s=Array.prototype.slice.call(arguments,
1);return s.length?function(){return arguments.length?q.apply(n,s.concat(Array.prototype.slice.call(arguments))):q.apply(n,s)}:function(){return arguments.length?q.apply(n,arguments):q.call(n)}});Array.isArray||(Array.isArray=function(n){return"[object Array]"===Object.prototype.toString.call(n)});Array.prototype.indexOf||(Array.prototype.indexOf=function(n){for(var q=0;q<this.length;q++)if(this[q]===n)return q;return-1});Array.prototype.forEach||(Array.prototype.forEach=function(n){for(var q=0;q<
this.length;q++)n(this[q],q)});Array.prototype.map||(Array.prototype.map=function(n){for(var q=Array(this.length),s=0;s<this.length;s++)q[s]=n(this[s]);return q});Array.prototype.reduce||(Array.prototype.reduce=function(n,q){var s,g=!1;1<arguments.length&&(s=q,g=!0);for(var c=0;this.length>c;++c)g?s=n(s,this[c],c,this):(s=this[c],g=!0);return s});String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});String.prototype.trimLeft||(String.prototype.trimLeft=function(){return this.replace(/^\s+/g,
"")});String.prototype.trimRight||(String.prototype.trimRight=function(){return this.replace(/\s+$/g,"")});return{}});
(function(){function n(c,e,f,p,h,b){e[c]&&(f.push(c),(!0===e[c]||1===e[c])&&p.push(h+c+"/"+b))}function q(c,e,f,p,h){e=p+e+"/"+h;require._fileExists(c.toUrl(e+".js"))&&f.push(e)}function s(c,e,f){for(var p in e)e.hasOwnProperty(p)&&(!c.hasOwnProperty(p)||f)?c[p]=e[p]:"object"===typeof e[p]&&s(c[p],e[p],f)}var g=/(^.*(^|\/)nls(\/|$))([^\/]*)\/?([^\/]*)/;define("i18n",["module"],function(c){var e=c.config?c.config():{};return{version:"2.0.1+",load:function(f,c,h,b){b=b||{};b.locale&&(e.locale=b.locale);
var a=g.exec(f),d=a[1],k=a[4],r=a[5],m=k.split("-"),v=[],t={},u,y="";a[5]?(d=a[1],f=d+r):(r=a[4],k=e.locale,k||(k=e.locale="undefined"===typeof navigator?"root":(navigator.language||navigator.userLanguage||"root").toLowerCase()),m=k.split("-"));if(b.isBuild){v.push(f);q(c,"root",v,d,r);for(u=0;u<m.length;u++)b=m[u],y+=(y?"-":"")+b,q(c,y,v,d,r);c(v,function(){h()})}else c([f],function(a){var b=[],k;n("root",a,b,v,d,r);for(u=0;u<m.length;u++)k=m[u],y+=(y?"-":"")+k,n(y,a,b,v,d,r);c(v,function(){var l,
z,x;for(l=b.length-1;-1<l&&b[l];l--){x=b[l];z=a[x];if(!0===z||1===z)z=c(d+x+"/"+r);s(t,z)}h(t)})})}}})})();define("orion/editor/i18n",{load:function(n,q,s,g){q.specified&&q.specified("orion/bootstrap")?q(["orion/i18n!"+n],function(c){s(c)}):s({})}});
define("orion/editor/nls/root/messages",{multipleAnnotations:"Multiple annotations:",line:"Line: ${0}",breakpoint:"Breakpoint",bookmark:"Bookmark",task:"Task",error:"Error",warning:"Warning",matchingSearch:"Matching Search",currentSearch:"Current Search",currentLine:"Current Line",matchingBracket:"Matching Bracket",currentBracket:"Current Bracket",lineUp:"Line Up",lineDown:"Line Down",lineStart:"Line Start",lineEnd:"Line End",charPrevious:"Previous Character",charNext:"Next Character",pageUp:"Page Up",
pageDown:"Page Down",scrollPageUp:"Scroll Page Up",scrollPageDown:"Scroll Page Down",scrollLineUp:"Scroll Line Up",scrollLineDown:"Scroll Line Down",wordPrevious:"Previous Word",wordNext:"Next Word",textStart:"Document Start",textEnd:"Document End",scrollTextStart:"Scroll Document Start",scrollTextEnd:"Scroll Document End",centerLine:"Center Line",selectLineUp:"Select Line Up",selectLineDown:"Select Line Down",selectWholeLineUp:" Select Whole Line Up",selectWholeLineDown:"Select Whole Line Down",
selectLineStart:"Select Line Start",selectLineEnd:"Select Line End",selectCharPrevious:"Select Previous Character",selectCharNext:"Select Next Character",selectPageUp:"Select Page Up",selectPageDown:"Select Page Down",selectWordPrevious:"Select Previous Word",selectWordNext:"Select Next Word",selectTextStart:"Select Document Start",selectTextEnd:"Select Document End",deletePrevious:"Delete Previous Character",deleteNext:"Delete Next Character",deleteWordPrevious:"Delete Previous Word",deleteWordNext:"Delete Next Word",
deleteLineStart:"Delete Line Start",deleteLineEnd:"Delete Line End",tab:"Insert Tab",enter:"Insert Line Delimiter",enterNoCursor:"Insert Line Delimiter",selectAll:"Select All",copy:"Copy",cut:"Cut",paste:"Paste",uppercase:"To Upper Case",lowercase:"To Lower Case",capitalize:"Capitalize",reversecase:"Reverse Case",toggleWrapMode:"Toggle Wrap Mode",toggleTabMode:"Toggle Tab Mode",toggleOverwriteMode:"Toggle Overwrite Mode",committerOnTime:"${0} on ${1}",emacs:"Emacs",exchangeMarkPoint:"Exchange Mark and Point",
setMarkCommand:"Set Mark",clearMark:"Clear Mark",digitArgument:"Digit Argument ${0}",negativeArgument:"Negative Argument",Comment:"Comment","Flat outline":"Flat outline",incrementalFindStr:"Incremental find: ${0}",incrementalFindStrNotFound:"Incremental find: ${0} (not found)",incrementalFindReverseStr:"Reverse Incremental find: ${0}",incrementalFindReverseStrNotFound:"Reverse Incremental find: ${0} (not found)",find:"Find...",undo:"Undo",redo:"Redo",cancelMode:"Cancel Current Mode",findNext:"Find Next Occurrence",
findPrevious:"Find Previous Occurrence",incrementalFind:"Incremental Find",incrementalFindReverse:"Incremental Find Reverse",indentLines:"Indent Lines",unindentLines:"Unindent Lines",moveLinesUp:"Move Lines Up",moveLinesDown:"Move Lines Down",copyLinesUp:"Copy Lines Up",copyLinesDown:"Copy Lines Down",deleteLines:"Delete Lines",gotoLine:"Goto Line...",gotoLinePrompty:"Goto Line:",nextAnnotation:"Next Annotation",prevAnnotation:"Previous Annotation",expand:"Expand",collapse:"Collapse",expandAll:"Expand All",
collapseAll:"Collapse All",lastEdit:"Last Edit Location",trimTrailingWhitespaces:"Trim Trailing Whitespaces",toggleLineComment:"Toggle Line Comment",addBlockComment:"Add Block Comment",removeBlockComment:"Remove Block Comment",linkedModeEntered:"Linked Mode entered",linkedModeExited:"Linked Mode exited",syntaxError:"Syntax Error",contentAssist:"Content Assist",lineColumn:"Line ${0} : Col ${1}",vi:"vi",vimove:"(Move)",viyank:"(Yank)",videlete:"(Delete)",vichange:"(Change)",viLeft:"${0} Left",viRight:"${0} Right",
viUp:"${0} Up",viDown:"${0} Down",viw:"${0} Next Word",vib:"${0} Beginning of Word",viW:"${0} Next Word (ws stop)",viB:"${0} Beginning of Word (ws stop)",vie:"${0} End of Word",viE:"${0} End of Word (ws stop)",vi$:"${0} End of the line","vi^_":"${0} First non-blank Char Current Line","vi+":"${0} First Char Next Line","vi-":"${0} First Char Previous Line","vi|":"${0} nth Column in Line",viH:"${0} Top of Page",viM:"${0} Middle of Page",viL:"${0} Bottom of Page","vi/":"${0} Search Forward","vi?":"${0} Search Backward",
vin:"${0} Next Search",viN:"${0} Previous Search",vif:"${0} Search Char Fwd",viF:"${0} Search Char Bckwd",vit:"${0} Search Before Char Fwd",viT:"${0} Search Before Char Bckwd","vi,":"${0} Repeat Reverse Char Search","vi;":"${0} Repeat Char Search",viG:"${0} Go to Line",viycd:"${0} Current Line",via:"Append After Cursor",viA:"Append to End of Line",vii:"Insert Before Cursor",viI:"Insert at Beginning of Line",viO:"Insert Line Above",vio:"Insert Line Below",viR:"Begin Overwriting Text",vis:"Substitute a Character",
viS:"Substitute Entire Line",viC:"Change Text Until Line End",vip:"Paste After Char or Line",viP:"Paste Before Char or Line",viStar:"Search Word Under Cursor",replaceAll:"Replacing all...",replacedMatches:"Replaced ${0} matches",nothingReplaced:"Nothing replaced",notFound:"Not found"});
define("orion/editor/nls/messages",["orion/editor/i18n!orion/editor/nls/messages","orion/editor/nls/root/messages"],function(n,q){var s={root:q},g;for(g in n)n.hasOwnProperty(g)&&"undefined"===typeof s[g]&&(s[g]=n[g]);return s});
define("orion/editor/eventTarget",[],function(){function n(){}n.addMixin=function(q){var s=n.prototype,g;for(g in s)s.hasOwnProperty(g)&&(q[g]=s[g])};n.prototype={addEventListener:function(n,s,g){this._eventTypes||(this._eventTypes={});var c=this._eventTypes[n];c||(c=this._eventTypes[n]={level:0,listeners:[]});c.listeners.push({listener:s,useCapture:g})},dispatchEvent:function(n){var s=n.type;this._dispatchEvent("pre"+s,n);this._dispatchEvent(s,n);this._dispatchEvent("post"+s,n)},_dispatchEvent:function(n,
s){var g=this._eventTypes?this._eventTypes[n]:null;if(g){var c=g.listeners;try{if(g.level++,c)for(var e=0,f=c.length;e<f;e++)if(c[e]){var p=c[e].listener;"function"===typeof p?p.call(this,s):p.handleEvent&&"function"===typeof p.handleEvent&&p.handleEvent(s)}}finally{if(g.level--,g.compact&&0===g.level){for(e=c.length-1;0<=e;e--)c[e]||c.splice(e,1);0===c.length&&delete this._eventTypes[n];g.compact=!1}}}},isListening:function(n){return!this._eventTypes?!1:void 0!==this._eventTypes[n]},removeEventListener:function(n,
s,g){if(this._eventTypes){var c=this._eventTypes[n];if(c){for(var e=c.listeners,f=0,p=e.length;f<p;f++){var h=e[f];if(h&&h.listener===s&&h.useCapture===g){0!==c.level?(e[f]=null,c.compact=!0):e.splice(f,1);break}}0===e.length&&delete this._eventTypes[n]}}}};return{EventTarget:n}});define("orion/regex",[],function(){return{escape:function(n){return n.replace(/([\\$\^*\/+?\.\(\)|{}\[\]])/g,"\\$\x26")},parse:function(n){return(n=/^\s*\/(.+)\/([gim]{0,3})\s*$/.exec(n))?{pattern:n[1],flags:n[2]}:null}}});
define("orion/util",[],function(){var n=navigator.userAgent,q=-1!==n.indexOf("MSIE")||-1!==n.indexOf("Trident")?document.documentMode:void 0,s=parseFloat(n.split("Firefox/")[1]||n.split("Minefield/")[1])||void 0,g=-1!==n.indexOf("Opera")?parseFloat(n.split("Version/")[1]):void 0,c=parseFloat(n.split("Chrome/")[1])||void 0,e=-1!==n.indexOf("Safari")&&!c,f=parseFloat(n.split("WebKit/")[1])||void 0,p=-1!==n.indexOf("Android"),h=-1!==n.indexOf("iPad"),n=-1!==n.indexOf("iPhone"),b=h||n,a=-1!==navigator.platform.indexOf("Mac"),
d=-1!==navigator.platform.indexOf("Win"),k=-1!==navigator.platform.indexOf("Linux"),r="ontouchstart"in document.createElement("input");return{formatMessage:function(a){var d=arguments;return a.replace(/\$\{([^\}]+)\}/g,function(a,b){return d[(b<<0)+1]})},createElement:function(a,d){return a.createElementNS?a.createElementNS("http://www.w3.org/1999/xhtml",d):a.createElement(d)},isIE:q,isFirefox:s,isOpera:g,isChrome:c,isSafari:e,isWebkit:f,isAndroid:p,isIPad:h,isIPhone:n,isIOS:b,isMac:a,isWindows:d,
isLinux:k,isTouch:r,platformDelimiter:d?"\r\n":"\n"}});
define("orion/editor/textModel",["orion/editor/eventTarget","orion/regex","orion/util"],function(n,q,s){function g(c,e){this._lastLineIndex=-1;this._text=[""];this._lineOffsets=[0];this.setText(c);this.setLineDelimiter(e)}g.prototype={destroy:function(){},find:function(c){1<this._text.length&&(this._text=[this._text.join("")]);var e=c.string,f=c.regex,p=e,h="",b=c.caseInsensitive;if(p)if(f){if(e=q.parse(p))p=e.pattern,h=e.flags}else p=e.replace(/([\\$\^*\/+?\.\(\)|{}\[\]])/g,"\\$\x26"),b&&(p=p.replace(/[iI\u0130\u0131]/g,
"[Ii\u0130\u0131]"));var a=null,d;if(p){var e=c.reverse,k=c.wrap,f=c.wholeWord,r=c.start||0;c=c.end;var m=null!==c&&void 0!==c;-1===h.indexOf("g")&&(h+="g");-1===h.indexOf("m")&&(h+="m");b&&-1===h.indexOf("i")&&(h+="i");f&&(p="\\b"+p+"\\b");var v=this._text[0],g,u,y=0;m&&(b=r<c?r:c,v=v.substring(b,r<c?c:r),y=b);var n=RegExp(p,h);e?d=function(){var a=null;for(n.lastIndex=0;;){u=n.lastIndex;g=n.exec(v);if(u===n.lastIndex)return null;if(g){if(!(g.index+y<r)){if(!k||a)break;r=v.length+y}a={start:g.index+
y,end:n.lastIndex+y}}else break}a&&(r=a.start);return a}:(m||(n.lastIndex=r),d=function(){for(;;){u=n.lastIndex;g=n.exec(v);if(u===n.lastIndex)break;if(g)return{start:g.index+y,end:n.lastIndex+y};if(!(0!==u&&k))break}return null});a=d()}return{next:function(){var b=a;b&&(a=d());return b},hasNext:function(){return null!==a}}},getCharCount:function(){for(var c=0,e=0;e<this._text.length;e++)c+=this._text[e].length;return c},getLine:function(c,e){var f=this.getLineCount();if(!(0<=c&&c<f))return null;
var p=this._lineOffsets[c];if(c+1<f){f=this.getText(p,this._lineOffsets[c+1]);if(e)return f;for(var p=f.length,h;10===(h=f.charCodeAt(p-1))||13===h;)p--;return f.substring(0,p)}return this.getText(p)},getLineAtOffset:function(c){var e=this.getCharCount();if(!(0<=c&&c<=e))return-1;var f=this.getLineCount();if(c===e)return f-1;var p,h,b=this._lastLineIndex;if(0<=b&&b<f&&(p=this._lineOffsets[b],h=b+1<f?this._lineOffsets[b+1]:e,p<=c&&c<h))return b;for(var a=f,d=-1;1<a-d;)if(b=Math.floor((a+d)/2),p=this._lineOffsets[b],
h=b+1<f?this._lineOffsets[b+1]:e,c<=p)a=b;else if(c<h){a=b;break}else d=b;return this._lastLineIndex=a},getLineCount:function(){return this._lineOffsets.length},getLineDelimiter:function(){return this._lineDelimiter},getLineEnd:function(c,e){var f=this.getLineCount();if(!(0<=c&&c<f))return-1;if(c+1<f){f=this._lineOffsets[c+1];if(e)return f;for(var p=this.getText(Math.max(this._lineOffsets[c],f-2),f),h=p.length,b;10===(b=p.charCodeAt(h-1))||13===b;)h--;return f-(p.length-h)}return this.getCharCount()},
getLineStart:function(c){return!(0<=c&&c<this.getLineCount())?-1:this._lineOffsets[c]},getText:function(c,e){void 0===c&&(c=0);void 0===e&&(e=this.getCharCount());if(c===e)return"";for(var f=0,p=0,h;p<this._text.length;){h=this._text[p].length;if(c<=f+h)break;f+=h;p++}for(var b=f,a=p;p<this._text.length;){h=this._text[p].length;if(e<=f+h)break;f+=h;p++}if(a===p)return this._text[a].substring(c-b,e-f);b=this._text[a].substring(c-b);f=this._text[p].substring(0,e-f);return b+this._text.slice(a+1,p).join("")+
f},onChanging:function(c){return this.dispatchEvent(c)},onChanged:function(c){return this.dispatchEvent(c)},setLineDelimiter:function(c,e){"auto"===c&&(c=void 0,1<this.getLineCount()&&(c=this.getText(this.getLineEnd(0),this.getLineEnd(0,!0))));this._lineDelimiter=c?c:s.platformDelimiter;if(e){var f=this.getLineCount();if(1<f){for(var p=Array(f),h=0;h<f;h++)p[h]=this.getLine(h);this.setText(p.join(this._lineDelimiter))}}},setText:function(c,e,f){void 0===c&&(c="");void 0===e&&(e=0);void 0===f&&(f=
this.getCharCount());if(!(e===f&&""===c)){for(var p=this.getLineAtOffset(e),h=this.getLineAtOffset(f),b=e,a=f-e,d=h-p,k=c.length,r=0,m=this.getLineCount(),v=0,g=0,u=0,n=[];;){-1!==v&&v<=u&&(v=c.indexOf("\r",u));-1!==g&&g<=u&&(g=c.indexOf("\n",u));if(-1===g&&-1===v)break;u=-1!==v&&-1!==g?v+1===g?g+1:(v<g?v:g)+1:-1!==v?v+1:g+1;n.push(e+u);r++}this.onChanging({type:"Changing",text:c,start:b,removedCharCount:a,addedCharCount:k,removedLineCount:d,addedLineCount:r});0===n.length&&(u=this.getLineStart(p),
h=h+1<m?this.getLineStart(h+1):this.getCharCount(),e!==u&&(c=this.getText(u,e)+c,e=u),f!==h&&(c+=this.getText(f,h),f=h));u=k-a;for(h=p+d+1;h<m;h++)this._lineOffsets[h]+=u;if(5E4>n.length)p=[p+1,d].concat(n),Array.prototype.splice.apply(this._lineOffsets,p);else{u=p+1;this._lineOffsets.splice(u,d);for(m=0;m<n.length;m+=5E4)p=[u,0].concat(n.slice(m,Math.min(n.length,m+5E4))),Array.prototype.splice.apply(this._lineOffsets,p),u+=5E4}for(u=m=0;u<this._text.length;){h=this._text[u].length;if(e<=m+h)break;
m+=h;u++}p=m;for(n=u;u<this._text.length;){h=this._text[u].length;if(f<=m+h)break;m+=h;u++}h=this._text[u];e=this._text[n].substring(0,e-p);f=h.substring(f-m);n=[n,u-n+1];e&&n.push(e);c&&n.push(c);f&&n.push(f);Array.prototype.splice.apply(this._text,n);0===this._text.length&&(this._text=[""]);this.onChanged({type:"Changed",start:b,removedCharCount:a,addedCharCount:k,removedLineCount:d,addedLineCount:r})}}};n.EventTarget.addMixin(g.prototype);return{TextModel:g}});
define("orion/keyBinding",["orion/util"],function(n){function q(g,c,e,f,p,h){this.type=h||"keydown";this.keyCode="string"===typeof g&&"keydown"===this.type?g.toUpperCase().charCodeAt(0):g;this.mod1=void 0!==c&&null!==c?c:!1;this.mod2=void 0!==e&&null!==e?e:!1;this.mod3=void 0!==f&&null!==f?f:!1;this.mod4=void 0!==p&&null!==p?p:!1}function s(g){this.keys=g}q.prototype={getKeys:function(){return[this]},match:function(g,c){if(void 0!==c){if(0!==c)return!1}else if(g instanceof Array){if(1<g.length)return!1;
g=g[0]}return g.type!==this.type?!1:this.keyCode===g.keyCode||this.keyCode===String.fromCharCode(n.isOpera?g.which:void 0!==g.charCode?g.charCode:g.keyCode)?this.mod1!==(n.isMac?g.metaKey:g.ctrlKey)||"keydown"===this.type&&this.mod2!==g.shiftKey||this.mod3!==g.altKey||n.isMac&&this.mod4!==g.ctrlKey?!1:!0:!1},equals:function(g){return!g||this.keyCode!==g.keyCode||this.mod1!==g.mod1||this.mod2!==g.mod2||this.mod3!==g.mod3||this.mod4!==g.mod4||this.type!==g.type?!1:!0}};s.prototype={getKeys:function(){return this.keys.slice(0)},
match:function(g,c){var e=this.keys;if(void 0!==c)return c>e.length?!1:e[c].match(g)?c===e.length-1?!0:c+1:!1;g instanceof Array||(g=[g]);if(g.length>e.length)return!1;var f;for(f=0;f<g.length;f++)if(!e[f].match(g[f]))return!1;return f===e.length?!0:f},equals:function(g){if(!g.keys||g.keys.length!==this.keys.length)return!1;for(var c=0;c<g.keys.length;c++)if(!g.keys[c].equals(this.keys[c]))return!1;return!0}};return{KeyBinding:q,KeyStroke:q,KeySequence:s}});
define("orion/editor/keyModes",["orion/keyBinding","orion/util"],function(n,q){function s(c){c&&(this._view=c,this._keyBindings=this.createKeyBindings(),this._keyBindingIndex=0)}function g(c){s.call(this,c)}s.prototype={createKeyBindings:function(){return[]},getKeyBindings:function(c){for(var e=[],f=this._keyBindings,p=0;p<f.length;p++)f[p].actionID===c&&e.push(f[p].keyBinding);return e},getView:function(){return this._view},isActive:function(){return-1!==this._view.getKeyModes().indexOf(this)},match:function(c){if("keydown"===
c.type)switch(c.keyCode){case 16:case 17:case 18:case 91:return}for(var e=this._keyBindingIndex,f=this._matchingKeyBindings||this._keyBindings,p=[],h=0;h<f.length;h++){var b=f[h],a=b.keyBinding.match(c,e);if(!0===a)return this._keyBindingIndex=0,this._matchingKeyBindings=null,b.actionID;"number"===typeof a&&p.push(b)}if(0===p.length)this._keyBindingIndex=0,this._matchingKeyBindings=null;else return this._keyBindingIndex++,this._matchingKeyBindings=p,"noop"},setKeyBinding:function(c,e){for(var f=this._keyBindings,
p=0;p<f.length;p++){var h=f[p];if(h.keyBinding.equals(c)){e?h.actionID=e:h.predefined?h.actionID="noop":f.splice(p,1);return}}e&&f.push({keyBinding:c,actionID:e})},setView:function(c){this._view=c}};g.prototype=new s;g.prototype.createKeyBindings=function(){var c=n.KeyBinding,e=[];e.push({actionID:"lineUp",keyBinding:new c(38),predefined:!0});e.push({actionID:"lineDown",keyBinding:new c(40),predefined:!0});e.push({actionID:"charPrevious",keyBinding:new c(37),predefined:!0});e.push({actionID:"charNext",
keyBinding:new c(39),predefined:!0});q.isMac?(e.push({actionID:"scrollPageUp",keyBinding:new c(33),predefined:!0}),e.push({actionID:"scrollPageDown",keyBinding:new c(34),predefined:!0}),e.push({actionID:"pageUp",keyBinding:new c(33,null,null,!0),predefined:!0}),e.push({actionID:"pageDown",keyBinding:new c(34,null,null,!0),predefined:!0}),e.push({actionID:"lineStart",keyBinding:new c(37,!0),predefined:!0}),e.push({actionID:"lineEnd",keyBinding:new c(39,!0),predefined:!0}),e.push({actionID:"wordPrevious",
keyBinding:new c(37,null,null,!0),predefined:!0}),e.push({actionID:"wordNext",keyBinding:new c(39,null,null,!0),predefined:!0}),e.push({actionID:"scrollTextStart",keyBinding:new c(36),predefined:!0}),e.push({actionID:"scrollTextEnd",keyBinding:new c(35),predefined:!0}),e.push({actionID:"textStart",keyBinding:new c(38,!0),predefined:!0}),e.push({actionID:"textEnd",keyBinding:new c(40,!0),predefined:!0}),e.push({actionID:"scrollPageUp",keyBinding:new c(38,null,null,null,!0),predefined:!0}),e.push({actionID:"scrollPageDown",
keyBinding:new c(40,null,null,null,!0),predefined:!0}),e.push({actionID:"lineStart",keyBinding:new c(37,null,null,null,!0),predefined:!0}),e.push({actionID:"lineEnd",keyBinding:new c(39,null,null,null,!0),predefined:!0}),e.push({actionID:"lineStart",keyBinding:new c(38,null,null,!0),predefined:!0}),e.push({actionID:"lineEnd",keyBinding:new c(40,null,null,!0),predefined:!0})):(e.push({actionID:"pageUp",keyBinding:new c(33),predefined:!0}),e.push({actionID:"pageDown",keyBinding:new c(34),predefined:!0}),
e.push({actionID:"lineStart",keyBinding:new c(36),predefined:!0}),e.push({actionID:"lineEnd",keyBinding:new c(35),predefined:!0}),e.push({actionID:"wordPrevious",keyBinding:new c(37,!0),predefined:!0}),e.push({actionID:"wordNext",keyBinding:new c(39,!0),predefined:!0}),e.push({actionID:"textStart",keyBinding:new c(36,!0),predefined:!0}),e.push({actionID:"textEnd",keyBinding:new c(35,!0),predefined:!0}));q.isFirefox&&q.isLinux&&(e.push({actionID:"lineUp",keyBinding:new c(38,!0),predefined:!0}),e.push({actionID:"lineDown",
keyBinding:new c(40,!0),predefined:!0}));q.isWindows&&(e.push({actionID:"scrollLineUp",keyBinding:new c(38,!0),predefined:!0}),e.push({actionID:"scrollLineDown",keyBinding:new c(40,!0),predefined:!0}));e.push({actionID:"selectLineUp",keyBinding:new c(38,null,!0),predefined:!0});e.push({actionID:"selectLineDown",keyBinding:new c(40,null,!0),predefined:!0});e.push({actionID:"selectCharPrevious",keyBinding:new c(37,null,!0),predefined:!0});e.push({actionID:"selectCharNext",keyBinding:new c(39,null,!0),
predefined:!0});e.push({actionID:"selectPageUp",keyBinding:new c(33,null,!0),predefined:!0});e.push({actionID:"selectPageDown",keyBinding:new c(34,null,!0),predefined:!0});q.isMac?(e.push({actionID:"selectLineStart",keyBinding:new c(37,!0,!0),predefined:!0}),e.push({actionID:"selectLineEnd",keyBinding:new c(39,!0,!0),predefined:!0}),e.push({actionID:"selectWordPrevious",keyBinding:new c(37,null,!0,!0),predefined:!0}),e.push({actionID:"selectWordNext",keyBinding:new c(39,null,!0,!0),predefined:!0}),
e.push({actionID:"selectTextStart",keyBinding:new c(36,null,!0),predefined:!0}),e.push({actionID:"selectTextEnd",keyBinding:new c(35,null,!0),predefined:!0}),e.push({actionID:"selectTextStart",keyBinding:new c(38,!0,!0),predefined:!0}),e.push({actionID:"selectTextEnd",keyBinding:new c(40,!0,!0),predefined:!0}),e.push({actionID:"selectLineStart",keyBinding:new c(37,null,!0,null,!0),predefined:!0}),e.push({actionID:"selectLineEnd",keyBinding:new c(39,null,!0,null,!0),predefined:!0}),e.push({actionID:"selectLineStart",
keyBinding:new c(38,null,!0,!0),predefined:!0}),e.push({actionID:"selectLineEnd",keyBinding:new c(40,null,!0,!0),predefined:!0})):(q.isLinux&&(e.push({actionID:"selectWholeLineUp",keyBinding:new c(38,!0,!0),predefined:!0}),e.push({actionID:"selectWholeLineDown",keyBinding:new c(40,!0,!0),predefined:!0})),e.push({actionID:"selectLineStart",keyBinding:new c(36,null,!0),predefined:!0}),e.push({actionID:"selectLineEnd",keyBinding:new c(35,null,!0),predefined:!0}),e.push({actionID:"selectWordPrevious",
keyBinding:new c(37,!0,!0),predefined:!0}),e.push({actionID:"selectWordNext",keyBinding:new c(39,!0,!0),predefined:!0}),e.push({actionID:"selectTextStart",keyBinding:new c(36,!0,!0),predefined:!0}),e.push({actionID:"selectTextEnd",keyBinding:new c(35,!0,!0),predefined:!0}));e.push({actionID:"undo",keyBinding:new n.KeyBinding("z",!0),predefined:!0});q.isMac?e.push({actionID:"redo",keyBinding:new n.KeyBinding("z",!0,!0),predefined:!0}):e.push({actionID:"redo",keyBinding:new n.KeyBinding("y",!0),predefined:!0});
e.push({actionID:"deletePrevious",keyBinding:new c(8),predefined:!0});e.push({actionID:"deletePrevious",keyBinding:new c(8,null,!0),predefined:!0});e.push({actionID:"deleteNext",keyBinding:new c(46),predefined:!0});e.push({actionID:"deleteWordPrevious",keyBinding:new c(8,!0),predefined:!0});e.push({actionID:"deleteWordPrevious",keyBinding:new c(8,!0,!0),predefined:!0});e.push({actionID:"deleteWordNext",keyBinding:new c(46,!0),predefined:!0});e.push({actionID:"tab",keyBinding:new c(9),predefined:!0});
e.push({actionID:"shiftTab",keyBinding:new c(9,null,!0),predefined:!0});e.push({actionID:"enter",keyBinding:new c(13),predefined:!0});e.push({actionID:"enter",keyBinding:new c(13,null,!0),predefined:!0});e.push({actionID:"selectAll",keyBinding:new c("a",!0),predefined:!0});e.push({actionID:"toggleTabMode",keyBinding:new c("m",!0),predefined:!0});q.isMac&&(e.push({actionID:"deleteNext",keyBinding:new c(46,null,!0),predefined:!0}),e.push({actionID:"deleteWordPrevious",keyBinding:new c(8,null,null,!0),
predefined:!0}),e.push({actionID:"deleteWordNext",keyBinding:new c(46,null,null,!0),predefined:!0}));e.push({actionID:"toggleWrapMode",keyBinding:new n.KeyBinding("w",!0,!1,!0)});e.push({actionID:"toggleOverwriteMode",keyBinding:new n.KeyBinding(45)});if(!q.isFirefox){var f=q.isMac&&q.isChrome;e.push({actionID:"noop",keyBinding:new c("u",!f,!1,!1,f),predefined:!0});e.push({actionID:"noop",keyBinding:new c("i",!f,!1,!1,f),predefined:!0});e.push({actionID:"noop",keyBinding:new c("b",!f,!1,!1,f),predefined:!0})}q.isFirefox&&
(e.push({actionID:"copy",keyBinding:new c(45,!0),predefined:!0}),e.push({actionID:"paste",keyBinding:new c(45,null,!0),predefined:!0}),e.push({actionID:"cut",keyBinding:new c(46,null,!0),predefined:!0}));q.isMac&&(e.push({actionID:"lineStart",keyBinding:new c("a",!1,!1,!1,!0),predefined:!0}),e.push({actionID:"lineEnd",keyBinding:new c("e",!1,!1,!1,!0),predefined:!0}),e.push({actionID:"lineUp",keyBinding:new c("p",!1,!1,!1,!0),predefined:!0}),e.push({actionID:"lineDown",keyBinding:new c("n",!1,!1,
!1,!0),predefined:!0}),e.push({actionID:"charPrevious",keyBinding:new c("b",!1,!1,!1,!0),predefined:!0}),e.push({actionID:"charNext",keyBinding:new c("f",!1,!1,!1,!0),predefined:!0}),e.push({actionID:"deletePrevious",keyBinding:new c("h",!1,!1,!1,!0),predefined:!0}),e.push({actionID:"deleteNext",keyBinding:new c("d",!1,!1,!1,!0),predefined:!0}),e.push({actionID:"deleteLineEnd",keyBinding:new c("k",!1,!1,!1,!0),predefined:!0}),q.isFirefox?(e.push({actionID:"scrollPageDown",keyBinding:new c("v",!1,
!1,!1,!0),predefined:!0}),e.push({actionID:"deleteLineStart",keyBinding:new c("u",!1,!1,!1,!0),predefined:!0}),e.push({actionID:"deleteWordPrevious",keyBinding:new c("w",!1,!1,!1,!0),predefined:!0})):(e.push({actionID:"pageDown",keyBinding:new c("v",!1,!1,!1,!0),predefined:!0}),e.push({actionID:"centerLine",keyBinding:new c("l",!1,!1,!1,!0),predefined:!0}),e.push({actionID:"enterNoCursor",keyBinding:new c("o",!1,!1,!1,!0),predefined:!0})));return e};return{KeyMode:s,DefaultKeyMode:g}});
define("orion/editor/textTheme",["require","orion/editor/eventTarget","orion/util"],function(n,q,s){function g(c){c=c||{};this._document=c.document||document}var c={};g.getTheme=function(e){e=e||"default";var f=c[e];f||(f=c[e]=new g);return f};g.prototype={getThemeClass:function(){return this._themeClass},setThemeClass:function(c,f){var p=this,h=p._themeClass;p._themeClass=c;this._load(c,f,function(){p.onThemeChanged({type:"ThemeChanged",oldValue:h,newValue:p.getThemeClass()})})},onThemeChanged:function(c){return this.dispatchEvent(c)},
buildStyleSheet:function(c,f){function p(b,a,d){a&&(h.push("."+c+" ."+b+" {"),h.push("\t"+(d?"background-color":"color")+": "+a+";"),h.push("}"))}var h=[];h.push("");h.push("."+c+" {");f.fontFamily&&h.push("\tfont-family: "+f.fontFamily+";");f.fontSize&&h.push("\tfont-size: "+f.fontSize+";");f.fontSize&&h.push("\tcolor: "+f.text+";");h.push("}");h.push("."+c+".textview {");f.background&&h.push("\tbackground-color: "+f.background+";");h.push("}");p("ruler.annotations",f.annotationRuler,!0);p("ruler.lines",
f.annotationRuler,!0);p("ruler.folding",f.annotationRuler,!0);p("ruler.overview",f.overviewRuler,!0);p("rulerLines",f.lineNumber,!1);p("rulerLines.even",f.lineNumberEven,!1);p("rulerLines.odd",f.lineNumberOdd,!1);p("annotationLine.currentLine",f.currentLine,!0);p("entity-name-tag",f.keyword,!1);p("entity-other-attribute-name",f.attribute,!1);p("string-quoted",f.string,!1);p("meta.annotation.currentLine",f.currentLine,!0);p("keyword",f.keyword,!1);p("string",f.string,!1);p("comment",f.comment,!1);
p("comment.block.documentation",f.comment,!1);p("keyword.other.documentation.markup",f.comment,!1);return h.join("\n")},_createStyle:function(c,f,p,h){var b=this._document;c="orion-theme-"+c;var a=b.getElementById(c);if(a){if(h||a.firstChild.data===f)return;a.removeChild(a.firstChild);a.appendChild(b.createTextNode(f))}else h?(a=s.createElement(b,"link"),a.rel="stylesheet",a.type="text/css",a.href=f,a.addEventListener("load",function(){p()})):(a=s.createElement(b,"style"),a.appendChild(b.createTextNode(f))),
a.id=c,(b.getElementsByTagName("head")[0]||b.documentElement).appendChild(a);h||p()},_load:function(c,f,p){if(c)if("string"===typeof f)this._createStyle(c,f,p);else if(f=f.href,".css"!==f.substring(f.length-4)&&(f+=".css"),/^\//.test(f)||/[a-zA-Z0-9]+:\/\//i.test(f)||!n.toUrl)this._createStyle(c,f,p,!0);else{var h=this;n(["text!"+f],function(b){h._createStyle(c,b,p,!1)})}else p()}};q.EventTarget.addMixin(g.prototype);return{TextTheme:g}});
define("orion/editor/util",[],function(){return{contains:function(n,q){if(!q)return!1;if(!n.compareDocumentPosition){for(var s=q;s;){if(n===s)return!0;s=s.parentNode}return!1}return n===q||0!==(n.compareDocumentPosition(q)&16)},addEventListener:function(n,q,s,g){"function"===typeof n.addEventListener?n.addEventListener(q,s,!0===g):n.attachEvent("on"+q,s)},removeEventListener:function(n,q,s,g){"function"===typeof n.removeEventListener?n.removeEventListener(q,s,!0===g):n.detachEvent("on"+q,s)}}});
define("orion/editor/textView","i18n!orion/editor/nls/messages orion/editor/textModel orion/editor/keyModes orion/editor/eventTarget orion/editor/textTheme orion/editor/util orion/util".split(" "),function(n,q,s,g,c,e,f){function p(l,a,x){if(x){a.className="";x=a.attributes;for(var d=x.length;0<d--;)(!f.isIE||9<=f.isIE||9>f.isIE&&x[d].specified)&&a.removeAttribute(x[d].name)}if(l){l.styleClass&&(a.className=l.styleClass);if(x=l.style)for(var b in x)x.hasOwnProperty(b)&&(a.style[b]=x[b]);if(l=l.attributes)for(var k in l)l.hasOwnProperty(k)&&
a.setAttribute(k,l[k])}}function h(l){return l instanceof Array?l.slice(0):l}function b(l,a){if(!l)return a;if(!a)return l;for(var x in a)a.hasOwnProperty(x)&&(l.hasOwnProperty(x)||(l[x]=a[x]));return l}function a(l,z){if(l===z)return!0;if(l&&!z||!l&&z||l&&l.constructor===String||z&&z.constructor===String)return!1;if(l instanceof Array||z instanceof Array){if(!(l instanceof Array&&z instanceof Array)||l.length!==z.length)return!1;for(var x=0;x<l.length;x++)if(!a(l[x],z[x]))return!1;return!0}if(!(l instanceof
Object)||!(z instanceof Object))return!1;for(x in l)if(l.hasOwnProperty(x)&&(!z.hasOwnProperty(x)||!a(l[x],z[x])))return!1;for(x in z)if(!l.hasOwnProperty(x))return!1;return!0}function d(l,a,x){for(var d=0,b=0,k=0,c=l.length;k<c;){-1!==d&&d<=k&&(d=l.indexOf("\r",k));-1!==b&&b<=k&&(b=l.indexOf("\n",k));var f=k,m;if(-1===b&&-1===d){a(l.substring(k));break}-1!==d&&-1!==b?d+1===b?(m=d,k=b+1):(m=d<b?d:b,k=(d<b?d:b)+1):-1!==d?(m=d,k=d+1):(m=b,k=b+1);a(l.substring(f,m));x()}}function k(l){var a,x,d,b,k=
l.ownerDocument.defaultView||l.ownerDocument.parentWindow;k.getComputedStyle?(l=k.getComputedStyle(l,null),a=l.getPropertyValue("padding-left"),x=l.getPropertyValue("padding-top"),d=l.getPropertyValue("padding-right"),b=l.getPropertyValue("padding-bottom")):l.currentStyle&&(a=l.currentStyle.paddingLeft,x=l.currentStyle.paddingTop,d=l.currentStyle.paddingRight,b=l.currentStyle.paddingBottom);return{left:parseInt(a,10)||0,top:parseInt(x,10)||0,right:parseInt(d,10)||0,bottom:parseInt(b,10)||0}}function r(l){var a,
x,d,b,c=l._trim;if(!c){var c=k(l),f=l.ownerDocument.defaultView||l.ownerDocument.parentWindow;f.getComputedStyle?(b=f.getComputedStyle(l,null),a=b.getPropertyValue("border-left-width"),x=b.getPropertyValue("border-top-width"),d=b.getPropertyValue("border-right-width"),b=b.getPropertyValue("border-bottom-width")):l.currentStyle&&(a=l.currentStyle.borderLeftWidth,x=l.currentStyle.borderTopWidth,d=l.currentStyle.borderRightWidth,b=l.currentStyle.borderBottomWidth);a=parseInt(a,10)||0;x=parseInt(x,10)||
0;d=parseInt(d,10)||0;b=parseInt(b,10)||0;c.left+=a;c.top+=x;c.right+=d;c.bottom+=b;l._trim=c}return c}function m(l,a,x,d){function b(a){if(a.animationName===c){var z=a.target;"function"===typeof z.__DOMReady&&(l.defaultView||l.parentWindow).setTimeout(function(){z.__DOMReady()},0)}}function k(l,a){for(var z=["","-webkit-","-moz-","-ms-","-o-"],x="",d="body ."+l+" {\n",b=0;b<z.length;b++)x+="@"+z[b]+"keyframes "+a+" {\nfrom { opacity: 0.99; }\nto { opacity: 1; }\n}\n",d+=z[b]+"animation-duration: 0.001s;\n"+
z[b]+"animation-name: "+a+";\n";return x+(d+"}")}x="_"+x+"DOMReady";a.classList.add(x);a.__DOMReady=d;d=x+"Style";if(!l.getElementById(d)){var c=x+"Animation";l.addEventListener("animationstart",b,!1);l.addEventListener("MSAnimationStart",b,!1);l.addEventListener("webkitAnimationStart",b,!1);a=l.createElement("style");a.id=d;d=l.getElementsByTagName("head")[0]||l.documentElement;a.appendChild(l.createTextNode(k(x,c)));d.insertBefore(a,d.firstChild)}}function v(l,a,x){this.start=l;this.end=a;this.caret=
x}function t(l){this.left=l.left;this.top=l.top;this.right=l.right;this.bottom=l.bottom}function u(l,a,x){this.view=l;this.lineIndex=a;this._lineDiv=x}function y(l){this._init(l||{})}var A=e.addEventListener,w=e.removeEventListener,B=function(){function l(l){this.options=l}l.prototype.play=function(){var l="number"===typeof this.options.duration?this.options.duration:350,a=this.options.easing||this.defaultEasing,d=this.options.onAnimate||function(){},b=this.options.curve[0],k=this.options.curve[1],
c=k-b,f=-1,m,e=this;this.interval=this.options.window.setInterval(function(){f=-1===f?(new Date).getTime():f;var r=((new Date).getTime()-f)/l;1>r?(r=a(r),m=b+r*c,d(m)):(d(k),e.stop())},"number"===typeof this.options.rate?this.options.rate:20)};l.prototype.stop=function(){this.options.window.clearInterval(this.interval);(this.options.onEnd||function(){})()};l.prototype.defaultEasing=function(l){return Math.sin(l*(Math.PI/2))};return l}();v.prototype={clone:function(){return new v(this.start,this.end,
this.caret)},collapse:function(){this.caret?this.end=this.start:this.start=this.end},extend:function(l){this.caret?this.start=l:this.end=l;this.start>this.end&&(l=this.start,this.start=this.end,this.end=l,this.caret=!this.caret)},setCaret:function(l){this.end=this.start=l;this.caret=!1},getCaret:function(){return this.caret?this.start:this.end},toString:function(){return"start\x3d"+this.start+" end\x3d"+this.end+(this.caret?" caret is at start":" caret is at end")},isEmpty:function(){return this.start===
this.end},equals:function(l){return this.caret===l.caret&&this.start===l.start&&this.end===l.end}};t.prototype={toString:function(){return"{l\x3d"+this.left+", t\x3d"+this.top+", r\x3d"+this.right+", b\x3d"+this.bottom+"}"}};u.prototype={create:function(l,a){if(!this._lineDiv){var x=this._lineDiv=this._createLine(l,a,this.lineIndex);x._line=this;return x}},_createLine:function(l,z,x){var d=this.view,b=d._model,k=b.getLine(x),c=b.getLineStart(x),m={type:"LineStyle",textView:d,lineIndex:x,lineText:k,
lineStart:c};d.onLineStyle(m);var e=l.ownerDocument,b=z||f.createElement(e,"div");if(!z||!a(z.viewStyle,m.style))p(m.style,b,z),z&&(z._trim=null),b.viewStyle=m.style,b.setAttribute("role","presentation");b.lineIndex=x;if(z&&b.viewLineText===k&&a(m.ranges,b.viewRanges))return b;b.viewRanges=m.ranges;b.viewLineText=k;x=[];this._createRanges(m.ranges,k,0,k.length,c,{tabOffset:0,ranges:x});m=" ";!d._fullSelection&&9>f.isIE&&(m="\ufeff");d={text:m,style:d._metrics.largestFontStyle,ignoreChars:1};0===x.length||
!x[x.length-1].style||"div"!==x[x.length-1].style.tagName?x.push(d):x.splice(x.length-1,0,d);var r,h,v,g=m=0;if(f.isFirefox&&2E3<k.length){z&&(b.innerHTML="",z.lineWidth=void 0);z=e.createDocumentFragment();for(k=0;k<x.length;k++)d=x[k],c=d.text,r=d.style,r=this._createSpan(b,c,r,d.ignoreChars),z.appendChild(r);b.appendChild(z)}else{var t,w;if(z){if(h=z.modelChangedEvent)0===h.removedLineCount&&0===h.addedLineCount?(w=h.start-c,t=h.addedCharCount-h.removedCharCount):w=-1,z.modelChangedEvent=void 0;
h=z.firstChild}for(k=0;k<x.length;k++){d=x[k];c=d.text;m+=c.length;r=d.style;if(h)if(v=h.firstChild.data,e=h.viewStyle,v===c&&a(r,e)){g+=v.length;h._rectsCache=void 0;r=h=h.nextSibling;continue}else for(;h;){if(-1!==w){e=m;e>=w&&(e-=t);v=(v=h.firstChild.data)?v.length:0;if(g+v>e)break;g+=v}e=h.nextSibling;b.removeChild(h);h=e}r=this._createSpan(b,c,r,d.ignoreChars);h?b.insertBefore(r,h):b.appendChild(r);z&&(z.lineWidth=void 0)}if(z)for(t=r?r.nextSibling:null;t;)e=t.nextSibling,z.removeChild(t),t=
e}b.parentNode||l.appendChild(b);return b},_createRanges:function(l,z,d,b,k,c){if(!(d>b)){if(l)for(var f=0;f<l.length;f++){var m=l[f];if(!(m.end<k+d)){var e=Math.max(k+d,m.start)-k;if(e>b)break;var r=Math.min(k+b,m.end)-k;if(e<=r){e=Math.max(d,e);r=Math.min(b,r);d<e&&this._createRange(z,d,e,null,c);if(!m.style||!m.style.unmergeable)for(;f+1<l.length&&l[f+1].start-k===r&&a(m.style,l[f+1].style);)m=l[f+1],r=Math.min(k+b,m.end)-k,f++;this._createRange(z,e,r,m.style,c);d=r}}}d<b&&this._createRange(z,
d,b,null,c)}},_createRange:function(l,a,d,b,k){if(!(a>d)){var c=this.view._customTabSize;if(c&&8!==c)for(var f=l.indexOf("\t",a);-1!==f&&f<d;){a<f&&(a={text:l.substring(a,f),style:b},k.ranges.push(a),k.tabOffset+=a.text.length);a=c-k.tabOffset%c;if(0<a){for(var m="\u00a0",e=1;e<a;e++)m+=" ";a={text:m,style:b,ignoreChars:a-1};k.ranges.push(a);k.tabOffset+=a.text.length}a=f+1;if(a===d)return;f=l.indexOf("\t",a)}a<=d&&(a={text:l.substring(a,d),style:b},k.ranges.push(a),k.tabOffset+=a.text.length)}},
_createSpan:function(l,a,d,b){var k=this.view,c="span";d&&d.tagName&&(c=d.tagName.toLowerCase());var m="a"===c;m&&(this.hasLink=!0);m&&!k._linksVisible&&(c="span");m=l.ownerDocument;l=f.createElement(l.ownerDocument,c);l.appendChild(m.createTextNode(d&&d.text?d.text:a));d&&d.html?(l.innerHTML=d.html,l.ignore=!0):d&&d.node&&(l.appendChild(d.node),l.ignore=!0);p(d,l);if("a"===c){var e=k._getWindow();A(l,"click",function(l){return k._handleLinkClick(l?l:e.event)},!1)}l.viewStyle=d;b&&(l.ignoreChars=
b);return l},_ensureCreated:function(){return this._lineDiv?this._lineDiv:this._createdDiv=this.create(this.view._clientDiv,null)},getBoundingClientRect:function(l,a){var d=this._ensureCreated(),b=this.view;if(void 0===l)return this._getLineBoundingClientRect(d,!0);var k=b._model,c=d.ownerDocument,m=this.lineIndex,e=null;if(l<k.getLineEnd(m)){var r=k.getLineStart(m);this.forEach(function(a){var z=a.firstChild,k=this._nodeLength(a);if(r+k>l){var m=l-r;if(1===z.length)e=new t(a.getBoundingClientRect());
else if(b._isRangeRects)k=c.createRange(),k.setStart(z,m),k.setEnd(z,m+1),e=new t(k.getBoundingClientRect());else if(f.isIE)k=c.body.createTextRange(),k.moveToElementText(a),k.collapse(),(z=0===m&&8===f.isIE)&&(m=1),k.moveEnd("character",m+1),k.moveStart("character",m),e=new t(k.getBoundingClientRect()),z&&(e.left=a.getClientRects()[0].left);else{var p=z.data;a.removeChild(z);a.appendChild(c.createTextNode(p.substring(0,m)));var h=f.createElement(c,"span");h.appendChild(c.createTextNode(p.substring(m,
m+1)));a.appendChild(h);a.appendChild(c.createTextNode(p.substring(m+1)));e=new t(h.getBoundingClientRect());a.innerHTML="";a.appendChild(z);this._createdDiv||(a=b._getSelection(),(r<=a.start&&a.start<r+k||r<=a.end&&a.end<r+k)&&b._updateDOMSelection())}f.isIE&&(m=d.ownerDocument.defaultView||d.ownerDocument.parentWindow,a=m.screen.logicalXDPI/m.screen.deviceXDPI,m=m.screen.logicalYDPI/m.screen.deviceYDPI,e.left*=a,e.right*=a,e.top*=m,e.bottom*=m);return!1}r+=k;return!0})}k=this.getBoundingClientRect();
e||(b._wrapMode?(m=this.getClientRects(),e=m[m.length-1],e.left=e.right,e.left+=k.left,e.top+=k.top,e.right+=k.left,e.bottom+=k.top):(e=new t(k),e.left=e.right));if(a||void 0===a)e.left-=k.left,e.top-=k.top,e.right-=k.left,e.bottom-=k.top;return e},forEach:function(l){for(var a=this._ensureCreated().firstChild;a;){var d=a.nextSibling;if(!a.ignore&&!l.call(this,a))break;a=d}},_getClientRects:function(l,a){var d,b,k,c;if(!l._rectsCache){d=l.getClientRects();b=Array(d.length);for(c=0;c<d.length;c++)k=
b[c]=new t(d[c]),k.left-=a.left,k.top-=a.top,k.right-=a.left,k.bottom-=a.top;l._rectsCache=b}d=l._rectsCache;b=[d.length];for(c=0;c<d.length;c++)b[c]=new t(d[c]);return b},getClientRects:function(l){if(!this.view._wrapMode)return[this.getBoundingClientRect()];var a=[],d=this._ensureCreated().getBoundingClientRect();this.forEach(function(l){l=this._getClientRects(l,d);for(var b=0;b<l.length;b++){var k=l[b],c,f;if(k.top!==k.bottom){var m=k.top+(k.bottom-k.top)/2;for(c=0;c<a.length&&!(f=a[c],f.top<=
m&&m<f.bottom);c++);c===a.length?a.push(k):(k.left<f.left&&(f.left=k.left),k.top<f.top&&(f.top=k.top),k.right>f.right&&(f.right=k.right),k.bottom>f.bottom&&(f.bottom=k.bottom))}}return!0});return void 0!==l?a[l]:a},_getLineBoundingClientRect:function(l,a){var d=new t(l.getBoundingClientRect());if(!this.view._wrapMode){d.right=d.left;for(var b=l.lastChild;b&&b.ignoreChars===b.firstChild.length;)b=b.previousSibling;b&&(b=b.getBoundingClientRect(),d.right=b.right+r(l).right)}a&&(b=r(l),d.left+=b.left,
d.right-=b.right);return d},getLineCount:function(){return!this.view._wrapMode?1:this.getClientRects().length},getLineIndex:function(l){if(!this.view._wrapMode)return 0;var a=this.getClientRects();l=this.getBoundingClientRect(l);l=l.top+(l.bottom-l.top)/2;for(var d=0;d<a.length;d++)if(a[d].top<=l&&l<a[d].bottom)return d;return a.length-1},getLineStart:function(l){if(!this.view._wrapMode||0===l)return this.view._model.getLineStart(this.lineIndex);var a=this.getClientRects();return this.getOffset(a[l].left+
1,a[l].top+1)},_nodeLength:function(l){if(!l||l.ignore)return 0;var a=l.firstChild.length;l.ignoreChars&&(a-=l.ignoreChars);return a},getModelOffset:function(l,a){if(!l)return 0;var d=0;this.forEach(function(b){var k=b.firstChild;if(k===l)return b.ignoreChars&&(d-=b.ignoreChars),d+=a,!1;b.ignoreChars&&(d-=b.ignoreChars);d+=k.data.length;return!0});return Math.max(0,d)+this.view._model.getLineStart(this.lineIndex)},getNodeOffset:function(l){var a=0,d,b,k=this.view._model,c=k.getLineStart(this.lineIndex),
f=l-c,m=k.getLineEnd(this.lineIndex)-c;this.forEach(function(l){var k=l.firstChild,c=this._nodeLength(l);if(c+a>f||a+c>=m)return d=k,b=f-a,l.ignoreChars&&(0<c&&b===c)&&(b+=l.ignoreChars),!1;a+=c;return!0});return{node:d,offset:b}},getText:function(l){var a="",d=0;this.forEach(function(b){var k;if(b.ignoreChars){k=b.lastChild;for(var c=0,f=[],m=-1;k;){var e=k.data;if(e)for(var r=e.length-1;0<=r;r--){var p=e.substring(r,r+1);c<b.ignoreChars&&(" "===p||"\ufeff"===p)?c++:f.push("\u00a0"===p?"\t":p)}l===
k&&(m=f.length);k=k.previousSibling}f=f.reverse().join("");-1!==m&&(d=a.length+f.length-m);a+=f}else for(k=b.firstChild;k;)l===k&&(d=a.length),a+=k.data,k=k.nextSibling;return!0});return{text:a,offset:d}},getOffset:function(l,a){function d(b,x,r){var C=b.firstChild,g=v._nodeLength(b),t=p.ownerDocument,w=t.defaultView||t.parentWindow,u=f.isIE?w.screen.logicalXDPI/w.screen.deviceXDPI:1,n=f.isIE?w.screen.logicalYDPI/w.screen.deviceYDPI:1,y,s,B,w=r.left+h.left,q,A;if(f.isIE||k._isRangeRects){for(var t=
k._isRangeRects?t.createRange():t.body.createTextRange(),G=g,H=-1;1<G-H;){var K=Math.floor((G+H)/2);r=H+1;y=K===g-1&&b.ignoreChars?C.length:K+1;q=0===r&&8===f.isIE;k._isRangeRects?(t.setStart(C,r),t.setEnd(C,y)):(q&&(r=1),t.moveToElementText(b),t.move("character",r),t.moveEnd("character",y-r));A=t.getClientRects();for(var O=!1,L=0;L<A.length;L++)if(r=A[L],y=(q?w:r.left)*u-h.left,B=r.right*u-h.left,s=r.top*n-h.top,r=r.bottom*n-h.top,y<=l&&l<B&&(!k._wrapMode||s<=a&&a<r)){O=!0;break}O?G=K:H=K}x+=G;r=
G;y=G===g-1&&b.ignoreChars?C.length:Math.min(G+1,C.length);k._isRangeRects?(t.setStart(C,r),t.setEnd(C,y)):(t.moveToElementText(b),t.move("character",r),t.moveEnd("character",y-r));A=t.getClientRects();g=!1;0<A.length&&(r=A[0],y=(q?w:r.left)*u-h.left,B=r.right*u-h.left,g=l>y+(B-y)/2);b=x-e;C=c.getLine(m);u=C.charCodeAt(b);55296<=u&&56319>=u&&g?b<C.length&&(u=C.charCodeAt(b+1),56320<=u&&57343>=u&&(x+=1)):56320<=u&&(57343>=u&&!g)&&0<b&&(u=C.charCodeAt(b-1),55296<=u&&56319>=u&&(x-=1));g&&x++}else{u=
[];for(q=0;q<g;q++)u.push("\x3cspan\x3e"),q===g-1?u.push(C.data.substring(q)):u.push(C.data.substring(q,q+1)),u.push("\x3c/span\x3e");b.innerHTML=u.join("");for(u=b.firstChild;u;){r=u.getBoundingClientRect();y=r.left-h.left;B=r.right-h.left;if(y<=l&&l<B){l>y+(B-y)/2&&x++;break}x++;u=u.nextSibling}v._createdDiv||(b.innerHTML="",b.appendChild(C),b=k._getSelection(),(x<=b.start&&b.start<x+g||x<=b.end&&b.end<x+g)&&k._updateDOMSelection())}return x}function b(d){if(d.ignore)return null;d=v._getClientRects(d,
h);for(var x=0;x<d.length;x++){var c=d[x];if(c.left<=l&&l<c.right&&(!k._wrapMode||c.top<=a&&a<c.bottom))return c}return null}var k=this.view,c=k._model,m=this.lineIndex,e=c.getLineStart(m),r=c.getLineEnd(m);if(e===r)return e;var p=this._ensureCreated(),h=this.getBoundingClientRect(),v=this,g,t;if(k._wrapMode){g=this.getClientRects();a<g[0].top&&(a=g[0].top);for(var w=0;w<g.length&&!(t=g[w],t.top<=a&&a<t.bottom);w++);l<t.left&&(l=t.left);l>t.right&&(l=t.right-1)}else 0>l&&(l=0),l>h.right-h.left&&(l=
h.right-h.left);var u,n;if(this._lastHitChild&&this._lastHitChild.parentNode){if(u=this._lastHitOffset,n=this._lastHitChild,t=b(n),!t){g=u;for(var w=u+this._nodeLength(n),y=n.previousSibling,s=n.nextSibling;y||s;){if(y){g-=this._nodeLength(y);if(t=b(y)){n=y;u=g;break}y=y.previousSibling}if(s){if(t=b(s)){n=s;u=w;break}w+=this._nodeLength(s);s=s.nextSibling}}}}else u=e,this.forEach(function(l){n=l;if(t=b(n))return!1;u+=this._nodeLength(n);return!0});n&&t&&(this._lastHitChild=n,this._lastHitOffset=u,
u=d(n,u,t));return Math.min(r,Math.max(e,u))},getNextOffset:function(l,a){if("line"===a.unit){var d=this.view._model,b=d.getLineAtOffset(l);if(0<a.count)return a.count--,d.getLineEnd(b);a.count++;return d.getLineStart(b)}return"wordend"===a.unit||"wordWS"===a.unit||"wordendWS"===a.unit?this._getNextOffset_W3C(l,a):f.isIE?this._getNextOffset_IE(l,a):this._getNextOffset_W3C(l,a)},_getNextOffset_W3C:function(l,a){function d(l){return 33<=l&&47>=l||58<=l&&64>=l||91<=l&&94>=l||96===l||123<=l&&126>=l}function b(l){return 32===
l||9===l}var k=this.view._model,c=k.getLineAtOffset(l),f=k.getLine(c),m=k.getLineStart(c),k=k.getLineEnd(c),c=f.length,e=l-m,r,p=0>a.count?-1:1;if("word"===a.unit||"wordend"===a.unit||"wordWS"===a.unit||"wordendWS"===a.unit)for(var h,v,g;0!==a.count;){if(0<a.count){if(e===c)return k;r=f.charCodeAt(e);h=d(r);v=!h&&!b(r);for(e++;e<c;){r=f.charCodeAt(e);if("wordWS"!==a.unit&&"wordendWS"!==a.unit){g=d(r);if("wordend"===a.unit){if(!g&&h)break}else if(g&&!h)break;r=!g&&!b(r)}else r=!b(r);if("wordend"===
a.unit||"wordendWS"===a.unit){if(!r&&v)break}else if(r&&!v)break;v=r;h=g;e++}}else{if(0===e)return m;e--;r=f.charCodeAt(e);h=d(r);for(v=!h&&!b(r);0<e;){r=f.charCodeAt(e-1);if("wordWS"!==a.unit&&"wordendWS"!==a.unit){g=d(r);if("wordend"===a.unit){if(g&&!h)break}else if(!g&&h)break;r=!g&&!b(r)}else r=!b(r);if("wordend"===a.unit||"wordendWS"===a.unit){if(r&&!v)break}else if(!r&&v)break;v=r;h=g;e--}}a.count-=p}else for(;0!==a.count&&0<=e+p&&e+p<=c;)e+=p,r=f.charCodeAt(e),56320<=r&&57343>=r&&0<e&&(r=f.charCodeAt(e-
1),55296<=r&&56319>=r&&(e+=p)),a.count-=p;return m+e},_getNextOffset_IE:function(l,a){var d=this._ensureCreated(),b=this.view._model,k=this.lineIndex,c=0,f;f=b.getLineStart(k);var m=d.ownerDocument,e=0>a.count?-1:1;if(l===b.getLineEnd(k)){for(d=d.lastChild;d&&d.ignoreChars===d.firstChild.length;)d=d.previousSibling;if(!d)return f;c=m.body.createTextRange();c.moveToElementText(d);f=c.text.length;c.moveEnd(a.unit,e);c=l+c.text.length-f}else if(l===f&&0>a.count)c=f;else for(d=d.firstChild;d;){b=this._nodeLength(d);
if(f+b>l){c=m.body.createTextRange();if(l===f&&0>a.count){for(f=d.previousSibling;f&&(!f.firstChild||!f.firstChild.length);)f=f.previousSibling;c.moveToElementText(f?f:d.previousSibling)}else c.moveToElementText(d),c.collapse(),c.moveEnd("character",l-f);f=c.text.length;c.moveEnd(a.unit,e);c=l+c.text.length-f;break}f=b+f;d=d.nextSibling}a.count-=e;return c},updateLinks:function(){var l=this._ensureCreated();if(this.hasLink){var a=this;this.forEach(function(d){var b=d.viewStyle;b&&(b.tagName&&"a"===
b.tagName.toLowerCase())&&l.replaceChild(a._createSpan(l,d.firstChild.data,b),d);return!0})}},destroy:function(){var l=this._createdDiv;l&&(l.parentNode.removeChild(l),this._createdDiv=null)}};y.prototype={addKeyMode:function(l,a){var d=this._keyModes;void 0!==a?d.splice(a,0,l):d.push(l);l._modeAdded&&l._modeAdded()},addRuler:function(l,a){l.setView(this);var d=this._rulers;if(void 0!==a){var b,k;for(k=b=0;b<d.length&&k<a;b++)l.getLocation()===d[b].getLocation()&&k++;d.splice(k,0,l);a=k}else d.push(l);
this._createRuler(l,a);this._update()},computeSize:function(){var l=0,a=0,d=this._model,b=this._clientDiv;if(!b)return{width:l,height:a};var k=b.style.width;f.isWebkit&&(b.style.width="0x7fffffffpx");for(var d=d.getLineCount(),c=0;c<d;c++){var m=this._getLine(c),e=m.getBoundingClientRect(),l=Math.max(l,e.right-e.left),a=a+(e.bottom-e.top);m.destroy()}f.isWebkit&&(b.style.width=k);b=this._getViewPadding();l+=b.right+b.left+this._metrics.scrollWidth;a+=b.bottom+b.top+this._metrics.scrollWidth;return{width:l,
height:a}},convert:function(l,a,d){if(this._clientDiv){var b=this._getScroll(),k=this._getViewPadding(),c=this._viewDiv.getBoundingClientRect();"document"===a&&(void 0!==l.x&&(l.x+=-b.x+c.left+k.left),void 0!==l.y&&(l.y+=-b.y+c.top+k.top));"document"===d&&(void 0!==l.x&&(l.x+=b.x-c.left-k.left),void 0!==l.y&&(l.y+=b.y-c.top-k.top));return l}},destroy:function(){for(var l=0;l<this._rulers.length;l++)this._rulers[l].setView(null);this.rulers=null;this._destroyView();this.onDestroy({type:"Destroy"});
this._parent=null;this._model&&this._model.destroy&&this._model.destroy();this._actions=this._keyModes=this._doubleClickSelection=this._selection=this._theme=this._model=null},focus:function(){this._clientDiv&&(this._updateDOMSelection(),this._clientDiv.focus(),this._updateDOMSelection())},hasFocus:function(){return this._hasFocus},getActionDescription:function(l){if(l=this._actions[l])return l.actionDescription},getActions:function(l){var a=[],d=this._actions,b;for(b in d)d.hasOwnProperty(b)&&(l||
!d[b].defaultHandler)&&a.push(b);return a},getBottomIndex:function(l){return!this._clientDiv?0:this._getBottomIndex(l)},getBottomPixel:function(){return!this._clientDiv?0:this._getScroll().y+this._getClientHeight()},getCaretOffset:function(){return this._getSelection().getCaret()},getClientArea:function(){if(!this._clientDiv)return{x:0,y:0,width:0,height:0};var l=this._getScroll();return{x:l.x,y:l.y,width:this._getClientWidth(),height:this._getClientHeight()}},getHorizontalPixel:function(){return!this._clientDiv?
0:this._getScroll().x},getKeyBindings:function(l){for(var a=[],d=this._keyModes,b=0;b<d.length;b++)a=a.concat(d[b].getKeyBindings(l));return a},getKeyModes:function(){return this._keyModes.slice(0)},getLineHeight:function(l){return!this._clientDiv?0:this._getLineHeight(l)},getLineIndex:function(l){return!this._clientDiv?0:this._getLineIndex(l)},getLinePixel:function(l){return!this._clientDiv?0:this._getLinePixel(l)},getLocationAtOffset:function(l){if(!this._clientDiv)return{x:0,y:0};var a=this._model;
l=Math.min(Math.max(0,l),a.getCharCount());var a=a.getLineAtOffset(l),d=this._getLine(a);l=d.getBoundingClientRect(l);d.destroy();d=l.left;a=this._getLinePixel(a)+l.top;return{x:d,y:a}},getNextOffset:function(l,a){var d=new v(l,l,!1);this._doMove(a,d);return d.getCaret()},getOptions:function(){var l;if(0===arguments.length)l=this._defaultOptions();else if(1===arguments.length){if(l=arguments[0],"string"===typeof l)return h(this["_"+l])}else{l={};for(var a in arguments)arguments.hasOwnProperty(a)&&
(l[arguments[a]]=void 0)}for(var d in l)l.hasOwnProperty(d)&&(l[d]=h(this["_"+d]));return l},getModel:function(){return this._model},getOffsetAtLocation:function(l,a){if(!this._clientDiv)return 0;var d=this._getLineIndex(a),b=this._getLine(d),d=b.getOffset(l,a-this._getLinePixel(d));b.destroy();return d},getLineAtOffset:function(l){this.getModel().getLineAtOffset(l)},getLineStart:function(l){this.getModel().getLineStart(l)},getRulers:function(){return this._rulers.slice(0)},getSelection:function(){var l=
this._getSelection();return{start:l.start,end:l.end}},getText:function(l,a){return this._model.getText(l,a)},getTopIndex:function(l){return!this._clientDiv?0:this._getTopIndex(l)},getTopPixel:function(){return!this._clientDiv?0:this._getScroll().y},invokeAction:function(l,a,d){if(this._clientDiv){if(l=this._actions[l]){if(!a&&l.handler&&l.handler(d))return!0;if(l.defaultHandler)return"boolean"===typeof l.defaultHandler(d)}return!1}},isDestroyed:function(){return!this._clientDiv},onContextMenu:function(l){return this.dispatchEvent(l)},
onDragStart:function(l){return this.dispatchEvent(l)},onDrag:function(l){return this.dispatchEvent(l)},onDragEnd:function(l){return this.dispatchEvent(l)},onDragEnter:function(l){return this.dispatchEvent(l)},onDragOver:function(l){return this.dispatchEvent(l)},onDragLeave:function(l){return this.dispatchEvent(l)},onDrop:function(l){return this.dispatchEvent(l)},onDestroy:function(l){return this.dispatchEvent(l)},onLineStyle:function(l){return this.dispatchEvent(l)},onKeyDown:function(l){return this.dispatchEvent(l)},
onKeyPress:function(l){return this.dispatchEvent(l)},onKeyUp:function(l){return this.dispatchEvent(l)},onModelChanged:function(l){return this.dispatchEvent(l)},onModelChanging:function(l){return this.dispatchEvent(l)},onModify:function(l){return this.dispatchEvent(l)},onMouseDown:function(l){return this.dispatchEvent(l)},onMouseUp:function(l){return this.dispatchEvent(l)},onMouseMove:function(l){return this.dispatchEvent(l)},onMouseOver:function(l){return this.dispatchEvent(l)},onMouseOut:function(l){return this.dispatchEvent(l)},
onSelection:function(l){return this.dispatchEvent(l)},onScroll:function(l){return this.dispatchEvent(l)},onVerify:function(l){return this.dispatchEvent(l)},onFocus:function(l){return this.dispatchEvent(l)},onBlur:function(l){return this.dispatchEvent(l)},redraw:function(){if(!(0<this._redrawCount)){var l=this._model.getLineCount();this.redrawRulers(0,l);this.redrawLines(0,l)}},redrawRulers:function(l,a){if(!(0<this._redrawCount))for(var d=this.getRulers(),b=0;b<d.length;b++)this.redrawLines(l,a,d[b])},
redrawLines:function(l,a,d){if(!(0<this._redrawCount)&&(void 0===l&&(l=0),void 0===a&&(a=this._model.getLineCount()),l!==a)){var b=this._clientDiv;if(b){if(d)for(b=this._getRulerParent(d).firstChild;b&&b._ruler!==d;)b=b.nextSibling;d?b.rulerChanged=!0:this._lineHeight&&this._resetLineHeight(l,a);if(!d||"page"===d.getOverview())for(b=b.firstChild;b;){var k=b.lineIndex;l<=k&&k<a&&(b.lineChanged=!0);b=b.nextSibling}!d&&(!this._wrapMode&&l<=this._maxLineIndex&&this._maxLineIndex<a)&&(this._checkMaxLineIndex=
this._maxLineIndex,this._maxLineIndex=-1,this._maxLineWidth=0);this._queueUpdate()}}},redrawRange:function(l,a){if(!(0<this._redrawCount)){var d=this._model;void 0===l&&(l=0);void 0===a&&(a=d.getCharCount());var b=d.getLineAtOffset(l),d=d.getLineAtOffset(Math.max(l,a-1))+1;this.redrawLines(b,d)}},removeKeyMode:function(l){for(var a=this._keyModes,d=0;d<a.length;d++)if(a[d]===l){a.splice(d,1);break}l._modeRemoved&&l._modeRemoved()},removeRuler:function(l){for(var a=this._rulers,d=0;d<a.length;d++)if(a[d]===
l){a.splice(d,1);l.setView(null);this._destroyRuler(l);this._update();break}},resize:function(){this._clientDiv&&this._handleResize(null)},setAction:function(l,a,d){if(l){var b=this._actions,k=b[l];k||(k=b[l]={});k.handler=a;void 0!==d&&(k.actionDescription=d)}},setKeyBinding:function(l,a){this._keyModes[0].setKeyBinding(l,a)},setCaretOffset:function(l,a,d){var b=this._model.getCharCount();l=Math.max(0,Math.min(l,b));l=new v(l,l,!1);this._setSelection(l,void 0===a||a,!0,d)},setHorizontalPixel:function(l){this._clientDiv&&
(l=Math.max(0,l),this._scrollView(l-this._getScroll().x,0))},setRedraw:function(l){l?0===--this._redrawCount&&this.redraw():this._redrawCount++},setModel:function(l){if(l&&l!==this._model){this._model.removeEventListener("preChanging",this._modelListener.onChanging);this._model.removeEventListener("postChanged",this._modelListener.onChanged);var a=this._model.getLineCount(),d=this._model.getCharCount(),b=l.getLineCount(),k=l.getCharCount(),c={type:"ModelChanging",text:l.getText(),start:0,removedCharCount:d,
addedCharCount:k,removedLineCount:a,addedLineCount:b};this.onModelChanging(c);this._model=l;c={type:"ModelChanged",start:0,removedCharCount:d,addedCharCount:k,removedLineCount:a,addedLineCount:b};this.onModelChanged(c);this._model.addEventListener("preChanging",this._modelListener.onChanging);this._model.addEventListener("postChanged",this._modelListener.onChanged);this._reset();this._update()}},setOptions:function(l){var d=this._defaultOptions(),b;for(b in l)if(l.hasOwnProperty(b)){var k=l[b];if(!a(this["_"+
b],k)){var c=d[b]?d[b].update:null;c?c.call(this,k):this["_"+b]=h(k)}}},setSelection:function(l,a,d,b){var k=l>a;if(k){var c=l;l=a;a=c}c=this._model.getCharCount();l=Math.max(0,Math.min(l,c));a=Math.max(0,Math.min(a,c));l=new v(l,a,k);this._setSelection(l,void 0===d||d,!0,b)},setText:function(l,a,d){var b=void 0===a&&void 0===d;void 0===a&&(a=0);void 0===d&&(d=this._model.getCharCount());b&&(this._variableLineHeight=!1);this._modifyContent({text:l,start:a,end:d,_code:!0},!b);b&&(this._columnX=-1,
this._setSelection(new v(0,0,!1),!0),13>f.isFirefox&&this._fixCaret())},setTopIndex:function(l){this._clientDiv&&this._scrollView(0,this._getLinePixel(Math.max(0,l))-this._getScroll().y)},setTopPixel:function(l){this._clientDiv&&this._scrollView(0,Math.max(0,l)-this._getScroll().y)},showSelection:function(){return this._showCaret(!0)},update:function(l,a){this._clientDiv&&((l||this._metrics.invalid)&&this._updateStyle(),void 0===a||a?this._update():this._queueUpdate())},_handleRootMouseDown:function(l){if(!this._ignoreEvent(l)){13>
f.isFirefox&&1===l.which&&(this._clientDiv.contentEditable=!1,this._ignoreBlur=(this._overlayDiv||this._clientDiv).draggable=!0);var a=this._overlayDiv||this._clientDiv;9>f.isIE&&(a=this._viewDiv);for(var d=l.target?l.target:l.srcElement;d;){if(a===d)return;d=d.parentNode}l.preventDefault&&l.preventDefault();l.stopPropagation&&l.stopPropagation();if(!this._isW3CEvents){var b=this;this._getWindow().setTimeout(function(){b._clientDiv.focus()},0)}}},_handleRootMouseUp:function(l){!this._ignoreEvent(l)&&
(13>f.isFirefox&&1===l.which)&&(this._clientDiv.contentEditable=!0,(this._overlayDiv||this._clientDiv).draggable=!1,this._fixCaret(),this._ignoreBlur=!1)},_handleBlur:function(l){if(!this._ignoreBlur){this._hasFocus=!1;if(9>f.isIE&&!this._getSelection().isEmpty()){l=this._rootDiv;var a=f.createElement(l.ownerDocument,"div");l.appendChild(a);l.removeChild(a)}this._cursorDiv&&(this._cursorDiv.style.display="none");if(this._selDiv1)if(this._selDiv1.style.background="lightgray",this._selDiv2.style.background=
"lightgray",this._selDiv3.style.background="lightgray",l=this._getWindow(),a=this._selDiv1.ownerDocument,l.getSelection){a=l.getSelection();for(l=a.anchorNode;l;){if(l===this._clientDiv){0<a.rangeCount&&a.removeAllRanges();break}l=l.parentNode}}else if(a.selection){this._ignoreSelect=!1;for(l=a.selection.createRange().parentElement();l;){if(l===this._clientDiv){a.selection.empty();break}l=l.parentNode}this._ignoreSelect=!0}if(!this._ignoreFocus)this.onBlur({type:"Blur"})}},_handleContextMenu:function(l){if(!this._ignoreEvent(l)){f.isIE&&
3===this._lastMouseButton&&this._updateDOMSelection();var a=!1;this.isListening("ContextMenu")?(a=this._createMouseEvent("ContextMenu",l),a.screenX=l.screenX,a.screenY=l.screenY,this.onContextMenu(a),a=a.defaultPrevented):f.isMac&&(f.isFirefox&&0===l.button)&&(a=!0);if(a)return l.preventDefault&&l.preventDefault(),!1}},_handleCopy:function(l){if(!this._ignoreEvent(l)&&!this._ignoreCopy&&this._doCopy(l))return l.preventDefault&&l.preventDefault(),!1},_handleCut:function(l){if(!this._ignoreEvent(l)&&
this._doCut(l))return l.preventDefault&&l.preventDefault(),!1},_handleDataModified:function(l){this._ignoreEvent(l)||this._startIME()},_handleDblclick:function(l){this._ignoreEvent(l)||(this._lastMouseTime=l.timeStamp?l.timeStamp:(new Date).getTime(),2!==this._clickCount&&(this._clickCount=2,this._handleMouse(l)))},_handleDragStart:function(l){if(!this._ignoreEvent(l)){if(13>f.isFirefox){var a=this;this._getWindow().setTimeout(function(){a._clientDiv.contentEditable=!0;a._clientDiv.draggable=!1;a._ignoreBlur=
!1},0)}if(this.isListening("DragStart")&&-1!==this._dragOffset)this._isMouseDown=!1,this.onDragStart(this._createMouseEvent("DragStart",l)),this._dragOffset=-1;else return l.preventDefault&&l.preventDefault(),!1}},_handleDrag:function(l){if(!this._ignoreEvent(l)&&this.isListening("Drag"))this.onDrag(this._createMouseEvent("Drag",l))},_handleDragEnd:function(l){if(!this._ignoreEvent(l)){this._dropTarget=!1;this._dragOffset=-1;if(this.isListening("DragEnd"))this.onDragEnd(this._createMouseEvent("DragEnd",
l));13>f.isFirefox&&(this._fixCaret(),"none"===l.dataTransfer.dropEffect&&!l.dataTransfer.mozUserCancelled&&this._fixCaret())}},_handleDragEnter:function(l){if(!this._ignoreEvent(l)){var a=!0;this._dropTarget=!0;this.isListening("DragEnter")&&(a=!1,this.onDragEnter(this._createMouseEvent("DragEnter",l)));if(f.isWebkit||a)return l.preventDefault&&l.preventDefault(),!1}},_handleDragOver:function(l){if(!this._ignoreEvent(l)){var a=!0;this.isListening("DragOver")&&(a=!1,this.onDragOver(this._createMouseEvent("DragOver",
l)));if(f.isWebkit||a)return a&&(l.dataTransfer.dropEffect="none"),l.preventDefault&&l.preventDefault(),!1}},_handleDragLeave:function(l){if(!this._ignoreEvent(l)&&(this._dropTarget=!1,this.isListening("DragLeave")))this.onDragLeave(this._createMouseEvent("DragLeave",l))},_handleDrop:function(l){if(!this._ignoreEvent(l)){this._dropTarget=!1;if(this.isListening("Drop"))this.onDrop(this._createMouseEvent("Drop",l));l.preventDefault&&l.preventDefault();return!1}},_handleFocus:function(l){this._hasFocus=
!0;f.isIOS&&void 0!==this._lastTouchOffset?(this.setCaretOffset(this._lastTouchOffset,!0),this._lastTouchOffset=void 0):this._updateDOMSelection();this._cursorDiv&&(this._cursorDiv.style.display="block");this._selDiv1&&(l=this._highlightRGB,this._selDiv1.style.background=l,this._selDiv2.style.background=l,this._selDiv3.style.background=l);if(!this._ignoreFocus)this.onFocus({type:"Focus"})},_handleKeyDown:function(l){if(!this._ignoreEvent(l)){if(this.isListening("KeyDown")){var a=this._createKeyEvent("KeyDown",
l);this.onKeyDown(a);if(a.defaultPrevented){f.isFirefox&&(this._keyDownPrevented=!0);l.preventDefault();return}}a=!1;switch(l.keyCode){case 16:case 17:case 18:case 91:a=!0;break;default:this._setLinksVisible(!1)}if(229===l.keyCode){if(this._readonly)return l.preventDefault&&l.preventDefault(),!1;a=!0;f.isSafari&&f.isMac&&l.ctrlKey&&(a=!1,l.keyCode=129);a&&this._startIME()}else a||this._commitIME();if((f.isMac||f.isLinux)&&4>f.isFirefox||12.16>f.isOpera)return this._keyDownEvent=l,!0;if(this._doAction(l))return l.preventDefault?
(l.preventDefault(),l.stopPropagation()):(l.cancelBubble=!0,l.returnValue=!1,l.keyCode=0),!1}},_handleKeyPress:function(l){if(!this._ignoreEvent(l))if(this._keyDownPrevented)l.preventDefault&&(l.preventDefault(),l.stopPropagation()),this._keyDownPrevented=void 0;else{if(f.isMac&&f.isWebkit&&(63232<=l.keyCode&&63487>=l.keyCode||13===l.keyCode||8===l.keyCode)||((f.isMac||f.isLinux)&&4>f.isFirefox||12.16>f.isOpera)&&this._doAction(this._keyDownEvent))return l.preventDefault&&l.preventDefault(),!1;var a=
f.isMac?l.metaKey:l.ctrlKey;if(void 0!==l.charCode&&a)switch(l.charCode){case 99:case 118:case 120:return!0}if(this.isListening("KeyPress")&&(a=this._createKeyEvent("KeyPress",l),this.onKeyPress(a),a.defaultPrevented)){l.preventDefault();return}if(this._doAction(l))return l.preventDefault?(l.preventDefault(),l.stopPropagation()):(l.cancelBubble=!0,l.returnValue=!1,l.keyCode=0),!1;a=!1;if(f.isMac){if(l.ctrlKey||l.metaKey)a=!0}else if(f.isFirefox){if(l.ctrlKey||l.altKey)a=!0}else l.ctrlKey^l.altKey&&
(a=!0);if(!a&&(a=f.isOpera?l.which:void 0!==l.charCode?l.charCode:l.keyCode,31<a))return this._doContent(String.fromCharCode(a)),l.preventDefault&&l.preventDefault(),!1}},_handleDocKeyUp:function(l){(f.isMac?l.metaKey:l.ctrlKey)||this._setLinksVisible(!1)},_handleKeyUp:function(l){if(!this._ignoreEvent(l)){if(this.isListening("KeyUp")){var a=this._createKeyEvent("KeyUp",l);this.onKeyUp(a);if(a.defaultPrevented){l.preventDefault();return}}this._handleDocKeyUp(l);13===l.keyCode&&this._commitIME()}},
_handleLinkClick:function(l){if(!(f.isMac?l.metaKey:l.ctrlKey))return l.preventDefault&&l.preventDefault(),!1},_handleMouse:function(l){var a=this._getWindow(),d=!0,b=a;if(f.isIE||f.isFirefox&&!this._overlayDiv)b=this._clientDiv;if(this._overlayDiv){this._hasFocus&&(this._ignoreFocus=!0);var k=this;a.setTimeout(function(){k.focus();k._ignoreFocus=!1},0)}1===this._clickCount?(d=this._setSelectionTo(l.clientX,l.clientY,l.shiftKey,(!f.isOpera||12.16<=f.isOpera)&&this._hasFocus&&this.isListening("DragStart")))&&
this._setGrab(b):(this._isW3CEvents&&this._setGrab(b),this._doubleClickSelection=null,this._setSelectionTo(l.clientX,l.clientY,l.shiftKey),this._doubleClickSelection=this._getSelection());return d},_handleMouseDown:function(l){if(!this._ignoreEvent(l)){if(this._linksVisible)if("A"!==(l.target||l.srcElement).tagName)this._setLinksVisible(!1);else return;this._commitIME();var a=l.which;a||(4===l.button&&(a=2),2===l.button&&(a=3),1===l.button&&(a=1));var d=2!==a&&l.timeStamp?l.timeStamp:(new Date).getTime(),
b=d-this._lastMouseTime,k=Math.abs(this._lastMouseX-l.clientX),c=Math.abs(this._lastMouseY-l.clientY),m=this._lastMouseButton===a;this._lastMouseX=l.clientX;this._lastMouseY=l.clientY;this._lastMouseTime=d;this._lastMouseButton=a;1===a&&(this._isMouseDown=!0,m&&b<=this._clickTime&&k<=this._clickDist&&c<=this._clickDist?this._clickCount++:this._clickCount=1);if(this.isListening("MouseDown")&&(d=this._createMouseEvent("MouseDown",l),this.onMouseDown(d),d.defaultPrevented)){l.preventDefault();return}if(1===
a&&this._handleMouse(l)&&(9<=f.isIE||f.isOpera||f.isChrome||f.isSafari||f.isFirefox&&!this._overlayDiv))this._hasFocus||this.focus(),l.preventDefault();f.isFirefox&&3===this._lastMouseButton&&this._updateDOMSelection()}},_handleMouseOver:function(l){if(!this._ignoreEvent(l)&&!this._animation&&this.isListening("MouseOver"))this.onMouseOver(this._createMouseEvent("MouseOver",l))},_handleMouseOut:function(l){if(!this._ignoreEvent(l)&&!this._animation&&this.isListening("MouseOut"))this.onMouseOut(this._createMouseEvent("MouseOut",
l))},_handleMouseMove:function(l){if(!this._animation){var a=this._isClientDiv(l);if(this.isListening("MouseMove")&&a)this.onMouseMove(this._createMouseEvent("MouseMove",l));if(!this._dropTarget){var d=this._linksVisible||this._lastMouseMoveX!==l.clientX||this._lastMouseMoveY!==l.clientY;this._lastMouseMoveX=l.clientX;this._lastMouseMoveY=l.clientY;this._setLinksVisible(d&&!this._isMouseDown&&(f.isMac?l.metaKey:l.ctrlKey));if(!this._isW3CEvents){if(0===l.button)return this._setGrab(null),!0;if(!this._isMouseDown&&
1===l.button&&0!==(this._clickCount&1)&&a)return this._clickCount=2,this._handleMouse(l,this._clickCount)}if(this._isMouseDown&&-1===this._dragOffset){a=l.clientX;l=l.clientY;var b=this._getViewPadding(),k=this._viewDiv.getBoundingClientRect(),c=this._getClientWidth(),m=this._getClientHeight(),d=k.left+b.left,e=k.top+b.top,c=k.left+b.left+c,b=k.top+b.top+m;l<e?this._doAutoScroll("up",a,l-e):l>b?this._doAutoScroll("down",a,l-b):a<d&&!this._wrapMode?this._doAutoScroll("left",a-d,l):a>c&&!this._wrapMode?
this._doAutoScroll("right",a-c,l):(this._endAutoScroll(),this._setSelectionTo(a,l,!0))}}}},_isClientDiv:function(l){var a=this._overlayDiv||this._clientDiv;for(l=l.target?l.target:l.srcElement;l;){if(a===l)return!0;l=l.parentNode}return!1},_createKeyEvent:function(l,a){return{type:l,event:a,preventDefault:function(){this.defaultPrevented=!0}}},_createMouseEvent:function(l,a){var d=this.convert({x:a.clientX,y:a.clientY},"page","document");return{type:l,event:a,clickCount:this._clickCount,x:d.x,y:d.y,
preventDefault:function(){this.defaultPrevented=!0}}},_handleMouseUp:function(l){var a=l.which?0===l.button:1===l.button;if(this.isListening("MouseUp")&&(this._isClientDiv(l)||a&&this._isMouseDown))this.onMouseUp(this._createMouseEvent("MouseUp",l));if(!this._linksVisible){if(a&&this._isMouseDown){if(-1!==this._dragOffset){var d=this._getSelection();d.extend(this._dragOffset);d.collapse();this._setSelection(d,!0,!0);this._dragOffset=-1}this._isMouseDown=!1;this._endAutoScroll();this._isW3CEvents&&
this._setGrab(null)}a&&f.isFirefox&&(this._updateDOMSelection(),l.preventDefault())}},_handleMouseWheel:function(l){var a=this._getLineHeight(),d=0,b=0;f.isIE||f.isOpera?b=-l.wheelDelta/40*a:f.isFirefox?"wheel"===l.type?l.deltaMode?(d=Math.max(-256,Math.min(256,l.deltaX))*a,b=Math.max(-256,Math.min(256,l.deltaY))*a):(d=l.deltaX,b=l.deltaY):(a=f.isMac?3*l.detail:Math.max(-256,Math.min(256,l.detail))*a,l.axis===l.HORIZONTAL_AXIS?d=a:b=a):f.isMac?(b=l.timeStamp-this._wheelTimeStamp,this._wheelTimeStamp=
l.timeStamp,d=0!==l.wheelDeltaX%120?1:40>b?40/(40-b):40,b=0!==l.wheelDeltaY%120?1:40>b?40/(40-b):40,d=Math.ceil(-l.wheelDeltaX/d),-1<d&&0>d&&(d=-1),0<d&&1>d&&(d=1),b=Math.ceil(-l.wheelDeltaY/b),-1<b&&0>b&&(b=-1),0<b&&1>b&&(b=1)):(d=-l.wheelDeltaX,b=8*(-l.wheelDeltaY/120)*a);if(f.isSafari||f.isChrome&&f.isMac){for(a=l.target;a&&void 0===a.lineIndex;)a=a.parentNode;this._mouseWheelLine=a}a=this._getScroll();this._scrollView(d,b);d=this._getScroll();if(a.x!==d.x||a.y!==d.y)return l.preventDefault&&l.preventDefault(),
!1},_handlePaste:function(a){if(!this._ignoreEvent(a)&&!this._ignorePaste&&this._doPaste(a)){if(f.isIE){var d=this;this._ignoreFocus=!0;this._getWindow().setTimeout(function(){d._updateDOMSelection();d._ignoreFocus=!1},0)}a.preventDefault&&a.preventDefault();return!1}},_handleResize:function(l){l=this._rootDiv.clientWidth;var d=this._rootDiv.clientHeight;if(this._rootWidth!==l||this._rootHeight!==d)this._rootWidth!==l&&this._wrapMode&&this._resetLineHeight(),this._rootWidth=l,this._rootHeight=d,l=
9>f.isIE,d=this._calculateMetrics(),a(d,this._metrics)||(this._variableLineHeight&&(this._variableLineHeight=!1,this._resetLineHeight()),this._metrics=d,l=!0),l?this._queueUpdate():this._update()},_handleRulerEvent:function(a){for(var d=a.target?a.target:a.srcElement,b=d.lineIndex;d&&!d._ruler;)void 0===b&&void 0!==d.lineIndex&&(b=d.lineIndex),d=d.parentNode;var k=d?d._ruler:null;if(void 0===b&&k&&"document"===k.getOverview()){var b=this._getClientHeight(),c=this._model.getLineCount(),f=this._getViewPadding(),
m=this._viewDiv.getBoundingClientRect(),b=Math.floor((a.clientY-m.top-this._metrics.scrollWidth)*c/(b+f.top+f.bottom-2*this._metrics.scrollWidth));0<=b&&b<c||(b=void 0)}if(k)switch(a.type){case "click":if(k.onClick)k.onClick(b,a);break;case "dblclick":if(k.onDblClick)k.onDblClick(b,a);break;case "mousemove":if(k.onMouseMove)k.onMouseMove(b,a);break;case "mouseover":if(k.onMouseOver)k.onMouseOver(b,a);break;case "mouseout":if(k.onMouseOut){for(c=a.relatedTarget;c&&c!==this._rootDiv;){if(c===d)return;
c=c.parentNode}k.onMouseOut(b,a)}}},_handleScroll:function(){var a=this._getScroll(!1),d=this._hScroll,b=this._vScroll;if(d!==a.x||b!==a.y)this._hScroll=a.x,this._vScroll=a.y,this._commitIME(),this._update(b===a.y),this.onScroll({type:"Scroll",oldValue:{x:d,y:b},newValue:a})},_handleSelectStart:function(a){if(this._ignoreSelect)return a&&a.preventDefault&&a.preventDefault(),!1},_getModelOffset:function(a,d){if(a){var b;b="DIV"===a.tagName?a:a.parentNode.parentNode;return!b._line?0:b._line._getModelOffset(a,
d)}},_updateSelectionFromDOM:function(){var a=this._getWindow().getSelection(),d=this._getModelOffset(a.anchorNode,a.anchorOffset),a=this._getModelOffset(a.focusNode,a.focusOffset);void 0===d||void 0===a||this._setSelection(new v(d,a),!1,!1)},_handleSelectionChange:function(a){if(-1===this._imeOffset)if(f.isAndroid){a=this._getWindow();this._selTimer&&a.clearTimeout(this._selTimer);var d=this;this._selTimer=a.setTimeout(function(){d._clientDiv&&(d._selTimer=null,d._updateSelectionFromDOM())},250)}else this._updateSelectionFromDOM()},
_handleTextInput:function(a){if(!this._ignoreEvent(a)){this._imeOffset=-1;var d=this._getWindow().getSelection();if(d.anchorNode!==this._anchorNode||d.focusNode!==this._focusNode||d.anchorOffset!==this._anchorOffset||d.focusOffset!==this._focusOffset){for(var b=d.anchorNode;b&&void 0===b.lineIndex;)b=b.parentNode;if(b){var k=this._model,c=b.lineIndex,f=k.getLine(c),m=f,e=0,k=k.getLineStart(c);0<d.rangeCount&&(d.getRangeAt(0).deleteContents(),c=b.ownerDocument.createTextNode(a.data),d.getRangeAt(0).insertNode(c),
e=this._getDOMText(b,c),m=e.text,e=e.offset,c.parentNode.removeChild(c));b.lineRemoved=!0;for(b=0;f.charCodeAt(b)===m.charCodeAt(b)&&b<e;)b++;d=f.length-1;for(c=m.length-f.length;f.charCodeAt(d)===m.charCodeAt(d+c)&&d+c>=e+a.data.length;)d--;d++;f=m.substring(b,d+c);this._modifyContent({text:f,start:b+k,end:d+k,_ignoreDOMSelection:!0},!0)}}else this._doContent(a.data);a.preventDefault()}},_handleTouchStart:function(a){this._commitIME();var d=this._getWindow();this._touchScrollTimer&&(this._vScrollDiv.style.display=
"none",this._hScrollDiv.style.display="none",d.clearInterval(this._touchScrollTimer),this._touchScrollTimer=null);var b=a.touches;if(1===b.length){var b=b[0],k=b.clientX,c=b.clientY;this._touchStartX=k;this._touchStartY=c;if(f.isAndroid&&(c<b.pageY-d.pageYOffset||k<b.pageX-d.pageXOffset))k=b.pageX-d.pageXOffset,c=b.pageY-d.pageYOffset;d=this.convert({x:k,y:c},"page","document");this._lastTouchOffset=this.getOffsetAtLocation(d.x,d.y);this._touchStartTime=a.timeStamp;this._touching=!0}},_handleTouchMove:function(a){var d=
a.touches;if(1===d.length){d=d[0];this._touchCurrentX=d.clientX;this._touchCurrentY=d.clientY;if(!this._touchScrollTimer&&200>a.timeStamp-this._touchStartTime){this._vScrollDiv.style.display="block";this._wrapMode||(this._hScrollDiv.style.display="block");var b=this,k=this._getWindow();this._touchScrollTimer=k.setInterval(function(){var a=0,l=0;if(b._touching)a=b._touchStartX-b._touchCurrentX,l=b._touchStartY-b._touchCurrentY,b._touchSpeedX=a/10,b._touchSpeedY=l/10,b._touchStartX=b._touchCurrentX,
b._touchStartY=b._touchCurrentY;else{if(0.1>Math.abs(b._touchSpeedX)&&0.1>Math.abs(b._touchSpeedY)){b._vScrollDiv.style.display="none";b._hScrollDiv.style.display="none";k.clearInterval(b._touchScrollTimer);b._touchScrollTimer=null;return}a=10*b._touchSpeedX;l=10*b._touchSpeedY;b._touchSpeedX*=0.95;b._touchSpeedY*=0.95}b._scrollView(a,l)},10)}this._touchScrollTimer&&a.preventDefault()}},_handleTouchEnd:function(a){0===a.touches.length&&(this._touching=!1)},_doAction:function(a){var d,b,k=this._keyModes;
for(b=k.length-1;0<=b;b--)if(d=k[b],"function"===typeof d.match&&(d=d.match(a),void 0!==d))return this.invokeAction(d);return!1},_doMove:function(a,d){var b=this._model,k=d.getCaret(),c=b.getLineAtOffset(k);a.count||(a.count=1);for(;0!==a.count;){var f=b.getLineStart(c);if(0>a.count&&k===f)if(0<c)"character"===a.unit&&a.count++,c--,d.extend(b.getLineEnd(c));else break;else if(0<a.count&&k===b.getLineEnd(c))if(c+1<b.getLineCount())"character"===a.unit&&a.count--,c++,d.extend(b.getLineStart(c));else break;
else{var m=!1;a.expandTab&&("character"===a.unit&&0===(k-f)%this._tabSize)&&(f=b.getText(f,k),m=!/[^ ]/.test(f));m?(d.extend(k-this._tabSize),a.count+=0>a.count?1:-1):(f=this._getLine(c),d.extend(f.getNextOffset(k,a)),f.destroy())}k=d.getCaret()}return d},_doBackspace:function(a){var d=this._getSelection();d.isEmpty()&&(a.count||(a.count=1),a.count*=-1,a.expandTab=this._expandTab,this._doMove(a,d));this._modifyContent({text:"",start:d.start,end:d.end},!0);return!0},_doCase:function(a){var d=this._getSelection();
this._doMove(a,d);var b=this.getText(d.start,d.end);this._setSelection(d,!0);switch(a.type){case "lower":b=b.toLowerCase();break;case "capitalize":b=b.replace(/(?:^|\s)\S/g,function(a){return a.toUpperCase()});break;case "reverse":a="";for(d=0;d<b.length;d++){var k=b[d],c=k.toLowerCase(),k=c!==k?c:k.toUpperCase();a+=k}b=a;break;default:b=b.toUpperCase()}this._doContent(b);return!0},_doContent:function(a){var d=this._getSelection();if(this._overwriteMode&&d.isEmpty()){var b=this._model,k=b.getLineAtOffset(d.end);
d.end<b.getLineEnd(k)&&(b=this._getLine(k),d.extend(b.getNextOffset(d.getCaret(),{unit:"character",count:1})),b.destroy())}this._modifyContent({text:a,start:d.start,end:d.end,_ignoreDOMSelection:!0},!0)},_doCopy:function(a){var d=this._getSelection();return!d.isEmpty()?(d=this._getBaseText(d.start,d.end),this._setClipboardText(d,a)):!0},_doCursorNext:function(a){var d=this._getSelection();!d.isEmpty()&&!a.select?d.start=d.end:this._doMove(a,d);a.select||d.collapse();this._setSelection(d,!0);return!0},
_doCursorPrevious:function(a){var d=this._getSelection();!d.isEmpty()&&!a.select?d.end=d.start:(a.count||(a.count=1),a.count*=-1,this._doMove(a,d));a.select||d.collapse();this._setSelection(d,!0);return!0},_doCut:function(a){var d=this._getSelection();return!d.isEmpty()?(d=this._getBaseText(d.start,d.end),this._doContent(""),this._setClipboardText(d,a)):!0},_doDelete:function(a){var d=this._getSelection();d.isEmpty()&&this._doMove(a,d);this._modifyContent({text:"",start:d.start,end:d.end},!0);return!0},
_doEnd:function(a){var d=this._getSelection(),b=this._model,k;if(a.ctrl)d.extend(b.getCharCount()),k=function(){};else{var c=d.getCaret(),f=b.getLineAtOffset(c);if(this._wrapMode){var m=this._getLine(f),c=m.getLineIndex(c),c=c===m.getLineCount()-1?b.getLineEnd(f):m.getLineStart(c+1)-1;m.destroy()}else a.count&&0<a.count&&(f=Math.min(f+a.count-1,b.getLineCount()-1)),c=b.getLineEnd(f);d.extend(c)}a.select||d.collapse();this._setSelection(d,!0,!0,k);return!0},_doEnter:function(a){var d=this._model,b=
this._getSelection();this._doContent(d.getLineDelimiter());a&&a.noCursor&&(b.end=b.start,this._setSelection(b,!0));return!0},_doHome:function(a){var d=this._getSelection(),b=this._model,k;if(a.ctrl)d.extend(0),k=function(){};else{var c=d.getCaret(),f=b.getLineAtOffset(c);this._wrapMode?(b=this._getLine(f),c=b.getLineIndex(c),c=b.getLineStart(c),b.destroy()):c=b.getLineStart(f);d.extend(c)}a.select||d.collapse();this._setSelection(d,!0,!0,k);return!0},_doLineDown:function(a){var d=this._model,b=this._getSelection(),
k=b.getCaret(),c=d.getLineAtOffset(k),m=this._getLine(c),e=this._columnX,r=1,p=!1;if(-1===e||a.wholeLine||a.select&&f.isIE)e=a.wholeLine?d.getLineEnd(c+1):k,e=m.getBoundingClientRect(e).left;(k=m.getLineIndex(k))<m.getLineCount()-1?r=m.getClientRects(k+1).top+1:(k=d.getLineCount()-1,p=c===k,a.count&&0<a.count?c=Math.min(c+a.count,k):c++);k=!1;if(p){if(a.select||f.isMac||f.isLinux)b.extend(d.getCharCount()),k=!0}else m.lineIndex!==c&&(m.destroy(),m=this._getLine(c)),b.extend(m.getOffset(e,r)),k=!0;
k&&(a.select||b.collapse(),this._setSelection(b,!0,!0));this._columnX=e;m.destroy();return!0},_doLineUp:function(a){var d=this._model,b=this._getSelection(),k=b.getCaret(),c=d.getLineAtOffset(k),m=this._getLine(c),e=this._columnX,r=!1,p;if(-1===e||a.wholeLine||a.select&&f.isIE)e=a.wholeLine?d.getLineStart(c-1):k,e=m.getBoundingClientRect(e).left;0<(k=m.getLineIndex(k))?p=m.getClientRects(k-1).top+1:(r=0===c,r||(a.count&&0<a.count?c=Math.max(c-a.count,0):c--,p=this._getLineHeight(c)-1));k=!1;if(r){if(a.select||
f.isMac||f.isLinux)b.extend(0),k=!0}else m.lineIndex!==c&&(m.destroy(),m=this._getLine(c)),b.extend(m.getOffset(e,p)),k=!0;k&&(a.select||b.collapse(),this._setSelection(b,!0,!0));this._columnX=e;m.destroy();return!0},_doNoop:function(){return!0},_doPageDown:function(a){var d=this,b=this._model,k=this._getSelection(),c=k.getCaret(),m=b.getLineAtOffset(c),e=b.getLineCount(),r=this._getScroll(),b=this._getClientHeight(),p,h;if(this._lineHeight){p=this._columnX;r=this._getBoundsAtOffset(c);if(-1===p||
a.select&&f.isIE)p=r.left;c=this._getLineIndex(r.top+b);h=this._getLine(c);m=this._getLinePixel(c);c=h.getOffset(p,r.top+b-m);b=h.getBoundingClientRect(c);h.destroy();k.extend(c);a.select||k.collapse();this._setSelection(k,!0,!0,function(){d._columnX=p},b.top+m-r.top);return!0}if(m<e-1){var v=this._getLineHeight(),g=Math.min(e-m-1,Math.floor(b/v)),g=Math.max(1,g);p=this._columnX;if(-1===p||a.select&&f.isIE)h=this._getLine(m),p=h.getBoundingClientRect(c).left,h.destroy();h=this._getLine(m+g);k.extend(h.getOffset(p,
0));h.destroy();a.select||k.collapse();a=e*v;c=r.y+g*v;c+b>a&&(c=a-b);this._setSelection(k,!0,!0,function(){d._columnX=p},c-r.y)}return!0},_doPageUp:function(a){var d=this,b=this._model,k=this._getSelection(),c=k.getCaret(),m=b.getLineAtOffset(c),e=this._getScroll(),r=this._getClientHeight(),p;if(this._lineHeight){p=this._columnX;e=this._getBoundsAtOffset(c);if(-1===p||a.select&&f.isIE)p=e.left;c=this._getLineIndex(e.bottom-r);b=this._getLine(c);m=this._getLinePixel(c);c=b.getOffset(p,e.bottom-r-
m);r=b.getBoundingClientRect(c);b.destroy();k.extend(c);a.select||k.collapse();this._setSelection(k,!0,!0,function(){d._columnX=p},r.top+m-e.top);return!0}if(0<m){var h=this._getLineHeight(),r=Math.max(1,Math.min(m,Math.floor(r/h)));p=this._columnX;if(-1===p||a.select&&f.isIE)b=this._getLine(m),p=b.getBoundingClientRect(c).left,b.destroy();b=this._getLine(m-r);k.extend(b.getOffset(p,this._getLineHeight(m-r)-1));b.destroy();a.select||k.collapse();a=Math.max(0,e.y-r*h);this._setSelection(k,!0,!0,function(){d._columnX=
p},a-e.y)}return!0},_doPaste:function(a){var d=this;return null!==this._getClipboardText(a,function(a){a&&(f.isLinux&&2===d._lastMouseButton&&(new Date).getTime()-d._lastMouseTime<=d._clickTime&&d._setSelectionTo(d._lastMouseX,d._lastMouseY),d._doContent(a))})},_doScroll:function(a){var d=a.type,b=this._model,k=b.getLineCount();a=this._getClientHeight();var c=this._getLineHeight(),k=k*c,f=this._getScroll().y,m;switch(d){case "textStart":m=0;break;case "textEnd":m=k-a;break;case "pageDown":m=f+a;break;
case "pageUp":m=f-a;break;case "lineDown":m=f+c;break;case "lineUp":m=f-c;break;case "centerLine":d=this._getSelection(),m=b.getLineAtOffset(d.start),b=(b.getLineAtOffset(d.end)-m+1)*c,m=m*c-a/2+b/2}void 0!==m&&(m=Math.min(Math.max(0,m),k-a),this._scrollViewAnimated(0,m-f,function(){}));return!0},_doSelectAll:function(a){a=this._model;var d=this._getSelection();d.setCaret(0);d.extend(a.getCharCount());this._setSelection(d,!1);return!0},_doTab:function(a){if(this._tabMode&&!this._readonly){a="\t";
if(this._expandTab){var d=this._model;a=this._getSelection().getCaret();var b=d.getLineAtOffset(a),d=d.getLineStart(b);a=Array(this._tabSize-(a-d)%this._tabSize+1).join(" ")}this._doContent(a);return!0}},_doShiftTab:function(a){if(this._tabMode&&!this._readonly)return!0},_doOverwriteMode:function(a){if(!this._readonly)return this.setOptions({overwriteMode:!this.getOptions("overwriteMode")}),!0},_doTabMode:function(a){this._tabMode=!this._tabMode;return!0},_doWrapMode:function(a){this.setOptions({wrapMode:!this.getOptions("wrapMode")});
return!0},_autoScroll:function(){var a=this._model,d=this._getSelection(),b=this.convert({x:this._autoScrollX,y:this._autoScrollY},"page","document"),k=d.getCaret(),c=a.getLineCount(),m=a.getLineAtOffset(k),e;if("up"===this._autoScrollDir||"down"===this._autoScrollDir)k=this._autoScrollY/this._getLineHeight(),k=0>k?Math.floor(k):Math.ceil(k),e=Math.max(0,Math.min(c-1,m+k));else if("left"===this._autoScrollDir||"right"===this._autoScrollDir)e=this._getLineIndex(b.y),m=this._getLine(m),b.x+=m.getBoundingClientRect(k,
!1).left,m.destroy();0===e&&(f.isMac||f.isLinux)?d.extend(0):e===c-1&&(f.isMac||f.isLinux)?d.extend(a.getCharCount()):(m=this._getLine(e),d.extend(m.getOffset(b.x,b.y-this._getLinePixel(e))),m.destroy());this._setSelection(d,!0)},_autoScrollTimer:function(){this._autoScroll();var a=this;this._autoScrollTimerID=this._getWindow().setTimeout(function(){a._autoScrollTimer()},this._AUTO_SCROLL_RATE)},_calculateLineHeightTimer:function(a){if(this._lineHeight&&!this._calculateLHTimer){var d=this._model.getLineCount(),
b=0;if(a){a=0;for(var k=(new Date).getTime(),c=0;b<d&&!(this._lineHeight[b]||(a++,c||(c=b),this._lineHeight[b]=this._calculateLineHeight(b)),b++,100<(new Date).getTime()-k););this.redrawRulers(0,d);this._queueUpdate()}a=this._getWindow();if(b!==d){var m=this;this._calculateLHTimer=a.setTimeout(function(){m._calculateLHTimer=null;m._calculateLineHeightTimer(!0)},0)}else this._calculateLHTimer&&(a.clearTimeout(this._calculateLHTimer),this._calculateLHTimer=void 0)}},_calculateLineHeight:function(a){a=
this._getLine(a);var d=a.getBoundingClientRect();a.destroy();return Math.max(1,d.bottom-d.top)},_calculateMetrics:function(){var a=this._clientDiv,d=a.ownerDocument,b=f.createElement(d,"div");b.style.lineHeight="normal";var c={type:"LineStyle",textView:this,0:0,lineText:this._model.getLine(0),lineStart:0};this.onLineStyle(c);p(c.style,b);b.style.position="fixed";b.style.left="-1000px";var m=f.createElement(d,"span");m.appendChild(d.createTextNode(" "));b.appendChild(m);var e=f.createElement(d,"span");
e.style.fontStyle="italic";e.appendChild(d.createTextNode(" "));b.appendChild(e);var h=f.createElement(d,"span");h.style.fontWeight="bold";h.appendChild(d.createTextNode(" "));b.appendChild(h);c=f.createElement(d,"span");c.style.fontWeight="bold";c.style.fontStyle="italic";c.appendChild(d.createTextNode(" "));b.appendChild(c);a.appendChild(b);var v=b.getBoundingClientRect(),m=m.getBoundingClientRect(),e=e.getBoundingClientRect(),h=h.getBoundingClientRect(),c=c.getBoundingClientRect(),m=m.bottom-m.top,
e=e.bottom-e.top,h=h.bottom-h.top,g=c.bottom-c.top,t=0,c=0>=v.bottom-v.top,v=Math.max(1,v.bottom-v.top);e>m&&(t=1);h>e&&(t=2);g>h&&(t=3);var u;0!==t&&(u={style:{}},0!==(t&1)&&(u.style.fontStyle="italic"),0!==(t&2)&&(u.style.fontWeight="bold"));m=r(b);a.removeChild(b);g=k(this._viewDiv);b=f.createElement(d,"div");b.style.position="fixed";b.style.left="-1000px";b.style.paddingLeft=g.left+"px";b.style.paddingTop=g.top+"px";b.style.paddingRight=g.right+"px";b.style.paddingBottom=g.bottom+"px";b.style.width=
"100px";b.style.height="100px";g=f.createElement(d,"div");g.style.width="100%";g.style.height="100%";b.appendChild(g);a.appendChild(b);t=b.getBoundingClientRect();e=g.getBoundingClientRect();h=0;this._singleMode||(b.style.overflow="hidden",g.style.height="200px",h=b.clientWidth,b.style.overflow="scroll",h-=b.clientWidth);a.removeChild(b);g={left:e.left-t.left,top:e.top-t.top,right:t.right-e.right,bottom:t.bottom-e.bottom};e=t=0;if(!c&&(this._wrapOffset||this._marginOffset))b=f.createElement(d,"div"),
b.style.position="fixed",b.style.left="-1000px",b.innerHTML=Array(this._wrapOffset+1+(f.isWebkit?0:1)).join(" "),a.appendChild(b),t=b.getBoundingClientRect(),t=Math.ceil(t.right-t.left),b.innerHTML=Array(this._marginOffset+1).join(" "),e=b.getBoundingClientRect(),e=Math.ceil(e.right-e.left),a.removeChild(b);return{lineHeight:v,largestFontStyle:u,lineTrim:m,viewPadding:g,scrollWidth:h,wrapWidth:t,marginWidth:e,invalid:c}},_cancelAnimation:function(){this._animation&&(this._animation.stop(),this._animation=
null)},_clearSelection:function(a){var d=this._getSelection();if(d.isEmpty())return!1;"next"===a?d.start=d.end:d.end=d.start;this._setSelection(d,!0);return!0},_commitIME:function(){if(-1!==this._imeOffset){this._scrollDiv.focus();this._clientDiv.focus();var a=this._model,d=a.getLineAtOffset(this._imeOffset),b=a.getLineStart(d),k=this._getDOMText(this._getLineNode(d)).text,a=a.getLine(d),b=this._imeOffset-b,a=b+k.length-a.length;b!==a&&(k=k.substring(b,a),this._doContent(k));this._imeOffset=-1}},
_createActions:function(){this.addKeyMode(new s.DefaultKeyMode(this));var a=this;this._actions={noop:{defaultHandler:function(){return a._doNoop()}},lineUp:{defaultHandler:function(d){return a._doLineUp(b(d,{select:!1}))},actionDescription:{name:n.lineUp}},lineDown:{defaultHandler:function(d){return a._doLineDown(b(d,{select:!1}))},actionDescription:{name:n.lineDown}},lineStart:{defaultHandler:function(d){return a._doHome(b(d,{select:!1,ctrl:!1}))},actionDescription:{name:n.lineStart}},lineEnd:{defaultHandler:function(d){return a._doEnd(b(d,
{select:!1,ctrl:!1}))},actionDescription:{name:n.lineEnd}},charPrevious:{defaultHandler:function(d){return a._doCursorPrevious(b(d,{select:!1,unit:"character"}))},actionDescription:{name:n.charPrevious}},charNext:{defaultHandler:function(d){return a._doCursorNext(b(d,{select:!1,unit:"character"}))},actionDescription:{name:n.charNext}},pageUp:{defaultHandler:function(d){return a._doPageUp(b(d,{select:!1}))},actionDescription:{name:n.pageUp}},pageDown:{defaultHandler:function(d){return a._doPageDown(b(d,
{select:!1}))},actionDescription:{name:n.pageDown}},scrollPageUp:{defaultHandler:function(d){return a._doScroll(b(d,{type:"pageUp"}))},actionDescription:{name:n.scrollPageUp}},scrollPageDown:{defaultHandler:function(d){return a._doScroll(b(d,{type:"pageDown"}))},actionDescription:{name:n.scrollPageDown}},scrollLineUp:{defaultHandler:function(d){return a._doScroll(b(d,{type:"lineUp"}))},actionDescription:{name:n.scrollLineUp}},scrollLineDown:{defaultHandler:function(d){return a._doScroll(b(d,{type:"lineDown"}))},
actionDescription:{name:n.scrollLineDown}},wordPrevious:{defaultHandler:function(d){return a._doCursorPrevious(b(d,{select:!1,unit:"word"}))},actionDescription:{name:n.wordPrevious}},wordNext:{defaultHandler:function(d){return a._doCursorNext(b(d,{select:!1,unit:"word"}))},actionDescription:{name:n.wordNext}},textStart:{defaultHandler:function(d){return a._doHome(b(d,{select:!1,ctrl:!0}))},actionDescription:{name:n.textStart}},textEnd:{defaultHandler:function(d){return a._doEnd(b(d,{select:!1,ctrl:!0}))},
actionDescription:{name:n.textEnd}},scrollTextStart:{defaultHandler:function(d){return a._doScroll(b(d,{type:"textStart"}))},actionDescription:{name:n.scrollTextStart}},scrollTextEnd:{defaultHandler:function(d){return a._doScroll(b(d,{type:"textEnd"}))},actionDescription:{name:n.scrollTextEnd}},centerLine:{defaultHandler:function(d){return a._doScroll(b(d,{type:"centerLine"}))},actionDescription:{name:n.centerLine}},selectLineUp:{defaultHandler:function(d){return a._doLineUp(b(d,{select:!0}))},actionDescription:{name:n.selectLineUp}},
selectLineDown:{defaultHandler:function(d){return a._doLineDown(b(d,{select:!0}))},actionDescription:{name:n.selectLineDown}},selectWholeLineUp:{defaultHandler:function(d){return a._doLineUp(b(d,{select:!0,wholeLine:!0}))},actionDescription:{name:n.selectWholeLineUp}},selectWholeLineDown:{defaultHandler:function(d){return a._doLineDown(b(d,{select:!0,wholeLine:!0}))},actionDescription:{name:n.selectWholeLineDown}},selectLineStart:{defaultHandler:function(d){return a._doHome(b(d,{select:!0,ctrl:!1}))},
actionDescription:{name:n.selectLineStart}},selectLineEnd:{defaultHandler:function(d){return a._doEnd(b(d,{select:!0,ctrl:!1}))},actionDescription:{name:n.selectLineEnd}},selectCharPrevious:{defaultHandler:function(d){return a._doCursorPrevious(b(d,{select:!0,unit:"character"}))},actionDescription:{name:n.selectCharPrevious}},selectCharNext:{defaultHandler:function(d){return a._doCursorNext(b(d,{select:!0,unit:"character"}))},actionDescription:{name:n.selectCharNext}},selectPageUp:{defaultHandler:function(d){return a._doPageUp(b(d,
{select:!0}))},actionDescription:{name:n.selectPageUp}},selectPageDown:{defaultHandler:function(d){return a._doPageDown(b(d,{select:!0}))},actionDescription:{name:n.selectPageDown}},selectWordPrevious:{defaultHandler:function(d){return a._doCursorPrevious(b(d,{select:!0,unit:"word"}))},actionDescription:{name:n.selectWordPrevious}},selectWordNext:{defaultHandler:function(d){return a._doCursorNext(b(d,{select:!0,unit:"word"}))},actionDescription:{name:n.selectWordNext}},selectTextStart:{defaultHandler:function(d){return a._doHome(b(d,
{select:!0,ctrl:!0}))},actionDescription:{name:n.selectTextStart}},selectTextEnd:{defaultHandler:function(d){return a._doEnd(b(d,{select:!0,ctrl:!0}))},actionDescription:{name:n.selectTextEnd}},deletePrevious:{defaultHandler:function(d){return a._doBackspace(b(d,{unit:"character"}))},actionDescription:{name:n.deletePrevious}},deleteNext:{defaultHandler:function(d){return a._doDelete(b(d,{unit:"character"}))},actionDescription:{name:n.deleteNext}},deleteWordPrevious:{defaultHandler:function(d){return a._doBackspace(b(d,
{unit:"word"}))},actionDescription:{name:n.deleteWordPrevious}},deleteWordNext:{defaultHandler:function(d){return a._doDelete(b(d,{unit:"word"}))},actionDescription:{name:n.deleteWordNext}},deleteLineStart:{defaultHandler:function(d){return a._doBackspace(b(d,{unit:"line"}))},actionDescription:{name:n.deleteLineStart}},deleteLineEnd:{defaultHandler:function(d){return a._doDelete(b(d,{unit:"line"}))},actionDescription:{name:n.deleteLineEnd}},tab:{defaultHandler:function(d){return a._doTab()},actionDescription:{name:n.tab}},
shiftTab:{defaultHandler:function(d){return a._doShiftTab()},actionDescription:{name:n.shiftTab}},enter:{defaultHandler:function(d){return a._doEnter()},actionDescription:{name:n.enter}},enterNoCursor:{defaultHandler:function(d){return a._doEnter(b(d,{noCursor:!0}))},actionDescription:{name:n.enterNoCursor}},selectAll:{defaultHandler:function(d){return a._doSelectAll()},actionDescription:{name:n.selectAll}},copy:{defaultHandler:function(d){return a._doCopy()},actionDescription:{name:n.copy}},cut:{defaultHandler:function(d){return a._doCut()},
actionDescription:{name:n.cut}},paste:{defaultHandler:function(d){return a._doPaste()},actionDescription:{name:n.paste}},uppercase:{defaultHandler:function(d){return a._doCase(b(d,{type:"upper"}))},actionDescription:{name:n.uppercase}},lowercase:{defaultHandler:function(d){return a._doCase(b(d,{type:"lower"}))},actionDescription:{name:n.lowercase}},capitalize:{defaultHandler:function(d){return a._doCase(b(d,{unit:"word",type:"capitalize"}))},actionDescription:{name:n.capitalize}},reversecase:{defaultHandler:function(d){return a._doCase(b(d,
{type:"reverse"}))},actionDescription:{name:n.reversecase}},toggleOverwriteMode:{defaultHandler:function(d){return a._doOverwriteMode()},actionDescription:{name:n.toggleOverwriteMode}},toggleTabMode:{defaultHandler:function(d){return a._doTabMode()},actionDescription:{name:n.toggleTabMode}},toggleWrapMode:{defaultHandler:function(d){return a._doWrapMode()},actionDescription:{name:n.toggleWrapMode}}}},_createRulerParent:function(a,d){var b=f.createElement(a,"div");b.className=d;b.tabIndex=-1;b.style.overflow=
"hidden";b.style.MozUserSelect="none";b.style.WebkitUserSelect="none";b.style.position="absolute";b.style.top="0px";b.style.bottom="0px";b.style.cursor="default";b.style.display="none";b.setAttribute("aria-hidden","true");this._rootDiv.appendChild(b);return b},_createRuler:function(a,d){if(this._clientDiv){var b=this._getRulerParent(a);if(b){if(b!==this._marginDiv||this._marginOffset)b.style.display="block";var k=f.createElement(b.ownerDocument,"div");k._ruler=a;k.rulerChanged=!0;k.style.position=
"relative";k.style.cssFloat="left";k.style.styleFloat="left";k.style.outline="none";if(void 0===d||0>d||d>=b.children.length)b.appendChild(k);else{for(var c=b.firstChild;c&&0<d--;)c=c.nextSibling;b.insertBefore(k,c)}}}},_createView:function(){function a(){e._rootDiv&&(e.update(!0),e._metrics.invalid&&e._getWindow().setTimeout(function(){a()},100))}if(!this._clientDiv){for(var d=this._parent;d.hasChildNodes();)d.removeChild(d.lastChild);var b=d.ownerDocument,k=f.createElement(b,"div");this._rootDiv=
k;k.tabIndex=-1;k.style.position="relative";k.style.overflow="hidden";k.style.width="100%";k.style.height="100%";k.style.overflow="hidden";k.style.WebkitTextSizeAdjust="100%";k.setAttribute("role","application");d.appendChild(k);this._leftDiv=this._createRulerParent(b,"textviewLeftRuler");d=f.createElement(b,"div");d.className="textviewScroll";this._viewDiv=d;d.tabIndex=-1;d.style.position="absolute";d.style.top="0px";d.style.bottom="0px";d.style.borderWidth="0px";d.style.margin="0px";d.style.outline=
"none";d.style.background="transparent";f.isMac&&f.isWebkit&&(d.style.pointerEvents="none",d.style.zIndex="2");k.appendChild(d);var c=this._createRulerParent(b,"textviewRightRuler");this._rightDiv=c;c.style.right="0px";this._scrollDiv=c=f.createElement(b,"div");c.style.margin="0px";c.style.borderWidth="0px";c.style.padding="0px";d.appendChild(c);(this._marginDiv=this._createRulerParent(b,"textviewMarginRuler")).style.zIndex="4";!f.isIE&&!f.isIOS&&(this._clipDiv=d=f.createElement(b,"div"),d.style.position=
"absolute",d.style.overflow="hidden",d.style.margin="0px",d.style.borderWidth="0px",d.style.padding="0px",d.style.background="transparent",k.appendChild(d),this._clipScrollDiv=c=f.createElement(b,"div"),c.style.position="absolute",c.style.height="1px",c.style.top="-1000px",c.style.background="transparent",d.appendChild(c));this._setFullSelection(this._fullSelection,!0);d=f.createElement(b,"div");d.className="textviewContent";this._clientDiv=d;d.tabIndex=0;d.style.position="absolute";d.style.borderWidth=
"0px";d.style.margin="0px";d.style.padding="0px";d.style.outline="none";d.style.zIndex="1";d.style.WebkitUserSelect="text";d.setAttribute("spellcheck","false");if(f.isIOS||f.isAndroid)d.style.WebkitTapHighlightColor="transparent";(this._clipDiv||k).appendChild(d);if(f.isIOS||f.isAndroid)this._vScrollDiv=c=f.createElement(b,"div"),c.style.position="absolute",c.style.borderWidth="1px",c.style.borderColor="white",c.style.borderStyle="solid",c.style.borderRadius="4px",c.style.backgroundColor="black",
c.style.opacity="0.5",c.style.margin="0px",c.style.padding="0px",c.style.outline="none",c.style.zIndex="3",c.style.width="8px",c.style.display="none",k.appendChild(c),this._hScrollDiv=c=f.createElement(b,"div"),c.style.position="absolute",c.style.borderWidth="1px",c.style.borderColor="white",c.style.borderStyle="solid",c.style.borderRadius="4px",c.style.backgroundColor="black",c.style.opacity="0.5",c.style.margin="0px",c.style.padding="0px",c.style.outline="none",c.style.zIndex="3",c.style.height=
"8px",c.style.display="none",k.appendChild(c);f.isFirefox&&!d.setCapture&&(this._overlayDiv=c=f.createElement(b,"div"),c.style.position=d.style.position,c.style.borderWidth=d.style.borderWidth,c.style.margin=d.style.margin,c.style.padding=d.style.padding,c.style.cursor="text",c.style.zIndex="2",(this._clipDiv||k).appendChild(c));d.contentEditable="true";d.setAttribute("role","textbox");d.setAttribute("aria-multiline","true");this._setWrapMode(this._wrapMode,!0);this._setReadOnly(this._readonly);this._setThemeClass(this._themeClass,
!0);this._setTabSize(this._tabSize,!0);this._setMarginOffset(this._marginOffset,!0);this._hookEvents();d=this._rulers;for(c=0;c<d.length;c++)this._createRuler(d[c]);this._update();var e=this;m(b,k,"textview",a)}},_defaultOptions:function(){return{parent:{value:void 0,update:null},model:{value:void 0,update:this.setModel},scrollAnimation:{value:0,update:null},readonly:{value:!1,update:this._setReadOnly},fullSelection:{value:!0,update:this._setFullSelection},tabMode:{value:!0,update:null},tabSize:{value:8,
update:this._setTabSize},expandTab:{value:!1,update:null},singleMode:{value:!1,update:this._setSingleMode},overwriteMode:{value:!1,update:this._setOverwriteMode},blockCursorVisible:{value:!1,update:this._setBlockCursor},marginOffset:{value:0,update:this._setMarginOffset},wrapOffset:{value:0,update:this._setWrapOffset},wrapMode:{value:!1,update:this._setWrapMode},wrappable:{value:!1,update:null},theme:{value:c.TextTheme.getTheme(),update:this._setTheme},themeClass:{value:void 0,update:this._setThemeClass}}},
_destroyRuler:function(a){var d=this._getRulerParent(a);if(d)for(var b=d.firstChild;b;){if(b._ruler===a){b._ruler=void 0;d.removeChild(b);if(0===d.children.length&&(d!==this._marginDiv||!this._marginOffset))d.style.display="none";break}b=b.nextSibling}},_destroyView:function(){if(this._clientDiv){this._setGrab(null);this._unhookEvents();var a=this._getWindow();this._autoScrollTimerID&&(a.clearTimeout(this._autoScrollTimerID),this._autoScrollTimerID=null);this._updateTimer&&(a.clearTimeout(this._updateTimer),
this._updateTimer=null);a=this._rootDiv;a.parentNode.removeChild(a);this._hScrollDiv=this._vScrollDiv=this._cursorDiv=this._marginDiv=this._rightDiv=this._leftDiv=this._overlayDiv=this._clientDiv=this._clipScrollDiv=this._clipDiv=this._viewDiv=this._scrollDiv=this._rootDiv=this._clipboardDiv=this._selDiv3=this._selDiv2=this._selDiv1=null}},_doAutoScroll:function(a,d,b){this._autoScrollDir=a;this._autoScrollX=d;this._autoScrollY=b;this._autoScrollTimerID||this._autoScrollTimer()},_endAutoScroll:function(){this._autoScrollTimerID&&
this._getWindow().clearTimeout(this._autoScrollTimerID);this._autoScrollTimerID=this._autoScrollDir=void 0},_fixCaret:function(){var a=this._clientDiv;if(a){var d=this._hasFocus;this._ignoreFocus=!0;d&&a.blur();a.contentEditable=!1;a.contentEditable=!0;d&&a.focus();this._ignoreFocus=!1}},_getBaseText:function(a,d){var b=this._model;b.getBaseModel&&(a=b.mapOffset(a),d=b.mapOffset(d),b=b.getBaseModel());return b.getText(a,d)},_getBottomIndex:function(a){var d=this._bottomChild;if(a&&this._getClientHeight()>
this._getLineHeight()){a=d.getBoundingClientRect();var b=this._clientDiv.getBoundingClientRect();a.bottom>b.bottom&&(d=this._getLinePrevious(d)||d)}return d.lineIndex},_getBoundsAtOffset:function(a){var d=this._getLine(this._model.getLineAtOffset(a));a=d.getBoundingClientRect(a);var b=this._getLinePixel(d.lineIndex);a.top+=b;a.bottom+=b;d.destroy();return a},_getClientHeight:function(){var a=this._getViewPadding();return Math.max(0,this._viewDiv.clientHeight-a.top-a.bottom)},_getClientWidth:function(){var a=
this._getViewPadding();return Math.max(0,this._viewDiv.clientWidth-a.left-a.right)},_getClipboardText:function(a,b){var k=this._model.getLineDelimiter(),c,m,e=this._getWindow(),r=e.clipboardData;!r&&a&&(r=a.clipboardData);if(r)return c=[],m=r.getData(f.isIE?"Text":"text/plain"),d(m,function(a){c.push(a)},function(){c.push(k)}),m=c.join(""),b&&b(m),m;if(f.isFirefox){this._ignoreFocus=!0;var p=this._clipboardDiv,r=this._rootDiv.ownerDocument;p||(this._clipboardDiv=p=f.createElement(r,"div"),p.style.position=
"fixed",p.style.whiteSpace="pre",p.style.left="-1000px",this._rootDiv.appendChild(p));p.innerHTML="\x3cpre contenteditable\x3d''\x3e\x3c/pre\x3e";p.firstChild.focus();var h=this,v=function(){var a=h._getTextFromElement(p);p.innerHTML="";c=[];d(a,function(a){c.push(a)},function(){c.push(k)});return c.join("")},g=!1;this._ignorePaste=!0;if(!f.isLinux||2!==this._lastMouseButton)try{g=r.execCommand("paste",!1,null)}catch(t){g=1<p.childNodes.length||p.firstChild&&0<p.firstChild.childNodes.length}this._ignorePaste=
!1;if(!g){if(a)return e.setTimeout(function(){h.focus();(m=v())&&b&&b(m);h._ignoreFocus=!1},0),null;this.focus();this._ignoreFocus=!1;return""}this.focus();this._ignoreFocus=!1;(m=v())&&b&&b(m);return m}return""},_getDOMText:function(a,d){return a._line.getText(d)},_getTextFromElement:function(a){var d=a.ownerDocument,b=d.defaultView;if(!b.getSelection)return a.innerText||a.textContent;d=d.createRange();d.selectNode(a);a=b.getSelection();var b=[],k;for(k=0;k<a.rangeCount;k++)b.push(a.getRangeAt(k));
this._ignoreSelect=!0;a.removeAllRanges();a.addRange(d);d=a.toString();a.removeAllRanges();for(k=0;k<b.length;k++)a.addRange(b[k]);this._ignoreSelect=!1;return d},_getViewPadding:function(){return this._metrics.viewPadding},_getLine:function(a){var d=this._getLineNode(a);return d&&!d.lineChanged&&!d.lineRemoved?d._line:new u(this,a)},_getLineHeight:function(a,d){if(void 0!==a&&this._lineHeight){var b=this._lineHeight[a];if(b)return b;if(d||void 0===d)return this._lineHeight[a]=this._calculateLineHeight(a)}return this._metrics.lineHeight},
_getLineNode:function(a){for(var d=this._clientDiv.firstChild;d;){if(a===d.lineIndex)return d;d=d.nextSibling}},_getLineNext:function(a){for(a=a?a.nextSibling:this._clientDiv.firstChild;a&&-1===a.lineIndex;)a=a.nextSibling;return a},_getLinePrevious:function(a){for(a=a?a.previousSibling:this._clientDiv.lastChild;a&&-1===a.lineIndex;)a=a.previousSibling;return a},_getLinePixel:function(a){a=Math.min(Math.max(0,a),this._model.getLineCount());if(this._lineHeight){var d=this._getTopIndex(),b=-this._topIndexY+
this._getScroll().y;if(a>d)for(;d<a;d++)b+=this._getLineHeight(d);else for(d-=1;d>=a;d--)b-=this._getLineHeight(d);return b}return this._getLineHeight()*a},_getLineIndex:function(a){var d,b=0,k=this._model.getLineCount();if(this._lineHeight){var b=this._getTopIndex(),c=-this._topIndexY+this._getScroll().y;if(a!==c)if(a<c)for(;a<c&&0<b;)a+=this._getLineHeight(--b);else for(d=this._getLineHeight(b);a-d>=c&&b<k-1;)a-=d,d=this._getLineHeight(++b)}else d=this._getLineHeight(),b=Math.floor(a/d);return Math.max(0,
Math.min(k-1,b))},_getRulerParent:function(a){switch(a.getLocation()){case "left":return this._leftDiv;case "right":return this._rightDiv;case "margin":return this._marginDiv}return null},_getScroll:function(a){(void 0===a||a)&&this._cancelAnimation();a=this._viewDiv;return{x:a.scrollLeft,y:a.scrollTop}},_getSelection:function(){return this._selection.clone()},_getTopIndex:function(a){var d=this._topChild;if(a&&this._getClientHeight()>this._getLineHeight()){a=d.getBoundingClientRect();var b=this._getViewPadding(),
k=this._viewDiv.getBoundingClientRect();a.top<k.top+b.top&&(d=this._getLineNext(d)||d)}return d.lineIndex},_hookEvents:function(){var a=this;this._modelListener={onChanging:function(d){a._onModelChanging(d)},onChanged:function(d){a._onModelChanged(d)}};this._model.addEventListener("preChanging",this._modelListener.onChanging);this._model.addEventListener("postChanged",this._modelListener.onChanged);this._themeListener={onChanged:function(d){a._setThemeClass(a._themeClass)}};this._theme.addEventListener("ThemeChanged",
this._themeListener.onChanged);var d=this._handlers=[],b=this._clientDiv,k=this._viewDiv,c=this._rootDiv,m=this._overlayDiv||b,e=b.ownerDocument,r=this._getWindow(),p=f.isIE?e:r;d.push({target:r,type:"resize",handler:function(d){return a._handleResize(d?d:r.event)}});d.push({target:b,type:"blur",handler:function(d){return a._handleBlur(d?d:r.event)}});d.push({target:b,type:"focus",handler:function(d){return a._handleFocus(d?d:r.event)}});d.push({target:k,type:"focus",handler:function(a){b.focus()}});
d.push({target:k,type:"scroll",handler:function(d){return a._handleScroll(d?d:r.event)}});d.push({target:b,type:"textInput",handler:function(d){return a._handleTextInput(d?d:r.event)}});d.push({target:b,type:"keydown",handler:function(d){return a._handleKeyDown(d?d:r.event)}});d.push({target:b,type:"keypress",handler:function(d){return a._handleKeyPress(d?d:r.event)}});d.push({target:b,type:"keyup",handler:function(d){return a._handleKeyUp(d?d:r.event)}});f.isIE&&d.push({target:e,type:"keyup",handler:function(d){return a._handleDocKeyUp(d?
d:r.event)}});d.push({target:b,type:"contextmenu",handler:function(d){return a._handleContextMenu(d?d:r.event)}});d.push({target:b,type:"copy",handler:function(d){return a._handleCopy(d?d:r.event)}});d.push({target:b,type:"cut",handler:function(d){return a._handleCut(d?d:r.event)}});d.push({target:b,type:"paste",handler:function(d){return a._handlePaste(d?d:r.event)}});if(f.isIOS||f.isAndroid)d.push({target:e,type:"selectionchange",handler:function(d){return a._handleSelectionChange(d?d:r.event)}}),
d.push({target:b,type:"touchstart",handler:function(d){return a._handleTouchStart(d?d:r.event)}}),d.push({target:b,type:"touchmove",handler:function(d){return a._handleTouchMove(d?d:r.event)}}),d.push({target:b,type:"touchend",handler:function(d){return a._handleTouchEnd(d?d:r.event)}});else{d.push({target:b,type:"selectstart",handler:function(d){return a._handleSelectStart(d?d:r.event)}});d.push({target:b,type:"mousedown",handler:function(d){return a._handleMouseDown(d?d:r.event)}});d.push({target:b,
type:"mouseover",handler:function(d){return a._handleMouseOver(d?d:r.event)}});d.push({target:b,type:"mouseout",handler:function(d){return a._handleMouseOut(d?d:r.event)}});d.push({target:p,type:"mouseup",handler:function(d){return a._handleMouseUp(d?d:r.event)}});d.push({target:p,type:"mousemove",handler:function(d){return a._handleMouseMove(d?d:r.event)}});d.push({target:c,type:"mousedown",handler:function(d){return a._handleRootMouseDown(d?d:r.event)}});d.push({target:c,type:"mouseup",handler:function(d){return a._handleRootMouseUp(d?
d:r.event)}});d.push({target:m,type:"dragstart",handler:function(d){return a._handleDragStart(d?d:r.event)}});d.push({target:m,type:"drag",handler:function(d){return a._handleDrag(d?d:r.event)}});d.push({target:m,type:"dragend",handler:function(d){return a._handleDragEnd(d?d:r.event)}});d.push({target:m,type:"dragenter",handler:function(d){return a._handleDragEnter(d?d:r.event)}});d.push({target:m,type:"dragover",handler:function(d){return a._handleDragOver(d?d:r.event)}});d.push({target:m,type:"dragleave",
handler:function(d){return a._handleDragLeave(d?d:r.event)}});d.push({target:m,type:"drop",handler:function(d){return a._handleDrop(d?d:r.event)}});d.push({target:this._clientDiv,type:26<f.isFirefox?"wheel":f.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(d){return a._handleMouseWheel(d?d:r.event)}});this._clipDiv&&d.push({target:this._clipDiv,type:26<f.isFirefox?"wheel":f.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(d){return a._handleMouseWheel(d?d:r.event)}});if(f.isFirefox&&
(!f.isWindows||15<=f.isFirefox))(k=r.MutationObserver||r.MozMutationObserver)?(this._mutationObserver=new k(function(d){a._handleDataModified(d)}),this._mutationObserver.observe(b,{subtree:!0,characterData:!0})):d.push({target:this._clientDiv,type:"DOMCharacterDataModified",handler:function(d){return a._handleDataModified(d?d:r.event)}});this._overlayDiv&&(d.push({target:this._overlayDiv,type:"mousedown",handler:function(d){return a._handleMouseDown(d?d:r.event)}}),d.push({target:this._overlayDiv,
type:"mouseover",handler:function(d){return a._handleMouseOver(d?d:r.event)}}),d.push({target:this._overlayDiv,type:"mouseout",handler:function(d){return a._handleMouseOut(d?d:r.event)}}),d.push({target:this._overlayDiv,type:"contextmenu",handler:function(d){return a._handleContextMenu(d?d:r.event)}}));this._isW3CEvents||d.push({target:this._clientDiv,type:"dblclick",handler:function(d){return a._handleDblclick(d?d:r.event)}})}this._hookRulerEvents(this._leftDiv,d);this._hookRulerEvents(this._rightDiv,
d);this._hookRulerEvents(this._marginDiv,d);for(k=0;k<d.length;k++)c=d[k],A(c.target,c.type,c.handler,c.capture)},_hookRulerEvents:function(a,d){if(a){var b=this,k=this._getWindow();f.isIE&&d.push({target:a,type:"selectstart",handler:function(){return!1}});d.push({target:a,type:26<f.isFirefox?"wheel":f.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(a){return b._handleMouseWheel(a?a:k.event)}});d.push({target:a,type:"click",handler:function(a){b._handleRulerEvent(a?a:k.event)}});d.push({target:a,
type:"dblclick",handler:function(a){b._handleRulerEvent(a?a:k.event)}});d.push({target:a,type:"mousemove",handler:function(a){b._handleRulerEvent(a?a:k.event)}});d.push({target:a,type:"mouseover",handler:function(a){b._handleRulerEvent(a?a:k.event)}});d.push({target:a,type:"mouseout",handler:function(a){b._handleRulerEvent(a?a:k.event)}})}},_getWindow:function(){return this._parent.ownerDocument.defaultView||this._parent.ownerDocument.parentWindow},_ignoreEvent:function(a){for(a=a.target;a&&a!==this._clientDiv;){if(a.ignore)return!0;
a=a.parentNode}return!1},_init:function(a){var d=a.parent;"string"===typeof d&&(d=(a.document||document).getElementById(d));if(!d)throw"no parent";a.parent=d;a.model=a.model||new q.TextModel;var b=this._defaultOptions(),k;for(k in b)b.hasOwnProperty(k)&&(this["_"+k]=void 0!==a[k]?a[k]:b[k].value);this._keyModes=[];this._rulers=[];this._selection=new v(0,0,!1);this._linksVisible=!1;this._maxLineWidth=this._redrawCount=0;this._maxLineIndex=-1;this._ignoreSelect=!0;this._hasFocus=this._ignoreFocus=!1;
this._dragOffset=this._columnX=-1;this._isRangeRects=(!f.isIE||9<=f.isIE)&&"function"===typeof d.ownerDocument.createRange().getBoundingClientRect;this._isW3CEvents=d.addEventListener;this._autoScrollTimerID=this._autoScrollY=this._autoScrollX=null;this._AUTO_SCROLL_RATE=50;this._mouseUpClosure=this._moseMoveClosure=this._grabControl=null;this._clickCount=this._lastMouseTime=this._lastMouseY=this._lastMouseX=0;this._clickTime=250;this._clickDist=5;this._isMouseDown=!1;this._doubleClickSelection=null;
this._vScroll=this._hScroll=0;this._imeOffset=-1;this._createActions();this._createView()},_modifyContent:function(a,d){if(!this._readonly||a._code)if(a.type="Verify",this.onVerify(a),!(null===a.text||void 0===a.text)){var b=this._model;try{a._ignoreDOMSelection&&(this._ignoreDOMSelection=!0),b.setText(a.text,a.start,a.end)}finally{a._ignoreDOMSelection&&(this._ignoreDOMSelection=!1)}d&&(b=this._getSelection(),b.setCaret(a.start+a.text.length),this._setSelection(b,!0));this.onModify({type:"Modify"})}},
_onModelChanged:function(a){a.type="ModelChanged";this.onModelChanged(a);a.type="Changed";var d=a.start,b=a.addedCharCount,k=a.removedCharCount,c=a.addedLineCount,m=a.removedLineCount,f=this._getSelection();f.end>d&&(f.end>d&&f.start<d+k?f.setCaret(d+b):(f.start+=b-k,f.end+=b-k),this._setSelection(f,!1,!1));d=this._model.getLineAtOffset(d);for(b=this._getLineNext();b;)k=b.lineIndex,d<=k&&k<=d+m&&(d===k&&!b.modelChangedEvent&&!b.lineRemoved?(b.modelChangedEvent=a,b.lineChanged=!0):(b.lineRemoved=!0,
b.lineChanged=!1,b.modelChangedEvent=null)),k>d+m&&(b.lineIndex=k+c-m,b._line.lineIndex=b.lineIndex),b=this._getLineNext(b);this._lineHeight&&(a=[d,m].concat(Array(c)),Array.prototype.splice.apply(this._lineHeight,a));!this._wrapMode&&(d<=this._maxLineIndex&&this._maxLineIndex<=d+m)&&(this._checkMaxLineIndex=this._maxLineIndex,this._maxLineIndex=-1,this._maxLineWidth=0);this._update()},_onModelChanging:function(a){a.type="ModelChanging";this.onModelChanging(a);a.type="Changing"},_queueUpdate:function(){if(!this._updateTimer&&
!this._ignoreQueueUpdate){var a=this;this._updateTimer=this._getWindow().setTimeout(function(){a._updateTimer=null;a._update()},0)}},_resetLineHeight:function(a,d){if(this._wrapMode||this._variableLineHeight){if(void 0!==a&&void 0!==d)for(var b=a;b<d;b++)this._lineHeight[b]=void 0;else this._lineHeight=Array(this._model.getLineCount());this._calculateLineHeightTimer()}else this._lineHeight=null},_resetLineWidth:function(){var a=this._clientDiv;if(a)for(a=a.firstChild;a;)a.lineWidth=void 0,a=a.nextSibling},
_reset:function(){this._maxLineIndex=-1;this._maxLineWidth=0;this._columnX=-1;this._bottomChild=this._topChild=null;this._topIndexY=0;this._variableLineHeight=!1;this._resetLineHeight();this._setSelection(new v(0,0,!1),!1,!1);this._viewDiv&&(this._viewDiv.scrollLeft=0,this._viewDiv.scrollTop=0);var a=this._clientDiv;if(a){for(a=a.firstChild;a;)a.lineRemoved=!0,a=a.nextSibling;13>f.isFirefox&&this._fixCaret()}},_scrollViewAnimated:function(a,d,b){var k=this._getWindow();if(b&&this._scrollAnimation){var c=
this;this._animation=new B({window:k,duration:this._scrollAnimation,curve:[d,0],onAnimate:function(a){a=d-Math.floor(a);c._scrollView(0,a);d-=a},onEnd:function(){c._animation=null;c._scrollView(a,d);b&&k.setTimeout(b,0)}});this._animation.play()}else this._scrollView(a,d),b&&k.setTimeout(b,0)},_scrollView:function(a,d){this._ensureCaretVisible=!1;var b=this._viewDiv;a&&(b.scrollLeft+=a);d&&(b.scrollTop+=d)},_setClipboardText:function(a,b){var k,c=this._getWindow(),m=c.clipboardData;!m&&b&&(m=b.clipboardData);
if(m&&(k=[],d(a,function(a){k.push(a)},function(){k.push(f.platformDelimiter)}),m.setData(f.isIE?"Text":"text/plain",k.join(""))))return!0;var e=this._parent.ownerDocument,r=f.createElement(e,"pre");r.style.position="fixed";r.style.left="-1000px";d(a,function(a){r.appendChild(e.createTextNode(a))},function(){r.appendChild(f.createElement(e,"br"))});r.appendChild(e.createTextNode(" "));this._clientDiv.appendChild(r);m=e.createRange();m.setStart(r.firstChild,0);m.setEndBefore(r.lastChild);var p=c.getSelection();
0<p.rangeCount&&p.removeAllRanges();p.addRange(m);var h=this,m=function(){r&&r.parentNode===h._clientDiv&&h._clientDiv.removeChild(r);h._updateDOMSelection()},p=!1;this._ignoreCopy=!0;try{p=e.execCommand("copy",!1,null)}catch(v){}this._ignoreCopy=!1;if(!p&&b)return c.setTimeout(m,0),!1;m();return!0},_setDOMSelection:function(a,d,b,k,c){this._setDOMFullSelection(a,d,b,k);a=a._line.getNodeOffset(d);b=b._line.getNodeOffset(k);k=this._getWindow();d=this._parent.ownerDocument;if(k.getSelection){var m=
k.getSelection();k=d.createRange();k.setStart(a.node,a.offset);k.setEnd(b.node,b.offset);if(this._hasFocus&&(m.anchorNode!==a.node||m.anchorOffset!==a.offset||m.focusNode!==b.node||m.focusOffset!==b.offset||m.anchorNode!==b.node||m.anchorOffset!==b.offset||m.focusNode!==a.node||m.focusOffset!==a.offset))this._anchorNode=a.node,this._anchorOffset=a.offset,this._focusNode=b.node,this._focusOffset=b.offset,this._ignoreSelect=!1,0<m.rangeCount&&m.removeAllRanges(),m.addRange(k),this._ignoreSelect=!0;
this._cursorDiv&&(k=d.createRange(),c?(k.setStart(a.node,a.offset),k.setEnd(a.node,a.offset)):(k.setStart(b.node,b.offset),k.setEnd(b.node,b.offset)),c=k.getClientRects()[0],a=this._cursorDiv.parentNode,b=a.getBoundingClientRect(),c&&b&&(this._cursorDiv.style.top=c.top-b.top+a.scrollTop+"px",this._cursorDiv.style.left=c.left-b.left+a.scrollLeft+"px"))}else d.selection&&this._hasFocus&&(c=d.body,k=f.createElement(d,"div"),c.appendChild(k),c.removeChild(k),k=c.createTextRange(),k.moveToElementText(a.node.parentNode),
k.moveStart("character",a.offset),c=c.createTextRange(),c.moveToElementText(b.node.parentNode),c.moveStart("character",b.offset),k.setEndPoint("EndToStart",c),this._ignoreSelect=!1,k.select(),this._ignoreSelect=!0)},_setDOMFullSelection:function(a,d,b,k){if(this._selDiv1){var c=this._selDiv1;c.style.width="0px";c.style.height="0px";c=this._selDiv2;c.style.width="0px";c.style.height="0px";c=this._selDiv3;c.style.width="0px";c.style.height="0px";if(!(a===b&&d===k)){var m=this._getViewPadding(),f=this._clientDiv.getBoundingClientRect(),
e=this._viewDiv.getBoundingClientRect(),c=e.left+m.left,r=f.right,m=e.top+m.top,p=f.bottom,e=f=0;this._clipDiv?(e=this._clipDiv.getBoundingClientRect(),f=e.left-this._clipDiv.scrollLeft):(e=this._rootDiv.getBoundingClientRect(),f=e.left);e=e.top;this._ignoreDOMSelection=!0;var h=(new u(this,a.lineIndex,a)).getBoundingClientRect(d,!1),v=h.left;d=(new u(this,b.lineIndex,b)).getBoundingClientRect(k,!1);var g=d.left;this._ignoreDOMSelection=!1;var t=this._selDiv1,v=Math.min(r,Math.max(c,v)),w=Math.min(p,
Math.max(m,h.top)),n=r;k=Math.min(p,Math.max(m,h.bottom));t.style.left=v-f+"px";t.style.top=w-e+"px";t.style.width=Math.max(0,n-v)+"px";t.style.height=Math.max(0,k-w)+"px";a.lineIndex===b.lineIndex?(n=Math.min(g,r),t.style.width=Math.max(0,n-v)+"px"):(h=Math.min(p,Math.max(m,d.top)),g=Math.min(r,Math.max(c,g)),m=Math.min(p,Math.max(m,d.bottom)),p=this._selDiv3,p.style.left=c-f+"px",p.style.top=h-e+"px",p.style.width=Math.max(0,g-c)+"px",p.style.height=Math.max(0,m-h)+"px",1<Math.abs(a.lineIndex-b.lineIndex)&&
(a=this._selDiv2,a.style.left=c-f+"px",a.style.top=k-e+"px",a.style.width=Math.max(0,r-c)+"px",a.style.height=Math.max(0,h-k)+"px"))}}},_setGrab:function(a){a!==this._grabControl&&(a?(a.setCapture&&a.setCapture(),this._grabControl=a):(this._grabControl.releaseCapture&&this._grabControl.releaseCapture(),this._grabControl=null))},_setLinksVisible:function(a){if(this._linksVisible!==a){this._linksVisible=a;f.isIE&&a&&(this._hadFocus=this._hasFocus);var d=this._clientDiv;d.contentEditable=!a;this._hadFocus&&
!a&&d.focus();this._overlayDiv&&(this._overlayDiv.style.zIndex=a?"-1":"1");for(a=this._getLineNext();a;)a._line.updateLinks(),a=this._getLineNext(a);this._updateDOMSelection()}},_setSelection:function(a,d,b,k,c){if(a){this._columnX=-1;void 0===b&&(b=!0);var m=this._selection;this._selection=a;!1!==d&&this._showCaret(!1,k,d,c);b&&this._updateDOMSelection();if(!m.equals(a))this.onSelection({type:"Selection",oldValue:{start:m.start,end:m.end},newValue:{start:a.start,end:a.end}})}},_setSelectionTo:function(a,
d,b,k){var c=this._model,m=this._getSelection();d=this.convert({x:a,y:d},"page","document");a=this._getLineIndex(d.y);if(1===this._clickCount){c=this._getLine(a);a=c.getOffset(d.x,d.y-this._getLinePixel(a));c.destroy();if(k&&!b&&m.start<=a&&a<m.end)return this._dragOffset=a,!1;m.extend(a);b||m.collapse()}else 0===(this._clickCount&1)?(c=this._getLine(a),a=c.getOffset(d.x,d.y-this._getLinePixel(a)),this._doubleClickSelection?a>=this._doubleClickSelection.start?(b=this._doubleClickSelection.start,k=
c.getNextOffset(a,{unit:"wordend",count:1})):(b=c.getNextOffset(a,{unit:"word",count:-1}),k=this._doubleClickSelection.end):(b=c.getNextOffset(a,{unit:"word",count:-1}),k=c.getNextOffset(b,{unit:"wordend",count:1})),c.destroy()):this._doubleClickSelection?(k=c.getLineAtOffset(this._doubleClickSelection.start),a>=k?(b=c.getLineStart(k),k=c.getLineEnd(a)):(b=c.getLineStart(a),k=c.getLineEnd(k))):(b=c.getLineStart(a),k=c.getLineEnd(a)),m.setCaret(b),m.extend(k);this._setSelection(m,!0,!0);return!0},
_setFullSelection:function(a,d){this._fullSelection=a;f.isWebkit&&(this._fullSelection=!0);var b=this._clipDiv||this._rootDiv;if(b)if(this._fullSelection){if(!this._selDiv1&&this._fullSelection&&!f.isIOS){var k=b.ownerDocument;this._highlightRGB=f.isWebkit?"transparent":"Highlight";var c=f.createElement(k,"div");this._selDiv1=c;c.style.position="absolute";c.style.borderWidth="0px";c.style.margin="0px";c.style.padding="0px";c.style.outline="none";c.style.background=this._highlightRGB;c.style.width=
"0px";c.style.height="0px";c.style.zIndex="0";b.appendChild(c);var m=f.createElement(k,"div");this._selDiv2=m;m.style.position="absolute";m.style.borderWidth="0px";m.style.margin="0px";m.style.padding="0px";m.style.outline="none";m.style.background=this._highlightRGB;m.style.width="0px";m.style.height="0px";m.style.zIndex="0";b.appendChild(m);this._selDiv3=k=f.createElement(k,"div");k.style.position="absolute";k.style.borderWidth="0px";k.style.margin="0px";k.style.padding="0px";k.style.outline="none";
k.style.background=this._highlightRGB;k.style.width="0px";k.style.height="0px";k.style.zIndex="0";b.appendChild(k);if(f.isFirefox&&f.isMac){b=this._getWindow().getComputedStyle(k,null).getPropertyValue("background-color");switch(b){case "rgb(119, 141, 168)":b="rgb(199, 208, 218)";break;case "rgb(127, 127, 127)":b="rgb(198, 198, 198)";break;case "rgb(255, 193, 31)":b="rgb(250, 236, 115)";break;case "rgb(243, 70, 72)":b="rgb(255, 176, 139)";break;case "rgb(255, 138, 34)":b="rgb(255, 209, 129)";break;
case "rgb(102, 197, 71)":b="rgb(194, 249, 144)";break;case "rgb(140, 78, 184)":b="rgb(232, 184, 255)";break;default:b="rgb(180, 213, 255)"}this._highlightRGB=b;c.style.background=b;m.style.background=b;k.style.background=b}d||this._updateDOMSelection()}}else this._selDiv1&&(b.removeChild(this._selDiv1),this._selDiv1=null),this._selDiv2&&(b.removeChild(this._selDiv2),this._selDiv2=null),this._selDiv3&&(b.removeChild(this._selDiv3),this._selDiv3=null)},_setBlockCursor:function(a){this._blockCursorVisible=
a;this._updateBlockCursorVisible()},_setOverwriteMode:function(a){this._overwriteMode=a;this._updateBlockCursorVisible()},_updateBlockCursorVisible:function(){if(this._blockCursorVisible||this._overwriteMode){if(!this._cursorDiv){var a=this._viewDiv,d=f.createElement(a.ownerDocument,"div");d.className="textviewBlockCursor";this._cursorDiv=d;d.tabIndex=-1;d.style.zIndex="2";d.style.color="transparent";d.style.position="absolute";d.style.pointerEvents="none";d.innerHTML="\x26nbsp;";a.appendChild(d);
this._updateDOMSelection()}}else this._cursorDiv&&(this._cursorDiv.parentNode.removeChild(this._cursorDiv),this._cursorDiv=null)},_setMarginOffset:function(a,d){this._marginOffset=a;this._marginDiv.style.display=a?"block":"none";d||(this._metrics=this._calculateMetrics(),this._queueUpdate())},_setWrapOffset:function(a,d){this._wrapOffset=a;d||(this._metrics=this._calculateMetrics(),this._queueUpdate())},_setReadOnly:function(a){this._readonly=a;this._clientDiv.setAttribute("aria-readonly",a?"true":
"false")},_setSingleMode:function(a,d){this._singleMode=a;this._updateOverflow();this._updateStyle(d)},_setTabSize:function(a,d){this._tabSize=a;this._customTabSize=void 0;var b=this._clientDiv;f.isOpera?b&&(b.style.OTabSize=this._tabSize+""):537.1<=f.isWebkit?b&&(b.style.tabSize=this._tabSize+""):4<=f.isFirefox?b&&(b.style.MozTabSize=this._tabSize+""):8!==this._tabSize&&(this._customTabSize=this._tabSize);d||(this.redrawLines(),this._resetLineWidth())},_setTheme:function(a){this._theme&&this._theme.removeEventListener("ThemeChanged",
this._themeListener.onChanged);(this._theme=a)&&this._theme.addEventListener("ThemeChanged",this._themeListener.onChanged);this._setThemeClass(this._themeClass)},_setThemeClass:function(a,d){this._themeClass=a;var b="textview",k=this._theme.getThemeClass();k&&(b+=" "+k);this._themeClass&&k!==this._themeClass&&(b+=" "+this._themeClass);this._rootDiv.className=b;this._updateStyle(d)},_setWrapMode:function(a,d){this._wrapMode=a&&this._wrappable;var b=this._clientDiv;this._wrapMode?(b.style.whiteSpace=
"pre-wrap",b.style.wordWrap="break-word"):(b.style.whiteSpace="pre",b.style.wordWrap="normal");this._updateOverflow();d||(this.redraw(),this._resetLineWidth());this._resetLineHeight()},_showCaret:function(a,d,b,k){if(this._clientDiv){var c=this._model,m=this._getSelection(),f=this._getScroll(),e=m.getCaret(),r=m.start,p=m.end,h=c.getLineAtOffset(p),v=Math.max(Math.max(r,c.getLineStart(h)),p-1),c=this._getClientWidth(),h=this._getClientHeight(),g=c/4,t=this._getBoundsAtOffset(e===r?r:v),u=t.left,w=
t.right,n=t.top,y=t.bottom;a&&!m.isEmpty()&&(t=this._getBoundsAtOffset(e===p?r:v),t.top===n?e===r?w=u+Math.min(t.right-u,c):u=w-Math.min(w-t.left,c):e===r?y=n+Math.min(t.bottom-n,h):n=y-Math.min(y-t.top,h));a=0;u<f.x&&(a=Math.min(u-f.x,-g));w>f.x+c&&(a=Math.max(w-f.x-c,g));m=0;n<f.y?m=n-f.y:y>f.y+h&&(m=y-f.y-h);k&&(0<k?0<m&&(m=Math.max(m,k)):0>m&&(m=Math.min(m,k)));if(0!==a||0!==m)return 0!==m&&"number"===typeof b&&(0>b&&(b=0),1<b&&(b=1),m+=Math.floor(0<m?b*h:-b*h)),this._scrollViewAnimated(a,m,d),
h!==this._getClientHeight()||c!==this._getClientWidth()?this._showCaret():this._ensureCaretVisible=!0,!0;d&&d();return!1}},_startIME:function(){if(-1===this._imeOffset){var a=this._getSelection();a.isEmpty()||this._modifyContent({text:"",start:a.start,end:a.end},!0);this._imeOffset=a.start}},_unhookEvents:function(){this._model.removeEventListener("preChanging",this._modelListener.onChanging);this._model.removeEventListener("postChanged",this._modelListener.onChanged);this._theme.removeEventListener("ThemeChanged",
this._themeListener.onChanged);this._modelListener=null;for(var a=0;a<this._handlers.length;a++){var d=this._handlers[a];w(d.target,d.type,d.handler)}this._handlers=null;this._mutationObserver&&(this._mutationObserver.disconnect(),this._mutationObserver=null)},_updateDOMSelection:function(){if(!(0<this._redrawCount)&&!this._ignoreDOMSelection&&this._clientDiv){var a=this._getSelection(),d=this._model,b=d.getLineAtOffset(a.start),k=d.getLineAtOffset(a.end),c=this._getLineNext();if(c){var m=this._getLinePrevious(),
f;b<c.lineIndex?(b=c,f=d.getLineStart(c.lineIndex)):b>m.lineIndex?(b=m,f=d.getLineStart(m.lineIndex)):(b=this._getLineNode(b),f=a.start);k<c.lineIndex?(k=c,d=d.getLineStart(c.lineIndex)):k>m.lineIndex?(k=m,d=d.getLineStart(m.lineIndex)):(k=this._getLineNode(k),d=a.end);this._setDOMSelection(b,f,k,d,a.caret)}}},_update:function(a){if(!(0<this._redrawCount)){this._updateTimer&&(this._getWindow().clearTimeout(this._updateTimer),this._updateTimer=null,a=!1);var d=this._clientDiv,b=this._viewDiv;if(d){this._metrics.invalid&&
(this._ignoreQueueUpdate=!0,this._updateStyle(),this._ignoreQueueUpdate=!1);var k=this._model,c=this._getScroll(!1),m=this._getViewPadding(),e=k.getLineCount(),r=this._getLineHeight(),p=!1,h=!1,v=!1,g=this._metrics.scrollWidth;this._wrapMode&&(d.style.width=(this._metrics.wrapWidth||this._getClientWidth())+"px");var t,w,n,y,s=0,B=0,q;if(this._lineHeight){for(;B<e;){q=this._getLineHeight(B);if(s+q>c.y)break;s+=q;B++}t=B;w=Math.max(0,t-1);n=k=c.y-s;0<t&&(k+=this._getLineHeight(t-1))}else y=Math.max(0,
c.y)/r,t=Math.floor(y),w=Math.max(0,t-1),k=Math.round((y-w)*r),n=Math.round((y-t)*r);this._topIndexY=n;y=this._rootDiv;var A=y.clientWidth,J=y.clientHeight;if(a){r=0;this._leftDiv&&(t=this._leftDiv.getBoundingClientRect(),r=t.right-t.left);t=this._getClientWidth();y=this._getClientHeight();h=t;this._wrapMode?this._metrics.wrapWidth&&(h=this._metrics.wrapWidth):h=Math.max(this._maxLineWidth,h);for(;B<e;)q=this._getLineHeight(B,!1),s+=q,B++;e=s}else{y=this._getClientHeight();n=Math.min(t+Math.floor((y+
n)/r),e-1);var c=Math.min(n+1,e-1),D;for(q=d.firstChild;q;){D=q.lineIndex;var E=q.nextSibling;if(!(w<=D&&D<=c)||q.lineRemoved||-1===q.lineIndex)this._mouseWheelLine===q?(q.style.display="none",q.lineIndex=-1):d.removeChild(q);q=E}q=this._getLineNext();var E=b.ownerDocument,I=E.createDocumentFragment();for(D=w;D<=c;D++)!q||q.lineIndex>D?(new u(this,D)).create(I,null):(I.firstChild&&(d.insertBefore(I,q),I=E.createDocumentFragment()),q&&q.lineChanged&&(q=(new u(this,D)).create(I,q),q.lineChanged=!1),
q=this._getLineNext(q));I.firstChild&&d.insertBefore(I,q);f.isWebkit&&!this._wrapMode&&(d.style.width="0x7fffffffpx");q=this._getLineNext();D=y+k;for(I=!1;q;)w=q.lineWidth,void 0===w&&(E=q._line.getBoundingClientRect(),w=q.lineWidth=Math.ceil(E.right-E.left),E=E.bottom-E.top,this._lineHeight?this._lineHeight[q.lineIndex]=E:0!==r&&(0!==E&&Math.ceil(r)!==Math.ceil(E))&&(this._variableLineHeight=!0,this._lineHeight=[],this._lineHeight[q.lineIndex]=E)),this._lineHeight&&!I&&(D-=this._lineHeight[q.lineIndex],
0>D&&(n=q.lineIndex,I=!0)),this._wrapMode||(w>=this._maxLineWidth&&(this._maxLineWidth=w,this._maxLineIndex=q.lineIndex),this._checkMaxLineIndex===q.lineIndex&&(this._checkMaxLineIndex=-1)),q.lineIndex===t&&(this._topChild=q),q.lineIndex===n&&(this._bottomChild=q),q=this._getLineNext(q);-1!==this._checkMaxLineIndex&&(D=this._checkMaxLineIndex,this._checkMaxLineIndex=-1,0<=D&&D<e&&(r=new u(this,D),E=r.getBoundingClientRect(),w=E.right-E.left,w>=this._maxLineWidth&&(this._maxLineWidth=w,this._maxLineIndex=
D),r.destroy()));for(;B<e;)q=this._getLineHeight(B,B<=n),s+=q,B++;e=s;this._updateRuler(this._leftDiv,t,c,J);this._updateRuler(this._rightDiv,t,c,J);this._updateRuler(this._marginDiv,t,c,J);r=0;this._leftDiv&&(t=this._leftDiv.getBoundingClientRect(),r=t.right-t.left);c=0;this._rightDiv&&(c=this._rightDiv.getBoundingClientRect(),c=c.right-c.left);b.style.left=r+"px";b.style.right=c+"px";c=this._scrollDiv;c.style.height=e+"px";t=this._getClientWidth();!this._singleMode&&!this._wrapMode&&(s=p=y,(B="scroll"===
b.style.overflowX)?p+=g:s-=g,q=n=t,(w="scroll"===b.style.overflowY)?n+=g:q-=g,y=p,t=n,e>y&&(v=!0,t=q),this._maxLineWidth>t&&(h=!0,y=s,e>y&&(v=!0,t=q)),B!==h&&(b.style.overflowX=h?"scroll":"hidden"),w!==v&&(b.style.overflowY=v?"scroll":"hidden"),p=B!==h||w!==v);v=t;this._wrapMode?this._metrics.wrapWidth&&(v=this._metrics.wrapWidth):v=Math.max(this._maxLineWidth,v);h=v;if((!f.isIE||9<=f.isIE)&&this._maxLineWidth>t)v+=m.right+m.left;c.style.width=v+"px";this._clipScrollDiv&&(this._clipScrollDiv.style.width=
v+"px");c=this._getScroll(!1)}this._vScrollDiv&&(v=y-8,s=Math.max(15,Math.ceil(Math.min(1,v/(e+m.top+m.bottom))*v)),this._vScrollDiv.style.left=r+t-8+"px",this._vScrollDiv.style.top=Math.floor(Math.max(0,c.y*v/e))+"px",this._vScrollDiv.style.height=s+"px");!this._wrapMode&&this._hScrollDiv&&(v=t-8,s=Math.max(15,Math.ceil(Math.min(1,v/(this._maxLineWidth+m.left+m.right))*v)),this._hScrollDiv.style.left=r+Math.floor(Math.max(0,Math.floor(c.x*v/this._maxLineWidth)))+"px",this._hScrollDiv.style.top=y-
9+"px",this._hScrollDiv.style.width=s+"px");B=c.x;s=this._clipDiv;v=this._overlayDiv;if(n=this._marginDiv)n.style.left=-B+r+this._metrics.marginWidth+m.left+"px",n.style.bottom=("scroll"===b.style.overflowX?g:0)+"px";s?(s.scrollLeft=B,s.scrollTop=0,b=r+m.left,g=m.top,a=t,r=y,B=0,n=-k,0===c.x&&(b-=m.left,a+=m.left,B=m.left),c.x+t===h&&(a+=m.right),0===c.y&&(g-=m.top,r+=m.top,n+=m.top),c.y+y===e&&(r+=m.bottom),s.style.left=b+"px",s.style.top=g+"px",s.style.right=A-a-b+"px",s.style.bottom=J-r-g+"px",
d.style.left=B+"px",d.style.top=n+"px",d.style.width=h+"px",d.style.height=y+k+"px",v&&(v.style.left=d.style.left,v.style.top=d.style.top,v.style.width=d.style.width,v.style.height=d.style.height)):(b=B,g=k,A=B+t,J=k+y,0===b&&(b-=m.left),0===g&&(g-=m.top),A===h&&(A+=m.right),c.y+y===e&&(J+=m.bottom),d.style.clip="rect("+g+"px,"+A+"px,"+J+"px,"+b+"px)",d.style.left=-B+r+m.left+"px",d.style.width=(this._wrapMode||f.isWebkit?h:t+B)+"px",a||(d.style.top=-k+m.top+"px",d.style.height=y+k+"px"),v&&(v.style.clip=
d.style.clip,v.style.left=d.style.left,v.style.width=d.style.width,a||(v.style.top=d.style.top,v.style.height=d.style.height)));this._updateDOMSelection();p&&(d=this._ensureCaretVisible,this._ensureCaretVisible=!1,d&&this._showCaret(),this._queueUpdate())}}},_updateOverflow:function(){var a=this._viewDiv;this._wrapMode?(a.style.overflowX="hidden",a.style.overflowY="scroll"):a.style.overflow="hidden"},_updateRuler:function(a,d,b,k){if(a){var c=this._parent.ownerDocument,m=this._getLineHeight(),e=this._getViewPadding();
for(a=a.firstChild;a;){var r=a._ruler,h=m,v=r.getOverview();"page"===v&&(h+=this._topIndexY);a.style.top=-h+"px";a.style.height=k+h+"px";a.rulerChanged&&p(r.getRulerStyle(),a);var g,t=a.firstChild;t?(g=t,t=t.nextSibling):(g=f.createElement(c,"div"),g.style.visibility="hidden",a.appendChild(g));var w;if(a.rulerChanged&&g){h=-1;if(w=r.getWidestAnnotation())p(w.style,g),w.html&&(g.innerHTML=w.html);g.lineIndex=h;g.style.height=m+e.top+"px"}var u;if("page"===v){for(r=r.getAnnotations(d,b+1);t;)h=t.lineIndex,
w=t.nextSibling,(!(d<=h&&h<=b)||t.lineChanged)&&a.removeChild(t),t=w;t=a.firstChild.nextSibling;u=c.createDocumentFragment();for(h=d;h<=b;h++)if(!t||t.lineIndex>h){g=f.createElement(c,"div");if(w=r[h])p(w.style,g),w.html&&(g.innerHTML=w.html),g.annotation=w;g.lineIndex=h;g.style.height=this._getLineHeight(h)+"px";u.appendChild(g)}else u.firstChild&&(a.insertBefore(u,t),u=c.createDocumentFragment()),t&&(t=t.nextSibling);u.firstChild&&a.insertBefore(u,t)}else{w=this._getClientHeight();h=this._model.getLineCount();
t=w+e.top+e.bottom-2*this._metrics.scrollWidth;v=m*h<t?m:t/h;if(a.rulerChanged){for(w=a.childNodes.length;1<w;)a.removeChild(a.lastChild),w--;r=r.getAnnotations(0,h);u=c.createDocumentFragment();for(var n in r)h=n>>>0,0>h||(g=f.createElement(c,"div"),w=r[n],p(w.style,g),g.style.position="absolute",g.style.top=this._metrics.scrollWidth+m+Math.floor(h*v)+"px",w.html&&(g.innerHTML=w.html),g.annotation=w,g.lineIndex=h,u.appendChild(g));a.appendChild(u)}else if(a._oldTrackHeight!==t)for(g=a.firstChild?
a.firstChild.nextSibling:null;g;)g.style.top=this._metrics.scrollWidth+m+Math.floor(g.lineIndex*v)+"px",g=g.nextSibling;a._oldTrackHeight=t}a.rulerChanged=!1;a=a.nextSibling}}},_updateStyleSheet:function(){var a="";f.isWebkit&&0<this._metrics.scrollWidth&&(a+="\n.textview ::-webkit-scrollbar-corner {background: #eeeeee;}");f.isFirefox&&(f.isMac&&this._highlightRGB&&"Highlight"!==this._highlightRGB)&&(a+="\n.textview ::-moz-selection {background: "+this._highlightRGB+";}");if(a){var d=this._clientDiv.ownerDocument,
b=d.getElementById("_textviewStyle");if(b)b.removeChild(b.firstChild),b.appendChild(d.createTextNode(a));else{b=f.createElement(d,"style");b.id="_textviewStyle";var k=d.getElementsByTagName("head")[0]||d.documentElement;b.appendChild(d.createTextNode(a));k.insertBefore(b,k.firstChild)}}},_updateStyle:function(a){!a&&f.isIE&&(this._rootDiv.style.lineHeight="normal");var d=this._metrics=this._calculateMetrics();this._rootDiv.style.lineHeight=f.isIE?d.lineHeight-(d.lineTrim.top+d.lineTrim.bottom)+"px":
"normal";this._updateStyleSheet();a||(this.redraw(),this._resetLineWidth())}};g.EventTarget.addMixin(y.prototype);return{TextView:y}});
define("orion/editor/projectionTextModel",["orion/editor/textModel","orion/editor/eventTarget"],function(n,q){function s(g){this._model=g;this._projections=[];var c=this;this._listener={onChanged:function(e){c._onChanged(e)},onChanging:function(e){c._onChanging(e)}};g.addEventListener("postChanged",this._listener.onChanged);g.addEventListener("preChanging",this._listener.onChanging)}s.prototype={destroy:function(){this._model&&(this._model.removeEventListener("postChanged",this._listener.onChanged),
this._model.removeEventListener("preChanging",this._listener.onChanging),this._model=null)},addProjection:function(g){if(g){var c=this._model,e=this._projections;g._lineIndex=c.getLineAtOffset(g.start);g._lineCount=c.getLineAtOffset(g.end)-g._lineIndex;var f=g.text;f||(f="");g._model="string"===typeof f?new n.TextModel(f,c.getLineDelimiter()):f;var c=this.mapOffset(g.start,!0),f=g.end-g.start,p=g._lineCount,h=g._model.getCharCount(),b=g._model.getLineCount()-1,a={type:"Changing",text:g._model.getText(),
start:c,removedCharCount:f,addedCharCount:h,removedLineCount:p,addedLineCount:b};this.onChanging(a);a=this._binarySearch(e,g.start);e.splice(a,0,g);this.onChanged({type:"Changed",start:c,removedCharCount:f,addedCharCount:h,removedLineCount:p,addedLineCount:b})}},getProjections:function(){return this._projections.slice(0)},getBaseModel:function(){return this._model},mapOffset:function(g,c){var e=this._projections,f=0,p,h;if(c){for(p=0;p<e.length;p++){h=e[p];if(h.start>g)break;if(h.end>g)return-1;f+=
h._model.getCharCount()-(h.end-h.start)}return g+f}for(p=0;p<e.length;p++){h=e[p];if(h.start>g-f)break;var b=h._model.getCharCount();if(h.start+b>g-f)return-1;f+=b-(h.end-h.start)}return g-f},removeProjection:function(g){var c,e=0;for(c=0;c<this._projections.length;c++){var f=this._projections[c];if(f===g){g=f;break}e+=f._model.getCharCount()-(f.end-f.start)}if(c<this._projections.length){var f=this._model,e=g.start+e,p=g.end-g.start,h=g._lineCount,b=g._model.getCharCount(),a=g._model.getLineCount()-
1;g={type:"Changing",text:f.getText(g.start,g.end),start:e,removedCharCount:b,addedCharCount:p,removedLineCount:a,addedLineCount:h};this.onChanging(g);this._projections.splice(c,1);this.onChanged({type:"Changed",start:e,removedCharCount:b,addedCharCount:p,removedLineCount:a,addedLineCount:h})}},_binarySearch:function(g,c){for(var e=g.length,f=-1,p;1<e-f;)p=Math.floor((e+f)/2),c<=g[p].start?e=p:f=p;return e},getCharCount:function(){for(var g=this._model.getCharCount(),c=this._projections,e=0;e<c.length;e++)var f=
c[e],g=g+(f._model.getCharCount()-(f.end-f.start));return g},getLine:function(g,c){if(0>g)return null;var e=this._model,f=this._projections,p=0,h=[],b=0,a,d,k;for(a=0;a<f.length;a++){k=f[a];if(k._lineIndex>=g-p)break;d=k._model.getLineCount()-1;if(k._lineIndex+d>=g-p){b=g-(k._lineIndex+p);if(b<d)return k._model.getLine(b,c);h.push(k._model.getLine(d))}b=k.end;p+=d-k._lineCount}for(b=Math.max(b,e.getLineStart(g-p));a<f.length;a++){k=f[a];if(k._lineIndex>g-p)break;h.push(e.getText(b,k.start));d=k._model.getLineCount()-
1;if(k._lineIndex+d>g-p)return h.push(k._model.getLine(0,c)),h.join("");h.push(k._model.getText());b=k.end;p+=d-k._lineCount}f=e.getLineEnd(g-p,c);b<f&&h.push(e.getText(b,f));return h.join("")},getLineAtOffset:function(g){for(var c=this._model,e=this._projections,f=0,p=0,h=0;h<e.length;h++){var b=e[h];if(b.start>g-f)break;var a=b._model.getCharCount();if(b.start+a>g-f){e=g-(b.start+f);p+=b._model.getLineAtOffset(e);f+=e;break}p+=b._model.getLineCount()-1-b._lineCount;f+=a-(b.end-b.start)}return c.getLineAtOffset(g-
f)+p},getLineCount:function(){for(var g=this._projections,c=this._model.getLineCount(),e=0;e<g.length;e++)var f=g[e],c=c+(f._model.getLineCount()-1-f._lineCount);return c},getLineDelimiter:function(){return this._model.getLineDelimiter()},getLineEnd:function(g,c){if(0>g)return-1;for(var e=this._model,f=this._projections,p=0,h=0,b=0;b<f.length;b++){var a=f[b];if(a._lineIndex>g-p)break;var d=a._model.getLineCount()-1;if(a._lineIndex+d>g-p)return a._model.getLineEnd(g-(a._lineIndex+p),c)+a.start+h;h+=
a._model.getCharCount()-(a.end-a.start);p+=d-a._lineCount}return e.getLineEnd(g-p,c)+h},getLineStart:function(g){if(0>g)return-1;for(var c=this._model,e=this._projections,f=0,p=0,h=0;h<e.length;h++){var b=e[h];if(b._lineIndex>=g-f)break;var a=b._model.getLineCount()-1;if(b._lineIndex+a>=g-f)return b._model.getLineStart(g-(b._lineIndex+f))+b.start+p;p+=b._model.getCharCount()-(b.end-b.start);f+=a-b._lineCount}return c.getLineStart(g-f)+p},getText:function(g,c){void 0===g&&(g=0);var e=this._model,f=
this._projections,p=0,h=[],b,a,d;for(b=0;b<f.length;b++){a=f[b];if(a.start>g-p)break;d=a._model.getCharCount();if(a.start+d>g-p){if(void 0!==c&&a.start+d>c-p)return a._model.getText(g-(a.start+p),c-(a.start+p));h.push(a._model.getText(g-(a.start+p)));g=a.end+p+d-(a.end-a.start)}p+=d-(a.end-a.start)}var k=g-p;if(void 0!==c){for(;b<f.length;b++){a=f[b];if(a.start>c-p)break;h.push(e.getText(k,a.start));d=a._model.getCharCount();if(a.start+d>c-p)return h.push(a._model.getText(0,c-(a.start+p))),h.join("");
h.push(a._model.getText());k=a.end;p+=d-(a.end-a.start)}h.push(e.getText(k,c-p))}else{for(;b<f.length;b++)a=f[b],h.push(e.getText(k,a.start)),h.push(a._model.getText()),k=a.end;h.push(e.getText(k))}return h.join("")},_onChanged:function(g){g=this._change;var c=g.baseStart,e=g.baseEnd,f,p,h=this._projections;for(f=0;f<h.length&&!(p=h[f],p.end>c);f++);var b=f;for(f=0;f<h.length&&!(p=h[f],p.start>=e);f++);var a=f,d=this._model,c=g.baseText.length-(e-c);for(f=a;f<h.length;f++)p=h[f],p.start+=c,p.end+=
c,p._lineIndex=d.getLineAtOffset(p.start);p=h.splice(b,a-b);for(f=0;f<p.length;f++)p[f].annotation&&p[f].annotation._expand();this.onChanged({type:"Changed",start:g.start,removedCharCount:g.removedCharCount,addedCharCount:g.addedCharCount,removedLineCount:g.removedLineCount,addedLineCount:g.addedLineCount});this._change=void 0},_onChanging:function(g){var c=!!this._change,e=this._change||{},f=g.start,p=f+g.removedCharCount;e.baseStart=f;e.baseEnd=p;e.baseText=g.text;e.addedLineCount=g.addedLineCount;
if(!c){this._change=e;e.text=g.text;var h=this._projections,b,a,d;g=function(k){for(b=a=0;a<h.length;a++){d=h[a];if(d.start>k)break;if(d.end>k)return-1;b+=d._model.getCharCount()-(d.end-d.start)}return k+b};e.start=g(f);-1===e.start&&(e.text=this._model.getText(d.start,f)+e.text,e.addedLineCount+=this._model.getLineAtOffset(f)-this._model.getLineAtOffset(d.start),e.start=d.start+b);e.end=g(p);-1===e.end&&(e.text+=this._model.getText(p,d.end),e.addedLineCount+=this._model.getLineAtOffset(d.end)-this._model.getLineAtOffset(p),
e.end=d.start+b)}e.addedCharCount=e.text.length;e.removedCharCount=e.end-e.start;e.removedLineCount=this.getLineAtOffset(e.end)-this.getLineAtOffset(e.start);this.onChanging({type:"Changing",text:e.text,start:e.start,removedCharCount:e.removedCharCount,addedCharCount:e.addedCharCount,removedLineCount:e.removedLineCount,addedLineCount:e.addedLineCount})},onChanging:function(g){return this.dispatchEvent(g)},onChanged:function(g){return this.dispatchEvent(g)},setLineDelimiter:function(g){this._model.setLineDelimiter(g)},
setText:function(g,c,e){function f(d){for(h=b=0;b<p.length;b++){a=p[b];if(a.start>d-h)break;var k=a._model.getCharCount();if(a.start+k>d-h)return-1;h+=k-(a.end-a.start)}return d-h}this._change={text:g||"",start:c||0,end:void 0===e?this.getCharCount():e};var p=this._projections,h,b,a,d,k;g=f(this._change.start);-1===g&&(d={projection:a,start:this._change.start-(a.start+h)},g=a.end);c=f(this._change.end);-1===c&&(k={projection:a,end:this._change.end-(a.start+h)},c=a.start);d&&k&&d.projection===k.projection?
a._model.setText(this._change.text,d.start,k.end):(this._model.setText(this._change.text,g,c),d&&(a=d.projection,a._model.setText("",d.start)),k&&(a=k.projection,a._model.setText("",0,k.end),a.start=a.end,a._lineCount=0));this._change=void 0}};q.EventTarget.addMixin(s.prototype);return{ProjectionTextModel:s}});
define("orion/editor/annotations",["i18n!orion/editor/nls/messages","orion/editor/eventTarget"],function(n,q){function s(a,d,b){this.start=a;this.end=d;this._projectionModel=b;this.html=this._expandedHTML;this.style=this._expandedStyle;this.expanded=!0}function g(){}function c(a,d){var b=a.lastIndexOf("."),b=a.substring(b+1),c={title:n[b],style:{styleClass:"annotation "+b},html:"\x3cdiv class\x3d'annotationHTML "+b+"'\x3e\x3c/div\x3e",overviewStyle:{styleClass:"annotationOverview "+b}};d?c.lineStyle=
{styleClass:"annotationLine "+b}:c.rangeStyle={styleClass:"annotationRange "+b};g.registerType(a,c)}function e(){}function f(a,d){for(var b=a.length,c=-1,m;1<b-c;)m=Math.floor((b+c)/2),d<=a[m].start?b=m:c=m;return b}function p(a){this._annotations=[];var d=this;this._listener={onChanged:function(a){d._onChanged(a)}};this.setTextModel(a)}function h(a,d){this._view=a;this._annotationModel=d;var b=this;this._listener={onDestroy:function(a){b._onDestroy(a)},onLineStyle:function(a){b._onLineStyle(a)},
onChanged:function(a){b._onAnnotationModelChanged(a)}};a.addEventListener("Destroy",this._listener.onDestroy);a.addEventListener("postLineStyle",this._listener.onLineStyle);d.addEventListener("Changed",this._listener.onChanged)}s.prototype={_expandedHTML:"\x3cdiv class\x3d'annotationHTML expanded'\x3e\x3c/div\x3e",_expandedStyle:{styleClass:"annotation expanded"},_collapsedHTML:"\x3cdiv class\x3d'annotationHTML collapsed'\x3e\x3c/div\x3e",_collapsedStyle:{styleClass:"annotation collapsed"},_collapse:function(){if(!this.expanded)return!1;
this.expanded=!1;this.html=this._collapsedHTML;this.style=this._collapsedStyle;this._annotationModel&&this._annotationModel.modifyAnnotation(this);return!0},_expand:function(){if(this.expanded)return!1;this.expanded=!0;this.html=this._expandedHTML;this.style=this._expandedStyle;this._annotationModel&&this._annotationModel.modifyAnnotation(this);return!0},collapse:function(){if(this._collapse()){var a=this._projectionModel,d=a.getBaseModel();this._projection={annotation:this,start:d.getLineStart(d.getLineAtOffset(this.start)+
1),end:d.getLineEnd(d.getLineAtOffset(this.end),!0)};a.addProjection(this._projection)}},expand:function(){this._expand()&&this._projectionModel.removeProjection(this._projection)}};g.ANNOTATION_ERROR="orion.annotation.error";g.ANNOTATION_WARNING="orion.annotation.warning";g.ANNOTATION_TASK="orion.annotation.task";g.ANNOTATION_BREAKPOINT="orion.annotation.breakpoint";g.ANNOTATION_BOOKMARK="orion.annotation.bookmark";g.ANNOTATION_FOLDING="orion.annotation.folding";g.ANNOTATION_CURRENT_BRACKET="orion.annotation.currentBracket";
g.ANNOTATION_MATCHING_BRACKET="orion.annotation.matchingBracket";g.ANNOTATION_CURRENT_LINE="orion.annotation.currentLine";g.ANNOTATION_CURRENT_SEARCH="orion.annotation.currentSearch";g.ANNOTATION_MATCHING_SEARCH="orion.annotation.matchingSearch";g.ANNOTATION_READ_OCCURRENCE="orion.annotation.readOccurrence";g.ANNOTATION_WRITE_OCCURRENCE="orion.annotation.writeOccurrence";g.ANNOTATION_SELECTED_LINKED_GROUP="orion.annotation.selectedLinkedGroup";g.ANNOTATION_CURRENT_LINKED_GROUP="orion.annotation.currentLinkedGroup";
g.ANNOTATION_LINKED_GROUP="orion.annotation.linkedGroup";g.ANNOTATION_BLAME="orion.annotation.blame";g.ANNOTATION_CURRENT_BLAME="orion.annotation.currentBlame";var b={};g.registerType=function(a,d){var k=d;"function"!==typeof k&&(k=function(a,d,b){this.start=a;this.end=d;void 0!==b&&(this.title=b)},k.prototype=d);k.prototype.type=a;b[a]=k;return a};g.createAnnotation=function(a,d,b,c){return new (this.getType(a))(d,b,c)};g.getType=function(a){return b[a]};c(g.ANNOTATION_ERROR);c(g.ANNOTATION_WARNING);
c(g.ANNOTATION_TASK);c(g.ANNOTATION_BREAKPOINT);c(g.ANNOTATION_BOOKMARK);c(g.ANNOTATION_CURRENT_BRACKET);c(g.ANNOTATION_MATCHING_BRACKET);c(g.ANNOTATION_CURRENT_SEARCH);c(g.ANNOTATION_MATCHING_SEARCH);c(g.ANNOTATION_READ_OCCURRENCE);c(g.ANNOTATION_WRITE_OCCURRENCE);c(g.ANNOTATION_SELECTED_LINKED_GROUP);c(g.ANNOTATION_CURRENT_LINKED_GROUP);c(g.ANNOTATION_LINKED_GROUP);c(g.ANNOTATION_CURRENT_LINE,!0);c(g.ANNOTATION_BLAME,!0);c(g.ANNOTATION_CURRENT_BLAME,!0);g.registerType(g.ANNOTATION_FOLDING,s);e.addMixin=
function(a){var d=e.prototype,b;for(b in d)d.hasOwnProperty(b)&&(a[b]=d[b])};e.prototype={addAnnotationType:function(a){this._annotationTypes||(this._annotationTypes=[]);this._annotationTypes.push(a)},getAnnotationTypePriority:function(a){if(this._annotationTypes)for(var d=0;d<this._annotationTypes.length;d++)if(this._annotationTypes[d]===a)return d+1;return 0},getAnnotationsByType:function(a,d,b){a=a.getAnnotations(d,b);for(b=[];a.hasNext();)d=a.next(),0!==this.getAnnotationTypePriority(d.type)&&
b.push(d);var c=this;b.sort(function(a,d){return c.getAnnotationTypePriority(a.type)-c.getAnnotationTypePriority(d.type)});return b},isAnnotationTypeVisible:function(a){return 0!==this.getAnnotationTypePriority(a)},removeAnnotationType:function(a){if(this._annotationTypes)for(var d=0;d<this._annotationTypes.length;d++)if(this._annotationTypes[d]===a){this._annotationTypes.splice(d,1);break}}};p.prototype={addAnnotation:function(a){if(a){var d=this._annotations,b=f(d,a.start);d.splice(b,0,a);a._annotationModel=
this;this.onChanged({type:"Changed",added:[a],removed:[],changed:[]})}},getTextModel:function(){return this._model},getAnnotations:function(a,d){var b=this._annotations,c,m=0,f;f=void 0===a&&void 0===d?function(){return m<b.length?b[m++]:null}:function(){for(;m<b.length;){var c=b[m++];if(a===c.start||(a>c.start?a<c.end:c.start<d))return c;if(c.start>=d)break}return null};c=f();return{next:function(){var a=c;a&&(c=f());return a},hasNext:function(){return null!==c}}},modifyAnnotation:function(a){if(a&&
!(0>this._getAnnotationIndex(a)))this.onChanged({type:"Changed",added:[],removed:[],changed:[a]})},onChanged:function(a){return this.dispatchEvent(a)},removeAnnotations:function(a){var d=this._annotations,b,c;if(a){b=[];for(c=d.length-1;0<=c;c--){var m=d[c];m.type===a&&(d.splice(c,1),b.splice(0,0,m),m._annotationModel=null)}}else b=d;this.onChanged({type:"Changed",removed:b,added:[],changed:[]})},removeAnnotation:function(a){if(a){var d=this._getAnnotationIndex(a);0>d||(a._annotationModel=null,a=
{type:"Changed",removed:this._annotations.splice(d,1),added:[],changed:[]},this.onChanged(a))}},replaceAnnotations:function(a,d){var b=this._annotations,c,m,e,h=[];if(a)for(c=a.length-1;0<=c;c--)e=a[c],m=this._getAnnotationIndex(e),0>m||(e._annotationModel=null,b.splice(m,1),h.splice(0,0,e));d||(d=[]);for(c=0;c<d.length;c++)e=d[c],m=f(b,e.start),e._annotationModel=this,b.splice(m,0,e);this.onChanged({type:"Changed",removed:h,added:d,changed:[]})},setTextModel:function(a){this._model&&this._model.removeEventListener("Changed",
this._listener.onChanged);(this._model=a)&&this._model.addEventListener("Changed",this._listener.onChanged)},_getAnnotationIndex:function(a){for(var d=this._annotations,b=f(d,a.start);b<d.length&&d[b].start===a.start;){if(d[b]===a)return b;b++}return-1},_onChanged:function(a){var d=a.start,b=a.addedCharCount,c=a.removedCharCount,m=this._annotations,f=d+c;if(0<m.length){a={type:"Changed",added:[],removed:[],changed:[],textModelChangedEvent:a};b-=c;for(c=0;c<m.length;c++){var e=m[c];e.start>=f?(e._oldStart=
e.start,e._oldEnd=e.end,e.start+=b,e.end+=b,a.changed.push(e)):e.end<=d||(e.start<d&&f<e.end?(e._oldStart=e.start,e._oldEnd=e.end,e.end+=b,a.changed.push(e)):(m.splice(c,1),a.removed.push(e),e._annotationModel=null,e.expand&&e.expand(),c--))}if(0<a.added.length||0<a.removed.length||0<a.changed.length)this.onChanged(a)}}};q.EventTarget.addMixin(p.prototype);h.prototype={destroy:function(){var a=this._view;a&&(a.removeEventListener("Destroy",this._listener.onDestroy),a.removeEventListener("LineStyle",
this._listener.onLineStyle),this.view=null);(a=this._annotationModel)&&a.removeEventListener("Changed",this._listener.onChanged)},_mergeStyle:function(a,d){if(d){a||(a={});a.styleClass=a.styleClass&&d.styleClass&&a.styleClass!==d.styleClass?a.styleClass+(" "+d.styleClass):d.styleClass;var b;d.tagName&&!a.tagName&&(a.tagName=d.tagName);if(d.style)for(b in a.style||(a.style={}),d.style)a.style[b]||(a.style[b]=d.style[b]);if(d.attributes)for(b in a.attributes||(a.attributes={}),d.attributes)a.attributes[b]||
(a.attributes[b]=d.attributes[b])}return a},_mergeStyleRanges:function(a,d){a||(a=[]);for(var b,c=f(a,d.start);c<a.length&&d;c++){var m=a[c];if(d.end<=m.start)break;if(!(d.start>=m.end)){b=this._mergeStyle({},m.style);b=this._mergeStyle(b,d.style);var e=[];e.push(c,1);d.start<m.start&&e.push({start:d.start,end:m.start,style:d.style});d.start>m.start&&e.push({start:m.start,end:d.start,style:m.style});e.push({start:Math.max(m.start,d.start),end:Math.min(m.end,d.end),style:b});d.end<m.end&&e.push({start:d.end,
end:m.end,style:m.style});d=d.end>m.end?{start:m.end,end:d.end,style:d.style}:null;Array.prototype.splice.apply(a,e)}}d&&(b=this._mergeStyle({},d.style),a.splice(c,0,{start:d.start,end:d.end,style:b}));return a},_onAnnotationModelChanged:function(a){function d(a,d){e.getBaseModel&&(a=e.mapOffset(a,!0),d=e.mapOffset(d,!0));-1!==a&&-1!==d&&c.redrawRange(a,d)}function b(a,c){for(var k=0;k<a.length;k++)if(m.isAnnotationTypeVisible(a[k].type)){var e=a[k];d(e.start,e.end);c&&(void 0!==e._oldStart&&e._oldEnd)&&
d(e._oldStart,e._oldEnd)}}var c=this._view;if(c){var m=this,e=c.getModel();b(a.added);b(a.removed);b(a.changed,!0)}},_onDestroy:function(a){this.destroy()},_onLineStyle:function(a){var d=this._annotationModel,b=a.textView.getModel(),c=d.getTextModel(),m=a.lineStart,e=a.lineStart+a.lineText.length;c!==b&&(m=b.mapOffset(m),e=b.mapOffset(e));for(d=d.getAnnotations(m,e);d.hasNext();)if(m=d.next(),this.isAnnotationTypeVisible(m.type)){if(m.rangeStyle){var e=m.start,f=m.end;c!==b&&(e=b.mapOffset(e,!0),
f=b.mapOffset(f,!0));a.ranges=this._mergeStyleRanges(a.ranges,{start:e,end:f,style:m.rangeStyle})}m.lineStyle&&(a.style=this._mergeStyle({},a.style),a.style=this._mergeStyle(a.style,m.lineStyle))}}};e.addMixin(h.prototype);return{FoldingAnnotation:s,AnnotationType:g,AnnotationTypeList:e,AnnotationModel:p,AnnotationStyler:h}});
define("orion/editor/tooltip","i18n!orion/editor/nls/messages orion/editor/textView orion/editor/textModel orion/editor/projectionTextModel orion/editor/util orion/util".split(" "),function(n,q,s,g,c,e){function f(c){this._view=c;this._fadeDelay=500;this._hideDelay=200;this._showDelay=500;this._autoHideDelay=5E3;this._create(c.getOptions("parent").ownerDocument)}f.getTooltip=function(c){c._tooltip||(c._tooltip=new f(c));return c._tooltip};f.prototype={_create:function(f){if(!this._tooltipDiv){var h=
this._tooltipDiv=e.createElement(f,"div");h.tabIndex=0;h.className="textviewTooltip";h.setAttribute("aria-live","assertive");h.setAttribute("aria-atomic","true");var b=this._tooltipContents=e.createElement(f,"div");h.appendChild(b);f.body.appendChild(h);var a=this;c.addEventListener(h,"mouseover",function(d){a._hideDelay&&(d=a._getWindow(),a._delayedHideTimeout&&(d.clearTimeout(a._delayedHideTimeout),a._delayedHideTimeout=null),a._hideTimeout&&(d.clearTimeout(a._hideTimeout),a._hideTimeout=null),
a._nextTarget=null)},!1);c.addEventListener(h,"mouseout",function(d){d=d.relatedTarget||d.toElement;!(d===h||a._hasFocus())&&(!d||!c.contains(h,d))&&a._hide()},!1);c.addEventListener(h,"keydown",function(d){27===d.keyCode&&a._hide()},!1);c.addEventListener(f,"mousedown",this._mouseDownHandler=function(d){a.isVisible()&&(c.contains(h,d.target||d.srcElement)||a._hide())},!0);this._view.addEventListener("Destroy",function(){a.destroy()});this._hide()}},_getWindow:function(){var c=this._tooltipDiv.ownerDocument;
return c.defaultView||c.parentWindow},destroy:function(){if(this._tooltipDiv){this._hide();var e=this._tooltipDiv.parentNode;e&&e.removeChild(this._tooltipDiv);c.removeEventListener(this._tooltipDiv.ownerDocument,"mousedown",this._mouseDownHandler,!0);this._tooltipDiv=null}},_hasFocus:function(){var e=this._tooltipDiv;return!e?!1:c.contains(e,e.ownerDocument.activeElement)},hide:function(c){void 0===c&&(c=this._hideDelay);var e=this._getWindow();this._delayedHideTimeout&&(e.clearTimeout(this._delayedHideTimeout),
this._delayedHideTimeout=null);var b=this;c?b._delayedHideTimeout=e.setTimeout(function(){b._delayedHideTimeout=null;b._hide();b.setTarget(b._nextTarget,0)},c):(b._hide(),b.setTarget(b._nextTarget,0))},_hide:function(){var c=this._tooltipDiv;c&&(this._hasFocus()&&this._view.focus(),this._contentsView&&(this._contentsView.destroy(),this._contentsView=null),this._tooltipContents&&(this._tooltipContents.innerHTML=""),c.style.visibility="hidden",c=this._getWindow(),this._showTimeout&&(c.clearTimeout(this._showTimeout),
this._showTimeout=null),this._delayedHideTimeout&&(c.clearTimeout(this._delayedHideTimeout),this._delayedHideTimeout=null),this._hideTimeout&&(c.clearTimeout(this._hideTimeout),this._hideTimeout=null),this._fadeTimeout&&(c.clearInterval(this._fadeTimeout),this._fadeTimeout=null))},isVisible:function(){return this._tooltipDiv&&"visible"===this._tooltipDiv.style.visibility},setTarget:function(c,e,b){if(this.isVisible())this._hasFocus()||(this._nextTarget=c,this.hide(b));else if(this._target=c){var a=
this;c=a._getWindow();a._showTimeout&&(c.clearTimeout(a._showTimeout),a._showTimeout=null);0===e?a.show(!0):a._showTimeout=c.setTimeout(function(){a._showTimeout=null;a.show(!0)},e?e:a._showDelay)}},show:function(c){if(this._target){var e=this._target.getTooltipInfo();if(e){var b=this._tooltipDiv,a=this._tooltipContents;b.style.left=b.style.right=b.style.width=b.style.height=a.style.width=a.style.height="auto";var d=e.contents;d instanceof Array&&(d=this._getAnnotationContents(d));if("string"===typeof d)a.innerHTML=
d;else if(this._isNode(d))a.appendChild(d);else if(d instanceof g.ProjectionTextModel){var k=this._view,f=k.getOptions();f.wrapMode=!1;f.parent=a;var m=f.themeClass;m?((m=m.replace("tooltipTheme",""))&&(m=" "+m),m="tooltipTheme"+m):m="tooltipTheme";f.themeClass=m;f=this._contentsView=new q.TextView(f);f.addEventListener("LineStyle",function(a){k.onLineStyle(a)});f.setModel(d);d=f.computeSize();a.style.width=d.width+"px";a.style.height=d.height+"px";f.resize()}else return;a=b.ownerDocument.documentElement;
"right"===e.anchor?(d=a.clientWidth-e.x,b.style.right=d+"px"):(d=parseInt(this._getNodeStyle(b,"padding-left","0"),10),d+=parseInt(this._getNodeStyle(b,"border-left-width","0"),10),d=e.x-d,b.style.left=d+"px");b.style.maxWidth=a.clientWidth-d-10+"px";d=parseInt(this._getNodeStyle(b,"padding-top","0"),10);d+=parseInt(this._getNodeStyle(b,"border-top-width","0"),10);d=e.y-d;b.style.top=d+"px";b.style.maxHeight=a.clientHeight-d-10+"px";b.style.opacity="1";b.style.visibility="visible";if(c){var v=this,
t=this._getWindow();v._hideTimeout=t.setTimeout(function(){v._hideTimeout=null;var a=parseFloat(v._getNodeStyle(b,"opacity","1"));v._fadeTimeout=t.setInterval(function(){"visible"===b.style.visibility&&0<a?(a-=0.1,b.style.opacity=a):v._hide()},v._fadeDelay/10)},v._autoHideDelay)}}}},_getAnnotationContents:function(f){function h(a,d){var b=u.getLineStart(u.getLineAtOffset(a)),c=u.getLineEnd(u.getLineAtOffset(d),!0);return u.getText(b,c)}function b(a){var d=a.title,b=e.createElement(m,"div");b.className=
"tooltipRow";a.html&&(b.innerHTML=a.html,b.lastChild&&c.addEventListener(b.lastChild,"click",function(d){d=a.start;var b=a.end;t.getBaseModel&&(d=t.mapOffset(d,!0),b=t.mapOffset(b,!0));v.setSelection(d,b,1/3,function(){r._hide()})},!1),b.appendChild(m.createTextNode("\u00a0")));d||(d=h(a.start,a.end));"function"===typeof d&&(d=a.title());if("string"===typeof d){var k=e.createElement(m,"span");k.appendChild(m.createTextNode(d));d=k}b.appendChild(d);return b}for(var a,d=[],k=0;k<f.length;k++)a=f[k],
""!==a.title&&!a.groupAnnotation&&d.push(a);f=d;if(0===f.length)return null;var r=this,m=this._tooltipDiv.ownerDocument,v=this._view,t=v.getModel(),u=t.getBaseModel?t.getBaseModel():t;if(1===f.length){a=f[0];if(void 0!==a.title)return a=b(a),a.firstChild&&((f=a.firstChild.className)&&(f+=" "),a.firstChild.className=f+"single"),a;f=new g.ProjectionTextModel(u);d=u.getLineStart(u.getLineAtOffset(a.start));k=u.getCharCount();a.end!==k&&f.addProjection({start:a.end,end:k});0<d&&f.addProjection({start:0,
end:d});return f}d=e.createElement(m,"div");a=e.createElement(m,"em");a.appendChild(m.createTextNode(n.multipleAnnotations));d.appendChild(a);for(k=0;k<f.length;k++)a=f[k],(a=b(a))&&d.appendChild(a);return d},_getNodeStyle:function(c,e,b){var a;if(c&&(a=c.style[e],!a))if(c.currentStyle){for(a=0;-1!==(a=e.indexOf("-",a));)e=e.substring(0,a)+e.substring(a+1,a+2).toUpperCase()+e.substring(a+2);a=c.currentStyle[e]}else a=(c=c.ownerDocument.defaultView.getComputedStyle(c,null))?c.getPropertyValue(e):null;
return a||b},_isNode:function(c){return"object"===typeof Node?c instanceof Node:c&&"object"===typeof c&&"number"===typeof c.nodeType&&"string"===typeof c.nodeName}};return{Tooltip:f}});
define("orion/editor/rulers",["i18n!orion/editor/nls/messages","orion/editor/annotations","orion/editor/tooltip","orion/util"],function(n,q,s,g){function c(b,a,d,c){this._location=a||"left";this._overview=d||"page";this._rulerStyle=c;this._view=null;var e=this;this._listener={onTextModelChanged:function(a){e._onTextModelChanged(a)},onAnnotationModelChanged:function(a){e._onAnnotationModelChanged(a)}};this.setAnnotationModel(b)}function e(b,a,d,k,e){c.call(this,b,a,"page",d);this._oddStyle=k||{style:{backgroundColor:"white"}};
this._evenStyle=e||{style:{backgroundColor:"white"}};this._numOfDigits=0;this._firstLine=1}function f(b,a,d){c.call(this,b,a,"page",d)}function p(b,a,d){c.call(this,b,a,"document",d)}function h(b,a,d){f.call(this,b,a,d)}c.prototype={getAnnotations:function(b,a){var d=this._annotationModel;if(!d)return[];var c=this._view.getModel(),e=c.getLineStart(b),m=c.getLineEnd(a-1),f=c;c.getBaseModel&&(f=c.getBaseModel(),e=c.mapOffset(e),m=c.mapOffset(m));for(var h=[],d=this.getAnnotationsByType(d,e,m),e=0;e<
d.length;e++)for(var m=d[e],g=f.getLineAtOffset(m.start),p=f.getLineAtOffset(Math.max(m.start,m.end-1)),n=g;n<=p;n++){var w=n;if(c!==f){w=f.getLineStart(n);w=c.mapOffset(w,!0);if(-1===w)continue;w=c.getLineAtOffset(w)}if(b<=w&&w<a){var s=this._mergeAnnotation(h[w],m,n-g,p-g+1);s&&(h[w]=s)}}if(!this._multiAnnotation&&this._multiAnnotationOverlay)for(var l in h)h[l]._multiple&&(h[l].html+=this._multiAnnotationOverlay.html);return h},getAnnotationModel:function(){return this._annotationModel},getLocation:function(){return this._location},
getOverview:function(){return this._overview},getRulerStyle:function(){return this._rulerStyle},getView:function(){return this._view},getWidestAnnotation:function(){return null},setAnnotationModel:function(b){this._annotationModel&&this._annotationModel.removEventListener("Changed",this._listener.onAnnotationModelChanged);(this._annotationModel=b)&&this._annotationModel.addEventListener("Changed",this._listener.onAnnotationModelChanged)},setMultiAnnotation:function(b){this._multiAnnotation=b},setMultiAnnotationOverlay:function(b){this._multiAnnotationOverlay=
b},setView:function(b){this._onTextModelChanged&&this._view&&this._view.removeEventListener("ModelChanged",this._listener.onTextModelChanged);this._view=b;this._onTextModelChanged&&this._view&&this._view.addEventListener("ModelChanged",this._listener.onTextModelChanged)},onClick:function(b,a){if(void 0!==b){var d=this._view,c=d.getModel(),e=c,m=c.getLineStart(b),f=m,h=m,g=this._annotationModel;if(g){d=d.getSelection();h=c.getLineEnd(b,!0);m<=d.start&&d.start<h&&(m=d.start);c.getBaseModel&&(m=c.mapOffset(m),
h=c.mapOffset(h),e=c.getBaseModel());for(var p,h=g.getAnnotations(m,h),g=null;!p&&h.hasNext();)d=h.next(),this.isAnnotationTypeVisible(d.type)&&(g=d,d.start<=m||(p=d));g&&void 0!==g.groupId&&(this._currentClickGroup=this._currentClickGroup===g.groupId?null:g.groupId,this._setCurrentGroup(b));p&&e.getLineAtOffset(p.start)===e.getLineAtOffset(m)?(m=p.start,h=p.end):h=m=f;c.getBaseModel&&(m=c.mapOffset(m,!0),h=c.mapOffset(h,!0))}(c=s.Tooltip.getTooltip(this._view))&&c.setTarget(null);this._view.setSelection(h,
m,1/3,function(){})}},onDblClick:function(b,a){},onMouseMove:function(b,a){var d=s.Tooltip.getTooltip(this._view);if(d&&!(d.isVisible()&&this._tooltipLineIndex===b)){this._tooltipLineIndex=b;var c=this;d.setTarget({y:a.clientY,getTooltipInfo:function(){return c._getTooltipInfo(c._tooltipLineIndex,this.y)}})}},onMouseOver:function(b,a){this.onMouseMove(b,a);this._currentClickGroup||this._setCurrentGroup(b)},onMouseOut:function(b,a){this._currentClickGroup||this._setCurrentGroup(-1);var d=s.Tooltip.getTooltip(this._view);
d&&d.setTarget(null)},_getTooltipInfo:function(b,a){if(void 0!==b){var d=this._view,c=d.getModel(),e=this._annotationModel,m=[];if(e){var m=c.getLineStart(b),f=c.getLineEnd(b);c.getBaseModel&&(m=c.mapOffset(m),f=c.mapOffset(f));m=this.getAnnotationsByType(e,m,f)}e=this._getTooltipContents(b,m);if(!e)return null;e={contents:e,anchor:this.getLocation()};m=d.getClientArea();"document"===this.getOverview()?m.y=d.convert({y:a},"view","document").y:m.y=d.getLocationAtOffset(c.getLineStart(b)).y;d.convert(m,
"document","page");e.x=m.x;e.y=m.y;"right"===e.anchor&&(e.x+=m.width);return e}},_getTooltipContents:function(b,a){return a},_onAnnotationModelChanged:function(b){function a(a){for(var b=0;b<a.length;b++)if(e.isAnnotationTypeVisible(a[b].type)){var m=a[b].start,f=a[b].end;c.getBaseModel&&(m=c.mapOffset(m,!0),f=c.mapOffset(f,!0));-1!==m&&-1!==f&&d.redrawLines(c.getLineAtOffset(m),c.getLineAtOffset(Math.max(m,f-1))+1,e)}}var d=this._view;if(d){var c=d.getModel(),e=this,m=c.getLineCount();b.textModelChangedEvent?
(b=b.textModelChangedEvent.start,c.getBaseModel&&(b=c.mapOffset(b,!0)),b=c.getLineAtOffset(b),d.redrawLines(b,m,e)):(a(b.added),a(b.removed),a(b.changed))}},_mergeAnnotation:function(b,a,d,c){b||(b={});0===d&&(b.html&&a.html?(a.html!==b.html&&(!b._multiple&&this._multiAnnotation)&&(b.html=this._multiAnnotation.html),b._multiple=!0):b.html=a.html);b.style=this._mergeStyle(b.style,a.style);return b},_mergeStyle:function(b,a){if(a){b||(b={});b.styleClass=b.styleClass&&a.styleClass&&b.styleClass!==a.styleClass?
b.styleClass+(" "+a.styleClass):a.styleClass;var d;if(a.style)for(d in b.style||(b.style={}),a.style)void 0===b.style[d]&&(b.style[d]=a.style[d]);if(a.attributes)for(d in b.attributes||(b.attributes={}),a.attributes)void 0===b.attributes[d]&&(b.attributes[d]=a.attributes[d])}return b},_setCurrentGroup:function(b){var a=this._annotationModel,d=null,c=a.getTextModel(),e,m=this._currentGroupAnnotation;if(-1!==b){var f=c.getLineStart(b),h=c.getLineEnd(b);c.getBaseModel&&(f=c.mapOffset(f),h=c.mapOffset(h));
for(e=a.getAnnotations(f,h);e.hasNext();)if(c=e.next(),this.isAnnotationTypeVisible(c.type)&&c.start<=f&&c.end>=h&&void 0!==c.groupId){d=c;break}if(m&&d&&m.groupId===d.groupId)return}this._currentGroupAnnotation=null;m&&a.removeAnnotations(m.groupType);if(d&&-1!==b){this._currentGroupAnnotation=d;e=a.getAnnotations();for(b=[];e.hasNext();)c=e.next(),delete c.groupAnnotation,c.groupId===d.groupId&&(c=c.createGroupAnnotation(),b.push(c));a.replaceAnnotations(null,b)}}};q.AnnotationTypeList.addMixin(c.prototype);
e.prototype=new c;e.prototype.getAnnotations=function(b,a){for(var d=c.prototype.getAnnotations.call(this,b,a),k=this._view.getModel(),e=b;e<a;e++){var m=e&1?this._oddStyle:this._evenStyle,f=e;k.getBaseModel&&(f=k.getLineStart(f),f=k.getBaseModel().getLineAtOffset(k.mapOffset(f)));d[e]||(d[e]={});d[e].html=this._firstLine+f+"";d[e].style||(d[e].style=m)}return d};e.prototype.getWidestAnnotation=function(){var b=this._view.getModel().getLineCount();return this.getAnnotations(b-1,b)[b-1]};e.prototype.setFirstLine=
function(b){this._firstLine=void 0!==b?b:1};e.prototype._onTextModelChanged=function(b){var a=b.start;b=this._view.getModel();var d=b.getBaseModel?b.getBaseModel().getLineCount():b.getLineCount(),d=(this._firstLine+d-1+"").length;this._numOfDigits!==d&&(this._numOfDigits=d,a=b.getLineAtOffset(a),this._view.redrawLines(a,b.getLineCount(),this))};f.prototype=new c;p.prototype=new c;p.prototype.getRulerStyle=function(){var b={style:{lineHeight:"1px",fontSize:"1px"}};return b=this._mergeStyle(b,this._rulerStyle)};
p.prototype._getTooltipContents=function(b,a){if(0===a.length){var d=this._view.getModel(),k=b;d.getBaseModel&&(k=d.getLineStart(k),k=d.getBaseModel().getLineAtOffset(d.mapOffset(k)));return g.formatMessage(n.line,k+1)}return c.prototype._getTooltipContents.call(this,b,a)};p.prototype._mergeAnnotation=function(b,a,d,c){if(0===d)return b||(b={html:"\x26nbsp;",style:{style:{height:3*c+"px"}}},b.style=this._mergeStyle(b.style,a.overviewStyle)),b};h.prototype=new f;h.prototype.onClick=function(b,a){if(void 0!==
b){var d=this._annotationModel;if(d){var c=this._view.getModel(),e=c.getLineStart(b),m=c.getLineEnd(b,!0);c.getBaseModel&&(e=c.mapOffset(e),m=c.mapOffset(m),c=c.getBaseModel());for(var f,d=d.getAnnotations(e,m);!f&&d.hasNext();)m=d.next(),this.isAnnotationTypeVisible(m.type)&&(f=m);f&&c.getLineAtOffset(f.start)===c.getLineAtOffset(e)&&((c=s.Tooltip.getTooltip(this._view))&&c.setTarget(null),f.expanded?f.collapse():f.expand())}}};h.prototype._getTooltipContents=function(b,a){return 1===a.length&&a[0].expanded?
null:f.prototype._getTooltipContents.call(this,b,a)};h.prototype._onAnnotationModelChanged=function(b){function a(a){for(m=0;m<a.length;m++)if(e.isAnnotationTypeVisible(a[m].type)){var d=a[m].start;c.getBaseModel&&(d=c.mapOffset(d,!0));-1!==d&&(g=Math.min(g,c.getLineAtOffset(d)))}}if(b.textModelChangedEvent)f.prototype._onAnnotationModelChanged.call(this,b);else{var d=this._view;if(d){var c=d.getModel(),e=this,m,h=c.getLineCount(),g=h;a(b.added);a(b.removed);a(b.changed);b=d.getRulers();for(m=0;m<
b.length;m++)d.redrawLines(g,h,b[m])}}};return{Ruler:c,AnnotationRuler:f,LineNumberRuler:e,OverviewRuler:p,FoldingRuler:h}});
define("orion/editor/undoStack",[],function(){function n(g,c,e,f,p){this.model=g;this.offset=c;this.text=e;this.previousText=f;this.type=p}function q(g){this.owner=g;this.changes=[]}function s(g,c){this.size=void 0!==c?c:100;this.reset();var e=this;this._listener={onChanging:function(c){e._onChanging(c)},onDestroy:function(c){e._onDestroy(c)}};if(g.getModel){var f=g.getModel();f.getBaseModel&&(f=f.getBaseModel());this.model=f;this.setView(g)}else this.shared=!0,this.model=g;this.model.addEventListener("Changing",
this._listener.onChanging)}n.prototype={getRedoChanges:function(){return[{start:this.offset,end:this.offset+this.previousText.length,text:this.text}]},getUndoChanges:function(){return[{start:this.offset,end:this.offset+this.text.length,text:this.previousText}]},undo:function(g,c){this._doUndoRedo(this.offset,this.previousText,this.text,g,c);return!0},redo:function(g,c){this._doUndoRedo(this.offset,this.text,this.previousText,g,c);return!0},merge:function(g,c,e,f,p){if(f===this.type){if(1===f&&g===
this.offset+this.text.length)return this.text+=c,!0;if(-1===f&&p===this.offset)return this.offset=g,this.previousText=e+this.previousText,!0;if(-1===f&&g===this.offset)return this.previousText+=e,!0}return!1},_doUndoRedo:function(g,c,e,f,p){this.model.setText(c,g,g+e.length);p&&f&&(e=f.getModel(),e!==this.model&&(g=e.mapOffset(g,!0)),f.setSelection(g,g+c.length))}};q.prototype={getRedoChanges:function(){for(var g=[],c=0;c<this.changes.length;c++)g=g.concat(this.changes[c].getRedoChanges());return g},
getUndoChanges:function(){for(var g=[],c=this.changes.length-1;0<=c;c--)g=g.concat(this.changes[c].getUndoChanges());return g},add:function(g){this.changes.push(g)},end:function(g){g&&(this.endSelection=g.getSelection(),this.endCaret=g.getCaretOffset());(g=this.owner)&&g.end&&g.end()},undo:function(g,c){1<this.changes.length&&g&&g.setRedraw(!1);for(var e=this.changes.length-1;0<=e;e--)this.changes[e].undo(g,!1);1<this.changes.length&&g&&g.setRedraw(!0);if(c&&g){var e=this.startSelection.start,f=this.startSelection.end;
g.setSelection(this.startCaret?e:f,this.startCaret?f:e)}(e=this.owner)&&e.undo&&e.undo();return 0<this.changes.length},redo:function(g,c){1<this.changes.length&&g&&g.setRedraw(!1);for(var e=0;e<this.changes.length;e++)this.changes[e].redo(g,!1);(1<this.changes.length,g)&&g.setRedraw(!0);if(c&&g){var e=this.endSelection.start,f=this.endSelection.end;g.setSelection(this.endCaret?e:f,this.endCaret?f:e)}(e=this.owner)&&e.redo&&e.redo();return 0<this.changes.length},merge:function(g,c,e,f,p){var h=this.changes.length;
return 0<h?this.changes[h-1].merge(g,c,e,f,p):!1},start:function(g){g&&(this.startSelection=g.getSelection(),this.startCaret=g.getCaretOffset());(g=this.owner)&&g.start&&g.start()}};s.prototype={destroy:function(){this._onDestroy()},add:function(g){this.compoundChange?this.compoundChange.add(g):(this.stack.splice(this.index,this.stack.length-this.index,g),this.index++,this.stack.length>this.size&&(this.stack.shift(),this.index--))},markClean:function(){this._commitUndo();if(this.cleanChange=this.stack[this.index-
1])this.cleanChange.type=2},isClean:function(){return this.cleanChange===this.stack[this.index-1]},canUndo:function(){return 0<this.index},canRedo:function(){return 0<this.stack.length-this.index},endCompoundChange:function(){this.compoundChange&&this.compoundChange.end(this.view);this.compoundChange=void 0},getSize:function(){return{undo:this.index,redo:this.stack.length-this.index}},getRedoChanges:function(){this._commitUndo();for(var g=[],c=this.index;c<this.stack.length;c++)g=g.concat(this.stack[c].getRedoChanges());
return g},getUndoChanges:function(){this._commitUndo();for(var g=[],c=this.index;0<=c;c--)g=g.concat(this.stack[c].getUndoChanges());return g},undo:function(){this._commitUndo();var g;g=!1;this._ignoreUndo=!0;do{if(0>=this.index)break;g=this.stack[--this.index]}while(!(g=g.undo(this.view,!0)));this._ignoreUndo=!1;return g},redo:function(){this._commitUndo();var g;this._ignoreUndo=!0;do{if(this.index>=this.stack.length)break;g=this.stack[this.index++]}while(!g.redo(this.view,!0));this._ignoreUndo=
!1;return!0},reset:function(){this.index=0;this.cleanChange=void 0;this.stack=[];this._ignoreUndo=!1;this._compoundChange=void 0},setView:function(g){this.view!==g&&(this.view&&g.removeEventListener("Destroy",this._listener.onDestroy),(this.view=g)&&g.addEventListener("Destroy",this._listener.onDestroy))},startCompoundChange:function(g){this._commitUndo();g=new q(g);this.add(g);this.compoundChange=g;this.compoundChange.start(this.view);return this.compoundChange},_commitUndo:function(){this.endCompoundChange()},
_onDestroy:function(g){(!g||!this.shared)&&this.model.removeEventListener("Changing",this._listener.onChanging);this.view&&(this.view.removeEventListener("Destroy",this._listener.onDestroy),this.view=null)},_onChanging:function(g){if(!this._ignoreUndo){var c=g.text,e=g.start,f=g.addedCharCount,p=g.removedCharCount;g=e+p;var h=0;0===f&&1===p?h=-1:1===f&&0===p&&(h=1);f=this.stack.length;p=this.model.getText(e,g);(!(0<f&&this.index===f)||!this.stack[f-1].merge(e,c,p,h,g))&&this.add(new n(this.model,
e,c,p,h))}}};return{UndoStack:s}});
define("orion/editor/textDND",["orion/util"],function(n){function q(n,g){this._view=n;this._undoStack=g;this._dragSelection=null;this._dropOffset=-1;this._dropText=null;var c=this;this._listener={onDragStart:function(e){c._onDragStart(e)},onDragEnd:function(e){c._onDragEnd(e)},onDragEnter:function(e){c._onDragEnter(e)},onDragOver:function(e){c._onDragOver(e)},onDrop:function(e){c._onDrop(e)},onDestroy:function(e){c._onDestroy(e)}};n.addEventListener("DragStart",this._listener.onDragStart);n.addEventListener("DragEnd",
this._listener.onDragEnd);n.addEventListener("DragEnter",this._listener.onDragEnter);n.addEventListener("DragOver",this._listener.onDragOver);n.addEventListener("Drop",this._listener.onDrop);n.addEventListener("Destroy",this._listener.onDestroy)}q.prototype={destroy:function(){var n=this._view;n&&(n.removeEventListener("DragStart",this._listener.onDragStart),n.removeEventListener("DragEnd",this._listener.onDragEnd),n.removeEventListener("DragEnter",this._listener.onDragEnter),n.removeEventListener("DragOver",
this._listener.onDragOver),n.removeEventListener("Drop",this._listener.onDrop),n.removeEventListener("Destroy",this._listener.onDestroy),this._view=null)},_onDestroy:function(n){this.destroy()},_onDragStart:function(n){var g=this._view,c=g.getSelection(),g=g.getModel();g.getBaseModel&&(c.start=g.mapOffset(c.start),c.end=g.mapOffset(c.end),g=g.getBaseModel());if(g=g.getText(c.start,c.end))this._dragSelection=c,n.event.dataTransfer.effectAllowed="copyMove",n.event.dataTransfer.setData("Text",g)},_onDragEnd:function(s){if(this._dragSelection){var g=
this._view,c=s.event.dataTransfer.dropEffect;if(!n.isFirefox&&("none"!==c||this._dropText))c=s.event.dataTransfer.dropEffect=this._dropEffect;this._undoStack&&this._undoStack.startCompoundChange();(s="move"===c)&&g.setText("",this._dragSelection.start,this._dragSelection.end);if(this._dropText){var c=this._dropText,e=this._dropOffset;s&&(e>=this._dragSelection.end?e-=this._dragSelection.end-this._dragSelection.start:e>=this._dragSelection.start&&(e=this._dragSelection.start));g.setText(c,e,e);g.setSelection(e,
e+c.length);this._dropText=null;this._dropOffset=-1}this._undoStack&&this._undoStack.endCompoundChange()}this._dragSelection=null},_onDragEnter:function(n){this._onDragOver(n)},_onDragOver:function(q){var g=q.event.dataTransfer.types,c=!this._view.getOptions("readonly");c&&g&&(c=g.contains?g.contains("text/plain")||g.contains("Text"):-1!==g.indexOf("text/plain")||-1!==g.indexOf("Text"));c?n.isFirefox||(this._dropEffect=q.event.dataTransfer.dropEffect=(n.isMac?q.event.altKey:q.event.ctrlKey)?"copy":
"move"):q.event.dataTransfer.dropEffect="none"},_onDrop:function(q){var g=this._view,c=q.event.dataTransfer.getData("Text");c&&(n.isFirefox||(q.event.dataTransfer.dropEffect=this._dropEffect),q=g.getOffsetAtLocation(q.x,q.y),this._dragSelection?(this._dropOffset=q,this._dropText=c):(g.setText(c,q,q),g.setSelection(q,q+c.length)))}};return{TextDND:q}});
define("orion/objects",[],function(){function n(n){for(var s=1;s<arguments.length;s++){var g=arguments[s],c;for(c in g)Object.prototype.hasOwnProperty.call(g,c)&&(n[c]=g[c])}return n}return{clone:function(q){if(Array.isArray(q))return Array.prototype.slice.call(q);var s=Object.create(Object.getPrototypeOf(q));n(s,q);return s},mixin:n,toArray:function(n){return Array.isArray(n)?n:[n]}}});
define("orion/editor/editor","i18n!orion/editor/nls/messages orion/editor/eventTarget orion/editor/tooltip orion/editor/annotations orion/objects orion/util".split(" "),function(n,q,s,g,c,e){function f(b){b=b||{};this._domNode=b.domNode;this._model=b.model;this._undoStack=b.undoStack;this._statusReporter=b.statusReporter;this._title=null;var a=this;this._listener={onChanged:function(d){a.onChanged(d)}};this._model&&this._model.addEventListener("Changed",this._listener.onChanged);this.checkDirty()}
function p(b){b=b||{};f.call(this,b);this._textViewFactory=b.textViewFactory;this._undoStackFactory=b.undoStackFactory;this._textDNDFactory=b.textDNDFactory;this._annotationFactory=b.annotationFactory;this._foldingRulerFactory=b.foldingRulerFactory;this._lineNumberRulerFactory=b.lineNumberRulerFactory;this._contentAssistFactory=b.contentAssistFactory;this._keyBindingFactory=b.keyBindingFactory;this._contentAssist=this._foldingRuler=this._overviewRuler=this._lineNumberRuler=this._annotationRuler=this._annotationModel=
this._annotationStyler=null}var h=g.AnnotationType;f.prototype={destroy:function(){this.uninstall();this._statusReporter=this._domNode=null;this._model&&this._model.removeEventListener("Changed",this._listener.onChanged)},checkDirty:function(){this.setDirty(this._undoStack&&!this._undoStack.isClean())},focus:function(){},getModel:function(){return this._model},getText:function(b,a){return this.getModel().getText(b,a)},getTitle:function(){return this._title},getUndoStack:function(){return this._undoStack},
install:function(){this.installed=!0},isDirty:function(){return this._dirty},markClean:function(){this.getUndoStack().markClean();this.setDirty(!1)},onDirtyChanged:function(b){return this.dispatchEvent(b)},onInputChanged:function(b){return this.dispatchEvent(b)},onChanged:function(b){this.checkDirty()},reportStatus:function(b,a,d){this._statusReporter&&this._statusReporter(b,a,d)},resize:function(){},setDirty:function(b){this._dirty!==b&&(this._dirty=b,this.onDirtyChanged({type:"DirtyChanged"}))},
_setModelText:function(b){this._model&&this._model.setText(b)},setInput:function(b,a,d,c){this._title=b;c||(a?this.reportStatus(a,"error"):null!==d&&(void 0!==d&&"string"===typeof d)&&this._setModelText(d),this._undoStack&&this._undoStack.reset());this.checkDirty();this.onInputChanged({type:"InputChanged",title:b,message:a,contents:d,contentsSaved:c})},setText:function(b,a,d){this.getModel().setText(b,a,d)},uninstall:function(){this.installed=!1}};q.EventTarget.addMixin(f.prototype);p.prototype=new f;
c.mixin(p.prototype,{destroy:function(){f.prototype.destroy.call(this);this._textViewFactory=this._undoStackFactory=this._textDNDFactory=this._annotationFactory=this._foldingRulerFactory=this._lineNumberRulerFactory=this._contentAssistFactory=this._keyBindingFactory=null},getAnnotationModel:function(){return this._annotationModel},getAnnotationRuler:function(){return this._annotationRuler},getAnnotationStyler:function(){return this._annotationStyler},getContentAssist:function(){return this._contentAssist},
getFoldingRuler:function(){return this._foldingRuler},getLineNumberRuler:function(){return this._lineNumberRuler},getModel:function(){if(!this._textView)return null;var b=this._textView.getModel();b.getBaseModel&&(b=b.getBaseModel());return b},getOverviewRuler:function(){return this._overviewRuler},getTextView:function(){return this._textView},getKeyModes:function(){return this._textView.getKeyModes()},getSourceCodeActions:function(){return this._sourceCodeActions},getLinkedMode:function(){return this._linkedMode},
getTextActions:function(){return this._textActions},focus:function(){this._textView&&this._textView.focus()},resize:function(){this._textView&&this._textView.resize()},setAnnotationRulerVisible:function(b,a){if(this._annotationRulerVisible!==b||a)if(this._annotationRulerVisible=b,this._annotationRuler){var d=this._textView;b?d.addRuler(this._annotationRuler,0):d.removeRuler(this._annotationRuler)}},setFoldingRulerVisible:function(b,a){if(this._foldingRulerVisible!==b||a)if(this._foldingRulerVisible=
b,this._foldingRuler){var d=this._textView;d.getModel().getBaseModel&&(b?d.addRuler(this._foldingRuler):d.removeRuler(this._foldingRuler))}},setLineNumberRulerVisible:function(b,a){if(this._lineNumberRulerVisible!==b||a)if(this._lineNumberRulerVisible=b,this._lineNumberRuler){var d=this._textView;b?d.addRuler(this._lineNumberRuler,!this._annotationRulerVisible?0:1):d.removeRuler(this._lineNumberRuler)}},setOverviewRulerVisible:function(b,a){if(this._overviewRulerVisible!==b||a)if(this._overviewRulerVisible=
b,this._overviewRuler){var d=this._textView;b?d.addRuler(this._overviewRuler):d.removeRuler(this._overviewRuler)}},mapOffset:function(b,a){var d=this._textView.getModel();d.getBaseModel&&(b=d.mapOffset(b,a));return b},getLineAtOffset:function(b){return this.getModel().getLineAtOffset(this.mapOffset(b))},getLineStart:function(b){return this.getModel().getLineStart(b)},getCaretOffset:function(){return this.mapOffset(this._textView.getCaretOffset())},getSelection:function(){var b=this._textView,a=b.getSelection(),
b=b.getModel();b.getBaseModel&&(a.start=b.mapOffset(a.start),a.end=b.mapOffset(a.end));return a},_expandOffset:function(b){var a=this._textView.getModel(),d=this._annotationModel;if(d&&a.getBaseModel)for(b=d.getAnnotations(b,b+1);b.hasNext();)a=b.next(),a.type===h.ANNOTATION_FOLDING&&a.expand&&a.expand()},setCaretOffset:function(b,a,d){var c=this._textView,e=c.getModel();e.getBaseModel&&(this._expandOffset(b),b=e.mapOffset(b,!0));c.setCaretOffset(b,a,d)},setText:function(b,a,d){var c=this._textView,
e=c.getModel();e.getBaseModel&&(void 0!==a&&(this._expandOffset(a),a=e.mapOffset(a,!0)),void 0!==d&&(this._expandOffset(d),d=e.mapOffset(d,!0)));c.setText(b,a,d)},setSelection:function(b,a,d,c){var e=this._textView,m=e.getModel();m.getBaseModel&&(this._expandOffset(b),this._expandOffset(a),b=m.mapOffset(b,!0),a=m.mapOffset(a,!0));e.setSelection(b,a,d,c)},moveSelection:function(b,a,d,c){var e=this._textView;this.setSelection(b,a||b,1/3,function(){(void 0===c||c)&&e.focus();d&&d()})},_getTooltipInfo:function(b,
a){var d=this._textView,c=this.getAnnotationModel();if(!c)return null;var e=this._annotationStyler;if(!e)return null;var m=d.getOffsetAtLocation(b,a);if(-1===m)return null;m=this.mapOffset(m);e=e.getAnnotationsByType(c,m,m+1);c=[];for(m=0;m<e.length;m++)e[m].rangeStyle&&c.push(e[m]);if(0===c.length)return null;d=d.convert({x:b,y:a},"document","page");return{contents:c,anchor:"left",x:d.x+10,y:d.y+20}},_highlightCurrentLine:function(b,a){var d=this._annotationModel;if(d){var c=this._textView;if(!c.getOptions("singleMode")){var e=
c.getModel(),m=a?e.getLineAtOffset(a.start):-1,f=e.getLineAtOffset(b.start),c=b.start===b.end,g=!a||a.start===a.end,p=e.getLineStart(f),n=e.getLineEnd(f);e.getBaseModel&&(p=e.mapOffset(p),n=e.mapOffset(n));e=this._currentLineAnnotation;if(!(m===f&&g&&c&&e&&e.start===p&&e.end===n)){var m=e?[e]:null,q;c&&(e=h.createAnnotation(h.ANNOTATION_CURRENT_LINE,p,n),q=[e]);this._currentLineAnnotation=e;d.replaceAnnotations(m,q)}}}},installTextView:function(){this.install()},install:function(){if(!this._textView){this._textView=
this._textViewFactory();this._undoStackFactory&&(this._undoStack=this._undoStackFactory.createUndoStack(this),this.checkDirty());this._textDNDFactory&&(this._textDND=this._textDNDFactory.createTextDND(this,this._undoStack));this._contentAssistFactory&&(this._contentAssist=this._contentAssistFactory.createContentAssistMode(this).getContentAssist());var b=this,a=this._textView,d=this;this._listener={onModelChanged:function(a){d.checkDirty()},onMouseOver:function(a){d._listener.onMouseMove(a)},onMouseMove:function(b){var c=
s.Tooltip.getTooltip(a);c&&!(d._listener.lastMouseX===b.event.clientX&&d._listener.lastMouseY===b.event.clientY)&&(d._listener.lastMouseX=b.event.clientX,d._listener.lastMouseY=b.event.clientY,c.setTarget({x:b.x,y:b.y,getTooltipInfo:function(){return d._getTooltipInfo(this.x,this.y)}}))},onMouseOut:function(b){var c=s.Tooltip.getTooltip(a);c&&!(d._listener.lastMouseX===b.event.clientX&&d._listener.lastMouseY===b.event.clientY)&&(d._listener.lastMouseX=b.event.clientX,d._listener.lastMouseY=b.event.clientY,
c.setTarget(null))},onScroll:function(d){(d=s.Tooltip.getTooltip(a))&&d.setTarget(null,0,0)},onSelection:function(a){d._updateCursorStatus();d._highlightCurrentLine(a.newValue,a.oldValue)}};a.addEventListener("ModelChanged",this._listener.onModelChanged);a.addEventListener("Selection",this._listener.onSelection);a.addEventListener("MouseOver",this._listener.onMouseOver);a.addEventListener("MouseOut",this._listener.onMouseOut);a.addEventListener("MouseMove",this._listener.onMouseMove);a.addEventListener("Scroll",
this._listener.onScroll);if(this._keyBindingFactory){var c;if(c="function"===typeof this._keyBindingFactory?this._keyBindingFactory(this,this.getKeyModes(),this._undoStack,this._contentAssist):this._keyBindingFactory.createKeyBindings(b,this._undoStack,this._contentAssist))this._textActions=c.textActions,this._linkedMode=c.linkedMode,this._sourceCodeActions=c.sourceCodeActions}c=function(a,d){if(void 0!==a&&-1!==a){for(var c=this.getView().getModel(),k=this.getAnnotationModel(),e=b.mapOffset(c.getLineStart(a)),
c=b.mapOffset(c.getLineEnd(a)),m=k.getAnnotations(e,c),f=null;m.hasNext();){var l=m.next();if(l.type===h.ANNOTATION_BOOKMARK){f=l;break}}f?k.removeAnnotation(f):(f=h.createAnnotation(h.ANNOTATION_BOOKMARK,e,c),f.title=void 0,k.addAnnotation(f))}};if(this._annotationFactory){var e=a.getModel();e.getBaseModel&&(e=e.getBaseModel());if(this._annotationModel=this._annotationFactory.createAnnotationModel(e))if(e=this._annotationStyler=this._annotationFactory.createAnnotationStyler(a,this._annotationModel))e.addAnnotationType(h.ANNOTATION_CURRENT_SEARCH),
e.addAnnotationType(h.ANNOTATION_MATCHING_SEARCH),e.addAnnotationType(h.ANNOTATION_ERROR),e.addAnnotationType(h.ANNOTATION_WARNING),e.addAnnotationType(h.ANNOTATION_MATCHING_BRACKET),e.addAnnotationType(h.ANNOTATION_CURRENT_BRACKET),e.addAnnotationType(h.ANNOTATION_CURRENT_LINE),e.addAnnotationType(h.ANNOTATION_READ_OCCURRENCE),e.addAnnotationType(h.ANNOTATION_WRITE_OCCURRENCE),e.addAnnotationType(h.ANNOTATION_SELECTED_LINKED_GROUP),e.addAnnotationType(h.ANNOTATION_CURRENT_LINKED_GROUP),e.addAnnotationType(h.ANNOTATION_LINKED_GROUP),
e.addAnnotationType("orion.annotation.highlightError");var e=this._annotationFactory.createAnnotationRulers(this._annotationModel),m=this._annotationRuler=e.annotationRuler;m&&(m.onDblClick=c,m.setMultiAnnotationOverlay({html:"\x3cdiv class\x3d'annotationHTML overlay'\x3e\x3c/div\x3e"}),m.addAnnotationType(h.ANNOTATION_ERROR),m.addAnnotationType(h.ANNOTATION_WARNING),m.addAnnotationType(h.ANNOTATION_TASK),m.addAnnotationType(h.ANNOTATION_BOOKMARK));this.setAnnotationRulerVisible(this._annotationRulerVisible||
void 0===this._annotationRulerVisible,!0);if(m=this._overviewRuler=e.overviewRuler)m.addAnnotationType(h.ANNOTATION_CURRENT_SEARCH),m.addAnnotationType(h.ANNOTATION_MATCHING_SEARCH),m.addAnnotationType(h.ANNOTATION_READ_OCCURRENCE),m.addAnnotationType(h.ANNOTATION_WRITE_OCCURRENCE),m.addAnnotationType(h.ANNOTATION_CURRENT_BLAME),m.addAnnotationType(h.ANNOTATION_ERROR),m.addAnnotationType(h.ANNOTATION_WARNING),m.addAnnotationType(h.ANNOTATION_TASK),m.addAnnotationType(h.ANNOTATION_BOOKMARK),m.addAnnotationType(h.ANNOTATION_MATCHING_BRACKET),
m.addAnnotationType(h.ANNOTATION_CURRENT_BRACKET),m.addAnnotationType(h.ANNOTATION_CURRENT_LINE);this.setOverviewRulerVisible(this._overviewRulerVisible||void 0===this._overviewRulerVisible,!0)}this._lineNumberRulerFactory&&(this._lineNumberRuler=this._lineNumberRulerFactory.createLineNumberRuler(this._annotationModel),this._lineNumberRuler.addAnnotationType(h.ANNOTATION_CURRENT_BLAME),this._lineNumberRuler.addAnnotationType(h.ANNOTATION_BLAME),this._lineNumberRuler.onDblClick=c,this.setLineNumberRulerVisible(this._lineNumberRulerVisible||
void 0===this._lineNumberRulerVisible,!0));this._foldingRulerFactory&&(this._foldingRuler=this._foldingRulerFactory.createFoldingRuler(this._annotationModel),this._foldingRuler.addAnnotationType(h.ANNOTATION_FOLDING),this.setFoldingRulerVisible(this._foldingRulerVisible||void 0===this._foldingRulerVisible,!0));this.dispatchEvent({type:"TextViewInstalled",textView:a});f.prototype.install.call(this)}},uninstallTextView:function(){this.uninstall()},uninstall:function(){var b=this._textView;b&&(b.destroy(),
this._textView=this._undoStack=this._textDND=this._contentAssist=this._listener=this._annotationModel=this._annotationStyler=this._annotationRuler=this._overviewRuler=this._lineNumberRuler=this._foldingRuler=this._currentLineAnnotation=this._title=null,this._dirty=!1,this._foldingRulerVisible=this._overviewRulerVisible=this._lineNumberRulerVisible=this._annotationRulerVisible=void 0,this.dispatchEvent({type:"TextViewUninstalled",textView:b}),f.prototype.uninstall.call(this))},_updateCursorStatus:function(){for(var b=
this.getModel(),a=this.getCaretOffset(),d=b.getLineAtOffset(a),b=b.getLineStart(d),a=a-b,b=this.getKeyModes(),c=0;c<b.length;c++){var f=b[c];if(f.isActive()&&f.isStatusActive&&f.isStatusActive())return}this.reportStatus(e.formatMessage(n.lineColumn,d+1,a+1))},showAnnotations:function(b,a,d,c){var e=this._annotationModel;if(e){for(var m=[],f=[],g=e.getTextModel(),p=e.getAnnotations(),n;p.hasNext();)n=p.next(),-1!==a.indexOf(n.type)&&n.creatorID===this&&m.push(n);if(b)for(a=0;a<b.length;a++)if(n=b[a]){if(d)n=
d(n);else{var q;"number"===typeof n.line?(q=g.getLineStart(n.line-1),p=q+n.start-1,q=q+n.end-1):(p=n.start,q=n.end);var w=c(n);if(!w)continue;n=h.createAnnotation(w,p,q,n.description)}n.creatorID=this;f.push(n)}e.replaceAnnotations(m,f)}},showProblems:function(b){this.showAnnotations(b,[h.ANNOTATION_ERROR,h.ANNOTATION_WARNING,h.ANNOTATION_TASK],null,function(a){switch(a.severity){case "error":return h.ANNOTATION_ERROR;case "warning":return h.ANNOTATION_WARNING;case "task":return h.ANNOTATION_TASK}return null})},
showOccurrences:function(b){this.showAnnotations(b,[h.ANNOTATION_READ_OCCURRENCE,h.ANNOTATION_WRITE_OCCURRENCE],null,function(a){return a.readAccess?h.ANNOTATION_READ_OCCURRENCE:h.ANNOTATION_WRITE_OCCURRENCE})},showBlame:function(b){var a=this._blameRGB,d=this.getTextView().getOptions("parent").ownerDocument;if(!a){var k=e.createElement(d,"div");k.className="annotation blame";d.body.appendChild(k);var f=(d.defaultView||d.parentWindow).getComputedStyle(k).getPropertyValue("background-color");k.parentNode.removeChild(k);
var k=f.indexOf("("),m=f.indexOf(")"),f=f.substring(k+1,m);this._blameRGB=a=f.split(",").slice(0,3)}var p=function(){var a=g.AnnotationType.createAnnotation(this.groupType,this.start,this.end,this.title);a.style=c.mixin({},a.style);a.style.style=c.mixin({},a.style.style);a.style.style.backgroundColor="";this.groupAnnotation=a;a.blame=this.blame;a.html=this.html;a.creatorID=this.creatorID;return a},t=function(){var a=e.createElement(d,"div");a.className="tooltipTitle";var b=this.blame.Message.indexOf("\n");
-1===b&&(b=this.blame.Message.length);var c=e.createElement(d,"a");c.href=this.blame.CommitLink;c.appendChild(d.createTextNode(this.blame.Message.substring(0,b)));a.appendChild(c);a.appendChild(e.createElement(d,"br"));a.appendChild(d.createTextNode(e.formatMessage(n.committerOnTime,this.blame.AuthorName,this.blame.Time)));return a},u=this.getModel();this.showAnnotations(b,[h.ANNOTATION_BLAME,h.ANNOTATION_CURRENT_BLAME],function(d){var b=u.getLineStart(d.Start-1),k=u.getLineEnd(d.End-1,!0),b=g.AnnotationType.createAnnotation(h.ANNOTATION_BLAME,
b,k,t),k=a.slice(0);k.push(d.Shade);b.style=c.mixin({},b.style);b.style.style=c.mixin({},b.style.style);b.style.style.backgroundColor="rgba("+k.join()+")";b.groupId=d.Name;b.groupType=h.ANNOTATION_CURRENT_BLAME;b.createGroupAnnotation=p;b.html='\x3cimg class\x3d"annotationHTML blame" src\x3d"'+d.AuthorImage+'"/\x3e';b.blame=d;return b})},showSelection:function(b,a,d,c,e){"number"===typeof b?("number"!==typeof a&&(a=b),this.moveSelection(b,a)):"number"===typeof d&&(b=this.getModel().getLineStart(d-
1),"number"===typeof c&&(b+=c),"number"!==typeof e&&(e=0),this.moveSelection(b,b+e))},_setModelText:function(b){this._textView&&(this._textView.setText(b),this._textView.getModel().setLineDelimiter("auto"),this._highlightCurrentLine(this._textView.getSelection()))},setInput:function(b,a,d,c,e){f.prototype.setInput.call(this,b,a,d,c);this._textView&&(!c&&!e)&&this._textView.focus()},onGotoLine:function(b,a,d,c){if(this._textView){var e=this.getModel();b=Math.max(0,Math.min(b,e.getLineCount()-1));var m=
e.getLineStart(b),f=0;void 0===d&&(d=0);"string"===typeof a?(b=e.getLine(b).indexOf(a),-1!==b&&(f=b,d=f+a.length)):(f=a,a=e.getLineEnd(b)-m,f=Math.min(f,a),d=Math.min(d,a));this.moveSelection(m+f,m+d,c)}}});return{BaseEditor:f,Editor:p}});
define("orion/editor/find","i18n!orion/editor/nls/messages orion/keyBinding orion/editor/keyModes orion/editor/annotations orion/regex orion/objects orion/util".split(" "),function(n,q,s,g,c,e,f){function p(a){var d=a.getTextView();s.KeyMode.call(this,d);this.editor=a;this._active=!1;this._success=!0;this._ignoreSelection=!1;this._prefix="";d.setAction("incrementalFindCancel",function(){this.setActive(!1);return!0}.bind(this));d.setAction("incrementalFindBackspace",function(){return this._backspace()}.bind(this));
var b=this;this._listener={onVerify:function(a){var d=b.editor,e=d.getModel(),f=d.mapOffset(a.start),d=d.mapOffset(a.end),e=e.getText(f,d);if((e=b._prefix.match(RegExp("^"+c.escape(e),"i")))&&0<e.length)b._prefix+=a.text,b._success=!0,b._status(),b.find(b._forward,!0),a.text=null},onSelection:function(){b._ignoreSelection||b.setActive(!1)}}}function h(a,d,b){if(a){this._editor=a;this._undoStack=d;this._showAll=!0;this._visible=!1;this._wrap=this._caseInsensitive=!0;this._wholeWord=!1;this._incremental=
!0;this._regex=!1;this._findAfterReplace=!0;this._reverse=this._hideAfterFind=!1;this._timer=this._end=this._start=void 0;this._lastString="";var c=this;this._listeners={onEditorFocus:function(a){c._removeCurrentAnnotation(a)}};this.setOptions(b)}}var b={};p.prototype=new s.KeyMode;e.mixin(p.prototype,{createKeyBindings:function(){var a=q.KeyBinding,d=[];d.push({actionID:"incrementalFindBackspace",keyBinding:new a(8)});d.push({actionID:"incrementalFindCancel",keyBinding:new a(13)});d.push({actionID:"incrementalFindCancel",
keyBinding:new a(27)});d.push({actionID:"incrementalFindReverse",keyBinding:new a(38)});d.push({actionID:"incrementalFind",keyBinding:new a(40)});d.push({actionID:"incrementalFindReverse",keyBinding:new a("k",!0,!0)});d.push({actionID:"incrementalFind",keyBinding:new a("k",!0)});return d},find:function(a,d){this._forward=a;if(!this.isActive())return this.setActive(!0),!1;var b=this._prefix;if(0===b.length)return!1;var c=this.editor,e=c.getModel(),e=a?this._success?d?this._start:c.getCaretOffset()+
1:0:this._success?d?this._start:c.getCaretOffset():e.getCharCount()-1;(b=c.getModel().find({string:b,start:e,reverse:!a,caseInsensitive:b.toLowerCase()===b}).next())?(d||(this._start=e),this._ignoreSelection=this._success=!0,c.moveSelection(a?b.start:b.end,a?b.end:b.start),this._ignoreSelection=!1):this._success=!1;this._status();return!0},isActive:function(){return this._active},isStatusActive:function(){return this.isActive()},setActive:function(a){this._active!==a&&(this._active=a,this._prefix=
"",this._success=!0,a=this.editor.getTextView(),this._start=this.editor.getCaretOffset(),this.editor.setCaretOffset(this._start),this._active?(a.addEventListener("Verify",this._listener.onVerify),a.addEventListener("Selection",this._listener.onSelection),a.addKeyMode(this)):(a.removeEventListener("Verify",this._listener.onVerify),a.removeEventListener("Selection",this._listener.onSelection),a.removeKeyMode(this)),this._status())},_backspace:function(){var a=this._prefix,a=this._prefix=a.substring(0,
a.length-1);return 0===a.length?(this._ignoreSelection=this._success=!0,this.editor.setCaretOffset(this.editor.getSelection().start),this._ignoreSelection=!1,this._status(),!0):this.find(this._forward,!0)},_status:function(){if(this.isActive()){var a;a=this._forward?this._success?n.incrementalFindStr:n.incrementalFindStrNotFound:this._success?n.incrementalFindReverseStr:n.incrementalFindReverseStrNotFound;a=f.formatMessage(a,this._prefix);this.editor.reportStatus(a,this._success?"":"error")}else this.editor.reportStatus("")}});
b.IncrementalFind=p;h.prototype={find:function(a,d,b){this.setOptions({reverse:!a});var c=this.getFindString(),e;d&&(c=d.findString||c,e=d.count);a=this.getOptions();this.setOptions(d);d=b?this._startOffset:this.getStartOffset();if((e=this._doFind(c,d,e))&&!b)this._startOffset=e.start;this.setOptions(a);this._hideAfterFind&&this.hide();return e},getStartOffset:function(){return void 0!==this._start?this._start:this._reverse?this._editor.getSelection().start-1:this._editor.getCaretOffset()},getFindString:function(){var a=
this._editor.getSelection(),a=this._editor.getText(a.start,a.end);this._regex&&(a=c.escape(a));return a||this._lastString},getOptions:function(){return{showAll:this._showAll,caseInsensitive:this._caseInsensitive,wrap:this._wrap,wholeWord:this._wholeWord,incremental:this._incremental,regex:this._regex,findAfterReplace:this._findAfterReplace,hideAfterFind:this._hideAfterFind,reverse:this._reverse,findCallback:this._findCallback,start:this._start,end:this._end}},getReplaceString:function(){return""},
hide:function(){this._visible=!1;this._savedOptions&&(this.setOptions(this._savedOptions.pop()),0===this._savedOptions.length&&(this._savedOptions=null));this._removeAllAnnotations();var a=this._editor.getTextView();a&&(a.removeEventListener("Focus",this._listeners.onEditorFocus),a.focus())},_processReplaceString:function(a){var d=a;if(this._regex){for(var d="",b=!1,c=this._editor.getModel().getLineDelimiter(),e=0;e<a.length;e++){var f=a.substring(e,e+1);if(b){switch(f){case "R":d+=c;break;case "r":d+=
"\r";break;case "n":d+="\n";break;case "t":d+="\t";break;case "\\":d+="\\";break;default:d+="\\"+f}b=!1}else"\\"===f?b=!0:d+=f}b&&(d+="\\")}return d},isVisible:function(){return this._visible},replace:function(){var a=this.getFindString();if(a){var d=this._editor,b=this._processReplaceString(this.getReplaceString()),c=d.getSelection().start;if(d=d.getModel().find({string:a,start:c,reverse:!1,wrap:this._wrap,regex:this._regex,wholeWord:this._wholeWord,caseInsensitive:this._caseInsensitive}).next())this.startUndo(),
this._doReplace(d.start,d.end,a,b),this.endUndo()}this._findAfterReplace&&a&&this._doFind(a,this.getStartOffset())},replaceAll:function(){var a=this.getFindString();if(a){this._replacingAll=!0;var d=this._editor,b=d.getTextView();d.reportStatus(n.replaceAll);var c=this._processReplaceString(this.getReplaceString()),e=this;window.setTimeout(function(){for(var h=0,g=0;;){var p=e._doFind(a,h,null,!0);if(!p)break;g++;1===g&&(b.setRedraw(!1),e.startUndo());e._doReplace(p.start,p.end,a,c);h=e.getStartOffset()}0<
g&&(e.endUndo(),b.setRedraw(!0));0<h?d.reportStatus(f.formatMessage(n.replacedMatches,g)):d.reportStatus(n.nothingReplaced,"error");e._replacingAll=!1},100)}},setOptions:function(a){if(a){if((!0===a.showAll||!1===a.showAll)&&this._showAll!==a.showAll)if(this._showAll=a.showAll,this.isVisible())if(this._showAll)this._markAllOccurrences();else{var d=this._editor.getAnnotationModel();d&&d.removeAnnotations(g.AnnotationType.ANNOTATION_MATCHING_SEARCH)}if(!0===a.caseInsensitive||!1===a.caseInsensitive)this._caseInsensitive=
a.caseInsensitive;if(!0===a.wrap||!1===a.wrap)this._wrap=a.wrap;if(!0===a.wholeWord||!1===a.wholeWord)this._wholeWord=a.wholeWord;if(!0===a.incremental||!1===a.incremental)this._incremental=a.incremental;if(!0===a.regex||!1===a.regex)this._regex=a.regex;if(!0===a.findAfterReplace||!1===a.findAfterReplace)this._findAfterReplace=a.findAfterReplace;if(!0===a.hideAfterFind||!1===a.hideAfterFind)this._hideAfterFind=a.hideAfterFind;if(!0===a.reverse||!1===a.reverse)this._reverse=a.reverse;a.hasOwnProperty("findCallback")&&
(this._findCallback=a.findCallback);a.hasOwnProperty("start")&&(this._start=a.start);a.hasOwnProperty("end")&&(this._end=a.end)}},show:function(a){this._visible=!0;a&&(this._savedOptions||(this._savedOptions=[]),this._savedOptions.push(this.getOptions()),this.setOptions(a));this._startOffset=this._editor.getSelection().start;this._editor.getTextView().addEventListener("Focus",this._listeners.onEditorFocus);var d=this;window.setTimeout(function(){d._incremental&&d.find(!0,null,!0)},0)},startUndo:function(){this._undoStack&&
this._undoStack.startCompoundChange()},endUndo:function(){this._undoStack&&this._undoStack.endCompoundChange()},_find:function(a,d,b){return this._editor.getModel().find({string:a,start:d,end:this._end,reverse:this._reverse,wrap:b?!1:this._wrap,regex:this._regex,wholeWord:this._wholeWord,caseInsensitive:this._caseInsensitive})},_doFind:function(a,d,b,c){b=b||1;var e=this._editor;if(!a)return this._removeAllAnnotations(),null;this._lastString=a;var f,h;if(this._regex)try{h=this._find(a,d,c)}catch(p){e.reportStatus(p.message,
"error");return}else h=this._find(a,d,c);for(a=0;a<b&&h.hasNext();a++)f=h.next();if(!this._replacingAll){f?this._editor.reportStatus(""):this._editor.reportStatus(n.notFound,"error");if(this.isVisible()){b=g.AnnotationType.ANNOTATION_CURRENT_SEARCH;if(h=e.getAnnotationModel())h.removeAnnotations(b),f&&h.addAnnotation(g.AnnotationType.createAnnotation(b,f.start,f.end));if(this._showAll){this._timer&&window.clearTimeout(this._timer);var q=this;this._timer=window.setTimeout(function(){q._markAllOccurrences();
q._timer=null},500)}}this._findCallback?this._findCallback(f):f&&e.moveSelection(f.start,f.end,null,!1)}return f},_doReplace:function(a,d,b,c){var e=this._editor;if(this._regex&&(c=e.getText(a,d).replace(RegExp(b,this._caseInsensitive?"i":""),c),!c))return;e.setText(c,a,d);e.setSelection(a,a+c.length,!0)},_markAllOccurrences:function(){var a=this._editor.getAnnotationModel();if(a){for(var d=g.AnnotationType.ANNOTATION_MATCHING_SEARCH,b=a.getAnnotations(),c=[],e;b.hasNext();){var f=b.next();f.type===
d&&c.push(f)}if(this.isVisible()){b=this.getFindString();b=this._editor.getModel().find({string:b,regex:this._regex,wholeWord:this._wholeWord,caseInsensitive:this._caseInsensitive});for(e=[];b.hasNext();)f=b.next(),e.push(g.AnnotationType.createAnnotation(d,f.start,f.end))}a.replaceAnnotations(c,e)}},_removeAllAnnotations:function(){var a=this._editor.getAnnotationModel();a&&(a.removeAnnotations(g.AnnotationType.ANNOTATION_CURRENT_SEARCH),a.removeAnnotations(g.AnnotationType.ANNOTATION_MATCHING_SEARCH))},
_removeCurrentAnnotation:function(a){(a=this._editor.getAnnotationModel())&&a.removeAnnotations(g.AnnotationType.ANNOTATION_CURRENT_SEARCH)}};b.Find=h;return b});
define("orion/editor/actions","i18n!orion/editor/nls/messages orion/keyBinding orion/editor/annotations orion/editor/tooltip orion/editor/find orion/util".split(" "),function(n,q,s,g,c,e){function f(a,d,b){this.editor=a;this.undoStack=d;this._incrementalFind=new c.IncrementalFind(a);this._find=b?b:new c.Find(a,d);this._lastEditLocation=null;this.init()}function p(a,d,b,c){this.editor=a;this.undoStack=d;this.contentAssist=b;this.linkedMode=c;this.contentAssist&&this.contentAssist.addEventListener("ProposalApplied",
this.contentAssistProposalApplied.bind(this));this.init()}var h=s.AnnotationType,b={};f.prototype={init:function(){var a=this.editor.getTextView();this._lastEditListener={onModelChanged:function(a){this.editor.isDirty()&&(this._lastEditLocation=a.start+a.addedCharCount)}.bind(this)};a.addEventListener("ModelChanged",this._lastEditListener.onModelChanged);a.setAction("undo",function(a){if(this.undoStack){var b=1;a&&a.count&&(b=a.count);for(;0<b;)this.undoStack.undo(),--b;return!0}return!1}.bind(this),
{name:n.undo});a.setAction("redo",function(a){if(this.undoStack){var b=1;a&&a.count&&(b=a.count);for(;0<b;)this.undoStack.redo(),--b;return!0}return!1}.bind(this),{name:n.redo});a.setKeyBinding(new q.KeyBinding("f",!0),"find");a.setAction("find",function(){if(this._find){var a=this.editor.getSelection();(a=prompt(n.find,this.editor.getText(a.start,a.end)))&&this._find.find(!0,{findString:a})}}.bind(this),{name:n.find});a.setKeyBinding(new q.KeyBinding("k",!0),"findNext");a.setAction("findNext",function(a){return this._find?
(this._find.find(!0,a),!0):!1}.bind(this),{name:n.findNext});a.setKeyBinding(new q.KeyBinding("k",!0,!0),"findPrevious");a.setAction("findPrevious",function(a){return this._find?(this._find.find(!1,a),!0):!1}.bind(this),{name:n.findPrevious});a.setKeyBinding(new q.KeyBinding("j",!0),"incrementalFind");a.setAction("incrementalFind",function(){this._incrementalFind&&this._incrementalFind.find(!0);return!0}.bind(this),{name:n.incrementalFind});a.setKeyBinding(new q.KeyBinding("j",!0,!0),"incrementalFindReverse");
a.setAction("incrementalFindReverse",function(){this._incrementalFind&&this._incrementalFind.find(!1);return!0}.bind(this),{name:n.incrementalFindReverse});a.setAction("tab",function(){return this.indentLines()}.bind(this));a.setAction("shiftTab",function(){return this.unindentLines()}.bind(this),{name:n.unindentLines});a.setKeyBinding(new q.KeyBinding(38,!1,!1,!0),"moveLinesUp");a.setAction("moveLinesUp",function(){return this.moveLinesUp()}.bind(this),{name:n.moveLinesUp});a.setKeyBinding(new q.KeyBinding(40,
!1,!1,!0),"moveLinesDown");a.setAction("moveLinesDown",function(){return this.moveLinesDown()}.bind(this),{name:n.moveLinesDown});a.setKeyBinding(new q.KeyBinding(38,!0,!1,!0),"copyLinesUp");a.setAction("copyLinesUp",function(){return this.copyLinesUp()}.bind(this),{name:n.copyLinesUp});a.setKeyBinding(new q.KeyBinding(40,!0,!1,!0),"copyLinesDown");a.setAction("copyLinesDown",function(){return this.copyLinesDown()}.bind(this),{name:n.copyLinesDown});a.setKeyBinding(new q.KeyBinding("d",!0,!1,!1),
"deleteLines");a.setAction("deleteLines",function(a){return this.deleteLines(a)}.bind(this),{name:n.deleteLines});a.setKeyBinding(new q.KeyBinding("l",!e.isMac,!1,!1,e.isMac),"gotoLine");a.setAction("gotoLine",function(){return this.gotoLine()}.bind(this),{name:n.gotoLine});a.setKeyBinding(new q.KeyBinding(190,!0),"nextAnnotation");a.setAction("nextAnnotation",function(){return this.nextAnnotation(!0)}.bind(this),{name:n.nextAnnotation});a.setKeyBinding(new q.KeyBinding(188,!0),"previousAnnotation");
a.setAction("previousAnnotation",function(){return this.nextAnnotation(!1)}.bind(this),{name:n.prevAnnotation});a.setKeyBinding(new q.KeyBinding("e",!0,!1,!0,!1),"expand");a.setAction("expand",function(){return this.expandAnnotation(!0)}.bind(this),{name:n.expand});a.setKeyBinding(new q.KeyBinding("c",!0,!1,!0,!1),"collapse");a.setAction("collapse",function(){return this.expandAnnotation(!1)}.bind(this),{name:n.collapse});a.setKeyBinding(new q.KeyBinding("e",!0,!0,!0,!1),"expandAll");a.setAction("expandAll",
function(){return this.expandAnnotations(!0)}.bind(this),{name:n.expandAll});a.setKeyBinding(new q.KeyBinding("c",!0,!0,!0,!1),"collapseAll");a.setAction("collapseAll",function(){return this.expandAnnotations(!1)}.bind(this),{name:n.collapseAll});a.setKeyBinding(new q.KeyBinding("q",!e.isMac,!1,!1,e.isMac),"lastEdit");a.setAction("lastEdit",function(){return this.gotoLastEdit()}.bind(this),{name:n.lastEdit})},copyLinesDown:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;
var d=a.getModel(),b=a.getSelection(),c=d.getLineAtOffset(b.start),b=d.getLineAtOffset(b.end>b.start?b.end-1:b.end),e=d.getLineStart(c),c=d.getLineEnd(b,!0),f=d.getLineCount(),h="",e=d.getText(e,c);b===f-1&&(e=(h=d.getLineDelimiter())+e);a.setText(e,c,c);a.setSelection(c+h.length,c+e.length);return!0},copyLinesUp:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var d=a.getModel(),b=a.getSelection(),c=d.getLineAtOffset(b.start),b=d.getLineAtOffset(b.end>b.start?b.end-
1:b.end),c=d.getLineStart(c),e=d.getLineEnd(b,!0),f=d.getLineCount(),h="",e=d.getText(c,e);b===f-1&&(e+=h=d.getLineDelimiter());a.setText(e,c,c);a.setSelection(c,c+e.length-h.length);return!0},deleteLines:function(a){var d=this.editor;if(d.getTextView().getOptions("readonly"))return!1;var b=1;a&&a.count&&(b=a.count);var c=d.getSelection(),e=d.getModel(),f=e.getLineAtOffset(c.start);a=e.getLineStart(f);b=c.start!==c.end||1===b?e.getLineAtOffset(c.end>c.start?c.end-1:c.end):Math.min(f+b-1,e.getLineCount()-
1);b=e.getLineEnd(b,!0);d.setText("",a,b);return!0},expandAnnotation:function(a){var d=this.editor,b=d.getAnnotationModel();if(!b)return!0;var c=d.getModel(),e=d.getCaretOffset(),f=c.getLineAtOffset(e),e=c.getLineStart(f),f=c.getLineEnd(f,!0);c.getBaseModel&&(e=c.mapOffset(e),f=c.mapOffset(f),c.getBaseModel());for(var h,b=b.getAnnotations(e,f);!h&&b.hasNext();)c=b.next(),c.type===s.AnnotationType.ANNOTATION_FOLDING&&(h=c);h&&a!==h.expanded&&(a?h.expand():(d.setCaretOffset(h.start),h.collapse()));
return!0},expandAnnotations:function(a){var d=this.editor,b=d.getTextView(),d=d.getAnnotationModel();if(!d)return!0;var c=d.getAnnotations();for(b.setRedraw(!1);c.hasNext();)d=c.next(),d.type===s.AnnotationType.ANNOTATION_FOLDING&&a!==d.expanded&&(a?d.expand():d.collapse());b.setRedraw(!0);return!0},indentLines:function(){var a=this.editor,d=a.getTextView();if(d.getOptions("readonly"))return!1;if(d.getOptions("tabMode")){var b=a.getModel(),c=a.getSelection(),e=b.getLineAtOffset(c.start),f=b.getLineAtOffset(c.end>
c.start?c.end-1:c.end);if(e!==f){var h=[];h.push("");for(var g=e;g<=f;g++)h.push(b.getLine(g,!0));g=b.getLineStart(e);b=b.getLineEnd(f,!0);d=d.getOptions("tabSize","expandTab");d=d.expandTab?Array(d.tabSize+1).join(" "):"\t";a.setText(h.join(d),g,b);a.setSelection(g===c.start?c.start:c.start+d.length,c.end+(f-e+1)*d.length);return!0}return!1}},gotoLastEdit:function(){"number"===typeof this._lastEditLocation&&this.editor.showSelection(this._lastEditLocation);return!0},gotoLine:function(){var a=this.editor,
d=a.getModel().getLineAtOffset(a.getCaretOffset());if(d=prompt(n.gotoLinePrompty,d+1))d=parseInt(d,10),a.onGotoLine(d-1,0);return!0},moveLinesDown:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var d=a.getModel(),b=a.getSelection(),c=d.getLineAtOffset(b.start),e=d.getLineAtOffset(b.end>b.start?b.end-1:b.end),f=d.getLineCount();if(e===f-1)return!0;var c=d.getLineStart(c),b=d.getLineEnd(e,!0),h=d.getLineEnd(e+1,!0)-(b-c),g=0;e!==f-2?d=d.getText(c,b):(e=d.getLineEnd(e),
d=d.getText(e,b)+d.getText(c,e),g+=b-e);this.startUndo();a.setText("",c,b);a.setText(d,h,h);a.setSelection(h+g,h+g+d.length);this.endUndo();return!0},moveLinesUp:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var d=a.getModel(),b=a.getSelection(),c=d.getLineAtOffset(b.start);if(0===c)return!0;var e=d.getLineAtOffset(b.end>b.start?b.end-1:b.end),f=d.getLineCount(),b=d.getLineStart(c-1),h=d.getLineStart(c),g=d.getLineEnd(e,!0),p=d.getText(h,g),n=0;e===f-1&&(e=d.getLineEnd(c-
1),c=d.getLineEnd(c-1,!0),p+=d.getText(e,c),h=e,n=c-e);this.startUndo();a.setText("",h,g);a.setText(p,b,b);a.setSelection(b,b+p.length-n);this.endUndo();return!0},nextAnnotation:function(a){function d(a){return!!a.lineStyle||a.type===h.ANNOTATION_MATCHING_BRACKET||a.type===h.ANNOTATION_CURRENT_BRACKET||!e.isAnnotationTypeVisible(a.type)}var b=this.editor,c=b.getAnnotationModel();if(!c)return!0;var e=b.getOverviewRuler()||b.getAnnotationStyler();if(!e)return!0;for(var f=b.getModel(),p=b.getCaretOffset(),
n=c.getAnnotations(a?p:0,a?f.getCharCount():p),q=null;n.hasNext();){var s=n.next();if(a){if(s.start<=p)continue}else if(s.start>=p)continue;if(!d(s)&&(q=s,a))break}if(q){for(var w=[q],n=c.getAnnotations(q.start,q.start);n.hasNext();)s=n.next(),s!==q&&!d(s)&&w.push(s);var B=b.getTextView(),l=f.getLineAtOffset(q.start),z=g.Tooltip.getTooltip(B);if(!z)return b.moveSelection(q.start),!0;b.moveSelection(q.start,q.start,function(){z.setTarget({getTooltipInfo:function(){var a=B.convert({x:B.getLocationAtOffset(q.start).x,
y:B.getLocationAtOffset(f.getLineStart(l)).y},"document","page");return{contents:w,x:a.x,y:a.y+Math.floor(1.33*B.getLineHeight(l))}}},0)})}return!0},unindentLines:function(){var a=this.editor,d=a.getTextView();if(d.getOptions("readonly"))return!1;if(d.getOptions("tabMode")){for(var b=a.getModel(),c=a.getSelection(),e=b.getLineAtOffset(c.start),f=b.getLineAtOffset(c.end>c.start?c.end-1:c.end),h=d.getOptions("tabSize"),g=Array(h+1).join(" "),p=[],n=d=0,w=e;w<=f;w++){var q=b.getLine(w,!0);if(b.getLineStart(w)!==
b.getLineEnd(w))if(0===q.indexOf("\t"))q=q.substring(1),d++;else if(0===q.indexOf(g))q=q.substring(h),d+=h;else return!0;w===e&&(n=d);p.push(q)}e=b.getLineStart(e);h=b.getLineEnd(f,!0);b=b.getLineStart(f);a.setText(p.join(""),e,h);f=e===c.start?c.start:c.start-n;c=Math.max(f,c.end-d+(c.end===b+1&&c.start!==c.end?1:0));a.setSelection(f,c);return!0}},startUndo:function(){this.undoStack&&this.undoStack.startCompoundChange()},endUndo:function(){this.undoStack&&this.undoStack.endCompoundChange()}};b.TextActions=
f;p.prototype={init:function(){var a=this.editor.getTextView();a.setAction("lineStart",function(){return this.lineStart()}.bind(this));a.setAction("enter",function(){return this.autoIndent()}.bind(this));a.setKeyBinding(new q.KeyBinding("t",!0,!1,!0),"trimTrailingWhitespaces");a.setAction("trimTrailingWhitespaces",function(){return this.trimTrailingWhitespaces()}.bind(this),{name:n.trimTrailingWhitespaces});a.setKeyBinding(new q.KeyBinding(191,!0),"toggleLineComment");a.setAction("toggleLineComment",
function(){return this.toggleLineComment()}.bind(this),{name:n.toggleLineComment});a.setKeyBinding(new q.KeyBinding(191,!0,!e.isMac,!1,e.isMac),"addBlockComment");a.setAction("addBlockComment",function(){return this.addBlockComment()}.bind(this),{name:n.addBlockComment});a.setKeyBinding(new q.KeyBinding(220,!0,!e.isMac,!1,e.isMac),"removeBlockComment");a.setAction("removeBlockComment",function(){return this.removeBlockComment()}.bind(this),{name:n.removeBlockComment});a.setKeyBinding(new q.KeyBinding("[",
!1,!1,!1,!1,"keypress"),"autoPairSquareBracket");a.setAction("autoPairSquareBracket",function(){return this.autoPairBrackets("[","]")}.bind(this));a.setKeyBinding(new q.KeyBinding("]",!1,!1,!1,!1,"keypress"),"skipClosingSquareBracket");a.setAction("skipClosingSquareBracket",function(){return this.skipClosingBracket("]")}.bind(this));a.setKeyBinding(new q.KeyBinding("\x3c",!1,!1,!1,!1,"keypress"),"autoPairAngleBracket");a.setAction("autoPairAngleBracket",function(){return this.autoPairBrackets("\x3c",
"\x3e")}.bind(this));a.setKeyBinding(new q.KeyBinding("\x3e",!1,!1,!1,!1,"keypress"),"skipClosingAngleBracket");a.setAction("skipClosingAngleBracket",function(){return this.skipClosingBracket("\x3e")}.bind(this));a.setKeyBinding(new q.KeyBinding("(",!1,!1,!1,!1,"keypress"),"autoPairParentheses");a.setAction("autoPairParentheses",function(){return this.autoPairBrackets("(",")")}.bind(this));a.setKeyBinding(new q.KeyBinding(")",!1,!1,!1,!1,"keypress"),"skipClosingParenthesis");a.setAction("skipClosingParenthesis",
function(){return this.skipClosingBracket(")")}.bind(this));a.setKeyBinding(new q.KeyBinding("{",!1,!1,!1,!1,"keypress"),"autoPairBraces");a.setAction("autoPairBraces",function(){return this.autoPairBrackets("{","}")}.bind(this));a.setKeyBinding(new q.KeyBinding("}",!1,!1,!1,!1,"keypress"),"skipClosingBrace");a.setAction("skipClosingBrace",function(){return this.skipClosingBracket("}")}.bind(this));a.setKeyBinding(new q.KeyBinding("'",!1,!1,!1,!1,"keypress"),"autoPairSingleQuotation");a.setAction("autoPairSingleQuotation",
function(){return this.autoPairQuotations("'")}.bind(this));a.setKeyBinding(new q.KeyBinding('"',!1,!1,!1,!1,"keypress"),"autoPairDblQuotation");a.setAction("autoPairDblQuotation",function(){return this.autoPairQuotations('"')}.bind(this));a.setAction("deletePrevious",function(){return this.deletePrevious()}.bind(this))},autoIndent:function(){var a=this.editor,d=a.getTextView();if(d.getOptions("readonly"))return!1;var b=a.getSelection();if(b.start===b.end){for(var c=a.getModel(),e=c.getLineAtOffset(b.start),
f=c.getLine(e,!1),h=c.getLineStart(e),g=0,p=b.start-h,n;g<p&&(32===(n=f.charCodeAt(g))||9===n);)g++;var h=f.substring(0,g),d=d.getOptions("tabSize","expandTab"),w=d.expandTab?Array(d.tabSize+1).join(" "):"\t",d=c.getLineDelimiter(),q=/^[\s]*\/\*[\*]*[\s]*$/,l=/^[\s]*\*/,z=/\*\/[\s]*$/,x=f.substring(0,p),s=f.substring(p),F;if(this.smartIndentation&&123===f.charCodeAt(F=x.trimRight().length-1))return c=p-F-1,s=s.length-s.trimLeft().length,f=125===f.charCodeAt(p+s)?d+h+w+d+h:d+h+w,a.setText(f,b.start-
c,b.end+s),a.setCaretOffset(b.start+d.length+h.length+w.length-c),!0;if(this.autoCompleteComments&&!z.test(x)&&(q.test(x)||l.test(x))){if(g=q.exec(x)){f=d+h+" * ";f=z.test(s)?f+s.substring(0,s.length-2).trim():f+s.trim();if(c.getLineCount()===e+1||!l.test(c.getLine(e+1)))f+=d+h+" */";a.setText(f,b.start,b.end+s.length);a.setCaretOffset(b.start+d.length+h.length+3);return!0}if(g=l.exec(x))for(e-=1;0<=e;e--){g=c.getLine(e,!1);if(q.test(g))return z.test(s)||47===f.charCodeAt(p)?(f=d+h+"*"+s,h=b.start+
d.length+h.length+1):(f=d+h+"* "+s,h=b.start+d.length+h.length+2),a.setText(f,b.start,b.end+s.length),a.setCaretOffset(h),!0;if(!l.test(g))break}}else{if(z.test(x)&&32===h.charCodeAt(h.length-1))return f=d+h.substring(0,h.length-1),a.setText(f,b.start,b.end),a.setCaretOffset(b.start+f.length),!0;if(0<g){for(g=p;g<f.length&&(32===(n=f.charCodeAt(g++))||9===n);)b.end++;a.setText(c.getLineDelimiter()+h,b.start,b.end);return!0}}}return!1},addBlockComment:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;
var d=a.getModel(),b=a.getSelection(),c=this._findEnclosingComment(d,b.start,b.end);if(void 0!==c.commentStart&&void 0!==c.commentEnd)return!0;d=d.getText(b.start,b.end);if(0===d.length)return!0;var c=d.length,d=d.replace(/\/\*|\*\//g,""),e=d.length;a.setText("/*"+d+"*/",b.start,b.end);a.setSelection(b.start+2,b.end+2+(e-c));return!0},autoPairBrackets:function(a,d){if("["===a&&!this.autoPairSquareBrackets||"{"===a&&!this.autoPairBraces||"("===a&&!this.autoPairParentheses||"\x3c"===a&&!this.autoPairAngleBrackets)return!1;
var b=this.editor;if(b.getTextView().getOptions("readonly"))return!1;var c=b.getSelection(),e=b.getModel(),f=b.getCaretOffset()===e.getCharCount()?"":e.getText(c.start,c.start+1).trim(),h=/^$|[)}\]>]/;return c.start===c.end&&h.test(f)?(b.setText(a+d,c.start,c.start),b.setCaretOffset(c.start+1),!0):c.start!==c.end?(e=e.getText(c.start,c.end),b.setText(a+e+d,c.start,c.end),b.setSelection(c.start+1,c.end+1),!0):!1},autoPairQuotations:function(a){if(!this.autoPairQuotation)return!1;var d=this.editor;
if(d.getTextView().getOptions("readonly"))return!1;var b=d.getSelection(),c=d.getModel(),e=d.getCaretOffset(),f=0===e?"":c.getText(b.start-1,b.start).trim(),h=e===c.getCharCount()?"":c.getText(b.start,b.start+1).trim(),e=/^"$|^'$/,g=/\w/,p=/^$|[)}\]>]/;if(b.start!==b.end){c=c.getText(b.start,b.end);if(e.test(c))return!1;d.setText(a+c+a,b.start,b.end);d.setSelection(b.start+1,b.end+1)}else{if(h!==a){if(f===a||e.test(h)||g.test(f)||!p.test(h))return!1;d.setText(a+a,b.start,b.start)}d.setCaretOffset(b.start+
1)}return!0},contentAssistProposalApplied:function(a){a=a.data.proposal;if(a.positions&&0<a.positions.length&&this.linkedMode){for(var d=[],b=0;b<a.positions.length;++b)d[b]={positions:[{offset:a.positions[b].offset,length:a.positions[b].length}]};this.linkedMode.enterLinkedMode({groups:d,escapePosition:a.escapePosition})}else a.groups&&0<a.groups.length&&this.linkedMode?this.linkedMode.enterLinkedMode({groups:a.groups,escapePosition:a.escapePosition}):a.escapePosition&&this.editor.getTextView().setCaretOffset(a.escapePosition);
return!0},deletePrevious:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var d=a.getSelection();if(d.start!==d.end)return!1;var b=a.getModel(),c=a.getCaretOffset(),e=0===c?"":b.getText(d.start-1,d.start),b=c===b.getCharCount()?"":b.getText(d.start,d.start+1);("("===e&&")"===b||"["===e&&"]"===b||"{"===e&&"}"===b||"\x3c"===e&&"\x3e"===b||'"'===e&&'"'===b||"'"===e&&"'"===b)&&a.setText("",d.start,d.start+1);return!1},_findEnclosingComment:function(a,b,c){var e=a.getLineAtOffset(b),
f=a.getLineAtOffset(c),h,g,p,n,q,w;for(h=e;0<=h&&!(g=a.getLine(h),p=h===e?b-a.getLineStart(e):g.length,n=g.lastIndexOf("/*",p),g=g.lastIndexOf("*/",p),g>n);h--)if(-1!==n){q=a.getLineStart(h)+n;break}for(h=f;h<a.getLineCount()&&!(g=a.getLine(h),p=h===f?c-a.getLineStart(f):0,n=g.indexOf("/*",p),g=g.indexOf("*/",p),-1!==n&&n<g);h++)if(-1!==g){w=a.getLineStart(h)+g;break}return{commentStart:q,commentEnd:w}},lineStart:function(){for(var a=this.editor,b=a.getModel(),c=a.getCaretOffset(),e=b.getLineAtOffset(c),
f=b.getLineStart(e),b=b.getLine(e),e=0;e<b.length;e++){var h=b.charCodeAt(e);if(!(32===h||9===h))break}e+=f;return c!==e?(a.setSelection(e,e),!0):!1},removeBlockComment:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var b=a.getModel(),c=a.getSelection(),e=b.getText(c.start,c.end),f,h,g;for(g=0;g<e.length;g++)if("/*"===e.substring(g,g+2)){f=c.start+g;break}for(;g<e.length;g++)if("*/"===e.substring(g,g+2)){h=c.start+g;break}if(void 0!==f&&void 0!==h)a.setText(b.getText(f+
2,h),f,h+2),a.setSelection(f,h);else{e=this._findEnclosingComment(b,c.start,c.end);if(void 0===e.commentStart||void 0===e.commentEnd)return!0;b=b.getText(e.commentStart+2,e.commentEnd);a.setText(b,e.commentStart,e.commentEnd+2);a.setSelection(c.start-2,c.end-2)}return!0},toggleLineComment:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;for(var b=this.lineComment||"//",c=a.getModel(),e=a.getSelection(),f=c.getLineAtOffset(e.start),h=c.getLineAtOffset(e.end>e.start?e.end-
1:e.end),g=!0,p=[],n,q,w=f;w<=h;w++)if(n=c.getLine(w,!0),p.push(n),!g||-1===(q=n.indexOf(b)))g=!1;else if(0!==q){var s;for(s=0;s<q;s++){var l=n.charCodeAt(s);if(!(32===l||9===l))break}g=s===q}l=b.length;w=c.getLineStart(f);s=c.getLineEnd(h,!0);if(g){for(g=0;g<p.length;g++)n=p[g],q=n.indexOf(b),p[g]=n.substring(0,q)+n.substring(q+l);b=p.join("");p=c.getLineStart(h);c=w===e.start?e.start:e.start-l;e=e.end-l*(h-f+1)+(e.end===p+1?l:0)}else p.splice(0,0,""),b=p.join(b),c=w===e.start?e.start:e.start+l,
e=e.end+l*(h-f+1);a.setText(b,w,s);a.setSelection(c,e);return!0},trimTrailingWhitespaces:function(){var a=this.editor,b=a.getModel(),c=a.getSelection();a.getTextView().setRedraw(!1);a.getUndoStack().startCompoundChange();for(var e=/(\s+$)/,f=b.getLineCount(),h=0;h<f;h++){var g=b.getLine(h),p=e.exec(g);if(p){var n=b.getLineStart(h),g=p[0].length,p=n+p.index;b.setText("",p,p+g);c.start>p&&(c.start=Math.max(p,c.start-g));c.start!==c.end&&c.end>p&&(c.end=Math.max(p,c.end-g))}}a.getUndoStack().endCompoundChange();
a.getTextView().setRedraw(!0);a.setSelection(c.start,c.end,!1)},startUndo:function(){this.undoStack&&this.undoStack.startCompoundChange()},skipClosingBracket:function(a){var b=this.editor;if(b.getTextView().getOptions("readonly"))return!1;var c=b.getSelection(),e=b.getModel();return(b.getCaretOffset()===e.getCharCount()?"":e.getText(c.start,c.start+1))===a?(b.setCaretOffset(c.start+1),!0):!1},endUndo:function(){this.undoStack&&this.undoStack.endCompoundChange()},setAutoPairParentheses:function(a){this.autoPairParentheses=
a},setAutoPairBraces:function(a){this.autoPairBraces=a},setAutoPairSquareBrackets:function(a){this.autoPairSquareBrackets=a},setAutoPairAngleBrackets:function(a){this.autoPairAngleBrackets=a},setAutoPairQuotations:function(a){this.autoPairQuotation=a},setAutoCompleteComments:function(a){this.autoCompleteComments=a},setLineComment:function(a){this.lineComment=a},setSmartIndentation:function(a){this.smartIndentation=a}};b.SourceCodeActions=p;String.prototype.trimLeft||(String.prototype.trimLeft=function(){return this.replace(/^\s+/g,
"")});String.prototype.trimRight||(String.prototype.trimRight=function(){return this.replace(/\s+$/g,"")});return b});
define("orion/editor/templates",[],function(){function n(n,g,c,e){this.prefix=n;this.description=g;this.template=c;this.name=e;this._parse()}function q(n,g){this._keywords=n||[];this._templates=[];this.addTemplates(g||[])}n.prototype={getProposal:function(n,g,c){n=g-n.length;g={};var e,f=void 0!==c.delimiter?c.delimiter:"\n";c.indentation&&(f+=c.indentation);var p=void 0!==c.tab?c.tab:"\t",h=0,b=this.variables,a=this.segments;c=[];for(var d=0;d<a.length;d++){var k=a[d],r=b[k];if(void 0!==r)switch(k){case "${tab}":k=
p;break;case "${delimiter}":k=f;break;case "${cursor}":k="";e=h;break;default:var m=g[k];m||(m=g[k]={data:r.data,positions:[]});k=r.substitution;m.data&&m.data.values&&(k=m.data.values[0]);m.positions.push({offset:n+h,length:k.length})}c.push(k);h+=k.length}var f=[],v;for(v in g)g.hasOwnProperty(v)&&f.push(g[v]);c=c.join("");void 0===e&&(e=c.length);return{proposal:c,name:this.name,description:this.description,groups:f,escapePosition:n+e,style:"noemphasis"}},match:function(n){return 0===this.prefix.indexOf(n)},
_parse:function(){var n=this.template,g=[],c={},e,f=0,n=n.replace(/\n/g,"${delimiter}"),n=n.replace(/\t/g,"${tab}");n.replace(/\$\{((?:[^\\}]+|\\.))*\}/g,function(p,h,b){var a=p.substring(2,p.length-1);h=p;var d=a,k=null,r=d.indexOf(":");-1!==r&&(d=d.substring(0,r),h="${"+d+"}",k=JSON.parse(a.substring(r+1).replace("\\}","}").trim()));(a=c[h])||(a=c[h]={});a.substitution=d;k&&(a.data=k);(e=n.substring(f,b))&&g.push(e);g.push(h);f=b+p.length;return d});(e=n.substring(f,n.length))&&g.push(e);this.segments=
g;this.variables=c}};q.prototype={addTemplates:function(q){for(var g=this.getTemplates(),c=0;c<q.length;c++)g.push(new n(q[c].prefix,q[c].description,q[c].template,q[c].name))},computeProposals:function(n,g,c){var e=this.getPrefix(n,g,c),f=[];this.isValid(e,n,g,c)&&(f=f.concat(this.getTemplateProposals(e,g,c)),f=f.concat(this.getKeywordProposals(e)));return f},getKeywords:function(){return this._keywords},getKeywordProposals:function(n){var g=[],c=this.getKeywords();if(c){for(var e=0;e<c.length;e++)0===
c[e].indexOf(n)&&g.push({proposal:c[e].substring(n.length),description:c[e],style:"noemphasis_keyword"});0<g.length&&g.splice(0,0,{proposal:"",description:"Keywords",style:"noemphasis_title_keywords",unselectable:!0})}return g},getPrefix:function(n,g,c){return c.prefix},getTemplates:function(){return this._templates},getTemplateProposals:function(n,g,c){for(var e=[],f=this.getTemplates(),p=0;p<f.length;p++){var h=f[p];h.match(n)&&(h=h.getProposal(n,g,c),this.removePrefix(n,h),e.push(h))}0<e.length&&
(e.sort(function(b,a){return b.name<a.name?-1:b.name>a.name?1:0}),e.splice(0,0,{proposal:"",description:"Templates",style:"noemphasis_title",unselectable:!0}));return e},removePrefix:function(n,g){if(!(g.overwrite=g.proposal.substring(0,n.length)!==n))g.proposal=g.proposal.substring(n.length)},isValid:function(n,g,c,e){return!0}};return{Template:n,TemplateContentAssist:q}});
define("orion/editor/linkedMode","i18n!orion/editor/nls/messages orion/keyBinding orion/editor/keyModes orion/editor/annotations orion/editor/templates orion/objects orion/util".split(" "),function(n,q,s,g,c,e){function f(c,b,a){var d=c.getTextView();s.KeyMode.call(this,d);this.editor=c;this.undoStack=b;this.contentAssist=a;this.linkedModeModel=null;d.setAction("linkedModeEnter",function(){this.exitLinkedMode(!0);return!0}.bind(this));d.setAction("linkedModeCancel",function(){this.exitLinkedMode(!1);
return!0}.bind(this));d.setAction("linkedModeNextGroup",function(){var a=this.linkedModeModel;this.selectLinkedGroup((a.selectedGroupIndex+1)%a.groups.length);return!0}.bind(this));d.setAction("linkedModePreviousGroup",function(){var a=this.linkedModeModel;this.selectLinkedGroup(0<a.selectedGroupIndex?a.selectedGroupIndex-1:a.groups.length-1);return!0}.bind(this));this.linkedModeListener={onActivating:function(a){this._groupContentAssistProvider&&(this.contentAssist.setProviders([this._groupContentAssistProvider]),
this.contentAssist.setProgress(null))}.bind(this),onModelChanged:function(a){if(!this.ignoreVerify){for(var b=this.editor.mapOffset(a.start),d=this.linkedModeModel,c,e;d;)if(c=this._getPositionChanged(d,b,b+a.removedCharCount),e=c.position,void 0===e||e.model!==d)this.exitLinkedMode(!1),d=this.linkedModeModel;else break;if(d){d=0;a=a.addedCharCount-a.removedCharCount;c=c.positions;for(var f,h=0;h<c.length;++h){f=c[h];e=f.position;var g=e.offset<=b&&b<=e.offset+e.length;g&&!f.ansestor?(e.offset+=d,
e.length+=a,d+=a):(e.offset+=d,f.ansestor&&g&&(e.length+=a));f.escape&&(f.model.escapePosition=e.offset)}this._updateAnnotations(c)}}}.bind(this),onVerify:function(a){if(!this.ignoreVerify){for(var b=this.editor,d=b.mapOffset(a.start),c=this.editor.mapOffset(a.end),e=this.linkedModeModel,f,h;e;)if(f=this._getPositionChanged(e,d,c),h=f.position,void 0===h||h.model!==e)this.exitLinkedMode(!1),e=this.linkedModeModel;else break;if(e){var g=this._compoundChange;g?g.owner.model===e&&g.owner.group===h.group||
(this.endUndo(),this.startUndo()):this.startUndo();e.selectedGroupIndex=h.group;var g=0,p=a.text.length-(c-d);f=f.positions;for(var n,d=d-h.position.offset,l=c-h.position.offset,q=0;q<f.length;++q)n=f[q],c=n.position,n.oldOffset=c.offset,n.model===e&&n.group===h.group?(c.offset+=g,c.length+=p,g+=p):(c.offset+=g,n.ansestor&&(c.length+=h.count*p)),n.escape&&(n.model.escapePosition=c.offset);this.ignoreVerify=!0;for(q=f.length-1;0<=q;q--)n=f[q],n.model===e&&n.group===h.group&&b.setText(a.text,n.oldOffset+
d,n.oldOffset+l);this.ignoreVerify=!1;a.text=null;this._updateAnnotations(f)}}}.bind(this)}}var p={};f.prototype=new s.KeyMode;e.mixin(f.prototype,{createKeyBindings:function(){var c=q.KeyBinding,b=[];b.push({actionID:"linkedModeEnter",keyBinding:new c(13)});b.push({actionID:"linkedModeCancel",keyBinding:new c(27)});b.push({actionID:"linkedModeNextGroup",keyBinding:new c(9)});b.push({actionID:"linkedModePreviousGroup",keyBinding:new c(9,!1,!0)});return b},enterLinkedMode:function(c){if(!this.linkedModeModel){var b=
this.editor.getTextView();b.addKeyMode(this);b.addEventListener("Verify",this.linkedModeListener.onVerify);b.addEventListener("ModelChanged",this.linkedModeListener.onModelChanged);this.contentAssist.addEventListener("Activating",this.linkedModeListener.onActivating);this.editor.reportStatus(n.linkedModeEntered,null,!0)}this._sortedPositions=null;this.linkedModeModel&&(c.previousModel=this.linkedModeModel,c.parentGroup=this.linkedModeModel.selectedGroupIndex,this.linkedModeModel.nextModel=c);this.linkedModeModel=
c;this.selectLinkedGroup(0)},exitLinkedMode:function(c){if(this.isActive()){this._compoundChange&&(this.endUndo(),this._compoundChange=null);this._sortedPositions=null;var b=this.linkedModeModel;this.linkedModeModel=b.previousModel;b.parentGroup=b.previousModel=void 0;this.linkedModeModel&&(this.linkedModeModel.nextModel=void 0);if(!this.linkedModeModel){var a=this.editor,d=a.getTextView();d.removeKeyMode(this);d.removeEventListener("Verify",this.linkedModeListener.onVerify);d.removeEventListener("ModelChanged",
this.linkedModeListener.onModelChanged);d=this.contentAssist;d.removeEventListener("Activating",this.linkedModeListener.onActivating);d.offset=void 0;this.editor.reportStatus(n.linkedModeExited,null,!0);c&&a.setCaretOffset(b.escapePosition,!1)}this.selectLinkedGroup(0)}},startUndo:function(){if(this.undoStack){var c=this,b=this.linkedModeModel;this._compoundChange=this.undoStack.startCompoundChange({model:b,group:b.selectedGroupIndex,end:function(){c._compoundChange=null}})}},endUndo:function(){this.undoStack&&
this.undoStack.endCompoundChange()},isActive:function(){return!!this.linkedModeModel},isStatusActive:function(){return!!this.linkedModeModel},selectLinkedGroup:function(e){var b=this.linkedModeModel;if(b){b.selectedGroupIndex=e;e=b.groups[e];var a=e.positions[0],d=this.editor;d.setSelection(a.offset,a.offset+a.length);if(b=this.contentAssist)b.offset=void 0,e.data&&"link"===e.data.type&&e.data.values?((this._groupContentAssistProvider=new c.TemplateContentAssist(e.data.values)).getPrefix=function(){var b=
d.getSelection();return b.start===b.end&&(b=d.getCaretOffset(),a.offset<=b&&b<=a.offset+a.length)?d.getText(a.offset,b):""},b.offset=a.offset,b.deactivate(),b.activate()):this._groupContentAssistProvider&&(this._groupContentAssistProvider=null,b.deactivate())}this._updateAnnotations()},_getModelPositions:function(c,b,a){for(var d=b.groups,e=0;e<d.length;e++)for(var f=d[e].positions,m=0;m<f.length;m++){var g=f[m];a&&(g={offset:g.offset+a,length:g.length});g={index:m,group:e,count:f.length,model:b,
position:g};c.push(g);b.nextModel&&b.nextModel.parentGroup===e&&(g.ansestor=!0,this._getModelPositions(c,b.nextModel,(a||0)+f[m].offset-f[0].offset))}},_getSortedPositions:function(c){var b=this._sortedPositions;if(!b){for(b=[];c.previousModel;)c=c.previousModel;for(this._getModelPositions(b,c);c;)void 0!==c.escapePosition&&b.push({escape:!0,model:c,position:{offset:c.escapePosition,length:0}}),c=c.nextModel;b.sort(function(a,b){return a.position.offset-b.position.offset});this._sortedPositions=b}return b},
_getPositionChanged:function(c,b,a){var d;c=this._getSortedPositions(c);for(var e=c.length-1;0<=e;e--){var f=c[e].position;if(f.offset<=b&&a<=f.offset+f.length){d=c[e];break}}return{position:d,positions:c}},_updateAnnotations:function(c){var b=this.editor.getAnnotationModel();if(b){var a=[],d=[];b.getTextModel();for(var e=b.getAnnotations(),f;e.hasNext();)switch(f=e.next(),f.type){case g.AnnotationType.ANNOTATION_LINKED_GROUP:case g.AnnotationType.ANNOTATION_CURRENT_LINKED_GROUP:case g.AnnotationType.ANNOTATION_SELECTED_LINKED_GROUP:a.push(f)}if(e=
this.linkedModeModel){c=c||this._getSortedPositions(e);for(var m=0;m<c.length;m++)if(f=c[m],f.model===e){var p=g.AnnotationType.ANNOTATION_LINKED_GROUP;f.group===e.selectedGroupIndex&&(p=0===f.index?g.AnnotationType.ANNOTATION_SELECTED_LINKED_GROUP:g.AnnotationType.ANNOTATION_CURRENT_LINKED_GROUP);f=f.position;f=g.AnnotationType.createAnnotation(p,f.offset,f.offset+f.length,"");d.push(f)}}b.replaceAnnotations(a,d)}}});p.LinkedMode=f;return p});
define("orion/editor/factories","orion/editor/actions orion/editor/undoStack orion/editor/rulers orion/editor/annotations orion/editor/textDND orion/editor/linkedMode".split(" "),function(n,q,s,g,c,e){function f(){}function p(){}function h(){}function b(){}function a(){}function d(){}var k={};f.prototype={createKeyBindings:function(a,b,d,c){c=new n.TextActions(a,b,c);var f=new e.LinkedMode(a,b,d);a=new n.SourceCodeActions(a,b,d,f);return{textActions:c,linkedMode:f,sourceCodeActions:a}}};k.KeyBindingsFactory=
f;p.prototype={createUndoStack:function(a){a=a.getTextView();return new q.UndoStack(a,200)}};k.UndoFactory=p;h.prototype={createLineNumberRuler:function(a){return new s.LineNumberRuler(a,"left",{styleClass:"ruler lines"},{styleClass:"rulerLines odd"},{styleClass:"rulerLines even"})}};k.LineNumberRulerFactory=h;b.prototype={createFoldingRuler:function(a){return new s.FoldingRuler(a,"left",{styleClass:"ruler folding"})}};k.FoldingRulerFactory=b;a.prototype={createAnnotationModel:function(a){return new g.AnnotationModel(a)},
createAnnotationStyler:function(a,b){return new g.AnnotationStyler(a,b)},createAnnotationRulers:function(a){var b=new s.AnnotationRuler(a,"left",{styleClass:"ruler annotations"});a=new s.OverviewRuler(a,"right",{styleClass:"ruler overview"});return{annotationRuler:b,overviewRuler:a}}};k.AnnotationFactory=a;d.prototype={createTextDND:function(a,b){return new c.TextDND(a.getTextView(),b)}};k.TextDNDFactory=d;return k});
define("orion/editor/editorFeatures",["orion/editor/factories","orion/editor/actions","orion/editor/linkedMode","orion/objects"],function(n,q,s,g){return g.mixin({},n,q,s)});
(function(n,q){"function"===typeof define&&define.amd?define("orion/Deferred",q):"object"===typeof exports?module.exports=q():(n.orion=n.orion||{},n.orion.Deferred=q())})(this,function(){function n(){for(var f;f=c.shift();)f();e=!1}function q(g){c.push(g);e||(e=!0,f())}function s(c){return function(e){c(e)}}function g(){function c(){for(var a;a=n.shift();){var b=a.deferred,e="fulfilled"===f?"resolve":"reject";a=a[e];if("function"===typeof a)try{var m=a(d),h=m&&("object"===typeof m||"function"===typeof m)&&
m.then;if("function"===typeof h)if(m===b.promise)b.reject(new TypeError);else{var g=m.cancel;"function"===typeof g?b._parentCancel=g.bind(m):delete b._parentCancel;h.call(m,s(b.resolve),s(b.reject),s(b.progress))}else b.resolve(m)}catch(p){b.reject(p)}else b[e](d)}}function e(a){delete m._parentCancel;f="rejected";d=a;n.length&&q(c)}function b(a){function t(a){return function(b){(!f||"assumed"===f)&&a(b)}}delete m._parentCancel;try{var u=a&&("object"===typeof a||"function"===typeof a)&&a.then;if("function"===
typeof u)if(a===m)e(new TypeError);else{f="assumed";var s=a&&a.cancel;if("function"!==typeof s){var A=new g;a=A.promise;try{u(A.resolve,A.reject,A.progress)}catch(w){A.reject(w)}s=a.cancel;u=a.then}d=a;u.call(a,t(b),t(e));m._parentCancel=s.bind(a)}else f="fulfilled",d=a,n.length&&q(c)}catch(B){t(e)(B)}}function a(){var a=m._parentCancel;a?(delete m._parentCancel,a()):f||(a=Error("Cancel"),a.name="Cancel",e(a))}var d,f,n=[],m=this;this.resolve=function(a){f||b(a);return m};this.reject=function(a){f||
e(a);return m};this.progress=function(a){f||n.forEach(function(b){if(b.progress)try{b.progress(a)}catch(d){}});return m.promise};this.cancel=function(){m._parentCancel?setTimeout(a,0):a();return m};this.then=function(a,b,d){var e=new g;e._parentCancel=m.promise.cancel;n.push({resolve:a,reject:b,progress:d,deferred:e});("fulfilled"===f||"rejected"===f)&&q(c);return e.promise};this.promise={then:m.then,cancel:m.cancel}}var c=[],e=!1,f=function(){if("undefined"!==typeof process&&"function"===typeof process.nextTick){var c=
process.nextTick;return function(){c(n)}}if("function"===typeof MutationObserver){var e=document.createElement("div");(new MutationObserver(n)).observe(e,{attributes:!0});return function(){e.setAttribute("class","_tick")}}return function(){setTimeout(n,0)}}();g.all=function(c,e){function b(a,b){n||(f[a]=b,0===--d&&m.resolve(f))}function a(a,d){if(!n){if(e)try{b(a,e(d));return}catch(c){d=c}m.reject(d)}}var d=c.length,f=[],n=!1,m=new g;m.then(void 0,function(){n=!0;c.forEach(function(a){a.cancel&&a.cancel()})});
0===d?m.resolve(f):c.forEach(function(d,c){d.then(b.bind(void 0,c),a.bind(void 0,c))});return m.promise};g.when=function(c,e,b,a){var d;c&&"function"===typeof c.then||(d=new g,d.resolve(c),c=d.promise);return c.then(e,b,a)};return g});
define("orion/webui/littlelib",["orion/util"],function(n){function q(c,b){b||(b=document);return b.querySelectorAll(c)}function s(c){var b=c.tabIndex;0===b&&n.isIE&&!{a:!0,body:!0,button:!0,frame:!0,iframe:!0,img:!0,input:!0,isindex:!0,object:!0,select:!0,textarea:!0}[c.nodeName.toLowerCase()]&&!c.attributes.tabIndex&&(b=-1);return b}function g(c){if(0<=s(c))return c;if(c.hasChildNodes())for(var b=0;b<c.childNodes.length;b++){var a=g(c.childNodes[b]);if(a)return a}return null}function c(e){if(0<=
s(e))return e;if(e.hasChildNodes())for(var b=e.childNodes.length-1;0<=b;b--){var a=c(e.childNodes[b]);if(a)return a}return null}function e(c,b){if(3===c.nodeType){var a=f.exec(c.nodeValue);a&&1<a.length&&b(c,a)}if(c.hasChildNodes())for(a=0;a<c.childNodes.length;a++)e(c.childNodes[a],b)}var f=/\$\{([^\}]+)\}/,p=null;return{$:function(c,b){b||(b=document);return b.querySelector(c)},$$:q,$$array:function(c,b){return Array.prototype.slice.call(q(c,b))},node:function(c){var b=c;"string"===typeof c&&(b=
document.getElementById(c));return b},contains:function(c,b){if(!c||!b)return!1;if(c===b)return!0;var a=c.compareDocumentPosition(b);return Boolean(a&16)},bounds:function(c){c=c.getBoundingClientRect();return{left:c.left+document.documentElement.scrollLeft,top:c.top+document.documentElement.scrollTop,width:c.width,height:c.height}},empty:function(c){for(;c.hasChildNodes();)c.removeChild(c.firstChild)},firstTabbable:g,lastTabbable:c,stop:function(c){window.document.all&&(c.keyCode=0);c.preventDefault&&
(c.preventDefault(),c.stopPropagation())},processTextNodes:function(c,b){e(c,function(a,d){a.parentNode.replaceChild(document.createTextNode(b[d[1]]||d[1]),a)})},processDOMNodes:function(c,b){e(c,function(a,d){var c=b[d[1]];if(c){var e=document.createRange(),f=d.index;e.setStart(a,f);e.setEnd(a,f+d[0].length);e.deleteContents();e.insertNode(c)}})},addAutoDismiss:function(c,b){function a(a){p.forEach(function(b){var c=!1,e=b.excludeNodes.some(function(b){return document.body.contains(b)?(c=!0,b.contains(a.target)):
!1});if(c&&!e)try{b.dismiss(a)}catch(f){"undefined"!==typeof console&&console&&console.error(f&&f.message)}});p=p.filter(function(a){return a.excludeNodes.some(function(a){return document.body.contains(a)})})}null===p&&(p=[],document.addEventListener("click",a,!0),n.isIOS&&document.addEventListener("touchend",function(a){function b(){a.target.removeEventListener("click",b)}0===a.touches.length&&a.target.addEventListener("click",b)},!1));p.push({excludeNodes:c,dismiss:b})},setFramesEnabled:function(c){for(var b=
document.getElementsByTagName("iframe"),a=0;a<b.length;a++)b[a].parentNode.style.pointerEvents=c?"":"none"},removeAutoDismiss:function(c){p=p.filter(function(b){return c!==b.dismiss})},KEY:{BKSPC:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DEL:46}}});
define("orion/editor/contentAssist","i18n!orion/editor/nls/messages orion/keyBinding orion/editor/keyModes orion/editor/eventTarget orion/Deferred orion/objects orion/editor/util orion/util orion/webui/littlelib".split(" "),function(n,q,s,g,c,e,f,p,h){function b(a){this.textView=a;this.state=k.INACTIVE;this.resetProviderInfoArray();var b=this;this.contentAssistListener={onModelChanging:function(a){this._latestModelChangingEvent=a}.bind(this),onSelection:function(a){this.isDeactivatingChange(this._latestModelChangingEvent,
a)?this.setState(k.INACTIVE):this.isActive()&&(this.state===k.ACTIVE&&this.setState(k.FILTERING),this.filterProposals(a));this._latestModelChangingEvent=null}.bind(this),onScroll:function(a){this.setState(k.INACTIVE)}.bind(this)};a.setKeyBinding(p.isMac?new q.KeyBinding(" ",!1,!1,!1,!0):new q.KeyBinding(" ",!0),"contentAssist");a.setKeyBinding(p.isMac?new q.KeyBinding(" ",!1,!1,!0,!0):new q.KeyBinding(" ",!0,!1,!0),"contentAssist");a.setAction("contentAssist",function(){a.getOptions("readonly")||
b.activate();return!0},{name:n.contentAssist})}function a(a,b){var d=a.textView;s.KeyMode.call(this,d);this.contentAssist=a;this.widget=b;this.proposals=[];var c=this;this.contentAssist.addEventListener("ProposalsComputed",function(a){c.proposals=a.data.proposals;if(0===c.proposals.length)c.selectedIndex=-1,c.cancel();else{for(c.selectedIndex=0;c.proposals[c.selectedIndex]&&c.proposals[c.selectedIndex].unselectable;)c.selectedIndex++;if(c.proposals[c.selectedIndex]){if(c.widget){var b=!0;if(a.autoApply){for(a=
c.selectedIndex+1;c.proposals[a]&&c.proposals[a].unselectable;)a++;c.proposals[a]||(b=!1,c.contentAssist.apply(c.proposals[c.selectedIndex]))}b&&(c.widget.show(),c.widget.selectNode(c.selectedIndex))}}else c.selectedIndex=-1,c.cancel()}});d.setAction("contentAssistApply",function(){return this.enter()}.bind(this));d.setAction("contentAssistCancel",function(){return this.cancel()}.bind(this));d.setAction("contentAssistNextProposal",function(){return this.lineDown()}.bind(this));d.setAction("contentAssistPreviousProposal",
function(){return this.lineUp()}.bind(this));d.setAction("contentAssistNextPage",function(){return this.pageDown()}.bind(this));d.setAction("contentAssistPreviousPage",function(){return this.pageUp()}.bind(this));d.setAction("contentAssistHome",function(){this.widget&&this.widget.scrollIndex(0,!0);return this.lineDown(0)}.bind(this));d.setAction("contentAssistEnd",function(){return this.lineUp(this.proposals.length-1)}.bind(this));d.setAction("contentAssistTab",function(){return this.tab()}.bind(this));
this.widget&&(this.widget.setContentAssistMode(this),this.widget.createAccessible())}function d(a,b){this.contentAssist=a;this.textView=this.contentAssist.getTextView();this.isShowing=this.textViewListenerAdded=!1;var d=this.textView.getOptions("parent").ownerDocument;this.parentNode="string"===typeof b?d.getElementById(b):b;if(!this.parentNode){this.parentNode=p.createElement(d,"div");this.parentNode.className="contentassist";var c=d.getElementsByTagName("body")[0];if(c)c.appendChild(this.parentNode);
else throw Error("parentNode is required");}this.parentNode.addEventListener("scroll",this.onScroll.bind(this));var e=this;this.textViewListener={onMouseDown:function(a){(a.event.target||a.event.srcElement).parentElement!==e.parentNode&&e.contentAssist.deactivate()}};this.contentAssist.addEventListener("Deactivating",function(a){e.hide()});this.scrollListener=function(a){e.isShowing&&e.position()};f.addEventListener(d,"scroll",this.scrollListener)}var k={INACTIVE:1,ACTIVE:2,FILTERING:3},r={selected:"selected",
hr:"proposal-hr",emphasis:"proposal-emphasis",noemphasis:"proposal-noemphasis",noemphasis_keyword:"proposal-noemphasis-keyword",noemphasis_title:"proposal-noemphasis-title",noemphasis_title_keywords:"proposal-noemphasis-title-keywords",dfault:"proposal-default"};b.prototype={apply:function(a){if(!a)return!1;var b=this.textView,d=b.getSelection(),c=this._initialCaretOffset,e=c,f=d=Math.max(d.start,d.end),g=b.getModel();g.getBaseModel&&(e=g.mapOffset(e),f=g.mapOffset(f),g=g.getBaseModel());a.overwrite&&
(c=this.getPrefixStart(g,e));e={proposal:a,start:e,end:f};this.setState(k.INACTIVE);b.setText("string"===typeof a?a:a.proposal,c,d);this.dispatchEvent({type:"ProposalApplied",data:e});return!0},activate:function(a,b){this.state===k.INACTIVE&&(this._autoTriggered=b?!0:!1,this.setState(k.ACTIVE,a))},deactivate:function(){this.setState(k.INACTIVE)},getTextView:function(){return this.textView},isActive:function(){return this.state===k.ACTIVE||this.state===k.FILTERING},isDeactivatingChange:function(a,
b){var d=!1;b.newValue.start<this._initialCaretOffset?d=!0:a&&(d=0<a.removedLineCount||0<a.addedLineCount);return d},setState:function(a,b){var d;a===k.ACTIVE?(this._filterText="",d="Activating",this._mode&&this._mode.setActive(!0)):a===k.INACTIVE&&(d="Deactivating",this._mode&&this._mode.setActive(!1),this._initialCaretOffset=-1,this._filterText="");d&&this.dispatchEvent({type:d,providerInfoArray:b});this.state=a;this.onStateChange(a)},setMode:function(a){this._mode=a},onStateChange:function(a){a===
k.INACTIVE?this.listenerAdded&&(this._latestModelChangingEvent=null,this.textView.removeEventListener("ModelChanging",this.contentAssistListener.onModelChanging),this.textView.removeEventListener("Scroll",this.contentAssistListener.onScroll),this.textView.removeEventListener("Selection",this.contentAssistListener.onSelection),this.listenerAdded=!1):a===k.ACTIVE&&(this.listenerAdded||(this.textView.addEventListener("ModelChanging",this.contentAssistListener.onModelChanging),this.textView.addEventListener("Scroll",
this.contentAssistListener.onScroll),this.textView.addEventListener("Selection",this.contentAssistListener.onSelection),this.listenerAdded=!0),this.computeProposals())},computeProposals:function(){var a=this,b=this.textView.getCaretOffset(),d=this.textView.getSelection(),d=Math.min(d.start,d.end);this._initialCaretOffset=Math.min(b,d);this._computeProposals(this._initialCaretOffset).then(function(b){a._computedProposals=b;a.isActive()&&(b=a._flatten(b),a.dispatchEvent({type:"ProposalsComputed",data:{proposals:b},
autoApply:!a._autoTriggered}))})},getPrefixStart:function(a,b){for(var d=b;0<d&&/[A-Za-z0-9_]/.test(a.getText(d-1,d));)d--;return d},handleError:function(a){"undefined"!==typeof console&&(console.log("Error retrieving content assist proposals"),console.log(a&&a.stack))},_computeProposals:function(a){var b=this._providerInfoArray,d=this.textView,f=d.getSelection(),k=d.getModel(),g=a;k.getBaseModel&&(g=k.mapOffset(g),f.start=k.mapOffset(f.start),f.end=k.mapOffset(f.end),k=k.getBaseModel());a=k.getLine(k.getLineAtOffset(g));
for(var h=0;h<a.length&&/\s/.test(a.charAt(h));)h++;var h=a.substring(0,h),d=d.getOptions("tabSize","expandTab"),d=d.expandTab?Array(d.tabSize+1).join(" "):"\t",p={line:a,offset:g,prefix:k.getText(this.getPrefixStart(k,g),g),selection:f,delimiter:k.getLineDelimiter(),tab:d,indentation:h},l=this,b=b.map(function(a){a=a.provider;var b;try{var d,f;if(d=a.computeContentAssist){var m=l.editorContextProvider,h=m.getEditorContext();p=e.mixin(p,m.getOptions());f=d.apply(a,[h,p])}else if(d=a.getProposals||
a.computeProposals)f=d.apply(a,[k.getText(),g,p]);b=l.progress?l.progress.progress(f,"Generating content assist proposal"):f}catch(n){l.handleError(n)}return c.when(b)});return c.all(b,this.handleError)},filterProposals:function(a){a="";var b=0;if(this._latestModelChangingEvent){a=this._latestModelChangingEvent.text;if(b=this._latestModelChangingEvent.removedCharCount)this._filterText=this._filterText.substring(0,this._filterText.length-b);a&&(this._filterText=this._filterText.concat(a));a=this.textView.getModel();
a.getBaseModel&&(a=a.getBaseModel());a=this.getPrefixStart(a,this._initialCaretOffset);var d=this.textView.getText(a,this._initialCaretOffset),c=[];this._computedProposals.forEach(function(a){a=a.filter(function(a){if(r[a.style]===r.hr||r[a.style]===r.noemphasis_title)return!0;var b="";if(a.overwrite){if(a.name)b=a.name;else if(a.proposal)b=a.proposal;else return!1;return 0===b.indexOf(d+this._filterText)}return a.name||a.proposal?(b=!1,a.name&&(b=0===a.name.indexOf(d+this._filterText)),!b&&a.proposal&&
(b=0===a.proposal.indexOf(this._filterText)),b):"string"===typeof a?0===a.indexOf(this._filterText):!1},this);0<a.length&&c.push(a)},this);c=this._removeExtraUnselectableElements(c);a=this._flatten(c);this.dispatchEvent({type:"ProposalsComputed",data:{proposals:a},autoApply:!1})}},_removeExtraUnselectableElements:function(a){return a.map(function(a){return a.filter(function(b,d){var c=!0;if(r[b.style]===r.hr)0===d||a.length-1===d?c=!1:r.hr===r[a[d-1].style]&&(c=!1);else if(r[b.style]===r.noemphasis_title){var e=
a[d+1];e?r[e.style]===r.noemphasis_title&&(c=!1):c=!1}return c})})},setEditorContextProvider:function(a){this.editorContextProvider=a},_generateProviderId:function(){this._uniqueProviderIdCounter?this._uniqueProviderIdCounter++:this._uniqueProviderIdCounter=0;return"ContentAssistGeneratedID_"+this._uniqueProviderIdCounter},setAutoTriggerEnabled:function(a){this._autoTriggerEnabled=a;this._updateAutoTriggerListenerState()},setProviders:function(a){a=a.map(function(a){return{provider:a,id:this._generateProviderId()}},
this);this.setProviderInfoArray(a)},setProviderInfoArray:function(a){this.resetProviderInfoArray();this._providerInfoArray=a;this._charTriggersInstalled=a.some(function(a){return a.charTriggers});this._updateAutoTriggerListenerState()},resetProviderInfoArray:function(){this._providerInfoArray=[];this._charTriggersInstalled=!1;this._updateAutoTriggerListenerState()},setProgress:function(a){this.progress=a},setStyleAccessor:function(a){this._styleAccessor=a},_flatten:function(a){return a.reduce(function(a,
b){var d=a;if(Array.isArray(b)&&0<b.length){var d=b,c=a;b[0].style&&0===r[b[0].style].indexOf(r.noemphasis)&&(d=a,c=b);0<d.length&&d[d.length-1].style&&r.hr!==r[d[d.length-1].style]&&(d=d.concat({proposal:"",name:"",description:"---------------------------------",style:"hr",unselectable:!0}));d=d.concat(c)}return d},[])},_triggerListener:function(a){if(this._styleAccessor){var b=this.textView.getCaretOffset(),d=null,c=[];if(this._charTriggersInstalled){var e=this.textView.getText(b-1,b);this._providerInfoArray.forEach(function(a){var f=
a.charTriggers;if(f&&f.test(e)){var f=!1,k=a.excludedStyles;k&&(d||(d=this._styleAccessor.getStyles(b-1)),f=d.some(function(a){return k.test(a.style)}));f||c.push(a)}},this);0<c.length&&this.activate(c,!0)}}},_updateAutoTriggerListenerState:function(){this._boundTriggerListener||(this._boundTriggerListener=this._triggerListener.bind(this));if(this._triggerListenerInstalled){if(!this._autoTriggerEnabled||!this._charTriggersInstalled)this.textView.removeEventListener("Modify",this._boundTriggerListener),
this._triggerListenerInstalled=!1}else this._autoTriggerEnabled&&this._charTriggersInstalled&&(this.textView.addEventListener("Modify",this._boundTriggerListener),this._triggerListenerInstalled=!0)}};g.EventTarget.addMixin(b.prototype);a.prototype=new s.KeyMode;e.mixin(a.prototype,{createKeyBindings:function(){var a=q.KeyBinding,b=[];b.push({actionID:"contentAssistApply",keyBinding:new a(13)});b.push({actionID:"contentAssistCancel",keyBinding:new a(27)});b.push({actionID:"contentAssistNextProposal",
keyBinding:new a(40)});b.push({actionID:"contentAssistPreviousProposal",keyBinding:new a(38)});b.push({actionID:"contentAssistNextPage",keyBinding:new a(34)});b.push({actionID:"contentAssistPreviousPage",keyBinding:new a(33)});b.push({actionID:"contentAssistHome",keyBinding:new a(h.KEY.HOME)});b.push({actionID:"contentAssistEnd",keyBinding:new a(h.KEY.END)});b.push({actionID:"contentAssistTab",keyBinding:new a(9)});return b},cancel:function(){this.getContentAssist().deactivate()},getContentAssist:function(){return this.contentAssist},
getProposals:function(){return this.proposals},isActive:function(){return this.getContentAssist().isActive()},setActive:function(a){a?this.contentAssist.textView.addKeyMode(this):this.contentAssist.textView.removeKeyMode(this)},lineUp:function(a,b){return this.selectNew(a,b,!1)},lineDown:function(a,b){return this.selectNew(a,b,!0)},selectNew:function(a,b,d){if(d){if(void 0===a&&(a=this.selectedIndex+1),a>=this.proposals.length){if(b)return!0;a=0}}else if(void 0===a&&(a=this.selectedIndex-1),0>a){if(b)return!0;
a=this.proposals.length-1}for(var c=a;this.proposals[a]&&this.proposals[a].unselectable;){if(d){if(a++,a>=this.proposals.length){if(b)return!0;a=0}}else if(a--,0>a){if(b)return!0;a=this.proposals.length-1}if(a===c){a=-1;break}}this.selectedIndex=a;this.widget&&this.widget.selectNode(a);return!0},pageUp:function(){if(this.widget){var a=this.widget.getTopIndex();a===this.selectedIndex&&(this.widget.scrollIndex(a,!1),a=this.widget.getTopIndex());return 0===a?this.lineDown(a,!0):this.lineUp(a,!0)}return this.lineUp()},
pageDown:function(){if(this.widget){var a=this.widget.getBottomIndex();a===this.selectedIndex&&(this.widget.scrollIndex(a,!0),a=this.widget.getBottomIndex());return this.lineDown(a,!0)}return this.lineDown()},enter:function(){return this.contentAssist.apply(this.proposals[this.selectedIndex]||null)},tab:function(){return this.widget?(this.widget.parentNode.focus(),!0):!1}});d.prototype={onClick:function(a){a||(a=window.event);this.contentAssist.apply(this.getProposal(a.target||a.srcElement));this.textView.focus()},
onScroll:function(a){this.previousCloneNode&&!this.preserveCloneThroughScroll&&(this._removeCloneNode(),this.previousSelectedNode.classList.add(r.selected));this.preserveCloneThroughScroll=!1},createDiv:function(a,b,d){var c=b.ownerDocument,e=p.createElement(c,"div");e.id="contentoption"+d;e.setAttribute("role","option");e.className=r[a.style]?r[a.style]:r.dfault;"hr"===a.style?a=p.createElement(c,"hr"):(a=this._createDisplayNode(e,a,d),e.contentAssistProposalIndex=d);e.appendChild(a);b.appendChild(e)},
createAccessible:function(){var a=this._contentAssistMode,b=this;this.parentNode.addEventListener("keydown",function(d){d||(d=window.event);d.preventDefault&&d.preventDefault();return d.keyCode===h.KEY.ESCAPE?a.cancel():d.keyCode===h.KEY.UP?a.lineUp():d.keyCode===h.KEY.DOWN?a.lineDown():d.keyCode===h.KEY.ENTER?a.enter():d.keyCode===h.KEY.PAGEDOWN?a.pageDown():d.keyCode===h.KEY.PAGEUP?a.pageUp():d.keyCode===h.KEY.HOME?(b.scrollIndex(0,!0),a.lineDown(0)):d.keyCode===h.KEY.END?a.lineUp(a.getProposals().length-
1):!1})},_createDisplayNode:function(a,b,d){var c=null,e=null;if("string"===typeof b)e=b;else if(b.description&&"string"===typeof b.description)if(b.name&&"string"===typeof b.name){var f=this._createNameNode(b.name);f.contentAssistProposalIndex=d;c=document.createElement("span");c.appendChild(f);f=document.createTextNode(b.description);c.appendChild(f);a.setAttribute("title",b.name+b.description)}else e=b.description;else e=b.proposal;e&&(c=this._createNameNode(e),a.setAttribute("title",e));c.contentAssistProposalIndex=
d;return c},_createNameNode:function(a){var b=document.createElement("span");b.classList.add("proposal-name");b.appendChild(document.createTextNode(a));return b},getProposal:function(a){var b=null;a=a.contentAssistProposalIndex;void 0!==a&&(b=this._contentAssistMode.getProposals()[a]||null);return b},getTopIndex:function(){for(var a=this.parentNode.childNodes,b=0;b<a.length;b++)if(a[b].offsetTop>=this.parentNode.scrollTop)return b;return 0},getBottomIndex:function(){for(var a=this.parentNode.childNodes,
b=0;b<a.length;b++){var d=a[b];if(d.offsetTop+d.offsetHeight>this.parentNode.scrollTop+this.parentNode.clientHeight)return Math.max(0,b-1)}return a.length-1},scrollIndex:function(a,b){this.parentNode.childNodes[a].scrollIntoView(b);this.preserveCloneThroughScroll=!0},selectNode:function(a){var b=null;this.previousSelectedNode&&(this.previousSelectedNode.classList.remove(r.selected),this.previousSelectedNode=null,this.previousCloneNode&&this._removeCloneNode());if(-1!==a){b=this.parentNode.childNodes[a];
b.classList.add(r.selected);this.parentNode.setAttribute("aria-activedescendant",b.id);b.focus();b.offsetTop<this.parentNode.scrollTop?(b.scrollIntoView(!0),this.preserveCloneThroughScroll=!0):b.offsetTop+b.offsetHeight>this.parentNode.scrollTop+this.parentNode.clientHeight&&(b.scrollIntoView(!1),this.preserveCloneThroughScroll=!0);var d=h.bounds(b.firstChild||b),c=h.bounds(this.parentNode);a=window.getComputedStyle(this.parentNode);var e=window.getComputedStyle(b),e=parseInt(a.paddingLeft)+parseInt(a.paddingRight)+
parseInt(e.paddingLeft)+parseInt(e.paddingRight);if(d.width>=c.width-e){e=parseInt(a.top);c=b.cloneNode(!0);c.classList.add("cloneProposal");c.style.top=e+b.offsetTop-this.parentNode.scrollTop+"px";c.style.left=a.left;c.setAttribute("id",c.id+"_clone");d=d.left+d.width-parseInt(document.documentElement.clientWidth);0<d&&(a=parseInt(a.left)-d,0>a&&(a=0),c.style.left=a+"px");a=document.createElement("div");a.id="clone_contentassist";a.classList.add("contentassist");a.classList.add("cloneWrapper");a.appendChild(c);
a.onclick=this.parentNode.onclick;this.parentNode.parentNode.insertBefore(a,this.parentNode);var f=function(a){a.contentAssistProposalIndex=b.contentAssistProposalIndex;if(a.hasChildNodes())for(var d=0;d<a.childNodes.length;d++)f(a.childNodes[d])};f(a);b.classList.remove(r.selected);this.previousCloneNode=a}}this.previousSelectedNode=b},setContentAssistMode:function(a){this._contentAssistMode=a},show:function(){var a=this._contentAssistMode.getProposals();if(0===a.length)this.hide();else{this.parentNode.innerHTML=
"";for(var b=0;b<a.length;b++)this.createDiv(a[b],this.parentNode,b);this.position();this.parentNode.onclick=this.onClick.bind(this);this.isShowing=!0;this.textViewListenerAdded||(this.textView.addEventListener("MouseDown",this.textViewListener.onMouseDown),this.textViewListenerAdded=!0)}},hide:function(){this.parentNode.ownerDocument.activeElement===this.parentNode&&this.textView.focus();this.parentNode.style.display="none";this.parentNode.onclick=null;this.isShowing=!1;this.textViewListenerAdded&&
(this.textView.removeEventListener("MouseDown",this.textViewListener.onMouseDown),this.textViewListenerAdded=!1);this.previousSelectedNode&&(this.previousSelectedNode=null,this.previousCloneNode&&this._removeCloneNode())},position:function(){var a=this.contentAssist,b=this.textView;if(void 0!==a.offset){var a=a.offset,d=b.getModel();d.getBaseModel&&(a=d.mapOffset(a,!0))}else a=this.textView.getCaretOffset();a=b.getLocationAtOffset(a);a.y+=b.getLineHeight();this.textView.convert(a,"document","page");
this.parentNode.style.position="fixed";this.parentNode.style.left=a.x+"px";this.parentNode.style.top=a.y+"px";this.parentNode.style.display="block";this.parentNode.scrollTop=0;b=this.parentNode.ownerDocument;d=b.documentElement.clientWidth;a.y+this.parentNode.offsetHeight>b.documentElement.clientHeight&&(this.parentNode.style.top=a.y-this.parentNode.offsetHeight-this.textView.getLineHeight()+"px");a.x+this.parentNode.offsetWidth>d&&(this.parentNode.style.left=d-this.parentNode.offsetWidth+"px")},
_removeCloneNode:function(){this.parentNode.parentNode.contains(this.previousCloneNode)&&this.parentNode.parentNode.removeChild(this.previousCloneNode);this.previousCloneNode=null}};return{ContentAssist:b,ContentAssistMode:a,ContentAssistWidget:d}});
define("orion/editor/stylers/lib/syntax",[],function(){return{id:"orion.lib",grammars:[{id:"orion.lib",repository:{brace_open:{match:"{",name:"punctuation.section.block.begin"},brace_close:{match:"}",name:"punctuation.section.block.end"},bracket_open:{match:"\\[",name:"punctuation.section.bracket.begin"},bracket_close:{match:"\\]",name:"punctuation.section.bracket.end"},parenthesis_open:{match:"\\(",name:"punctuation.section.parens.begin"},parenthesis_close:{match:"\\)",name:"punctuation.section.parens.end"},
doc_block:{begin:{match:"/\\*\\*",literal:"/**"},end:{match:"\\*/",literal:"*/"},name:"comment.block.documentation",patterns:[{match:"@(?:(?!\\*/)\\S)*",name:"keyword.other.documentation.tag"},{match:"\\\x3c\\S*\\\x3e",name:"keyword.other.documentation.markup"},{match:"(\\b)(TODO)(\\b)(((?!\\*/).)*)",name:"meta.annotation.task.todo",captures:{2:{name:"keyword.other.documentation.task"},4:{name:"comment.block"}}}]},number_decimal:{match:"\\b-?(?:\\.\\d+|\\d+\\.?\\d*)(?:[eE][+-]?\\d+)?\\b",name:"constant.numeric.number"},
number_hex:{match:"\\b0[xX][0-9A-Fa-f]+\\b",name:"constant.numeric.hex"},string_doubleQuote:{match:'"(?:\\\\.|[^"])*"?',name:"string.quoted.double"},string_singleQuote:{match:"'(?:\\\\.|[^'])*'?",name:"string.quoted.single"},todo_comment_singleLine:{match:"(\\b)(TODO)(\\b)(.*)",name:"meta.annotation.task.todo",captures:{2:{name:"keyword.other.documentation.task"},4:{name:"comment.line"}}}}},{id:"orion.c-like",repository:{comment_singleLine:{match:{match:"//.*",literal:"//"},name:"comment.line.double-slash",
patterns:[{include:"orion.lib#todo_comment_singleLine"}]},comment_block:{begin:{match:"/\\*",literal:"/*"},end:{match:"\\*/",literal:"*/"},name:"comment.block",patterns:[{match:"(\\b)(TODO)(\\b)(((?!\\*/).)*)",name:"meta.annotation.task.todo",captures:{2:{name:"keyword.other.documentation.task"},4:{name:"comment.block"}}}]}}}],keywords:[]}});
define("orion/editor/stylers/text_css/syntax",["orion/editor/stylers/lib/syntax"],function(n){var q="alignment-adjust alignment-baseline animation-delay animation-direction animation-duration animation-iteration-count animation-name animation-play-state animation-timing-function animation appearance azimuth backface-visibility background-attachment background-clip background-color background-image background-origin background-position background-repeat background-size background baseline-shift binding bleed bookmark-label bookmark-level bookmark-state bookmark-target border-bottom-color border-bottom-left-radius border-bottom-right-radius border-bottom-style border-bottom-width border-bottom border-collapse border-color border-image-outset border-image-repeat border-image-slice border-image-source border-image-width border-image border-left-color border-left-style border-left-width border-left border-radius border-right-color border-right-style border-right-width border-right border-spacing border-style border-top-color border-top-left-radius border-top-right-radius border-top-style border-top-width border-top border-width border bottom box-align box-decoration-break box-direction box-flex-group box-flex box-lines box-ordinal-group box-orient box-pack box-shadow box-sizing break-after break-before break-inside caption-side clear clip color-profile color column-count column-fill column-gap column-rule-color column-rule-style column-rule-width column-rule column-span column-width columns content counter-increment counter-reset crop cue-after cue-before cue cursor direction display dominant-baseline drop-initial-after-adjust drop-initial-after-align drop-initial-before-adjust drop-initial-before-align drop-initial-size drop-initial-value elevation empty-cells fit-position fit flex-align flex-flow flex-inline-pack flex-order flex-pack float-offset float font-family font-size font-size-adjust font-stretch font-style font-variant font-weight font grid-columns grid-rows hanging-punctuation height hyphenate-after hyphenate-before hyphenate-character hyphenate-lines hyphenate-resource hyphens icon image-orientation image-rendering image-resolution inline-box-align left letter-spacing line-height line-stacking-ruby line-stacking-shift line-stacking-strategy line-stacking list-style-image list-style-position list-style-type list-style margin-bottom margin-left margin-right margin-top margin mark-after mark-before mark marker-offset marks marquee-direction marquee-loop marquee-play-count marquee-speed marquee-style max-height max-width min-height min-width move-to nav-down nav-index nav-left nav-right nav-up opacity orphans outline-color outline-offset outline-style outline-width outline overflow-style overflow-x overflow-y overflow padding-bottom padding-left padding-right padding-top padding page-break-after page-break-before page-break-inside page-policy page pause-after pause-before pause perspective-origin perspective phonemes pitch-range pitch play-during position presentation-level punctuation-trim quotes rendering-intent resize rest-after rest-before rest richness right rotation-point rotation ruby-align ruby-overhang ruby-position ruby-span size speak-header speak-numeral speak-punctuation speak speech-rate stress string-set table-layout target-name target-new target-position target text-align-last text-align text-decoration text-emphasis text-height text-indent text-justify text-outline text-shadow text-transform text-wrap top transform-origin transform-style transform transition-delay transition-duration transition-property transition-timing-function transition unicode-bidi vertical-align visibility voice-balance voice-duration voice-family voice-pitch-range voice-pitch voice-rate voice-stress voice-volume volume white-space-collapse white-space widows width word-break word-spacing word-wrap z-index".split(" ");n=
n.grammars;n.push({id:"orion.css",contentTypes:["text/css"],patterns:[{begin:"'(?:\\\\.|[^\\\\'])*\\\\$",end:"^(?:$|(?:\\\\.|[^\\\\'])*('|[^\\\\]$))",name:"string.quoted.single.css"},{begin:'"(?:\\\\.|[^\\\\"])*\\\\$',end:'^(?:$|(?:\\\\.|[^\\\\"])*("|[^\\\\]$))',name:"string.quoted.double.css"},{include:"orion.lib#string_doubleQuote"},{include:"orion.lib#string_singleQuote"},{include:"orion.c-like#comment_block"},{include:"orion.lib#brace_open"},{include:"orion.lib#brace_close"},{include:"orion.lib#bracket_open"},
{include:"orion.lib#bracket_close"},{include:"orion.lib#parenthesis_open"},{include:"orion.lib#parenthesis_close"},{include:"orion.lib#number_decimal"},{include:"#number_hex"},{match:"(?i)\\b-?(?:\\.\\d+|\\d+\\.?\\d*)(?:%|em|ex|ch|rem|vw|vh|vmin|vmax|in|cm|mm|pt|pc|px|deg|grad|rad|turn|s|ms|Hz|kHz|dpi|dpcm|dppx)?\\b",name:"constant.numeric.value.css"},{match:"(?:-webkit-|-moz-|-ms-|\\b)(?:"+q.join("|")+")\\b",name:"keyword.control.css"}],repository:{number_hex:{match:"#[0-9A-Fa-f]+\\b",name:"constant.numeric.hex.css"}}});
return{id:n[n.length-1].id,grammars:n,keywords:q}});
define("orion/editor/cssContentAssist",["orion/editor/templates","orion/editor/stylers/text_css/syntax"],function(n,q){function s(a){return JSON.stringify(a).replace("}","\\}")}function g(){}for(var c={type:"link",values:"visible hidden scroll auto no-display no-content".split(" ")},e={type:"link",values:"solid dashed dotted double groove ridge inset outset".split(" ")},f={type:"link",values:[]},p=0;10>p;p++)f.values.push(p.toString());for(var h={type:"link",values:"black white red green blue magenta yellow cyan grey darkred darkgreen darkblue darkmagenta darkcyan darkyellow darkgray lightgray".split(" ")},
b=[{prefix:"rule",description:"rule - class selector rule",template:".${class} {\n\t${cursor}\n}"},{prefix:"rule",description:"rule - id selector rule",template:"#${id} {\n\t${cursor}\n}"},{prefix:"outline",description:"outline - outline style",template:"outline: ${color:"+s(h)+"} ${style:"+s(e)+"} ${width:"+s(f)+"}px;"},{prefix:"background-image",description:"background-image - image style",template:'background-image: url("${uri}");'},{prefix:"url",description:"url - url image",template:'url("${uri}");'},
{prefix:"rgb",description:"rgb - rgb color",template:"rgb(${red},${green},${blue});"},{prefix:"@",description:"import - import style sheet",template:'@import "${uri}";'}],a=[{prop:"display",values:{type:"link",values:"none block box flex inline inline-block inline-flex inline-table list-item table table-caption table-cell table-column table-column-group table-footer-group table-header-group table-row table-row-group inherit".split(" ")}},{prop:"overflow",values:c},{prop:"overflow-x",values:c},{prop:"overflow-y",
values:c},{prop:"float",values:{type:"link",values:["left","right","none","inherit"]}},{prop:"position",values:{type:"link",values:["absolute","fixed","relative","static","inherit"]}},{prop:"cursor",values:{type:"link",values:"auto crosshair default e-resize help move n-resize ne-resize nw-resize pointer progress s-resize se-resize sw-resize text w-resize wait inherit".split(" ")}},{prop:"color",values:h},{prop:"border-top-color",values:h},{prop:"border-bottom-color",values:h},{prop:"border-right-color",
values:h},{prop:"border-left-color",values:h},{prop:"background-color",values:h},{prop:"font-style",values:{type:"link",values:["italic","normal","oblique","inherit"]}},{prop:"font-weight",values:{type:"link",values:"bold normal bolder lighter 100 200 300 400 500 600 700 800 900 inherit".split(" ")}},{prop:"white-space",values:{type:"link",values:"pre pre-line pre-wrap nowrap normal inherit".split(" ")}},{prop:"word-wrap",values:{type:"link",values:["normal","break-word"]}},{prop:"visibility",values:{type:"link",
values:["hidden","visible","collapse","inherit"]}}],p=0;p<a.length;p++)c=a[p],b.push({prefix:c.prop,description:c.prop+" - "+c.prop+" style",template:c.prop+": ${value:"+s(c.values)+"};"});a="width height top bottom left right min-width min-height max-width max-height margin padding padding-left padding-right padding-top padding-bottom margin-left margin-top margin-bottom margin-right".split(" ");for(p=0;p<a.length;p++)c=a[p],b.push({prefix:c,description:c+" - "+c+" pixel style",template:c+": ${value}px;"});
a=["padding","margin"];for(p=0;p<a.length;p++)c=a[p],b.push({prefix:c,description:c+" - "+c+" top right bottom left style",template:c+": ${top}px ${left}px ${bottom}px ${right}px;"}),b.push({prefix:c,description:c+" - "+c+" top right,left bottom style",template:c+": ${top}px ${right_left}px ${bottom}px;"}),b.push({prefix:c,description:c+" - "+c+" top,bottom right,left style",template:c+": ${top_bottom}px ${right_left}px"});a=["border","border-top","border-bottom","border-left","border-right"];for(p=
0;p<a.length;p++)c=a[p],b.push({prefix:c,description:c+" - "+c+" style",template:c+": ${width:"+s(f)+"}px ${style:"+s(e)+"} ${color:"+s(h)+"};"});g.prototype=new n.TemplateContentAssist(q.keywords,b);g.prototype.getPrefix=function(a,b,c){for(c=b;c&&/[A-Za-z\-\@]/.test(a.charAt(c-1));)c--;return c?a.substring(c,b):""};return{CssContentAssistProvider:g}});
define("orion/editor/htmlContentAssist",["orion/editor/templates"],function(n){function q(){}var s=new n.Template("","Simple HTML document",'\x3c!DOCTYPE html\x3e\n\x3chtml lang\x3d"en"\x3e\n\t\x3chead\x3e\n\t\t\x3cmeta charset\x3dutf-8\x3e\n\t\t\x3ctitle\x3e${title}\x3c/title\x3e\n\t\x3c/head\x3e\n\t\x3cbody\x3e\n\t\t\x3ch1\x3e${header}\x3c/h1\x3e\n\t\t\x3cp\x3e\n\t\t\t${cursor}\n\t\t\x3c/p\x3e\n\t\x3c/body\x3e\n\x3c/html\x3e'),g=[{prefix:"\x3cimg",name:"\x3cimg\x3e",description:" - HTML image element",
template:'\x3cimg src\x3d"${cursor}" alt\x3d"${Image}"/\x3e'},{prefix:"\x3ca",name:"\x3ca\x3e",description:" - HTML anchor element",template:'\x3ca href\x3d"${cursor}"\x3e\x3c/a\x3e'},{prefix:"\x3cul",name:"\x3cul\x3e",description:" - HTML unordered list",template:"\x3cul\x3e\n\t\x3cli\x3e${cursor}\x3c/li\x3e\n\x3c/ul\x3e"},{prefix:"\x3col",name:"\x3col\x3e",description:" - HTML ordered list",template:"\x3col\x3e\n\t\x3cli\x3e${cursor}\x3c/li\x3e\n\x3c/ol\x3e"},{prefix:"\x3cdl",name:"\x3cdl\x3e",
description:" - HTML definition list",template:"\x3cdl\x3e\n\t\x3cdt\x3e${cursor}\x3c/dt\x3e\n\t\x3cdd\x3e\x3c/dd\x3e\n\x3c/dl\x3e"},{prefix:"\x3ctable",name:"\x3ctable\x3e",description:" - basic HTML table",template:"\x3ctable\x3e\n\t\x3ctr\x3e\n\t\t\x3ctd\x3e${cursor}\x3c/td\x3e\n\t\x3c/tr\x3e\n\x3c/table\x3e"},{prefix:"\x3c!--",name:"\x3c!-- --\x3e",description:" - HTML comment",template:"\x3c!-- ${cursor} --\x3e"}],c,e,f,p,h="abbr b button canvas cite command dd del dfn dt em embed font h1 h2 h3 h4 h5 h6 i ins kbd label li mark meter object option output progress q rp rt samp small strong sub sup td time title tt u var".split(" ");
for(p=0;p<h.length;p++)c=h[p],f="\x3c"+c+"\x3e\x3c/"+c+"\x3e",e="\x3c"+c+"\x3e${cursor}\x3c/"+c+"\x3e",g.push({prefix:"\x3c"+c,description:f,template:e});h="address article aside audio bdo blockquote body caption code colgroup datalist details div fieldset figure footer form head header hgroup iframe legend map menu nav noframes noscript optgroup p pre ruby script section select span style tbody textarea tfoot th thead tr video".split(" ");for(p=0;p<h.length;p++)c=h[p],f="\x3c"+c+"\x3e\x3c/"+c+"\x3e",
e="\x3c"+c+"\x3e\n\t${cursor}\n\x3c/"+c+"\x3e",g.push({prefix:"\x3c"+c,description:f,template:e});h="area base br col hr input link meta param keygen source".split(" ");for(p=0;p<h.length;p++)c=h[p],e=f="\x3c"+c+"/\x3e",g.push({prefix:"\x3c"+c,description:f,template:e});q.prototype=new n.TemplateContentAssist([],g);q.prototype.getPrefix=function(b,a,d){d="";for(var c=a;c&&/[A-Za-z0-9<!-]/.test(b.charAt(c-1));)if(c--,"\x3c"===b.charAt(c)){d=b.substring(c,a);break}return d};q.prototype.computeProposals=
function(b,a,d){return 0===b.length?[s.getProposal("",a,d)]:n.TemplateContentAssist.prototype.computeProposals.call(this,b,a,d).sort(function(a,b){var d=a.prefix||a.proposal,c=b.prefix||b.proposal;if(d){if(!c)return 1}else return-1;return d.toLowerCase().localeCompare(c.toLowerCase())})};return{HTMLContentAssistProvider:q}});
define("orion/editor/stylers/application_javascript/syntax",["orion/editor/stylers/lib/syntax"],function(n){var q="break case class catch continue const debugger default delete do else enum export extends false finally for function if implements import in instanceof interface let new null package private protected public return static super switch this throw true try typeof undefined var void while with yield".split(" ");n=n.grammars;n.push({id:"orion.js",contentTypes:["application/javascript"],patterns:[{begin:"'(?:\\\\.|[^\\\\'])*\\\\$",
end:"^(?:$|(?:\\\\.|[^\\\\'])*('|[^\\\\]$))",name:"string.quoted.single.js"},{begin:'"(?:\\\\.|[^\\\\"])*\\\\$',end:'^(?:$|(?:\\\\.|[^\\\\"])*("|[^\\\\]$))',name:"string.quoted.double.js"},{include:"orion.lib#string_doubleQuote"},{include:"orion.lib#string_singleQuote"},{include:"orion.c-like#comment_singleLine"},{match:"/(?![\\s\\*])(?:\\\\.|[^/])+/(?:[gim]{0,3})",name:"string.regexp.js"},{include:"orion.lib#doc_block"},{include:"orion.c-like#comment_block"},{include:"orion.lib#brace_open"},{include:"orion.lib#brace_close"},
{include:"orion.lib#bracket_open"},{include:"orion.lib#bracket_close"},{include:"orion.lib#parenthesis_open"},{include:"orion.lib#parenthesis_close"},{include:"orion.lib#number_decimal"},{include:"orion.lib#number_hex"},{match:"\\b(?:"+q.join("|")+")\\b",name:"keyword.control.js"}]});return{id:n[n.length-1].id,grammars:n,keywords:q}});
define("orion/editor/jsTemplateContentAssist",["orion/editor/templates","orion/editor/stylers/application_javascript/syntax"],function(n,q){function s(){}var g=[{prefix:"if",name:"if",description:" - if statement",template:"if (${condition}) {\n\t${cursor}\n}"},{prefix:"if",name:"if",description:" - if else statement",template:"if (${condition}) {\n\t${cursor}\n} else {\n\t\n}"},{prefix:"for",name:"for",description:" - iterate over array",template:"for (var ${i}\x3d0; ${i}\x3c${array}.length; ${i}++) {\n\t${cursor}\n}"},
{prefix:"for",name:"for",description:" - iterate over array with local var",template:"for (var ${i}\x3d0; ${i}\x3c${array}.length; ${i}++) {\n\tvar ${value} \x3d ${array}[${i}];\n\t${cursor}\n}"},{prefix:"for",name:"for..in",description:" - iterate over properties of an object",template:"for (var ${property} in ${object}) {\n\tif (${object}.hasOwnProperty(${property})) {\n\t\t${cursor}\n\t}\n}"},{prefix:"while",name:"while",description:" - while loop with condition",template:"while (${condition}) {\n\t${cursor}\n}"},
{prefix:"do",name:"do",description:" - do while loop with condition",template:"do {\n\t${cursor}\n} while (${condition});"},{prefix:"switch",name:"switch",description:" - switch case statement",template:"switch (${expression}) {\n\tcase ${value1}:\n\t\t${cursor}\n\t\tbreak;\n\tdefault:\n}"},{prefix:"case",name:"case",description:" - case statement",template:"case ${value}:\n\t${cursor}\n\tbreak;"},{prefix:"try",name:"try",description:" - try..catch statement",template:"try {\n\t${cursor}\n} catch (${err}) {\n}"},
{prefix:"try",name:"try",description:" - try..catch statement with finally block",template:"try {\n\t${cursor}\n} catch (${err}) {\n} finally {\n}"},{prefix:"typeof",name:"typeof",description:" - typeof statement",template:'typeof ${object} \x3d\x3d\x3d "${type:'+JSON.stringify({type:"link",values:"undefined object boolean number string function xml".split(" ")}).replace("}","\\}")+'}"'},{prefix:"instanceof",name:"instanceof",description:" - instanceof statement",template:"${object} instanceof ${type}"},
{prefix:"with",name:"with",description:" - with statement",template:"with (${object}) {\n\t${cursor}\n}"},{prefix:"function",name:"function",description:" - function declaration",template:"/**\n * @name ${name}\n * @param ${parameter}\n */\nfunction ${name} (${parameter}) {\n\t${cursor}\n}"},{prefix:"function",name:"function",description:" - function expression",template:"/**\n * @name ${name}\n * @function\n * @param ${parameter}\n */\n${name}: function(${parameter}) {\n\t${cursor}\n}"},{prefix:"define",
name:"define",description:" - define function call",template:"/* global define */\ndefine('${name}',[\n'${import}'\n], function(${importname}) {\n\t${cursor}\n});"},{prefix:"nls",name:"nls",description:" - non NLS string",template:"${cursor} //$NON-NLS-${0}$"},{prefix:"log",name:"log",description:" - console log",template:"console.log(${object});"},{prefix:"mongodb",name:"mongodb",description:" - Node.js require statement for MongoDB",template:"var ${name} \x3d require('mongodb');\n"},{prefix:"mongodb",
name:"mongodb client",description:" - create a new MongoDB client",template:"var MongoClient \x3d require('mongodb').MongoClient;\nvar Server \x3d require('mongodb').Server;\n${cursor}"},{prefix:"mongodb",name:"mongodb open",description:" - create a new MongoDB client and open a connection",template:"var MongoClient \x3d require('mongodb').MongoClient;\nvar Server \x3d require('mongodb').Server;\nvar ${client} \x3d new MongoClient(new Server(${host}, ${port}));\ntry {\n\t${client}.open(function(error, ${client}) {\n\t\tvar ${db} \x3d ${client}.db(${name});\n\t\t${cursor}\n\t});\n} finally {\n\t${client}.close();\n};"},
{prefix:"mongodb",name:"mongodb connect",description:" - connect to an existing MongoDB database",template:"var MongoClient \x3d require('mongodb').MongoClient;\nMongoClient.connect(${url}, function(error, db) {\n\t${cursor}\n});\n"},{prefix:"mongodb",name:"mongodb connect (Cloud Foundry)",description:" - connect to an existing MongoDB database using Cloud Foundry",template:"if (${process}.env.VCAP_SERVICES) {\n\tvar env \x3d JSON.parse(${process}.env.VCAP_SERVICES);\n\tvar mongo \x3d env['${mongo-version}'][0].credentials;\n} else {\n\tvar mongo \x3d {\n\t\tusername : 'username',\n\t\tpassword : 'password',\n\t\turl : 'mongodb://username:password@localhost:27017/database'\n\t};\n}\nvar MongoClient \x3d require('mongodb').MongoClient;\nMongoClient.connect(mongo.url, function(error, db) {\n\t${cursor}\n});\n"},
{prefix:"mongodb",name:"mongodb collection",description:" - create a MongoDB database collection",template:"${db}.collection(${id}, function(${error}, collection) {\n\t${cursor}\n});"},{prefix:"mongodb",name:"mongodb strict collection",description:" - create a MongoDB database strict collection",template:"${db}.collection(${id}, {strict:true}, function(${error}, collection) {\n\t${cursor}\n});"},{prefix:"redis",name:"redis",description:" - Node.js require statement for Redis",template:"var ${name} \x3d require('redis');\n"},
{prefix:"redis",name:"redis client",description:" - create a new Redis client",template:"var ${name} \x3d require('redis');\nvar ${client} \x3d ${name}.createClient(${port}, ${host}, ${options});\n"},{prefix:"redis",name:"redis connect",description:" - create a new Redis client and connect",template:"var ${name} \x3d require('redis');\nvar ${client} \x3d ${name}.createClient(${port}, ${host}, ${options});\ntry {\n\t${cursor}\n} finally {\n\t${client}.close();\n}\n"},{prefix:"redis",name:"redis set",
description:" - create a new Redis client set call",template:"client.set(${key}, ${value});\n"},{prefix:"redis",name:"redis get",description:" - create a new Redis client get call",template:"client.get(${key}, function(${error}, ${reply}) {\n\t${cursor}\n});\n"},{prefix:"redis",name:"redis on",description:" - create a new Redis client event handler",template:"client.on(${event}, function(${arg}) {\n\t${cursor}});\n"},{prefix:"pg",name:"postgres",description:" - Node.js require statement for Postgres DB",
template:"var pg \x3d require('pg');\n"},{prefix:"pg",name:"postgres client",description:" - create a new Postgres DB client",template:"var pg \x3d require('pg');\nvar url \x3d \"postgres://postgres:${port}@${host}/${database}\";\nvar ${client} \x3d new pg.Client(url);\n"},{prefix:"pg",name:"postgres connect",description:" - create a new Postgres DB client and connect",template:"var pg \x3d require('pg');\nvar url \x3d \"postgres://postgres:${port}@${host}/${database}\";\nvar ${client} \x3d new pg.Client(url);\n${client}.connect(function(error) {\n\t${cursor}\n});\n"},
{prefix:"pg",name:"postgres query",description:" - create a new Postgres DB query statement",template:"${client}.query(${sql}, function(error, result) {\n\t${cursor}\n});\n"},{prefix:"mysql",name:"mysql",description:" - Node.js require statement for MySQL DB",template:"var mysql \x3d require('mysql');\n"},{prefix:"mysql",name:"mysql connection",description:" - create a new MySQL DB connection",template:"var mysql \x3d require('mysql');\nvar ${connection} \x3d mysql.createConnection({\n\thost : ${host},\n\tuser : ${username},\n\tpassword : ${password}\n});\ntry {\n\t${connection}.connect();\n\t${cursor}\n} finally {\n\t${connection}.end();\n}"},
{prefix:"mysql",name:"mysql query",description:" - create a new MySQL DB query statement",template:"${connection}.query(${sql}, function(error, rows, fields) {\n\t${cursor}\n});\n"},{prefix:"express",name:"express",description:" - Node.js require statement for Express",template:"var ${name} \x3d require('express');"},{prefix:"express",name:"express app",description:" - create a new Express app",template:"var express \x3d require('express');\nvar ${app} \x3d express();\n${cursor}\napp.listen(${timeout});\n"},
{prefix:"express",name:"express configure",description:" - create an Express app configure statement",template:"app.configure(function() {\n\tapp.set(${id}, ${value});\n});"},{prefix:"express",name:"express specific configure",description:" - create a specific Express app configure statement",template:"app.configure(${name}, function() {\n\tapp.set(${id}, ${value});\n});"},{prefix:"express",name:"express app get",description:" - create a new Express app.get call",template:"var value \x3d app.get(${id}, function(request, result){\n\t${cursor}\n});\n"},
{prefix:"express",name:"express app set",description:" - create a new Express app set call",template:"app.set(${id}, ${value});\n"},{prefix:"express",name:"express app use",description:" - create a new Express app use statement",template:"app.use(${fnOrObject});\n"},{prefix:"express",name:"express app engine",description:" - create a new Express app engine statement",template:"app.engine(${fnOrObject});\n"},{prefix:"express",name:"express app param",description:" - create a new Express app param statement",
template:"app.param(${id}, ${value});\n"},{prefix:"express",name:"express app error use",description:" - create a new Express app error handling use statement",template:"app.use(function(error, request, result, next) {\n\tresult.send(${code}, ${message});\n});\n"},{prefix:"amqp",name:"amqp",description:" - Node.js require statement for AMQP framework",template:"var amqp \x3d require('amqp');\n"},{prefix:"amqp",name:"amqp connection",description:" - create a new AMQP connection ",template:"var amqp \x3d require('amqp');\nvar ${connection} \x3d amqp.createConnection({\n\thost: ${host},\n\tport: ${port},\n\tlogin: ${login},\n\tpassword: ${password}\n});\n"},
{prefix:"amqp",name:"amqp on",description:" - create a new AMQP connection on statement",template:"${connection}.on(${event}, function() {\n\t${cursor}\n});\n"},{prefix:"amqp",name:"amqp queue",description:" - create a new AMQP connection queue statement",template:"${connection}.queue(${id}, function(queue) {\n\tqueue.bind('#'); //catch all messages\n\tqueue.subscribe(function (message, headers, deliveryInfo) {\n\t\t// Receive messages\n\t});\n\t${cursor}\n});\n"},{prefix:"amqp",name:"amqp exchange",
description:" - create a new AMQP connection exchange",template:"var exchange \x3d ${connection}.exchange(${id}, {type: 'topic'}, function(exchange) {\n\t${cursor}\n});\n"}];s.prototype=new n.TemplateContentAssist(q.keywords,g);s.prototype.isValid=function(c,e,f,g){c=e.charAt(f-c.length-1);return!c||-1===":!@#$^\x26*.?\x3c\x3e".indexOf(c)};return{JSTemplateContentAssistProvider:s}});
define("orion/editor/AsyncStyler",["i18n!orion/editor/nls/messages","orion/editor/annotations"],function(n,q){function s(e){return-1!==e.getProperty("objectClass").indexOf(c)&&"highlighter"===e.getProperty("type")}function g(c,e,g){this.initialize(c,e,g);this.lineStyles=[]}var c="orion.edit.highlighter",e=c+" service must be an event emitter";q.AnnotationType.registerType("orion.annotation.highlightError",{title:n.syntaxError,html:"\x3cdiv class\x3d'annotationHTML error'\x3e\x3c/div\x3e",rangeStyle:{styleClass:"annotationRange error"}});
g.prototype={initialize:function(e,g,h){this.textView=e;this.serviceRegistry=g;this.annotationModel=h;this.services=[];var b=this;this.listener={onModelChanging:function(a){b.onModelChanging(a)},onModelChanged:function(a){b.onModelChanged(a)},onDestroy:function(a){b.onDestroy(a)},onLineStyle:function(a){b.onLineStyle(a)},onStyleReady:function(a){b.onStyleReady(a)},onServiceAdded:function(a){b.onServiceAdded(a.serviceReference,b.serviceRegistry.getService(a.serviceReference))},onServiceRemoved:function(a){b.onServiceRemoved(a.serviceReference,
b.serviceRegistry.getService(a.serviceReference))}};e.addEventListener("ModelChanging",this.listener.onModelChanging);e.addEventListener("ModelChanged",this.listener.onModelChanged);e.addEventListener("Destroy",this.listener.onDestroy);e.addEventListener("LineStyle",this.listener.onLineStyle);g.addEventListener("registered",this.listener.onServiceAdded);g.addEventListener("unregistering",this.listener.onServiceRemoved);e=g.getServiceReferences(c);for(h=0;h<e.length;h++){var a=e[h];s(a)&&this.addServiceListener(g.getService(a))}},
onDestroy:function(c){this.destroy()},destroy:function(){this.textView&&(this.textView.removeEventListener("ModelChanging",this.listener.onModelChanging),this.textView.removeEventListener("ModelChanged",this.listener.onModelChanged),this.textView.removeEventListener("Destroy",this.listener.onDestroy),this.textView.removeEventListener("LineStyle",this.listener.onLineStyle),this.textView=null);if(this.services){for(var c=0;c<this.services.length;c++)this.removeServiceListener(this.services[c]);this.services=
null}this.serviceRegistry&&(this.serviceRegistry.removeEventListener("registered",this.listener.onServiceAdded),this.serviceRegistry.removeEventListener("unregistering",this.listener.onServiceRemoved),this.serviceRegistry=null);this.lineStyles=this.listener=null},onModelChanging:function(c){this.startLine=this.textView.getModel().getLineAtOffset(c.start)},onModelChanged:function(c){var e=this.startLine;(c.addedLineCount||c.removedLineCount)&&Array.prototype.splice.apply(this.lineStyles,[e,c.removedLineCount].concat(this._getEmptyStyle(c.addedLineCount)))},
onStyleReady:function(c){var e=c.lineStyles||c.style;c=Number.MAX_VALUE;var g=-1,b=this.textView.getModel(),a;for(a in e)Object.prototype.hasOwnProperty.call(e,a)&&(this.lineStyles[a]=e[a],c=Math.min(c,a),g=Math.max(g,a));c=Math.max(c,0);g=Math.min(g,b.getLineCount());if(e=this.annotationModel){for(var d=e.getAnnotations(b.getLineStart(c),b.getLineEnd(g)),k=[];d.hasNext();){var n=d.next();"orion.annotation.highlightError"===n.type&&k.push(n)}d=[];for(n=c;n<=g;n++){a=n;var m=this.lineStyles[a],m=m&&
m.errors;a=b.getLineStart(a);if(m)for(var s=0;s<m.length;s++){var t=m[s];d.push(q.AnnotationType.createAnnotation("orion.annotation.highlightError",t.start+a,t.end+a))}}e.replaceAnnotations(k,d)}this.textView.redrawLines(c,g+1)},onLineStyle:function(c){var e=this.lineStyles[c.lineIndex];if(e)if(e.ranges){for(var e=e.ranges,g=c.lineStart,b=e.length,a=[],d=0;d<b;d++){var k=e[d];a.push({start:k.start+g,end:k.end+g,style:k.style})}c.ranges=a}else e.style&&(c.style=e.style)},_getEmptyStyle:function(c){for(var e=
[],g=0;g<c;g++)e.push(null);return e},setContentType:function(c){this.contentType=c;if(this.services)for(c=0;c<this.services.length;c++){var e=this.services[c];if(e.setContentType){var g=this.serviceRegistry.getService("orion.page.progress");g?g.progress(e.setContentType(this.contentType),"Styling content type: "+this.contentType.id?this.contentType.id:this.contentType):e.setContentType(this.contentType)}}},onServiceAdded:function(c,e){s(c)&&this.addServiceListener(e)},onServiceRemoved:function(c,
e){-1!==this.services.indexOf(e)&&this.removeServiceListener(e)},addServiceListener:function(c){if("function"===typeof c.addEventListener){if(c.addEventListener("orion.edit.highlighter.styleReady",this.listener.onStyleReady),this.services.push(c),c.setContentType&&this.contentType){var g=this.serviceRegistry.getService("orion.page.progress");g?g.progress(c.setContentType(this.contentType),"Styling content type: "+this.contentType.id?this.contentType.id:this.contentType):c.setContentType(this.contentType)}}else"undefined"!==
typeof console&&console.log(Error(e))},removeServiceListener:function(c){"function"===typeof c.removeEventListener?(c.removeEventListener("orion.edit.highlighter.styleReady",this.listener.onStyleReady),c=this.services.indexOf(c),-1!==c&&this.services.splice(c,1)):"undefined"!==typeof console&&console.log(Error(e))}};return g});
define("orion/editor/mirror",["i18n!orion/editor/nls/messages","orion/editor/eventTarget","orion/editor/annotations"],function(n,q,s){function g(b){this.string=b;this.tokenStart=this.pos=0}function c(b,a){return{token:function(a,b){return a.skipToEnd()}}}function e(b){this._modes={};this.mimeModes={};this.options={};this.StringStream=g;this.defineMode("null",c);this.defineMIME("text/plain","null")}function f(b){var a=[],d;for(d in b)Object.prototype.hasOwnProperty.call(b,d)&&a.push(d);return a}function p(b,
a,d){d=d||{};this.model=b;this.codeMirror=a;this.isWhitespaceVisible="undefined"===typeof d.whitespacesVisible?!1:d.whitespacesVisible;this.mode=null;this.isModeLoaded=!1;this.lines=[];this.dirtyLines=[];this.startLine=Number.MAX_VALUE;this.endLine=-1;this.timer=null;this.initialize(b)}function h(b,a,d){this.init(b,a,d)}g.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return 0===this.pos},peek:function(){return this.string[this.pos]},next:function(){return this.string[this.pos++]},
eat:function(b){var a=this.string[this.pos];return"string"===typeof a&&(a===b||b.test&&b.test(a)||"function"===typeof b&&b(a))?this.string[this.pos++]:void 0},eatWhile:function(b){for(var a=!1;void 0!==this.eat(b);)a=!0;return a},eatSpace:function(){return this.eatWhile(/\s/)},skipToEnd:function(){this.pos=this.string.length},skipTo:function(b){b=this.string.indexOf(b,this.pos);return-1!==b?(this.pos=b,!0):!1},match:function(b,a,d){a=!0===a||"undefined"===typeof a;if("string"===typeof b){var c=d?
this.string.toLowerCase():this.string;b=d?b.toLowerCase():b;d=c.indexOf(b,this.pos);-1!==d&&a&&(this.pos=d+b.length);return-1!==d}if((b=this.string.substring(this.pos).match(b))&&a&&"string"===typeof b[0])this.pos+=b.index+b[0].length;return b},backUp:function(b){this.pos-=b},column:function(){for(var b=0,a=0;a<this.tokenStart;)b+="\t"===this.string[a++]?4:1;return b},indentation:function(){for(var b=this.string.search(/\S/),a=0,d=0;d<b;)a+="\t"===this.string[d++]?4:1;return a},current:function(){return this.string.substring(this.tokenStart,
this.pos)},advance:function(){this.tokenStart=this.pos}};e.prototype={options:{},setOption:function(b,a){this.options[b]=a},getOption:function(b){return this.options[b]},copyState:function(b,a){if("function"===typeof b.copyState)return b.copyState(a);var d={},c;for(c in a){var e=a[c];d[c]=e instanceof Array?e.slice():e}return d},startState:function(b,a){return b.startState(a)},defineMode:function(b,a){this._modes[b]=a},defineMIME:function(b,a){this.mimeModes[b]=a},getMode:function(b,a){var d={},c;
"string"===typeof a&&this.mimeModes[a]&&(a=this.mimeModes[a]);"object"===typeof a&&(d=a,c=this._modes[a.name]);c=c||this._modes[a];return"function"!==typeof c?("undefined"!==typeof console&&console&&console.log("Mode not found: "+a),this.getMode(b,"null")):c(b,d)},listModes:function(){return f(this._modes)},listMIMEs:function(){return f(this.mimeModes)},_getModeName:function(b){b=this.mimeModes[b];"object"===typeof b&&(b=b.name);return b}};p.prototype={initialize:function(b){var a=this;this.listener=
{onModelChanging:function(b){a._onModelChanging(b)},onModelChanged:function(b){a._onModelChanged(b)},onDestroy:function(b){a._onDestroy(b)}};this.model.addEventListener("Changing",this.listener.onModelChanging);this.model.addEventListener("Changed",this.listener.onModelChanged);this.model.addEventListener("Destroy",this.listener.onDestroy)},destroy:function(){this.model&&(this.model.removeEventListener("Changing",this.listener.onModelChanging),this.model.removeEventListener("Changed",this.listener.onModelChanged),
this.model.removeEventListener("Destroy",this.listener.onDestroy));this.dirtyLines=this.lines=this.mode=this.codeMirror=this.model=null;clearTimeout(this.timer);this.timer=null},_onModelChanging:function(b){this.startLine=this.model.getLineAtOffset(b.start)},_onModelChanged:function(b){this._dbgEvent(b);var a=this.startLine;(b.removedLineCount||b.addedLineCount)&&Array.prototype.splice.apply(this.lines,[a+1,b.removedLineCount].concat(this._newLines(b.addedLineCount)));this.mode&&(b=Math.max(b.addedLineCount,
b.removedLineCount),b=a+Math.min(b,500),this.highlight(a,b),this.highlightLater(b+1))},_onDestroy:function(b){this.destroy()},setViewportIndex:function(b){this.viewportIndex=b},_dbgEvent:function(b){},_dbgStyle:function(){},_newLines:function(b,a){for(var d=[],c=0;c<b;c++)d.push({style:null,eolState:null});return d},setMode:function(b,a){b&&(this.mode=this.codeMirror.getMode(this.codeMirror.options,b),this.lines=this._newLines(this.model.getLineCount()),a&&this.highlight())},highlight:function(b,
a,d){if(this.mode){var c=this.model.getLineCount();b="undefined"===typeof b?0:b;a="undefined"===typeof a?c-1:Math.min(a,c-1);for(var c=this.mode,e=this.getState(b),f=b;f<=a;f++){var g=this.lines[f];this.highlightLine(f,g,e);g.eolState=this.codeMirror.copyState(c,e)}this._expandRange(b,a);if(!d)this.onHighlightDone()}},highlightLater:function(b){this.dirtyLines.push(b);var a=this;this.timer=setTimeout(function(){a._highlightJob()},50)},_highlightJob:function(){for(var b=+new Date+30,a=this.mode.compareStates,
d=this.model.getLineCount();this.dirtyLines.length;){var c=this.viewportIndex,e=this.lines[c],c=e&&!e.eolState?c:this.dirtyLines.pop();if(c>=d)break;this._expandRange(c,c);for(var e=this._getResumeLineIndex(c),c=e+1,e=(e=0<=e&&this.lines[e].eolState)?this.codeMirror.copyState(this.mode,e):this.mode.startState(),f=0,g=c;g<d;g++){var h=this.lines[g],p=h.eolState,n=this.highlightLine(g,h,e);h.eolState=this.codeMirror.copyState(this.mode,e);n&&this._expandRange(c,g+1);var h=a&&p&&a(p,h.eolState),q=!a&&
!n&&3<f++;if(h||q)break;else if(!p||n)f=0;p=g<d||this.dirtyLines.length;if(+new Date>b&&p){this.highlightLater(g+1);this.onHighlightDone();return}}}this.onHighlightDone()},onHighlightDone:function(){this.startLine!==Number.MAX_VALUE&&-1!==this.endLine&&this.dispatchEvent({type:"Highlight",start:this.startLine,end:this.endLine});this.startLine=Number.MAX_VALUE;this.endLine=-1},_getResumeLineIndex:function(b){for(var a=this.lines,d=b-1;0<=d;d--)if(a[d].eolState||40<b-d)return d;return-1},getState:function(b){var a=
this.mode,d=this.lines,c,e;for(c=b-1;0<=c&&!(e=d[c],e.eolState||40<b-c);c--);var f=0<=c&&d[c].eolState;if(f){f=this.codeMirror.copyState(a,f);for(c=Math.max(0,c);c<b-1;c++)e=d[c],this.highlightLine(c,e,f),e.eolState=this.codeMirror.copyState(a,f);return f}return a.startState()},highlightLine:function(b,a,d){if(this.mode){var c=this.model;c.getLineStart(b)===c.getLineEnd(b)&&this.mode.blankLine&&this.mode.blankLine(d);var e=a.style||[];b=c.getLine(b);b=new g(b);for(var c=!a.style,f=[],h=0;!b.eol();h++){var p=
this.mode.token(b,d)||null,n=b.current();this._whitespaceStyle(p,n,b.tokenStart);p=[b.tokenStart,b.pos,p];n=e[h];f.push(p);c=c||!n||n[0]!==p[0]||n[1]!==p[1]||n[2]!==p[2];b.advance()}if(c=c||f.length!==e.length)a.style=f.length?f:null;return c}},_whitespaceStyle:function(b,a,d){if(!b&&this.isWhitespaceVisible&&/\s+/.test(a)){b=[];for(var c,e,f=0;f<a.length;f++){var g=a[f];g!==e&&(e&&b.push([d+c,d+f,"\t"===e?"punctuation separator tab":"punctuation separator space"]),c=f,e=g)}b.push([d+c,d+f,"\t"===
e?"punctuation separator tab":"punctuation separator space"]);return b}return null},_expandRange:function(b,a){this.startLine=Math.min(this.startLine,b);this.endLine=Math.max(this.endLine,a)},toStyleRangesAndErrors:function(b,a){var d=b.style;if(!d)return null;for(var c=[],e=[],f="undefined"===typeof a?0:this.model.getLineStart(a),g=0;g<d.length;g++){var h=d[g],p;p=(p=h[2])?"punctuation separator tab"===p||"punctuation separator space"===p?p:"cm-"+p:null;p&&(h={start:f+h[0],end:f+h[1],style:{styleClass:p}},
c.push(h),"cm-error"===p&&e.push(h))}return[c,e]},getLineStyle:function(b){return this.lines[b]},getLineStyles:function(){return this.lines}};q.EventTarget.addMixin(p.prototype);s.AnnotationType.registerType("orion.annotation.highlightError",{title:n.syntaxError,html:"\x3cdiv class\x3d'annotationHTML error'\x3e\x3c/div\x3e",rangeStyle:{styleClass:"annotationRange error"}});h.prototype={init:function(b,a,d){this.textView=b;this.annotationModel=d;this.modeApplier=new p(b.getModel(),a);var c=this;this.listener=
{onLineStyle:function(a){c.onLineStyle(a)},onDestroy:function(a){c.onDestroy(a)},onHighlight:function(a){c.onHighlight(a)}};b.addEventListener("LineStyle",this.listener.onLineStyle);b.addEventListener("Destroy",this.listener.onDestroy);this.modeApplier.addEventListener("Highlight",this.listener.onHighlight)},destroy:function(){this.modeApplier&&(this.modeApplier.removeEventListener("Highlight",this.listener.onHighlight),this.modeApplier.destroy());this.textView&&(this.textView.removeEventListener("LineStyle",
this.listener.onLineStyle),this.textView.removeEventListener("Destroy",this.listener.onDestroy));this.listener=this.modeApplier=this.annotationModel=this.textView=null},setMode:function(b){this.modeApplier.setMode(b)},onLineStyle:function(b){var a=b.lineIndex,d=this.modeApplier,c=d.getLineStyle(a);if(!c||!c.eolState){var e=this.textView.getModel().getLineCount();d.highlight(a,Math.min(a+20,e-1),!0);c=d.getLineStyle(a)}e=this.textView.getModel();if(c){var f=d.toStyleRangesAndErrors(c,a);if(f&&(b.ranges=
f[0],b=this.annotationModel)){d=[];c=[];if(f=f[1])for(var g=0;g<f.length;g++){var h=f[g];"cm-error"===h.style.styleClass&&c.push(s.AnnotationType.createAnnotation("orion.annotation.highlightError",h.start,h.end))}for(a=b.getAnnotations(e.getLineStart(a),e.getLineEnd(a));a.hasNext();)e=a.next(),"orion.annotation.highlightError"===e.type&&d.push(e);b.replaceAnnotations(d,c)}}},onHighlight:function(b){this.textView.redrawLines(b.start,b.end)},onDestroy:function(b){this.destroy()}};return{Mirror:e,ModeApplier:p,
CodeMirrorStyler:h}});
define("orion/editor/textMateStyler",["orion/regex"],function(n){function q(c){var e;if(c instanceof Array){e=Array(c.length);for(var f=0;f<c.length;f++)e[f]=q(c[f])}else for(f in e={},c)if(Object.prototype.hasOwnProperty.call(c,f)){var g=c[f];e[f]="object"===typeof g&&null!==g?q(g):g}return e}function s(c,e,f){this.initialize(c);this.grammar=q(e);this.externalGrammars=f?q(f):[];this._styles={};this._tree=null;this._allGrammars={};this.preprocess(this.grammar)}var g={unsupported:[{regex:/\(\?[ims\-]:/,func:function(c){return"option on/off for subexp"}},
{regex:/\(\?<([=!])/,func:function(c){return"\x3d"===c[1]?"lookbehind":"negative lookbehind"}},{regex:/\(\?>/,func:function(c){return"atomic group"}}],toRegExp:function(c){function e(b,a){throw Error('Unsupported regex feature "'+b+'": "'+a[0]+'" at index: '+a.index+" in "+a.input);}var f="",p;c=g.processGlobalFlag("x",c,function(b){for(var a="",d=!1,c=b.length,e=0;e<c;){var f=b.charAt(e);if(!d&&"#"===f)for(;e<c&&"\r"!==f&&"\n"!==f;)f=b.charAt(++e);else if(!d&&/\s/.test(f))for(;e<c&&/\s/.test(f);)f=
b.charAt(++e);else"\\"===f?(a+=f,/\s/.test(b.charAt(e+1))||(a+=b.charAt(e+1),e+=1)):("["===f?d=!0:"]"===f&&(d=!1),a+=f),e+=1}return a});c=g.processGlobalFlag("i",c,function(b){f+="i";return b});for(p=0;p<this.unsupported.length;p++){var h;(h=this.unsupported[p].regex.exec(c))&&e(this.unsupported[p].func(h),h)}return RegExp(c,f)},processGlobalFlag:function(c,e,f){var g="(?"+c+")";c="(?"+c+":";if(e.substring(0,g.length)===g)return f(e.substring(g.length));if(e.substring(0,c.length)===c){for(var g=0,
h=e.length,b=-1,a=0;a<h&&-1===b;a++)switch(e.charAt(a)){case "\\":a++;break;case "(":g++;break;case ")":g--,0===g&&(b=a)}g=b;if(g<e.length-1)throw Error("Only a "+c+") group that encloses the entire regex is supported in: "+e);return f(e.substring(c.length,g))}return e},hasBackReference:function(c){return/\\\d+/.test(c.source)},getSubstitutedRegex:function(c,e,f){f="undefined"===typeof f?!0:!1;c=c.source.split(/(\\\d+)/g);for(var g=[],h=0;h<c.length;h++){var b=c[h],a=/\\(\d+)/.exec(b);a?(b=e[a[1]]||
"",g.push(f?n.escape(b):b)):g.push(b)}return RegExp(g.join(""))},groupify:function(c,e){for(var f=c.source,g=f.length,h=[],b=0,a=[],d=1,k=1,n=[],m={},q={},s=0;s<g;s++){var u=h[h.length-1],y=f.charAt(s);switch(y){case "(":4===u&&(h.pop(),n.push(")"),a[a.length-1].end=s);var A=s+2<g?f.charAt(s+1)+""+f.charAt(s+2):null;if("?:"===A||"?\x3d"===A||"?!"===A){var w;"?:"===A?w=1:(w=3,b++);h.push(w);a.push({start:s,end:-1,type:w});n.push(y);n.push(A);s+=A.length}else h.push(2),a.push({start:s,end:-1,type:2,
oldNum:d,num:k}),n.push(y),0===b&&(q[k]=null),m[d]=k,d++,k++;break;case ")":u=h.pop();3===u&&b--;a[a.length-1].end=s;n.push(y);break;case "*":case "+":case "?":case "}":var B=y,l=f.charAt(s-1),A=s-1;if("}"===y){for(w=s-1;"{"!==f.charAt(w)&&0<=w;w--);l=f.charAt(w-1);A=w-1;B=f.substring(w,s+1)}w=a[a.length-1];if(")"===l&&(2===w.type||4===w.type)){n.splice(w.start,0,"(");n.push(B);n.push(")");y={start:w.start,end:n.length-1,type:4,num:w.num};for(l=0;l<a.length;l++)if(u=a[l],(2===u.type||4===u.type)&&
u.start>=w.start&&u.end<=A)u.start+=1,u.end+=1,u.num+=1,2===u.type&&(m[u.oldNum]=u.num);a.push(y);k++;break}default:"|"!==y&&(2!==u&&4!==u)&&0===b&&(h.push(4),a.push({start:s,end:-1,type:4,num:k}),n.push("("),q[k]=null,k++),n.push(y),"\\"===y&&(y=f.charAt(s+1),n.push(y),s+=1)}}for(;h.length;)h.pop(),n.push(")");f=RegExp(n.join(""));g={};e=e||m;for(var z in e)e.hasOwnProperty(z)&&(g[z]="\\"+e[z]);f=this.getSubstitutedRegex(f,g,!1);return[f,m,q]},complexCaptures:function(c){if(!c)return!1;for(var e in c)if(c.hasOwnProperty(e)&&
"0"!==e)return!0;return!1}};s.prototype={initialize:function(c){this.textView=c;this.textView.stylerOptions=this;var e=this;this._listener={onModelChanged:function(c){e.onModelChanged(c)},onDestroy:function(c){e.onDestroy(c)},onLineStyle:function(c){e.onLineStyle(c)},onStorage:function(c){e.onStorage(c)}};c.addEventListener("ModelChanged",this._listener.onModelChanged);c.addEventListener("Destroy",this._listener.onDestroy);c.addEventListener("LineStyle",this._listener.onLineStyle);c.redrawLines()},
onDestroy:function(c){this.destroy()},destroy:function(){this.textView&&(this.textView.removeEventListener("ModelChanged",this._listener.onModelChanged),this.textView.removeEventListener("Destroy",this._listener.onDestroy),this.textView.removeEventListener("LineStyle",this._listener.onLineStyle),this.textView=null);this._listener=this._tree=this._styles=this.grammar=null},preprocess:function(c){for(c=[c];0!==c.length;){var e=c.pop();if(!e._resolvedRule||!e._typedRule)if(e._resolvedRule=this._resolve(e),
e._typedRule=this._createTypedRule(e),this.addStyles(e.name),this.addStyles(e.contentName),this.addStylesForCaptures(e.captures),this.addStylesForCaptures(e.beginCaptures),this.addStylesForCaptures(e.endCaptures),e._resolvedRule!==e&&c.push(e._resolvedRule),e.patterns)for(var f=0;f<e.patterns.length;f++)c.push(e.patterns[f])}},addStyles:function(c){if(c&&!this._styles[c]){this._styles[c]=[];for(var e=c.split("."),f=0;f<e.length;f++)this._styles[c].push(e.slice(0,f+1).join("-"))}},addStylesForCaptures:function(c){for(var e in c)c.hasOwnProperty(e)&&
this.addStyles(c[e].name)},ContainerRule:function(){function c(c){this.rule=c;this.subrules=c.patterns}c.prototype.valueOf=function(){return"aa"};return c}(),BeginEndRule:function(){function c(c){this.rule=c;this.beginRegex=g.toRegExp(c.begin);this.endRegex=g.toRegExp(c.end);this.subrules=c.patterns||[];this.endRegexHasBackRef=g.hasBackReference(this.endRegex);var f=g.complexCaptures(c.captures);c=g.complexCaptures(c.beginCaptures)||g.complexCaptures(c.endCaptures);if(this.isComplex=f||c)f=g.groupify(this.beginRegex),
this.beginRegex=f[0],this.beginOld2New=f[1],this.beginConsuming=f[2],f=g.groupify(this.endRegex,this.beginOld2New),this.endRegex=f[0],this.endOld2New=f[1],this.endConsuming=f[2]}c.prototype.valueOf=function(){return this.beginRegex};return c}(),MatchRule:function(){function c(c){this.rule=c;this.matchRegex=g.toRegExp(c.match);if(this.isComplex=g.complexCaptures(c.captures))c=g.groupify(this.matchRegex),this.matchRegex=c[0],this.matchOld2New=c[1],this.matchConsuming=c[2]}c.prototype.valueOf=function(){return this.matchRegex};
return c}(),_createTypedRule:function(c){return c.match?new this.MatchRule(c):c.begin?new this.BeginEndRule(c):new this.ContainerRule(c)},_resolve:function(c){var e=c;if(c.include){if(c.begin||c.end||c.match)throw Error('Unexpected regex pattern in "include" rule '+c.include);c=c.include;if("#"===c.charAt(0)){if(e=this.grammar.repository&&this.grammar.repository[c.substring(1)],!e)throw Error("Couldn't find included rule "+c+" in grammar repository");}else if("$self"===c)e=this.grammar;else{if("$base"===
c)throw Error('Include "$base" is not supported');e=this._allGrammars[c];if(!e)for(var f=0;f<this.externalGrammars.length;f++){var g=this.externalGrammars[f];if(g.scopeName===c){this.preprocess(g);e=this._allGrammars[c]=g;break}}}}return e},ContainerNode:function(){function c(c,f){this.parent=c;this.rule=f;this.children=[];this.end=this.start=null}c.prototype.addChild=function(c){this.children.push(c)};c.prototype.valueOf=function(){var c=this.rule;return"ContainerNode { "+(c.include||"")+" "+(c.name||
"")+(c.comment||"")+"}"};return c}(),BeginEndNode:function(){function c(c,f,p){this.parent=c;this.rule=f;this.children=[];this.setStart(p);this.endMatch=this.end=null;this.endRegexSubstituted=f.endRegexHasBackRef?g.getSubstitutedRegex(f.endRegex,p):null}c.prototype.addChild=function(c){this.children.push(c)};c.prototype.getIndexInParent=function(c){return this.parent?this.parent.children.indexOf(this):-1};c.prototype.setStart=function(c){this.start=c.index;this.beginMatch=c};c.prototype.setEnd=function(c){c&&
"object"===typeof c?(this.endMatch=c,this.end=c.index+c[0].length):(this.endMatch=null,this.end=c)};c.prototype.shiftStart=function(c){this.start+=c;this.beginMatch.index+=c};c.prototype.shiftEnd=function(c){this.end+=c;this.endMatch&&(this.endMatch.index+=c)};c.prototype.valueOf=function(){return"{"+this.rule.beginRegex+" range\x3d"+this.start+".."+this.end+"}"};return c}(),push:function(c,e){if(e)for(var f=e.length;0<f;)c.push(e[--f])},exec:function(c,e,f){if(e=c.exec(e))e.index+=f;c.lastIndex=
0;return e},afterMatch:function(c){return c.index+c[0].length},getEndMatch:function(c,e,f){if(c instanceof this.BeginEndNode){var g=c.rule;c=c.endRegexSubstituted||g.endRegex;return!c?null:this.exec(c,e,f)}return null},initialParse:function(){this.textView.getModel().getCharCount();this._tree=new this.ContainerNode(null,this.grammar._typedRule);this.parse(this._tree,!1,0)},onModelChanged:function(c){var e=c.addedCharCount,f=c.removedCharCount;c=c.start;if(this._tree){var g=this.textView.getModel(),
h=g.getCharCount(),g=g.getLineEnd(g.getLineAtOffset(c)-1),b=this.getFirstDamaged(g,g),g=-1===g?0:g,e=b?this.parse(b,!0,g,c,e,f):h;this.textView.redrawRange(g,e)}else this.initialParse()},getFirstDamaged:function(c,e){if(0>c)return this._tree;for(var f=[this._tree],g=null;f.length;){var h=f.pop();if(!h.parent||this.isDamaged(h,c,e)){h instanceof this.BeginEndNode&&(g=h);for(var b=0;b<h.children.length;b++)f.push(h.children[b])}}return g||this._tree},isDamaged:function(c,e,f){return c.start<=f&&c.end>
e},parse:function(c,e,f,g,h,b){var a=this.textView.getModel(),d=a.getLineStart(a.getLineCount()-1),k=a.getCharCount(),n=this.getInitialExpected(c,f),m=-1;e&&(c.repaired=!0,c.endNeedsUpdate=!0,m=(m=c.children[c.children.length-1])?a.getLineEnd(a.getLineAtOffset(m.end+(h-b))):-1,g=a.getLineEnd(a.getLineAtOffset(g+b)),m=Math.max(m,g));m=-1===m?k:m;g=n;for(var q=c,s=!1,u=f,y=-1;q&&(!e||u<m);){var A=this.getNextMatch(a,q,u);A||(u=u>=d?k:a.getLineStart(a.getLineAtOffset(u)+1));var w=A&&A.match,B=A&&A.rule,
l=A&&A.isEnd;if(A&&A.isSub)u=this.afterMatch(w),B instanceof this.BeginEndRule&&(s=!0,e&&B===g.rule&&q===g.parent?(q=g,q.setStart(w),q.repaired=!0,q.endNeedsUpdate=!0,g=this.getNextExpected(g,"begin")):(e&&(this.prune(q,g),e=!1),w=new this.BeginEndNode(q,B,w),q.addChild(w),q=w));else if(l||u===k)q instanceof this.BeginEndNode&&(w?(s=!0,y=Math.max(y,q.end),q.setEnd(w),u=this.afterMatch(w),e&&q===g&&q.parent===g.parent?(q.repaired=!0,delete q.endNeedsUpdate,g=this.getNextExpected(g,"end")):e&&(this.prune(q,
g),e=!1)):(q.setEnd(k),delete q.endNeedsUpdate)),q=q.parent;e&&(u>=m&&!s)&&(this.prune(c,n),e=!1)}this.removeUnrepairedChildren(c,e,f);this.cleanup(e,c,f,m,k,h,b);return e?Math.max(y,u):u},removeUnrepairedChildren:function(c,e,f){if(e){e=c.children;for(var g=-1,h=0;h<e.length;h++){var b=e[h];if(!b.repaired&&this.isDamaged(b,f,Number.MAX_VALUE)){g=h;break}}-1!==g&&(c.children.length=g)}},cleanup:function(c,e,f,g,h,b,a){if(c){c=b-a;h=this.getIntersecting(g-c+1,h);e=this.getIntersecting(f,g);for(f=0;f<
h.length;f++)g=h[f],!g.repaired&&g instanceof this.BeginEndNode&&(g.shiftEnd(c),g.shiftStart(c));for(f=0;f<e.length;f++)g=e[f],g.repaired&&g.endNeedsUpdate&&g.shiftEnd(c),delete g.endNeedsUpdate,delete g.repaired}else{e=this.getIntersecting(f,g);for(f=0;f<e.length;f++)delete e[f].repaired}},getNextMatch:function(c,e,f,g){var h=c.getLineAtOffset(f),h=c.getLineEnd(h),b=c.getText(f,h),a=[],d=[];c=[];h=[];for(this.push(a,e.rule.subrules);a.length;){var k=a.length?a.pop():null,k=k&&k._resolvedRule._typedRule;
if(k instanceof this.ContainerRule&&-1===d.indexOf(k))d.push(k),this.push(a,k.subrules);else if(!k||!g||k.matchRegex){var n=k&&this.exec(k.matchRegex||k.beginRegex,b,f);n&&(c.push(n),h.push(k))}}a=Number.MAX_VALUE;d=-1;for(k=0;k<c.length;k++)n=c[k],n.index<a&&(a=n.index,d=k);if(!g&&(f=this.getEndMatch(e,b,f)))if(g=e.rule.applyEndPatternLast,-1===d||f.index<a||!g&&f.index===a)return{isEnd:!0,rule:e.rule,match:f};return-1===d?null:{isSub:!0,rule:h[d],match:c[d]}},getInitialExpected:function(c,e){var f,
g;if(c===this._tree)for(f=0;f<c.children.length;f++){if(g=c.children[f],g.start>=e)return g}else if(c instanceof this.BeginEndNode&&c.endMatch){var h=c.endMatch.index;for(f=0;f<c.children.length&&!(g=c.children[f],g.start>=e);f++);if(g&&g.start<h)return g}return c},getNextExpected:function(c,e){if("begin"===e){var f=c.children[0];return f?f:c}if("end"===e&&(f=c.parent)){var g=f.children[f.children.indexOf(c)+1];return g?g:f}return null},prune:function(c,e){e.parent===c?c.children.length=e.getIndexInParent():
c instanceof this.BeginEndNode&&(c.endMatch=null,c.end=null);c.parent&&(c.parent.children.length=c.getIndexInParent()+1)},onLineStyle:function(c){this._tree||this.initialParse();var e=c.lineStart,f=this.textView.getModel(),g=f.getLineEnd(c.lineIndex),h=f.getLineEnd(f.getLineAtOffset(e)-1),h=this.getFirstDamaged(h,h),e=this.getLineScope(f,h,e,g);c.ranges=this.toStyleRanges(e);c.ranges.sort(function(b,a){return b.start-a.start})},getLineScope:function(c,e,f,g){for(var h=f,b=this.getInitialExpected(e,
f),a=[],d=[];e&&h<g;){var k=this.getNextMatch(c,e,h);if(!k)break;var n=k&&k.match,m=k&&k.rule,q=k&&k.isSub,k=k&&k.isEnd;n.index!==h&&d.push({start:h,end:n.index,node:e});q?(h=this.afterMatch(n),m instanceof this.BeginEndRule?(this.addBeginScope(a,n,m),e=b,b=this.getNextExpected(b,"begin")):this.addMatchScope(a,n,m)):k&&(h=this.afterMatch(n),this.addEndScope(a,n,m),b=this.getNextExpected(b,"end"),e=e.parent)}h<g&&d.push({start:h,end:g,node:e});c=this.getInheritedLineScope(d,f,g);return a.concat(c)},
getInheritedLineScope:function(c,e,f){e=[];for(f=0;f<c.length;f++)for(var g=c[f],h=g.node;h;){var b=h.rule.rule,a=b.name;if(b=b.contentName||a){this.addScopeRange(e,g.start,g.end,b);break}h=h.parent}return e},addBeginScope:function(c,e,f){var g=f.rule;this.addCapturesScope(c,e,g.beginCaptures||g.captures,f.isComplex,f.beginOld2New,f.beginConsuming)},addEndScope:function(c,e,f){var g=f.rule;this.addCapturesScope(c,e,g.endCaptures||g.captures,f.isComplex,f.endOld2New,f.endConsuming)},addMatchScope:function(c,
e,f){var g=f.rule,h=g.name;(g=g.captures)?this.addCapturesScope(c,e,g,f.isComplex,f.matchOld2New,f.matchConsuming):this.addScope(c,e,h)},addScope:function(c,e,f){f&&c.push({start:e.index,end:this.afterMatch(e),scope:f})},addScopeRange:function(c,e,f,g){g&&c.push({start:e,end:f,scope:g})},addCapturesScope:function(c,e,f,g,h,b){if(f)if(g){g={1:0};for(var a=0,d=1;void 0!==e[d];d++)void 0!==b[d]&&(a+=e[d].length),void 0!==e[d+1]&&(g[d+1]=a);b=e.index;for(a=1;f[a];a++){var d=f[a].name,k=h[a],n=b+g[k];
"undefined"!==typeof e[k]&&this.addScopeRange(c,n,n+e[k].length,d)}}else this.addScope(c,e,f[0]&&f[0].name)},getIntersecting:function(c,e){for(var f=[],g=this._tree?[this._tree]:[];g.length;){var h=g.pop(),b=!1;h instanceof this.ContainerNode?b=!0:this.isDamaged(h,c,e)&&(b=!0,f.push(h));if(b)for(var b=h.children.length,a=0;a<b;a++)g.push(h.children[a])}return f.reverse()},toStyleRanges:function(c){for(var e=[],f=0;f<c.length;f++){var g=c[f],h=this._styles[g.scope];if(!h)throw Error("styles not found for "+
g.scope);h=h.join(" ");e.push({start:g.start,end:g.end,style:{styleClass:h}})}return e}};return{RegexUtil:g,TextMateStyler:s}});
define("orion/editor/htmlGrammar",[],function(){return{HtmlGrammar:function(){return{scopeName:"source.html",uuid:"3B5C76FB-EBB5-D930-F40C-047D082CE99B",patterns:[{begin:"\x3c!(doctype|DOCTYPE)",end:"\x3e",contentName:"entity.name.tag.doctype.html",beginCaptures:{0:{name:"entity.name.tag.doctype.html"}},endCaptures:{0:{name:"entity.name.tag.doctype.html"}}},{begin:"\x3c!--",end:"--\x3e",beginCaptures:{0:{name:"punctuation.definition.comment.html"}},endCaptures:{0:{name:"punctuation.definition.comment.html"}},
patterns:[{match:"--",name:"invalid.illegal.badcomment.html"}],contentName:"comment.block.html"},{match:"\x3c[A-Za-z0-9_\\-:]+(?\x3d ?)",name:"entity.name.tag.html"},{include:"#attrName"},{include:"#qString"},{include:"#qqString"},{include:"#entity"},{match:"\x3c/[A-Za-z0-9_\\-:]+\x3e",name:"entity.name.tag.html"},{match:"\x3e",name:"entity.name.tag.html"}],repository:{attrName:{match:"[A-Za-z\\-:]+(?\x3d\\s*\x3d\\s*['\"])",name:"entity.other.attribute.name.html"},qqString:{match:'(")[^"]+(")',name:"string.quoted.double.html"},
qString:{match:"(')[^']+(')",name:"string.quoted.single.html"},entity:{match:"\x26[A-Za-z0-9]+;",name:"constant.character.entity.html"}}}}}});
define("orion/editor/textStyler",["orion/editor/annotations"],function(n){function q(a,b){this._unnamedCounter=0;this._patterns=[];this._rootId=b;a.forEach(function(a){this._addRepositoryPatterns(a.repository||{},a.id);this._addPatterns(a.patterns||[],a.id)}.bind(this))}function s(a,b,c,d,e){this.start=a.start;this.end=a.end;this.contentStart=a.contentStart;this.contentEnd=a.contentEnd;this.pattern=b;this._styler=c;this._parent=e;this._linePatterns=[];this._blockPatterns=[];this._enclosurePatterns=
{};d&&(this._initPatterns(),this._subBlocks=y(d,d.getText(this.start,this.end),this,this.start))}function g(a){this._styler=a}function c(a,b,c,d){this.highlightCaretLine=this.whitespacesVisible=this.spacesVisible=this.tabsVisible=!1;this.detectTasks=this.foldingEnabled=!0;this.view=a;this.annotationModel=b;this.patternManager=new q(c,d);this._accessor=new g(this);this._bracketAnnotations=void 0;var e=this;this._listener={onChanged:function(a){e._onModelChanged(a)},onDestroy:function(a){e._onDestroy(a)},
onLineStyle:function(a){e._onLineStyle(a)},onMouseDown:function(a){e._onMouseDown(a)},onSelection:function(a){e._onSelection(a)}};c=a.getModel();c.getBaseModel&&(c=c.getBaseModel());c.addEventListener("Changed",this._listener.onChanged);a.addEventListener("MouseDown",this._listener.onMouseDown);a.addEventListener("Selection",this._listener.onSelection);a.addEventListener("Destroy",this._listener.onDestroy);a.addEventListener("LineStyle",this._listener.onLineStyle);d=c.getCharCount();this._rootBlock=
new s({start:0,contentStart:0,end:d,contentEnd:d},null,this,c);this._computeFolding(this._rootBlock.getBlocks());b&&this.detectTasks&&(d=[],A(this._rootBlock,c,d),b.replaceAnnotations([],d));a.redrawLines()}var e={styleClass:"meta annotation currentLine"},f=/$/,p=/\\(\d)/g,h=/^\(\?i\)\s*/,b=/(.*)(?:[\r\n]|$)/g,a={regex:/[ ]/g,style:{styleClass:"punctuation separator space",unmergeable:!0}},d={regex:/\t/g,style:{styleClass:"punctuation separator tab",unmergeable:!0}},k=function(a,c,d,e){var f=d,g=
a.lastIndex;b.lastIndex=d;d=b.exec(c);var k,h;a.lastIndex=0;if(d){for(h=d.index;0<=--h&&!(k=c.charAt(h),"\n"===k||"\r"===k););k=c.substring(h+1,d.index+d[1].length);a.lastIndex=h=d.index-h-1}for(;d&&d.index<c.length;){var m;if(e){var n=a.lastIndex;a.test(k)&&(a.lastIndex=n,m=a.exec(k))}else m=a.exec(k);if(m)return m.index+=f,m.index-=h,a.lastIndex=g,m;h=0;f+=d[0].length;if(d=b.exec(c))k=d[1],a.lastIndex=0}a.lastIndex=g;return null},r=function(a,b){var c=a.toString();p.lastIndex=0;if(!p.test(c))return a;
p.lastIndex=0;for(var d=p.exec(c);d;)c=c.replace(d[0],b[d[1]]||""),p.lastIndex=0,d=p.exec(c);return RegExp(c.substring(1,c.length-1-1),"g")},m=function(a,b,c,d){if(b=k(a.pattern.regex?a.pattern.regex:a.pattern.regexBegin,b,d,!0)){a.result=b;for(d=0;d<c.length;d++)if(b.index<c[d].result.index||b.index===c[d].result.index&&a.pattern.pattern.index<c[d].pattern.pattern.index){c.splice(d,0,a);return}c.push(a)}},v=function(a,b,c,d){if(b[0])d.push({start:c,end:c+a[0].length,style:b[0].name});else for(var e=
0,f=1;f<a.length;f++)if(a[f]){var g=b[f];if(g){var k=c+e;d.push({start:k,end:k+a[f].length,style:g.name})}e+=a[f].length}},t=function(a,b,c){var d=a.start;b.forEach(function(b){d<=b.start&&c.push({start:d,end:b.start,style:a.style});c.push(b);d=b.end});d<a.end&&c.push({start:d,end:a.end,style:a.style})},u=function(a,b,c,d,e){if(a&&(c=c.getLinePatterns())){var g=[];c.forEach(function(b){var c=b.regex||b.regexBegin;c.oldLastIndex=c.lastIndex;(c=k(c,a,0))&&g.push({result:c,pattern:b})});g.sort(function(a,
b){return a.result.index<b.result.index?-1:a.result.index>b.result.index?1:a.pattern.pattern.index<b.pattern.pattern.index?-1:1});for(var h=0;0<g.length;){var n=g[0];g.splice(0,1);if(!(n.result.index<h)){var p=n.result.index,q,s=[];if(n.pattern.regex){h=n.result;q=p+h[0].length;q={start:b+p,end:b+q,style:n.pattern.pattern.name};if(!e){n.pattern.pattern.captures&&v(h,n.pattern.pattern.captures,b+p,s);s.sort(function(a,b){return a.start<b.start?-1:a.start>b.start?1:0});for(p=0;p<s.length-1;p++)if(s[p+
1].start<s[p].end){var u={start:s[p+1].end,end:s[p].end,style:s[p].style};s[p].end=s[p+1].start;s.splice(p+2,0,u)}}t(q,s,d)}else h=n.pattern.regexEnd,h=r(h,n.result),h=k(h,a,n.result.index+n.result[0].length),h||(f.lastIndex=0,h=f.exec(a)),q=h.index+h[0].length,d.push({start:b+p,end:b+q,style:n.pattern.pattern.name});h=h.index+h[0].length}m(n,a,g,h)}c.forEach(function(a){a=a.regex||a.regexBegin;a.lastIndex=a.oldLastIndex})}},y=function(a,b,c,d){if(!b)return[];var e=[],g=[];c.getBlockPatterns().forEach(function(a){var c=
k(a.regexBegin||a.regex,b,0);c&&g.push({result:c,pattern:a})}.bind(this));if(!g.length)return e;g.sort(function(a,b){return a.result.index<b.result.index?-1:a.result.index>b.result.index?1:a.pattern.pattern.index<b.pattern.pattern.index?-1:1});for(var h=0;0<g.length;){var n=g[0];g.splice(0,1);if(!(n.result.index<h)){var h=d+n.result.index,p=n.result.index,q=null,t=n.pattern.regexEnd;if(t){var p=p+n.result[0].length,u=n.pattern,v=r(t,n.result);v!==t&&(u={pattern:u.pattern,regexBegin:u.regexBegin,regexEnd:v},
t=v);for(v=p;!q;){v=k(t,b,v);v||(f.lastIndex=0,v=f.exec(b));var y=new s({start:h,end:d+v.index+v[0].length,contentStart:d+p,contentEnd:d+v.index},u,c.getStyler(),a,c),A=y.getBlocks();if(!A.length||A[A.length-1].end<=v.index+d)q=y;v=v.index+v[0].length}}else q=new s({start:h,end:h+n.result[0].length,contentStart:h,contentEnd:h+n.result[0].length},n.pattern,c.getStyler(),a,c);e.push(q);h=q.end-d}m(n,b,g,h)}return e},A=function(a,b,c){if(a.getAnnotationModel()){var d=n.AnnotationType.ANNOTATION_TASK;
if(a.getLinePatterns().length&&a.pattern&&a.pattern.pattern.name&&0===a.pattern.pattern.name.indexOf("comment")){var e=[];u(b.getText(a.contentStart,a.end),a.contentStart,a,e,!0);for(var f=0;f<e.length;f++)"meta.annotation.task.todo"===e[f].style&&c.push(n.AnnotationType.createAnnotation(d,e[f].start,e[f].end,b.getText(e[f].start,e[f].end)))}a.getBlocks().forEach(function(a){A(a,b,c)}.bind(this))}};q.prototype={getPatterns:function(a){a?(a="string"===typeof a?a:a.qualifiedId,a+="#"):a=this._rootId+
"#"+this._NO_ID;var b=[0],c={},d=RegExp("^"+a+"[^#]+$");this._patterns.forEach(function(a){d.test(a.qualifiedId)&&(a.include?this._processInclude(a,b,c):(a.index=b[0]++,c[a.id]=a))}.bind(this));var e=[];Object.keys(c).forEach(function(a){e.push(c[a])});return e},_addPatterns:function(a,b){a.forEach(function(a){this._addPattern(a,this._NO_ID+this._unnamedCounter++,b)}.bind(this))},_addRepositoryPatterns:function(a,b){Object.keys(a).forEach(function(c){this._addPattern(a[c],c,b)}.bind(this))},_addPattern:function(a,
b,c){a.parentId=c;a.id=b;a.qualifiedId=a.parentId+"#"+a.id;this._patterns.push(a);a.patterns&&!a.include&&this._addPatterns(a.patterns,a.qualifiedId)},_processInclude:function(a,b,c){var d,e=a.include.indexOf("#");d=0===e?RegExp("^"+a.qualifiedId.substring(0,a.qualifiedId.indexOf("#"))+a.include+"$"):-1===e?RegExp("^"+a.include+"#"+this._NO_ID+"[^#]+$"):RegExp("^"+a.include+"$");this._patterns.forEach(function(a){d.test(a.qualifiedId)&&(a.include?this._processInclude(a,b,c):c[a.id]||(a.index=b[0]++,
c[a.id]=a))}.bind(this))},_NO_ID:"NoID"};s.prototype={adjustEnd:function(a){this.end+=a;this.contentEnd+=a;this._subBlocks.forEach(function(b){b.adjustEnd(a)})},adjustStart:function(a){this.start+=a;this.contentStart+=a;this._subBlocks.forEach(function(b){b.adjustStart(a)})},computeStyle:function(a,b){if(!this.pattern||!(this.start<=b&&b<this.end))return null;var c={start:this.start,end:this.end,style:this.pattern.pattern.name};if(this.contentStart<=b&&b<this.contentEnd)return this.pattern.pattern.contentName?
{start:this.contentStart,end:this.contentEnd,style:this.pattern.pattern.contentName}:c;var d,e,f,g;if(b<this.contentStart){e=this.pattern.pattern.beginCaptures||this.pattern.pattern.captures;if(!e)return c;d=this.pattern.regexBegin;f=a.getText(this.start,this.contentStart);g=this.start}else{e=this.pattern.pattern.endCaptures||this.pattern.pattern.captures;if(!e)return c;d=this.pattern.regexEnd;f=a.getText(this.contentEnd,this.end);g=this.contentEnd}d.lastIndex=0;if(f=d.exec(f)){d=[];v(f,e,g,d);for(e=
0;e<d.length;e++)if(d[e].start<=b&&b<d[e].end)return d[e]}return c},getAnnotationModel:function(){return this._styler._getAnnotationModel()},getBlockPatterns:function(){return this._blockPatterns},getBlocks:function(){return this._subBlocks},getEnclosurePatterns:function(){return this._enclosurePatterns},getLinePatterns:function(){return this._linePatterns},getParent:function(){return this._parent},getPatternManager:function(){return this._styler._getPatternManager()},getPatterns:function(){return this.getLinePatterns()},
getStyler:function(){return this._styler},isRenderingWhitespace:function(){return this._styler._isRenderingWhitespace()},_initPatterns:function(){if(this.pattern&&this.pattern.pattern._linePatterns)this._linePatterns=this.pattern.pattern._linePatterns,this._blockPatterns=this.pattern.pattern._blockPatterns,this._enclosurePatterns=this.pattern.pattern._enclosurePatterns;else{var a=function(a){a="string"===typeof a?a:a.match;var b=h.exec(a),c="g";b&&(a=a.substring(b[0].length),c+="i");return RegExp(a,
c)},b=-1,c=0;this.getPatternManager().getPatterns(this.pattern?this.pattern.pattern:null).forEach(function(d){var e;if(d.match&&!d.begin&&!d.end){if(e={regex:a(d.match),pattern:d},this._linePatterns.push(e),d.name&&0===d.name.indexOf("punctuation.section")&&(-1!==d.name.indexOf(".begin")||-1!==d.name.indexOf(".end")))this._enclosurePatterns[d.name]=e}else!d.match&&(d.begin&&d.end)&&(b=c,e={regexBegin:a(d.begin),regexEnd:a(d.end),pattern:d},this._linePatterns.push(e));c++}.bind(this));this._blockPatterns=
this._linePatterns.slice(0,b+1);this.pattern&&(this.pattern.pattern._enclosurePatterns=this._enclosurePatterns,this.pattern.pattern._linePatterns=this._linePatterns,this.pattern.pattern._blockPatterns=this._blockPatterns)}}};g.prototype={getPatterns:function(a){return this._styler.getPatterns(a)},getStyles:function(a){return this._styler.getStyles(a)}};c.prototype={destroy:function(){var a=this.view;if(a){var b=a.getModel();b.getBaseModel&&(b=b.getBaseModel());b.removeEventListener("Changed",this._listener.onChanged);
a.removeEventListener("MouseDown",this._listener.onMouseDown);a.removeEventListener("Selection",this._listener.onSelection);a.removeEventListener("Destroy",this._listener.onDestroy);a.removeEventListener("LineStyle",this._listener.onLineStyle);this.view=null}},getPatterns:function(a){return this._findBlock(this._rootBlock,a).getPatterns()},getStyleAccessor:function(){return this._accessor},getStyles:function(a){var b=[],c=this.view.getModel();c.getBaseModel&&(c=c.getBaseModel());var d=this._findBlock(this._rootBlock,
a),e=c.getLineAtOffset(a),f=c.getLine(e),g=[];u(f,c.getLineStart(e),d,g);for(e=0;e<g.length&&!(a<g[e].start);e++)if(g[e].start<=a&&a<g[e].end){b.push(g[e]);break}for(;d;)(g=d.computeStyle(c,a))&&b.splice(0,0,g),d=d.getParent();return b},setHighlightCaretLine:function(a){this.highlightCaretLine=a},setWhitespacesVisible:function(a,b){this.whitespacesVisible!==a&&(this.whitespacesVisible=a,b&&this.view.redraw())},setTabsVisible:function(a){this.tabsVisible!==a&&(this.tabsVisible=a,this.setWhitespacesVisible(this.tabsVisible||
this.spacesVisible,!1),this.view.redraw())},setSpacesVisible:function(a){this.spacesVisible!==a&&(this.spacesVisible=a,this.setWhitespacesVisible(this.tabsVisible||this.spacesVisible,!1),this.view.redraw())},setDetectHyperlinks:function(a){},setFoldingEnabled:function(a){this.foldingEnabled=a},setDetectTasks:function(a){this.detectTasks=a},_binarySearch:function(a,b,c,d,e){var f;void 0===d&&(d=-1);void 0===e&&(e=a.length);for(;1<e-d;)if(f=Math.floor((e+d)/2),b<=a[f].start)e=f;else if(c&&b<a[f].end){e=
f;break}else d=f;return e},_computeFolding:function(a){if(this.foldingEnabled){var b=this.view.getModel();if(b.getBaseModel){var c=this.annotationModel;if(c){c.removeAnnotations(n.AnnotationType.ANNOTATION_FOLDING);for(var d=[],e=b.getBaseModel(),f=0;f<a.length;f++){var g=a[f];(g=this._createFoldingAnnotation(b,e,g.start,g.end))&&d.push(g)}c.replaceAnnotations(null,d)}}}},_createFoldingAnnotation:function(a,b,c,d){var e=b.getLineAtOffset(c);b=b.getLineAtOffset(d);return e===b?null:new (n.AnnotationType.getType(n.AnnotationType.ANNOTATION_FOLDING))(c,
d,a)},_findBlock:function(a,b){var c=a.getBlocks();if(!c.length)return a;var d=this._binarySearch(c,b,!0);return d<c.length&&c[d].start<=b&&b<c[d].end?this._findBlock(c[d],b):a},_findBrackets:function(a,b,c,d,e,f){for(var g=[],h=[],k=e,m=c.getBlocks(),n=this._binarySearch(m,e,!0);n<m.length&&!(m[n].start>=f);n++){var p=m[n].start,q=m[n].end;k<p&&(u(d.substring(k-e,p-e),k,c,h),h.forEach(function(c){0===c.style.indexOf(a.pattern.name)?g.push(c.start+1):0===c.style.indexOf(b.pattern.name)&&g.push(-(c.start+
1))}),h=[]);k=q}k<f&&(u(d.substring(k-e,f-e),k,c,h),h.forEach(function(c){0===c.style.indexOf(a.pattern.name)?g.push(c.start+1):0===c.style.indexOf(b.pattern.name)&&g.push(-(c.start+1))}));return g},_findMatchingBracket:function(a,b,c){for(var d=a.getLineAtOffset(c),e=a.getLineEnd(d),f=a.getText(c,e),g,h=b.getEnclosurePatterns(),m=Object.keys(h),n=0;n<m.length;n++){var p=h[m[n]],q=k(p.regex,f,0);if(q&&0===q.index){g=p;break}}if(!g)return-1;f=!1;-1!==g.pattern.name.indexOf(".begin")?(f=!0,n=g.pattern.name.replace(".begin",
".end")):n=g.pattern.name.replace(".end",".begin");h=h[n];if(!h)return-1;m=a.getLine(d);p=a.getLineStart(d);e=this._findBrackets(g,h,b,m,p,e);for(n=0;n<e.length;n++)if(m=0<=e[n]?1:-1,e[n]*m-1===c){c=1;if(f){for(n++;n<e.length;n++)if(m=0<=e[n]?1:-1,c+=m,0===c)return e[n]*m-1;d+=1;for(n=a.getLineCount();d<n;){m=a.getLine(d);p=a.getLineStart(d);e=a.getLineEnd(d);e=this._findBrackets(g,h,b,m,p,e);for(f=0;f<e.length;f++)if(m=0<=e[f]?1:-1,c+=m,0===c)return e[f]*m-1;d++}}else{for(n--;0<=n;n--)if(m=0<=e[n]?
1:-1,c+=m,0===c)return e[n]*m-1;for(d-=1;0<=d;){m=a.getLine(d);p=a.getLineStart(d);e=a.getLineEnd(d);e=this._findBrackets(g,h,b,m,p,e);for(n=e.length-1;0<=n;n--)if(m=0<=e[n]?1:-1,c+=m,0===c)return e[n]*m-1;d--}}break}return-1},_getAnnotationModel:function(){return this.annotationModel},_getLineStyle:function(a){if(this.highlightCaretLine){var b=this.view,c=b.getModel(),b=b.getSelection();if(b.start===b.end&&c.getLineAtOffset(b.start)===a)return e}return null},_getPatternManager:function(){return this.patternManager},
_getStyles:function(a,b,c,d){b.getBaseModel&&(d=b.mapOffset(d));for(var e=d+c.length,f=[],g=d,h=a.getBlocks(),m=this._binarySearch(h,d,!0);m<h.length&&!(h[m].start>=e);m++){var n=h[m].start,p=h[m].end;g<n&&u(c.substring(g-d,n-d),g,a,f);var q=Math.max(g,n);if(q===n&&h[m].pattern.regexBegin){var r=k(h[m].pattern.regexBegin,c.substring(q-d),0);if(r){var s=h[m].pattern.pattern.beginCaptures||h[m].pattern.pattern.captures;s?v(r,s,q,f):f.push({start:q,end:q+r[0].length,style:h[m].pattern.pattern.name});
q+=r[0].length}}var n=Math.min(e,p),t=[];if(n===p&&h[m].pattern.regexEnd&&(g=c.substring(n-g-(h[m].end-h[m].contentEnd)),r=k(h[m].pattern.regexEnd,g,0)))(s=h[m].pattern.pattern.endCaptures||h[m].pattern.pattern.captures)?v(r,s,n-r[0].length,t):h[m].pattern.pattern.name&&t.push({start:n-r[0].length,end:n,style:h[m].pattern.pattern.name}),n-=r[0].length;var g=this._getStyles(h[m],b,c.substring(q-d,n-d),q),y=h[m].pattern.pattern.contentName||h[m].pattern.pattern.name;if(y){var H=q;g.forEach(function(a){a.start-
H&&f.push({start:H,end:a.start,style:y});f.push(a);H=a.end});n-H&&f.push({start:H,end:n,style:y})}else f=f.concat(g);f=f.concat(t);g=p}g<e&&u(c.substring(g-d,e-d),g,a,f);if(b.getBaseModel)for(a=0;a<f.length;a++)c=f[a].end-f[a].start,f[a].start=b.mapOffset(f[a].start,!0),f[a].end=f[a].start+c;return f},_isRenderingWhitespace:function(){return this.whitespacesVisible&&(this.tabsVisible||this.spacesVisible)},_onDestroy:function(a){this.destroy()},_onLineStyle:function(b){b.textView===this.view&&(b.style=
this._getLineStyle(b.lineIndex));b.ranges=this._getStyles(this._rootBlock,b.textView.getModel(),b.lineText,b.lineStart);b.ranges.forEach(function(a){a.style&&(a.style={styleClass:a.style.replace(/\./g," ")})});this._isRenderingWhitespace()&&(this.spacesVisible&&this._spliceStyles(a,b.ranges,b.lineText,b.lineStart),this.tabsVisible&&this._spliceStyles(d,b.ranges,b.lineText,b.lineStart))},_onSelection:function(a){var b=a.oldValue,c=a.newValue,d=this.view;a=d.getModel();var e;if(this.highlightCaretLine){var f=
a.getLineAtOffset(b.start);e=a.getLineAtOffset(c.start);var g=c.start===c.end,b=b.start===b.end;f===e&&b&&g||(b&&d.redrawLines(f,f+1),(f!==e||!b)&&g&&d.redrawLines(e,e+1))}if(this.annotationModel){var b=this._bracketAnnotations,h,k;if(c.start===c.end&&0<(k=d.getCaretOffset()))k-=1,a.getBaseModel&&(k=a.mapOffset(k),a=a.getBaseModel()),c=this._findBlock(this._rootBlock,k),a=this._findMatchingBracket(a,c,k),-1!==a&&(h=[n.AnnotationType.createAnnotation(n.AnnotationType.ANNOTATION_MATCHING_BRACKET,a,
a+1),n.AnnotationType.createAnnotation(n.AnnotationType.ANNOTATION_CURRENT_BRACKET,k,k+1)]);this._bracketAnnotations=h;this.annotationModel.replaceAnnotations(b,h)}},_onMouseDown:function(a){if(2===a.clickCount){var b=this.view,c=b.getModel(),d=b.getOffsetAtLocation(a.x,a.y);if(0<d){var e=d-1,f=c;c.getBaseModel&&(e=c.mapOffset(e),f=c.getBaseModel());var g=this._findBlock(this._rootBlock,e),e=this._findMatchingBracket(f,g,e);-1!==e&&(a.preventDefault(),a=e,c.getBaseModel&&(a=c.mapOffset(a,!0)),d>a&&
(d--,a++),b.setSelection(a,d))}}},_onModelChanged:function(a){var b=a.start,c=a.removedCharCount;a=a.addedCharCount-c;var d=this.view,e=d.getModel(),f=e.getBaseModel?e.getBaseModel():e,c=b+c,g=f.getCharCount(),h=this._rootBlock.getBlocks(),k=h.length,m=f.getLineStart(f.getLineAtOffset(b)),p=this._binarySearch(h,m,!0),q=this._binarySearch(h,c,!1,p-1,k),r;p<k&&h[p].start<=m&&m<h[p].end?(r=h[p].start,r>b&&(r+=a)):r=p===k&&0<k&&g-a===h[k-1].end?h[k-1].start:m;var s;do q<k?(s=h[q].end,s>b&&(s+=a),q+=1):
(q=k,s=g),m=f.getText(r,s),m=y(f,m,this._rootBlock,r);while(m.length&&h.length&&q<k&&m[m.length-1].pattern.pattern.id!==h[q-1].pattern.pattern.id);for(g=p;g<h.length;g++)k=h[g],k.start>b&&k.adjustStart(a),k.start>b&&k.adjustEnd(a);var t=q-p!==m.length;if(!t)for(g=0;g<m.length;g++){var k=h[p+g],u=m[g];if(k.start!==u.start||k.end!==u.end||k.type!==u.type){t=!0;break}}g=[p,q-p].concat(m);Array.prototype.splice.apply(h,g);t&&(g=r,k=s,e!==f&&(g=e.mapOffset(g,!0),k=e.mapOffset(k,!0)),d.redrawRange(g,k));
if(this.annotationModel){d=[];h=[];p=[];r=this.annotationModel.getAnnotations(r,s);for(s=this.foldingEnabled&&f!==e;r.hasNext();)if(k=r.next(),s&&k.type===n.AnnotationType.ANNOTATION_FOLDING){p.push(k);for(g=0;g<m.length&&!(k.start===m[g].start&&k.end===m[g].end);g++);g===m.length?(d.push(k),k.expand()):(g=k.start,q=k.end,g>b&&(g-=a),q>b&&(q-=a),g<=b&&(b<q&&g<=c&&c<q)&&(g=f.getLineAtOffset(k.start),q=f.getLineAtOffset(k.end),g!==q?k.expanded||k.expand():this.annotationModel.removeAnnotation(k)));
for(g=0;g<m.length;g++){k=m[g];for(q=0;q<p.length&&!(p[q].start===k.start&&p[q].end===k.end);q++);q===p.length&&(k=this._createFoldingAnnotation(e,f,k.start,k.end))&&h.push(k)}}else k.type===n.AnnotationType.ANNOTATION_TASK&&d.push(k);if(this.detectTasks)for(g=0;g<m.length;g++)A(m[g],f,h);this.annotationModel.replaceAnnotations(d,h)}},_spliceStyles:function(a,b,c,d){for(var e=a.regex,f=e.lastIndex=0,g=e.exec(c);g;){for(g=d+g.index;f<b.length&&!(g<b[f].end);)f++;var h={start:g,end:g+1,style:a.style};
if(f<b.length&&b[f].start<=g){var k={start:g+1,end:b[f].end,style:b[f].style};b[f].end=g;b.splice(f+1,0,k);b.splice(f+1,0,h);f+=2}else b.splice(f,0,h),f++;g=e.exec(c)}}};return{TextStyler:c}});
define("orion/editor/stylers/application_xml/syntax",["orion/editor/stylers/lib/syntax"],function(n){n=n.grammars;n.push({id:"orion.xml",contentTypes:["application/xml","application/xhtml+xml"],patterns:[{include:"#comment"},{include:"#doctype"},{include:"#xmlDeclaration"},{include:"#tag"},{include:"#ampersandEscape"}],repository:{ampersandEscape:{match:"\x26lt;|\x26gt;|\x26amp;",name:"constant.character"},comment:{begin:{match:"\x3c!--",literal:"\x3c!--"},end:{match:"--\x3e",literal:"--\x3e"},name:"comment.block.xml",
patterns:[{match:"(\\b)(TODO)(\\b)(((?!--\x3e).)*)",name:"meta.annotation.task.todo",captures:{2:{name:"keyword.other.documentation.task"},4:{name:"comment.line"}}}]},doctype:{begin:"\x3c!(?:doctype|DOCTYPE)",end:"\x3e",name:"meta.tag.doctype.xml",captures:{0:{name:"entity.name.tag.doctype.xml"}},patterns:[{include:"#comment"},{include:"orion.lib#string_doubleQuote"},{include:"orion.lib#string_singleQuote"}]},tag:{begin:"\x3c/?[A-Za-z0-9]+",end:"/?\x3e",captures:{0:{name:"entity.name.tag.xml"}},name:"meta.tag.xml",
patterns:[{include:"#comment"},{include:"orion.lib#string_doubleQuote"},{include:"orion.lib#string_singleQuote"}]},xmlDeclaration:{begin:"\x3c\\?xml",end:"\\?\x3e",captures:{0:{name:"entity.name.tag.declaration.xml"}},patterns:[{include:"#comment"},{include:"orion.lib#string_doubleQuote"},{include:"orion.lib#string_singleQuote"}],name:"meta.tag.declaration.xml"}}});return{id:n[n.length-1].id,grammars:n,keywords:[]}});
define("orion/editor/stylers/text_html/syntax",["orion/editor/stylers/lib/syntax","orion/editor/stylers/application_javascript/syntax","orion/editor/stylers/text_css/syntax","orion/editor/stylers/application_xml/syntax"],function(n,q,s,g){n=n.grammars.concat(q.grammars).concat(s.grammars).concat(g.grammars);n.push({id:"orion.html",contentTypes:["text/html"],patterns:[{begin:"(?i)(\x3cstyle)([^\x3e]*)(\x3e)",end:"(?i)(\x3c/style\x3e)",captures:{1:{name:"entity.name.tag.html"},3:{name:"entity.name.tag.html"}},
contentName:"source.css.embedded.html",patterns:[{include:"orion.css"}]},{begin:"(?i)\x3cscript\\s*\x3e|\x3cscript\\s.*?(?:language\\s*\x3d\\s*(['\"])javascript\\1|type\\s*\x3d\\s*(['\"])(?:text|application)/(?:javascript|ecmascript)\\2).*?\x3e",end:"(?i)\x3c/script\x3e",captures:{0:{name:"entity.name.tag.html"}},contentName:"source.js.embedded.html",patterns:[{include:"orion.js"}]},{include:"orion.xml#comment"},{include:"orion.xml#doctype"},{include:"orion.xml#tag"},{include:"orion.xml#ampersandEscape"}]});
return{id:n[n.length-1].id,grammars:n,keywords:[]}});
define("orion/editor/edit","require orion/editor/shim orion/editor/textView orion/editor/textModel orion/editor/textTheme orion/editor/projectionTextModel orion/editor/eventTarget orion/keyBinding orion/editor/rulers orion/editor/annotations orion/editor/tooltip orion/editor/undoStack orion/editor/textDND orion/editor/editor orion/editor/editorFeatures orion/editor/contentAssist orion/editor/cssContentAssist orion/editor/htmlContentAssist orion/editor/jsTemplateContentAssist orion/editor/AsyncStyler orion/editor/mirror orion/editor/textMateStyler orion/editor/htmlGrammar orion/editor/textStyler orion/editor/stylers/application_javascript/syntax orion/editor/stylers/text_css/syntax orion/editor/stylers/text_html/syntax".split(" "),function(n,
q,s,g,c,e,f,p,h,b,a,d,k,r,m,v,t,u,y,A,w,B,l,z,x,C,F){function M(a,b,c){for(var d;c&&c!==b&&"none"!==d;)d=a.getComputedStyle?a.getComputedStyle(c,null).getPropertyValue("display"):c.currentStyle.display,c=c.parentNode;return!c||!d?"none":d}function P(a){var b=a.firstChild;if(b&&"TEXTAREA"===b.tagName)return b.value;var c=a.ownerDocument,d=c.defaultView||c.parentWindow;if(!d.getSelection||1===a.childNodes.length&&b.nodeType===Node.TEXT_NODE||"none"===M(d,c,a))return a.innerText||a.textContent;b=c.createRange();
b.selectNode(a);a=d.getSelection();d=[];for(c=0;c<a.rangeCount;c++)d.push(a.getRangeAt(c));a.removeAllRanges();a.addRange(b);b=a.toString();a.removeAllRanges();for(c=0;c<d.length;c++)a.addRange(d[c]);return b}function Q(a){if("data-editor-"===a.substring(0,12))return a=a.substring(12),a=a.replace(/-([a-z])/ig,function(a,b){return b.toUpperCase()})}function G(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}function R(a,b){var c={};G(c,b);for(var d,e=0,f=a.attributes,g=f.length;e<g;e++){d=f.item(e);
var h=Q(d.nodeName);if(h){d=d.nodeValue;if("true"===d||"false"===d)d="true"===d;c[h]=d}}return c}function S(a,b){if(a.getElementsByClassName)return a.getElementsByClassName(b);b=b.replace(/ *$/,"");return a.querySelectorAll?a.querySelectorAll((" "+b).replace(/ +/g,".")):null}function N(a){var b=a.document||document,d=a.parent;d||(d="editor");"string"===typeof d&&(d=b.getElementById(d));if(!d&&a.className){var f=S(b,a.className);if(f){a.className=void 0;1<f.length&&void 0===a.noFocus&&(a.noFocus=!0);
for(var b=[],h=f.length-1;0<=h;h--)a.parent=f[h],b.push(N(a));return b}}if(!d)throw"no parent";a=R(d,a);if("string"===typeof a.theme){var f=c.TextTheme.getTheme(a.theme),k=a.theme.lastIndexOf("/"),l=a.theme;-1!==k&&(l=l.substring(k+1));".css"===l.substring(l.length-4)&&(l=l.substring(0,l.length-4));f.setThemeClass(l,{href:a.theme});a.theme=f}var p;a.readonly||(h={createContentAssistMode:function(a){p=new v.ContentAssist(a.getTextView());a=new v.ContentAssistWidget(p);a=new v.ContentAssistMode(p,a);
p.setMode(a);return a}});var q=new r.Editor({textViewFactory:function(){return new s.TextView({parent:d,model:new e.ProjectionTextModel(a.model?a.model:new g.TextModel("")),tabSize:a.tabSize?a.tabSize:4,readonly:a.readonly,fullSelection:a.fullSelection,tabMode:a.tabMode,expandTab:a.expandTab,singleMode:a.singleMode,themeClass:a.themeClass,theme:a.theme,wrapMode:a.wrapMode,wrappable:a.wrappable})},undoStackFactory:new m.UndoFactory,annotationFactory:new m.AnnotationFactory,lineNumberRulerFactory:new m.LineNumberRulerFactory,
foldingRulerFactory:new m.FoldingRulerFactory,textDNDFactory:new m.TextDNDFactory,contentAssistFactory:h,keyBindingFactory:new m.KeyBindingsFactory,statusReporter:a.statusReporter,domNode:d});q.addEventListener("TextViewInstalled",function(){var b=q.getLineNumberRuler();b&&void 0!==a.firstLineIndex&&b.setFirstLine(a.firstLineIndex);if(b=q.getSourceCodeActions())b.setAutoPairParentheses(a.autoPairParentheses),b.setAutoPairBraces(a.autoPairBraces),b.setAutoPairSquareBrackets(a.autoPairSquareBrackets),
b.setAutoPairAngleBrackets(a.autoPairAngleBrackets),b.setAutoPairQuotations(a.autoPairQuotations),b.setAutoCompleteComments(a.autoCompleteComments),b.setSmartIndentation(a.smartIndentation)});h=a.contents;void 0===h&&(h=P(d));h||(h="");q.installTextView();q.setLineNumberRulerVisible(void 0===a.showLinesRuler||a.showLinesRuler);q.setAnnotationRulerVisible(void 0===a.showAnnotationRuler||a.showFoldingRuler);q.setOverviewRulerVisible(void 0===a.showOverviewRuler||a.showOverviewRuler);q.setFoldingRulerVisible(void 0===
a.showFoldingRuler||a.showFoldingRuler);q.setInput(a.title,null,h,!1,a.noFocus);({styler:null,highlight:function(b,c){this.styler&&this.styler.destroy&&this.styler.destroy();this.styler=null;"js"===b?b="application/javascript":"css"===b?b="text/css":"html"===b?b="text/html":"java"===b&&(b="text/x-java-source");var d=c.getTextView(),e=c.getAnnotationModel();b&&(b=b.replace(/[*|:/".<>?+]/g,"_"),n(["./stylers/"+b+"/syntax"],function(a){this.styler=new z.TextStyler(d,e,a.grammars,a.id)}));"text/css"===
b&&c.setFoldingRulerVisible(void 0===a.showFoldingRuler||a.showFoldingRuler)}}).highlight(a.contentType||a.lang,q);if(p){var w=new t.CssContentAssistProvider,x=new u.HTMLContentAssistProvider,A=new y.JSTemplateContentAssistProvider;p.addEventListener("Activating",function(){/css$/.test(a.lang)?p.setProviders([w]):/js$/.test(a.lang)?p.setProviders([A]):/html$/.test(a.lang)&&p.setProviders([x])})}h=b.defaultView||b.parentWindow;!a.noComputeSize&&("none"!==M(h,b,d)&&50>=d.clientHeight)&&(b=q.getTextView().computeSize().height,
d.style.height=b+"px");return q}var K=this.orion?this.orion.editor:void 0;if(K)for(var L=0;L<arguments.length;L++)G(K,arguments[L]);return N});var orion=this.orion||(this.orion={}),editor=orion.editor||(orion.editor={});editor.edit=require("orion/editor/edit");