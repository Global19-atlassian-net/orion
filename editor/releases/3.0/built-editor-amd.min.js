/*

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
 Felipe Heidrich (IBM Corporation) - initial API and implementation
 Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
 Felipe Heidrich (IBM Corporation) - initial API and implementation
 Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
 Felipe Heidrich (IBM Corporation) - initial API and implementation
 Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
 Felipe Heidrich (IBM Corporation) - initial API and implementation
 Silenio Quarti (IBM Corporation) - initial API and implementation
 Mihai Sucan (Mozilla Foundation) - fix for Bug#334583 Bug#348471 Bug#349485 Bug#350595 Bug#360726 Bug#361180 Bug#362835 Bug#362428 Bug#362286 Bug#354270 Bug#361474 Bug#363945 Bug#366312 Bug#370584

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
 Felipe Heidrich (IBM Corporation) - initial API and implementation
 Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
 Felipe Heidrich (IBM Corporation) - initial API and implementation
 Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
 Felipe Heidrich (IBM Corporation) - initial API and implementation
 Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
 Felipe Heidrich (IBM Corporation) - initial API and implementation
 Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2009, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 Copyright (c) 2012 VMware, Inc.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation
 Andrew Eisenberg - rename to jsTemplateContentAssist.js

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation 

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation 

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation 

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation
 Alex Lakatos - fix for bug#369781

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation
 RequireJS i18n 1.0.0 Copyright (c) 2010-2011, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/jrburke/requirejs for details

 Copyright (c) 2011 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation
*/
define("orion/util",[],function(){var u=navigator.userAgent,r=parseFloat(u.split("MSIE")[1])||void 0,p=parseFloat(u.split("Firefox/")[1]||u.split("Minefield/")[1])||void 0,i=u.indexOf("Opera")!==-1,b=parseFloat(u.split("Chrome/")[1])||void 0,e=u.indexOf("Safari")!==-1&&!b,d=parseFloat(u.split("WebKit/")[1])||void 0,g=u.indexOf("Android")!==-1,h=u.indexOf("iPad")!==-1,u=u.indexOf("iPhone")!==-1,a=h||u,f=navigator.platform.indexOf("Mac")!==-1,o=navigator.platform.indexOf("Win")!==-1,m=navigator.platform.indexOf("Linux")!==
-1;return{formatMessage:function(a){var b=arguments;return a.replace(/\$\{([^\}]+)\}/g,function(a,c){return b[(c<<0)+1]})},createElement:function(a,b){return a.createElementNS?a.createElementNS("http://www.w3.org/1999/xhtml",b):a.createElement(b)},isIE:r,isFirefox:p,isOpera:i,isChrome:b,isSafari:e,isWebkit:d,isAndroid:g,isIPad:h,isIPhone:u,isIOS:a,isMac:f,isWindows:o,isLinux:m,platformDelimiter:o?"\r\n":"\n"}});
define("orion/editor/eventTarget",[],function(){function u(){}u.addMixin=function(r){var p=u.prototype,i;for(i in p)p.hasOwnProperty(i)&&(r[i]=p[i])};u.prototype={addEventListener:function(r,p,i){if(!this._eventTypes)this._eventTypes={};var b=this._eventTypes[r];b||(b=this._eventTypes[r]={level:0,listeners:[]});b.listeners.push({listener:p,useCapture:i})},dispatchEvent:function(r){var p=r.type;this._dispatchEvent("pre"+p,r);this._dispatchEvent(p,r);this._dispatchEvent("post"+p,r)},_dispatchEvent:function(r,
p){var i=this._eventTypes?this._eventTypes[r]:null;if(i){var b=i.listeners;try{if(i.level++,b)for(var e=0,d=b.length;e<d;e++)if(b[e]){var g=b[e].listener;typeof g==="function"?g.call(this,p):g.handleEvent&&typeof g.handleEvent==="function"&&g.handleEvent(p)}}finally{if(i.level--,i.compact&&i.level===0){for(e=b.length-1;e>=0;e--)b[e]||b.splice(e,1);b.length===0&&delete this._eventTypes[r];i.compact=!1}}}},isListening:function(r){return!this._eventTypes?!1:this._eventTypes[r]!==void 0},removeEventListener:function(r,
p,i){if(this._eventTypes){var b=this._eventTypes[r];if(b){for(var e=b.listeners,d=0,g=e.length;d<g;d++){var h=e[d];if(h&&h.listener===p&&h.useCapture===i){b.level!==0?(e[d]=null,b.compact=!0):e.splice(d,1);break}}e.length===0&&delete this._eventTypes[r]}}}};return{EventTarget:u}});
define("orion/editor/textModel",["orion/editor/eventTarget","orion/util"],function(u,r){function p(i,b){this._lastLineIndex=-1;this._text=[""];this._lineOffsets=[0];this.setText(i);this.setLineDelimiter(b)}p.prototype={find:function(i){if(this._text.length>1)this._text=[this._text.join("")];var b=i.string,e=b;!i.regex&&b&&(e=b.replace(/([\\$\^*\/+?\.\(\)|{}\[\]])/g,"\\$&"));var d=null,g;if(e){var b=i.reverse,h=i.wrap,a=i.wholeWord,f=i.caseInsensitive,o=i.start||0,m=i.end,i=i.end!==void 0,n="";n.indexOf("g")===
-1&&(n+="g");f&&n.indexOf("i")===-1&&(n+="i");a&&(e="\\b"+e+"\\b");var t=this._text[0],q,c,k=0;i&&(t=t.substring(o,m),k=o);var s=RegExp(e,n);if(b)g=function(){var j=null;for(s.lastIndex=0;;){c=s.lastIndex;q=s.exec(t);if(c===s.lastIndex)return null;if(q){if(!(q.index<o)){if(!h||j)break;o=t.length}j={start:q.index+k,end:s.lastIndex+k}}else break}if(j)o=j.start;return j};else{if(!i)s.lastIndex=o;g=function(){for(;;){c=s.lastIndex;q=s.exec(t);if(c===s.lastIndex)break;if(q)return{start:q.index+k,end:s.lastIndex+
k};if(!(c!==0&&h))break}return null}}d=g()}return{next:function(){var c=d;c&&(d=g());return c},hasNext:function(){return d!==null}}},getCharCount:function(){for(var i=0,b=0;b<this._text.length;b++)i+=this._text[b].length;return i},getLine:function(i,b){var e=this.getLineCount();if(!(0<=i&&i<e))return null;var d=this._lineOffsets[i];if(i+1<e){e=this.getText(d,this._lineOffsets[i+1]);if(b)return e;for(var d=e.length,g;(g=e.charCodeAt(d-1))===10||g===13;)d--;return e.substring(0,d)}else return this.getText(d)},
getLineAtOffset:function(i){var b=this.getCharCount();if(!(0<=i&&i<=b))return-1;var e=this.getLineCount();if(i===b)return e-1;var d,g,h=this._lastLineIndex;if(0<=h&&h<e&&(d=this._lineOffsets[h],g=h+1<e?this._lineOffsets[h+1]:b,d<=i&&i<g))return h;for(var a=e,f=-1;a-f>1;)if(h=Math.floor((a+f)/2),d=this._lineOffsets[h],g=h+1<e?this._lineOffsets[h+1]:b,i<=d)a=h;else if(i<g){a=h;break}else f=h;return this._lastLineIndex=a},getLineCount:function(){return this._lineOffsets.length},getLineDelimiter:function(){return this._lineDelimiter},
getLineEnd:function(i,b){var e=this.getLineCount();if(!(0<=i&&i<e))return-1;if(i+1<e){e=this._lineOffsets[i+1];if(b)return e;for(var d=this.getText(Math.max(this._lineOffsets[i],e-2),e),g=d.length,h;(h=d.charCodeAt(g-1))===10||h===13;)g--;return e-(d.length-g)}else return this.getCharCount()},getLineStart:function(i){return!(0<=i&&i<this.getLineCount())?-1:this._lineOffsets[i]},getText:function(i,b){i===void 0&&(i=0);b===void 0&&(b=this.getCharCount());if(i===b)return"";for(var e=0,d=0,g;d<this._text.length;){g=
this._text[d].length;if(i<=e+g)break;e+=g;d++}for(var h=e,a=d;d<this._text.length;){g=this._text[d].length;if(b<=e+g)break;e+=g;d++}if(a===d)return this._text[a].substring(i-h,b-e);h=this._text[a].substring(i-h);e=this._text[d].substring(0,b-e);return h+this._text.slice(a+1,d).join("")+e},onChanging:function(i){return this.dispatchEvent(i)},onChanged:function(i){return this.dispatchEvent(i)},setLineDelimiter:function(i,b){i==="auto"&&(i=void 0,this.getLineCount()>1&&(i=this.getText(this.getLineEnd(0),
this.getLineEnd(0,!0))));this._lineDelimiter=i?i:r.platformDelimiter;if(b){var e=this.getLineCount();if(e>1){for(var d=Array(e),g=0;g<e;g++)d[g]=this.getLine(g);this.setText(d.join(this._lineDelimiter))}}},setText:function(i,b,e){i===void 0&&(i="");b===void 0&&(b=0);e===void 0&&(e=this.getCharCount());if(!(b===e&&i==="")){for(var d=this.getLineAtOffset(b),g=this.getLineAtOffset(e),h=b,a=e-b,f=g-d,o=i.length,m=0,n=this.getLineCount(),t=0,q=0,c=0,k=[];;){t!==-1&&t<=c&&(t=i.indexOf("\r",c));q!==-1&&
q<=c&&(q=i.indexOf("\n",c));if(q===-1&&t===-1)break;c=t!==-1&&q!==-1?t+1===q?q+1:(t<q?t:q)+1:t!==-1?t+1:q+1;k.push(b+c);m++}this.onChanging({type:"Changing",text:i,start:h,removedCharCount:a,addedCharCount:o,removedLineCount:f,addedLineCount:m});k.length===0&&(t=this.getLineStart(d),g=g+1<n?this.getLineStart(g+1):this.getCharCount(),b!==t&&(i=this.getText(t,b)+i,b=t),e!==g&&(i+=this.getText(e,g),e=g));g=o-a;for(t=d+f+1;t<n;t++)this._lineOffsets[t]+=g;d=[d+1,f].concat(k);Array.prototype.splice.apply(this._lineOffsets,
d);for(g=k=0;g<this._text.length;){t=this._text[g].length;if(b<=k+t)break;k+=t;g++}n=k;for(d=g;g<this._text.length;){t=this._text[g].length;if(e<=k+t)break;k+=t;g++}t=this._text[g];b=this._text[d].substring(0,b-n);e=t.substring(e-k);d=[d,g-d+1];b&&d.push(b);i&&d.push(i);e&&d.push(e);Array.prototype.splice.apply(this._text,d);if(this._text.length===0)this._text=[""];this.onChanged({type:"Changed",start:h,removedCharCount:a,addedCharCount:o,removedLineCount:f,addedLineCount:m})}}};u.EventTarget.addMixin(p.prototype);
return{TextModel:p}});
define("orion/editor/textTheme",["require","orion/editor/eventTarget","orion/util"],function(u,r,p){function i(b){b=b||{};this._document=b.document||document}var b={};i.getTheme=function(e){var e=e||"default",d=b[e];d||(d=b[e]=new i);return d};i.prototype={getThemeClass:function(){return this._themeClass},setThemeClass:function(b,d){var g=this,h=g._themeClass;g._themeClass=b;this._load(b,d,function(){g.onThemeChanged({type:"ThemeChanged",oldValue:h,newValue:g.getThemeClass()})})},onThemeChanged:function(b){return this.dispatchEvent(b)},
buildStyleSheet:function(b,d){function g(a,d,m){h.push("."+b+" ."+a+" {");h.push("\t"+(m?"background-color":"color")+": "+d+";");h.push("}")}var h=[];h.push("");var a=d.fontFamily,a=a==="sans serif"?'"Menlo", "Consolas", "Vera Mono", "monospace"':"monospace";h.push("."+b+" {");h.push("\tfont-family: "+a+";");h.push("\tfont-size: "+d.fontSize+";");h.push("\tcolor: "+d.text+";");h.push("}");h.push("."+b+".textview {");h.push("\tbackground-color: "+d.background+";");h.push("}");g("ruler.annotations",
d.annotationRuler,!0);g("ruler.lines",d.annotationRuler,!0);g("ruler.folding",d.annotationRuler,!0);g("ruler.overview",d.overviewRuler,!0);g("rulerLines",d.lineNumber,!1);g("rulerLines.even",d.lineNumberEven,!1);g("rulerLines.odd",d.lineNumberOdd,!1);g("annotationLine.currentLine",d.currentLine,!0);g("entity-name-tag",d.keyword,!1);g("entity-other-attribute-name",d.attribute,!1);g("string-quoted",d.string,!1);g("token_keyword",d.keyword,!1);g("token_string",d.string,!1);g("token_singleline_comment",
d.comment,!1);g("token_multiline_comment",d.comment,!1);g("token_doc_comment",d.comment,!1);g("token_doc_html_markup",d.comment,!1);return h.join("\n")},_createStyle:function(b,d,g,h){var a=this._document,b="orion-theme-"+b,f=a.getElementById(b);if(f){if(h||f.firstChild.data===d)return;f.removeChild(f.firstChild);f.appendChild(a.createTextNode(d))}else h?(f=p.createElement(a,"link"),f.rel="stylesheet",f.type="text/css",f.href=d,f.addEventListener("load",function(){g()})):(f=p.createElement(a,"style"),
f.appendChild(a.createTextNode(d))),f.id=b,(a.getElementsByTagName("head")[0]||a.documentElement).appendChild(f);h||g()},_load:function(b,d,g){if(b)if(typeof d==="string")this._createStyle(b,d,g);else if(d=d.href,d.substring(d.length-4)!==".css"&&(d+=".css"),/^\//.test(d)||/[a-zA-Z0-9]+:\/\//i.test(d)||!u.toUrl)this._createStyle(b,d,g,!0);else{var h=this;u(["text!"+d],function(a){h._createStyle(b,a,g,!1)})}else g()}};r.EventTarget.addMixin(i.prototype);return{TextTheme:i}});
define("orion/editor/projectionTextModel",["orion/editor/textModel","orion/editor/eventTarget"],function(u,r){function p(i){this._model=i;this._projections=[]}p.prototype={addProjection:function(i){if(i){var b=this._model,e=this._projections;i._lineIndex=b.getLineAtOffset(i.start);i._lineCount=b.getLineAtOffset(i.end)-i._lineIndex;var d=i.text;d||(d="");i._model=typeof d==="string"?new u.TextModel(d,b.getLineDelimiter()):d;var b=this.mapOffset(i.start,!0),d=i.end-i.start,g=i._lineCount,h=i._model.getCharCount(),
a=i._model.getLineCount()-1;this.onChanging({type:"Changing",text:i._model.getText(),start:b,removedCharCount:d,addedCharCount:h,removedLineCount:g,addedLineCount:a});var f=this._binarySearch(e,i.start);e.splice(f,0,i);this.onChanged({type:"Changed",start:b,removedCharCount:d,addedCharCount:h,removedLineCount:g,addedLineCount:a})}},getProjections:function(){return this._projections.slice(0)},getBaseModel:function(){return this._model},mapOffset:function(i,b){var e=this._projections,d=0,g,h;if(b){for(g=
0;g<e.length;g++){h=e[g];if(h.start>i)break;if(h.end>i)return-1;d+=h._model.getCharCount()-(h.end-h.start)}return i+d}for(g=0;g<e.length;g++){h=e[g];if(h.start>i-d)break;var a=h._model.getCharCount();if(h.start+a>i-d)return-1;d+=a-(h.end-h.start)}return i-d},removeProjection:function(i){var b,e=0;for(b=0;b<this._projections.length;b++){var d=this._projections[b];if(d===i){i=d;break}e+=d._model.getCharCount()-(d.end-d.start)}if(b<this._projections.length){var d=this._model,e=i.start+e,g=i.end-i.start,
h=i._lineCount,a=i._model.getCharCount(),f=i._model.getLineCount()-1;this.onChanging({type:"Changing",text:d.getText(i.start,i.end),start:e,removedCharCount:a,addedCharCount:g,removedLineCount:f,addedLineCount:h});this._projections.splice(b,1);this.onChanged({type:"Changed",start:e,removedCharCount:a,addedCharCount:g,removedLineCount:f,addedLineCount:h})}},_binarySearch:function(i,b){for(var e=i.length,d=-1,g;e-d>1;)g=Math.floor((e+d)/2),b<=i[g].start?e=g:d=g;return e},getCharCount:function(){for(var i=
this._model.getCharCount(),b=this._projections,e=0;e<b.length;e++){var d=b[e];i+=d._model.getCharCount()-(d.end-d.start)}return i},getLine:function(i,b){if(i<0)return null;var e=this._model,d=this._projections,g=0,h=[],a=0,f,o,m;for(f=0;f<d.length;f++){m=d[f];if(m._lineIndex>=i-g)break;o=m._model.getLineCount()-1;if(m._lineIndex+o>=i-g)if(a=i-(m._lineIndex+g),a<o)return m._model.getLine(a,b);else h.push(m._model.getLine(o));a=m.end;g+=o-m._lineCount}for(a=Math.max(a,e.getLineStart(i-g));f<d.length;f++){m=
d[f];if(m._lineIndex>i-g)break;h.push(e.getText(a,m.start));o=m._model.getLineCount()-1;if(m._lineIndex+o>i-g)return h.push(m._model.getLine(0,b)),h.join("");h.push(m._model.getText());a=m.end;g+=o-m._lineCount}d=e.getLineEnd(i-g,b);a<d&&h.push(e.getText(a,d));return h.join("")},getLineAtOffset:function(i){for(var b=this._model,e=this._projections,d=0,g=0,h=0;h<e.length;h++){var a=e[h];if(a.start>i-d)break;var f=a._model.getCharCount();if(a.start+f>i-d){e=i-(a.start+d);g+=a._model.getLineAtOffset(e);
d+=e;break}g+=a._model.getLineCount()-1-a._lineCount;d+=f-(a.end-a.start)}return b.getLineAtOffset(i-d)+g},getLineCount:function(){for(var i=this._projections,b=this._model.getLineCount(),e=0;e<i.length;e++){var d=i[e];b+=d._model.getLineCount()-1-d._lineCount}return b},getLineDelimiter:function(){return this._model.getLineDelimiter()},getLineEnd:function(i,b){if(i<0)return-1;for(var e=this._model,d=this._projections,g=0,h=0,a=0;a<d.length;a++){var f=d[a];if(f._lineIndex>i-g)break;var o=f._model.getLineCount()-
1;if(f._lineIndex+o>i-g)return f._model.getLineEnd(i-(f._lineIndex+g),b)+f.start+h;h+=f._model.getCharCount()-(f.end-f.start);g+=o-f._lineCount}return e.getLineEnd(i-g,b)+h},getLineStart:function(i){if(i<0)return-1;for(var b=this._model,e=this._projections,d=0,g=0,h=0;h<e.length;h++){var a=e[h];if(a._lineIndex>=i-d)break;var f=a._model.getLineCount()-1;if(a._lineIndex+f>=i-d)return a._model.getLineStart(i-(a._lineIndex+d))+a.start+g;g+=a._model.getCharCount()-(a.end-a.start);d+=f-a._lineCount}return b.getLineStart(i-
d)+g},getText:function(i,b){i===void 0&&(i=0);var e=this._model,d=this._projections,g=0,h=[],a,f,o;for(a=0;a<d.length;a++){f=d[a];if(f.start>i-g)break;o=f._model.getCharCount();if(f.start+o>i-g)if(b!==void 0&&f.start+o>b-g)return f._model.getText(i-(f.start+g),b-(f.start+g));else h.push(f._model.getText(i-(f.start+g))),i=f.end+g+o-(f.end-f.start);g+=o-(f.end-f.start)}var m=i-g;if(b!==void 0){for(;a<d.length;a++){f=d[a];if(f.start>b-g)break;h.push(e.getText(m,f.start));o=f._model.getCharCount();if(f.start+
o>b-g)return h.push(f._model.getText(0,b-(f.start+g))),h.join("");h.push(f._model.getText());m=f.end;g+=o-(f.end-f.start)}h.push(e.getText(m,b-g))}else{for(;a<d.length;a++)f=d[a],h.push(e.getText(m,f.start)),h.push(f._model.getText()),m=f.end;h.push(e.getText(m))}return h.join("")},_onChanging:function(i,b,e,d,g,h){for(var a=this._model,f=this._projections,o,m=0,n,t=b+e;o<f.length;o++){e=f[o];if(e.start>b)break;m+=e._model.getCharCount()-(e.end-e.start)}b+=m;for(var q=o;o<f.length;o++){e=f[o];if(e.start>
t)break;m+=e._model.getCharCount()-(e.end-e.start);n+=e._model.getLineCount()-1-e._lineCount}e=t+m;m=o;this.onChanging(b,e-b,d,g+n,h);f.splice(f,m-q);for(i=i.length-(e-b);o<f.length;o++)e=f[o],e.start+=i,e.end+=i,e._lineIndex=a.getLineAtOffset(e.start)},onChanging:function(i){return this.dispatchEvent(i)},onChanged:function(i){return this.dispatchEvent(i)},setLineDelimiter:function(i){this._model.setLineDelimiter(i)},setText:function(i,b,e){i===void 0&&(i="");b===void 0&&(b=0);var d=b,g=e,h=this._model,
a=this._projections,f=0,o=0,m,n,t,q,c,k=0;for(m=0;m<a.length;m++){n=a[m];if(n.start>b-f)break;t=n._model.getCharCount();if(n.start+t>b-f)if(e!==void 0&&n.start+t>e-f){n._model.setText(i,b-(n.start+f),e-(n.start+f));return}else k=n._model.getLineCount()-1-n._model.getLineAtOffset(b-(n.start+f)),q={projection:n,start:b-(n.start+f)},b=n.end+f+t-(n.end-n.start);o+=n._model.getLineCount()-1-n._lineCount;f+=t-(n.end-n.start)}b-=f;var s=m,k=h.getLineAtOffset(b)+o-k;if(e!==void 0)for(;m<a.length;m++){n=a[m];
if(n.start>e-f)break;t=n._model.getCharCount();if(n.start+t>e-f){o+=n._model.getLineAtOffset(e-(n.start+f));t=e-(n.start+f);e=n.end+f;c={projection:n,end:t};break}o+=n._model.getLineCount()-1-n._lineCount;f+=t-(n.end-n.start)}else{for(;m<a.length;m++)n=a[m],o+=n._model.getLineCount()-1-n._lineCount,f+=n._model.getCharCount()-(n.end-n.start);e=g=h.getCharCount()+f}e-=f;n=h.getLineAtOffset(e)+o;g-=d;for(var o=n-k,k=i.length,j=t=n=f=0;;){n!==-1&&n<=j&&(n=i.indexOf("\r",j));t!==-1&&t<=j&&(t=i.indexOf("\n",
j));if(t===-1&&n===-1)break;j=n!==-1&&t!==-1?n+1===t?t+1:(n<t?n:t)+1:n!==-1?n+1:t+1;f++}this.onChanging({type:"Changing",text:i,start:d,removedCharCount:g,addedCharCount:k,removedLineCount:o,addedLineCount:f});h.setText(i,b,e);if(q)n=q.projection,n._model.setText("",q.start);if(c)n=c.projection,n._model.setText("",0,c.end),n.start=n.end,n._lineCount=0;a.splice(s,m-s);for(i=i.length-(e-b);m<a.length;m++)n=a[m],n.start+=i,n.end+=i,n._lineIndex=h.getLineAtOffset(n.start);this.onChanged({type:"Changed",
start:d,removedCharCount:g,addedCharCount:k,removedLineCount:o,addedLineCount:f})}};r.EventTarget.addMixin(p.prototype);return{ProjectionTextModel:p}});
define("orion/keyBinding",["orion/util"],function(u){function r(p,i,b,e,d){this.keyCode=typeof p==="string"?p.toUpperCase().charCodeAt(0):p;this.mod1=i!==void 0&&i!==null?i:!1;this.mod2=b!==void 0&&b!==null?b:!1;this.mod3=e!==void 0&&e!==null?e:!1;this.mod4=d!==void 0&&d!==null?d:!1}r.prototype={match:function(p){return this.keyCode===p.keyCode?this.mod1!==(u.isMac?p.metaKey:p.ctrlKey)?!1:this.mod2!==p.shiftKey?!1:this.mod3!==p.altKey?!1:u.isMac&&this.mod4!==p.ctrlKey?!1:!0:!1},equals:function(p){return!p?
!1:this.keyCode!==p.keyCode?!1:this.mod1!==p.mod1?!1:this.mod2!==p.mod2?!1:this.mod3!==p.mod3?!1:this.mod4!==p.mod4?!1:!0}};return{KeyBinding:r}});
define("orion/editor/textView",["orion/editor/textModel","orion/keyBinding","orion/editor/eventTarget","orion/editor/textTheme","orion/util"],function(u,r,p,i,b){function e(c,k,s,j){typeof c.addEventListener==="function"?c.addEventListener(k,s,j===!0):c.attachEvent("on"+k,s)}function d(c,k,s){if(s){k.className="";for(var s=k.attributes,j=s.length;j-- >0;)(!b.isIE||b.isIE>=9||b.isIE<9&&s[j].specified)&&k.removeAttribute(s[j].name)}if(c){if(c.styleClass)k.className=c.styleClass;if(s=c.style)for(var a in s)s.hasOwnProperty(a)&&
(k.style[a]=s[a]);if(c=c.attributes)for(var l in c)c.hasOwnProperty(l)&&k.setAttribute(l,c[l])}}function g(c){return c instanceof Array?c.slice(0):c}function h(c,k){if(c===k)return!0;if(c&&!k||!c&&k)return!1;if(c&&c.constructor===String||k&&k.constructor===String)return!1;if(c instanceof Array||k instanceof Array){if(!(c instanceof Array&&k instanceof Array))return!1;if(c.length!==k.length)return!1;for(var s=0;s<c.length;s++)if(!h(c[s],k[s]))return!1;return!0}if(!(c instanceof Object)||!(k instanceof
Object))return!1;for(s in c)if(c.hasOwnProperty(s)){if(!k.hasOwnProperty(s))return!1;if(!h(c[s],k[s]))return!1}for(s in k)if(!c.hasOwnProperty(s))return!1;return!0}function a(c,k,s){for(var j=0,a=0,l=0,b=c.length;l<b;){j!==-1&&j<=l&&(j=c.indexOf("\r",l));a!==-1&&a<=l&&(a=c.indexOf("\n",l));var f=l,d;if(a===-1&&j===-1){k(c.substring(l));break}j!==-1&&a!==-1?j+1===a?(d=j,l=a+1):(d=j<a?j:a,l=(j<a?j:a)+1):j!==-1?(d=j,l=j+1):(d=a,l=a+1);k(c.substring(f,d));s()}}function f(c){var k,s,j,a,l=c.ownerDocument.defaultView||
c.ownerDocument.parentWindow;if(l.getComputedStyle)c=l.getComputedStyle(c,null),k=c.getPropertyValue("padding-left"),s=c.getPropertyValue("padding-top"),j=c.getPropertyValue("padding-right"),a=c.getPropertyValue("padding-bottom");else if(c.currentStyle)k=c.currentStyle.paddingLeft,s=c.currentStyle.paddingTop,j=c.currentStyle.paddingRight,a=c.currentStyle.paddingBottom;return{left:parseInt(k,10)||0,top:parseInt(s,10)||0,right:parseInt(j,10)||0,bottom:parseInt(a,10)||0}}function o(c){var k,s,j,a,l=
c._trim;if(!l){var l=f(c),b=c.ownerDocument.defaultView||c.ownerDocument.parentWindow;if(b.getComputedStyle)a=b.getComputedStyle(c,null),k=a.getPropertyValue("border-left-width"),s=a.getPropertyValue("border-top-width"),j=a.getPropertyValue("border-right-width"),a=a.getPropertyValue("border-bottom-width");else if(c.currentStyle)k=c.currentStyle.borderLeftWidth,s=c.currentStyle.borderTopWidth,j=c.currentStyle.borderRightWidth,a=c.currentStyle.borderBottomWidth;k=parseInt(k,10)||0;s=parseInt(s,10)||
0;j=parseInt(j,10)||0;a=parseInt(a,10)||0;l.left+=k;l.top+=s;l.right+=j;l.bottom+=a;c._trim=l}return l}function m(c,k,s){this.start=c;this.end=k;this.caret=s}function n(c){this.left=c.left;this.top=c.top;this.right=c.right;this.bottom=c.bottom}function t(c,k,s){this.view=c;this.lineIndex=k;this._lineDiv=s}function q(c){this._init(c||{})}m.prototype={clone:function(){return new m(this.start,this.end,this.caret)},collapse:function(){this.caret?this.end=this.start:this.start=this.end},extend:function(c){this.caret?
this.start=c:this.end=c;if(this.start>this.end)c=this.start,this.start=this.end,this.end=c,this.caret=!this.caret},setCaret:function(c){this.end=this.start=c;this.caret=!1},getCaret:function(){return this.caret?this.start:this.end},toString:function(){return"start="+this.start+" end="+this.end+(this.caret?" caret is at start":" caret is at end")},isEmpty:function(){return this.start===this.end},equals:function(c){return this.caret===c.caret&&this.start===c.start&&this.end===c.end}};n.prototype={toString:function(){return"{l="+
this.left+", t="+this.top+", r="+this.right+", b="+this.bottom+"}"}};t.prototype={create:function(c,k){if(!this._lineDiv){var s=this._lineDiv=this._createLine(c,k,this.lineIndex);s._line=this;return s}},_createLine:function(c,k,s){var j=this.view,a=j._model,l=a.getLine(s),f=a.getLineStart(s),e={type:"LineStyle",textView:j,lineIndex:s,lineText:l,lineStart:f};if(l.length<2E3)j.onLineStyle(e);a=k||b.createElement(c.ownerDocument,"div");if(!k||!h(k.viewStyle,e.style)){d(e.style,a,k);if(k)k._trim=null;
a.viewStyle=e.style;a.setAttribute("role","presentation")}a.lineIndex=s;s=[];this._createRanges(e.ranges,l,0,l.length,f,{tabOffset:0,ranges:s});l=" ";!j._fullSelection&&b.isIE<9&&(l="\ufeff");b.isWebkit&&(l="\u200c");s.push({text:l,style:j._metrics.largestFontStyle,ignoreChars:1});var m,o,g,n,i,l=j=0,t,q;if(k){if(o=k.modelChangedEvent)o.removedLineCount===0&&o.addedLineCount===0?(q=o.start-f,t=o.addedCharCount-o.removedCharCount):q=-1,k.modelChangedEvent=void 0;o=k.firstChild}for(f=0;f<s.length;f++){m=
s[f];n=m.text;j+=n.length;e=m.style;if(o)if(i=o.firstChild.data,g=o.viewStyle,i===n&&h(e,g)){l+=i.length;o._rectsCache=void 0;m=o=o.nextSibling;continue}else for(;o;){if(q!==-1){g=j;g>=q&&(g-=t);i=(i=o.firstChild.data)?i.length:0;if(l+i>g)break;l+=i}g=o.nextSibling;a.removeChild(o);o=g}m=this._createSpan(a,n,e,m.ignoreChars);o?a.insertBefore(m,o):a.appendChild(m);if(k)k.lineWidth=void 0}if(k)for(c=m?m.nextSibling:null;c;)g=c.nextSibling,k.removeChild(c),c=g;else c.appendChild(a);return a},_createRanges:function(c,
k,s,j,a,l){if(!(s>=j)){if(c)for(var b=0;b<c.length;b++){var f=c[b];if(!(f.end<=a+s)){var d=Math.max(a+s,f.start)-a;if(d>=j)break;var e=Math.min(a+j,f.end)-a;if(d<e){d=Math.max(s,d);e=Math.min(j,e);for(s<d&&this._createRange(k,s,d,null,l);b+1<c.length&&c[b+1].start-a===e&&h(f.style,c[b+1].style);)f=c[b+1],e=Math.min(a+j,f.end)-a,b++;this._createRange(k,d,e,f.style,l);s=e}}}s<j&&this._createRange(k,s,j,null,l)}},_createRange:function(c,k,s,j,a){if(!(k>=s)){var l=this.view._customTabSize;if(l&&l!==8)for(var b=
c.indexOf("\t",k);b!==-1&&b<s;){k<b&&(k={text:c.substring(k,b),style:j},a.ranges.push(k),a.tabOffset+=k.text.length);k=l-a.tabOffset%l;if(k>0){for(var f="\u00a0",d=1;d<k;d++)f+=" ";k={text:f,style:j,ignoreChars:k-1};a.ranges.push(k);a.tabOffset+=k.text.length}k=b+1;b=c.indexOf("\t",k)}k<s&&(k={text:c.substring(k,s),style:j},a.ranges.push(k),a.tabOffset+=k.text.length)}},_createSpan:function(c,k,s,j){var a=s&&s.tagName==="A";if(a)c.hasLink=!0;var a=a&&this.view._linksVisible?"a":"span",l=c.ownerDocument,
c=b.createElement(c.ownerDocument,a);c.appendChild(l.createTextNode(k));d(s,c);if(a==="A"){var f=this.view,m=this._getWindow();e(c,"click",function(c){return f._handleLinkClick(c?c:m.event)},!1)}c.viewStyle=s;if(j)c.ignoreChars=j;return c},_ensureCreated:function(){return this._lineDiv?this._lineDiv:this._createdDiv=this.create(this.view._clientDiv,null)},getBoundingClientRect:function(c,k){var s=this._ensureCreated(),j=this.view;if(c===void 0)return this._getLineBoundingClientRect(s,!0);var a=j._model,
l=s.ownerDocument,f=this.lineIndex,d=null;if(c<a.getLineEnd(f)){a=a.getLineStart(f);for(f=s.firstChild;f;){var e=f.firstChild,m=e.length;f.ignoreChars&&(m-=f.ignoreChars);if(a+m>c){d=c-a;if(j._isRangeRects)l=l.createRange(),l.setStart(e,d),l.setEnd(e,d+1),d=new n(l.getBoundingClientRect());else if(b.isIE)l=l.body.createTextRange(),l.moveToElementText(f),l.collapse(),l.moveEnd("character",d+1),l.moveStart("character",d),d=new n(l.getBoundingClientRect());else{var o=e.data;f.removeChild(e);f.appendChild(l.createTextNode(o.substring(0,
d)));var h=b.createElement(l,"span");h.appendChild(l.createTextNode(o.substring(d,d+1)));f.appendChild(h);f.appendChild(l.createTextNode(o.substring(d+1)));d=new n(h.getBoundingClientRect());f.innerHTML="";f.appendChild(e);this._createdDiv||(l=j._getSelection(),(a<=l.start&&l.start<a+m||a<=l.end&&l.end<a+m)&&j._updateDOMSelection())}b.isIE&&(l=s.ownerDocument.defaultView||s.ownerDocument.parentWindow,s=l.screen.logicalXDPI/l.screen.deviceXDPI,l=l.screen.logicalYDPI/l.screen.deviceYDPI,d.left*=s,d.right*=
s,d.top*=l,d.bottom*=l);break}a+=m;f=f.nextSibling}}s=this.getBoundingClientRect();if(!d)j._wrapMode?(j=this.getClientRects(),d=j[j.length-1],d.left=d.right,d.left+=s.left,d.top+=s.top,d.right+=s.left,d.bottom+=s.top):(d=new n(s),d.left=d.right);if(k||k===void 0)d.left-=s.left,d.top-=s.top,d.right-=s.left,d.bottom-=s.top;return d},_getClientRects:function(c,k){var s,j,a,l;if(!c._rectsCache){s=c.getClientRects();j=Array(s.length);for(l=0;l<s.length;l++)a=j[l]=new n(s[l]),a.left-=k.left,a.top-=k.top,
a.right-=k.left,a.bottom-=k.top;c._rectsCache=j}s=c._rectsCache;j=[s.length];for(l=0;l<s.length;l++)j[l]=new n(s[l]);return j},getClientRects:function(c){if(!this.view._wrapMode)return[this.getBoundingClientRect()];for(var k=this._ensureCreated(),s=[],j=k.firstChild,a,l=k.getBoundingClientRect();j;){for(var b=this._getClientRects(j,l),k=0;k<b.length;k++){var f=b[k],d;if(f.top!==f.bottom){var e=f.top+(f.bottom-f.top)/2;for(d=0;d<s.length;d++)if(a=s[d],a.top<=e&&e<a.bottom)break;if(d===s.length)s.push(f);
else{if(f.left<a.left)a.left=f.left;if(f.top<a.top)a.top=f.top;if(f.right>a.right)a.right=f.right;if(f.bottom>a.bottom)a.bottom=f.bottom}}}j=j.nextSibling}return c!==void 0?s[c]:s},_getLineBoundingClientRect:function(c,k){var s=new n(c.getBoundingClientRect());if(!this.view._wrapMode){s.right=s.left;for(var j=c.lastChild;j&&j.ignoreChars===j.firstChild.length;)j=j.previousSibling;if(j)j=j.getBoundingClientRect(),s.right=j.right+o(c).right}k&&(j=o(c),s.left+=j.left,s.right-=j.right);return s},getLineCount:function(){return!this.view._wrapMode?
1:this.getClientRects().length},getLineIndex:function(c){if(!this.view._wrapMode)return 0;for(var k=this.getClientRects(),c=this.getBoundingClientRect(c),c=c.top+(c.bottom-c.top)/2,s=0;s<k.length;s++)if(k[s].top<=c&&c<k[s].bottom)return s;return k.length-1},getLineStart:function(c){if(!this.view._wrapMode||c===0)return this.view._model.getLineStart(c);var k=this.getClientRects();return this.getOffset(k[c].left+1,k[c].top+1)},getOffset:function(c,k){var s=this.view,j=s._model,a=this.lineIndex,l=j.getLineStart(a),
j=j.getLineEnd(a);if(l===j)return l;var f=this._ensureCreated(),a=this.getBoundingClientRect(),d,e;if(s._wrapMode){d=this.getClientRects();if(k<d[0].top)k=d[0].top;for(var m=0;m<d.length;m++)if(e=d[m],e.top<=k&&k<e.bottom)break;if(c<e.left)c=e.left;c>e.right&&(c=e.right-1)}else c<0&&(c=0),c>a.right-a.left&&(c=a.right-a.left);var o=f.ownerDocument,m=o.defaultView||o.parentWindow,h=b.isIE?m.screen.logicalXDPI/m.screen.deviceXDPI:1,g=b.isIE?m.screen.logicalYDPI/m.screen.deviceYDPI:1,m=l,n=f.firstChild;
a:for(;n;){var i=n.firstChild,f=i.length;n.ignoreChars&&(f-=n.ignoreChars);var t,q,p;d=this._getClientRects(n,a);for(var r=0;r<d.length;r++)if(e=d[r],e.left<=c&&c<e.right&&(!s._wrapMode||e.top<=k&&k<e.bottom)){if(b.isIE||s._isRangeRects){for(var o=s._isRangeRects?o.createRange():o.body.createTextRange(),r=f,u=-1;r-u>1;){var A=Math.floor((r+u)/2);e=u+1;d=A===f-1&&n.ignoreChars?i.length:A+1;s._isRangeRects?(o.setStart(i,e),o.setEnd(i,d)):(o.moveToElementText(n),o.move("character",e),o.moveEnd("character",
d-e));d=o.getClientRects();for(var G=!1,C=0;C<d.length;C++)if(e=d[C],t=e.left*h-a.left,p=e.right*h-a.left,q=e.top*g-a.top,e=e.bottom*g-a.top,t<=c&&c<p&&(!s._wrapMode||q<=k&&k<e)){G=!0;break}G?r=A:u=A}m+=r;e=r;d=r===f-1&&n.ignoreChars?i.length:Math.min(r+1,i.length);s._isRangeRects?(o.setStart(i,e),o.setEnd(i,d)):(o.moveToElementText(n),o.move("character",e),o.moveEnd("character",d-e));e=o.getClientRects()[0];t=e.left*h-a.left;p=e.right*h-a.left;c>t+(p-t)/2&&m++}else{e=[];for(h=0;h<f;h++)e.push("<span>"),
h===f-1?e.push(i.data.substring(h)):e.push(i.data.substring(h,h+1)),e.push("</span>");n.innerHTML=e.join("");for(h=n.firstChild;h;){e=h.getBoundingClientRect();t=e.left-a.left;p=e.right-a.left;if(t<=c&&c<p){c>t+(p-t)/2&&m++;break}m++;h=h.nextSibling}if(!this._createdDiv)n.innerHTML="",n.appendChild(i),a=s._getSelection(),(m<=a.start&&a.start<m+f||m<=a.end&&a.end<m+f)&&s._updateDOMSelection()}break a}m+=f;n=n.nextSibling}return Math.min(j,Math.max(l,m))},getNextOffset:function(c,k,s){return k==="line"?
(k=this.view._model,c=k.getLineAtOffset(c),s>0?k.getLineEnd(c):k.getLineStart(c)):k==="wordend"?this._getNextOffset_W3C(c,k,s):b.isIE?this._getNextOffset_IE(c,k,s):this._getNextOffset_W3C(c,k,s)},_getNextOffset_W3C:function(c,k,s){function a(c){return 33<=c&&c<=47||58<=c&&c<=64||91<=c&&c<=94||c===96||123<=c&&c<=126}if(k==="word"||k==="wordend"){var b=this.view._model,l=b.getLineAtOffset(c),f=b.getLine(l),d=b.getLineStart(l),l=b.getLineEnd(l),b=f.length;c-=d;var e,m;if(s>0){if(c===b)return l;e=f.charCodeAt(c);
m=a(e);s=!m&&!(e===32||e===9);for(c++;c<b;){e=f.charCodeAt(c);l=a(e);if(k==="wordend"){if(!l&&m)break}else if(l&&!m)break;e=!l&&!(e===32||e===9);if(k==="wordend"){if(!e&&s)break}else if(e&&!s)break;s=e;m=l;c++}}else{if(c===0)return d;c--;e=f.charCodeAt(c);m=a(e);for(s=!m&&!(e===32||e===9);0<c;){e=f.charCodeAt(c-1);l=a(e);if(k==="wordend"){if(l&&!m)break}else if(!l&&m)break;e=!l&&!(e===32||e===9);if(k==="wordend"){if(e&&!s)break}else if(!e&&s)break;s=e;m=l;c--}}return d+c}return c+s},_getNextOffset_IE:function(c,
k,s){var a=this._ensureCreated(),b=this.view._model,l=this.lineIndex,f=0,d;d=b.getLineStart(l);var e=a.ownerDocument;if(c===b.getLineEnd(l))f=e.body.createTextRange(),f.moveToElementText(a.lastChild),d=f.text.length,f.moveEnd(k,s),f=c+f.text.length-d;else if(c===d&&s<0)f=d;else for(a=a.firstChild;a;){b=a.firstChild.length;a.ignoreChars&&(b-=a.ignoreChars);if(d+b>c){f=e.body.createTextRange();c===d&&s<0?f.moveToElementText(a.previousSibling):(f.moveToElementText(a),f.collapse(),f.moveEnd("character",
c-d));d=f.text.length;f.moveEnd(k,s);f=c+f.text.length-d;break}d=b+d;a=a.nextSibling}return f},destroy:function(){var c=this._createdDiv;if(c)c.parentNode.removeChild(c),this._createdDiv=null}};q.prototype={addRuler:function(c,k){c.setView(this);var s=this._rulers;if(k!==void 0){var a,b;for(a=0,b=0;a<s.length&&b<k;a++)c.getLocation()===s[a].getLocation()&&b++;s.splice(b,0,c);k=b}else s.push(c);this._createRuler(c,k);this._update()},computeSize:function(){var c=0,k=0,s=this._model,a=this._clientDiv;
if(!a)return{width:c,height:k};var f=a.style.width;if(b.isWebkit)a.style.width="0x7fffffffpx";for(var s=s.getLineCount(),l=0;l<s;l++){var d=this._getLine(l),e=d.getBoundingClientRect(),c=Math.max(c,e.right-e.left);k+=e.bottom-e.top;d.destroy()}if(b.isWebkit)a.style.width=f;a=this._getViewPadding();c+=a.right+a.left;k+=a.bottom+a.top;return{width:c,height:k}},convert:function(c,k,a){if(this._clientDiv){var j=this._getScroll(),b=this._getViewPadding(),l=this._viewDiv.getBoundingClientRect();k==="document"&&
(c.x!==void 0&&(c.x+=-j.x+l.left+b.left),c.y!==void 0&&(c.y+=-j.y+l.top+b.top));a==="document"&&(c.x!==void 0&&(c.x+=j.x-l.left-b.left),c.y!==void 0&&(c.y+=j.y-l.top-b.top));return c}},destroy:function(){for(var c=0;c<this._rulers.length;c++)this._rulers[c].setView(null);this.rulers=null;this._destroyView();this.onDestroy({type:"Destroy"});this._actions=this._keyBindings=this._doubleClickSelection=this._selection=this._theme=this._model=this._parent=null},focus:function(){this._clientDiv&&(this._updateDOMSelection(),
b.isOpera&&this._clientDiv.blur(),this._clientDiv.focus(),this._updateDOMSelection())},hasFocus:function(){return this._hasFocus},getActionDescription:function(c){if(c=this._actions[c])return c.actionDescription},getActions:function(c){var k=[],a=this._actions,j;for(j in a)a.hasOwnProperty(j)&&(c||!a[j].defaultHandler)&&k.push(j);return k},getBottomIndex:function(c){return!this._clientDiv?0:this._getBottomIndex(c)},getBottomPixel:function(){return!this._clientDiv?0:this._getScroll().y+this._getClientHeight()},
getCaretOffset:function(){return this._getSelection().getCaret()},getClientArea:function(){if(!this._clientDiv)return{x:0,y:0,width:0,height:0};var c=this._getScroll();return{x:c.x,y:c.y,width:this._getClientWidth(),height:this._getClientHeight()}},getHorizontalPixel:function(){return!this._clientDiv?0:this._getScroll().x},getKeyBindings:function(c){for(var k=[],a=this._keyBindings,j=0;j<a.length;j++)a[j].actionID===c&&k.push(a[j].keyBinding);return k},getLineHeight:function(c){return!this._clientDiv?
0:this._getLineHeight(c)},getLineIndex:function(c){return!this._clientDiv?0:this._getLineIndex(c)},getLinePixel:function(c){return!this._clientDiv?0:this._getLinePixel(c)},getLocationAtOffset:function(c){if(!this._clientDiv)return{x:0,y:0};var k=this._model,c=Math.min(Math.max(0,c),k.getCharCount()),k=k.getLineAtOffset(c),a=this._getLine(k),c=a.getBoundingClientRect(c);a.destroy();a=c.left;k=this._getLinePixel(k)+c.top;return{x:a,y:k}},getOptions:function(){var c;if(arguments.length===0)c=this._defaultOptions();
else if(arguments.length===1){if(c=arguments[0],typeof c==="string")return g(this["_"+c])}else{c={};for(var k in arguments)arguments.hasOwnProperty(k)&&(c[arguments[k]]=void 0)}for(var a in c)c.hasOwnProperty(a)&&(c[a]=g(this["_"+a]));return c},getModel:function(){return this._model},getOffsetAtLocation:function(c,k){if(!this._clientDiv)return 0;var a=this._getLineIndex(k),j=this._getLine(a),a=j.getOffset(c,k-this._getLinePixel(a));j.destroy();return a},getRulers:function(){return this._rulers.slice(0)},
getSelection:function(){var c=this._getSelection();return{start:c.start,end:c.end}},getText:function(c,k){return this._model.getText(c,k)},getTopIndex:function(c){return!this._clientDiv?0:this._getTopIndex(c)},getTopPixel:function(){return!this._clientDiv?0:this._getScroll().y},invokeAction:function(c,k){if(this._clientDiv){var a=this._actions[c];if(a){if(!k&&a.handler&&a.handler())return;if(a.defaultHandler)return a.defaultHandler()}return!1}},isDestroyed:function(){return!this._clientDiv},onContextMenu:function(c){return this.dispatchEvent(c)},
onDragStart:function(c){return this.dispatchEvent(c)},onDrag:function(c){return this.dispatchEvent(c)},onDragEnd:function(c){return this.dispatchEvent(c)},onDragEnter:function(c){return this.dispatchEvent(c)},onDragOver:function(c){return this.dispatchEvent(c)},onDragLeave:function(c){return this.dispatchEvent(c)},onDrop:function(c){return this.dispatchEvent(c)},onDestroy:function(c){return this.dispatchEvent(c)},onLineStyle:function(c){return this.dispatchEvent(c)},onModelChanged:function(c){return this.dispatchEvent(c)},
onModelChanging:function(c){return this.dispatchEvent(c)},onModify:function(c){return this.dispatchEvent(c)},onMouseDown:function(c){return this.dispatchEvent(c)},onMouseUp:function(c){return this.dispatchEvent(c)},onMouseMove:function(c){return this.dispatchEvent(c)},onMouseOver:function(c){return this.dispatchEvent(c)},onMouseOut:function(c){return this.dispatchEvent(c)},onSelection:function(c){return this.dispatchEvent(c)},onScroll:function(c){return this.dispatchEvent(c)},onVerify:function(c){return this.dispatchEvent(c)},
onFocus:function(c){return this.dispatchEvent(c)},onBlur:function(c){return this.dispatchEvent(c)},redraw:function(){if(!(this._redrawCount>0)){var c=this._model.getLineCount();this.redrawRulers(0,c);this.redrawLines(0,c)}},redrawRulers:function(c,k){if(!(this._redrawCount>0))for(var a=this.getRulers(),j=0;j<a.length;j++)this.redrawLines(c,k,a[j])},redrawLines:function(c,k,a){if(!(this._redrawCount>0)&&(c===void 0&&(c=0),k===void 0&&(k=this._model.getLineCount()),c!==k)){var j=this._clientDiv;if(j){if(a)for(j=
(a.getLocation()==="left"?this._leftDiv:this._rightDiv).firstChild;j;){if(j._ruler===a)break;j=j.nextSibling}a?j.rulerChanged=!0:this._lineHeight&&this._resetLineHeight(c,k);if(!a||a.getOverview()==="page")for(j=j.firstChild;j;){var b=j.lineIndex;if(c<=b&&b<k)j.lineChanged=!0;j=j.nextSibling}if(!a&&!this._wrapMode&&c<=this._maxLineIndex&&this._maxLineIndex<k)this._checkMaxLineIndex=this._maxLineIndex,this._maxLineIndex=-1,this._maxLineWidth=0;this._queueUpdate()}}},redrawRange:function(c,k){if(!(this._redrawCount>
0)){var a=this._model;c===void 0&&(c=0);k===void 0&&(k=a.getCharCount());var j=a.getLineAtOffset(c),a=a.getLineAtOffset(Math.max(c,k-1))+1;this.redrawLines(j,a)}},removeRuler:function(c){for(var k=this._rulers,a=0;a<k.length;a++)if(k[a]===c){k.splice(a,1);c.setView(null);this._destroyRuler(c);this._update();break}},resize:function(){this._clientDiv&&this._handleResize(null)},setAction:function(c,k,a){if(c){var j=this._actions,b=j[c];b||(b=j[c]={});b.handler=k;b.actionDescription=a}},setKeyBinding:function(c,
k){for(var a=this._keyBindings,j=0;j<a.length;j++){var b=a[j];if(b.keyBinding.equals(c)){k?b.actionID=k:b.predefined?b.actionID=null:a.splice(j,1);return}}k&&a.push({keyBinding:c,actionID:k})},setCaretOffset:function(c,k){var a=this._model.getCharCount(),c=Math.max(0,Math.min(c,a));this._setSelection(new m(c,c,!1),k===void 0||k)},setHorizontalPixel:function(c){this._clientDiv&&(c=Math.max(0,c),this._scrollView(c-this._getScroll().x,0))},setRedraw:function(c){c?--this._redrawCount===0&&this.redraw():
this._redrawCount++},setModel:function(c){if(c&&c!==this._model){this._model.removeEventListener("preChanging",this._modelListener.onChanging);this._model.removeEventListener("postChanged",this._modelListener.onChanged);var k=this._model.getLineCount(),a=this._model.getCharCount(),j=c.getLineCount(),b=c.getCharCount(),l={type:"ModelChanging",text:c.getText(),start:0,removedCharCount:a,addedCharCount:b,removedLineCount:k,addedLineCount:j};this.onModelChanging(l);this._model=c;l={type:"ModelChanged",
start:0,removedCharCount:a,addedCharCount:b,removedLineCount:k,addedLineCount:j};this.onModelChanged(l);this._model.addEventListener("preChanging",this._modelListener.onChanging);this._model.addEventListener("postChanged",this._modelListener.onChanged);this._reset();this._update()}},setOptions:function(c){var k=this._defaultOptions(),a;for(a in c)if(c.hasOwnProperty(a)){var j=c[a];if(!h(this["_"+a],j)){var b=k[a]?k[a].update:null;b?b.call(this,j):this["_"+a]=g(j)}}},setSelection:function(c,k,a){var j=
c>k;if(j)var b=c,c=k,k=b;b=this._model.getCharCount();c=Math.max(0,Math.min(c,b));k=Math.max(0,Math.min(k,b));this._setSelection(new m(c,k,j),a===void 0||a)},setText:function(c,k,a){var j=k===void 0&&a===void 0;k===void 0&&(k=0);a===void 0&&(a=this._model.getCharCount());this._modifyContent({text:c,start:k,end:a,_code:!0},!j);if(j)this._columnX=-1,this._setSelection(new m(0,0,!1),!0),b.isFirefox&&this._fixCaret()},setTopIndex:function(c){this._clientDiv&&this._scrollView(0,this._getLinePixel(Math.max(0,
c))-this._getScroll().y)},setTopPixel:function(c){this._clientDiv&&this._scrollView(0,Math.max(0,c)-this._getScroll().y)},showSelection:function(){return this._showCaret(!0)},update:function(c,k){this._clientDiv&&(c&&this._updateStyle(),k===void 0||k?this._update():this._queueUpdate())},_handleRootMouseDown:function(c){if(b.isFirefox&&c.which===1)this._clientDiv.contentEditable=!1,this._ignoreBlur=(this._overlayDiv||this._clientDiv).draggable=!0;var k=this._overlayDiv||this._clientDiv;if(b.isIE<9)k=
this._viewDiv;for(var a=c.target?c.target:c.srcElement;a;){if(k===a)return;a=a.parentNode}c.preventDefault&&c.preventDefault();c.stopPropagation&&c.stopPropagation();if(!this._isW3CEvents){var j=this;this._getWindow().setTimeout(function(){j._clientDiv.focus()},0)}},_handleRootMouseUp:function(c){if(b.isFirefox&&c.which===1)this._clientDiv.contentEditable=!0,(this._overlayDiv||this._clientDiv).draggable=!1,this._fixCaret(),this._ignoreBlur=!1},_handleBlur:function(){if(!this._ignoreBlur){this._hasFocus=
!1;if(b.isIE<9&&!this._getSelection().isEmpty()){var c=this._rootDiv,k=b.createElement(c.ownerDocument,"div");c.appendChild(k);c.removeChild(k)}if(this._selDiv1)if(this._selDiv1.style.background="lightgray",this._selDiv2.style.background="lightgray",this._selDiv3.style.background="lightgray",c=this._getWindow(),k=this._selDiv1.ownerDocument,c.getSelection){k=c.getSelection();for(c=k.anchorNode;c;){if(c===this._clientDiv){k.rangeCount>0&&k.removeAllRanges();break}c=c.parentNode}}else if(k.selection){this._ignoreSelect=
!1;for(c=k.selection.createRange().parentElement();c;){if(c===this._clientDiv){k.selection.empty();break}c=c.parentNode}this._ignoreSelect=!0}if(!this._ignoreFocus)this.onBlur({type:"Blur"})}},_handleContextMenu:function(c){b.isIE&&this._lastMouseButton===3&&this._updateDOMSelection();var k=!1;if(this.isListening("ContextMenu"))k=this._createMouseEvent("ContextMenu",c),k.screenX=c.screenX,k.screenY=c.screenY,this.onContextMenu(k),k=k.defaultPrevented;if(k)return c.preventDefault&&c.preventDefault(),
!1},_handleCopy:function(c){if(!this._ignoreCopy&&this._doCopy(c))return c.preventDefault&&c.preventDefault(),!1},_handleCut:function(c){if(this._doCut(c))return c.preventDefault&&c.preventDefault(),!1},_handleDataModified:function(){this._startIME()},_handleDblclick:function(c){this._lastMouseTime=c.timeStamp?c.timeStamp:(new Date).getTime();if(this._clickCount!==2)this._clickCount=2,this._handleMouse(c)},_handleDragStart:function(c){if(b.isFirefox){var k=this;this._getWindow().setTimeout(function(){k._clientDiv.contentEditable=
!0;k._clientDiv.draggable=!1;k._ignoreBlur=!1},0)}if(this.isListening("DragStart")&&this._dragOffset!==-1)this._isMouseDown=!1,this.onDragStart(this._createMouseEvent("DragStart",c)),this._dragOffset=-1;else return c.preventDefault&&c.preventDefault(),!1},_handleDrag:function(c){if(this.isListening("Drag"))this.onDrag(this._createMouseEvent("Drag",c))},_handleDragEnd:function(c){this._dropTarget=!1;this._dragOffset=-1;if(this.isListening("DragEnd"))this.onDragEnd(this._createMouseEvent("DragEnd",
c));b.isFirefox&&(this._fixCaret(),c.dataTransfer.dropEffect==="none"&&!c.dataTransfer.mozUserCancelled&&this._fixCaret())},_handleDragEnter:function(c){var k=!0;this._dropTarget=!0;this.isListening("DragEnter")&&(k=!1,this.onDragEnter(this._createMouseEvent("DragEnter",c)));if(b.isWebkit||k)return c.preventDefault&&c.preventDefault(),!1},_handleDragOver:function(c){var k=!0;this.isListening("DragOver")&&(k=!1,this.onDragOver(this._createMouseEvent("DragOver",c)));if(b.isWebkit||k){if(k)c.dataTransfer.dropEffect=
"none";c.preventDefault&&c.preventDefault();return!1}},_handleDragLeave:function(c){this._dropTarget=!1;if(this.isListening("DragLeave"))this.onDragLeave(this._createMouseEvent("DragLeave",c))},_handleDrop:function(c){this._dropTarget=!1;if(this.isListening("Drop"))this.onDrop(this._createMouseEvent("Drop",c));c.preventDefault&&c.preventDefault();return!1},_handleFocus:function(){this._hasFocus=!0;b.isIOS&&this._lastTouchOffset!==void 0?(this.setCaretOffset(this._lastTouchOffset,!0),this._lastTouchOffset=
void 0):this._updateDOMSelection();if(this._selDiv1){var c=this._highlightRGB;this._selDiv1.style.background=c;this._selDiv2.style.background=c;this._selDiv3.style.background=c}if(!this._ignoreFocus)this.onFocus({type:"Focus"})},_handleKeyDown:function(c){var k=!1;switch(c.keyCode){case 16:case 17:case 18:case 91:k=!0;break;default:this._setLinksVisible(!1)}if(c.keyCode===229){if(this._readonly)return c.preventDefault&&c.preventDefault(),!1;k=!0;b.isSafari&&b.isMac&&c.ctrlKey&&(k=!1);k&&this._startIME()}else k||
this._commitIME();if((b.isMac||b.isLinux)&&b.isFirefox<4||b.isOpera)return this._keyDownEvent=c,!0;if(this._doAction(c))return c.preventDefault?(c.preventDefault(),c.stopPropagation()):(c.cancelBubble=!0,c.returnValue=!1,c.keyCode=0),!1},_handleKeyPress:function(c){if(b.isMac&&b.isWebkit&&(63232<=c.keyCode&&c.keyCode<=63487||c.keyCode===13||c.keyCode===8))return c.preventDefault&&c.preventDefault(),!1;if(((b.isMac||b.isLinux)&&b.isFirefox<4||b.isOpera)&&this._doAction(this._keyDownEvent))return c.preventDefault&&
c.preventDefault(),!1;var k=b.isMac?c.metaKey:c.ctrlKey;if(c.charCode!==void 0&&k)switch(c.charCode){case 99:case 118:case 120:return!0}k=!1;if(b.isMac){if(c.ctrlKey||c.metaKey)k=!0}else if(b.isFirefox){if(c.ctrlKey||c.altKey)k=!0}else c.ctrlKey^c.altKey&&(k=!0);if(!k&&(k=b.isOpera?c.which:c.charCode!==void 0?c.charCode:c.keyCode,k>31))return this._doContent(String.fromCharCode(k)),c.preventDefault&&c.preventDefault(),!1},_handleKeyUp:function(c){(b.isMac?c.metaKey:c.ctrlKey)||this._setLinksVisible(!1);
c.keyCode===13&&this._commitIME()},_handleLinkClick:function(c){if(!(b.isMac?c.metaKey:c.ctrlKey))return c.preventDefault&&c.preventDefault(),!1},_handleMouse:function(c){var k=this._getWindow(),a=!0,j=k;if(b.isIE||b.isFirefox&&!this._overlayDiv)j=this._clientDiv;if(this._overlayDiv){if(this._hasFocus)this._ignoreFocus=!0;var f=this;k.setTimeout(function(){f.focus();f._ignoreFocus=!1},0)}this._clickCount===1?(a=this._setSelectionTo(c.clientX,c.clientY,c.shiftKey,!b.isOpera&&this._hasFocus&&this.isListening("DragStart")))&&
this._setGrab(j):(this._isW3CEvents&&this._setGrab(j),this._doubleClickSelection=null,this._setSelectionTo(c.clientX,c.clientY,c.shiftKey),this._doubleClickSelection=this._getSelection());return a},_handleMouseDown:function(c){if(this._linksVisible)if((c.target||c.srcElement).tagName!=="A")this._setLinksVisible(!1);else return;this._commitIME();var k=c.which;k||(c.button===4&&(k=2),c.button===2&&(k=3),c.button===1&&(k=1));var a=k!==2&&c.timeStamp?c.timeStamp:(new Date).getTime(),j=a-this._lastMouseTime,
f=Math.abs(this._lastMouseX-c.clientX),l=Math.abs(this._lastMouseY-c.clientY),d=this._lastMouseButton===k;this._lastMouseX=c.clientX;this._lastMouseY=c.clientY;this._lastMouseTime=a;this._lastMouseButton=k;if(k===1)this._isMouseDown=!0,d&&j<=this._clickTime&&f<=this._clickDist&&l<=this._clickDist?this._clickCount++:this._clickCount=1;if(this.isListening("MouseDown")&&(a=this._createMouseEvent("MouseDown",c),this.onMouseDown(a),a.defaultPrevented)){c.preventDefault();return}if(k===1&&this._handleMouse(c)&&
(b.isIE>=9||b.isOpera||b.isChrome||b.isSafari||b.isFirefox&&!this._overlayDiv))this._hasFocus||this.focus(),c.preventDefault();b.isFirefox&&this._lastMouseButton===3&&this._updateDOMSelection()},_handleMouseOver:function(c){if(this.isListening("MouseOver"))this.onMouseOver(this._createMouseEvent("MouseOver",c))},_handleMouseOut:function(c){if(this.isListening("MouseOut"))this.onMouseOut(this._createMouseEvent("MouseOut",c))},_handleMouseMove:function(c){var k=this._isClientDiv(c);if(this.isListening("MouseMove")&&
k)this.onMouseMove(this._createMouseEvent("MouseMove",c));if(!this._dropTarget){var a=this._linksVisible||this._lastMouseMoveX!==c.clientX||this._lastMouseMoveY!==c.clientY;this._lastMouseMoveX=c.clientX;this._lastMouseMoveY=c.clientY;this._setLinksVisible(a&&!this._isMouseDown&&(b.isMac?c.metaKey:c.ctrlKey));if(!this._isW3CEvents){if(c.button===0)return this._setGrab(null),!0;if(!this._isMouseDown&&c.button===1&&(this._clickCount&1)!==0&&k)return this._clickCount=2,this._handleMouse(c,this._clickCount)}if(this._isMouseDown&&
this._dragOffset===-1){var k=c.clientX,c=c.clientY,j=this._getViewPadding(),f=this._viewDiv.getBoundingClientRect(),l=this._getClientWidth(),d=this._getClientHeight(),a=f.left+j.left,e=f.top+j.top,l=f.left+j.left+l,j=f.top+j.top+d,f=this._model,d=f.getLineAtOffset(this._getSelection().getCaret());c<e&&d!==0?this._doAutoScroll("up",k,c-e):c>j&&d!==f.getLineCount()-1?this._doAutoScroll("down",k,c-j):k<a&&!this._wrapMode?this._doAutoScroll("left",k-a,c):k>l&&!this._wrapMode?this._doAutoScroll("right",
k-l,c):(this._endAutoScroll(),this._setSelectionTo(k,c,!0))}}},_isClientDiv:function(c){for(var k=this._overlayDiv||this._clientDiv,c=c.target?c.target:c.srcElement;c;){if(k===c)return!0;c=c.parentNode}return!1},_createMouseEvent:function(c,k){var a=this.convert({x:k.clientX,y:k.clientY},"page","document");return{type:c,event:k,clickCount:this._clickCount,x:a.x,y:a.y,preventDefault:function(){this.defaultPrevented=!0}}},_handleMouseUp:function(c){var k=c.which?c.button===0:c.button===1;if(this.isListening("MouseUp")&&
(this._isClientDiv(c)||k&&this._isMouseDown))this.onMouseUp(this._createMouseEvent("MouseUp",c));if(!this._linksVisible&&k&&this._isMouseDown){if(this._dragOffset!==-1)k=this._getSelection(),k.extend(this._dragOffset),k.collapse(),this._setSelection(k,!0,!0),this._dragOffset=-1;this._isMouseDown=!1;this._endAutoScroll();this._isW3CEvents&&this._setGrab(null);b.isFirefox&&c.preventDefault()}},_handleMouseWheel:function(c){var k=this._getLineHeight(),a=0,j=0;b.isIE||b.isOpera?j=-c.wheelDelta/40*k:b.isFirefox?
(k=b.isMac?c.detail*3:Math.max(-256,Math.min(256,c.detail))*k,c.axis===c.HORIZONTAL_AXIS?a=k:j=k):b.isMac?(j=a=40,c.wheelDeltaX%120!==0&&(a=1),c.wheelDeltaY%120!==0&&(j=1),a=-c.wheelDeltaX/a,-1<a&&a<0&&(a=-1),0<a&&a<1&&(a=1),j=-c.wheelDeltaY/j,-1<j&&j<0&&(j=-1),0<j&&j<1&&(j=1)):(a=-c.wheelDeltaX,j=-c.wheelDeltaY/120*8*k);if(b.isSafari){for(k=c.target;k&&k.lineIndex===void 0;)k=k.parentNode;this._mouseWheelLine=k}k=this._getScroll();this._scrollView(a,j);a=this._getScroll();if(k.x!==a.x||k.y!==a.y)return c.preventDefault&&
c.preventDefault(),!1},_handlePaste:function(c){if(!this._ignorePaste&&this._doPaste(c)){if(b.isIE){var k=this;this._ignoreFocus=!0;this._getWindow().setTimeout(function(){k._updateDOMSelection();k._ignoreFocus=!1},0)}c.preventDefault&&c.preventDefault();return!1}},_handleResize:function(){var c=this._parent.clientWidth,k=this._parent.clientHeight;if(this._parentWidth!==c||this._parentHeight!==k)this._parentWidth!==c&&this._resetLineHeight(),this._parentWidth=c,this._parentHeight=k,b.isIE<9?this._queueUpdate():
this._update()},_handleRulerEvent:function(c){for(var k=c.target?c.target:c.srcElement,a=k.lineIndex;k&&!k._ruler;){if(a===void 0&&k.lineIndex!==void 0)a=k.lineIndex;k=k.parentNode}k=k?k._ruler:null;if(a===void 0&&k&&k.getOverview()==="document"){var a=this._getClientHeight(),j=this._model.getLineCount(),b=this._getViewPadding(),l=this._viewDiv.getBoundingClientRect(),a=Math.floor((c.clientY-l.top-this._metrics.scrollWidth)*j/(a+b.top+b.bottom-2*this._metrics.scrollWidth));0<=a&&a<j||(a=void 0)}if(k)switch(c.type){case "click":if(k.onClick)k.onClick(a,
c);break;case "dblclick":if(k.onDblClick)k.onDblClick(a,c);break;case "mousemove":if(k.onMouseMove)k.onMouseMove(a,c);break;case "mouseover":if(k.onMouseOver)k.onMouseOver(a,c);break;case "mouseout":if(k.onMouseOut)k.onMouseOut(a,c)}},_handleScroll:function(){var c=this._getScroll(),k=this._hScroll,a=this._vScroll;if(k!==c.x||a!==c.y)this._hScroll=c.x,this._vScroll=c.y,this._commitIME(),this._update(a===c.y),this.onScroll({type:"Scroll",oldValue:{x:k,y:a},newValue:c})},_handleSelectStart:function(c){if(this._ignoreSelect)return c&&
c.preventDefault&&c.preventDefault(),!1},_getModelOffset:function(c,k){if(c){var a;a=c.tagName==="DIV"?c:c.parentNode.parentNode;var j=0,b=a.lineIndex;if(c.tagName!=="DIV")for(a=a.firstChild;a;){var l=a.firstChild;if(l===c){a.ignoreChars&&(j-=a.ignoreChars);j+=k;break}a.ignoreChars&&(j-=a.ignoreChars);j+=l.data.length;a=a.nextSibling}return Math.max(0,j)+this._model.getLineStart(b)}},_updateSelectionFromDOM:function(){var c=this._getWindow().getSelection(),k=this._getModelOffset(c.anchorNode,c.anchorOffset),
c=this._getModelOffset(c.focusNode,c.focusOffset);k===void 0||c===void 0||this._setSelection(new m(k,c),!1,!1)},_handleSelectionChange:function(){if(this._imeOffset===-1)if(b.isAndroid){var c=this._getWindow();this._selTimer&&c.clearTimeout(this._selTimer);var k=this;this._selTimer=c.setTimeout(function(){if(k._clientDiv)k._selTimer=null,k._updateSelectionFromDOM()},250)}else this._updateSelectionFromDOM()},_handleTextInput:function(c){this._imeOffset=-1;if(b.isAndroid){for(var k=this._getWindow().getSelection(),
a=k.anchorNode;a;){if(a.lineIndex!==void 0)break;a=a.parentNode}if(a){var j=this._model,f=a.lineIndex,l=j.getLine(f),d=l,e=0,j=j.getLineStart(f);if(k.rangeCount>0)k.getRangeAt(0).deleteContents(),f=a.ownerDocument.createTextNode(c.data),k.getRangeAt(0).insertNode(f),e=this._getDOMText(a,f),d=e.text,e=e.offset,f.parentNode.removeChild(f);a.lineRemoved=!0;for(a=0;l.charCodeAt(a)===d.charCodeAt(a)&&a<e;)a++;k=l.length-1;for(f=d.length-l.length;l.charCodeAt(k)===d.charCodeAt(k+f)&&k+f>=e+c.data.length;)k--;
k++;l=d.substring(a,k+f);a+=j;k+=j;this._modifyContent({text:l,start:a,end:k,_ignoreDOMSelection:!0},!0)}}else this._doContent(c.data);c.preventDefault()},_handleTouchStart:function(c){this._commitIME();var k=this._getWindow();if(this._touchScrollTimer)this._vScrollDiv.style.display="none",this._hScrollDiv.style.display="none",k.clearInterval(this._touchScrollTimer),this._touchScrollTimer=null;var a=c.touches;if(a.length===1){var a=a[0],j=a.clientX,f=a.clientY;this._touchStartX=j;this._touchStartY=
f;if(b.isAndroid&&(f<a.pageY-k.pageYOffset||j<a.pageX-k.pageXOffset))j=a.pageX-k.pageXOffset,f=a.pageY-k.pageYOffset;k=this.convert({x:j,y:f},"page","document");this._lastTouchOffset=this.getOffsetAtLocation(k.x,k.y);this._touchStartTime=c.timeStamp;this._touching=!0}},_handleTouchMove:function(c){var k=c.touches;if(k.length===1){k=k[0];this._touchCurrentX=k.clientX;this._touchCurrentY=k.clientY;if(!this._touchScrollTimer&&c.timeStamp-this._touchStartTime<200){this._vScrollDiv.style.display="block";
if(!this._wrapMode)this._hScrollDiv.style.display="block";var a=this,j=this._getWindow();this._touchScrollTimer=j.setInterval(function(){var c=0,k=0;if(a._touching)c=a._touchStartX-a._touchCurrentX,k=a._touchStartY-a._touchCurrentY,a._touchSpeedX=c/10,a._touchSpeedY=k/10,a._touchStartX=a._touchCurrentX,a._touchStartY=a._touchCurrentY;else if(Math.abs(a._touchSpeedX)<0.1&&Math.abs(a._touchSpeedY)<0.1){a._vScrollDiv.style.display="none";a._hScrollDiv.style.display="none";j.clearInterval(a._touchScrollTimer);
a._touchScrollTimer=null;return}else c=a._touchSpeedX*10,k=a._touchSpeedY*10,a._touchSpeedX*=0.95,a._touchSpeedY*=0.95;a._scrollView(c,k)},10)}this._touchScrollTimer&&c.preventDefault()}},_handleTouchEnd:function(c){if(c.touches.length===0)this._touching=!1},_doAction:function(c){for(var k=this._keyBindings,a=0;a<k.length;a++){var j=k[a];if(j.keyBinding.match(c)){if(j.actionID&&(c=this._actions[j.actionID]))if(c.handler){if(!c.handler())return c.defaultHandler?typeof c.defaultHandler()==="boolean":
!1}else if(c.defaultHandler)return typeof c.defaultHandler()==="boolean";return!0}}return!1},_doBackspace:function(c){var k=this._getSelection();if(k.isEmpty()){var a=this._model,j=k.getCaret(),b=a.getLineAtOffset(j),l=a.getLineStart(b);if(j===l)b>0&&k.extend(a.getLineEnd(b-1));else{var f=!1;this._expandTab&&c.unit==="character"&&(j-l)%this._tabSize===0&&(f=!/[^ ]/.test(a.getText(l,j)));f?k.extend(j-this._tabSize):(a=this._getLine(b),k.extend(a.getNextOffset(j,c.unit,-1)),a.destroy())}}this._modifyContent({text:"",
start:k.start,end:k.end},!0);return!0},_doContent:function(c){var a=this._getSelection();this._modifyContent({text:c,start:a.start,end:a.end,_ignoreDOMSelection:!0},!0)},_doCopy:function(c){var a=this._getSelection();return!a.isEmpty()?this._setClipboardText(this._getBaseText(a.start,a.end),c):!0},_doCursorNext:function(c){if(!c.select&&this._clearSelection("next"))return!0;var a=this._model,b=this._getSelection(),j=b.getCaret(),f=a.getLineAtOffset(j);j===a.getLineEnd(f)?f+1<a.getLineCount()&&b.extend(a.getLineStart(f+
1)):(a=this._getLine(f),b.extend(a.getNextOffset(j,c.unit,1)),a.destroy());c.select||b.collapse();this._setSelection(b,!0);return!0},_doCursorPrevious:function(c){if(!c.select&&this._clearSelection("previous"))return!0;var a=this._model,b=this._getSelection(),j=b.getCaret(),f=a.getLineAtOffset(j);j===a.getLineStart(f)?f>0&&b.extend(a.getLineEnd(f-1)):(a=this._getLine(f),b.extend(a.getNextOffset(j,c.unit,-1)),a.destroy());c.select||b.collapse();this._setSelection(b,!0);return!0},_doCut:function(c){var a=
this._getSelection();return!a.isEmpty()?(a=this._getBaseText(a.start,a.end),this._doContent(""),this._setClipboardText(a,c)):!0},_doDelete:function(c){var a=this._getSelection();if(a.isEmpty()){var b=this._model,j=a.getCaret(),f=b.getLineAtOffset(j);j===b.getLineEnd(f)?f+1<b.getLineCount()&&a.extend(b.getLineStart(f+1)):(b=this._getLine(f),a.extend(b.getNextOffset(j,c.unit,1)),b.destroy())}this._modifyContent({text:"",start:a.start,end:a.end},!0);return!0},_doEnd:function(c){var a=this._getSelection(),
b=this._model;if(c.ctrl)a.extend(b.getCharCount());else{var j=a.getCaret(),f=b.getLineAtOffset(j);if(this._wrapMode){var l=this._getLine(f),j=l.getLineIndex(j),j=j===l.getLineCount()-1?b.getLineEnd(f):l.getLineStart(j+1)-1;l.destroy()}else j=b.getLineEnd(f);a.extend(j)}c.select||a.collapse();this._setSelection(a,!0);return!0},_doEnter:function(c){var a=this._model,b=this._getSelection();this._doContent(a.getLineDelimiter());if(c&&c.noCursor)b.end=b.start,this._setSelection(b);return!0},_doHome:function(c){var a=
this._getSelection(),b=this._model;if(c.ctrl)a.extend(0);else{var j=a.getCaret(),f=b.getLineAtOffset(j);this._wrapMode?(b=this._getLine(f),j=b.getLineIndex(j),j=b.getLineStart(j),b.destroy()):j=b.getLineStart(f);a.extend(j)}c.select||a.collapse();this._setSelection(a,!0);return!0},_doLineDown:function(c){var a=this._model,f=this._getSelection(),j=f.getCaret(),d=a.getLineAtOffset(j),l=this._getLine(d),e=this._columnX,m=1,o=!1;if(e===-1||c.wholeLine||c.select&&b.isIE)e=c.wholeLine?a.getLineEnd(d+1):
j,e=l.getBoundingClientRect(e).left;(j=l.getLineIndex(j))<l.getLineCount()-1?m=l.getClientRects(j+1).top+1:(o=d===a.getLineCount()-1,d++);o?c.select&&(f.extend(a.getCharCount()),this._setSelection(f,!0,!0)):(l.lineIndex!==d&&(l.destroy(),l=this._getLine(d)),f.extend(l.getOffset(e,m)),c.select||f.collapse(),this._setSelection(f,!0,!0));this._columnX=e;l.destroy();return!0},_doLineUp:function(c){var a=this._model,f=this._getSelection(),j=f.getCaret(),d=a.getLineAtOffset(j),l=this._getLine(d),e=this._columnX,
m=!1,o;if(e===-1||c.wholeLine||c.select&&b.isIE)e=c.wholeLine?a.getLineStart(d-1):j,e=l.getBoundingClientRect(e).left;(j=l.getLineIndex(j))>0?o=l.getClientRects(j-1).top+1:(m=d===0,m||(d--,o=this._getLineHeight(d)-1));m?c.select&&(f.extend(0),this._setSelection(f,!0,!0)):(l.lineIndex!==d&&(l.destroy(),l=this._getLine(d)),f.extend(l.getOffset(e,o)),c.select||f.collapse(),this._setSelection(f,!0,!0));this._columnX=e;l.destroy();return!0},_doPageDown:function(c){var a=this._model,f=this._getSelection(),
j=f.getCaret(),d=a.getLineAtOffset(j),l=a.getLineCount(),e=this._getScroll(),m=this._getClientHeight(),o;if(this._lineHeight){a=this._columnX;e=this._getBoundsAtOffset(j);if(a===-1||c.select&&b.isIE)a=e.left;j=this._getLineIndex(e.top+m);o=this._getLine(j);d=this._getLinePixel(j);j=o.getOffset(a,e.top+m-d);m=o.getBoundingClientRect(j);o.destroy();f.extend(j);c.select||f.collapse();this._setSelection(f,!0,!0,m.top+d-e.top);this._columnX=a;return!0}if(d<l-1){var h=this._getLineHeight(),g=Math.min(l-
d-1,Math.floor(m/h)),g=Math.max(1,g),a=this._columnX;if(a===-1||c.select&&b.isIE)o=this._getLine(d),a=o.getBoundingClientRect(j).left,o.destroy();o=this._getLine(d+g);f.extend(o.getOffset(a,0));o.destroy();c.select||f.collapse();c=l*h;j=e.y+g*h;j+m>c&&(j=c-m);this._setSelection(f,!0,!0,j-e.y);this._columnX=a}return!0},_doPageUp:function(c){var a=this._model,f=this._getSelection(),j=f.getCaret(),d=a.getLineAtOffset(j),l=this._getScroll(),e=this._getClientHeight(),m;if(this._lineHeight){a=this._columnX;
l=this._getBoundsAtOffset(j);if(a===-1||c.select&&b.isIE)a=l.left;j=this._getLineIndex(l.bottom-e);m=this._getLine(j);d=this._getLinePixel(j);j=m.getOffset(a,l.bottom-e-d);e=m.getBoundingClientRect(j);m.destroy();f.extend(j);c.select||f.collapse();this._setSelection(f,!0,!0,e.top+d-l.top);this._columnX=a;return!0}if(d>0){var o=this._getLineHeight(),e=Math.max(1,Math.min(d,Math.floor(e/o))),a=this._columnX;if(a===-1||c.select&&b.isIE)m=this._getLine(d),a=m.getBoundingClientRect(j).left,m.destroy();
m=this._getLine(d-e);f.extend(m.getOffset(a,this._getLineHeight(d-e)-1));m.destroy();c.select||f.collapse();c=Math.max(0,l.y-e*o);this._setSelection(f,!0,!0,c-l.y);this._columnX=a}return!0},_doPaste:function(c){var a=this;return this._getClipboardText(c,function(c){c&&(b.isLinux&&a._lastMouseButton===2&&(new Date).getTime()-a._lastMouseTime<=a._clickTime&&a._setSelectionTo(a._lastMouseX,a._lastMouseY),a._doContent(c))})!==null},_doScroll:function(c){var a=c.type,b=this._model,j=b.getLineCount(),c=
this._getClientHeight(),f=this._getLineHeight();j*=f;var l=this._getScroll().y,d;switch(a){case "textStart":d=0;break;case "textEnd":d=j-c;break;case "pageDown":d=l+c;break;case "pageUp":d=l-c;break;case "centerLine":a=this._getSelection(),d=b.getLineAtOffset(a.start),b=(b.getLineAtOffset(a.end)-d+1)*f,d=d*f-c/2+b/2}d!==void 0&&(d=Math.min(Math.max(0,d),j-c),this._scrollView(0,d-l));return!0},_doSelectAll:function(){var c=this._model,a=this._getSelection();a.setCaret(0);a.extend(c.getCharCount());
this._setSelection(a,!1);return!0},_doTab:function(){if(this._tabMode&&!this._readonly){var c="\t";if(this._expandTab)var a=this._model,c=this._getSelection().getCaret(),b=a.getLineAtOffset(c),a=a.getLineStart(b),c=Array(this._tabSize-(c-a)%this._tabSize+1).join(" ");this._doContent(c);return!0}},_doShiftTab:function(){return!this._tabMode||this._readonly?void 0:!0},_doTabMode:function(){this._tabMode=!this._tabMode;return!0},_doWrapMode:function(){this.setOptions({wrapMode:!this.getOptions("wrapMode")});
return!0},_autoScroll:function(){var c=this._getSelection(),a=this.convert({x:this._autoScrollX,y:this._autoScrollY},"page","document"),b=c.getCaret(),j=this._model.getLineAtOffset(b),f;if(this._autoScrollDir==="up"||this._autoScrollDir==="down")b=this._autoScrollY/this._getLineHeight(),b=b<0?Math.floor(b):Math.ceil(b),f=j,f=Math.max(0,Math.min(this._model.getLineCount()-1,f+b));else if(this._autoScrollDir==="left"||this._autoScrollDir==="right")f=this._getLineIndex(a.y),j=this._getLine(j),a.x+=j.getBoundingClientRect(b,
!1).left,j.destroy();j=this._getLine(f);c.extend(j.getOffset(a.x,a.y-this._getLinePixel(f)));j.destroy();this._setSelection(c,!0)},_autoScrollTimer:function(){this._autoScroll();var c=this;this._autoScrollTimerID=this._getWindow().setTimeout(function(){c._autoScrollTimer()},this._AUTO_SCROLL_RATE)},_calculateLineHeightTimer:function(c){if(this._lineHeight&&!this._calculateLHTimer){var a=this._model.getLineCount(),b=0;if(c){for(var c=0,j=(new Date).getTime(),f=0;b<a;)if(this._lineHeight[b]||(c++,f||
(f=b),this._lineHeight[b]=this._calculateLineHeight(b)),b++,(new Date).getTime()-j>100)break;this.redrawRulers(0,a);this._queueUpdate()}c=this._getWindow();if(b!==a){var l=this;this._calculateLHTimer=c.setTimeout(function(){l._calculateLHTimer=null;l._calculateLineHeightTimer(!0)},0)}else if(this._calculateLHTimer)c.clearTimeout(this._calculateLHTimer),this._calculateLHTimer=void 0}},_calculateLineHeight:function(c){var c=this._getLine(c),a=c.getBoundingClientRect();c.destroy();return Math.max(1,
Math.ceil(a.bottom-a.top))},_calculateMetrics:function(){var c=this._clientDiv,a=c.ownerDocument,e=b.createElement(a,"div");e.style.lineHeight="normal";var j={type:"LineStyle",textView:this,0:0,lineText:this._model.getLine(0),lineStart:0};this.onLineStyle(j);d(j.style,e);e.style.position="fixed";e.style.left="-1000px";var m=b.createElement(a,"span");m.appendChild(a.createTextNode(" "));e.appendChild(m);var l=b.createElement(a,"span");l.style.fontStyle="italic";l.appendChild(a.createTextNode(" "));
e.appendChild(l);var h=b.createElement(a,"span");h.style.fontWeight="bold";h.appendChild(a.createTextNode(" "));e.appendChild(h);j=b.createElement(a,"span");j.style.fontWeight="bold";j.style.fontStyle="italic";j.appendChild(a.createTextNode(" "));e.appendChild(j);c.appendChild(e);var g=e.getBoundingClientRect(),m=m.getBoundingClientRect(),l=l.getBoundingClientRect(),h=h.getBoundingClientRect(),j=j.getBoundingClientRect(),m=m.bottom-m.top,l=l.bottom-l.top,h=h.bottom-h.top,n=j.bottom-j.top,i=0,j=g.bottom-
g.top<=0,g=Math.max(1,g.bottom-g.top);l>m&&(i=1);h>l&&(i=2);n>h&&(i=3);var t;if(i!==0){t={style:{}};if((i&1)!==0)t.style.fontStyle="italic";if((i&2)!==0)t.style.fontWeight="bold"}m=o(e);c.removeChild(e);l=f(this._viewDiv);e=b.createElement(a,"div");e.style.position="fixed";e.style.left="-1000px";e.style.paddingLeft=l.left+"px";e.style.paddingTop=l.top+"px";e.style.paddingRight=l.right+"px";e.style.paddingBottom=l.bottom+"px";e.style.width="100px";e.style.height="100px";h=b.createElement(a,"div");
h.style.width="100%";h.style.height="100%";e.appendChild(h);c.appendChild(e);a=e.getBoundingClientRect();l=h.getBoundingClientRect();e.style.overflow="hidden";h.style.height="200px";h=e.clientWidth;e.style.overflow="scroll";n=e.clientWidth;c.removeChild(e);l={left:l.left-a.left,top:l.top-a.top,right:a.right-l.right,bottom:a.bottom-l.bottom};return{lineHeight:g,largestFontStyle:t,lineTrim:m,viewPadding:l,scrollWidth:h-n,invalid:j}},_clearSelection:function(c){var a=this._getSelection();if(a.isEmpty())return!1;
c==="next"?a.start=a.end:a.end=a.start;this._setSelection(a,!0);return!0},_commitIME:function(){if(this._imeOffset!==-1){this._scrollDiv.focus();this._clientDiv.focus();var c=this._model,a=c.getLineAtOffset(this._imeOffset),b=c.getLineStart(a),j=this._getDOMText(this._getLineNode(a)).text,c=c.getLine(a),b=this._imeOffset-b,c=b+j.length-c.length;b!==c&&this._doContent(j.substring(b,c));this._imeOffset=-1}},_createActions:function(){var c=r.KeyBinding,a=this._keyBindings=[];a.push({actionID:"lineUp",
keyBinding:new c(38),predefined:!0});a.push({actionID:"lineDown",keyBinding:new c(40),predefined:!0});a.push({actionID:"charPrevious",keyBinding:new c(37),predefined:!0});a.push({actionID:"charNext",keyBinding:new c(39),predefined:!0});b.isMac?(a.push({actionID:"scrollPageUp",keyBinding:new c(33),predefined:!0}),a.push({actionID:"scrollPageDown",keyBinding:new c(34),predefined:!0}),a.push({actionID:"pageUp",keyBinding:new c(33,null,null,!0),predefined:!0}),a.push({actionID:"pageDown",keyBinding:new c(34,
null,null,!0),predefined:!0}),a.push({actionID:"lineStart",keyBinding:new c(37,!0),predefined:!0}),a.push({actionID:"lineEnd",keyBinding:new c(39,!0),predefined:!0}),a.push({actionID:"wordPrevious",keyBinding:new c(37,null,null,!0),predefined:!0}),a.push({actionID:"wordNext",keyBinding:new c(39,null,null,!0),predefined:!0}),a.push({actionID:"scrollTextStart",keyBinding:new c(36),predefined:!0}),a.push({actionID:"scrollTextEnd",keyBinding:new c(35),predefined:!0}),a.push({actionID:"textStart",keyBinding:new c(38,
!0),predefined:!0}),a.push({actionID:"textEnd",keyBinding:new c(40,!0),predefined:!0}),a.push({actionID:"scrollPageUp",keyBinding:new c(38,null,null,null,!0),predefined:!0}),a.push({actionID:"scrollPageDown",keyBinding:new c(40,null,null,null,!0),predefined:!0}),a.push({actionID:"lineStart",keyBinding:new c(37,null,null,null,!0),predefined:!0}),a.push({actionID:"lineEnd",keyBinding:new c(39,null,null,null,!0),predefined:!0}),a.push({actionID:"lineStart",keyBinding:new c(38,null,null,!0),predefined:!0}),
a.push({actionID:"lineEnd",keyBinding:new c(40,null,null,!0),predefined:!0})):(a.push({actionID:"pageUp",keyBinding:new c(33),predefined:!0}),a.push({actionID:"pageDown",keyBinding:new c(34),predefined:!0}),a.push({actionID:"lineStart",keyBinding:new c(36),predefined:!0}),a.push({actionID:"lineEnd",keyBinding:new c(35),predefined:!0}),a.push({actionID:"wordPrevious",keyBinding:new c(37,!0),predefined:!0}),a.push({actionID:"wordNext",keyBinding:new c(39,!0),predefined:!0}),a.push({actionID:"textStart",
keyBinding:new c(36,!0),predefined:!0}),a.push({actionID:"textEnd",keyBinding:new c(35,!0),predefined:!0}));b.isFirefox&&b.isLinux&&(a.push({actionID:"lineUp",keyBinding:new c(38,!0),predefined:!0}),a.push({actionID:"lineDown",keyBinding:new c(40,!0),predefined:!0}));a.push({actionID:"selectLineUp",keyBinding:new c(38,null,!0),predefined:!0});a.push({actionID:"selectLineDown",keyBinding:new c(40,null,!0),predefined:!0});a.push({actionID:"selectCharPrevious",keyBinding:new c(37,null,!0),predefined:!0});
a.push({actionID:"selectCharNext",keyBinding:new c(39,null,!0),predefined:!0});a.push({actionID:"selectPageUp",keyBinding:new c(33,null,!0),predefined:!0});a.push({actionID:"selectPageDown",keyBinding:new c(34,null,!0),predefined:!0});b.isMac?(a.push({actionID:"selectLineStart",keyBinding:new c(37,!0,!0),predefined:!0}),a.push({actionID:"selectLineEnd",keyBinding:new c(39,!0,!0),predefined:!0}),a.push({actionID:"selectWordPrevious",keyBinding:new c(37,null,!0,!0),predefined:!0}),a.push({actionID:"selectWordNext",
keyBinding:new c(39,null,!0,!0),predefined:!0}),a.push({actionID:"selectTextStart",keyBinding:new c(36,null,!0),predefined:!0}),a.push({actionID:"selectTextEnd",keyBinding:new c(35,null,!0),predefined:!0}),a.push({actionID:"selectTextStart",keyBinding:new c(38,!0,!0),predefined:!0}),a.push({actionID:"selectTextEnd",keyBinding:new c(40,!0,!0),predefined:!0}),a.push({actionID:"selectLineStart",keyBinding:new c(37,null,!0,null,!0),predefined:!0}),a.push({actionID:"selectLineEnd",keyBinding:new c(39,
null,!0,null,!0),predefined:!0}),a.push({actionID:"selectLineStart",keyBinding:new c(38,null,!0,!0),predefined:!0}),a.push({actionID:"selectLineEnd",keyBinding:new c(40,null,!0,!0),predefined:!0})):(b.isLinux&&(a.push({actionID:"selectWholeLineUp",keyBinding:new c(38,!0,!0),predefined:!0}),a.push({actionID:"selectWholeLineDown",keyBinding:new c(40,!0,!0),predefined:!0})),a.push({actionID:"selectLineStart",keyBinding:new c(36,null,!0),predefined:!0}),a.push({actionID:"selectLineEnd",keyBinding:new c(35,
null,!0),predefined:!0}),a.push({actionID:"selectWordPrevious",keyBinding:new c(37,!0,!0),predefined:!0}),a.push({actionID:"selectWordNext",keyBinding:new c(39,!0,!0),predefined:!0}),a.push({actionID:"selectTextStart",keyBinding:new c(36,!0,!0),predefined:!0}),a.push({actionID:"selectTextEnd",keyBinding:new c(35,!0,!0),predefined:!0}));a.push({actionID:"undo",keyBinding:new r.KeyBinding("z",!0),predefined:!0});b.isMac?a.push({actionID:"redo",keyBinding:new r.KeyBinding("z",!0,!0),predefined:!0}):
a.push({actionID:"redo",keyBinding:new r.KeyBinding("y",!0),predefined:!0});a.push({actionID:"deletePrevious",keyBinding:new c(8),predefined:!0});a.push({actionID:"deletePrevious",keyBinding:new c(8,null,!0),predefined:!0});a.push({actionID:"deleteNext",keyBinding:new c(46),predefined:!0});a.push({actionID:"deleteWordPrevious",keyBinding:new c(8,!0),predefined:!0});a.push({actionID:"deleteWordPrevious",keyBinding:new c(8,!0,!0),predefined:!0});a.push({actionID:"deleteWordNext",keyBinding:new c(46,
!0),predefined:!0});a.push({actionID:"tab",keyBinding:new c(9),predefined:!0});a.push({actionID:"shiftTab",keyBinding:new c(9,null,!0),predefined:!0});a.push({actionID:"enter",keyBinding:new c(13),predefined:!0});a.push({actionID:"enter",keyBinding:new c(13,null,!0),predefined:!0});a.push({actionID:"selectAll",keyBinding:new c("a",!0),predefined:!0});a.push({actionID:"toggleTabMode",keyBinding:new c("m",!0),predefined:!0});b.isMac&&(a.push({actionID:"deleteNext",keyBinding:new c(46,null,!0),predefined:!0}),
a.push({actionID:"deleteWordPrevious",keyBinding:new c(8,null,null,!0),predefined:!0}),a.push({actionID:"deleteWordNext",keyBinding:new c(46,null,null,!0),predefined:!0}));if(!b.isFirefox){var f=b.isMac&&b.isChrome;a.push({actionID:null,keyBinding:new c("u",!f,!1,!1,f),predefined:!0});a.push({actionID:null,keyBinding:new c("i",!f,!1,!1,f),predefined:!0});a.push({actionID:null,keyBinding:new c("b",!f,!1,!1,f),predefined:!0})}b.isFirefox&&(a.push({actionID:"copy",keyBinding:new c(45,!0),predefined:!0}),
a.push({actionID:"paste",keyBinding:new c(45,null,!0),predefined:!0}),a.push({actionID:"cut",keyBinding:new c(46,null,!0),predefined:!0}));b.isMac&&(a.push({actionID:"lineStart",keyBinding:new c("a",!1,!1,!1,!0),predefined:!0}),a.push({actionID:"lineEnd",keyBinding:new c("e",!1,!1,!1,!0),predefined:!0}),a.push({actionID:"lineUp",keyBinding:new c("p",!1,!1,!1,!0),predefined:!0}),a.push({actionID:"lineDown",keyBinding:new c("n",!1,!1,!1,!0),predefined:!0}),a.push({actionID:"charPrevious",keyBinding:new c("b",
!1,!1,!1,!0),predefined:!0}),a.push({actionID:"charNext",keyBinding:new c("f",!1,!1,!1,!0),predefined:!0}),a.push({actionID:"deletePrevious",keyBinding:new c("h",!1,!1,!1,!0),predefined:!0}),a.push({actionID:"deleteNext",keyBinding:new c("d",!1,!1,!1,!0),predefined:!0}),a.push({actionID:"deleteLineEnd",keyBinding:new c("k",!1,!1,!1,!0),predefined:!0}),b.isFirefox?(a.push({actionID:"scrollPageDown",keyBinding:new c("v",!1,!1,!1,!0),predefined:!0}),a.push({actionID:"deleteLineStart",keyBinding:new c("u",
!1,!1,!1,!0),predefined:!0}),a.push({actionID:"deleteWordPrevious",keyBinding:new c("w",!1,!1,!1,!0),predefined:!0})):(a.push({actionID:"pageDown",keyBinding:new c("v",!1,!1,!1,!0),predefined:!0}),a.push({actionID:"centerLine",keyBinding:new c("l",!1,!1,!1,!0),predefined:!0}),a.push({actionID:"enterNoCursor",keyBinding:new c("o",!1,!1,!1,!0),predefined:!0})));var j=this;this._actions={lineUp:{defaultHandler:function(){return j._doLineUp({select:!1})}},lineDown:{defaultHandler:function(){return j._doLineDown({select:!1})}},
lineStart:{defaultHandler:function(){return j._doHome({select:!1,ctrl:!1})}},lineEnd:{defaultHandler:function(){return j._doEnd({select:!1,ctrl:!1})}},charPrevious:{defaultHandler:function(){return j._doCursorPrevious({select:!1,unit:"character"})}},charNext:{defaultHandler:function(){return j._doCursorNext({select:!1,unit:"character"})}},pageUp:{defaultHandler:function(){return j._doPageUp({select:!1})}},pageDown:{defaultHandler:function(){return j._doPageDown({select:!1})}},scrollPageUp:{defaultHandler:function(){return j._doScroll({type:"pageUp"})}},
scrollPageDown:{defaultHandler:function(){return j._doScroll({type:"pageDown"})}},wordPrevious:{defaultHandler:function(){return j._doCursorPrevious({select:!1,unit:"word"})}},wordNext:{defaultHandler:function(){return j._doCursorNext({select:!1,unit:"word"})}},textStart:{defaultHandler:function(){return j._doHome({select:!1,ctrl:!0})}},textEnd:{defaultHandler:function(){return j._doEnd({select:!1,ctrl:!0})}},scrollTextStart:{defaultHandler:function(){return j._doScroll({type:"textStart"})}},scrollTextEnd:{defaultHandler:function(){return j._doScroll({type:"textEnd"})}},
centerLine:{defaultHandler:function(){return j._doScroll({type:"centerLine"})}},selectLineUp:{defaultHandler:function(){return j._doLineUp({select:!0})}},selectLineDown:{defaultHandler:function(){return j._doLineDown({select:!0})}},selectWholeLineUp:{defaultHandler:function(){return j._doLineUp({select:!0,wholeLine:!0})}},selectWholeLineDown:{defaultHandler:function(){return j._doLineDown({select:!0,wholeLine:!0})}},selectLineStart:{defaultHandler:function(){return j._doHome({select:!0,ctrl:!1})}},
selectLineEnd:{defaultHandler:function(){return j._doEnd({select:!0,ctrl:!1})}},selectCharPrevious:{defaultHandler:function(){return j._doCursorPrevious({select:!0,unit:"character"})}},selectCharNext:{defaultHandler:function(){return j._doCursorNext({select:!0,unit:"character"})}},selectPageUp:{defaultHandler:function(){return j._doPageUp({select:!0})}},selectPageDown:{defaultHandler:function(){return j._doPageDown({select:!0})}},selectWordPrevious:{defaultHandler:function(){return j._doCursorPrevious({select:!0,
unit:"word"})}},selectWordNext:{defaultHandler:function(){return j._doCursorNext({select:!0,unit:"word"})}},selectTextStart:{defaultHandler:function(){return j._doHome({select:!0,ctrl:!0})}},selectTextEnd:{defaultHandler:function(){return j._doEnd({select:!0,ctrl:!0})}},deletePrevious:{defaultHandler:function(){return j._doBackspace({unit:"character"})}},deleteNext:{defaultHandler:function(){return j._doDelete({unit:"character"})}},deleteWordPrevious:{defaultHandler:function(){return j._doBackspace({unit:"word"})}},
deleteWordNext:{defaultHandler:function(){return j._doDelete({unit:"word"})}},deleteLineStart:{defaultHandler:function(){return j._doBackspace({unit:"line"})}},deleteLineEnd:{defaultHandler:function(){return j._doDelete({unit:"line"})}},tab:{defaultHandler:function(){return j._doTab()}},shiftTab:{defaultHandler:function(){return j._doShiftTab()}},enter:{defaultHandler:function(){return j._doEnter()}},enterNoCursor:{defaultHandler:function(){return j._doEnter({noCursor:!0})}},selectAll:{defaultHandler:function(){return j._doSelectAll()}},
copy:{defaultHandler:function(){return j._doCopy()}},cut:{defaultHandler:function(){return j._doCut()}},paste:{defaultHandler:function(){return j._doPaste()}},toggleWrapMode:{defaultHandler:function(){return j._doWrapMode()}},toggleTabMode:{defaultHandler:function(){return j._doTabMode()}}}},_createRuler:function(c,a){if(this._clientDiv){var f=c.getLocation()==="left"?this._leftDiv:this._rightDiv;f.style.display="block";var j=b.createElement(f.ownerDocument,"div");j._ruler=c;j.rulerChanged=!0;j.style.position=
"relative";j.style["float"]="left";j.style.borderWidth="0px";j.style.margin="0px";j.style.padding="0px";j.style.outline="none";if(a===void 0||a<0||a>=f.children.length)f.appendChild(j);else{for(var d=f.firstChild;d&&--a>0;)d=d.nextSibling;f.insertBefore(j,d)}}},_createView:function(){if(!this._clientDiv){for(var c=this._parent;c.hasChildNodes();)c.removeChild(c.lastChild);var a=c.ownerDocument,f=b.createElement(a,"div");this._rootDiv=f;f.tabIndex=-1;f.style.position="relative";f.style.overflow="hidden";
f.style.width="100%";f.style.height="100%";f.style.overflow="hidden";f.style.WebkitTextSizeAdjust="100%";f.setAttribute("role","application");c.appendChild(f);c=b.createElement(a,"div");c.className="textviewLeftRuler";this._leftDiv=c;c.tabIndex=-1;c.style.overflow="hidden";c.style.MozUserSelect="none";c.style.WebkitUserSelect="none";c.style.position="absolute";c.style.top="0px";c.style.bottom="0px";c.style.cursor="default";c.style.display="none";c.setAttribute("aria-hidden","true");f.appendChild(c);
c=b.createElement(a,"div");c.className="textviewScroll";this._viewDiv=c;c.tabIndex=-1;c.style.overflow="auto";c.style.position="absolute";c.style.top="0px";c.style.bottom="0px";c.style.borderWidth="0px";c.style.margin="0px";c.style.outline="none";c.style.background="transparent";if(b.isMac&&b.isWebkit)c.style.pointerEvents="none",c.style.zIndex="2";f.appendChild(c);var j=b.createElement(a,"div");j.className="textviewRightRuler";this._rightDiv=j;j.tabIndex=-1;j.style.display="none";j.style.overflow=
"hidden";j.style.MozUserSelect="none";j.style.WebkitUserSelect="none";j.style.position="absolute";j.style.top="0px";j.style.bottom="0px";j.style.cursor="default";j.style.right="0px";j.setAttribute("aria-hidden","true");f.appendChild(j);this._scrollDiv=j=b.createElement(a,"div");j.style.margin="0px";j.style.borderWidth="0px";j.style.padding="0px";c.appendChild(j);if(b.isFirefox)this._clipboardDiv=c=b.createElement(a,"div"),c.style.position="fixed",c.style.whiteSpace="pre",c.style.left="-1000px",f.appendChild(c);
if(!b.isIE&&!b.isIOS)this._clipDiv=c=b.createElement(a,"div"),c.style.position="absolute",c.style.overflow="hidden",c.style.margin="0px",c.style.borderWidth="0px",c.style.padding="0px",c.style.background="transparent",f.appendChild(c),this._clipScrollDiv=j=b.createElement(a,"div"),j.style.position="absolute",j.style.height="1px",j.style.top="-1000px",j.style.background="transparent",c.appendChild(j);this._setFullSelection(this._fullSelection,!0);c=b.createElement(a,"div");c.className="textviewContent";
this._clientDiv=c;c.style.position="absolute";c.style.borderWidth="0px";c.style.margin="0px";c.style.padding="0px";c.style.outline="none";c.style.zIndex="1";c.style.WebkitUserSelect="text";c.setAttribute("spellcheck","false");if(b.isIOS||b.isAndroid)c.style.WebkitTapHighlightColor="transparent";(this._clipDiv||f).appendChild(c);if(b.isIOS||b.isAndroid)this._vScrollDiv=j=b.createElement(a,"div"),j.style.position="absolute",j.style.borderWidth="1px",j.style.borderColor="white",j.style.borderStyle="solid",
j.style.borderRadius="4px",j.style.backgroundColor="black",j.style.opacity="0.5",j.style.margin="0px",j.style.padding="0px",j.style.outline="none",j.style.zIndex="3",j.style.width="8px",j.style.display="none",f.appendChild(j),this._hScrollDiv=j=b.createElement(a,"div"),j.style.position="absolute",j.style.borderWidth="1px",j.style.borderColor="white",j.style.borderStyle="solid",j.style.borderRadius="4px",j.style.backgroundColor="black",j.style.opacity="0.5",j.style.margin="0px",j.style.padding="0px",
j.style.outline="none",j.style.zIndex="3",j.style.height="8px",j.style.display="none",f.appendChild(j);if(b.isFirefox&&!c.setCapture)this._overlayDiv=j=b.createElement(a,"div"),j.style.position=c.style.position,j.style.borderWidth=c.style.borderWidth,j.style.margin=c.style.margin,j.style.padding=c.style.padding,j.style.cursor="text",j.style.zIndex="2",(this._clipDiv||f).appendChild(j);c.contentEditable="true";c.setAttribute("role","textbox");c.setAttribute("aria-multiline","true");this._setWrapMode(this._wrapMode,
!0);this._setReadOnly(this._readonly);this._setThemeClass(this._themeClass,!0);this._setTabSize(this._tabSize,!0);if(!a.getElementById("_textviewStyle")&&(f="",b.isWebkit&&this._metrics.scrollWidth>0&&(f+="\n.textview ::-webkit-scrollbar-corner {background: #eeeeee;}"),b.isFirefox&&b.isMac&&this._highlightRGB&&this._highlightRGB!=="Highlight"&&(f+="\n.textview ::-moz-selection {background: "+this._highlightRGB+";}"),f))c=b.createElement(a,"style"),c.id="_textviewStyle",j=a.getElementsByTagName("head")[0]||
a.documentElement,c.appendChild(a.createTextNode(f)),j.insertBefore(c,j.firstChild);this._hookEvents();a=this._rulers;for(f=0;f<a.length;f++)this._createRuler(a[f]);this._update()}},_defaultOptions:function(){return{parent:{value:void 0,update:null},model:{value:void 0,update:this.setModel},readonly:{value:!1,update:this._setReadOnly},fullSelection:{value:!0,update:this._setFullSelection},tabMode:{value:!0,update:null},tabSize:{value:8,update:this._setTabSize},expandTab:{value:!1,update:null},wrapMode:{value:!1,
update:this._setWrapMode},theme:{value:i.TextTheme.getTheme(),update:this._setTheme},themeClass:{value:void 0,update:this._setThemeClass}}},_destroyRuler:function(c){var a=c.getLocation()==="left"?this._leftDiv:this._rightDiv;if(a)for(var b=a.firstChild;b;){if(b._ruler===c){b._ruler=void 0;a.removeChild(b);if(a.children.length===0)a.style.display="none";break}b=b.nextSibling}},_destroyView:function(){if(this._clientDiv){this._setGrab(null);this._unhookEvents();var c=this._getWindow();if(this._autoScrollTimerID)c.clearTimeout(this._autoScrollTimerID),
this._autoScrollTimerID=null;if(this._updateTimer)c.clearTimeout(this._updateTimer),this._updateTimer=null;c=this._rootDiv;c.parentNode.removeChild(c);this._hScrollDiv=this._vScrollDiv=this._rightDiv=this._leftDiv=this._overlayDiv=this._clientDiv=this._clipScrollDiv=this._clipDiv=this._viewDiv=this._scrollDiv=this._rootDiv=this._clipboardDiv=this._selDiv3=this._selDiv2=this._selDiv1=null}},_doAutoScroll:function(c,a,b){this._autoScrollDir=c;this._autoScrollX=a;this._autoScrollY=b;this._autoScrollTimerID||
this._autoScrollTimer()},_endAutoScroll:function(){this._autoScrollTimerID&&this._getWindow().clearTimeout(this._autoScrollTimerID);this._autoScrollTimerID=this._autoScrollDir=void 0},_fixCaret:function(){var c=this._clientDiv;if(c){var a=this._hasFocus;this._ignoreFocus=!0;a&&c.blur();c.contentEditable=!1;c.contentEditable=!0;a&&c.focus();this._ignoreFocus=!1}},_getBaseText:function(c,a){var b=this._model;b.getBaseModel&&(c=b.mapOffset(c),a=b.mapOffset(a),b=b.getBaseModel());return b.getText(c,a)},
_getBottomIndex:function(c){var a=this._bottomChild;if(c&&this._getClientHeight()>this._getLineHeight()){var c=a.getBoundingClientRect(),b=this._clientDiv.getBoundingClientRect();c.bottom>b.bottom&&(a=this._getLinePrevious(a)||a)}return a.lineIndex},_getBoundsAtOffset:function(c){var a=this._getLine(this._model.getLineAtOffset(c)),c=a.getBoundingClientRect(c),b=this._getLinePixel(a.lineIndex);c.top+=b;c.bottom+=b;a.destroy();return c},_getClientHeight:function(){var c=this._getViewPadding();return Math.max(0,
this._viewDiv.clientHeight-c.top-c.bottom)},_getClientWidth:function(){var c=this._getViewPadding();return Math.max(0,this._viewDiv.clientWidth-c.left-c.right)},_getClipboardText:function(c,f){var d=this._model.getLineDelimiter(),j,e,l=this._getWindow();if(l.clipboardData)return j=[],e=l.clipboardData.getData("Text"),a(e,function(c){j.push(c)},function(){j.push(d)}),e=j.join(""),f&&f(e),e;if(b.isFirefox){this._ignoreFocus=!0;var m=this._clipboardDiv;m.innerHTML="<pre contenteditable=''></pre>";m.firstChild.focus();
var o=this,h=function(){var c=o._getTextFromElement(m);m.innerHTML="";j=[];a(c,function(c){j.push(c)},function(){j.push(d)});return j.join("")},g=!1;this._ignorePaste=!0;if(!b.isLinux||this._lastMouseButton!==2)try{g=m.ownerDocument.execCommand("paste",!1,null)}catch(n){g=m.childNodes.length>1||m.firstChild&&m.firstChild.childNodes.length>0}this._ignorePaste=!1;if(!g)return c?(l.setTimeout(function(){o.focus();(e=h())&&f&&f(e);o._ignoreFocus=!1},0),null):(this.focus(),this._ignoreFocus=!1,"");this.focus();
this._ignoreFocus=!1;(e=h())&&f&&f(e);return e}return c&&c.clipboardData?(j=[],e=c.clipboardData.getData("text/plain"),a(e,function(c){j.push(c)},function(){j.push(d)}),(e=j.join(""))&&f&&f(e),e):""},_getDOMText:function(c,a){for(var b=c.firstChild,f="",d=0;b;){var l;if(b.ignoreChars){l=b.lastChild;for(var e=0,m=[],o=-1;l;){for(var h=l.data,g=h.length-1;g>=0;g--){var n=h.substring(g,g+1);e<b.ignoreChars&&(n===" "||n==="\u200c"||n==="\ufeff")?e++:m.push(n==="\u00a0"?"\t":n)}if(a===l)o=m.length;l=l.previousSibling}m=
m.reverse().join("");o!==-1&&(d=f.length+m.length-o);f+=m}else for(l=b.firstChild;l;){if(a===l)d=f.length;f+=l.data;l=l.nextSibling}b=b.nextSibling}return{text:f,offset:d}},_getTextFromElement:function(c){var a=c.ownerDocument,b=a.defaultView;if(!b.getSelection)return c.innerText||c.textContent;a=a.createRange();a.selectNode(c);var c=b.getSelection(),b=[],f;for(f=0;f<c.rangeCount;f++)b.push(c.getRangeAt(f));this._ignoreSelect=!0;c.removeAllRanges();c.addRange(a);a=c.toString();c.removeAllRanges();
for(f=0;f<b.length;f++)c.addRange(b[f]);this._ignoreSelect=!1;return a},_getViewPadding:function(){return this._metrics.viewPadding},_getLine:function(c){var a=this._getLineNode(c);return a&&!a.lineChanged&&!a.lineRemoved?a._line:new t(this,c)},_getLineHeight:function(c,a){if(c!==void 0&&this._lineHeight){var b=this._lineHeight[c];if(b)return b;if(a||a===void 0)return this._lineHeight[c]=this._calculateLineHeight(c)}return this._metrics.lineHeight},_getLineNode:function(c){for(var a=this._clientDiv.firstChild;a;){if(c===
a.lineIndex)return a;a=a.nextSibling}},_getLineNext:function(c){for(c=c?c.nextSibling:this._clientDiv.firstChild;c&&c.lineIndex===-1;)c=c.nextSibling;return c},_getLinePrevious:function(c){for(c=c?c.previousSibling:this._clientDiv.lastChild;c&&c.lineIndex===-1;)c=c.previousSibling;return c},_getLinePixel:function(c){c=Math.min(Math.max(0,c),this._model.getLineCount());if(this._lineHeight){var a=this._getTopIndex(),b=-this._topIndexY+this._getScroll().y;if(c>a)for(;a<c;a++)b+=this._getLineHeight(a);
else for(a-=1;a>=c;a--)b-=this._getLineHeight(a);return b}return this._getLineHeight()*c},_getLineIndex:function(c){var a,b=0,f=this._model.getLineCount();if(this._lineHeight){var b=this._getTopIndex(),d=-this._topIndexY+this._getScroll().y;if(c!==d)if(c<d)for(;c<d&&b>0;)c+=this._getLineHeight(--b);else for(a=this._getLineHeight(b);c-a>=d&&b<f-1;)c-=a,a=this._getLineHeight(++b)}else a=this._getLineHeight(),b=Math.floor(c/a);return Math.max(0,Math.min(f-1,b))},_getScroll:function(){var c=this._viewDiv;
return{x:c.scrollLeft,y:c.scrollTop}},_getSelection:function(){return this._selection.clone()},_getTopIndex:function(c){var a=this._topChild;if(c&&this._getClientHeight()>this._getLineHeight()){var c=a.getBoundingClientRect(),b=this._getViewPadding(),f=this._viewDiv.getBoundingClientRect();c.top<f.top+b.top&&(a=this._getLineNext(a)||a)}return a.lineIndex},_hookEvents:function(){var c=this;this._modelListener={onChanging:function(a){c._onModelChanging(a)},onChanged:function(a){c._onModelChanged(a)}};
this._model.addEventListener("preChanging",this._modelListener.onChanging);this._model.addEventListener("postChanged",this._modelListener.onChanged);this._themeListener={onChanged:function(){c._setThemeClass(c._themeClass)}};this._theme.addEventListener("ThemeChanged",this._themeListener.onChanged);var a=this._handlers=[],f=this._clientDiv,j=this._viewDiv,d=this._rootDiv,l=this._overlayDiv||f,m=f.ownerDocument,o=this._getWindow(),h=b.isIE?m:o;a.push({target:o,type:"resize",handler:function(a){return c._handleResize(a?
a:o.event)}});a.push({target:f,type:"blur",handler:function(a){return c._handleBlur(a?a:o.event)}});a.push({target:f,type:"focus",handler:function(a){return c._handleFocus(a?a:o.event)}});a.push({target:j,type:"focus",handler:function(){f.focus()}});a.push({target:j,type:"scroll",handler:function(a){return c._handleScroll(a?a:o.event)}});a.push({target:f,type:"textInput",handler:function(a){return c._handleTextInput(a?a:o.event)}});a.push({target:f,type:"keydown",handler:function(a){return c._handleKeyDown(a?
a:o.event)}});a.push({target:f,type:"keypress",handler:function(a){return c._handleKeyPress(a?a:o.event)}});a.push({target:f,type:"keyup",handler:function(a){return c._handleKeyUp(a?a:o.event)}});a.push({target:f,type:"contextmenu",handler:function(a){return c._handleContextMenu(a?a:o.event)}});a.push({target:f,type:"copy",handler:function(a){return c._handleCopy(a?a:o.event)}});a.push({target:f,type:"cut",handler:function(a){return c._handleCut(a?a:o.event)}});a.push({target:f,type:"paste",handler:function(a){return c._handlePaste(a?
a:o.event)}});if(b.isIOS||b.isAndroid)a.push({target:m,type:"selectionchange",handler:function(a){return c._handleSelectionChange(a?a:o.event)}}),a.push({target:f,type:"touchstart",handler:function(a){return c._handleTouchStart(a?a:o.event)}}),a.push({target:f,type:"touchmove",handler:function(a){return c._handleTouchMove(a?a:o.event)}}),a.push({target:f,type:"touchend",handler:function(a){return c._handleTouchEnd(a?a:o.event)}});else{a.push({target:f,type:"selectstart",handler:function(a){return c._handleSelectStart(a?
a:o.event)}});a.push({target:f,type:"mousedown",handler:function(a){return c._handleMouseDown(a?a:o.event)}});a.push({target:f,type:"mouseover",handler:function(a){return c._handleMouseOver(a?a:o.event)}});a.push({target:f,type:"mouseout",handler:function(a){return c._handleMouseOut(a?a:o.event)}});a.push({target:h,type:"mouseup",handler:function(a){return c._handleMouseUp(a?a:o.event)}});a.push({target:h,type:"mousemove",handler:function(a){return c._handleMouseMove(a?a:o.event)}});a.push({target:d,
type:"mousedown",handler:function(a){return c._handleRootMouseDown(a?a:o.event)}});a.push({target:d,type:"mouseup",handler:function(a){return c._handleRootMouseUp(a?a:o.event)}});a.push({target:l,type:"dragstart",handler:function(a){return c._handleDragStart(a?a:o.event)}});a.push({target:l,type:"drag",handler:function(a){return c._handleDrag(a?a:o.event)}});a.push({target:l,type:"dragend",handler:function(a){return c._handleDragEnd(a?a:o.event)}});a.push({target:l,type:"dragenter",handler:function(a){return c._handleDragEnter(a?
a:o.event)}});a.push({target:l,type:"dragover",handler:function(a){return c._handleDragOver(a?a:o.event)}});a.push({target:l,type:"dragleave",handler:function(a){return c._handleDragLeave(a?a:o.event)}});a.push({target:l,type:"drop",handler:function(a){return c._handleDrop(a?a:o.event)}});a.push({target:this._clientDiv,type:b.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(a){return c._handleMouseWheel(a?a:o.event)}});if(b.isFirefox&&(!b.isWindows||b.isFirefox>=15))(j=o.MutationObserver||
o.MozMutationObserver)?(this._mutationObserver=new j(function(a){c._handleDataModified(a)}),this._mutationObserver.observe(f,{subtree:!0,characterData:!0})):a.push({target:this._clientDiv,type:"DOMCharacterDataModified",handler:function(a){return c._handleDataModified(a?a:o.event)}});this._overlayDiv&&(a.push({target:this._overlayDiv,type:"mousedown",handler:function(a){return c._handleMouseDown(a?a:o.event)}}),a.push({target:this._overlayDiv,type:"mouseover",handler:function(a){return c._handleMouseOver(a?
a:o.event)}}),a.push({target:this._overlayDiv,type:"mouseout",handler:function(a){return c._handleMouseOut(a?a:o.event)}}),a.push({target:this._overlayDiv,type:"contextmenu",handler:function(a){return c._handleContextMenu(a?a:o.event)}}));this._isW3CEvents||a.push({target:this._clientDiv,type:"dblclick",handler:function(a){return c._handleDblclick(a?a:o.event)}})}j=this._leftDiv;d=this._rightDiv;b.isIE&&a.push({target:j,type:"selectstart",handler:function(){return!1}});a.push({target:j,type:b.isFirefox?
"DOMMouseScroll":"mousewheel",handler:function(a){return c._handleMouseWheel(a?a:o.event)}});a.push({target:j,type:"click",handler:function(a){c._handleRulerEvent(a?a:o.event)}});a.push({target:j,type:"dblclick",handler:function(a){c._handleRulerEvent(a?a:o.event)}});a.push({target:j,type:"mousemove",handler:function(a){c._handleRulerEvent(a?a:o.event)}});a.push({target:j,type:"mouseover",handler:function(a){c._handleRulerEvent(a?a:o.event)}});a.push({target:j,type:"mouseout",handler:function(a){c._handleRulerEvent(a?
a:o.event)}});b.isIE&&a.push({target:d,type:"selectstart",handler:function(){return!1}});a.push({target:d,type:b.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(a){return c._handleMouseWheel(a?a:o.event)}});a.push({target:d,type:"click",handler:function(a){c._handleRulerEvent(a?a:o.event)}});a.push({target:d,type:"dblclick",handler:function(a){c._handleRulerEvent(a?a:o.event)}});a.push({target:d,type:"mousemove",handler:function(a){c._handleRulerEvent(a?a:o.event)}});a.push({target:d,type:"mouseover",
handler:function(a){c._handleRulerEvent(a?a:o.event)}});a.push({target:d,type:"mouseout",handler:function(a){c._handleRulerEvent(a?a:o.event)}});for(j=0;j<a.length;j++)d=a[j],e(d.target,d.type,d.handler,d.capture)},_getWindow:function(){return this._parent.ownerDocument.defaultView||this._parent.ownerDocument.parentWindow},_init:function(a){var f=a.parent;typeof f==="string"&&(f=(a.document||document).getElementById(f));if(!f)throw"no parent";a.parent=f;a.model=a.model||new u.TextModel;var d=this._defaultOptions(),
j;for(j in d)d.hasOwnProperty(j)&&(this["_"+j]=a[j]!==void 0?a[j]:d[j].value);this._rulers=[];this._selection=new m(0,0,!1);this._linksVisible=!1;this._maxLineWidth=this._redrawCount=0;this._maxLineIndex=-1;this._ignoreSelect=!0;this._hasFocus=this._ignoreFocus=!1;this._dragOffset=this._columnX=-1;this._isRangeRects=(!b.isIE||b.isIE>=9)&&typeof f.ownerDocument.createRange().getBoundingClientRect==="function";this._isW3CEvents=f.addEventListener;this._autoScrollTimerID=this._autoScrollY=this._autoScrollX=
null;this._AUTO_SCROLL_RATE=50;this._mouseUpClosure=this._moseMoveClosure=this._grabControl=null;this._clickCount=this._lastMouseTime=this._lastMouseY=this._lastMouseX=0;this._clickTime=250;this._clickDist=5;this._isMouseDown=!1;this._doubleClickSelection=null;this._vScroll=this._hScroll=0;this._imeOffset=-1;this._createActions();this._createView()},_modifyContent:function(a,f){if(!this._readonly||a._code)if(a.type="Verify",this.onVerify(a),!(a.text===null||a.text===void 0)){var b=this._model;try{if(a._ignoreDOMSelection)this._ignoreDOMSelection=
!0;b.setText(a.text,a.start,a.end)}finally{if(a._ignoreDOMSelection)this._ignoreDOMSelection=!1}f&&(b=this._getSelection(),b.setCaret(a.start+a.text.length),this._setSelection(b,!0));this.onModify({type:"Modify"})}},_onModelChanged:function(a){a.type="ModelChanged";this.onModelChanged(a);a.type="Changed";var f=a.start,b=a.addedCharCount,j=a.removedCharCount,d=a.addedLineCount,l=a.removedLineCount,e=this._getSelection();e.end>f&&(e.end>f&&e.start<f+j?e.setCaret(f+b):(e.start+=b-j,e.end+=b-j),this._setSelection(e,
!1,!1));f=this._model.getLineAtOffset(f);for(b=this._getLineNext();b;){j=b.lineIndex;if(f<=j&&j<=f+l)f===j&&!b.modelChangedEvent&&!b.lineRemoved?(b.modelChangedEvent=a,b.lineChanged=!0):(b.lineRemoved=!0,b.lineChanged=!1,b.modelChangedEvent=null);if(j>f+l)b.lineIndex=j+d-l,b._line.lineIndex=b.lineIndex;b=this._getLineNext(b)}if(!this._wrapMode&&f<=this._maxLineIndex&&this._maxLineIndex<=f+l)this._checkMaxLineIndex=this._maxLineIndex,this._maxLineIndex=-1,this._maxLineWidth=0;this._update()},_onModelChanging:function(a){a.type=
"ModelChanging";this.onModelChanging(a);a.type="Changing"},_queueUpdate:function(){if(!this._updateTimer&&!this._ignoreQueueUpdate){var a=this;this._updateTimer=this._getWindow().setTimeout(function(){a._updateTimer=null;a._update()},0)}},_resetLineHeight:function(a,b){if(this._wrapMode){if(a!==void 0&&b!==void 0)for(var f=a;f<b;f++)this._lineHeight[f]=void 0;else this._lineHeight=Array(this._model.getLineCount());this._calculateLineHeightTimer()}else this._lineHeight=null},_resetLineWidth:function(){var a=
this._clientDiv;if(a)for(a=a.firstChild;a;)a.lineWidth=void 0,a=a.nextSibling},_reset:function(){this._maxLineIndex=-1;this._maxLineWidth=0;this._columnX=-1;this._bottomChild=this._topChild=null;this._topIndexY=0;this._resetLineHeight();this._setSelection(new m(0,0,!1),!1,!1);if(this._viewDiv)this._viewDiv.scrollLeft=0,this._viewDiv.scrollTop=0;var a=this._clientDiv;if(a){for(var f=a.firstChild;f;)f.lineRemoved=!0,f=f.nextSibling;if(b.isFirefox)this._ignoreFocus=!1,(f=this._hasFocus)&&a.blur(),a.contentEditable=
!1,a.contentEditable=!0,f&&a.focus(),this._ignoreFocus=!1}},_scrollView:function(a,f){this._ensureCaretVisible=!1;var b=this._viewDiv;a&&(b.scrollLeft+=a);f&&(b.scrollTop+=f)},_setClipboardText:function(c,f){var d,j=this._parent.ownerDocument,e=this._getWindow();if(e.clipboardData)return d=[],a(c,function(a){d.push(a)},function(){d.push(b.platformDelimiter)}),e.clipboardData.setData("Text",d.join(""));if(f&&f.clipboardData&&(d=[],a(c,function(a){d.push(a)},function(){d.push(b.platformDelimiter)}),
f.clipboardData.setData("text/plain",d.join(""))))return!0;var l=b.createElement(j,"pre");l.style.position="fixed";l.style.left="-1000px";a(c,function(a){l.appendChild(j.createTextNode(a))},function(){l.appendChild(b.createElement(j,"br"))});l.appendChild(j.createTextNode(" "));this._clientDiv.appendChild(l);var o=j.createRange();o.setStart(l.firstChild,0);o.setEndBefore(l.lastChild);var m=e.getSelection();m.rangeCount>0&&m.removeAllRanges();m.addRange(o);var h=this,o=function(){l&&l.parentNode===
h._clientDiv&&h._clientDiv.removeChild(l);h._updateDOMSelection()},m=!1;this._ignoreCopy=!0;try{m=j.execCommand("copy",!1,null)}catch(g){}this._ignoreCopy=!1;if(!m&&f)return e.setTimeout(o,0),!1;o();return!0},_setDOMSelection:function(a,f,d,j){for(var e,l,o,m,h=0,g=a.firstChild,n,i,t=this._model.getLine(a.lineIndex).length;g;){n=g.firstChild;i=n.length;g.ignoreChars&&(i-=g.ignoreChars);if(h+i>f||h+i>=t){e=n;l=f-h;g.ignoreChars&&i>0&&l===i&&(l+=g.ignoreChars);break}h+=i;g=g.nextSibling}for(var h=0,
g=d.firstChild,q=this._model.getLine(d.lineIndex).length;g;){n=g.firstChild;i=n.length;g.ignoreChars&&(i-=g.ignoreChars);if(i+h>j||h+i>=q){o=n;m=j-h;g.ignoreChars&&i>0&&m===i&&(m+=g.ignoreChars);break}h+=i;g=g.nextSibling}this._setDOMFullSelection(a,f,t,d,j,q);if(this._hasFocus)if(f=this._getWindow(),a=this._parent.ownerDocument,f.getSelection){if(f=f.getSelection(),!(f.anchorNode===e&&f.anchorOffset===l&&f.focusNode===o&&f.focusOffset===m||f.anchorNode===o&&f.anchorOffset===m&&f.focusNode===e&&f.focusOffset===
l))a=a.createRange(),a.setStart(e,l),a.setEnd(o,m),this._ignoreSelect=!1,f.rangeCount>0&&f.removeAllRanges(),f.addRange(a),this._ignoreSelect=!0}else if(a.selection)f=a.body,a=b.createElement(a,"div"),f.appendChild(a),f.removeChild(a),a=f.createTextRange(),a.moveToElementText(e.parentNode),a.moveStart("character",l),e=f.createTextRange(),e.moveToElementText(o.parentNode),e.moveStart("character",m),a.setEndPoint("EndToStart",e),this._ignoreSelect=!1,a.select(),this._ignoreSelect=!0},_setDOMFullSelection:function(a,
f,b,j,d){if(this._selDiv1&&(b=this._selDiv1,b.style.width="0px",b.style.height="0px",b=this._selDiv2,b.style.width="0px",b.style.height="0px",b=this._selDiv3,b.style.width="0px",b.style.height="0px",!(a===j&&f===d))){var l=this._model,e=this._getViewPadding(),o=this._clientDiv.getBoundingClientRect(),m=this._viewDiv.getBoundingClientRect(),b=m.left+e.left,h=o.right,e=m.top+e.top,g=o.bottom,m=o=0;this._clipDiv?(m=this._clipDiv.getBoundingClientRect(),o=m.left-this._clipDiv.scrollLeft):(m=this._rootDiv.getBoundingClientRect(),
o=m.left);m=m.top;this._ignoreDOMSelection=!0;var a=(new t(this,a.lineIndex,a)).getBoundingClientRect(l.getLineStart(a.lineIndex)+f,!1),n=a.left,d=(new t(this,j.lineIndex,j)).getBoundingClientRect(l.getLineStart(j.lineIndex)+d,!1),f=d.left;this._ignoreDOMSelection=!1;var l=this._selDiv1,n=Math.min(h,Math.max(b,n)),i=Math.min(g,Math.max(e,a.top)),q=h,j=Math.min(g,Math.max(e,a.bottom));l.style.left=n-o+"px";l.style.top=i-m+"px";l.style.width=Math.max(0,q-n)+"px";l.style.height=Math.max(0,j-i)+"px";
if(a.top===d.top)q=Math.min(f,h),l.style.width=Math.max(0,q-n)+"px";else if(a=Math.min(g,Math.max(e,d.top)),f=Math.min(h,Math.max(b,f)),e=Math.min(g,Math.max(e,d.bottom)),g=this._selDiv3,g.style.left=b-o+"px",g.style.top=a-m+"px",g.style.width=Math.max(0,f-b)+"px",g.style.height=Math.max(0,e-a)+"px",a-j>0)e=this._selDiv2,e.style.left=b-o+"px",e.style.top=j-m+"px",e.style.width=Math.max(0,h-b)+"px",e.style.height=Math.max(0,a-j)+"px"}},_setGrab:function(a){if(a!==this._grabControl)a?(a.setCapture&&
a.setCapture(),this._grabControl=a):(this._grabControl.releaseCapture&&this._grabControl.releaseCapture(),this._grabControl=null)},_setLinksVisible:function(a){if(this._linksVisible!==a){this._linksVisible=a;if(b.isIE&&a)this._hadFocus=this._hasFocus;var f=this._clientDiv;f.contentEditable=!a;this._hadFocus&&!a&&f.focus();if(this._overlayDiv)this._overlayDiv.style.zIndex=a?"-1":"1";for(a=this._getLineNext();a;){if(a.hasLink)for(f=a.firstChild;f;){var d=f.nextSibling,j=f.viewStyle;j&&j.tagName==="A"&&
a.replaceChild(a._line._createSpan(a,f.firstChild.data,j),f);f=d}a=this._getLineNext(a)}}},_setSelection:function(a,f,b,j){if(a){this._columnX=-1;b===void 0&&(b=!0);var d=this._selection;this._selection=a;f&&this._showCaret(!1,j);b&&this._updateDOMSelection();if(!d.equals(a))this.onSelection({type:"Selection",oldValue:{start:d.start,end:d.end},newValue:{start:a.start,end:a.end}})}},_setSelectionTo:function(a,f,b,j){var d=this._model,l=this._getSelection(),f=this.convert({x:a,y:f},"page","document"),
a=this._getLineIndex(f.y);if(this._clickCount===1){d=this._getLine(a);a=d.getOffset(f.x,f.y-this._getLinePixel(a));d.destroy();if(j&&!b&&l.start<=a&&a<l.end)return this._dragOffset=a,!1;l.extend(a);b||l.collapse()}else(this._clickCount&1)===0?(d=this._getLine(a),a=d.getOffset(f.x,f.y-this._getLinePixel(a)),this._doubleClickSelection?a>=this._doubleClickSelection.start?(b=this._doubleClickSelection.start,j=d.getNextOffset(a,"wordend",1)):(b=d.getNextOffset(a,"word",-1),j=this._doubleClickSelection.end):
(b=d.getNextOffset(a,"word",-1),j=d.getNextOffset(b,"wordend",1)),d.destroy()):this._doubleClickSelection?(j=d.getLineAtOffset(this._doubleClickSelection.start),a>=j?(b=d.getLineStart(j),j=d.getLineEnd(a)):(b=d.getLineStart(a),j=d.getLineEnd(j))):(b=d.getLineStart(a),j=d.getLineEnd(a)),l.setCaret(b),l.extend(j);this._setSelection(l,!0,!0);return!0},_setFullSelection:function(a,f){this._fullSelection=a;if(b.isWebkit)this._fullSelection=!0;var d=this._clipDiv||this._rootDiv;if(d)if(this._fullSelection){if(!this._selDiv1&&
this._fullSelection&&!b.isIOS){var j=d.ownerDocument;this._highlightRGB=b.isWebkit?"transparent":"Highlight";var e=b.createElement(j,"div");this._selDiv1=e;e.style.position="absolute";e.style.borderWidth="0px";e.style.margin="0px";e.style.padding="0px";e.style.outline="none";e.style.background=this._highlightRGB;e.style.width="0px";e.style.height="0px";e.style.zIndex="0";d.appendChild(e);var l=b.createElement(j,"div");this._selDiv2=l;l.style.position="absolute";l.style.borderWidth="0px";l.style.margin=
"0px";l.style.padding="0px";l.style.outline="none";l.style.background=this._highlightRGB;l.style.width="0px";l.style.height="0px";l.style.zIndex="0";d.appendChild(l);this._selDiv3=j=b.createElement(j,"div");j.style.position="absolute";j.style.borderWidth="0px";j.style.margin="0px";j.style.padding="0px";j.style.outline="none";j.style.background=this._highlightRGB;j.style.width="0px";j.style.height="0px";j.style.zIndex="0";d.appendChild(j);if(b.isFirefox&&b.isMac){d=this._getWindow().getComputedStyle(j,
null).getPropertyValue("background-color");switch(d){case "rgb(119, 141, 168)":d="rgb(199, 208, 218)";break;case "rgb(127, 127, 127)":d="rgb(198, 198, 198)";break;case "rgb(255, 193, 31)":d="rgb(250, 236, 115)";break;case "rgb(243, 70, 72)":d="rgb(255, 176, 139)";break;case "rgb(255, 138, 34)":d="rgb(255, 209, 129)";break;case "rgb(102, 197, 71)":d="rgb(194, 249, 144)";break;case "rgb(140, 78, 184)":d="rgb(232, 184, 255)";break;default:d="rgb(180, 213, 255)"}this._highlightRGB=d;e.style.background=
d;l.style.background=d;j.style.background=d}f||this._updateDOMSelection()}}else{if(this._selDiv1)d.removeChild(this._selDiv1),this._selDiv1=null;if(this._selDiv2)d.removeChild(this._selDiv2),this._selDiv2=null;if(this._selDiv3)d.removeChild(this._selDiv3),this._selDiv3=null}},_setReadOnly:function(a){this._readonly=a;this._clientDiv.setAttribute("aria-readonly",a?"true":"false")},_setTabSize:function(a,f){this._tabSize=a;this._customTabSize=void 0;var d=this._clientDiv;if(b.isOpera){if(d)d.style.OTabSize=
this._tabSize+""}else if(b.isWebkit>=537.1){if(d)d.style.tabSize=this._tabSize+""}else if(b.isFirefox>=4){if(d)d.style.MozTabSize=this._tabSize+""}else if(this._tabSize!==8)this._customTabSize=this._tabSize;f||(this.redrawLines(),this._resetLineWidth())},_setTheme:function(a){this._theme&&this._theme.removeEventListener("ThemeChanged",this._themeListener.onChanged);(this._theme=a)&&this._theme.addEventListener("ThemeChanged",this._themeListener.onChanged);this._setThemeClass(this._themeClass)},_setThemeClass:function(a,
f){this._themeClass=a;var b="textview",d=this._theme.getThemeClass();d&&(b+=" "+d);this._themeClass&&d!==this._themeClass&&(b+=" "+this._themeClass);this._rootDiv.className=b;this._updateStyle(f)},_setWrapMode:function(a,f){this._wrapMode=a;var b=this._clientDiv,d=this._viewDiv;a?(b.style.whiteSpace="pre-wrap",b.style.wordWrap="break-word",d.style.overflowX="hidden",d.style.overflowY="scroll"):(b.style.whiteSpace="pre",b.style.wordWrap="normal",d.style.overflowX="auto",d.style.overflowY="auto");f||
(this.redraw(),this._resetLineWidth());this._resetLineHeight()},_showCaret:function(a,f){if(this._clientDiv){var b=this._model,d=this._getSelection(),e=this._getScroll(),l=d.getCaret(),o=d.start,m=d.end,h=b.getLineAtOffset(m),g=Math.max(Math.max(o,b.getLineStart(h)),m-1),b=this._getClientWidth(),h=this._getClientHeight(),n=b/4,i=this._getBoundsAtOffset(l===o?o:g),t=i.left,q=i.right,p=i.top,r=i.bottom;a&&!d.isEmpty()&&(i=this._getBoundsAtOffset(l===m?o:g),i.top===p?l===o?q=t+Math.min(i.right-t,b):
t=q-Math.min(q-i.left,b):l===o?r=p+Math.min(i.bottom-p,h):p=r-Math.min(r-i.top,h));d=0;t<e.x&&(d=Math.min(t-e.x,-n));q>e.x+b&&(d=Math.max(q-e.x-b,n));l=0;p<e.y?l=p-e.y:r>e.y+h&&(l=r-e.y-h);f&&(f>0?l>0&&(l=Math.max(l,f)):l<0&&(l=Math.min(l,f)));return d!==0||l!==0?(this._scrollView(d,l),h!==this._getClientHeight()||b!==this._getClientWidth()?this._showCaret():this._ensureCaretVisible=!0,!0):!1}},_startIME:function(){if(this._imeOffset===-1){var a=this._getSelection();a.isEmpty()||this._modifyContent({text:"",
start:a.start,end:a.end},!0);this._imeOffset=a.start}},_unhookEvents:function(){this._model.removeEventListener("preChanging",this._modelListener.onChanging);this._model.removeEventListener("postChanged",this._modelListener.onChanged);this._theme.removeEventListener("ThemeChanged",this._themeListener.onChanged);this._modelListener=null;for(var a=0;a<this._handlers.length;a++){var f=this._handlers[a],b=f.target,d=f.type,f=f.handler;typeof b.removeEventListener==="function"?b.removeEventListener(d,
f,!1):b.detachEvent("on"+d,f)}this._handlers=null;if(this._mutationObserver)this._mutationObserver.disconnect(),this._mutationObserver=null},_updateDOMSelection:function(){if(!this._ignoreDOMSelection&&this._clientDiv){var a=this._getSelection(),f=this._model,b=f.getLineAtOffset(a.start),d=f.getLineAtOffset(a.end),e=this._getLineNext();if(e){var l=this._getLinePrevious(),o;b<e.lineIndex?(o=e,b=0):b>l.lineIndex?(o=l,b=0):(o=this._getLineNode(b),b=a.start-f.getLineStart(b));d<e.lineIndex?a=0:d>l.lineIndex?
(e=l,a=0):(e=this._getLineNode(d),a=a.end-f.getLineStart(d));this._setDOMSelection(o,b,e,a)}}},_update:function(a){if(!(this._redrawCount>0)){if(this._updateTimer)this._getWindow().clearTimeout(this._updateTimer),this._updateTimer=null,a=!1;var f=this._clientDiv;if(f){if(this._metrics.invalid)this._ignoreQueueUpdate=!0,this._updateStyle(),this._ignoreQueueUpdate=!1;var d=this._model,j=this._getScroll(),e=this._getViewPadding(),l=d.getLineCount(),o=this._getLineHeight(),m=this._getClientWidth();if(this._wrapMode)f.style.width=
m+"px";var h,g,n,i,q=0,p=0;if(this._lineHeight){for(;p<l;){n=this._getLineHeight(p);if(q+n>j.y)break;q+=n;p++}h=p;g=Math.max(0,h-1);n=d=j.y-q;h>0&&(d+=this._getLineHeight(h-1))}else i=Math.max(0,j.y)/o,h=Math.floor(i),g=Math.max(0,h-1),d=Math.round((i-g)*o),n=Math.round((i-h)*o);this._topIndexY=n;i=this._parent;var r=i.clientWidth,u=i.clientHeight;i=this._getClientHeight();if(a){g=0;this._leftDiv&&(h=this._leftDiv.getBoundingClientRect(),g=h.right-h.left);h=m;for(this._wrapMode||(h=Math.max(this._maxLineWidth,
h));p<l;)n=this._getLineHeight(p,!1),q+=n,p++;l=q}else{var m=this._viewDiv,o=Math.min(h+Math.floor((i+n)/o),l-1),j=Math.min(o+1,l-1),v;for(n=f.firstChild;n;){v=n.lineIndex;var w=n.nextSibling;if(!(g<=v&&v<=j)||n.lineRemoved||n.lineIndex===-1)this._mouseWheelLine===n?(n.style.display="none",n.lineIndex=-1):f.removeChild(n);n=w}n=this._getLineNext();var w=m.ownerDocument,z=w.createDocumentFragment();for(v=g;v<=j;v++)if(!n||n.lineIndex>v)(new t(this,v)).create(z,null);else{z.firstChild&&(f.insertBefore(z,
n),z=w.createDocumentFragment());if(n&&n.lineChanged)n=(new t(this,v)).create(z,n),n.lineChanged=!1;n=this._getLineNext(n)}z.firstChild&&f.insertBefore(z,n);if(b.isWebkit&&!this._wrapMode)f.style.width="0x7fffffffpx";n=this._getLineNext();v=i+d;for(z=!1;n;){g=n.lineWidth;if(g===void 0)w=n._line.getBoundingClientRect(),g=n.lineWidth=Math.ceil(w.right-w.left),this._lineHeight&&(this._lineHeight[n.lineIndex]=Math.ceil(w.bottom-w.top));if(this._lineHeight&&!z&&(v-=this._lineHeight[n.lineIndex],v<0))o=
n.lineIndex,z=!0;if(!this._wrapMode){if(g>=this._maxLineWidth)this._maxLineWidth=g,this._maxLineIndex=n.lineIndex;if(this._checkMaxLineIndex===n.lineIndex)this._checkMaxLineIndex=-1}if(n.lineIndex===h)this._topChild=n;if(n.lineIndex===o)this._bottomChild=n;n=this._getLineNext(n)}if(this._checkMaxLineIndex!==-1&&(v=this._checkMaxLineIndex,this._checkMaxLineIndex=-1,0<=v&&v<l)){n=new t(this,v);w=n.getBoundingClientRect();g=w.right-w.left;if(g>=this._maxLineWidth)this._maxLineWidth=g,this._maxLineIndex=
v;n.destroy()}for(;p<l;)n=this._getLineHeight(p,p<=o),q+=n,p++;l=q;this._updateRuler(this._leftDiv,h,j,u);this._updateRuler(this._rightDiv,h,j,u);g=0;this._leftDiv&&(h=this._leftDiv.getBoundingClientRect(),g=h.right-h.left);j=0;this._rightDiv&&(j=this._rightDiv.getBoundingClientRect(),j=j.right-j.left);m.style.left=g+"px";m.style.right=j+"px";j=this._scrollDiv;j.style.height=l+"px";q=m=this._getClientWidth();this._wrapMode||(q=Math.max(this._maxLineWidth,q));h=q;if((!b.isIE||b.isIE>=9)&&this._maxLineWidth>
m)q+=e.right+e.left;j.style.width=q+"px";if(this._clipScrollDiv)this._clipScrollDiv.style.width=q+"px";j=this._getScroll()}if(this._vScrollDiv)q=i-8,p=Math.max(15,Math.ceil(Math.min(1,q/(l+e.top+e.bottom))*q)),this._vScrollDiv.style.left=g+m-8+"px",this._vScrollDiv.style.top=Math.floor(Math.max(0,j.y*q/l))+"px",this._vScrollDiv.style.height=p+"px";if(!this._wrapMode&&this._hScrollDiv)q=m-8,p=Math.max(15,Math.ceil(Math.min(1,q/(this._maxLineWidth+e.left+e.right))*q)),this._hScrollDiv.style.left=g+
Math.floor(Math.max(0,Math.floor(j.x*q/this._maxLineWidth)))+"px",this._hScrollDiv.style.top=i-9+"px",this._hScrollDiv.style.width=p+"px";v=j.x;n=this._clipDiv;q=this._overlayDiv;if(n){n.scrollLeft=v;p=g+e.left;o=e.top;a=m;g=i;v=0;w=-d;if(j.x===0)p-=e.left,a+=e.left,v=e.left;j.x+m===h&&(a+=e.right);j.y===0&&(o-=e.top,g+=e.top,w+=e.top);j.y+i===l&&(g+=e.bottom);n.style.left=p+"px";n.style.top=o+"px";n.style.right=r-a-p+"px";n.style.bottom=u-g-o+"px";f.style.left=v+"px";f.style.top=w+"px";f.style.width=
h+"px";f.style.height=i+d+"px";if(q)q.style.left=f.style.left,q.style.top=f.style.top,q.style.width=f.style.width,q.style.height=f.style.height}else{p=v;o=d;r=v+m;u=d+i;p===0&&(p-=e.left);o===0&&(o-=e.top);r===h&&(r+=e.right);j.y+i===l&&(u+=e.bottom);f.style.clip="rect("+o+"px,"+r+"px,"+u+"px,"+p+"px)";f.style.left=-v+g+e.left+"px";f.style.width=(b.isWebkit?h:m+v)+"px";if(!a)f.style.top=-d+e.top+"px",f.style.height=i+d+"px";if(q&&(q.style.clip=f.style.clip,q.style.left=f.style.left,q.style.width=
f.style.width,!a))q.style.top=f.style.top,q.style.height=f.style.height}this._updateDOMSelection();f=this._ensureCaretVisible;this._ensureCaretVisible=!1;i!==this._getClientHeight()&&(this._update(),f&&this._showCaret())}}},_updateRuler:function(a,f,e,j){if(a)for(var o=this._parent.ownerDocument,l=this._getLineHeight(),m=this._getViewPadding(),a=a.firstChild;a;){var h=a._ruler,n=l,g=h.getOverview();g==="page"&&(n+=this._topIndexY);a.style.top=-n+"px";a.style.height=j+n+"px";a.rulerChanged&&d(h.getRulerStyle(),
a);var i,t=a.firstChild;t?(i=t,t=t.nextSibling):(i=b.createElement(o,"div"),i.style.visibility="hidden",a.appendChild(i));var q;if(a.rulerChanged&&i){n=-1;if(q=h.getWidestAnnotation())if(d(q.style,i),q.html)i.innerHTML=q.html;i.lineIndex=n;i.style.height=l+m.top+"px"}var p;if(g==="page"){for(h=h.getAnnotations(f,e+1);t;)n=t.lineIndex,q=t.nextSibling,(!(f<=n&&n<=e)||t.lineChanged)&&a.removeChild(t),t=q;t=a.firstChild.nextSibling;p=o.createDocumentFragment();for(n=f;n<=e;n++)if(!t||t.lineIndex>n){i=
b.createElement(o,"div");if(q=h[n]){d(q.style,i);if(q.html)i.innerHTML=q.html;i.annotation=q}i.lineIndex=n;i.style.height=this._getLineHeight(n)+"px";p.appendChild(i)}else if(p.firstChild&&(a.insertBefore(p,t),p=o.createDocumentFragment()),t)t=t.nextSibling;p.firstChild&&a.insertBefore(p,t)}else{q=this._getClientHeight();n=this._model.getLineCount();t=q+m.top+m.bottom-2*this._metrics.scrollWidth;g=l*n<t?l:t/n;if(a.rulerChanged){for(q=a.childNodes.length;q>1;)a.removeChild(a.lastChild),q--;h=h.getAnnotations(0,
n);p=o.createDocumentFragment();for(var r in h)if(n=r>>>0,!(n<0)){i=b.createElement(o,"div");q=h[r];d(q.style,i);i.style.position="absolute";i.style.top=this._metrics.scrollWidth+l+Math.floor(n*g)+"px";if(q.html)i.innerHTML=q.html;i.annotation=q;i.lineIndex=n;p.appendChild(i)}a.appendChild(p)}else if(a._oldTrackHeight!==t)for(i=a.firstChild?a.firstChild.nextSibling:null;i;)i.style.top=this._metrics.scrollWidth+l+Math.floor(i.lineIndex*g)+"px",i=i.nextSibling;a._oldTrackHeight=t}a.rulerChanged=!1;
a=a.nextSibling}},_updateStyle:function(a){if(!a&&b.isIE)this._rootDiv.style.lineHeight="normal";var f=this._metrics=this._calculateMetrics();this._rootDiv.style.lineHeight=b.isIE?f.lineHeight-(f.lineTrim.top+f.lineTrim.bottom)+"px":"normal";a||(this.redraw(),this._resetLineWidth())}};p.EventTarget.addMixin(q.prototype);return{TextView:q}});
(function(){function u(b,e,d,g,h,a){e[b]&&(d.push(b),(e[b]===!0||e[b]===1)&&g.push(h+b+"/"+a))}function r(b,e,d,g,h){e=g+e+"/"+h;require._fileExists(b.toUrl(e))&&d.push(e)}var p=/(^.*(^|\/)nls(\/|$))([^\/]*)\/?([^\/]*)/,i={};define("i18n",{version:"1.0.0",load:function(b,e,d,g){var g=g||{},h=p.exec(b),a=h[1],f=h[4],o=h[5],m=f.split("-"),n=[],t={},q,c,k="";h[5]?(a=h[1],b=a+o):(o=h[4],f=g.locale||(g.locale=typeof navigator==="undefined"?"root":(navigator.language||navigator.userLanguage||"root").toLowerCase()),
m=f.split("-"));if(g.isBuild){n.push(b);r(e,"root",n,a,o);for(q=0;c=m[q];q++)k+=(k?"-":"")+c,r(e,k,n,a,o);e(n,function(){d()})}else e([b],function(f){var b=[];u("root",f,b,n,a,o);for(q=0;c=m[q];q++)k+=(k?"-":"")+c,u(k,f,b,n,a,o);e(n,function(){var m,l;for(m=b.length-1;m>-1&&(c=b[m]);m--){l=f[c];if(l===!0||l===1)l=e(a+c+"/"+o);var h=t,k=void 0;for(k in l)!(k in i)&&!(k in h)&&(h[k]=l[k])}d(t)})})}})})();
define("orion/editor/i18n",{load:function(u,r,p){r.specified&&r.specified("orion/bootstrap")?r(["orion/i18n!"+u],function(i){p(i)}):p({})}});
define("orion/editor/nls/root/messages",{multipleAnnotations:"Multiple annotations:",line:"Line: ${0}",breakpoint:"Breakpoint",bookmark:"Bookmark",task:"Task",error:"Error",warning:"Warning",matchingSearch:"Matching Search",currentSearch:"Current Search",currentLine:"Current Line",matchingBracket:"Matching Bracket",currentBracket:"Current Bracket",Comment:"Comment","Flat outline":"Flat outline",incrementalFind:"Incremental find: ${0}",incrementalFindNotFound:"Incremental find: ${0} (not found)",find:"Find...",
undo:"Undo",redo:"Redo",cancelMode:"Cancel Current Mode",findNext:"Find Next Occurrence",findPrevious:"Find Previous Occurrence",incrementalFindKey:"Incremental Find",indentLines:"Indent Lines",unindentLines:"Unindent Lines",moveLinesUp:"Move Lines Up",moveLinesDown:"Move Lines Down",copyLinesUp:"Copy Lines Up",copyLinesDown:"Copy Lines Down",deleteLines:"Delete Lines",gotoLine:"Goto Line...",gotoLinePrompty:"Goto Line:",nextAnnotation:"Next Annotation",prevAnnotation:"Previous Annotation",expand:"Expand",
collapse:"Collapse",expandAll:"Expand All",collapseAll:"Collapse All",lastEdit:"Last Edit Location",toggleLineComment:"Toggle Line Comment",addBlockComment:"Add Block Comment",removeBlockComment:"Remove Block Comment",linkedModeEntered:"Linked Mode entered",linkedModeExited:"Linked Mode exited",syntaxError:"Syntax Error",contentAssist:"Content Assist",lineColumn:"Line ${0} : Col ${1}"});
define("orion/editor/nls/messages",["orion/editor/i18n!orion/editor/nls/messages","orion/editor/nls/root/messages"],function(u,r){var p={root:r},i;for(i in u)u.hasOwnProperty(i)&&typeof p[i]==="undefined"&&(p[i]=u[i]);return p});
define("orion/editor/annotations",["i18n!orion/editor/nls/messages","orion/editor/eventTarget"],function(u,r){function p(a,f,b){this.start=a;this.end=f;this._projectionModel=b;this.html=this._expandedHTML;this.style=this._expandedStyle;this.expanded=!0}function i(){}function b(a,f){var b=a.lastIndexOf("."),b=a.substring(b+1),d={title:u[b],style:{styleClass:"annotation "+b},html:"<div class='annotationHTML "+b+"'></div>",overviewStyle:{styleClass:"annotationOverview "+b}};f?d.lineStyle={styleClass:"annotationLine "+
b}:d.rangeStyle={styleClass:"annotationRange "+b};i.registerType(a,d)}function e(){}function d(a){this._annotations=[];var f=this;this._listener={onChanged:function(a){f._onChanged(a)}};this.setTextModel(a)}function g(a,f){this._view=a;this._annotationModel=f;var b=this;this._listener={onDestroy:function(a){b._onDestroy(a)},onLineStyle:function(a){b._onLineStyle(a)},onChanged:function(a){b._onAnnotationModelChanged(a)}};a.addEventListener("Destroy",this._listener.onDestroy);a.addEventListener("postLineStyle",
this._listener.onLineStyle);f.addEventListener("Changed",this._listener.onChanged)}p.prototype={_expandedHTML:"<div class='annotationHTML expanded'></div>",_expandedStyle:{styleClass:"annotation expanded"},_collapsedHTML:"<div class='annotationHTML collapsed'></div>",_collapsedStyle:{styleClass:"annotation collapsed"},collapse:function(){if(this.expanded){this.expanded=!1;this.html=this._collapsedHTML;this.style=this._collapsedStyle;var a=this._projectionModel,f=a.getBaseModel();this._projection=
{start:f.getLineStart(f.getLineAtOffset(this.start)+1),end:f.getLineEnd(f.getLineAtOffset(this.end),!0)};a.addProjection(this._projection)}},expand:function(){if(!this.expanded)this.expanded=!0,this.html=this._expandedHTML,this.style=this._expandedStyle,this._projectionModel.removeProjection(this._projection)}};i.ANNOTATION_ERROR="orion.annotation.error";i.ANNOTATION_WARNING="orion.annotation.warning";i.ANNOTATION_TASK="orion.annotation.task";i.ANNOTATION_BREAKPOINT="orion.annotation.breakpoint";
i.ANNOTATION_BOOKMARK="orion.annotation.bookmark";i.ANNOTATION_FOLDING="orion.annotation.folding";i.ANNOTATION_CURRENT_BRACKET="orion.annotation.currentBracket";i.ANNOTATION_MATCHING_BRACKET="orion.annotation.matchingBracket";i.ANNOTATION_CURRENT_LINE="orion.annotation.currentLine";i.ANNOTATION_CURRENT_SEARCH="orion.annotation.currentSearch";i.ANNOTATION_MATCHING_SEARCH="orion.annotation.matchingSearch";i.ANNOTATION_READ_OCCURRENCE="orion.annotation.readOccurrence";i.ANNOTATION_WRITE_OCCURRENCE="orion.annotation.writeOccurrence";
var h={};i.registerType=function(a,f){var b=f;if(typeof b!=="function")b=function(a,f,b){this.start=a;this.end=f;if(b)this.title=b},b.prototype=f;b.prototype.type=a;h[a]=b;return a};i.createAnnotation=function(a,f,b,d){return new (this.getType(a))(f,b,d)};i.getType=function(a){return h[a]};b(i.ANNOTATION_ERROR);b(i.ANNOTATION_WARNING);b(i.ANNOTATION_TASK);b(i.ANNOTATION_BREAKPOINT);b(i.ANNOTATION_BOOKMARK);b(i.ANNOTATION_CURRENT_BRACKET);b(i.ANNOTATION_MATCHING_BRACKET);b(i.ANNOTATION_CURRENT_SEARCH);
b(i.ANNOTATION_MATCHING_SEARCH);b(i.ANNOTATION_READ_OCCURRENCE);b(i.ANNOTATION_WRITE_OCCURRENCE);b(i.ANNOTATION_CURRENT_LINE,!0);i.registerType(i.ANNOTATION_FOLDING,p);e.addMixin=function(a){var f=e.prototype,b;for(b in f)f.hasOwnProperty(b)&&(a[b]=f[b])};e.prototype={addAnnotationType:function(a){if(!this._annotationTypes)this._annotationTypes=[];this._annotationTypes.push(a)},getAnnotationTypePriority:function(a){if(this._annotationTypes)for(var f=0;f<this._annotationTypes.length;f++)if(this._annotationTypes[f]===
a)return f+1;return 0},getAnnotationsByType:function(a,f,b){a=a.getAnnotations(f,b);for(b=[];a.hasNext();)f=a.next(),this.getAnnotationTypePriority(f.type)!==0&&b.push(f);var d=this;b.sort(function(a,f){return d.getAnnotationTypePriority(a.type)-d.getAnnotationTypePriority(f.type)});return b},isAnnotationTypeVisible:function(a){return this.getAnnotationTypePriority(a)!==0},removeAnnotationType:function(a){if(this._annotationTypes)for(var f=0;f<this._annotationTypes.length;f++)if(this._annotationTypes[f]===
a){this._annotationTypes.splice(f,1);break}}};d.prototype={addAnnotation:function(a){if(a){var f=this._annotations,b=this._binarySearch(f,a.start);f.splice(b,0,a);this.onChanged({type:"Changed",added:[a],removed:[],changed:[]})}},getTextModel:function(){return this._model},getAnnotations:function(a,f){var b=this._annotations,d,e=0,h=function(){for(;e<b.length;){var d=b[e++];if(a===d.start||(a>d.start?a<d.end:d.start<f))return d;if(d.start>=f)break}return null};d=h();return{next:function(){var a=d;
a&&(d=h());return a},hasNext:function(){return d!==null}}},modifyAnnotation:function(a){if(a&&!(this._getAnnotationIndex(a)<0))this.onChanged({type:"Changed",added:[],removed:[],changed:[a]})},onChanged:function(a){return this.dispatchEvent(a)},removeAnnotations:function(a){var f=this._annotations,b,d;if(a){b=[];for(d=f.length-1;d>=0;d--){var e=f[d];e.type===a&&f.splice(d,1);b.splice(0,0,e)}}else b=f;this.onChanged({type:"Changed",removed:b,added:[],changed:[]})},removeAnnotation:function(a){if(a&&
(a=this._getAnnotationIndex(a),!(a<0)))this.onChanged({type:"Changed",removed:this._annotations.splice(a,1),added:[],changed:[]})},replaceAnnotations:function(a,f){var b=this._annotations,d,e,h,g=[];if(a)for(d=a.length-1;d>=0;d--)h=a[d],e=this._getAnnotationIndex(h),e<0||(b.splice(e,1),g.splice(0,0,h));f||(f=[]);for(d=0;d<f.length;d++)h=f[d],e=this._binarySearch(b,h.start),b.splice(e,0,h);this.onChanged({type:"Changed",removed:g,added:f,changed:[]})},setTextModel:function(a){this._model&&this._model.removeEventListener("Changed",
this._listener.onChanged);(this._model=a)&&this._model.addEventListener("Changed",this._listener.onChanged)},_binarySearch:function(a,f){for(var b=a.length,d=-1,e;b-d>1;)e=Math.floor((b+d)/2),f<=a[e].start?b=e:d=e;return b},_getAnnotationIndex:function(a){for(var f=this._annotations,b=this._binarySearch(f,a.start);b<f.length&&f[b].start===a.start;){if(f[b]===a)return b;b++}return-1},_onChanged:function(a){var b=a.start,d=a.removedCharCount,e=this._annotations,h=b+d;if(0<e.length){for(var g={type:"Changed",
added:[],removed:[],changed:[],textModelChangedEvent:a},a=a.addedCharCount-d,d=0;d<e.length;d++){var i=e[d];i.start>=h?(i.start+=a,i.end+=a,g.changed.push(i)):i.end<=b||(i.start<b&&h<i.end?(i.end+=a,g.changed.push(i)):(e.splice(d,1),g.removed.push(i),d--))}if(g.added.length>0||g.removed.length>0||g.changed.length>0)this.onChanged(g)}}};r.EventTarget.addMixin(d.prototype);g.prototype={destroy:function(){var a=this._view;if(a)a.removeEventListener("Destroy",this._listener.onDestroy),a.removeEventListener("LineStyle",
this._listener.onLineStyle),this.view=null;(a=this._annotationModel)&&a.removeEventListener("Changed",this._listener.onChanged)},_mergeStyle:function(a,b){if(b){a||(a={});a.styleClass&&b.styleClass&&a.styleClass!==b.styleClass?a.styleClass+=" "+b.styleClass:a.styleClass=b.styleClass;var d;if(b.style){if(!a.style)a.style={};for(d in b.style)a.style[d]||(a.style[d]=b.style[d])}if(b.attributes){if(!a.attributes)a.attributes={};for(d in b.attributes)a.attributes[d]||(a.attributes[d]=b.attributes[d])}}return a},
_mergeStyleRanges:function(a,b){a||(a=[]);var d,e;for(e=0;e<a.length&&b;e++){var h=a[e];if(b.end<=h.start)break;if(!(b.start>=h.end)){d=this._mergeStyle({},h.style);d=this._mergeStyle(d,b.style);var g=[];g.push(e,1);b.start<h.start&&g.push({start:b.start,end:h.start,style:b.style});b.start>h.start&&g.push({start:h.start,end:b.start,style:h.style});g.push({start:Math.max(h.start,b.start),end:Math.min(h.end,b.end),style:d});b.end<h.end&&g.push({start:b.end,end:h.end,style:h.style});b=b.end>h.end?{start:h.end,
end:b.end,style:b.style}:null;Array.prototype.splice.apply(a,g)}}b&&(d=this._mergeStyle({},b.style),a.splice(e,0,{start:b.start,end:b.end,style:d}));return a},_onAnnotationModelChanged:function(a){function b(a){for(var f=0;f<a.length;f++)if(e.isAnnotationTypeVisible(a[f].type)){var c=a[f].start,k=a[f].end;h.getBaseModel&&(c=h.mapOffset(c,!0),k=h.mapOffset(k,!0));c!==-1&&k!==-1&&d.redrawRange(c,k)}}if(!a.textModelChangedEvent){var d=this._view;if(d){var e=this,h=d.getModel();b(a.added);b(a.removed);
b(a.changed)}}},_onDestroy:function(){this.destroy()},_onLineStyle:function(a){var b=this._annotationModel,d=a.textView.getModel(),e=b.getTextModel(),h=a.lineStart,g=a.lineStart+a.lineText.length;e!==d&&(h=d.mapOffset(h),g=d.mapOffset(g));for(b=b.getAnnotations(h,g);b.hasNext();)if(h=b.next(),this.isAnnotationTypeVisible(h.type)){if(h.rangeStyle){var g=h.start,i=h.end;e!==d&&(g=d.mapOffset(g,!0),i=d.mapOffset(i,!0));a.ranges=this._mergeStyleRanges(a.ranges,{start:g,end:i,style:h.rangeStyle})}if(h.lineStyle)a.style=
this._mergeStyle({},a.style),a.style=this._mergeStyle(a.style,h.lineStyle)}}};e.addMixin(g.prototype);return{FoldingAnnotation:p,AnnotationType:i,AnnotationTypeList:e,AnnotationModel:d,AnnotationStyler:g}});
define("orion/editor/tooltip",["i18n!orion/editor/nls/messages","orion/editor/textView","orion/editor/textModel","orion/editor/projectionTextModel","orion/util"],function(u,r,p,i,b){function e(b){this._view=b;this._create(b.getOptions("parent").ownerDocument);b.addEventListener("Destroy",this,this.destroy)}e.getTooltip=function(b){if(!b._tooltip)b._tooltip=new e(b);return b._tooltip};e.prototype={_create:function(d){if(!this._tooltipDiv){var e=this._tooltipDiv=b.createElement(d,"div");e.className=
"textviewTooltip";e.setAttribute("aria-live","assertive");e.setAttribute("aria-atomic","true");var h=this._tooltipContents=b.createElement(d,"div");e.appendChild(h);d.body.appendChild(e);this.hide()}},_getWindow:function(){var b=this._tooltipDiv.ownerDocument;return b.defaultView||b.parentWindow},destroy:function(){if(this._tooltipDiv){this.hide();var b=this._tooltipDiv.parentNode;b&&b.removeChild(this._tooltipDiv);this._tooltipDiv=null}},hide:function(){if(this._contentsView)this._contentsView.destroy(),
this._contentsView=null;if(this._tooltipContents)this._tooltipContents.innerHTML="";if(this._tooltipDiv)this._tooltipDiv.style.visibility="hidden";var b=this._getWindow();if(this._showTimeout)b.clearTimeout(this._showTimeout),this._showTimeout=null;if(this._hideTimeout)b.clearTimeout(this._hideTimeout),this._hideTimeout=null;if(this._fadeTimeout)b.clearInterval(this._fadeTimeout),this._fadeTimeout=null},isVisible:function(){return this._tooltipDiv&&this._tooltipDiv.style.visibility==="visible"},setTarget:function(b,
e){if(this.target!==b&&(this._target=b,this.hide(),b)){var h=this;if(e===0)h.show(!0);else{var a=this._getWindow();h._showTimeout=a.setTimeout(function(){h.show(!0)},e?e:500)}}},show:function(b){if(this._target){var e=this._target.getTooltipInfo();if(e){var h=this._tooltipDiv,a=this._tooltipContents;h.style.left=h.style.right=h.style.width=h.style.height=a.style.width=a.style.height="auto";var f=e.contents;f instanceof Array&&(f=this._getAnnotationContents(f));if(typeof f==="string")a.innerHTML=f;
else if(this._isNode(f))a.appendChild(f);else if(f instanceof i.ProjectionTextModel){var o=this._view,m=o.getOptions();m.wrapMode=!1;m.parent=a;var n=m.themeClass;n?((n=n.replace("tooltip",""))&&(n=" "+n),n="tooltip"+n):n="tooltip";m.themeClass=n;m=this._contentsView=new r.TextView(m);m._clientDiv.contentEditable=!1;m.addEventListener("LineStyle",function(a){o.onLineStyle(a)});m.setModel(f);f=m.computeSize();a.style.width=f.width+20+"px";a.style.height=f.height+"px";m.resize()}else return;a=h.ownerDocument.documentElement;
e.anchor==="right"?(f=a.clientWidth-e.x,h.style.right=f+"px"):(f=parseInt(this._getNodeStyle(h,"padding-left","0"),10),f+=parseInt(this._getNodeStyle(h,"border-left-width","0"),10),f=e.x-f,h.style.left=f+"px");h.style.maxWidth=a.clientWidth-f-10+"px";f=parseInt(this._getNodeStyle(h,"padding-top","0"),10);f+=parseInt(this._getNodeStyle(h,"border-top-width","0"),10);f=e.y-f;h.style.top=f+"px";h.style.maxHeight=a.clientHeight-f-10+"px";h.style.opacity="1";h.style.visibility="visible";if(b){var t=this,
q=this._getWindow();t._hideTimeout=q.setTimeout(function(){var a=parseFloat(t._getNodeStyle(h,"opacity","1"));t._fadeTimeout=q.setInterval(function(){h.style.visibility==="visible"&&a>0?(a-=0.1,h.style.opacity=a):t.hide()},50)},5E3)}}}},_getAnnotationContents:function(b){function e(b){var f=b.title;if(f==="")return null;var d="<div>";b.html&&(d+=b.html+"&nbsp;");if(!f)f=b.end,b=a.getLineStart(a.getLineAtOffset(b.start)),f=a.getLineEnd(a.getLineAtOffset(f),!0),f=a.getText(b,f);f=f.replace(/</g,"&lt;").replace(/>/g,
"&gt;");d+="<span style='vertical-align:middle;'>"+f+"</span><div>";return d}if(b.length===0)return null;var h=this._view.getModel(),a=h.getBaseModel?h.getBaseModel():h;if(b.length===1)if(h=b[0],h.title!==void 0)return e(h);else{var b=new i.ProjectionTextModel(a),f=a.getLineStart(a.getLineAtOffset(h.start)),o=a.getCharCount();h.end!==o&&b.addProjection({start:h.end,end:o});f>0&&b.addProjection({start:0,end:f});return b}else{f="<div><em>"+u.multipleAnnotations+"</em></div>";for(o=0;o<b.length;o++)h=
b[o],(h=e(h))&&(f+=h);return f}},_getNodeStyle:function(b,e,h){var a;if(b&&(a=b.style[e],!a))if(b.currentStyle){for(a=0;(a=e.indexOf("-",a))!==-1;)e=e.substring(0,a)+e.substring(a+1,a+2).toUpperCase()+e.substring(a+2);a=b.currentStyle[e]}else a=(b=b.ownerDocument.defaultView.getComputedStyle(b,null))?b.getPropertyValue(e):null;return a||h},_isNode:function(b){return typeof Node==="object"?b instanceof Node:b&&typeof b==="object"&&typeof b.nodeType==="number"&&typeof b.nodeName==="string"}};return{Tooltip:e}});
define("orion/editor/rulers",["i18n!orion/editor/nls/messages","orion/editor/annotations","orion/editor/tooltip","orion/util"],function(u,r,p,i){function b(a,b,d,e){this._location=b||"left";this._overview=d||"page";this._rulerStyle=e;this._view=null;var h=this;this._listener={onTextModelChanged:function(a){h._onTextModelChanged(a)},onAnnotationModelChanged:function(a){h._onAnnotationModelChanged(a)}};this.setAnnotationModel(a)}function e(a,f,d,e,h){b.call(this,a,f,"page",d);this._oddStyle=e||{style:{backgroundColor:"white"}};
this._evenStyle=h||{style:{backgroundColor:"white"}};this._numOfDigits=0}function d(a,f,d){b.call(this,a,f,"page",d)}function g(a,f,d){b.call(this,a,f,"document",d)}function h(a,b,e){d.call(this,a,b,e)}b.prototype={getAnnotations:function(a,b){var d=this._annotationModel;if(!d)return[];var e=this._view.getModel(),h=e.getLineStart(a),g=e.getLineEnd(b-1),i=e;e.getBaseModel&&(i=e.getBaseModel(),h=e.mapOffset(h),g=e.mapOffset(g));for(var c=[],d=this.getAnnotationsByType(d,h,g),h=0;h<d.length;h++)for(var g=
d[h],k=i.getLineAtOffset(g.start),s=i.getLineAtOffset(Math.max(g.start,g.end-1)),j=k;j<=s;j++){var x=j;if(e!==i){x=i.getLineStart(j);x=e.mapOffset(x,!0);if(x===-1)continue;x=e.getLineAtOffset(x)}if(a<=x&&x<b){var l=this._mergeAnnotation(c[x],g,j-k,s-k+1);l&&(c[x]=l)}}if(!this._multiAnnotation&&this._multiAnnotationOverlay)for(var y in c)c[y]._multiple&&(c[y].html+=this._multiAnnotationOverlay.html);return c},getAnnotationModel:function(){return this._annotationModel},getLocation:function(){return this._location},
getOverview:function(){return this._overview},getRulerStyle:function(){return this._rulerStyle},getView:function(){return this._view},getWidestAnnotation:function(){return null},setAnnotationModel:function(a){this._annotationModel&&this._annotationModel.removEventListener("Changed",this._listener.onAnnotationModelChanged);(this._annotationModel=a)&&this._annotationModel.addEventListener("Changed",this._listener.onAnnotationModelChanged)},setMultiAnnotation:function(a){this._multiAnnotation=a},setMultiAnnotationOverlay:function(a){this._multiAnnotationOverlay=
a},setView:function(a){this._onTextModelChanged&&this._view&&this._view.removeEventListener("ModelChanged",this._listener.onTextModelChanged);this._view=a;this._onTextModelChanged&&this._view&&this._view.addEventListener("ModelChanged",this._listener.onTextModelChanged)},onClick:function(){},onDblClick:function(){},onMouseMove:function(a,b){var d=p.Tooltip.getTooltip(this._view);if(d&&!(d.isVisible()&&this._tooltipLineIndex===a)){this._tooltipLineIndex=a;var e=this;d.setTarget({y:b.clientY,getTooltipInfo:function(){return e._getTooltipInfo(e._tooltipLineIndex,
this.y)}})}},onMouseOver:function(a,b){this.onMouseMove(a,b)},onMouseOut:function(){var a=p.Tooltip.getTooltip(this._view);a&&a.setTarget(null)},_getTooltipInfo:function(a,b){if(a!==void 0){var d=this._view,e=d.getModel(),h=this._annotationModel,g=[];if(h){var g=e.getLineStart(a),i=e.getLineEnd(a);e.getBaseModel&&(g=e.mapOffset(g),i=e.mapOffset(i));g=this.getAnnotationsByType(h,g,i)}h=this._getTooltipContents(a,g);if(!h)return null;h={contents:h,anchor:this.getLocation()};g=d.getClientArea();g.y=
this.getOverview()==="document"?d.convert({y:b},"view","document").y:d.getLocationAtOffset(e.getLineStart(a)).y;d.convert(g,"document","page");h.x=g.x;h.y=g.y;h.anchor==="right"&&(h.x+=g.width);return h}},_getTooltipContents:function(a,b){return b},_onAnnotationModelChanged:function(a){function b(a){for(var c=0;c<a.length;c++)if(h.isAnnotationTypeVisible(a[c].type)){var f=a[c].start,g=a[c].end;e.getBaseModel&&(f=e.mapOffset(f,!0),g=e.mapOffset(g,!0));f!==-1&&g!==-1&&d.redrawLines(e.getLineAtOffset(f),
e.getLineAtOffset(Math.max(f,g-1))+1,h)}}var d=this._view;if(d){var e=d.getModel(),h=this,g=e.getLineCount();a.textModelChangedEvent?(a=a.textModelChangedEvent.start,e.getBaseModel&&(a=e.mapOffset(a,!0)),a=e.getLineAtOffset(a),d.redrawLines(a,g,h)):(b(a.added),b(a.removed),b(a.changed))}},_mergeAnnotation:function(a,b,d){a||(a={});if(d===0)if(a.html&&b.html){if(b.html!==a.html&&!a._multiple&&this._multiAnnotation)a.html=this._multiAnnotation.html;a._multiple=!0}else a.html=b.html;a.style=this._mergeStyle(a.style,
b.style);return a},_mergeStyle:function(a,b){if(b){a||(a={});a.styleClass&&b.styleClass&&a.styleClass!==b.styleClass?a.styleClass+=" "+b.styleClass:a.styleClass=b.styleClass;var d;if(b.style){if(!a.style)a.style={};for(d in b.style)a.style[d]||(a.style[d]=b.style[d])}if(b.attributes){if(!a.attributes)a.attributes={};for(d in b.attributes)a.attributes[d]||(a.attributes[d]=b.attributes[d])}}return a}};r.AnnotationTypeList.addMixin(b.prototype);e.prototype=new b;e.prototype.getAnnotations=function(a,
f){for(var d=b.prototype.getAnnotations.call(this,a,f),e=this._view.getModel(),h=a;h<f;h++){var g=h&1?this._oddStyle:this._evenStyle,i=h;e.getBaseModel&&(i=e.getLineStart(i),i=e.getBaseModel().getLineAtOffset(e.mapOffset(i)));d[h]||(d[h]={});d[h].html=i+1+"";if(!d[h].style)d[h].style=g}return d};e.prototype.getWidestAnnotation=function(){var a=this._view.getModel().getLineCount();return this.getAnnotations(a-1,a)[a-1]};e.prototype._onTextModelChanged=function(a){var a=a.start,b=this._view.getModel(),
d=((b.getBaseModel?b.getBaseModel().getLineCount():b.getLineCount())+"").length;if(this._numOfDigits!==d)this._numOfDigits=d,this._view.redrawLines(b.getLineAtOffset(a),b.getLineCount(),this)};d.prototype=new b;g.prototype=new b;g.prototype.getRulerStyle=function(){var a={style:{lineHeight:"1px",fontSize:"1px"}};return a=this._mergeStyle(a,this._rulerStyle)};g.prototype.onClick=function(a){a!==void 0&&this._view.setTopIndex(a)};g.prototype._getTooltipContents=function(a,f){if(f.length===0){var d=
this._view.getModel(),e=a;d.getBaseModel&&(e=d.getLineStart(e),e=d.getBaseModel().getLineAtOffset(d.mapOffset(e)));return i.formatMessage(u.line,e+1)}return b.prototype._getTooltipContents.call(this,a,f)};g.prototype._mergeAnnotation=function(a,b,d,e){if(d===0){if(!a)a={html:"&nbsp;",style:{style:{height:3*e+"px"}}},a.style=this._mergeStyle(a.style,b.overviewStyle);return a}};h.prototype=new d;h.prototype.onClick=function(a){if(a!==void 0){var b=this._annotationModel;if(b){var d=this._view.getModel(),
e=d.getLineStart(a),a=d.getLineEnd(a,!0);d.getBaseModel&&(e=d.mapOffset(e),a=d.mapOffset(a),d=d.getBaseModel());for(var h,b=b.getAnnotations(e,a);!h&&b.hasNext();)a=b.next(),this.isAnnotationTypeVisible(a.type)&&(h=a);h&&d.getLineAtOffset(h.start)===d.getLineAtOffset(e)&&((d=p.Tooltip.getTooltip(this._view))&&d.setTarget(null),h.expanded?h.collapse():h.expand(),this._annotationModel.modifyAnnotation(h))}}};h.prototype._getTooltipContents=function(a,b){return b.length===1&&b[0].expanded?null:d.prototype._getTooltipContents.call(this,
a,b)};h.prototype._onAnnotationModelChanged=function(a){function b(a){for(i=0;i<a.length;i++)if(g.isAnnotationTypeVisible(a[i].type)){var f=a[i].start;h.getBaseModel&&(f=h.mapOffset(f,!0));f!==-1&&(c=Math.min(c,h.getLineAtOffset(f)))}}if(a.textModelChangedEvent)d.prototype._onAnnotationModelChanged.call(this,a);else{var e=this._view;if(e){var h=e.getModel(),g=this,i,q=h.getLineCount(),c=q;b(a.added);b(a.removed);b(a.changed);a=e.getRulers();for(i=0;i<a.length;i++)e.redrawLines(c,q,a[i])}}};return{Ruler:b,
AnnotationRuler:d,LineNumberRuler:e,OverviewRuler:g,FoldingRuler:h}});
define("orion/editor/undoStack",[],function(){function u(i,b,e){this.offset=i;this.text=b;this.previousText=e}function r(){this.changes=[]}function p(i,b){this.view=i;this.size=b!==void 0?b:100;this.reset();var e=i.getModel();e.getBaseModel&&(e=e.getBaseModel());this.model=e;var d=this;this._listener={onChanging:function(b){d._onChanging(b)},onDestroy:function(b){d._onDestroy(b)}};e.addEventListener("Changing",this._listener.onChanging);i.addEventListener("Destroy",this._listener.onDestroy)}u.prototype=
{undo:function(i,b){this._doUndoRedo(this.offset,this.previousText,this.text,i,b)},redo:function(i,b){this._doUndoRedo(this.offset,this.text,this.previousText,i,b)},_doUndoRedo:function(i,b,e,d,g){var h=d.getModel();if(h.mapOffset&&d.annotationModel){var a=h.mapOffset(i,!0);if(a<0)for(var f=d.annotationModel.getAnnotations(i,i+1);f.hasNext();){var o=f.next();if(o.type==="orion.annotation.folding"){o.expand();a=h.mapOffset(i,!0);break}}if(a<0)return;i=a}d.setText(b,i,i+e.length);g&&d.setSelection(i,
i+b.length)}};r.prototype={add:function(i){this.changes.push(i)},end:function(i){this.endSelection=i.getSelection();this.endCaret=i.getCaretOffset()},undo:function(i,b){for(var e=this.changes.length-1;e>=0;e--)this.changes[e].undo(i,!1);if(b){var e=this.startSelection.start,d=this.startSelection.end;i.setSelection(this.startCaret?e:d,this.startCaret?d:e)}},redo:function(i,b){for(var e=0;e<this.changes.length;e++)this.changes[e].redo(i,!1);if(b){var e=this.endSelection.start,d=this.endSelection.end;
i.setSelection(this.endCaret?e:d,this.endCaret?d:e)}},start:function(i){this.startSelection=i.getSelection();this.startCaret=i.getCaretOffset()}};p.prototype={add:function(i){this.compoundChange?this.compoundChange.add(i):(this.stack.splice(this.index,this.stack.length-this.index,i),this.index++,this.stack.length>this.size&&(this.stack.shift(),this.index--,this.cleanIndex--))},markClean:function(){this.endCompoundChange();this._commitUndo();this.cleanIndex=this.index},isClean:function(){return this.cleanIndex===
this.getSize().undo},canUndo:function(){return this.getSize().undo>0},canRedo:function(){return this.getSize().redo>0},endCompoundChange:function(){this.compoundChange&&this.compoundChange.end(this.view);this.compoundChange=void 0},getSize:function(){var i=this.index,b=this.stack.length;this._undoStart!==void 0&&i++;return{undo:i,redo:b-i}},undo:function(){this._commitUndo();if(this.index<=0)return!1;var i=this.stack[--this.index];this._ignoreUndo=!0;i.undo(this.view,!0);this._ignoreUndo=!1;return!0},
redo:function(){this._commitUndo();if(this.index>=this.stack.length)return!1;var i=this.stack[this.index++];this._ignoreUndo=!0;i.redo(this.view,!0);this._ignoreUndo=!1;return!0},reset:function(){this.index=this.cleanIndex=0;this.stack=[];this._undoStart=void 0;this._undoText="";this._undoType=0;this._ignoreUndo=!1;this._compoundChange=void 0},startCompoundChange:function(){this._commitUndo();var i=new r;this.add(i);this.compoundChange=i;this.compoundChange.start(this.view)},_commitUndo:function(){if(this._undoStart!==
void 0)this._undoType===-1?this.add(new u(this._undoStart,"",this._undoText)):this.add(new u(this._undoStart,this._undoText,"")),this._undoStart=void 0,this._undoText="",this._undoType=0},_onDestroy:function(){this.model.removeEventListener("Changing",this._listener.onChanging);this.view.removeEventListener("Destroy",this._listener.onDestroy)},_onChanging:function(i){var b=i.text,e=i.start,d=i.removedCharCount,i=i.addedCharCount;if(!this._ignoreUndo){this._undoStart!==void 0&&!(i===1&&d===0&&this._undoType===
1&&e===this._undoStart+this._undoText.length||i===0&&d===1&&this._undoType===-1&&(e+1===this._undoStart||e===this._undoStart))&&this._commitUndo();if(!this.compoundChange)if(i===1&&d===0){if(this._undoStart===void 0)this._undoStart=e;this._undoText+=b;this._undoType=1;return}else if(i===0&&d===1){b=this._undoText.length>0&&this._undoStart===e;this._undoStart=e;this._undoType=-1;b?this._undoText+=this.model.getText(e,e+d):this._undoText=this.model.getText(e,e+d)+this._undoText;return}this.add(new u(e,
b,this.model.getText(e,e+d)))}}};return{UndoStack:p}});
define("orion/editor/textDND",[],function(){function u(r,p){this._view=r;this._undoStack=p;this._dragSelection=null;this._dropOffset=-1;this._dropText=null;var i=this;this._listener={onDragStart:function(b){i._onDragStart(b)},onDragEnd:function(b){i._onDragEnd(b)},onDragEnter:function(b){i._onDragEnter(b)},onDragOver:function(b){i._onDragOver(b)},onDrop:function(b){i._onDrop(b)},onDestroy:function(b){i._onDestroy(b)}};r.addEventListener("DragStart",this._listener.onDragStart);r.addEventListener("DragEnd",
this._listener.onDragEnd);r.addEventListener("DragEnter",this._listener.onDragEnter);r.addEventListener("DragOver",this._listener.onDragOver);r.addEventListener("Drop",this._listener.onDrop);r.addEventListener("Destroy",this._listener.onDestroy)}u.prototype={destroy:function(){var r=this._view;if(r)r.removeEventListener("DragStart",this._listener.onDragStart),r.removeEventListener("DragEnd",this._listener.onDragEnd),r.removeEventListener("DragEnter",this._listener.onDragEnter),r.removeEventListener("DragOver",
this._listener.onDragOver),r.removeEventListener("Drop",this._listener.onDrop),r.removeEventListener("Destroy",this._listener.onDestroy),this._view=null},_onDestroy:function(){this.destroy()},_onDragStart:function(r){var p=this._view,i=p.getSelection(),p=p.getModel();if(p.getBaseModel)i.start=p.mapOffset(i.start),i.end=p.mapOffset(i.end),p=p.getBaseModel();if(p=p.getText(i.start,i.end))this._dragSelection=i,r.event.dataTransfer.effectAllowed="copyMove",r.event.dataTransfer.setData("Text",p)},_onDragEnd:function(r){var p=
this._view;if(this._dragSelection){this._undoStack&&this._undoStack.startCompoundChange();(r=r.event.dataTransfer.dropEffect==="move")&&p.setText("",this._dragSelection.start,this._dragSelection.end);if(this._dropText){var i=this._dropText,b=this._dropOffset;if(r)if(b>=this._dragSelection.end)b-=this._dragSelection.end-this._dragSelection.start;else if(b>=this._dragSelection.start)b=this._dragSelection.start;p.setText(i,b,b);p.setSelection(b,b+i.length);this._dropText=null;this._dropOffset=-1}this._undoStack&&
this._undoStack.endCompoundChange()}this._dragSelection=null},_onDragEnter:function(r){this._onDragOver(r)},_onDragOver:function(r){var p=r.event.dataTransfer.types;if(p){var i=!this._view.getOptions("readonly");i&&(i=p.contains?p.contains("text/plain"):p.indexOf("text/plain")!==-1);if(!i)r.event.dataTransfer.dropEffect="none"}},_onDrop:function(r){var p=this._view,i=r.event.dataTransfer.getData("Text");if(i)r=p.getOffsetAtLocation(r.x,r.y),this._dragSelection?(this._dropOffset=r,this._dropText=i):
(p.setText(i,r,r),p.setSelection(r,r+i.length))}};return{TextDND:u}});
define("orion/editor/editor","i18n!orion/editor/nls/messages,orion/keyBinding,orion/editor/eventTarget,orion/editor/tooltip,orion/editor/annotations,orion/util".split(","),function(u,r,p,i,b,e){function d(a){this._textViewFactory=a.textViewFactory;this._undoStackFactory=a.undoStackFactory;this._textDNDFactory=a.textDNDFactory;this._annotationFactory=a.annotationFactory;this._foldingRulerFactory=a.foldingRulerFactory;this._lineNumberRulerFactory=a.lineNumberRulerFactory;this._contentAssistFactory=
a.contentAssistFactory;this._keyBindingFactory=a.keyBindingFactory;this._statusReporter=a.statusReporter;this._domNode=a.domNode;this._foldingRuler=this._overviewRuler=this._lineNumberRuler=this._annotationRuler=this._annotationModel=this._annotationStyler=null;this._dirty=!1;this._title=this._contentAssist=null;this._keyModes=[]}function g(a){var b=this,d=Array.prototype.slice.call(arguments,1);return d.length?function(){return arguments.length?b.apply(a,d.concat(Array.prototype.slice.call(arguments))):
b.apply(a,d)}:function(){return arguments.length?b.apply(a,arguments):b.call(a)}}var h;d.prototype={destroy:function(){this.uninstallTextView();this._textViewFactory=this._undoStackFactory=this._textDNDFactory=this._annotationFactory=this._foldingRulerFactory=this._lineNumberRulerFactory=this._contentAssistFactory=this._keyBindingFactory=this._statusReporter=this._domNode=null},getAnnotationModel:function(){return this._annotationModel},getAnnotationRuler:function(){return this._annotationRuler},
getAnnotationStyler:function(){return this._annotationStyler},getFoldingRuler:function(){return this._foldingRuler},getLineNumberRuler:function(){return this._lineNumberRuler},getModel:function(){var a=this._textView.getModel();a.getBaseModel&&(a=a.getBaseModel());return a},getOverviewRuler:function(){return this._overviewRuler},getTextView:function(){return this._textView},getTitle:function(){return this._title},getKeyModes:function(){return this._keyModes},isDirty:function(){return this._dirty},
setAnnotationRulerVisible:function(a){if(this._annotationRulerVisible!==a&&(this._annotationRulerVisible=a,this._annotationRuler)){var b=this._textView;a?b.addRuler(this._annotationRuler,0):b.removeRuler(this._annotationRuler)}},setFoldingRulerVisible:function(a){if(this._foldingRulerVisible!==a&&(this._foldingRulerVisible=a,this._foldingRuler)){var b=this._textView;b.getModel().getBaseModel&&(a?b.addRuler(this._foldingRuler,100):b.removeRuler(this._foldingRuler))}},setDirty:function(a){if(this._dirty!==
a)this._dirty=a,this.onDirtyChanged({type:"DirtyChanged"})},setLineNumberRulerVisible:function(a){if(this._lineNumberRulerVisible!==a&&(this._lineNumberRulerVisible=a,this._lineNumberRuler)){var b=this._textView;a?b.addRuler(this._lineNumberRuler,1):b.removeRuler(this._lineNumberRuler)}},setOverviewRulerVisible:function(a){if(this._overviewRulerVisible!==a&&(this._overviewRulerVisible=a,this._overviewRuler)){var b=this._textView;a?b.addRuler(this._overviewRuler):b.removeRuler(this._overviewRuler)}},
mapOffset:function(a,b){var d=this._textView.getModel();d.getBaseModel&&(a=d.mapOffset(a,b));return a},getCaretOffset:function(){return this.mapOffset(this._textView.getCaretOffset())},getSelection:function(){var a=this._textView,b=a.getSelection(),a=a.getModel();if(a.getBaseModel)b.start=a.mapOffset(b.start),b.end=a.mapOffset(b.end);return b},getText:function(a,b){var d=this._textView.getModel();d.getBaseModel&&(d=d.getBaseModel());return d.getText(a,b)},_expandOffset:function(a){var d=this._textView.getModel(),
e=this._annotationModel;if(e&&d.getBaseModel)for(a=e.getAnnotations(a,a+1);a.hasNext();)d=a.next(),d.type===b.AnnotationType.ANNOTATION_FOLDING&&d.expand&&(d.expand(),e.modifyAnnotation(d))},setCaretOffset:function(a){var b=this._textView,d=b.getModel();d.getBaseModel&&(this._expandOffset(a),a=d.mapOffset(a,!0));b.setCaretOffset(a)},setText:function(a,b,d){var e=this._textView,h=e.getModel();h.getBaseModel&&(b!==void 0&&(this._expandOffset(b),b=h.mapOffset(b,!0)),d!==void 0&&(this._expandOffset(d),
d=h.mapOffset(d,!0)));e.setText(a,b,d)},setFoldingEnabled:function(a){this.setFoldingRulerVisible(a)},setSelection:function(a,b,d){var e=this._textView,h=e.getModel();h.getBaseModel&&(this._expandOffset(a),this._expandOffset(b),a=h.mapOffset(a,!0),b=h.mapOffset(b,!0));e.setSelection(a,b,d)},moveSelection:function(a,b,d,e){var g=this._textView;this.setSelection(a,b||a,!1);var b=g.getTopPixel(),i=g.getBottomPixel(),a=this.getModel().getLineAtOffset(a),a=g.getLinePixel(a);a<b||a>i?(i=Math.max(0,a-Math.floor((a<
b?3:1)*(i-b)/4)),(new h({node:g,duration:300,curve:[b,i],onAnimate:function(a){g.setTopPixel(Math.floor(a))},onEnd:function(){g.showSelection();(e===void 0||e)&&g.focus();d&&d()}})).play()):(g.showSelection(),(e===void 0||e)&&g.focus(),d&&d())},checkDirty:function(){this.setDirty(!this._undoStack.isClean())},reportStatus:function(a,b,d){this._statusReporter&&this._statusReporter(a,b,d)},_getTooltipInfo:function(a,b){var d=this._textView,e=this.getAnnotationModel();if(!e)return null;var h=this._annotationStyler;
if(!h)return null;var g=d.getOffsetAtLocation(a,b);if(g===-1)return null;g=this.mapOffset(g);h=h.getAnnotationsByType(e,g,g+1);e=[];for(g=0;g<h.length;g++)h[g].rangeStyle&&e.push(h[g]);if(e.length===0)return null;d=d.convert({x:a,y:b},"document","page");return{contents:e,anchor:"left",x:d.x+10,y:d.y+20}},_highlightCurrentLine:function(a,d){var e=this._annotationModel;if(e){var h=this._textView.getModel(),g=d?h.getLineAtOffset(d.start):-1,i=h.getLineAtOffset(a.start),q=a.start===a.end,c=!d||d.start===
d.end,k=h.getLineStart(i),s=h.getLineEnd(i);h.getBaseModel&&(k=h.mapOffset(k),s=h.mapOffset(s));h=this._currentLineAnnotation;if(!(g===i&&c&&q&&h&&h.start===k&&h.end===s)){var g=h?[h]:null,j;q&&(h=b.AnnotationType.createAnnotation(b.AnnotationType.ANNOTATION_CURRENT_LINE,k,s),j=[h]);this._currentLineAnnotation=h;e.replaceAnnotations(g,j)}}},installTextView:function(){this._textView=this._textViewFactory();if(this._undoStackFactory)this._undoStack=this._undoStackFactory.createUndoStack(this);if(this._textDNDFactory)this._textDND=
this._textDNDFactory.createTextDND(this,this._undoStack);if(this._contentAssistFactory){var a=this._contentAssistFactory.createContentAssistMode(this);this._keyModes.push(a);this._contentAssist=a.getContentAssist()}var d=this,e=this._textView,h=this;this._listener={onModelChanged:function(){h.checkDirty()},onMouseOver:function(a){h._listener.onMouseMove(a)},onMouseMove:function(a){var b=i.Tooltip.getTooltip(e);if(b&&!(h._listener.lastMouseX===a.event.clientX&&h._listener.lastMouseY===a.event.clientY))h._listener.lastMouseX=
a.event.clientX,h._listener.lastMouseY=a.event.clientY,b.setTarget({x:a.x,y:a.y,getTooltipInfo:function(){return h._getTooltipInfo(this.x,this.y)}})},onMouseOut:function(a){var b=i.Tooltip.getTooltip(e);if(b&&!(h._listener.lastMouseX===a.event.clientX&&h._listener.lastMouseY===a.event.clientY))h._listener.lastMouseX=a.event.clientX,h._listener.lastMouseY=a.event.clientY,b.setTarget(null)},onScroll:function(){var a=i.Tooltip.getTooltip(e);a&&a.setTarget(null)},onSelection:function(a){h._updateCursorStatus();
h._highlightCurrentLine(a.newValue,a.oldValue)}};e.addEventListener("ModelChanged",this._listener.onModelChanged);e.addEventListener("Selection",this._listener.onSelection);e.addEventListener("MouseOver",this._listener.onMouseOver);e.addEventListener("MouseOut",this._listener.onMouseOut);e.addEventListener("MouseMove",this._listener.onMouseMove);e.addEventListener("Scroll",this._listener.onScroll);this._keyBindingFactory&&this._keyBindingFactory(this,this._keyModes,this._undoStack,this._contentAssist);
e.setKeyBinding(new r.KeyBinding(27),"cancelMode");e.setAction("cancelMode",function(){for(var a=!1,b=0;b<this._keyModes.length;b++)this._keyModes[b].isActive()&&(a=this._keyModes[b].cancel()||a);return a}.bind(this),{name:u.cancelMode});e.setAction("lineUp",function(){for(var a=0;a<this._keyModes.length;a++)if(this._keyModes[a].isActive())return this._keyModes[a].lineUp();return!1}.bind(this));e.setAction("lineDown",function(){for(var a=0;a<this._keyModes.length;a++)if(this._keyModes[a].isActive())return this._keyModes[a].lineDown();
return!1}.bind(this));e.setAction("enter",function(){for(var a=0;a<this._keyModes.length;a++)if(this._keyModes[a].isActive())return this._keyModes[a].enter();return!1}.bind(this));a=function(a){if(a!==void 0&&a!==-1){for(var c=this.getView().getModel(),e=this.getAnnotationModel(),h=d.mapOffset(c.getLineStart(a)),a=d.mapOffset(c.getLineEnd(a)),c=e.getAnnotations(h,a),j=null;c.hasNext();){var g=c.next();if(g.type===b.AnnotationType.ANNOTATION_BOOKMARK){j=g;break}}j?e.removeAnnotation(j):(j=b.AnnotationType.createAnnotation(b.AnnotationType.ANNOTATION_BOOKMARK,
h,a),j.title=void 0,e.addAnnotation(j))}};if(this._annotationFactory){var g=e.getModel();g.getBaseModel&&(g=g.getBaseModel());if(this._annotationModel=this._annotationFactory.createAnnotationModel(g))if(g=this._annotationStyler=this._annotationFactory.createAnnotationStyler(e,this._annotationModel))g.addAnnotationType(b.AnnotationType.ANNOTATION_CURRENT_SEARCH),g.addAnnotationType(b.AnnotationType.ANNOTATION_MATCHING_SEARCH),g.addAnnotationType(b.AnnotationType.ANNOTATION_ERROR),g.addAnnotationType(b.AnnotationType.ANNOTATION_WARNING),
g.addAnnotationType(b.AnnotationType.ANNOTATION_MATCHING_BRACKET),g.addAnnotationType(b.AnnotationType.ANNOTATION_CURRENT_BRACKET),g.addAnnotationType(b.AnnotationType.ANNOTATION_CURRENT_LINE),g.addAnnotationType(b.AnnotationType.ANNOTATION_READ_OCCURRENCE),g.addAnnotationType(b.AnnotationType.ANNOTATION_WRITE_OCCURRENCE),g.addAnnotationType("orion.annotation.highlightError");e.annotationModel=this._annotationModel;var g=this._annotationFactory.createAnnotationRulers(this._annotationModel),t=this._annotationRuler=
g.annotationRuler;if(t)t.onClick=function(a){if(a!==void 0&&a!==-1)for(var b=this.getView().getModel(),e=this.getAnnotationModel(),h=d.mapOffset(b.getLineStart(a)),a=d.mapOffset(b.getLineEnd(a)),a=e.getAnnotations(h,a);a.hasNext();)if(e=a.next(),this.isAnnotationTypeVisible(e.type)){a=d.getModel();d.onGotoLine(a.getLineAtOffset(h),e.start-h,e.end-h);break}},t.onDblClick=a,t.setMultiAnnotationOverlay({html:"<div class='annotationHTML overlay'></div>"}),t.addAnnotationType(b.AnnotationType.ANNOTATION_ERROR),
t.addAnnotationType(b.AnnotationType.ANNOTATION_WARNING),t.addAnnotationType(b.AnnotationType.ANNOTATION_TASK),t.addAnnotationType(b.AnnotationType.ANNOTATION_BOOKMARK);this.setAnnotationRulerVisible(!0);if(t=this._overviewRuler=g.overviewRuler)t.onClick=function(a){a!==void 0&&(a=e.getModel().getLineStart(a),d.moveSelection(d.mapOffset(a)))},t.addAnnotationType(b.AnnotationType.ANNOTATION_CURRENT_SEARCH),t.addAnnotationType(b.AnnotationType.ANNOTATION_MATCHING_SEARCH),t.addAnnotationType(b.AnnotationType.ANNOTATION_ERROR),
t.addAnnotationType(b.AnnotationType.ANNOTATION_WARNING),t.addAnnotationType(b.AnnotationType.ANNOTATION_TASK),t.addAnnotationType(b.AnnotationType.ANNOTATION_BOOKMARK),t.addAnnotationType(b.AnnotationType.ANNOTATION_MATCHING_BRACKET),t.addAnnotationType(b.AnnotationType.ANNOTATION_CURRENT_BRACKET),t.addAnnotationType(b.AnnotationType.ANNOTATION_CURRENT_LINE),t.addAnnotationType(b.AnnotationType.ANNOTATION_READ_OCCURRENCE),t.addAnnotationType(b.AnnotationType.ANNOTATION_WRITE_OCCURRENCE);this.setOverviewRulerVisible(!0)}if(this._lineNumberRulerFactory)this._lineNumberRuler=
this._lineNumberRulerFactory.createLineNumberRuler(this._annotationModel),this._lineNumberRuler.onDblClick=a,this.setLineNumberRulerVisible(!0);if(this._foldingRulerFactory)this._foldingRuler=this._foldingRulerFactory.createFoldingRuler(this._annotationModel),this._foldingRuler.addAnnotationType(b.AnnotationType.ANNOTATION_FOLDING),this.setFoldingRulerVisible(!1);this.dispatchEvent({type:"TextViewInstalled",textView:e})},uninstallTextView:function(){var a=this._textView;if(a)a.destroy(),this._textView=
this._undoStack=this._textDND=this._contentAssist=this._listener=this._annotationModel=this._annotationStyler=this._annotationRuler=this._overviewRuler=this._lineNumberRuler=this._foldingRuler=this._currentLineAnnotation=this._title=null,this._dirty=!1,this._keyModes=[],this.dispatchEvent({type:"TextViewUninstalled",textView:a})},_updateCursorStatus:function(){var a=this.getModel(),b=this.getCaretOffset(),d=a.getLineAtOffset(b),a=a.getLineStart(d);b-=a;for(a=0;a<this._keyModes.length;a++){var h=this._keyModes[a];
if(h.isActive()&&h.isStatusActive&&h.isStatusActive())return}this.reportStatus(e.formatMessage(u.lineColumn,d+1,b+1))},showProblems:function(a){var d=this._annotationModel;if(d){for(var e=[],h=[],g=d.getTextModel(),i=d.getAnnotations(0,g.getCharCount()),q;i.hasNext();)q=i.next(),(q.type===b.AnnotationType.ANNOTATION_ERROR||q.type===b.AnnotationType.ANNOTATION_WARNING)&&e.push(q);if(a)for(i=0;i<a.length;i++)if(q=a[i]){var c=q.description.replace(/'/g,"&#39;").replace(/"/g,"&#34;"),k=g.getLineStart(q.line-
1);q=b.AnnotationType.createAnnotation(q.severity==="error"?b.AnnotationType.ANNOTATION_ERROR:b.AnnotationType.ANNOTATION_WARNING,k+q.start-1,k+q.end,c);h.push(q)}d.replaceAnnotations(e,h)}},showOccurrences:function(a){var d=this._annotationModel;if(d){for(var e=[],h=[],g=d.getTextModel(),i=d.getAnnotations(0,g.getCharCount()),q;i.hasNext();)q=i.next(),(q.type===b.AnnotationType.ANNOTATION_READ_OCCURRENCE||q.type===b.AnnotationType.ANNOTATION_WRITE_OCCURRENCE)&&e.push(q);if(a)for(i=0;i<a.length;i++)if(q=
a[i]){var c=g.getLineStart(q.line-1);q=b.AnnotationType.createAnnotation(q.readAccess===!0?b.AnnotationType.ANNOTATION_READ_OCCURRENCE:b.AnnotationType.ANNOTATION_WRITE_OCCURRENCE,c+q.start-1,c+q.end,q.description);h.push(q)}d.replaceAnnotations(e,h)}},showSelection:function(a,b,d,e,h){typeof a==="number"?(typeof b!=="number"&&(b=a),this.moveSelection(a,b)):typeof d==="number"&&(a=this.getModel().getLineStart(d-1),typeof e==="number"&&(a+=e),typeof h!=="number"&&(h=0),this.moveSelection(a,a+h))},
setInput:function(a,b,d,e){this._title=a;this._textView&&(e?(this._undoStack.markClean(),this.checkDirty()):(b?this._textView.setText(b):d!==null&&d!==void 0&&(this._textView.setText(d),this._textView.getModel().setLineDelimiter("auto"),this._highlightCurrentLine(this._textView.getSelection())),this._undoStack.reset(),this.checkDirty(),this._textView.focus()));this.onInputChanged({type:"InputChanged",title:a,message:b,contents:d,contentsSaved:e})},onInputChanged:function(a){return this.dispatchEvent(a)},
onGotoLine:function(a,b,d){if(this._textView){var e=this.getModel(),h=e.getLineStart(a),g=0;d===void 0&&(d=0);typeof b==="string"?(a=e.getLine(a).indexOf(b),a!==-1&&(g=a,d=g+b.length)):(g=b,b=e.getLineEnd(a)-h,g=Math.min(g,b),d=Math.min(d,b));this.moveSelection(h+g,h+d)}},onDirtyChanged:function(a){return this.dispatchEvent(a)}};p.EventTarget.addMixin(d.prototype);h=function(){function a(a){this.options=a}a.prototype.play=function(){var a=typeof this.options.duration==="number"?this.options.duration:
350,b=this.options.easing||this.defaultEasing,d=this.options.onAnimate||function(){},e=this.options.onEnd||function(){},h=this.options.curve[0],g=this.options.curve[1]-h,c,k,i=-1;k=setInterval(function(){i=i===-1?(new Date).getTime():i;var j=((new Date).getTime()-i)/a;j<1?(j=b(j),c=h+j*g,d(c)):(clearInterval(k),e())},typeof this.options.rate==="number"?this.options.rate:20)};a.prototype.defaultEasing=function(a){return Math.sin(a*(Math.PI/2))};return a}();if(!Function.prototype.bind)Function.prototype.bind=
g;return{Editor:d}});define("orion/editor/regex",[],function(){return{escape:function(u){return u.replace(/([\\$\^*\/+?\.\(\)|{}\[\]])/g,"\\$&")},parse:function(u){return(u=/^\s*\/(.+)\/([gim]{0,3})\s*$/.exec(u))?{pattern:u[1],flags:u[2]}:null}}});
define("orion/editor/editorFeatures","i18n!orion/editor/nls/messages,orion/editor/undoStack,orion/keyBinding,orion/editor/rulers,orion/editor/annotations,orion/editor/tooltip,orion/editor/textDND,orion/editor/regex,orion/util".split(","),function(u,r,p,i,b,e,d,g,h){function a(){}function f(){}function o(){}function m(){}function n(){}function t(a,b,c){this.editor=a;this.textView=a.getTextView();this.undoStack=b;this._incrementalFindActive=!1;this._incrementalFindSuccess=!0;this._incrementalFindIgnoreSelection=
!1;this._incrementalFindPrefix="";this._searcher=c;this._lastEditLocation=null;this.init()}function q(a,b,c,d){this.editor=a;this.textView=a.getTextView();this.undoStack=b;this.contentAssist=c;this.linkedMode=d;this.contentAssist&&this.contentAssist.addEventListener("ProposalApplied",this.contentAssistProposalApplied.bind(this));this.init()}function c(a){this.editor=a;this.textView=a.getTextView();this.linkedModeActive=!1;this.linkedModePositions=[];this.linkedModeEscapePosition=this.linkedModeCurrentPositionIndex=
0;this.linkedModeListener={onVerify:function(a){for(var b=!1,c=0,d=0;d<this.linkedModePositions.length;++d){var e=this.linkedModePositions[d];if(b)e.offset+=c;else if(a.start>=e.offset&&a.end<=e.offset+e.length)b=e.length,e.length=a.start-e.offset+a.text.length+(e.offset+e.length-a.end),c=e.length-b,b=!0}b?this.linkedModeEscapePosition+=c:this.cancel()}.bind(this)}}a.prototype={createUndoStack:function(a){var a=a.getTextView(),b=new r.UndoStack(a,200);a.setAction("undo",function(){b.undo();return!0},
{name:u.undo});a.setAction("redo",function(){b.redo();return!0},{name:u.redo});return b}};f.prototype={createLineNumberRuler:function(a){return new i.LineNumberRuler(a,"left",{styleClass:"ruler lines"},{styleClass:"rulerLines odd"},{styleClass:"rulerLines even"})}};o.prototype={createFoldingRuler:function(a){return new i.FoldingRuler(a,"left",{styleClass:"ruler folding"})}};m.prototype={createAnnotationModel:function(a){return new b.AnnotationModel(a)},createAnnotationStyler:function(a,c){return new b.AnnotationStyler(a,
c)},createAnnotationRulers:function(a){var b=new i.AnnotationRuler(a,"left",{styleClass:"ruler annotations"}),a=new i.OverviewRuler(a,"right",{styleClass:"ruler overview"});return{annotationRuler:b,overviewRuler:a}}};n.prototype={createTextDND:function(a,b){return new d.TextDND(a.getTextView(),b)}};t.prototype={init:function(){function a(d){var f=c.editor,l=f.getAnnotationModel();if(!l)return!0;for(var h=f.getModel(),g=f.getCaretOffset(),l=l.getAnnotations(d?g:0,d?h.getCharCount():g),k=null;l.hasNext();){var i=
l.next();if(d){if(i.start<=g)continue}else if(i.start>=g)continue;switch(i.type){case b.AnnotationType.ANNOTATION_ERROR:case b.AnnotationType.ANNOTATION_WARNING:case b.AnnotationType.ANNOTATION_TASK:case b.AnnotationType.ANNOTATION_BOOKMARK:break;default:continue}k=i;if(d)break}if(k){var m=c.textView,o=h.getLineAtOffset(k.start),n=e.Tooltip.getTooltip(m);if(!n)return f.moveSelection(k.start),!0;f.moveSelection(k.start,k.start,function(){n.setTarget({getTooltipInfo:function(){var a=m.convert({x:m.getLocationAtOffset(k.start).x,
y:m.getLocationAtOffset(h.getLineStart(o)).y},"document","page");return{contents:[k],x:a.x,y:a.y+Math.floor(m.getLineHeight(o)*1.33)}}},0)})}return!0}var c=this;this._incrementalFindListener={onVerify:function(a){var b=c.editor,d=b.getModel(),e=b.mapOffset(a.start),f=b.mapOffset(a.end),e=d.getText(e,f),d=c._incrementalFindPrefix;if((d=d.match(RegExp("^"+g.escape(e),"i")))&&d.length>0)d=c._incrementalFindPrefix+=a.text,c.editor.reportStatus(h.formatMessage(u.incrementalFind,d)),e=b.getSelection().start,
(e=b.getModel().find({string:d,start:e,caseInsensitive:d.toLowerCase()===d}).next())?(c._incrementalFindSuccess=!0,c._incrementalFindIgnoreSelection=!0,b.moveSelection(e.start,e.end),c._incrementalFindIgnoreSelection=!1):(b.reportStatus(h.formatMessage(u.incrementalFindNotFound,d),"error"),c._incrementalFindSuccess=!1),a.text=null},onSelection:function(){c._incrementalFindIgnoreSelection||c.toggleIncrementalFind()}};this._lastEditListener={onModelChanged:function(a){if(c.editor.isDirty())c._lastEditLocation=
a.start+a.addedCharCount}};this.textView.addEventListener("ModelChanged",this._lastEditListener.onModelChanged);this.textView.setKeyBinding(new p.KeyBinding("k",!0),"findNext");this.textView.setAction("findNext",function(){if(this._searcher){var a=this.textView.getSelection();a.start<a.end?this._searcher.findNext(!0,this.textView.getText(a.start,a.end)):this._searcher.findNext(!0);return!0}return!1}.bind(this),{name:u.findNext});this.textView.setKeyBinding(new p.KeyBinding("k",!0,!0),"findPrevious");
this.textView.setAction("findPrevious",function(){if(this._searcher){var a=this.textView.getSelection();a.start<a.end?this._searcher.findNext(!1,this.textView.getText(a.start,a.end)):this._searcher.findNext(!1);return!0}return!1}.bind(this),{name:u.findPrevious});this.textView.setKeyBinding(new p.KeyBinding("j",!0),"incrementalFind");this.textView.setAction("incrementalFind",function(){if(this._searcher&&this._searcher.visible())return!0;var a=this.editor;if(this._incrementalFindActive){var b=this._incrementalFindPrefix;
if(b.length!==0){var c;c=0;this._incrementalFindSuccess&&(c=a.getSelection().start+1);(c=a.getModel().find({string:b,start:c,caseInsensitive:b.toLowerCase()===b}).next())?(this._incrementalFindIgnoreSelection=this._incrementalFindSuccess=!0,a.moveSelection(c.start,c.end),this._incrementalFindIgnoreSelection=!1,a.reportStatus(h.formatMessage(u.incrementalFind,b))):(a.reportStatus(h.formatMessage(u.incrementalFindNotFound,b),"error"),this._incrementalFindSuccess=!1)}}else a.setCaretOffset(a.getCaretOffset()),
this.toggleIncrementalFind();return!0}.bind(this),{name:u.incrementalFindKey});this.textView.setAction("deletePrevious",function(){if(this._incrementalFindActive){var a=this.editor,b=this._incrementalFindPrefix,b=this._incrementalFindPrefix=b.substring(0,b.length-1);if(b.length===0)return this._incrementalFindIgnoreSelection=this._incrementalFindSuccess=!0,a.setCaretOffset(a.getSelection().start),this._incrementalFindIgnoreSelection=!1,this.toggleIncrementalFind(),!0;a.reportStatus(h.formatMessage(u.incrementalFind,
b));var c=a.getModel().find({string:b,start:a.getCaretOffset()-b.length-1,reverse:!0,caseInsensitive:b.toLowerCase()===b}).next();c?(this._incrementalFindIgnoreSelection=this._incrementalFindSuccess=!0,a.moveSelection(c.start,c.end),this._incrementalFindIgnoreSelection=!1):a.reportStatus(h.formatMessage(u.incrementalFindNotFound,b),"error");return!0}return!1}.bind(this));this.textView.setAction("tab",function(){if(this.textView.getOptions("readonly"))return!1;if(this.textView.getOptions("tabMode")){var a=
this.editor,b=a.getModel(),c=a.getSelection(),d=b.getLineAtOffset(c.start),e=b.getLineAtOffset(c.end>c.start?c.end-1:c.end);if(d!==e){var f=[];f.push("");for(var h=d;h<=e;h++)f.push(b.getLine(h,!0));var h=b.getLineStart(d),b=b.getLineEnd(e,!0),g=this.textView.getOptions("tabSize","expandTab"),g=g.expandTab?Array(g.tabSize+1).join(" "):"\t";a.setText(f.join(g),h,b);a.setSelection(h===c.start?c.start:c.start+g.length,c.end+(e-d+1)*g.length);return!0}a=a.getKeyModes();for(c=0;c<a.length;c++)if(a[c].isActive())return a[c].tab();
return!1}}.bind(this));this.textView.setAction("shiftTab",function(){if(this.textView.getOptions("readonly"))return!1;if(this.textView.getOptions("tabMode")){for(var a=this.editor,b=a.getModel(),c=a.getSelection(),d=b.getLineAtOffset(c.start),e=b.getLineAtOffset(c.end>c.start?c.end-1:c.end),f=this.textView.getOptions("tabSize"),h=Array(f+1).join(" "),g=[],k=0,i=0,m=d;m<=e;m++){var o=b.getLine(m,!0);if(b.getLineStart(m)!==b.getLineEnd(m))if(o.indexOf("\t")===0)o=o.substring(1),k++;else if(o.indexOf(h)===
0)o=o.substring(f),k+=f;else return!0;m===d&&(i=k);g.push(o)}d=b.getLineStart(d);f=b.getLineEnd(e,!0);b=b.getLineStart(e);a.setText(g.join(""),d,f);g=d===c.start?c.start:c.start-i;c=Math.max(g,c.end-k+(c.end===b+1&&c.start!==c.end?1:0));a.setSelection(g,c);return!0}}.bind(this),{name:u.unindentLines});this.textView.setKeyBinding(new p.KeyBinding(38,!1,!1,!0),"moveLinesUp");this.textView.setAction("moveLinesUp",function(){if(this.textView.getOptions("readonly"))return!1;var a=this.editor,b=a.getModel(),
c=a.getSelection(),d=b.getLineAtOffset(c.start);if(d===0)return!0;var e=b.getLineAtOffset(c.end>c.start?c.end-1:c.end),f=b.getLineCount(),c=b.getLineStart(d-1),h=b.getLineStart(d),g=b.getLineEnd(e,!0),k=b.getText(h,g),i=0;e===f-1&&(e=b.getLineEnd(d-1),d=b.getLineEnd(d-1,!0),k+=b.getText(e,d),h=e,i=d-e);this.startUndo();a.setText("",h,g);a.setText(k,c,c);a.setSelection(c,c+k.length-i);this.endUndo();return!0}.bind(this),{name:u.moveLinesUp});this.textView.setKeyBinding(new p.KeyBinding(40,!1,!1,!0),
"moveLinesDown");this.textView.setAction("moveLinesDown",function(){if(this.textView.getOptions("readonly"))return!1;var a=this.editor,b=a.getModel(),c=a.getSelection(),d=b.getLineAtOffset(c.start),e=b.getLineAtOffset(c.end>c.start?c.end-1:c.end),f=b.getLineCount();if(e===f-1)return!0;var d=b.getLineStart(d),c=b.getLineEnd(e,!0),h=b.getLineEnd(e+1,!0)-(c-d),g=0;e!==f-2?b=b.getText(d,c):(e=b.getLineEnd(e),b=b.getText(e,c)+b.getText(d,e),g+=c-e);this.startUndo();a.setText("",d,c);a.setText(b,h,h);a.setSelection(h+
g,h+g+b.length);this.endUndo();return!0}.bind(this),{name:u.moveLinesDown});this.textView.setKeyBinding(new p.KeyBinding(38,!0,!1,!0),"copyLinesUp");this.textView.setAction("copyLinesUp",function(){if(this.textView.getOptions("readonly"))return!1;var a=this.editor,b=a.getModel(),c=a.getSelection(),d=b.getLineAtOffset(c.start),c=b.getLineAtOffset(c.end>c.start?c.end-1:c.end),d=b.getLineStart(d),e=b.getLineEnd(c,!0),f=b.getLineCount(),h="",e=b.getText(d,e);c===f-1&&(e+=h=b.getLineDelimiter());a.setText(e,
d,d);a.setSelection(d,d+e.length-h.length);return!0}.bind(this),{name:u.copyLinesUp});this.textView.setKeyBinding(new p.KeyBinding(40,!0,!1,!0),"copyLinesDown");this.textView.setAction("copyLinesDown",function(){if(this.textView.getOptions("readonly"))return!1;var a=this.editor,b=a.getModel(),c=a.getSelection(),d=b.getLineAtOffset(c.start),c=b.getLineAtOffset(c.end>c.start?c.end-1:c.end),e=b.getLineStart(d),d=b.getLineEnd(c,!0),f=b.getLineCount(),h="",e=b.getText(e,d);c===f-1&&(e=(h=b.getLineDelimiter())+
e);a.setText(e,d,d);a.setSelection(d+h.length,d+e.length);return!0}.bind(this),{name:u.copyLinesDown});this.textView.setKeyBinding(new p.KeyBinding("d",!0,!1,!1),"deleteLines");this.textView.setAction("deleteLines",function(){if(this.textView.getOptions("readonly"))return!1;var a=this.editor,b=a.getSelection(),c=a.getModel(),d=c.getLineAtOffset(b.start),b=c.getLineAtOffset(b.end>b.start?b.end-1:b.end),d=c.getLineStart(d),c=c.getLineEnd(b,!0);a.setText("",d,c);return!0}.bind(this),{name:u.deleteLines});
this.textView.setKeyBinding(new p.KeyBinding("l",!0),"gotoLine");this.textView.setAction("gotoLine",function(){var a=this.editor,b=a.getModel().getLineAtOffset(a.getCaretOffset());if(b=prompt(u.gotoLinePrompty,b+1))b=parseInt(b,10),a.onGotoLine(b-1,0);return!0}.bind(this),{name:u.gotoLine});this.textView.setKeyBinding(new p.KeyBinding(190,!0),"nextAnnotation");this.textView.setAction("nextAnnotation",function(){return a(!0)}.bind(this),{name:u.nextAnnotation});this.textView.setKeyBinding(new p.KeyBinding(188,
!0),"previousAnnotation");this.textView.setAction("previousAnnotation",function(){return a(!1)}.bind(this),{name:u.prevAnnotation});this.textView.setKeyBinding(new p.KeyBinding("e",!0,!1,!0,!1),"expand");this.textView.setAction("expand",function(){var a=this.editor,c=a.getAnnotationModel();if(!c)return!0;var d=a.getModel(),a=a.getCaretOffset(),e=d.getLineAtOffset(a),a=d.getLineStart(e),e=d.getLineEnd(e,!0);d.getBaseModel&&(a=d.mapOffset(a),e=d.mapOffset(e),d.getBaseModel());for(var f,d=c.getAnnotations(a,
e);!f&&d.hasNext();)a=d.next(),a.type===b.AnnotationType.ANNOTATION_FOLDING&&(a.expanded||(f=a));f&&!f.expanded&&(f.expand(),c.modifyAnnotation(f));return!0}.bind(this),{name:u.expand});this.textView.setKeyBinding(new p.KeyBinding("c",!0,!1,!0,!1),"collapse");this.textView.setAction("collapse",function(){var a=this.editor,c=a.getAnnotationModel();if(!c)return!0;var d=a.getModel(),e=a.getCaretOffset(),f=d.getLineAtOffset(e),e=d.getLineStart(f),f=d.getLineEnd(f,!0);d.getBaseModel&&(e=d.mapOffset(e),
f=d.mapOffset(f),d.getBaseModel());for(var h,d=c.getAnnotations(e,f);!h&&d.hasNext();)e=d.next(),e.type===b.AnnotationType.ANNOTATION_FOLDING&&(h=e);h&&h.expanded&&(a.setCaretOffset(h.start),h.collapse(),c.modifyAnnotation(h));return!0}.bind(this),{name:u.collapse});this.textView.setKeyBinding(new p.KeyBinding("e",!0,!0,!0,!1),"expandAll");this.textView.setAction("expandAll",function(){var a=this.editor,c=a.getAnnotationModel();if(!c)return!0;var a=a.getModel(),d=c.getAnnotations(0,a.getCharCount());
for(this.textView.setRedraw(!1);d.hasNext();)a=d.next(),a.type===b.AnnotationType.ANNOTATION_FOLDING&&!a.expanded&&(a.expand(),c.modifyAnnotation(a));this.textView.setRedraw(!0);return!0}.bind(this),{name:u.expandAll});this.textView.setKeyBinding(new p.KeyBinding("c",!0,!0,!0,!1),"collapseAll");this.textView.setAction("collapseAll",function(){var a=this.editor,c=a.getAnnotationModel();if(!c)return!0;var a=a.getModel(),d=c.getAnnotations(0,a.getCharCount());for(this.textView.setRedraw(!1);d.hasNext();)a=
d.next(),a.type===b.AnnotationType.ANNOTATION_FOLDING&&a.expanded&&(a.collapse(),c.modifyAnnotation(a));this.textView.setRedraw(!0);return!0}.bind(this),{name:u.collapseAll});this.textView.setKeyBinding(new p.KeyBinding("q",!h.isMac,!1,!1,h.isMac),"lastEdit");this.textView.setAction("lastEdit",function(){typeof this._lastEditLocation==="number"&&this.editor.showSelection(this._lastEditLocation);return!0}.bind(this),{name:u.lastEdit})},toggleIncrementalFind:function(){(this._incrementalFindActive=
!this._incrementalFindActive)?(this.editor.reportStatus(h.formatMessage(u.incrementalFind,this._incrementalFindPrefix)),this.textView.addEventListener("Verify",this._incrementalFindListener.onVerify),this.textView.addEventListener("Selection",this._incrementalFindListener.onSelection)):(this._incrementalFindPrefix="",this.editor.reportStatus(""),this.textView.removeEventListener("Verify",this._incrementalFindListener.onVerify),this.textView.removeEventListener("Selection",this._incrementalFindListener.onSelection),
this.textView.setCaretOffset(this.textView.getCaretOffset()))},startUndo:function(){this.undoStack&&this.undoStack.startCompoundChange()},endUndo:function(){this.undoStack&&this.undoStack.endCompoundChange()},cancel:function(){this.toggleIncrementalFind()},isActive:function(){return this._incrementalFindActive},isStatusActive:function(){return this._incrementalFindActive},lineUp:function(){if(this._incrementalFindActive){var a=this._incrementalFindPrefix;if(a.length===0)return!1;var b=this.editor,
c=b.getModel(),c=this._incrementalFindSuccess?b.getCaretOffset()-a.length-1:c.getCharCount()-1;(c=b.getModel().find({string:a,start:c,reverse:!0,caseInsensitive:a.toLowerCase()===a}).next())?(this._incrementalFindIgnoreSelection=this._incrementalFindSuccess=!0,b.moveSelection(c.start,c.end),this._incrementalFindIgnoreSelection=!1,b.reportStatus(h.formatMessage(u.incrementalFind,a))):(b.reportStatus(h.formatMessage(u.incrementalFindNotFound,a),"error"),this._incrementalFindSuccess=!1);return!0}return!1},
lineDown:function(){if(this._incrementalFindActive){var a=this._incrementalFindPrefix;if(a.length===0)return!1;var b=this.editor,c=0;this._incrementalFindSuccess&&(c=b.getSelection().start+1);(c=b.getModel().find({string:a,start:c,caseInsensitive:a.toLowerCase()===a}).next())?(this._incrementalFindIgnoreSelection=this._incrementalFindSuccess=!0,b.moveSelection(c.start,c.end),this._incrementalFindIgnoreSelection=!1,b.reportStatus(h.formatMessage(u.incrementalFind,a))):(b.reportStatus(h.formatMessage(u.incrementalFindNotFound,
a),"error"),this._incrementalFindSuccess=!1);return!0}return!1},enter:function(){return!1}};q.prototype={startUndo:function(){this.undoStack&&this.undoStack.startCompoundChange()},endUndo:function(){this.undoStack&&this.undoStack.endCompoundChange()},init:function(){function a(b,c,d){var e=b.getLineAtOffset(c),f=b.getLineAtOffset(d),h,g,i,k,m,o;for(h=e;h>=0;h--)if(g=b.getLine(h),i=h===e?c-b.getLineStart(e):g.length,k=g.lastIndexOf("/*",i),g=g.lastIndexOf("*/",i),g>k)break;else if(k!==-1){m=b.getLineStart(h)+
k;break}for(h=f;h<b.getLineCount();h++)if(g=b.getLine(h),i=h===f?d-b.getLineStart(f):0,k=g.indexOf("/*",i),g=g.indexOf("*/",i),k!==-1&&k<g)break;else if(g!==-1){o=b.getLineStart(h)+g;break}return{commentStart:m,commentEnd:o}}this.textView.setAction("lineStart",function(){for(var a=this.editor,b=a.getModel(),c=a.getCaretOffset(),d=b.getLineAtOffset(c),e=b.getLineStart(d),b=b.getLine(d),d=0;d<b.length;d++){var f=b.charCodeAt(d);if(!(f===32||f===9))break}d+=e;return c!==d?(a.setSelection(d,d),!0):!1}.bind(this));
this.textView.setKeyBinding(new p.KeyBinding(191,!0),"toggleLineComment");this.textView.setAction("toggleLineComment",function(){if(this.textView.getOptions("readonly"))return!1;for(var a=this.editor,b=a.getModel(),c=a.getSelection(),d=b.getLineAtOffset(c.start),e=b.getLineAtOffset(c.end>c.start?c.end-1:c.end),f=!0,h=[],g,i,k=d;k<=e;k++)if(g=b.getLine(k,!0),h.push(g),!f||(i=g.indexOf("//"))===-1)f=!1;else if(i!==0){var m;for(m=0;m<i;m++)if(f=g.charCodeAt(m),!(f===32||f===9))break;f=m===i}k=b.getLineStart(d);
m=b.getLineEnd(e,!0);if(f){for(f=0;f<h.length;f++)g=h[f],i=g.indexOf("//"),h[f]=g.substring(0,i)+g.substring(i+2);h=h.join("");g=b.getLineStart(e);b=k===c.start?c.start:c.start-2;c=c.end-2*(e-d+1)+(c.end===g+1?2:0)}else h.splice(0,0,""),h=h.join("//"),b=k===c.start?c.start:c.start+2,c=c.end+2*(e-d+1);a.setText(h,k,m);a.setSelection(b,c);return!0}.bind(this),{name:u.toggleLineComment});this.textView.setKeyBinding(new p.KeyBinding(191,!0,!h.isMac,!1,h.isMac),"addBlockComment");this.textView.setAction("addBlockComment",
function(){if(this.textView.getOptions("readonly"))return!1;var b=this.editor,c=b.getModel(),d=b.getSelection(),e=RegExp("/\\*|\\*/","g"),f=a(c,d.start,d.end);if(f.commentStart!==void 0&&f.commentEnd!==void 0)return!0;c=c.getText(d.start,d.end);if(c.length===0)return!0;f=c.length;c=c.replace(e,"");e=c.length;b.setText("/*"+c+"*/",d.start,d.end);b.setSelection(d.start+2,d.end+2+(e-f));return!0}.bind(this),{name:u.addBlockComment});this.textView.setKeyBinding(new p.KeyBinding(220,!0,!h.isMac,!1,h.isMac),
"removeBlockComment");this.textView.setAction("removeBlockComment",function(){if(this.textView.getOptions("readonly"))return!1;var b=this.editor,c=b.getModel(),d=b.getSelection(),e=c.getText(d.start,d.end),f,h,g;for(g=0;g<e.length;g++)if(e.substring(g,g+2)==="/*"){f=d.start+g;break}for(;g<e.length;g++)if(e.substring(g,g+2)==="*/"){h=d.start+g;break}if(f!==void 0&&h!==void 0)b.setText(c.getText(f+2,h),f,h+2),b.setSelection(f,h);else{e=a(c,d.start,d.end);if(e.commentStart===void 0||e.commentEnd===void 0)return!0;
c=c.getText(e.commentStart+2,e.commentEnd);b.setText(c,e.commentStart,e.commentEnd+2);b.setSelection(d.start-2,d.end-2)}return!0}.bind(this),{name:u.removeBlockComment})},contentAssistProposalApplied:function(a){a=a.data.proposal;if(a.positions&&this.linkedMode){for(var b=[],c=0;c<a.positions.length;++c)b[c]={positions:[{offset:a.positions[c].offset,length:a.positions[c].length}]};this.linkedMode.enterLinkedMode({groups:b,escapePosition:a.escapePosition})}else a.escapePosition&&this.textView.setCaretOffset(a.escapePosition);
return!0},cancel:function(){return!1},isActive:function(){return!0},isStatusActive:function(){return!1},lineUp:function(){return!1},lineDown:function(){return!1},enter:function(){if(this.textView.getOptions("readonly"))return!1;var a=this.editor,b=a.getSelection();if(b.start===b.end){for(var c=a.getModel(),d=c.getLineAtOffset(b.start),e=c.getLine(d,!0),f=c.getLineStart(d),d=0,f=b.start-f,h;d<f&&((h=e.charCodeAt(d))===32||h===9);)d++;if(d>0){for(var g=e.substring(0,d),d=f;d<e.length&&((h=e.charCodeAt(d++))===
32||h===9);)b.end++;a.setText(c.getLineDelimiter()+g,b.start,b.end);return!0}}return!1},tab:function(){return!1}};c.prototype={enterLinkedMode:function(a){if(!this.linkedModeActive){this.linkedModeActive=!0;this.linkedModePositions=[];for(var b=0;b<a.groups.length;++b){var c=a.groups[b];this.linkedModePositions[b]={offset:c.positions[0].offset,length:c.positions[0].length}}this.linkedModeEscapePosition=a.escapePosition;this.linkedModeCurrentPositionIndex=0;this.selectTextForLinkedModePosition(this.linkedModePositions[this.linkedModeCurrentPositionIndex]);
this.textView.addEventListener("Verify",this.linkedModeListener.onVerify);this.textView.setKeyBinding(new p.KeyBinding(9),"nextLinkedModePosition");this.textView.setAction("nextLinkedModePosition",function(){this.linkedModeCurrentPositionIndex=++this.linkedModeCurrentPositionIndex%this.linkedModePositions.length;this.selectTextForLinkedModePosition(this.linkedModePositions[this.linkedModeCurrentPositionIndex]);return!0}.bind(this));this.textView.setKeyBinding(new p.KeyBinding(9,!1,!0),"previousLinkedModePosition");
this.textView.setAction("previousLinkedModePosition",function(){this.linkedModeCurrentPositionIndex=this.linkedModeCurrentPositionIndex>0?this.linkedModeCurrentPositionIndex-1:this.linkedModePositions.length-1;this.selectTextForLinkedModePosition(this.linkedModePositions[this.linkedModeCurrentPositionIndex]);return!0}.bind(this));this.editor.reportStatus(u.linkedModeEntered,null,!0)}},isActive:function(){return this.linkedModeActive},isStatusActive:function(){return this.linkedModeActive},enter:function(){this.cancel();
return!0},cancel:function(a){if(this.linkedModeActive)this.linkedModeActive=!1,this.textView.removeEventListener("Verify",this.linkedModeListener.onVerify),this.textView.setKeyBinding(new p.KeyBinding(9),"tab"),this.textView.setKeyBinding(new p.KeyBinding(9,!1,!0),"shiftTab"),a||this.textView.setCaretOffset(this.linkedModeEscapePosition,!1),this.editor.reportStatus(u.linkedModeExited,null,!0)},lineUp:function(){this.cancel(!0);return!1},lineDown:function(){this.cancel(!0);return!1},selectTextForLinkedModePosition:function(a){this.textView.setSelection(a.offset,
a.offset+a.length)}};return{UndoFactory:a,LineNumberRulerFactory:f,FoldingRulerFactory:o,AnnotationFactory:m,TextDNDFactory:n,TextActions:t,SourceCodeActions:q,LinkedMode:c}});
(function(u,r){typeof define==="function"&&define.amd?define("orion/Deferred",[],r):typeof exports==="object"?module.exports=r():(u.orion=u.orion||{},u.orion.Deferred=r())})(this,function(){function u(){for(var a;a=d.shift()||g.shift();)a();h=!1}function r(a,b){(b?g:d).push(a);h||(h=!0,b?setTimeout(u,0):u())}function p(a){return function(){a.apply(null,arguments)}}function i(){}function b(){var a=Error("Cancel");a.name="Cancel";return a}function e(){function a(){for(var a;a=g.shift();){var b=a.deferred,
c=h==="resolved"?"resolve":"reject";if(typeof a[c]==="function")try{var e=a[c](d);e&&typeof e.then==="function"?(b.cancel=e.cancel||i,e.then(p(b.resolve),p(b.reject),b.progress)):b.resolve(e)}catch(n){b.reject(n)}else b[c](d)}}var d,h,g=[],n=this;this.reject=function(b){h||(h="rejected",d=b,g.length&&r(a));return n.promise};this.resolve=function(b){h||(h="resolved",d=b,g.length&&r(a));return n.promise};this.progress=function(a){h||g.forEach(function(b){b.progress&&b.progress(a)});return n.promise};
this.cancel=function(){h||n.reject(b())};this.then=function(b,d,c){var b={resolve:b,reject:d,progress:c,deferred:new e},f=b.deferred,i=this.cancel.bind(this),j=function(){r(function(){(f.cancel===j?i:f.cancel)()},!0)};f.cancel=j;d=f.promise;d.cancel=function(){f.cancel()};g.push(b);h&&r(a,!0);return d};this.promise={then:this.then,cancel:this.cancel}}var d=[],g=[],h=!1;e.all=function(a,b){function d(a,b){q||(i[a]=b,--g===0&&c.resolve(i))}function h(a,e){if(!q){if(b)try{d(a,b(e));return}catch(g){e=
g}c.reject(e)}}var g=a.length,i=[],q=!1,c=new e;c.then(null,function(){q=!0;a.forEach(function(a){a.cancel&&a.cancel()})});g===0?c.resolve(i):a.forEach(function(a,b){a.then(d.bind(null,b),h.bind(null,b))});return c.promise};e.when=function(a,b,d,h){var g;if(!(a&&typeof a.then==="function"))g=new e,g.resolve(a),a=g.promise;return a.then(b,d,h)};return e});
define("orion/editor/contentAssist",["i18n!orion/editor/nls/messages","orion/keyBinding","orion/editor/eventTarget","orion/Deferred","orion/util"],function(u,r,p,i,b){var e,d,g;function h(a){this.textView=a;this.state=e;this.providers=[];var f=this;this.contentAssistListener={onModelChanging:function(a){f.isDeactivatingChange(a)?f.setState(e):f.state===d&&f.setState(g)},onScroll:function(){f.setState(e)},onSelection:function(){var a=f.state;if(a===d||a===g)f.computeProposals(),f.setState(g)}};a.setKeyBinding(b.isMac?
new r.KeyBinding(" ",!1,!1,!1,!0):new r.KeyBinding(" ",!0),"contentAssist");a.setAction("contentAssist",function(){f.activate();return!0},{name:u.contentAssist})}function a(a,b){this.contentAssist=a;this.widget=b;this.proposals=[];var d=this;this.contentAssist.addEventListener("ProposalsComputed",function(a){d.proposals=a.data.proposals;d.selectedIndex=d.proposals.length?0:-1})}function f(a,d){this.contentAssist=a;this.textView=this.contentAssist.getTextView();this.isShowing=this.textViewListenerAdded=
!1;var e=this.textView.getOptions("parent").ownerDocument;this.parentNode=typeof d==="string"?e.getElementById(d):d;if(!this.parentNode){this.parentNode=b.createElement(e,"div");this.parentNode.className="contentassist";var f=e.getElementsByTagName("body")[0];if(f)f.appendChild(this.parentNode);else throw Error("parentNode is required");}var c=this;this.textViewListener={onMouseDown:function(a){a.event.target.parentElement!==c.parentNode&&c.contentAssist.deactivate()}};this.contentAssist.addEventListener("ProposalsComputed",
function(a){c.setProposals(a.data.proposals);c.show();if(!c.textViewListenerAdded)c.textView.addEventListener("MouseDown",c.textViewListener.onMouseDown),c.textViewListenerAdded=!0});this.contentAssist.addEventListener("Deactivating",function(){c.setProposals([]);c.hide();if(c.textViewListenerAdded)c.textView.removeEventListener("MouseDown",c.textViewListener.onMouseDown),c.textViewListenerAdded=!1;c.textViewListenerAdded=!1});this.scrollListener=function(){c.isShowing&&c.position()};e.addEventListener("scroll",
this.scrollListener)}e=1;d=2;g=3;var o={selected:" selected",hr:"proposal-hr",emphasis:"proposal-emphasis",noemphasis:"proposal-noemphasis",dfault:"proposal-default"};h.prototype={apply:function(a){if(!a)return!1;var b=this.textView.getCaretOffset(),d={proposal:a,start:b,end:b};this.setState(e);this.textView.setText(a.proposal||a,b,b);this.dispatchEvent({type:"ProposalApplied",data:d});return!0},activate:function(){this.state===e&&this.setState(d)},deactivate:function(){this.setState(e)},getTextView:function(){return this.textView},
isActive:function(){return this.state===d||this.state===g},isDeactivatingChange:function(a){var b=a.removedCharCount>0&&a.addedCharCount===0,d=this.textView,d=a.start+1<=d.getModel().getCharCount()&&/^\s*$/.test(d.getText(a.start,a.start+1));return a.removedLineCount>0||a.addedLineCount>0||b&&d},setState:function(a){var b;a===d?b="Activating":a===e&&(b="Deactivating");b&&this.dispatchEvent({type:b});this.state=a;this.onStateChange(a)},onStateChange:function(a){if(a===e){if(this.listenerAdded)this.textView.removeEventListener("ModelChanging",
this.contentAssistListener.onModelChanging),this.textView.removeEventListener("Scroll",this.contentAssistListener.onScroll),this.textView.removeEventListener("Selection",this.contentAssistListener.onSelection),this.listenerAdded=!1}else if(a===d){if(!this.listenerAdded)this.textView.addEventListener("ModelChanging",this.contentAssistListener.onModelChanging),this.textView.addEventListener("Scroll",this.contentAssistListener.onScroll),this.textView.addEventListener("Selection",this.contentAssistListener.onSelection),
this.listenerAdded=!0;this.computeProposals()}},computeProposals:function(){var a=this;this._computeProposals(this.textView.getCaretOffset()).then(function(b){a.dispatchEvent({type:"ProposalsComputed",data:{proposals:b}})})},getPrefixStart:function(a){for(;a>0&&/[A-Za-z0-9_]/.test(this.textView.getText(a-1,a));)a--;return a},handleError:function(a){typeof console!=="undefined"&&(console.log("Error retrieving content assist proposals"),console.log(a))},_computeProposals:function(a){var b=this.providers,
d=this.textView,e=d.getModel(),c=d.getText(),f={line:e.getLine(e.getLineAtOffset(a)),prefix:d.getText(this.getPrefixStart(a),a),selection:d.getSelection()},h=this,b=b.map(function(b){var d=b.computeProposals||b.getProposals,e;try{typeof d==="function"&&(e=h.progress?h.progress.progress(d.apply(b,[c,a,f]),"Generating content assist proposal"):d.apply(b,[c,a,f]))}catch(g){h.handleError(g)}return i.when(e)});return i.all(b,this.handleError).then(function(a){return a.reduce(function(a,b){return b instanceof
Array?a.concat(b):a},[])})},setProviders:function(a){this.providers=a.slice(0)},setProgress:function(a){this.progress=a}};p.EventTarget.addMixin(h.prototype);a.prototype={cancel:function(){this.getContentAssist().deactivate()},getContentAssist:function(){return this.contentAssist},isActive:function(){return this.getContentAssist().isActive()},lineUp:function(){for(var a=this.selectedIndex===0?this.proposals.length-1:this.selectedIndex-1;this.proposals[a].unselectable&&a>0;)a--;this.selectedIndex=
a;this.widget&&this.widget.setSelectedIndex(this.selectedIndex);return!0},lineDown:function(){for(var a=this.selectedIndex===this.proposals.length-1?0:this.selectedIndex+1;this.proposals[a].unselectable&&a<this.proposals.length-1;)a++;this.selectedIndex=a;this.widget&&this.widget.setSelectedIndex(this.selectedIndex);return!0},enter:function(){return this.contentAssist.apply(this.proposals[this.selectedIndex]||null)},tab:function(){return this.widget?(this.widget.createAccessible(this),this.widget.parentNode.focus(),
!0):!1}};f.prototype={onClick:function(a){this.contentAssist.apply(this.getProposal(a.target));this.textView.focus()},createDiv:function(a,d,e,f){var c=e.ownerDocument,h=b.createElement(c,"div");h.id="contentoption"+f;h.setAttribute("role","option");a.style==="hr"?a=b.createElement(c,"hr"):(h.className=this.calculateClasses(a.style,d),a=c.createTextNode(this.getDisplayString(a)),d&&this.parentNode.setAttribute("aria-activedescendant",h.id));h.appendChild(a,h);e.appendChild(h)},createAccessible:function(a){this._isAccessible||
this.parentNode.addEventListener("keydown",function(b){b.preventDefault();if(b.keyCode===27)return a.cancel();else if(b.keyCode===38)return a.lineUp();else if(b.keyCode===40)return a.lineDown();else if(b.keyCode===13)return a.enter();return!1});this._isAccessible=!0},calculateClasses:function(a,b){var d=o[a];if(!d)d=o.dfault;return b?d+o.selected:d},getDisplayString:function(a){return typeof a==="string"?a:a.description&&typeof a.description==="string"?a.description:a.proposal},getProposal:function(a){for(var b=
0,d=this.parentNode.firstChild;d!==null;d=d.nextSibling){if(d===a)return this.proposals[b]||null;b++}return null},setSelectedIndex:function(a){this.selectedIndex=a;this.selectNode(this.parentNode.childNodes[this.selectedIndex])},selectNode:function(a){for(var b=this.parentNode.childNodes,d=0;d<b.length;d++){var e=b[d],c=e.className.indexOf(o.selected);if(c>=0)e.className=e.className.substring(0,c)+e.className.substring(c+o.selected.length);e===a&&(e.className+=o.selected,this.parentNode.setAttribute("aria-activedescendant",
e.id),e.focus(),e.offsetTop<this.parentNode.scrollTop?e.scrollIntoView(!0):e.offsetTop+e.offsetHeight>this.parentNode.scrollTop+this.parentNode.clientHeight&&e.scrollIntoView(!1))}},setProposals:function(a){this.proposals=a},show:function(){if(this.proposals.length===0)this.hide();else{this.parentNode.innerHTML="";for(var a=0;a<this.proposals.length;a++)this.createDiv(this.proposals[a],a===0,this.parentNode,a);this.position();this.parentNode.onclick=this.onClick.bind(this);this.isShowing=!0}},hide:function(){this.parentNode.ownerDocument.activeElement===
this.parentNode&&this.textView.focus();this.parentNode.style.display="none";this.parentNode.onclick=null;this.isShowing=!1},position:function(){var a=this.textView.getLocationAtOffset(this.textView.getCaretOffset());a.y+=this.textView.getLineHeight();this.textView.convert(a,"document","page");this.parentNode.style.position="fixed";this.parentNode.style.left=a.x+"px";this.parentNode.style.top=a.y+"px";this.parentNode.style.display="block";this.parentNode.scrollTop=0;var b=this.parentNode.ownerDocument,
d=b.documentElement.clientWidth;if(a.y+this.parentNode.offsetHeight>b.documentElement.clientHeight)this.parentNode.style.top=a.y-this.parentNode.offsetHeight-this.textView.getLineHeight()+"px";if(a.x+this.parentNode.offsetWidth>d)this.parentNode.style.left=d-this.parentNode.offsetWidth+"px"}};return{ContentAssist:h,ContentAssistMode:a,ContentAssistWidget:f}});
define("orion/editor/cssContentAssist",[],function(){function u(){}var r="alignment-adjust,alignment-baseline,animation,animation-delay,animation-direction,animation-duration,animation-iteration-count,animation-name,animation-play-state,animation-timing-function,appearance,azimuth,backface-visibility,background,background-attachment,background-clip,background-color,background-image,background-origin,background-position,background-repeat,background-size,baseline-shift,binding,bleed,bookmark-label,bookmark-level,bookmark-state,bookmark-target,border,border-bottom,border-bottom-color,border-bottom-left-radius,border-bottom-right-radius,border-bottom-style,border-bottom-width,border-collapse,border-color,border-image,border-image-outset,border-image-repeat,border-image-slice,border-image-source,border-image-width,border-left,border-left-color,border-left-style,border-left-width,border-radius,border-right,border-right-color,border-right-style,border-right-width,border-spacing,border-style,border-top,border-top-color,border-top-left-radius,border-top-right-radius,border-top-style,border-top-width,border-width,bottom,box-align,box-decoration-break,box-direction,box-flex,box-flex-group,box-lines,box-ordinal-group,box-orient,box-pack,box-shadow,box-sizing,break-after,break-before,break-inside,caption-side,clear,clip,color,color-profile,column-count,column-fill,column-gap,column-rule,column-rule-color,column-rule-style,column-rule-width,column-span,column-width,columns,content,counter-increment,counter-reset,crop,cue,cue-after,cue-before,cursor,direction,display,dominant-baseline,drop-initial-after-adjust,drop-initial-after-align,drop-initial-before-adjust,drop-initial-before-align,drop-initial-size,drop-initial-value,elevation,empty-cells,fit,fit-position,flex-align,flex-flow,flex-inline-pack,flex-order,flex-pack,float,float-offset,font,font-family,font-size,font-size-adjust,font-stretch,font-style,font-variant,font-weight,grid-columns,grid-rows,hanging-punctuation,height,hyphenate-after,hyphenate-before,hyphenate-character,hyphenate-lines,hyphenate-resource,hyphens,icon,image-orientation,image-rendering,image-resolution,inline-box-align,left,letter-spacing,line-height,line-stacking,line-stacking-ruby,line-stacking-shift,line-stacking-strategy,list-style,list-style-image,list-style-position,list-style-type,margin,margin-bottom,margin-left,margin-right,margin-top,mark,mark-after,mark-before,marker-offset,marks,marquee-direction,marquee-loop,marquee-play-count,marquee-speed,marquee-style,max-height,max-width,min-height,min-width,move-to,nav-down,nav-index,nav-left,nav-right,nav-up,opacity,orphans,outline,outline-color,outline-offset,outline-style,outline-width,overflow,overflow-style,overflow-x,overflow-y,padding,padding-bottom,padding-left,padding-right,padding-top,page,page-break-after,page-break-before,page-break-inside,page-policy,pause,pause-after,pause-before,perspective,perspective-origin,phonemes,pitch,pitch-range,play-during,position,presentation-level,punctuation-trim,quotes,rendering-intent,resize,rest,rest-after,rest-before,richness,right,rotation,rotation-point,ruby-align,ruby-overhang,ruby-position,ruby-span,size,speak,speak-header,speak-numeral,speak-punctuation,speech-rate,stress,string-set,table-layout,target,target-name,target-new,target-position,text-align,text-align-last,text-decoration,text-emphasis,text-height,text-indent,text-justify,text-outline,text-shadow,text-transform,text-wrap,top,transform,transform-origin,transform-style,transition,transition-delay,transition-duration,transition-property,transition-timing-function,unicode-bidi,vertical-align,visibility,voice-balance,voice-duration,voice-family,voice-pitch,voice-pitch-range,voice-rate,voice-stress,voice-volume,volume,white-space,white-space-collapse,widows,width,word-break,word-spacing,word-wrap,z-index".split(",");u.prototype=
{computeProposals:function(p,i){var b;for(b=i;b&&/[A-Za-z\-]/.test(p.charAt(b-1));)b--;b=b?p.substring(b,i):"";for(var e=[],d=0;d<r.length;d++){var g=r[d];g.indexOf(b)===0&&e.push({proposal:g.substring(b.length),description:g})}return e}};return{CssContentAssistProvider:u}});
define("orion/editor/htmlContentAssist",[],function(){function u(){}u.prototype={leadingWhitespace:function(r,p){var i="";for(p-=1;p>0;){var b=r.charAt(p--);if(b==="\n"||b==="\r")break;i=/\s/.test(b)?b.concat(i):""}return i},computeProposals:function(r,p,i){function b(a){return a.substring(i.prefix.length)}var e=[];if(r.length===0)return e.push({proposal:'<!DOCTYPE html>\n<html lang="en">\n\t<head>\n\t\t<meta charset=utf-8>\n\t\t<title>My Document</title>\n\t</head>\n\t<body>\n\t\t<h1>A basic HTML document</h1>\n\t\t<p>\n\t\t\t\n\t\t</p>\n\t</body>\n</html>',
description:"Simple HTML document",escapePosition:p+152}),e;var d=i.prefix;if(r.charAt(p-d.length-1)!=="<")return e;for(var g,h,a="abbr,b,button,canvas,cite,command,dd,del,dfn,dt,em,embed,font,h1,h2,h3,h4,h5,h6,i,ins,kbd,label,li,mark,meter,object,option,output,progress,q,rp,rt,samp,small,strong,sub,sup,td,time,title,tt,u,var".split(","),f=0;f<a.length;f++)g=a[f],g.indexOf(d)===0&&(h=g+"></"+g+">",g=p+g.length-d.length+1,e.push({proposal:b(h),description:"<"+h,escapePosition:g}));a="address,article,aside,audio,bdo,blockquote,body,caption,code,colgroup,datalist,details,div,fieldset,figure,footer,form,head,header,hgroup,iframe,legend,map,menu,nav,noframes,noscript,optgroup,p,pre,ruby,script,section,select,span,style,tbody,textarea,tfoot,th,thead,tr,video".split(",");
r=this.leadingWhitespace(r,p);for(f=0;f<a.length;f++)g=a[f],g.indexOf(d)===0&&(h=g+">\n"+r+"\t\n"+r+"</"+g+">",g=p+g.length-d.length+r.length+3,e.push({proposal:b(h),description:"<"+h,escapePosition:g}));a="area,base,br,col,hr,input,link,meta,param,keygen,source".split(",");for(f=0;f<a.length;f++)g=a[f],g.indexOf(d)===0&&(h=g+"/>",g=p+g.length-d.length+2,e.push({proposal:b(h),description:"<"+h,escapePosition:g}));"img".indexOf(d)===0&&(h='img src="" alt="Image"/>',e.push({proposal:b(h),description:"<"+
h,escapePosition:p+9-d.length}));d==="a"&&e.push({proposal:b('a href=""></a>'),description:"<a></a> - HTML anchor element",escapePosition:p+7});"ul".indexOf(d)===0&&(h="<ul> - unordered list",g=p-d.length+r.length+9,e.push({proposal:b("ul>\n"+r+"\t<li></li>\n"+r+"</ul>"),description:h,escapePosition:g}));"ol".indexOf(d)===0&&(h="<ol> - ordered list",g=p-d.length+r.length+9,e.push({proposal:b("ol>\n"+r+"\t<li></li>\n"+r+"</ol>"),description:h,escapePosition:g}));"dl".indexOf(d)===0&&(h="<dl> - definition list",
g=p-d.length+r.length+9,e.push({proposal:b("dl>\n"+r+"\t<dt></dt>\n"+r+"\t<dd></dd>\n"+r+"</dl>"),description:h,escapePosition:g}));"table".indexOf(d)===0&&(h="<table> - basic HTML table",g=p-d.length+r.length*2+19,e.push({proposal:b("table>\n"+r+"\t<tr>\n"+r+"\t\t<td></td>\n"+r+"\t</tr>\n"+r+"</table>"),description:h,escapePosition:g}));return e}};return{HTMLContentAssistProvider:u}});
define("orion/editor/jsTemplateContentAssist",[],function(){function u(b,e,d){var g=d-b.length,h=[],a="";for(d-=1;d>0;){var f=e.charAt(d--);if(f==="\n"||f==="\r")break;a=/\s/.test(f)?f.concat(a):""}e=a;"if".indexOf(b)===0&&(d="if - if statement",a=[{offset:g+4,length:9}],f=g+e.length+18,h.push({proposal:("if (condition) {\n"+e+"\t\n"+e+"}").substring(b.length),description:d,positions:a,escapePosition:f}),d="if - if else statement",a=[{offset:g+4,length:9}],f=g+e.length+18,h.push({proposal:("if (condition) {\n"+
e+"\t\n"+e+"} else {\n"+e+"\t\n"+e+"}").substring(b.length),description:d,positions:a,escapePosition:f}));"for".indexOf(b)===0&&(d="for - iterate over array",a=[{offset:g+9,length:1},{offset:g+20,length:5}],f=g+e.length+42,h.push({proposal:("for (var i = 0; i < array.length; i++) {\n"+e+"\t\n"+e+"}").substring(b.length),description:d,positions:a,escapePosition:f}),d="for..in - iterate over properties of an object",a=[{offset:g+9,length:8},{offset:g+21,length:6}],f=g+2*e.length+73,h.push({proposal:("for (var property in object) {\n"+
e+"\tif (object.hasOwnProperty(property)) {\n"+e+"\t\t\n"+e+"\t}\n"+e+"}").substring(b.length),description:d,positions:a,escapePosition:f}));"while".indexOf(b)===0&&(d="while - while loop with condition",a=[{offset:g+7,length:9}],f=g+e.length+21,h.push({proposal:("while (condition) {\n"+e+"\t\n"+e+"}").substring(b.length),description:d,positions:a,escapePosition:f}));"do".indexOf(b)===0&&(d="do - do while loop with condition",a=[{offset:g+16,length:9}],f=g+e.length+6,h.push({proposal:("do {\n"+e+
"\t\n"+e+"} while (condition);").substring(b.length),description:d,positions:a,escapePosition:f}));"switch".indexOf(b)===0&&(d="switch - switch case statement",a=[{offset:g+8,length:10},{offset:g+28,length:6}],f=g+2*e.length+38,h.push({proposal:("switch (expression) {\n"+e+"\tcase value1:\n"+e+"\t\t\n"+e+"\t\tbreak;\n"+e+"\tdefault:\n"+e+"}").substring(b.length),description:d,positions:a,escapePosition:f}));"try".indexOf(b)===0&&(d="try - try..catch statement",f=g+e.length+7,h.push({proposal:("try {\n"+
e+"\t\n"+e+"} catch (err) {\n"+e+"}").substring(b.length),description:d,escapePosition:f}),d="try - try..catch statement with finally block",f=g+e.length+7,h.push({proposal:("try {\n"+e+"\t\n"+e+"} catch (err) {\n"+e+"} finally {\n"+e+"}").substring(b.length),description:d,escapePosition:f}));return h}function r(b){for(var e="break,case,catch,continue,debugger,default,delete,do,else,finally,for,function,if,in,instanceof,new,return,switch,this,throw,try,typeof,var,void,while,with".split(","),d=[],
g=0;g<e.length;g++)e[g].indexOf(b)===0&&d.push({proposal:e[g].substring(b.length),description:e[g]});return d}function p(){}var i={":":":","!":"!","@":"@","#":"#",$:"$","^":"^","&":"&","*":"*",".":".","?":"?","<":"<",">":">"};p.prototype={computeProposals:function(b,e,d){for(var d=d.prefix,g=[],h=e-d.length-1,a="";h>=0;)if(a=b[h],a==="\n"||a==="\r")break;else if(/\s/.test(a))h--;else break;if(i[a])return g;g=g.concat(u(d,b,e));return g=g.concat(r(d,b,e))}};return{JSTemplateContentAssistProvider:p}});
define("orion/editor/AsyncStyler",["i18n!orion/editor/nls/messages","orion/editor/annotations"],function(u,r){function p(d){return d.getProperty("objectClass").indexOf(b)!==-1&&d.getProperty("type")==="highlighter"}function i(b,e,h){this.initialize(b,e,h);this.lineStyles=[]}var b="orion.edit.highlighter",e=b+" service must be an event emitter";r.AnnotationType.registerType("orion.annotation.highlightError",{title:u.syntaxError,html:"<div class='annotationHTML error'></div>",rangeStyle:{styleClass:"annotationRange error"}});
i.prototype={initialize:function(d,e,h){this.textView=d;this.serviceRegistry=e;this.annotationModel=h;this.services=[];var a=this;this.listener={onModelChanging:function(b){a.onModelChanging(b)},onModelChanged:function(b){a.onModelChanged(b)},onDestroy:function(b){a.onDestroy(b)},onLineStyle:function(b){a.onLineStyle(b)},onStyleReady:function(b){a.onStyleReady(b)},onServiceAdded:function(b){a.onServiceAdded(b.serviceReference,a.serviceRegistry.getService(b.serviceReference))},onServiceRemoved:function(b){a.onServiceRemoved(b.serviceReference,
a.serviceRegistry.getService(b.serviceReference))}};d.addEventListener("ModelChanging",this.listener.onModelChanging);d.addEventListener("ModelChanged",this.listener.onModelChanged);d.addEventListener("Destroy",this.listener.onDestroy);d.addEventListener("LineStyle",this.listener.onLineStyle);e.addEventListener("registered",this.listener.onServiceAdded);e.addEventListener("unregistering",this.listener.onServiceRemoved);d=e.getServiceReferences(b);for(h=0;h<d.length;h++){var f=d[h];p(f)&&this.addServiceListener(e.getService(f))}},
onDestroy:function(){this.destroy()},destroy:function(){if(this.textView)this.textView.removeEventListener("ModelChanging",this.listener.onModelChanging),this.textView.removeEventListener("ModelChanged",this.listener.onModelChanged),this.textView.removeEventListener("Destroy",this.listener.onDestroy),this.textView.removeEventListener("LineStyle",this.listener.onLineStyle),this.textView=null;if(this.services){for(var b=0;b<this.services.length;b++)this.removeServiceListener(this.services[b]);this.services=
null}if(this.serviceRegistry)this.serviceRegistry.removeEventListener("registered",this.listener.onServiceAdded),this.serviceRegistry.removeEventListener("unregistering",this.listener.onServiceRemoved),this.serviceRegistry=null;this.lineStyles=this.listener=null},onModelChanging:function(b){this.startLine=this.textView.getModel().getLineAtOffset(b.start)},onModelChanged:function(b){var e=this.startLine;(b.addedLineCount||b.removedLineCount)&&Array.prototype.splice.apply(this.lineStyles,[e,b.removedLineCount].concat(this._getEmptyStyle(b.addedLineCount)))},
onStyleReady:function(b){var e=b.lineStyles||b.style,b=Number.MAX_VALUE,h=-1,a=this.textView.getModel(),f;for(f in e)e.hasOwnProperty(f)&&(this.lineStyles[f]=e[f],b=Math.min(b,f),h=Math.max(h,f));b=Math.max(b,0);h=Math.min(h,a.getLineCount());if(e=this.annotationModel){for(var i=e.getAnnotations(a.getLineStart(b),a.getLineEnd(h)),m=[];i.hasNext();){var n=i.next();n.type==="orion.annotation.highlightError"&&m.push(n)}i=[];for(n=b;n<=h;n++){f=n;var t=this.lineStyles[f],t=t&&t.errors;f=a.getLineStart(f);
if(t)for(var q=0;q<t.length;q++){var c=t[q];i.push(r.AnnotationType.createAnnotation("orion.annotation.highlightError",c.start+f,c.end+f))}}e.replaceAnnotations(m,i)}this.textView.redrawLines(b,h+1)},onLineStyle:function(b){function e(a,b){for(var d=a.length,h=[],g=0;g<d;g++){var i=a[g];h.push({start:i.start+b,end:i.end+b,style:i.style})}return h}var h=this.lineStyles[b.lineIndex];if(h)if(h.ranges)b.ranges=e(h.ranges,b.lineStart);else if(h.style)b.style=h.style},_getEmptyStyle:function(b){for(var e=
[],h=0;h<b;h++)e.push(null);return e},setContentType:function(b){this.contentType=b;if(this.services)for(b=0;b<this.services.length;b++){var e=this.services[b];if(e.setContentType){var h=this.serviceRegistry.getService("orion.page.progress");h?h.progress(e.setContentType(this.contentType),"Styling content type: "+this.contentType.id?this.contentType.id:this.contentType):e.setContentType(this.contentType)}}},onServiceAdded:function(b,e){p(b)&&this.addServiceListener(e)},onServiceRemoved:function(b,
e){this.services.indexOf(e)!==-1&&this.removeServiceListener(e)},addServiceListener:function(b){if(typeof b.addEventListener==="function"){if(b.addEventListener("orion.edit.highlighter.styleReady",this.listener.onStyleReady),this.services.push(b),b.setContentType&&this.contentType){var g=this.serviceRegistry.getService("orion.page.progress");g?g.progress(b.setContentType(this.contentType),"Styling content type: "+this.contentType.id?this.contentType.id:this.contentType):b.setContentType(this.contentType)}}else typeof console!==
"undefined"&&console.log(Error(e))},removeServiceListener:function(b){typeof b.removeEventListener==="function"?(b.removeEventListener("orion.edit.highlighter.styleReady",this.listener.onStyleReady),b=this.services.indexOf(b),b!==-1&&this.services.splice(b,1)):typeof console!=="undefined"&&console.log(Error(e))}};return i});
define("orion/editor/mirror",["i18n!orion/editor/nls/messages","orion/editor/eventTarget","orion/editor/annotations"],function(u,r,p){function i(b){this.string=b;this.tokenStart=this.pos=0}function b(){this._modes={};this.mimeModes={};this.options={};this.StringStream=i}function e(b){var a=[],d;for(d in b)Object.prototype.hasOwnProperty.call(b,d)&&a.push(d);return a}function d(b,a,d){d=d||{};this.model=b;this.codeMirror=a;this.isWhitespaceVisible=typeof d.whitespacesVisible==="undefined"?!1:d.whitespacesVisible;
this.mode=null;this.isModeLoaded=!1;this.lines=[];this.dirtyLines=[];this.startLine=Number.MAX_VALUE;this.endLine=-1;this.timer=null;this.initialize(b)}function g(b,a,d){this.init(b,a,d)}i.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return this.pos===0},peek:function(){return this.string[this.pos]},next:function(){return this.string[this.pos++]},eat:function(b){var a=this.string[this.pos];return typeof a==="string"&&(a===b||b.test&&b.test(a)||typeof b==="function"&&
b(a))?this.string[this.pos++]:void 0},eatWhile:function(b){for(var a=!1;this.eat(b)!==void 0;)a=!0;return a},eatSpace:function(){return this.eatWhile(/\s/)},skipToEnd:function(){this.pos=this.string.length},skipTo:function(b){b=this.string.indexOf(b,this.pos);return b!==-1?(this.pos=b,!0):!1},match:function(b,a,d){a=a===!0||typeof a==="undefined";if(typeof b==="string"){var e=d?this.string.toLowerCase():this.string,b=d?b.toLowerCase():b,d=e.indexOf(b,this.pos);if(d!==-1&&a)this.pos=d+b.length;return d!==
-1}else return(b=this.string.substring(this.pos).match(b))&&a&&typeof b[0]==="string"&&(this.pos+=b.index+b[0].length),b},backUp:function(b){this.pos-=b},column:function(){for(var b=0,a=0;a<this.tokenStart;)b+=this.string[a++]==="\t"?4:1;return b},indentation:function(){for(var b=this.string.search(/\S/),a=0,d=0;d<b;)a+=this.string[d++]==="\t"?4:1;return a},current:function(){return this.string.substring(this.tokenStart,this.pos)},advance:function(){this.tokenStart=this.pos}};b.prototype={options:{},
setOption:function(b,a){this.options[b]=a},getOption:function(b){return this.options[b]},copyState:function(b,a){if(typeof b.copyState==="function")return b.copyState(a);var d={},e;for(e in a){var g=a[e];d[e]=g instanceof Array?g.slice():g}return d},defineMode:function(b,a){this._modes[b]=a},defineMIME:function(b,a){this.mimeModes[b]=a},getMode:function(b,a){var d={},e;typeof a==="string"&&this.mimeModes[a]&&(a=this.mimeModes[a]);typeof a==="object"&&(d=a,e=this._modes[a.name]);e=e||this._modes[a];
if(typeof e!=="function")throw"Mode not found "+a;return e(b,d)},listModes:function(){return e(this._modes)},listMIMEs:function(){return e(this.mimeModes)},_getModeName:function(b){b=this.mimeModes[b];if(typeof b==="object")b=b.name;return b}};d.prototype={initialize:function(){var b=this;this.listener={onModelChanging:function(a){b._onModelChanging(a)},onModelChanged:function(a){b._onModelChanged(a)},onDestroy:function(a){b._onDestroy(a)}};this.model.addEventListener("Changing",this.listener.onModelChanging);
this.model.addEventListener("Changed",this.listener.onModelChanged);this.model.addEventListener("Destroy",this.listener.onDestroy)},destroy:function(){this.model&&(this.model.removeEventListener("Changing",this.listener.onModelChanging),this.model.removeEventListener("Changed",this.listener.onModelChanged),this.model.removeEventListener("Destroy",this.listener.onDestroy));this.dirtyLines=this.lines=this.mode=this.codeMirror=this.model=null;clearTimeout(this.timer);this.timer=null},_onModelChanging:function(b){this.startLine=
this.model.getLineAtOffset(b.start)},_onModelChanged:function(b){this._dbgEvent(b);var a=this.startLine;(b.removedLineCount||b.addedLineCount)&&Array.prototype.splice.apply(this.lines,[a+1,b.removedLineCount].concat(this._newLines(b.addedLineCount)));this.mode&&(b=Math.max(b.addedLineCount,b.removedLineCount),b=a+Math.min(b,500),this.highlight(a,b),this.highlightLater(b+1))},_onDestroy:function(){this.destroy()},setViewportIndex:function(b){this.viewportIndex=b},_dbgEvent:function(){},_dbgStyle:function(){},
_newLines:function(b){for(var a=[],d=0;d<b;d++)a.push({style:null,eolState:null});return a},setMode:function(b,a){if(b)this.mode=this.codeMirror.getMode(this.codeMirror.options,b),this.lines=this._newLines(this.model.getLineCount()),a&&this.highlight()},highlight:function(b,a,d){if(this.mode){for(var e=this.model.getLineCount(),b=typeof b==="undefined"?0:b,a=typeof a==="undefined"?e-1:Math.min(a,e-1),e=this.mode,g=this.getState(b),i=b;i<=a;i++){var t=this.lines[i];this.highlightLine(i,t,g);t.eolState=
this.codeMirror.copyState(e,g)}this._expandRange(b,a);if(!d)this.onHighlightDone()}},highlightLater:function(b){this.dirtyLines.push(b);var a=this;this.timer=setTimeout(function(){a._highlightJob()},50)},_highlightJob:function(){for(var b=+new Date+30,a=this.mode.compareStates,d=this.model.getLineCount();this.dirtyLines.length;){var e=this.viewportIndex,g=this.lines[e],e=g&&!g.eolState?e:this.dirtyLines.pop();if(e>=d)break;this._expandRange(e,e);for(var g=this._getResumeLineIndex(e),e=g+1,g=(g=g>=
0&&this.lines[g].eolState)?this.codeMirror.copyState(this.mode,g):this.mode.startState(),i=0,t=e;t<d;t++){var q=this.lines[t],c=q.eolState,k=this.highlightLine(t,q,g);q.eolState=this.codeMirror.copyState(this.mode,g);k&&this._expandRange(e,t+1);var q=a&&c&&a(c,q.eolState),p=!a&&!k&&i++>3;if(q||p)break;else if(!c||k)i=0;c=t<d||this.dirtyLines.length;if(+new Date>b&&c){this.highlightLater(t+1);this.onHighlightDone();return}}}this.onHighlightDone()},onHighlightDone:function(){this.startLine!==Number.MAX_VALUE&&
this.endLine!==-1&&this.dispatchEvent({type:"Highlight",start:this.startLine,end:this.endLine});this.startLine=Number.MAX_VALUE;this.endLine=-1},_getResumeLineIndex:function(b){for(var a=this.lines,d=b-1;d>=0;d--)if(a[d].eolState||b-d>40)return d;return-1},getState:function(b){var a=this.mode,d=this.lines,e,g;for(e=b-1;e>=0;e--)if(g=d[e],g.eolState||b-e>40)break;var i=e>=0&&d[e].eolState;if(i){i=this.codeMirror.copyState(a,i);for(e=Math.max(0,e);e<b-1;e++)g=d[e],this.highlightLine(e,g,i),g.eolState=
this.codeMirror.copyState(a,i);return i}else return a.startState()},highlightLine:function(b,a,d){if(this.mode){var e=this.model;e.getLineStart(b)===e.getLineEnd(b)&&this.mode.blankLine&&this.mode.blankLine(d);for(var g=a.style||[],b=e.getLine(b),b=new i(b),e=!a.style,n=[],t=0;!b.eol();t++){var q=this.mode.token(b,d)||null,c=b.current();this._whitespaceStyle(q,c,b.tokenStart);q=[b.tokenStart,b.pos,q];c=g[t];n.push(q);e=e||!c||c[0]!==q[0]||c[1]!==q[1]||c[2]!==q[2];b.advance()}if(e=e||n.length!==g.length)a.style=
n.length?n:null;return e}},_whitespaceStyle:function(b,a,d){if(!b&&this.isWhitespaceVisible&&/\s+/.test(a)){for(var b=[],e,g,i=0;i<a.length;i++){var t=a[i];t!==g&&(g&&b.push([d+e,d+i,g==="\t"?"token_tab":"token_space"]),e=i,g=t)}b.push([d+e,d+i,g==="\t"?"token_tab":"token_space"]);return b}return null},_expandRange:function(b,a){this.startLine=Math.min(this.startLine,b);this.endLine=Math.max(this.endLine,a)},toStyleRangesAndErrors:function(b,a){var d=b.style;if(!d)return null;for(var e=[],g=[],i=
typeof a==="undefined"?0:this.model.getLineStart(a),t=0;t<d.length;t++){var q=d[t],c=!q[2]?null:q[2]==="token_tab"||q[2]==="token_space"?q[2]:"cm-"+q[2];c&&(q={start:i+q[0],end:i+q[1],style:{styleClass:c}},e.push(q),c==="cm-error"&&g.push(q))}return[e,g]},getLineStyle:function(b){return this.lines[b]},getLineStyles:function(){return this.lines}};r.EventTarget.addMixin(d.prototype);p.AnnotationType.registerType("orion.annotation.highlightError",{title:u.syntaxError,html:"<div class='annotationHTML error'></div>",
rangeStyle:{styleClass:"annotationRange error"}});g.prototype={init:function(b,a,e){this.textView=b;this.annotationModel=e;this.modeApplier=new d(b.getModel(),a);var g=this;this.listener={onLineStyle:function(a){g.onLineStyle(a)},onDestroy:function(a){g.onDestroy(a)},onHighlight:function(a){g.onHighlight(a)}};b.addEventListener("LineStyle",this.listener.onLineStyle);b.addEventListener("Destroy",this.listener.onDestroy);this.modeApplier.addEventListener("Highlight",this.listener.onHighlight)},destroy:function(){this.modeApplier&&
(this.modeApplier.removeEventListener("Highlight",this.listener.onHighlight),this.modeApplier.destroy());this.textView&&(this.textView.removeEventListener("LineStyle",this.listener.onLineStyle),this.textView.removeEventListener("Destroy",this.listener.onDestroy));this.listener=this.modeApplier=this.annotationModel=this.textView=null},setMode:function(b){this.modeApplier.setMode(b)},onLineStyle:function(b){var a=b.lineIndex,d=this.modeApplier,e=d.getLineStyle(a);if(!e||!e.eolState){var g=this.textView.getModel().getLineCount();
d.highlight(a,Math.min(a+20,g-1),!0);e=d.getLineStyle(a)}g=this.textView.getModel();if(e){var i=d.toStyleRangesAndErrors(e,a);if(i&&(b.ranges=i[0],b=this.annotationModel)){d=[];e=[];if(i=i[1])for(var t=0;t<i.length;t++){var q=i[t];q.style.styleClass==="cm-error"&&e.push(p.AnnotationType.createAnnotation("orion.annotation.highlightError",q.start,q.end))}for(a=b.getAnnotations(g.getLineStart(a),g.getLineEnd(a));a.hasNext();)g=a.next(),g.type==="orion.annotation.highlightError"&&d.push(g);b.replaceAnnotations(d,
e)}}},onHighlight:function(b){this.textView.redrawLines(b.start,b.end)},onDestroy:function(){this.destroy()}};return{Mirror:b,ModeApplier:d,CodeMirrorStyler:g}});
define("orion/editor/textMateStyler",["orion/editor/regex"],function(u){function r(b){var e;if(b instanceof Array){e=Array(b.length);for(var d=0;d<b.length;d++)e[d]=r(b[d])}else for(d in e={},b)if(Object.prototype.hasOwnProperty.call(b,d)){var g=b[d];e[d]=typeof g==="object"&&g!==null?r(g):g}return e}function p(b,e,d){this.initialize(b);this.grammar=r(e);this.externalGrammars=d?r(d):[];this._styles={};this._tree=null;this._allGrammars={};this.preprocess(this.grammar)}var i={unsupported:[{regex:/\(\?[ims\-]:/,
func:function(){return"option on/off for subexp"}},{regex:/\(\?<([=!])/,func:function(b){return b[1]==="="?"lookbehind":"negative lookbehind"}},{regex:/\(\?>/,func:function(){return"atomic group"}}],toRegExp:function(b){function e(a,b){throw Error('Unsupported regex feature "'+a+'": "'+b[0]+'" at index: '+b.index+" in "+b.input);}var d="",g,b=i.processGlobalFlag("x",b,function(a){for(var b="",d=!1,e=a.length,h=0;h<e;){var g=a.charAt(h);if(!d&&g==="#")for(;h<e&&g!=="\r"&&g!=="\n";)g=a.charAt(++h);
else if(!d&&/\s/.test(g))for(;h<e&&/\s/.test(g);)g=a.charAt(++h);else g==="\\"?(b+=g,/\s/.test(a.charAt(h+1))||(b+=a.charAt(h+1),h+=1)):(g==="["?d=!0:g==="]"&&(d=!1),b+=g),h+=1}return b}),b=i.processGlobalFlag("i",b,function(a){d+="i";return a});for(g=0;g<this.unsupported.length;g++){var h;(h=this.unsupported[g].regex.exec(b))&&e(this.unsupported[g].func(h),h)}return RegExp(b,d)},processGlobalFlag:function(b,e,d){function g(a,b){for(var d=0,e=a.length,h=-1,g=b;g<e&&h===-1;g++)switch(a.charAt(g)){case "\\":g++;
break;case "(":d++;break;case ")":d--,d===0&&(h=g)}return h}var h="(?"+b+")",b="(?"+b+":";if(e.substring(0,h.length)===h)return d(e.substring(h.length));else if(e.substring(0,b.length)===b){h=g(e,0);if(h<e.length-1)throw Error("Only a "+b+") group that encloses the entire regex is supported in: "+e);return d(e.substring(b.length,h))}return e},hasBackReference:function(b){return/\\\d+/.test(b.source)},getSubstitutedRegex:function(b,e,d){for(var d=typeof d==="undefined"?!0:!1,b=b.source.split(/(\\\d+)/g),
g=[],h=0;h<b.length;h++){var a=b[h],f=/\\(\d+)/.exec(a);f?(a=e[f[1]]||"",g.push(d?u.escape(a):a)):g.push(a)}return RegExp(g.join(""))},groupify:function(b,e){for(var d=b.source,g=d.length,h=[],a=0,f=[],i=1,m=1,n=[],p={},q={},c=0;c<g;c++){var k=h[h.length-1],s=d.charAt(c);switch(s){case "(":if(k===4)h.pop(),n.push(")"),f[f.length-1].end=c;var j=c+2<g?d.charAt(c+1)+""+d.charAt(c+2):null;if(j==="?:"||j==="?="||j==="?!"){var r;j==="?:"?r=1:(r=3,a++);h.push(r);f.push({start:c,end:-1,type:r});n.push(s);
n.push(j);c+=j.length}else h.push(2),f.push({start:c,end:-1,type:2,oldNum:i,num:m}),n.push(s),a===0&&(q[m]=null),p[i]=m,i++,m++;break;case ")":k=h.pop();k===3&&a--;f[f.length-1].end=c;n.push(s);break;case "*":case "+":case "?":case "}":var l=s,y=d.charAt(c-1),j=c-1;if(s==="}"){for(r=c-1;d.charAt(r)!=="{"&&r>=0;r--);y=d.charAt(r-1);j=r-1;l=d.substring(r,c+1)}r=f[f.length-1];if(y===")"&&(r.type===2||r.type===4)){n.splice(r.start,0,"(");n.push(l);n.push(")");s={start:r.start,end:n.length-1,type:4,num:r.num};
for(y=0;y<f.length;y++)if(k=f[y],(k.type===2||k.type===4)&&k.start>=r.start&&k.end<=j)if(k.start+=1,k.end+=1,k.num+=1,k.type===2)p[k.oldNum]=k.num;f.push(s);m++;break}default:s!=="|"&&k!==2&&k!==4&&a===0&&(h.push(4),f.push({start:c,end:-1,type:4,num:m}),n.push("("),q[m]=null,m++),n.push(s),s==="\\"&&(s=d.charAt(c+1),n.push(s),c+=1)}}for(;h.length;)h.pop(),n.push(")");var d=RegExp(n.join("")),g={},e=e||p,u;for(u in e)e.hasOwnProperty(u)&&(g[u]="\\"+e[u]);d=this.getSubstitutedRegex(d,g,!1);return[d,
p,q]},complexCaptures:function(b){if(!b)return!1;for(var e in b)if(b.hasOwnProperty(e)&&e!=="0")return!0;return!1}};p.prototype={initialize:function(b){this.textView=b;this.textView.stylerOptions=this;var e=this;this._listener={onModelChanged:function(b){e.onModelChanged(b)},onDestroy:function(b){e.onDestroy(b)},onLineStyle:function(b){e.onLineStyle(b)},onStorage:function(b){e.onStorage(b)}};b.addEventListener("ModelChanged",this._listener.onModelChanged);b.addEventListener("Destroy",this._listener.onDestroy);
b.addEventListener("LineStyle",this._listener.onLineStyle);b.redrawLines()},onDestroy:function(){this.destroy()},destroy:function(){if(this.textView)this.textView.removeEventListener("ModelChanged",this._listener.onModelChanged),this.textView.removeEventListener("Destroy",this._listener.onDestroy),this.textView.removeEventListener("LineStyle",this._listener.onLineStyle),this.textView=null;this._listener=this._tree=this._styles=this.grammar=null},preprocess:function(b){for(b=[b];b.length!==0;){var e=
b.pop();if(!e._resolvedRule||!e._typedRule)if(e._resolvedRule=this._resolve(e),e._typedRule=this._createTypedRule(e),this.addStyles(e.name),this.addStyles(e.contentName),this.addStylesForCaptures(e.captures),this.addStylesForCaptures(e.beginCaptures),this.addStylesForCaptures(e.endCaptures),e._resolvedRule!==e&&b.push(e._resolvedRule),e.patterns)for(var d=0;d<e.patterns.length;d++)b.push(e.patterns[d])}},addStyles:function(b){if(b&&!this._styles[b]){this._styles[b]=[];for(var e=b.split("."),d=0;d<
e.length;d++)this._styles[b].push(e.slice(0,d+1).join("-"))}},addStylesForCaptures:function(b){for(var e in b)b.hasOwnProperty(e)&&this.addStyles(b[e].name)},ContainerRule:function(){function b(b){this.rule=b;this.subrules=b.patterns}b.prototype.valueOf=function(){return"aa"};return b}(),BeginEndRule:function(){function b(b){this.rule=b;this.beginRegex=i.toRegExp(b.begin);this.endRegex=i.toRegExp(b.end);this.subrules=b.patterns||[];this.endRegexHasBackRef=i.hasBackReference(this.endRegex);var d=i.complexCaptures(b.captures),
b=i.complexCaptures(b.beginCaptures)||i.complexCaptures(b.endCaptures);if(this.isComplex=d||b)d=i.groupify(this.beginRegex),this.beginRegex=d[0],this.beginOld2New=d[1],this.beginConsuming=d[2],d=i.groupify(this.endRegex,this.beginOld2New),this.endRegex=d[0],this.endOld2New=d[1],this.endConsuming=d[2]}b.prototype.valueOf=function(){return this.beginRegex};return b}(),MatchRule:function(){function b(b){this.rule=b;this.matchRegex=i.toRegExp(b.match);if(this.isComplex=i.complexCaptures(b.captures))b=
i.groupify(this.matchRegex),this.matchRegex=b[0],this.matchOld2New=b[1],this.matchConsuming=b[2]}b.prototype.valueOf=function(){return this.matchRegex};return b}(),_createTypedRule:function(b){return b.match?new this.MatchRule(b):b.begin?new this.BeginEndRule(b):new this.ContainerRule(b)},_resolve:function(b){var e=b;if(b.include){if(b.begin||b.end||b.match)throw Error('Unexpected regex pattern in "include" rule '+b.include);b=b.include;if(b.charAt(0)==="#"){if(e=this.grammar.repository&&this.grammar.repository[b.substring(1)],
!e)throw Error("Couldn't find included rule "+b+" in grammar repository");}else if(b==="$self")e=this.grammar;else if(b==="$base")throw Error('Include "$base" is not supported');else if(e=this._allGrammars[b],!e)for(var d=0;d<this.externalGrammars.length;d++){var g=this.externalGrammars[d];if(g.scopeName===b){this.preprocess(g);e=this._allGrammars[b]=g;break}}}return e},ContainerNode:function(){function b(b,d){this.parent=b;this.rule=d;this.children=[];this.end=this.start=null}b.prototype.addChild=
function(b){this.children.push(b)};b.prototype.valueOf=function(){var b=this.rule;return"ContainerNode { "+(b.include||"")+" "+(b.name||"")+(b.comment||"")+"}"};return b}(),BeginEndNode:function(){function b(b,d,g){this.parent=b;this.rule=d;this.children=[];this.setStart(g);this.endMatch=this.end=null;this.endRegexSubstituted=d.endRegexHasBackRef?i.getSubstitutedRegex(d.endRegex,g):null}b.prototype.addChild=function(b){this.children.push(b)};b.prototype.getIndexInParent=function(){return this.parent?
this.parent.children.indexOf(this):-1};b.prototype.setStart=function(b){this.start=b.index;this.beginMatch=b};b.prototype.setEnd=function(b){b&&typeof b==="object"?(this.endMatch=b,this.end=b.index+b[0].length):(this.endMatch=null,this.end=b)};b.prototype.shiftStart=function(b){this.start+=b;this.beginMatch.index+=b};b.prototype.shiftEnd=function(b){this.end+=b;this.endMatch&&(this.endMatch.index+=b)};b.prototype.valueOf=function(){return"{"+this.rule.beginRegex+" range="+this.start+".."+this.end+
"}"};return b}(),push:function(b,e){if(e)for(var d=e.length;d>0;)b.push(e[--d])},exec:function(b,e,d){(e=b.exec(e))&&(e.index+=d);b.lastIndex=0;return e},afterMatch:function(b){return b.index+b[0].length},getEndMatch:function(b,e,d){if(b instanceof this.BeginEndNode){var g=b.rule,b=b.endRegexSubstituted||g.endRegex;return!b?null:this.exec(b,e,d)}return null},initialParse:function(){this.textView.getModel().getCharCount();this._tree=new this.ContainerNode(null,this.grammar._typedRule);this.parse(this._tree,
!1,0)},onModelChanged:function(b){var e=b.addedCharCount,d=b.removedCharCount,b=b.start;if(this._tree){var g=this.textView.getModel(),h=g.getCharCount(),g=g.getLineEnd(g.getLineAtOffset(b)-1),a=this.getFirstDamaged(g,g),g=g===-1?0:g,e=a?this.parse(a,!0,g,b,e,d):h;this.textView.redrawRange(g,e)}else this.initialParse()},getFirstDamaged:function(b,e){if(b<0)return this._tree;for(var d=[this._tree],g=null;d.length;){var h=d.pop();if(!h.parent||this.isDamaged(h,b,e)){h instanceof this.BeginEndNode&&(g=
h);for(var a=0;a<h.children.length;a++)d.push(h.children[a])}}return g||this._tree},isDamaged:function(b,e,d){return b.start<=d&&b.end>e},parse:function(b,e,d,g,h,a){var f=this.textView.getModel(),i=f.getLineStart(f.getLineCount()-1),m=f.getCharCount(),n=this.getInitialExpected(b,d),p=-1;if(e)b.repaired=!0,b.endNeedsUpdate=!0,p=(p=b.children[b.children.length-1])?f.getLineEnd(f.getLineAtOffset(p.end+(h-a))):-1,g=f.getLineEnd(f.getLineAtOffset(g+a)),p=Math.max(p,g);for(var p=p===-1?m:p,g=n,q=b,c=!1,
k=d,s=-1;q&&(!e||k<p);){var j=this.getNextMatch(f,q,k);j||(k=k>=i?m:f.getLineStart(f.getLineAtOffset(k)+1));var r=j&&j.match,l=j&&j.rule,y=j&&j.isEnd;if(j&&j.isSub){if(k=this.afterMatch(r),l instanceof this.BeginEndRule)c=!0,e&&l===g.rule&&q===g.parent?(q=g,q.setStart(r),q.repaired=!0,q.endNeedsUpdate=!0,g=this.getNextExpected(g,"begin")):(e&&(this.prune(q,g),e=!1),r=new this.BeginEndNode(q,l,r),q.addChild(r),q=r)}else if(y||k===m){if(q instanceof this.BeginEndNode)r?(c=!0,s=Math.max(s,q.end),q.setEnd(r),
k=this.afterMatch(r),e&&q===g&&q.parent===g.parent?(q.repaired=!0,delete q.endNeedsUpdate,g=this.getNextExpected(g,"end")):e&&(this.prune(q,g),e=!1)):(q.setEnd(m),delete q.endNeedsUpdate);q=q.parent}e&&k>=p&&!c&&(this.prune(b,n),e=!1)}this.removeUnrepairedChildren(b,e,d);this.cleanup(e,b,d,p,m,h,a);return e?Math.max(s,k):k},removeUnrepairedChildren:function(b,e,d){if(e){for(var e=b.children,g=-1,h=0;h<e.length;h++){var a=e[h];if(!a.repaired&&this.isDamaged(a,d,Number.MAX_VALUE)){g=h;break}}if(g!==
-1)b.children.length=g}},cleanup:function(b,e,d,g,h,a,f){if(b){b=a-f;h=this.getIntersecting(g-b+1,h);e=this.getIntersecting(d,g);for(d=0;d<h.length;d++)g=h[d],!g.repaired&&g instanceof this.BeginEndNode&&(g.shiftEnd(b),g.shiftStart(b));for(d=0;d<e.length;d++)g=e[d],g.repaired&&g.endNeedsUpdate&&g.shiftEnd(b),delete g.endNeedsUpdate,delete g.repaired}else{e=this.getIntersecting(d,g);for(d=0;d<e.length;d++)delete e[d].repaired}},getNextMatch:function(b,e,d,g){var h=b.getLineAtOffset(d),h=b.getLineEnd(h),
a=b.getText(d,h),f=[],i=[],b=[],h=[];for(this.push(f,e.rule.subrules);f.length;){var m=f.length?f.pop():null,m=m&&m._resolvedRule._typedRule;if(m instanceof this.ContainerRule&&i.indexOf(m)===-1)i.push(m),this.push(f,m.subrules);else if(!m||!g||m.matchRegex){var n=m&&this.exec(m.matchRegex||m.beginRegex,a,d);n&&(b.push(n),h.push(m))}}f=Number.MAX_VALUE;i=-1;for(m=0;m<b.length;m++)if(n=b[m],n.index<f)f=n.index,i=m;if(!g&&(d=this.getEndMatch(e,a,d)))if(g=e.rule.applyEndPatternLast,i===-1||d.index<f||
!g&&d.index===f)return{isEnd:!0,rule:e.rule,match:d};return i===-1?null:{isSub:!0,rule:h[i],match:b[i]}},getInitialExpected:function(b,e){var d,g;if(b===this._tree)for(d=0;d<b.children.length;d++){if(g=b.children[d],g.start>=e)return g}else if(b instanceof this.BeginEndNode&&b.endMatch){var h=b.endMatch.index;for(d=0;d<b.children.length;d++)if(g=b.children[d],g.start>=e)break;if(g&&g.start<h)return g}return b},getNextExpected:function(b,e){if(e==="begin"){var d=b.children[0];return d?d:b}else if(e===
"end"&&(d=b.parent)){var g=d.children[d.children.indexOf(b)+1];return g?g:d}return null},prune:function(b,e){if(e.parent===b)b.children.length=e.getIndexInParent();else if(b instanceof this.BeginEndNode)b.endMatch=null,b.end=null;if(b.parent)b.parent.children.length=b.getIndexInParent()+1},onLineStyle:function(b){this._tree||this.initialParse();var e=b.lineStart,d=this.textView.getModel(),g=d.getLineEnd(b.lineIndex),h=d.getLineEnd(d.getLineAtOffset(e)-1),h=this.getFirstDamaged(h,h),e=this.getLineScope(d,
h,e,g);b.ranges=this.toStyleRanges(e);b.ranges.sort(function(a,b){return a.start-b.start})},getLineScope:function(b,e,d,g){for(var h=d,a=this.getInitialExpected(e,d),f=[],i=[];e&&h<g;){var m=this.getNextMatch(b,e,h);if(!m)break;var n=m&&m.match,p=m&&m.rule,q=m&&m.isSub,m=m&&m.isEnd;n.index!==h&&i.push({start:h,end:n.index,node:e});if(q)h=this.afterMatch(n),p instanceof this.BeginEndRule?(this.addBeginScope(f,n,p),e=a,a=this.getNextExpected(a,"begin")):this.addMatchScope(f,n,p);else if(m)h=this.afterMatch(n),
this.addEndScope(f,n,p),a=this.getNextExpected(a,"end"),e=e.parent}h<g&&i.push({start:h,end:g,node:e});b=this.getInheritedLineScope(i,d,g);return f.concat(b)},getInheritedLineScope:function(b){for(var e=[],d=0;d<b.length;d++)for(var g=b[d],h=g.node;h;){var a=h.rule.rule,f=a.name;if(a=a.contentName||f){this.addScopeRange(e,g.start,g.end,a);break}h=h.parent}return e},addBeginScope:function(b,e,d){var g=d.rule;this.addCapturesScope(b,e,g.beginCaptures||g.captures,d.isComplex,d.beginOld2New,d.beginConsuming)},
addEndScope:function(b,e,d){var g=d.rule;this.addCapturesScope(b,e,g.endCaptures||g.captures,d.isComplex,d.endOld2New,d.endConsuming)},addMatchScope:function(b,e,d){var g=d.rule,h=g.name;(g=g.captures)?this.addCapturesScope(b,e,g,d.isComplex,d.matchOld2New,d.matchConsuming):this.addScope(b,e,h)},addScope:function(b,e,d){d&&b.push({start:e.index,end:this.afterMatch(e),scope:d})},addScopeRange:function(b,e,d,g){g&&b.push({start:e,end:d,scope:g})},addCapturesScope:function(b,e,d,g,h,a){if(d)if(g){for(var g=
{1:0},f=0,i=1;e[i]!==void 0;i++)a[i]!==void 0&&(f+=e[i].length),e[i+1]!==void 0&&(g[i+1]=f);a=e.index;for(f=1;d[f];f++){var i=d[f].name,m=h[f],n=a+g[m];typeof e[m]!=="undefined"&&this.addScopeRange(b,n,n+e[m].length,i)}}else this.addScope(b,e,d[0]&&d[0].name)},getIntersecting:function(b,e){for(var d=[],g=this._tree?[this._tree]:[];g.length;){var h=g.pop(),a=!1;h instanceof this.ContainerNode?a=!0:this.isDamaged(h,b,e)&&(a=!0,d.push(h));if(a)for(var a=h.children.length,f=0;f<a;f++)g.push(h.children[f])}return d.reverse()},
toStyleRanges:function(b){for(var e=[],d=0;d<b.length;d++){var g=b[d],h=this._styles[g.scope];if(!h)throw Error("styles not found for "+g.scope);h=h.join(" ");e.push({start:g.start,end:g.end,style:{styleClass:h}})}return e}};return{RegexUtil:i,TextMateStyler:p}});
define("orion/editor/htmlGrammar",[],function(){return{HtmlGrammar:function(){return{scopeName:"source.html",uuid:"3B5C76FB-EBB5-D930-F40C-047D082CE99B",patterns:[{begin:"<!(doctype|DOCTYPE)",end:">",contentName:"entity.name.tag.doctype.html",beginCaptures:{0:{name:"entity.name.tag.doctype.html"}},endCaptures:{0:{name:"entity.name.tag.doctype.html"}}},{begin:"<\!--",end:"--\>",beginCaptures:{0:{name:"punctuation.definition.comment.html"}},endCaptures:{0:{name:"punctuation.definition.comment.html"}},
patterns:[{match:"--",name:"invalid.illegal.badcomment.html"}],contentName:"comment.block.html"},{match:"<[A-Za-z0-9_\\-:]+(?= ?)",name:"entity.name.tag.html"},{include:"#attrName"},{include:"#qString"},{include:"#qqString"},{include:"#entity"},{match:"</[A-Za-z0-9_\\-:]+>",name:"entity.name.tag.html"},{match:">",name:"entity.name.tag.html"}],repository:{attrName:{match:"[A-Za-z\\-:]+(?=\\s*=\\s*['\"])",name:"entity.other.attribute.name.html"},qqString:{match:'(")[^"]+(")',name:"string.quoted.double.html"},
qString:{match:"(')[^']+(')",name:"string.quoted.single.html"},entity:{match:"&[A-Za-z0-9]+;",name:"constant.character.entity.html"}}}}}});
define("examples/editor/textStyler",["orion/editor/annotations"],function(u){function r(a,b){this.keywords=a;this.whitespacesVisible=b;this.setText("")}function p(){r.call(this,null,!0)}function i(a){r.call(this,null,a)}function b(){r.call(this,null,!1)}function e(a,c,e){this.commentStart="/*";this.commentEnd="*/";var f=[];switch(c){case "java":f=g;break;case "js":f=d;break;case "css":f=h}this.whitespacesVisible=!1;this.detectHyperlinks=!0;this.highlightCaretLine=!1;this.detectTasks=this.foldingEnabled=
!0;this._scanner=new r(f,this.whitespacesVisible);this._firstScanner=new b;this._commentScanner=new i(this.whitespacesVisible);this._whitespaceScanner=new p;if(c==="css")this._scanner.isCSS=!0,this._firstScanner.isCSS=!0;this.view=a;this.annotationModel=e;this._bracketAnnotations=void 0;var j=this;this._listener={onChanged:function(a){j._onModelChanged(a)},onDestroy:function(a){j._onDestroy(a)},onLineStyle:function(a){j._onLineStyle(a)},onMouseDown:function(a){j._onMouseDown(a)},onSelection:function(a){j._onSelection(a)}};
c=a.getModel();c.getBaseModel&&(c=c.getBaseModel());c.addEventListener("Changed",this._listener.onChanged);a.addEventListener("MouseDown",this._listener.onMouseDown);a.addEventListener("Selection",this._listener.onSelection);a.addEventListener("Destroy",this._listener.onDestroy);a.addEventListener("LineStyle",this._listener.onLineStyle);this._computeComments();this._computeFolding();a.redrawLines()}var d="break,case,class,catch,continue,const,debugger,default,delete,do,else,enum,export,extends,false,finally,for,function,if,implements,import,in,instanceof,interface,let,new,null,package,private,protected,public,return,static,super,switch,this,throw,true,try,typeof,undefined,var,void,while,with,yield".split(","),
g="abstract,boolean,break,byte,case,catch,char,class,continue,default,do,double,else,extends,false,final,finally,float,for,if,implements,import,instanceof,int,interface,long,native,new,null,package,private,protected,public,return,short,static,super,switch,synchronized,this,throw,throws,transient,true,try,void,volatile,while".split(","),h="alignment-adjust,alignment-baseline,animation,animation-delay,animation-direction,animation-duration,animation-iteration-count,animation-name,animation-play-state,animation-timing-function,appearance,azimuth,backface-visibility,background,background-attachment,background-clip,background-color,background-image,background-origin,background-position,background-repeat,background-size,baseline-shift,binding,bleed,bookmark-label,bookmark-level,bookmark-state,bookmark-target,border,border-bottom,border-bottom-color,border-bottom-left-radius,border-bottom-right-radius,border-bottom-style,border-bottom-width,border-collapse,border-color,border-image,border-image-outset,border-image-repeat,border-image-slice,border-image-source,border-image-width,border-left,border-left-color,border-left-style,border-left-width,border-radius,border-right,border-right-color,border-right-style,border-right-width,border-spacing,border-style,border-top,border-top-color,border-top-left-radius,border-top-right-radius,border-top-style,border-top-width,border-width,bottom,box-align,box-decoration-break,box-direction,box-flex,box-flex-group,box-lines,box-ordinal-group,box-orient,box-pack,box-shadow,box-sizing,break-after,break-before,break-inside,caption-side,clear,clip,color,color-profile,column-count,column-fill,column-gap,column-rule,column-rule-color,column-rule-style,column-rule-width,column-span,column-width,columns,content,counter-increment,counter-reset,crop,cue,cue-after,cue-before,cursor,direction,display,dominant-baseline,drop-initial-after-adjust,drop-initial-after-align,drop-initial-before-adjust,drop-initial-before-align,drop-initial-size,drop-initial-value,elevation,empty-cells,fit,fit-position,flex-align,flex-flow,flex-inline-pack,flex-order,flex-pack,float,float-offset,font,font-family,font-size,font-size-adjust,font-stretch,font-style,font-variant,font-weight,grid-columns,grid-rows,hanging-punctuation,height,hyphenate-after,hyphenate-before,hyphenate-character,hyphenate-lines,hyphenate-resource,hyphens,icon,image-orientation,image-rendering,image-resolution,inline-box-align,left,letter-spacing,line-height,line-stacking,line-stacking-ruby,line-stacking-shift,line-stacking-strategy,list-style,list-style-image,list-style-position,list-style-type,margin,margin-bottom,margin-left,margin-right,margin-top,mark,mark-after,mark-before,marker-offset,marks,marquee-direction,marquee-loop,marquee-play-count,marquee-speed,marquee-style,max-height,max-width,min-height,min-width,move-to,nav-down,nav-index,nav-left,nav-right,nav-up,opacity,orphans,outline,outline-color,outline-offset,outline-style,outline-width,overflow,overflow-style,overflow-x,overflow-y,padding,padding-bottom,padding-left,padding-right,padding-top,page,page-break-after,page-break-before,page-break-inside,page-policy,pause,pause-after,pause-before,perspective,perspective-origin,phonemes,pitch,pitch-range,play-during,position,presentation-level,punctuation-trim,quotes,rendering-intent,resize,rest,rest-after,rest-before,richness,right,rotation,rotation-point,ruby-align,ruby-overhang,ruby-position,ruby-span,size,speak,speak-header,speak-numeral,speak-punctuation,speech-rate,stress,string-set,table-layout,target,target-name,target-new,target-position,text-align,text-align-last,text-decoration,text-emphasis,text-height,text-indent,text-justify,text-outline,text-shadow,text-transform,text-wrap,top,transform,transform-origin,transform-style,transition,transition-delay,transition-duration,transition-property,transition-timing-function,unicode-bidi,vertical-align,visibility,voice-balance,voice-duration,voice-family,voice-pitch,voice-pitch-range,voice-rate,voice-stress,voice-volume,volume,white-space,white-space-collapse,widows,width,word-break,word-spacing,word-wrap,z-index".split(","),
a={styleClass:"comment"},f={styleClass:"token_multiline_comment"},o={styleClass:"token_doc_comment"},m={styleClass:"token_doc_html_markup"},n={styleClass:"token_task_tag"},t={styleClass:"token_doc_tag"},q={styleClass:"token_string"},c={styleClass:"token_number"},k={styleClass:"token_keyword"},s={styleClass:"token_space"},j={styleClass:"token_tab"},x={styleClass:"line_caret"};r.prototype={getOffset:function(){return this.offset},getStartOffset:function(){return this.startOffset},getData:function(){return this.text.substring(this.startOffset,
this.offset)},getDataLength:function(){return this.offset-this.startOffset},_default:function(a){switch(a){case 32:case 9:if(this.whitespacesVisible)return a===32?11:10;do a=this._read();while(a===32||a===9);this._unread(a);return 9;case 123:case 125:case 40:case 41:case 91:case 93:case 60:case 62:return a;default:var b=this.isCSS,c=this.offset-1;if(!b&&48<=a&&a<=57){var d=b=!1,e=!1,f=a;do if(a=this._read(),a===46&&!b)b=!0;else if(a===101&&!d)b=d=!0,a=this._read(),a!==45&&this._unread(a);else if(a===
120&&f===48&&this.offset-c===2)b=d=e=!0;else if(!(48<=a&&a<=57||e&&(65<=a&&a<=70||97<=a&&a<=102)))break;while(1);this._unread(a);return 3}if(97<=a&&a<=122||65<=a&&a<=90||a===95||45===a&&b){do a=this._read();while(97<=a&&a<=122||65<=a&&a<=90||a===95||48<=a&&a<=57||45===a&&b);this._unread(a);a=this.keywords;if(a.length>0){c=this.text.substring(c,this.offset);for(b=0;b<a.length;b++)if(this.keywords[b]===c)return 2}}return 1}},_read:function(){return this.offset<this.text.length?this.text.charCodeAt(this.offset++):
-1},_unread:function(a){a!==-1&&this.offset--},nextToken:function(){for(this.startOffset=this.offset;;){var a=this._read(),b;switch(a){case -1:return null;case 47:a=this._read();if(!this.isCSS&&a===47)for(;;)if(a=this._read(),a===-1||a===10||a===13)return this._unread(a),6;if(a===42){a=this._read();b=7;for(a===42&&(b=8);;){for(;a===42;)if(a=this._read(),a===47)return b;if(a===-1)return this._unread(a),b;a=this._read()}}this._unread(a);return 1;case 39:for(b=4;;)switch(a=this._read(),a){case 39:return b;
case 13:case 10:case -1:return this._unread(a),b;case 92:switch(a=this._read(),a){case 10:b=5;break;case 13:b=5,a=this._read(),a!==10&&this._unread(a)}}break;case 34:for(b=4;;)switch(a=this._read(),a){case 34:return b;case 13:case 10:case -1:return this._unread(a),b;case 92:switch(a=this._read(),a){case 10:b=5;break;case 13:b=5,a=this._read(),a!==10&&this._unread(a)}}break;default:return this._default(a)}}},setText:function(a){this.text=a;this.startOffset=this.offset=0}};p.prototype=new r(null);p.prototype.nextToken=
function(){for(this.startOffset=this.offset;;){var a=this._read();switch(a){case -1:return null;case 32:return 11;case 9:return 10;default:do a=this._read();while(!(a===32||a===9||a===-1));this._unread(a);return 1}}};i.prototype=new r(null);i.prototype.setType=function(a){this._type=a};i.prototype.nextToken=function(){for(this.startOffset=this.offset;;){var a=this._read();switch(a){case -1:return null;case 32:case 9:if(this.whitespacesVisible)return a===32?11:10;do a=this._read();while(a===32||a===
9);this._unread(a);return 9;case 60:if(this._type===8){do a=this._read();while(!(a===62||a===-1));if(a===62)return 12}return 1;case 64:if(this._type===8){do a=this._read();while(97<=a&&a<=122||65<=a&&a<=90||a===95||48<=a&&a<=57);this._unread(a);return 13}return 1;case 84:if((a=this._read())===79)if((a=this._read())===68)if((a=this._read())===79)if(a=this._read(),!(97<=a&&a<=122||65<=a&&a<=90||a===95||48<=a&&a<=57))return this._unread(a),14;this._unread(a);default:do a=this._read();while(!(a===32||
a===9||a===-1||a===60||a===64||a===84));this._unread(a);return 1}}};b.prototype=new r(null);b.prototype._default=function(a){for(;;)switch(a=this._read(),a){case 47:case 34:case 39:case -1:return this._unread(a),1}};e.prototype={destroy:function(){var a=this.view;if(a){var b=a.getModel();b.getBaseModel&&(b=b.getBaseModel());b.removeEventListener("Changed",this._listener.onChanged);a.removeEventListener("MouseDown",this._listener.onMouseDown);a.removeEventListener("Selection",this._listener.onSelection);
a.removeEventListener("Destroy",this._listener.onDestroy);a.removeEventListener("LineStyle",this._listener.onLineStyle);this.view=null}},setHighlightCaretLine:function(a){this.highlightCaretLine=a},setWhitespacesVisible:function(a){this.whitespacesVisible=a;this._scanner.whitespacesVisible=a;this._commentScanner.whitespacesVisible=a},setDetectHyperlinks:function(a){this.detectHyperlinks=a},setFoldingEnabled:function(a){this.foldingEnabled=a},setDetectTasks:function(a){this.detectTasks=a},_binarySearch:function(a,
b,c,d,e){var f;d===void 0&&(d=-1);if(e===void 0)e=a.length;for(;e-d>1;)if(f=Math.floor((e+d)/2),b<=a[f].start)e=f;else if(c&&b<a[f].end){e=f;break}else d=f;return e},_computeComments:function(){var a=this.view.getModel();a.getBaseModel&&(a=a.getBaseModel());this.comments=this._findComments(a.getText())},_computeFolding:function(){if(this.foldingEnabled){var a=this.view.getModel();if(a.getBaseModel){var b=this.annotationModel;if(b){b.removeAnnotations(u.AnnotationType.ANNOTATION_FOLDING);for(var c=
[],d=a.getBaseModel(),e=this.comments,f=0;f<e.length;f++){var g=e[f];(g=this._createFoldingAnnotation(a,d,g.start,g.end))&&c.push(g)}b.replaceAnnotations(null,c)}}}},_createFoldingAnnotation:function(a,b,c,d){var e=b.getLineAtOffset(c),b=b.getLineAtOffset(d);return e===b?null:new (u.AnnotationType.getType(u.AnnotationType.ANNOTATION_FOLDING))(c,d,a)},_computeTasks:function(a,b,c){if(this.detectTasks){var d=this.annotationModel;if(d){var e=this.view.getModel(),f=e;e.getBaseModel&&(f=e.getBaseModel());
for(var g=d.getAnnotations(b,c),e=[],h=u.AnnotationType.ANNOTATION_TASK;g.hasNext();){var i=g.next();i.type===h&&e.push(i)}g=[];i=this._commentScanner;i.setText(f.getText(b,c));for(var j;j=i.nextToken();){var k=i.getStartOffset()+b;j===14&&(j=f.getLineEnd(f.getLineAtOffset(k)),a!==6&&(j=Math.min(j,c-this.commentEnd.length)),g.push(u.AnnotationType.createAnnotation(h,k,j,f.getText(k,j))))}d.replaceAnnotations(e,g)}}},_getLineStyle:function(a){if(this.highlightCaretLine){var b=this.view,c=b.getModel(),
b=b.getSelection();if(b.start===b.end&&c.getLineAtOffset(b.start)===a)return x}return null},_getStyles:function(a,b,c){a.getBaseModel&&(c=a.mapOffset(c));for(var d=c+b.length,e=[],g=c,h=this.comments,i=this._binarySearch(h,c,!0);i<h.length;i++){if(h[i].start>=d)break;var j=h[i].start,k=h[i].end;g<j&&this._parse(b.substring(g-c,j-c),g,e);var m=h[i].type,n;switch(m){case 8:n=o;break;case 7:n=f;break;case 5:n=q}g=Math.max(g,j);j=Math.min(d,k);(m===8||m===7)&&(this.whitespacesVisible||this.detectHyperlinks)?
this._parseComment(b.substring(g-c,j-c),g,e,n,m):m===5&&this.whitespacesVisible?this._parseString(b.substring(g-c,j-c),g,e,q):e.push({start:g,end:j,style:n});g=k}g<d&&this._parse(b.substring(g-c,d-c),g,e);if(a.getBaseModel)for(b=0;b<e.length;b++)c=e[b].end-e[b].start,e[b].start=a.mapOffset(e[b].start,!0),e[b].end=e[b].start+c;return e},_parse:function(b,d,e){var g=this._scanner;for(g.setText(b);b=g.nextToken();){var h=g.getStartOffset()+d,i=null;switch(b){case 2:i=k;break;case 3:i=c;break;case 5:case 4:if(this.whitespacesVisible){this._parseString(g.getData(),
h,e,q);continue}else i=q;break;case 8:this._parseComment(g.getData(),h,e,o,b);continue;case 6:this._parseComment(g.getData(),h,e,a,b);continue;case 7:this._parseComment(g.getData(),h,e,f,b);continue;case 10:this.whitespacesVisible&&(i=j);break;case 11:this.whitespacesVisible&&(i=s)}e.push({start:h,end:g.getOffset()+d,style:i})}},_parseComment:function(a,b,c,d,e){var f=this._commentScanner;f.setText(a);for(f.setType(e);a=f.nextToken();){var e=f.getStartOffset()+b,g=d;switch(a){case 10:this.whitespacesVisible&&
(g=j);break;case 11:this.whitespacesVisible&&(g=s);break;case 12:g=m;break;case 13:g=t;break;case 14:g=n;break;default:this.detectHyperlinks&&(g=this._detectHyperlinks(f.getData(),e,c,g))}g&&c.push({start:e,end:f.getOffset()+b,style:g})}},_parseString:function(a,b,c,d){var e=this._whitespaceScanner;for(e.setText(a);a=e.nextToken();){var f=e.getStartOffset()+b,g=d;switch(a){case 10:this.whitespacesVisible&&(g=j);break;case 11:this.whitespacesVisible&&(g=s)}g&&c.push({start:f,end:e.getOffset()+b,style:g})}},
_detectHyperlinks:function(a,b,c,d){var e=null,f;if((f=a.indexOf("://"))>0){for(var e=a,g=f;g>0;){f=e.charCodeAt(g-1);if(!(97<=f&&f<=122||65<=f&&f<=90||45===f||48<=f&&f<=57))break;g--}if(g>0&&(f="\"\"''(){}[]<>".indexOf(e.substring(g-1,g)),f!==-1&&(f&1)===0&&(f=e.lastIndexOf("\"\"''(){}[]<>".substring(f+1,f+2)))!==-1)){var h=f;f=this._clone(d);f.tagName="A";f.attributes={href:e.substring(g,h)};c.push({start:b,end:b+g,style:d});c.push({start:b+g,end:b+h,style:f});c.push({start:b+h,end:b+a.length,style:d});
return null}}else a.toLowerCase().indexOf("bug#")===0&&(e="https://bugs.eclipse.org/bugs/show_bug.cgi?id="+parseInt(a.substring(4),10));return e?(f=this._clone(d),f.tagName="A",f.attributes={href:e},f):d},_clone:function(a){if(!a)return a;var b={},c;for(c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},_findComments:function(a,b){var b=b||0,c=this._firstScanner,d;c.setText(a);for(var e=[];d=c.nextToken();)(d===7||d===8||d===5)&&e.push({start:c.getStartOffset()+b,end:c.getOffset()+b,type:d}),(d===
6||d===7||d===8)&&this._computeTasks(d,c.getStartOffset()+b,c.getOffset()+b);return e},_findMatchingBracket:function(a,b){var c="{}()[]<>",d=a.getText(b,b+1),e=c.indexOf(d,0);if(e===-1)return-1;var f;f=e&1?c.substring(e-1,e):c.substring(e+1,e+2);for(var g=a.getLineAtOffset(b),c=a.getLine(g),h=a.getLineStart(g),i=a.getLineEnd(g),c=this._findBrackets(d,f,c,h,h,i),i=0;i<c.length;i++)if(h=c[i]>=0?1:-1,c[i]*h-1===b){var j=1;if(e&1){for(i--;i>=0;i--)if(h=c[i]>=0?1:-1,j+=h,j===0)return c[i]*h-1;for(g-=1;g>=
0;){c=a.getLine(g);h=a.getLineStart(g);i=a.getLineEnd(g);c=this._findBrackets(d,f,c,h,h,i);for(e=c.length-1;e>=0;e--)if(h=c[e]>=0?1:-1,j+=h,j===0)return c[e]*h-1;g--}}else{for(i++;i<c.length;i++)if(h=c[i]>=0?1:-1,j+=h,j===0)return c[i]*h-1;g+=1;for(e=a.getLineCount();g<e;){c=a.getLine(g);h=a.getLineStart(g);i=a.getLineEnd(g);c=this._findBrackets(d,f,c,h,h,i);for(i=0;i<c.length;i++)if(h=c[i]>=0?1:-1,j+=h,j===0)return c[i]*h-1;g++}}break}return-1},_findBrackets:function(a,b,c,d,e,f){for(var g=[],a=
a.charCodeAt(0),b=b.charCodeAt(0),h=e,i=this._scanner,j,k=this.comments,m=this._binarySearch(k,e,!0);m<k.length;m++){if(k[m].start>=f)break;j=k[m].start;var n=k[m].end;if(h<j)for(i.setText(c.substring(h-e,j-e));j=i.nextToken();)j===a?g.push(i.getStartOffset()+h-e+d+1):j===b&&g.push(-(i.getStartOffset()+h-e+d+1));h=n}if(h<f)for(i.setText(c.substring(h-e,f-e));j=i.nextToken();)j===a?g.push(i.getStartOffset()+h-e+d+1):j===b&&g.push(-(i.getStartOffset()+h-e+d+1));return g},_onDestroy:function(){this.destroy()},
_onLineStyle:function(a){if(a.textView===this.view)a.style=this._getLineStyle(a.lineIndex);a.ranges=this._getStyles(a.textView.getModel(),a.lineText,a.lineStart)},_onSelection:function(a){var b=a.oldValue,c=a.newValue,d=this.view,a=d.getModel(),e;if(this.highlightCaretLine){var f=a.getLineAtOffset(b.start);e=a.getLineAtOffset(c.start);var g=c.start===c.end,b=b.start===b.end;f===e&&b&&g||(b&&d.redrawLines(f,f+1),(f!==e||!b)&&g&&d.redrawLines(e,e+1))}if(this.annotationModel){var b=this._bracketAnnotations,
h,i;if(c.start===c.end&&(i=d.getCaretOffset())>0)i-=1,a.getBaseModel&&(i=a.mapOffset(i),a=a.getBaseModel()),a=this._findMatchingBracket(a,i),a!==-1&&(h=[u.AnnotationType.createAnnotation(u.AnnotationType.ANNOTATION_MATCHING_BRACKET,a,a+1),u.AnnotationType.createAnnotation(u.AnnotationType.ANNOTATION_CURRENT_BRACKET,i,i+1)]);this._bracketAnnotations=h;this.annotationModel.replaceAnnotations(b,h)}},_onMouseDown:function(a){if(a.clickCount===2){var b=this.view,c=b.getModel(),d=b.getOffsetAtLocation(a.x,
a.y);if(d>0){var e=d-1,f=c;c.getBaseModel&&(e=c.mapOffset(e),f=c.getBaseModel());e=this._findMatchingBracket(f,e);e!==-1&&(a.preventDefault(),a=e,c.getBaseModel&&(a=c.mapOffset(a,!0)),d>a&&(d--,a++),b.setSelection(a,d))}}},_onModelChanged:function(a){var b=a.start,c=a.removedCharCount,d=a.addedCharCount-c,e=this.view,a=e.getModel(),f=a.getBaseModel?a.getBaseModel():a,c=b+c,g=f.getCharCount(),h=this.comments.length,i=f.getLineStart(f.getLineAtOffset(b)),j=this._binarySearch(this.comments,i,!0),k=this._binarySearch(this.comments,
c,!1,j-1,h);j<h&&this.comments[j].start<=i&&i<this.comments[j].end?(i=this.comments[j].start,i>b&&(i+=d)):i=j===h&&h>0&&g-d===this.comments[h-1].end?this.comments[h-1].start:i;var m;k<h?(m=this.comments[k].end,m>b&&(m+=d),k+=1):(k=h,m=g);for(var n,g=this._findComments(f.getText(i,m),i),h=j;h<this.comments.length;h++)n=this.comments[h],n.start>b&&(n.start+=d),n.start>b&&(n.end+=d);var o=k-j!==g.length;if(!o)for(h=0;h<g.length;h++){n=this.comments[j+h];var p=g[h];if(n.start!==p.start||n.end!==p.end||
n.type!==p.type){o=!0;break}}h=[j,k-j].concat(g);Array.prototype.splice.apply(this.comments,h);o&&(h=i,n=m,a!==f&&(h=a.mapOffset(h,!0),n=a.mapOffset(n,!0)),e.redrawRange(h,n));if(this.foldingEnabled&&f!==a&&this.annotationModel){e=this.annotationModel;j=e.getAnnotations(i,m);i=[];for(m=[];j.hasNext();)if(n=j.next(),n.type===u.AnnotationType.ANNOTATION_FOLDING){m.push(n);for(h=0;h<g.length;h++)if(n.start===g[h].start&&n.end===g[h].end)break;h===g.length?(i.push(n),n.expand()):(h=n.start,k=n.end,h>
b&&(h-=d),k>b&&(k-=d),h<=b&&b<k&&h<=c&&c<k&&(h=f.getLineAtOffset(n.start),k=f.getLineAtOffset(n.end),h!==k?n.expanded||(n.expand(),e.modifyAnnotation(n)):e.removeAnnotation(n)))}b=[];for(h=0;h<g.length;h++){n=g[h];for(d=0;d<m.length;d++)if(m[d].start===n.start&&m[d].end===n.end)break;d===m.length&&(n=this._createFoldingAnnotation(a,f,n.start,n.end))&&b.push(n)}e.replaceAnnotations(i,b)}}};return{TextStyler:e}});
define("orion/editor/edit","orion/editor/textView,orion/editor/textModel,orion/editor/textTheme,orion/editor/projectionTextModel,orion/editor/eventTarget,orion/keyBinding,orion/editor/rulers,orion/editor/annotations,orion/editor/tooltip,orion/editor/undoStack,orion/editor/textDND,orion/editor/editor,orion/editor/editorFeatures,orion/editor/contentAssist,orion/editor/cssContentAssist,orion/editor/htmlContentAssist,orion/editor/jsTemplateContentAssist,orion/editor/AsyncStyler,orion/editor/mirror,orion/editor/textMateStyler,orion/editor/htmlGrammar,examples/editor/textStyler".split(","),function(u,
r,p,i,b,e,d,g,h,a,f,o,m,n,t,q,c,k,s,j,x,l){function y(a){var b=a.firstChild;if(b&&b.tagName==="TEXTAREA")return b.value;var b=a.ownerDocument,c=b.defaultView||b.parentWindow;if(!c.getSelection)return a.innerText||a.textContent;b=b.createRange();b.selectNode(a);var a=c.getSelection(),c=[],d;for(d=0;d<a.rangeCount;d++)c.push(a.getRangeAt(d));a.removeAllRanges();a.addRange(b);b=a.toString();a.removeAllRanges();for(d=0;d<c.length;d++)a.addRange(c[d]);return b}function H(a){if(a.substring(0,12)==="data-editor-")return a=
a.substring(12),a=a.replace(/-([a-z])/ig,function(a,b){return b.toUpperCase()})}function D(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}function I(a,b){var c={};D(c,b);for(var d,e=0,f=a.attributes,g=f.length;e<g;e++){d=f.item(e);var h=H(d.nodeName);if(h){d=d.nodeValue;if(d==="true"||d==="false")d=d==="true";c[h]=d}}return c}function J(a){var b=a.ownerDocument,b=b.defaultView||b.parentWindow,c;if(b.getComputedStyle)c=b.getComputedStyle(a,null).getPropertyValue("height");else if(a.currentStyle)c=
a.currentStyle.height;return parseInt(c,10)||0}function E(a){var b=a.parent;b||(b="editor");typeof b==="string"&&(b=(a.document||document).getElementById(b));if(!b&&a.className){var d=(a.document||document).getElementsByClassName(a.className);if(d){a.className=void 0;for(var e=[],f=0;f<d.length;f++)a.parent=d[f],e.push(E(a));return e}}if(!b)throw"no parent";a=I(b,a);if(typeof a.theme==="string"){var d=p.TextTheme.getTheme(a.theme),f=a.theme.lastIndexOf("/"),g=a.theme;f!==-1&&(g=g.substring(f+1));
g.substring(g.length-4)===".css"&&(g=g.substring(0,g.length-4));d.setThemeClass(g,{href:a.theme});a.theme=d}var h;a.readonly||(e={createContentAssistMode:function(a){h=new n.ContentAssist(a.getTextView());a=new n.ContentAssistWidget(h);return new n.ContentAssistMode(h,a)}});e=new o.Editor({textViewFactory:function(){return new u.TextView({parent:b,model:new i.ProjectionTextModel(new r.TextModel("")),tabSize:a.tabSize?a.tabSize:4,readonly:a.readonly,fullSelection:a.fullSelection,tabMode:a.tabMode,
expandTab:a.expandTab,themeClass:a.themeClass,theme:a.theme,wrapMode:a.wrapMode})},undoStackFactory:new m.UndoFactory,annotationFactory:new m.AnnotationFactory,lineNumberRulerFactory:new m.LineNumberRulerFactory,foldingRulerFactory:new m.FoldingRulerFactory,textDNDFactory:new m.TextDNDFactory,contentAssistFactory:e,keyBindingFactory:function(a,b,c,d){var e=new m.TextActions(a,c);b.push(e);a=new m.SourceCodeActions(a,c,d);b.push(a)},statusReporter:a.statusReporter,domNode:b});d=a.contents;d===void 0&&
(d=y(b));d||(d="");e.installTextView();e.setLineNumberRulerVisible(a.showLinesRuler===void 0||a.showLinesRuler);e.setAnnotationRulerVisible(a.showAnnotationRuler===void 0||a.showFoldingRuler);e.setOverviewRulerVisible(a.showOverviewRuler===void 0||a.showOverviewRuler);e.setFoldingRulerVisible(a.showFoldingRuler===void 0||a.showFoldingRuler);e.setInput(a.title,null,d);({styler:null,highlight:function(b,c){if(this.styler)this.styler.destroy(),this.styler=null;if(b){var d=c.getTextView(),e=c.getAnnotationModel();
switch(b){case "js":case "java":case "css":this.styler=new l.TextStyler(d,b,e);c.setFoldingRulerVisible(a.showFoldingRuler===void 0||a.showFoldingRuler);break;case "html":this.styler=new j.TextMateStyler(d,new x.HtmlGrammar)}}}}).highlight(a.lang,e);if(h){var k=new t.CssContentAssistProvider,q=new c.JSTemplateContentAssistProvider;h.addEventListener("Activating",function(){/css$/.test(a.lang)?h.setProviders([k]):/js$/.test(a.lang)&&h.setProviders([q])})}if(J(b)<=50)d=e.getTextView().computeSize().height,
b.style.height=d+"px";return e}var F=this.orion?this.orion.editor:void 0;if(F)for(var B=0;B<arguments.length;B++)D(F,arguments[B]);return E});define(["orion/editor/edit"],function(u){return u});