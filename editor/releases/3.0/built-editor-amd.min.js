/*

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
 Felipe Heidrich (IBM Corporation) - initial API and implementation
 Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
 Felipe Heidrich (IBM Corporation) - initial API and implementation
 Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
 Felipe Heidrich (IBM Corporation) - initial API and implementation
 Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
 Felipe Heidrich (IBM Corporation) - initial API and implementation
 Silenio Quarti (IBM Corporation) - initial API and implementation
 Mihai Sucan (Mozilla Foundation) - fix for Bug#334583 Bug#348471 Bug#349485 Bug#350595 Bug#360726 Bug#361180 Bug#362835 Bug#362428 Bug#362286 Bug#354270 Bug#361474 Bug#363945 Bug#366312 Bug#370584

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
 Felipe Heidrich (IBM Corporation) - initial API and implementation
 Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
 Felipe Heidrich (IBM Corporation) - initial API and implementation
 Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
 Felipe Heidrich (IBM Corporation) - initial API and implementation
 Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
 Felipe Heidrich (IBM Corporation) - initial API and implementation
 Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2009, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 Copyright (c) 2012 VMware, Inc.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation
 Andrew Eisenberg - rename to jsTemplateContentAssist.js

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation 

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation 

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation 

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation
 Alex Lakatos - fix for bug#369781

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation
 RequireJS i18n 1.0.0 Copyright (c) 2010-2011, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/jrburke/requirejs for details

 Copyright (c) 2011 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation
*/
define("orion/util",[],function(){var s=navigator.userAgent,p=parseFloat(s.split("MSIE")[1])||void 0,o=parseFloat(s.split("Firefox/")[1]||s.split("Minefield/")[1])||void 0,j=s.indexOf("Opera")!==-1,b=parseFloat(s.split("Chrome/")[1])||void 0,f=s.indexOf("Safari")!==-1&&!b,e=parseFloat(s.split("WebKit/")[1])||void 0,h=s.indexOf("Android")!==-1,g=s.indexOf("iPad")!==-1,s=s.indexOf("iPhone")!==-1,a=g||s,c=navigator.platform.indexOf("Mac")!==-1,q=navigator.platform.indexOf("Win")!==-1,l=navigator.platform.indexOf("Linux")!==
-1;return{formatMessage:function(a){var b=arguments;return a.replace(/\$\{([^\}]+)\}/g,function(a,d){return b[(d<<0)+1]})},createElement:function(a,b){return a.createElementNS?a.createElementNS("http://www.w3.org/1999/xhtml",b):a.createElement(b)},isIE:p,isFirefox:o,isOpera:j,isChrome:b,isSafari:f,isWebkit:e,isAndroid:h,isIPad:g,isIPhone:s,isIOS:a,isMac:c,isWindows:q,isLinux:l,platformDelimiter:q?"\r\n":"\n"}});
define("orion/editor/eventTarget",[],function(){function s(){}s.addMixin=function(p){var o=s.prototype,j;for(j in o)o.hasOwnProperty(j)&&(p[j]=o[j])};s.prototype={addEventListener:function(p,o,j){if(!this._eventTypes)this._eventTypes={};var b=this._eventTypes[p];b||(b=this._eventTypes[p]={level:0,listeners:[]});b.listeners.push({listener:o,useCapture:j})},dispatchEvent:function(p){var o=p.type;this._dispatchEvent("pre"+o,p);this._dispatchEvent(o,p);this._dispatchEvent("post"+o,p)},_dispatchEvent:function(p,
o){var j=this._eventTypes?this._eventTypes[p]:null;if(j){var b=j.listeners;try{if(j.level++,b)for(var f=0,e=b.length;f<e;f++)if(b[f]){var h=b[f].listener;typeof h==="function"?h.call(this,o):h.handleEvent&&typeof h.handleEvent==="function"&&h.handleEvent(o)}}finally{if(j.level--,j.compact&&j.level===0){for(f=b.length-1;f>=0;f--)b[f]||b.splice(f,1);b.length===0&&delete this._eventTypes[p];j.compact=!1}}}},isListening:function(p){return!this._eventTypes?!1:this._eventTypes[p]!==void 0},removeEventListener:function(p,
o,j){if(this._eventTypes){var b=this._eventTypes[p];if(b){for(var f=b.listeners,e=0,h=f.length;e<h;e++){var g=f[e];if(g&&g.listener===o&&g.useCapture===j){b.level!==0?(f[e]=null,b.compact=!0):f.splice(e,1);break}}f.length===0&&delete this._eventTypes[p]}}}};return{EventTarget:s}});
define("orion/editor/textModel",["orion/editor/eventTarget","orion/util"],function(s,p){function o(j,b){this._lastLineIndex=-1;this._text=[""];this._lineOffsets=[0];this.setText(j);this.setLineDelimiter(b)}o.prototype={find:function(j){if(this._text.length>1)this._text=[this._text.join("")];var b=j.string,f=b;!j.regex&&b&&(f=b.replace(/([\\$\^*\/+?\.\(\)|{}\[\]])/g,"\\$&"));var e=null,h;if(f){var b=j.reverse,g=j.wrap,a=j.wholeWord,c=j.caseInsensitive,q=j.start||0,l=j.end,j=j.end!==void 0,n="";n.indexOf("g")===
-1&&(n+="g");c&&n.indexOf("i")===-1&&(n+="i");a&&(f="\\b"+f+"\\b");var u=this._text[0],t,d,k=0;j&&(u=u.substring(q,l),k=q);var r=RegExp(f,n);if(b)h=function(){var i=null;for(r.lastIndex=0;;){d=r.lastIndex;t=r.exec(u);if(d===r.lastIndex)return null;if(t){if(!(t.index<q)){if(!g||i)break;q=u.length}i={start:t.index+k,end:r.lastIndex+k}}else break}if(i)q=i.start;return i};else{if(!j)r.lastIndex=q;h=function(){for(;;){d=r.lastIndex;t=r.exec(u);if(d===r.lastIndex)break;if(t)return{start:t.index+k,end:r.lastIndex+
k};if(!(d!==0&&g))break}return null}}e=h()}return{next:function(){var d=e;d&&(e=h());return d},hasNext:function(){return e!==null}}},getCharCount:function(){for(var j=0,b=0;b<this._text.length;b++)j+=this._text[b].length;return j},getLine:function(j,b){var f=this.getLineCount();if(!(0<=j&&j<f))return null;var e=this._lineOffsets[j];if(j+1<f){f=this.getText(e,this._lineOffsets[j+1]);if(b)return f;for(var e=f.length,h;(h=f.charCodeAt(e-1))===10||h===13;)e--;return f.substring(0,e)}else return this.getText(e)},
getLineAtOffset:function(j){var b=this.getCharCount();if(!(0<=j&&j<=b))return-1;var f=this.getLineCount();if(j===b)return f-1;var e,h,g=this._lastLineIndex;if(0<=g&&g<f&&(e=this._lineOffsets[g],h=g+1<f?this._lineOffsets[g+1]:b,e<=j&&j<h))return g;for(var a=f,c=-1;a-c>1;)if(g=Math.floor((a+c)/2),e=this._lineOffsets[g],h=g+1<f?this._lineOffsets[g+1]:b,j<=e)a=g;else if(j<h){a=g;break}else c=g;return this._lastLineIndex=a},getLineCount:function(){return this._lineOffsets.length},getLineDelimiter:function(){return this._lineDelimiter},
getLineEnd:function(j,b){var f=this.getLineCount();if(!(0<=j&&j<f))return-1;if(j+1<f){f=this._lineOffsets[j+1];if(b)return f;for(var e=this.getText(Math.max(this._lineOffsets[j],f-2),f),h=e.length,g;(g=e.charCodeAt(h-1))===10||g===13;)h--;return f-(e.length-h)}else return this.getCharCount()},getLineStart:function(j){return!(0<=j&&j<this.getLineCount())?-1:this._lineOffsets[j]},getText:function(j,b){j===void 0&&(j=0);b===void 0&&(b=this.getCharCount());if(j===b)return"";for(var f=0,e=0,h;e<this._text.length;){h=
this._text[e].length;if(j<=f+h)break;f+=h;e++}for(var g=f,a=e;e<this._text.length;){h=this._text[e].length;if(b<=f+h)break;f+=h;e++}if(a===e)return this._text[a].substring(j-g,b-f);g=this._text[a].substring(j-g);f=this._text[e].substring(0,b-f);return g+this._text.slice(a+1,e).join("")+f},onChanging:function(j){return this.dispatchEvent(j)},onChanged:function(j){return this.dispatchEvent(j)},setLineDelimiter:function(j,b){j==="auto"&&(j=void 0,this.getLineCount()>1&&(j=this.getText(this.getLineEnd(0),
this.getLineEnd(0,!0))));this._lineDelimiter=j?j:p.platformDelimiter;if(b){var f=this.getLineCount();if(f>1){for(var e=Array(f),h=0;h<f;h++)e[h]=this.getLine(h);this.setText(e.join(this._lineDelimiter))}}},setText:function(j,b,f){j===void 0&&(j="");b===void 0&&(b=0);f===void 0&&(f=this.getCharCount());if(!(b===f&&j==="")){for(var e=this.getLineAtOffset(b),h=this.getLineAtOffset(f),g=b,a=f-b,c=h-e,q=j.length,l=0,n=this.getLineCount(),u=0,t=0,d=0,k=[];;){u!==-1&&u<=d&&(u=j.indexOf("\r",d));t!==-1&&
t<=d&&(t=j.indexOf("\n",d));if(t===-1&&u===-1)break;d=u!==-1&&t!==-1?u+1===t?t+1:(u<t?u:t)+1:u!==-1?u+1:t+1;k.push(b+d);l++}this.onChanging({type:"Changing",text:j,start:g,removedCharCount:a,addedCharCount:q,removedLineCount:c,addedLineCount:l});k.length===0&&(u=this.getLineStart(e),h=h+1<n?this.getLineStart(h+1):this.getCharCount(),b!==u&&(j=this.getText(u,b)+j,b=u),f!==h&&(j+=this.getText(f,h),f=h));h=q-a;for(u=e+c+1;u<n;u++)this._lineOffsets[u]+=h;e=[e+1,c].concat(k);Array.prototype.splice.apply(this._lineOffsets,
e);for(h=k=0;h<this._text.length;){u=this._text[h].length;if(b<=k+u)break;k+=u;h++}n=k;for(e=h;h<this._text.length;){u=this._text[h].length;if(f<=k+u)break;k+=u;h++}u=this._text[h];b=this._text[e].substring(0,b-n);f=u.substring(f-k);e=[e,h-e+1];b&&e.push(b);j&&e.push(j);f&&e.push(f);Array.prototype.splice.apply(this._text,e);if(this._text.length===0)this._text=[""];this.onChanged({type:"Changed",start:g,removedCharCount:a,addedCharCount:q,removedLineCount:c,addedLineCount:l})}}};s.EventTarget.addMixin(o.prototype);
return{TextModel:o}});
define("orion/editor/textTheme",["require","orion/editor/eventTarget","orion/util"],function(s,p,o){function j(b){b=b||{};this._document=b.document||document}var b={};j.getTheme=function(f){var f=f||"default",e=b[f];e||(e=b[f]=new j);return e};j.prototype={buildStyleSheet:function(b,e){function h(a,e,l){g.push("."+b+" ."+a+" {");g.push("\t"+(l?"background-color":"color")+": "+e+";");g.push("}")}var g=[];g.push("");var a=e.fontFamily,a=a==="sans serif"?'"Menlo", "Consolas", "Vera Mono", "monospace"':"monospace";
g.push("."+b+" {");g.push("\tfont-family: "+a+";");g.push("\tfont-size: "+e.fontSize+";");g.push("\tcolor: "+e.text+";");g.push("}");g.push("."+b+".textview {");g.push("\tbackground-color: "+e.background+";");g.push("}");h("ruler.annotations",e.annotationRuler,!0);h("ruler.lines",e.annotationRuler,!0);h("ruler.folding",e.annotationRuler,!0);h("ruler.overview",e.overviewRuler,!0);h("rulerLines",e.lineNumber,!1);h("rulerLines.even",e.lineNumberEven,!1);h("rulerLines.odd",e.lineNumberOdd,!1);h("annotationLine.currentLine",
e.currentLine,!0);h("entity-name-tag",e.keyword,!1);h("entity-other-attribute-name",e.attribute,!1);h("string-quoted",e.string,!1);h("token_keyword",e.keyword,!1);h("token_string",e.string,!1);h("token_singleline_comment",e.comment,!1);h("token_multiline_comment",e.comment,!1);h("token_doc_comment",e.comment,!1);h("token_doc_html_markup",e.comment,!1);return g.join("\n")},_createStyle:function(b,e,h,g){var a=this._document,b="orion-theme-"+b,c=a.getElementById(b);if(c){if(g||c.firstChild.data===e)return;
c.removeChild(c.firstChild);c.appendChild(a.createTextNode(e))}else g?(c=o.createElement(a,"link"),c.rel="stylesheet",c.type="text/css",c.href=e,c.addEventListener("load",function(){h()})):(c=o.createElement(a,"style"),c.appendChild(a.createTextNode(e))),c.id=b,(a.getElementsByTagName("head")[0]||a.documentElement).appendChild(c);g||h()},getThemeClass:function(){return this._themeClass},_load:function(b,e,h){if(b)if(typeof e==="string")this._createStyle(b,e,h);else if(e=e.href,e.substring(e.length-
4)!==".css"&&(e+=".css"),/^https?:\/\//i.test(e))this._createStyle(b,s.toUrl(e),h,!0);else{var g=this;s(["text!"+e],function(a){g._createStyle(b,a,h,!1)})}else h()},setThemeClass:function(b,e){var h=this,g=h._themeClass;h._themeClass=b;this._load(b,e,function(){h.onThemeChanged({type:"ThemeChanged",oldValue:g,newValue:h.getThemeClass()})})},onThemeChanged:function(b){return this.dispatchEvent(b)}};p.EventTarget.addMixin(j.prototype);return{TextTheme:j}});
define("orion/editor/projectionTextModel",["orion/editor/textModel","orion/editor/eventTarget"],function(s,p){function o(j){this._model=j;this._projections=[]}o.prototype={addProjection:function(j){if(j){var b=this._model,f=this._projections;j._lineIndex=b.getLineAtOffset(j.start);j._lineCount=b.getLineAtOffset(j.end)-j._lineIndex;var e=j.text;e||(e="");j._model=typeof e==="string"?new s.TextModel(e,b.getLineDelimiter()):e;var b=this.mapOffset(j.start,!0),e=j.end-j.start,h=j._lineCount,g=j._model.getCharCount(),
a=j._model.getLineCount()-1;this.onChanging({type:"Changing",text:j._model.getText(),start:b,removedCharCount:e,addedCharCount:g,removedLineCount:h,addedLineCount:a});var c=this._binarySearch(f,j.start);f.splice(c,0,j);this.onChanged({type:"Changed",start:b,removedCharCount:e,addedCharCount:g,removedLineCount:h,addedLineCount:a})}},getProjections:function(){return this._projections.slice(0)},getBaseModel:function(){return this._model},mapOffset:function(j,b){var f=this._projections,e=0,h,g;if(b){for(h=
0;h<f.length;h++){g=f[h];if(g.start>j)break;if(g.end>j)return-1;e+=g._model.getCharCount()-(g.end-g.start)}return j+e}for(h=0;h<f.length;h++){g=f[h];if(g.start>j-e)break;var a=g._model.getCharCount();if(g.start+a>j-e)return-1;e+=a-(g.end-g.start)}return j-e},removeProjection:function(j){var b,f=0;for(b=0;b<this._projections.length;b++){var e=this._projections[b];if(e===j){j=e;break}f+=e._model.getCharCount()-(e.end-e.start)}if(b<this._projections.length){var e=this._model,f=j.start+f,h=j.end-j.start,
g=j._lineCount,a=j._model.getCharCount(),c=j._model.getLineCount()-1;this.onChanging({type:"Changing",text:e.getText(j.start,j.end),start:f,removedCharCount:a,addedCharCount:h,removedLineCount:c,addedLineCount:g});this._projections.splice(b,1);this.onChanged({type:"Changed",start:f,removedCharCount:a,addedCharCount:h,removedLineCount:c,addedLineCount:g})}},_binarySearch:function(j,b){for(var f=j.length,e=-1,h;f-e>1;)h=Math.floor((f+e)/2),b<=j[h].start?f=h:e=h;return f},getCharCount:function(){for(var j=
this._model.getCharCount(),b=this._projections,f=0;f<b.length;f++){var e=b[f];j+=e._model.getCharCount()-(e.end-e.start)}return j},getLine:function(j,b){if(j<0)return null;var f=this._model,e=this._projections,h=0,g=[],a=0,c,q,l;for(c=0;c<e.length;c++){l=e[c];if(l._lineIndex>=j-h)break;q=l._model.getLineCount()-1;if(l._lineIndex+q>=j-h)if(a=j-(l._lineIndex+h),a<q)return l._model.getLine(a,b);else g.push(l._model.getLine(q));a=l.end;h+=q-l._lineCount}for(a=Math.max(a,f.getLineStart(j-h));c<e.length;c++){l=
e[c];if(l._lineIndex>j-h)break;g.push(f.getText(a,l.start));q=l._model.getLineCount()-1;if(l._lineIndex+q>j-h)return g.push(l._model.getLine(0,b)),g.join("");g.push(l._model.getText());a=l.end;h+=q-l._lineCount}e=f.getLineEnd(j-h,b);a<e&&g.push(f.getText(a,e));return g.join("")},getLineAtOffset:function(j){for(var b=this._model,f=this._projections,e=0,h=0,g=0;g<f.length;g++){var a=f[g];if(a.start>j-e)break;var c=a._model.getCharCount();if(a.start+c>j-e){f=j-(a.start+e);h+=a._model.getLineAtOffset(f);
e+=f;break}h+=a._model.getLineCount()-1-a._lineCount;e+=c-(a.end-a.start)}return b.getLineAtOffset(j-e)+h},getLineCount:function(){for(var j=this._projections,b=this._model.getLineCount(),f=0;f<j.length;f++){var e=j[f];b+=e._model.getLineCount()-1-e._lineCount}return b},getLineDelimiter:function(){return this._model.getLineDelimiter()},getLineEnd:function(j,b){if(j<0)return-1;for(var f=this._model,e=this._projections,h=0,g=0,a=0;a<e.length;a++){var c=e[a];if(c._lineIndex>j-h)break;var q=c._model.getLineCount()-
1;if(c._lineIndex+q>j-h)return c._model.getLineEnd(j-(c._lineIndex+h),b)+c.start+g;g+=c._model.getCharCount()-(c.end-c.start);h+=q-c._lineCount}return f.getLineEnd(j-h,b)+g},getLineStart:function(j){if(j<0)return-1;for(var b=this._model,f=this._projections,e=0,h=0,g=0;g<f.length;g++){var a=f[g];if(a._lineIndex>=j-e)break;var c=a._model.getLineCount()-1;if(a._lineIndex+c>=j-e)return a._model.getLineStart(j-(a._lineIndex+e))+a.start+h;h+=a._model.getCharCount()-(a.end-a.start);e+=c-a._lineCount}return b.getLineStart(j-
e)+h},getText:function(j,b){j===void 0&&(j=0);var f=this._model,e=this._projections,h=0,g=[],a,c,q;for(a=0;a<e.length;a++){c=e[a];if(c.start>j-h)break;q=c._model.getCharCount();if(c.start+q>j-h)if(b!==void 0&&c.start+q>b-h)return c._model.getText(j-(c.start+h),b-(c.start+h));else g.push(c._model.getText(j-(c.start+h))),j=c.end+h+q-(c.end-c.start);h+=q-(c.end-c.start)}var l=j-h;if(b!==void 0){for(;a<e.length;a++){c=e[a];if(c.start>b-h)break;g.push(f.getText(l,c.start));q=c._model.getCharCount();if(c.start+
q>b-h)return g.push(c._model.getText(0,b-(c.start+h))),g.join("");g.push(c._model.getText());l=c.end;h+=q-(c.end-c.start)}g.push(f.getText(l,b-h))}else{for(;a<e.length;a++)c=e[a],g.push(f.getText(l,c.start)),g.push(c._model.getText()),l=c.end;g.push(f.getText(l))}return g.join("")},_onChanging:function(j,b,f,e,h,g){for(var a=this._model,c=this._projections,q,l=0,n,u=b+f;q<c.length;q++){f=c[q];if(f.start>b)break;l+=f._model.getCharCount()-(f.end-f.start)}b+=l;for(var t=q;q<c.length;q++){f=c[q];if(f.start>
u)break;l+=f._model.getCharCount()-(f.end-f.start);n+=f._model.getLineCount()-1-f._lineCount}f=u+l;l=q;this.onChanging(b,f-b,e,h+n,g);c.splice(c,l-t);for(j=j.length-(f-b);q<c.length;q++)f=c[q],f.start+=j,f.end+=j,f._lineIndex=a.getLineAtOffset(f.start)},onChanging:function(j){return this.dispatchEvent(j)},onChanged:function(j){return this.dispatchEvent(j)},setLineDelimiter:function(j){this._model.setLineDelimiter(j)},setText:function(j,b,f){j===void 0&&(j="");b===void 0&&(b=0);var e=b,h=f,g=this._model,
a=this._projections,c=0,q=0,l,n,u,t,d,k=0;for(l=0;l<a.length;l++){n=a[l];if(n.start>b-c)break;u=n._model.getCharCount();if(n.start+u>b-c)if(f!==void 0&&n.start+u>f-c){n._model.setText(j,b-(n.start+c),f-(n.start+c));return}else k=n._model.getLineCount()-1-n._model.getLineAtOffset(b-(n.start+c)),t={projection:n,start:b-(n.start+c)},b=n.end+c+u-(n.end-n.start);q+=n._model.getLineCount()-1-n._lineCount;c+=u-(n.end-n.start)}b-=c;var r=l,k=g.getLineAtOffset(b)+q-k;if(f!==void 0)for(;l<a.length;l++){n=a[l];
if(n.start>f-c)break;u=n._model.getCharCount();if(n.start+u>f-c){q+=n._model.getLineAtOffset(f-(n.start+c));u=f-(n.start+c);f=n.end+c;d={projection:n,end:u};break}q+=n._model.getLineCount()-1-n._lineCount;c+=u-(n.end-n.start)}else{for(;l<a.length;l++)n=a[l],q+=n._model.getLineCount()-1-n._lineCount,c+=n._model.getCharCount()-(n.end-n.start);f=h=g.getCharCount()+c}f-=c;n=g.getLineAtOffset(f)+q;h-=e;for(var q=n-k,k=j.length,i=u=n=c=0;;){n!==-1&&n<=i&&(n=j.indexOf("\r",i));u!==-1&&u<=i&&(u=j.indexOf("\n",
i));if(u===-1&&n===-1)break;i=n!==-1&&u!==-1?n+1===u?u+1:(n<u?n:u)+1:n!==-1?n+1:u+1;c++}this.onChanging({type:"Changing",text:j,start:e,removedCharCount:h,addedCharCount:k,removedLineCount:q,addedLineCount:c});g.setText(j,b,f);if(t)n=t.projection,n._model.setText("",t.start);if(d)n=d.projection,n._model.setText("",0,d.end),n.start=n.end,n._lineCount=0;a.splice(r,l-r);for(j=j.length-(f-b);l<a.length;l++)n=a[l],n.start+=j,n.end+=j,n._lineIndex=g.getLineAtOffset(n.start);this.onChanged({type:"Changed",
start:e,removedCharCount:h,addedCharCount:k,removedLineCount:q,addedLineCount:c})}};p.EventTarget.addMixin(o.prototype);return{ProjectionTextModel:o}});
define("orion/keyBinding",["orion/util"],function(s){function p(o,j,b,f,e){this.keyCode=typeof o==="string"?o.toUpperCase().charCodeAt(0):o;this.mod1=j!==void 0&&j!==null?j:!1;this.mod2=b!==void 0&&b!==null?b:!1;this.mod3=f!==void 0&&f!==null?f:!1;this.mod4=e!==void 0&&e!==null?e:!1}p.prototype={match:function(o){return this.keyCode===o.keyCode?this.mod1!==(s.isMac?o.metaKey:o.ctrlKey)?!1:this.mod2!==o.shiftKey?!1:this.mod3!==o.altKey?!1:s.isMac&&this.mod4!==o.ctrlKey?!1:!0:!1},equals:function(o){return!o?
!1:this.keyCode!==o.keyCode?!1:this.mod1!==o.mod1?!1:this.mod2!==o.mod2?!1:this.mod3!==o.mod3?!1:this.mod4!==o.mod4?!1:!0}};return{KeyBinding:p}});
define("orion/editor/textView",["orion/editor/textModel","orion/keyBinding","orion/editor/eventTarget","orion/editor/textTheme","orion/util"],function(s,p,o,j,b){function f(d,k,r,i){typeof d.addEventListener==="function"?d.addEventListener(k,r,i===!0):d.attachEvent("on"+k,r)}function e(d,k,r){if(r){k.className="";for(var r=k.attributes,i=r.length;i-- >0;)(!b.isIE||b.isIE>=9||b.isIE<9&&r[i].specified)&&k.removeAttribute(r[i].name)}if(d){if(d.styleClass)k.className=d.styleClass;if(r=d.style)for(var a in r)r.hasOwnProperty(a)&&
(k.style[a]=r[a]);if(d=d.attributes)for(var m in d)d.hasOwnProperty(m)&&k.setAttribute(m,d[m])}}function h(d){return d instanceof Array?d.slice(0):d}function g(d,k){if(d===k)return!0;if(d&&!k||!d&&k)return!1;if(d&&d.constructor===String||k&&k.constructor===String)return!1;if(d instanceof Array||k instanceof Array){if(!(d instanceof Array&&k instanceof Array))return!1;if(d.length!==k.length)return!1;for(var r=0;r<d.length;r++)if(!g(d[r],k[r]))return!1;return!0}if(!(d instanceof Object)||!(k instanceof
Object))return!1;for(r in d)if(d.hasOwnProperty(r)){if(!k.hasOwnProperty(r))return!1;if(!g(d[r],k[r]))return!1}for(r in k)if(!d.hasOwnProperty(r))return!1;return!0}function a(d,k,r){for(var i=0,a=0,m=0,b=d.length;m<b;){i!==-1&&i<=m&&(i=d.indexOf("\r",m));a!==-1&&a<=m&&(a=d.indexOf("\n",m));var c=m,e;if(a===-1&&i===-1){k(d.substring(m));break}i!==-1&&a!==-1?i+1===a?(e=i,m=a+1):(e=i<a?i:a,m=(i<a?i:a)+1):i!==-1?(e=i,m=i+1):(e=a,m=a+1);k(d.substring(c,e));r()}}function c(d){var k,r,i,a,m=d.ownerDocument.defaultView||
d.ownerDocument.parentWindow;if(m.getComputedStyle)d=m.getComputedStyle(d,null),k=d.getPropertyValue("padding-left"),r=d.getPropertyValue("padding-top"),i=d.getPropertyValue("padding-right"),a=d.getPropertyValue("padding-bottom");else if(d.currentStyle)k=d.currentStyle.paddingLeft,r=d.currentStyle.paddingTop,i=d.currentStyle.paddingRight,a=d.currentStyle.paddingBottom;return{left:parseInt(k,10)||0,top:parseInt(r,10)||0,right:parseInt(i,10)||0,bottom:parseInt(a,10)||0}}function q(d){var k,r,i,a,m=
d._trim;if(!m){var m=c(d),b=d.ownerDocument.defaultView||d.ownerDocument.parentWindow;if(b.getComputedStyle)a=b.getComputedStyle(d,null),k=a.getPropertyValue("border-left-width"),r=a.getPropertyValue("border-top-width"),i=a.getPropertyValue("border-right-width"),a=a.getPropertyValue("border-bottom-width");else if(d.currentStyle)k=d.currentStyle.borderLeftWidth,r=d.currentStyle.borderTopWidth,i=d.currentStyle.borderRightWidth,a=d.currentStyle.borderBottomWidth;k=parseInt(k,10)||0;r=parseInt(r,10)||
0;i=parseInt(i,10)||0;a=parseInt(a,10)||0;m.left+=k;m.top+=r;m.right+=i;m.bottom+=a;d._trim=m}return m}function l(d,k,r){this.start=d;this.end=k;this.caret=r}function n(d){this.left=d.left;this.top=d.top;this.right=d.right;this.bottom=d.bottom}function u(d,k,r){this.view=d;this.lineIndex=k;this._lineDiv=r}function t(d){this._init(d||{})}l.prototype={clone:function(){return new l(this.start,this.end,this.caret)},collapse:function(){this.caret?this.end=this.start:this.start=this.end},extend:function(d){this.caret?
this.start=d:this.end=d;if(this.start>this.end)d=this.start,this.start=this.end,this.end=d,this.caret=!this.caret},setCaret:function(d){this.end=this.start=d;this.caret=!1},getCaret:function(){return this.caret?this.start:this.end},toString:function(){return"start="+this.start+" end="+this.end+(this.caret?" caret is at start":" caret is at end")},isEmpty:function(){return this.start===this.end},equals:function(d){return this.caret===d.caret&&this.start===d.start&&this.end===d.end}};n.prototype={toString:function(){return"{l="+
this.left+", t="+this.top+", r="+this.right+", b="+this.bottom+"}"}};u.prototype={create:function(d,k){if(!this._lineDiv){var r=this._lineDiv=this._createLine(d,k,this.lineIndex);r._line=this;return r}},_createLine:function(d,k,r){var i=this.view,a=i._model,m=a.getLine(r),c=a.getLineStart(r),f={type:"LineStyle",textView:i,lineIndex:r,lineText:m,lineStart:c};if(m.length<2E3)i.onLineStyle(f);a=k||b.createElement(d.ownerDocument,"div");if(!k||!g(k.viewStyle,f.style)){e(f.style,a,k);if(k)k._trim=null;
a.viewStyle=f.style;a.setAttribute("role","presentation")}a.lineIndex=r;r=[];this._createRanges(f.ranges,m,0,m.length,c,{tabOffset:0,ranges:r});m=" ";!i._fullSelection&&b.isIE<9&&(m="\ufeff");b.isWebkit&&(m="\u200c");r.push({text:m,style:i._metrics.largestFontStyle,ignoreChars:1});var l,q,h,n,j,m=i=0,u,t;if(k){if(q=k.modelChangedEvent)q.removedLineCount===0&&q.addedLineCount===0?(t=q.start-c,u=q.addedCharCount-q.removedCharCount):t=-1,k.modelChangedEvent=void 0;q=k.firstChild}for(c=0;c<r.length;c++){l=
r[c];n=l.text;i+=n.length;f=l.style;if(q)if(j=q.firstChild.data,h=q.viewStyle,j===n&&g(f,h)){m+=j.length;q._rectsCache=void 0;l=q=q.nextSibling;continue}else for(;q;){if(t!==-1){h=i;h>=t&&(h-=u);j=(j=q.firstChild.data)?j.length:0;if(m+j>h)break;m+=j}h=q.nextSibling;a.removeChild(q);q=h}l=this._createSpan(a,n,f,l.ignoreChars);q?a.insertBefore(l,q):a.appendChild(l);if(k)k.lineWidth=void 0}if(k)for(d=l?l.nextSibling:null;d;)h=d.nextSibling,k.removeChild(d),d=h;else d.appendChild(a);return a},_createRanges:function(d,
k,r,i,a,m){if(!(r>=i)){if(d)for(var b=0;b<d.length;b++){var c=d[b];if(!(c.end<=a+r)){var e=Math.max(a+r,c.start)-a;if(e>=i)break;var f=Math.min(a+i,c.end)-a;if(e<f){e=Math.max(r,e);f=Math.min(i,f);for(r<e&&this._createRange(k,r,e,null,m);b+1<d.length&&d[b+1].start-a===f&&g(c.style,d[b+1].style);)c=d[b+1],f=Math.min(a+i,c.end)-a,b++;this._createRange(k,e,f,c.style,m);r=f}}}r<i&&this._createRange(k,r,i,null,m)}},_createRange:function(d,k,r,i,a){if(!(k>=r)){var m=this.view._customTabSize;if(m&&m!==8)for(var b=
d.indexOf("\t",k);b!==-1&&b<r;){k<b&&(k={text:d.substring(k,b),style:i},a.ranges.push(k),a.tabOffset+=k.text.length);k=m-a.tabOffset%m;if(k>0){for(var c="\u00a0",e=1;e<k;e++)c+=" ";k={text:c,style:i,ignoreChars:k-1};a.ranges.push(k);a.tabOffset+=k.text.length}k=b+1;b=d.indexOf("\t",k)}k<r&&(k={text:d.substring(k,r),style:i},a.ranges.push(k),a.tabOffset+=k.text.length)}},_createSpan:function(d,k,r,i){var a=r&&r.tagName==="A";if(a)d.hasLink=!0;var a=a&&this.view._linksVisible?"a":"span",m=d.ownerDocument,
d=b.createElement(d.ownerDocument,a);d.appendChild(m.createTextNode(k));e(r,d);if(a==="A"){var c=this.view,l=this._getWindow();f(d,"click",function(d){return c._handleLinkClick(d?d:l.event)},!1)}d.viewStyle=r;if(i)d.ignoreChars=i;return d},_ensureCreated:function(){return this._lineDiv?this._lineDiv:this._createdDiv=this.create(this.view._clientDiv,null)},getBoundingClientRect:function(d,k){var r=this._ensureCreated(),i=this.view;if(d===void 0)return this._getLineBoundingClientRect(r,!0);var a=i._model,
m=r.ownerDocument,c=this.lineIndex,e=null;if(d<a.getLineEnd(c)){a=a.getLineStart(c);for(c=r.firstChild;c;){var f=c.firstChild,l=f.length;c.ignoreChars&&(l-=c.ignoreChars);if(a+l>d){e=d-a;if(i._isRangeRects)m=m.createRange(),m.setStart(f,e),m.setEnd(f,e+1),e=new n(m.getBoundingClientRect());else if(b.isIE)m=m.body.createTextRange(),m.moveToElementText(c),m.collapse(),m.moveEnd("character",e+1),m.moveStart("character",e),e=new n(m.getBoundingClientRect());else{var q=f.data;c.removeChild(f);c.appendChild(m.createTextNode(q.substring(0,
e)));var g=b.createElement(m,"span");g.appendChild(m.createTextNode(q.substring(e,e+1)));c.appendChild(g);c.appendChild(m.createTextNode(q.substring(e+1)));e=new n(g.getBoundingClientRect());c.innerHTML="";c.appendChild(f);this._createdDiv||(m=i._getSelection(),(a<=m.start&&m.start<a+l||a<=m.end&&m.end<a+l)&&i._updateDOMSelection())}b.isIE&&(m=r.ownerDocument.defaultView||r.ownerDocument.parentWindow,r=m.screen.logicalXDPI/m.screen.deviceXDPI,m=m.screen.logicalYDPI/m.screen.deviceYDPI,e.left*=r,e.right*=
r,e.top*=m,e.bottom*=m);break}a+=l;c=c.nextSibling}}r=this.getBoundingClientRect();if(!e)i._wrapMode?(i=this.getClientRects(),e=i[i.length-1],e.left=e.right,e.left+=r.left,e.top+=r.top,e.right+=r.left,e.bottom+=r.top):(e=new n(r),e.left=e.right);if(k||k===void 0)e.left-=r.left,e.top-=r.top,e.right-=r.left,e.bottom-=r.top;return e},_getClientRects:function(d,k){var r,i,a,m;if(!d._rectsCache){r=d.getClientRects();i=Array(r.length);for(m=0;m<r.length;m++)a=i[m]=new n(r[m]),a.left-=k.left,a.top-=k.top,
a.right-=k.left,a.bottom-=k.top;d._rectsCache=i}r=d._rectsCache;i=[r.length];for(m=0;m<r.length;m++)i[m]=new n(r[m]);return i},getClientRects:function(d){if(!this.view._wrapMode)return[this.getBoundingClientRect()];for(var k=this._ensureCreated(),r=[],i=k.firstChild,a,m=k.getBoundingClientRect();i;){for(var b=this._getClientRects(i,m),k=0;k<b.length;k++){var c=b[k],e;if(c.top!==c.bottom){var f=c.top+(c.bottom-c.top)/2;for(e=0;e<r.length;e++)if(a=r[e],a.top<=f&&f<a.bottom)break;if(e===r.length)r.push(c);
else{if(c.left<a.left)a.left=c.left;if(c.top<a.top)a.top=c.top;if(c.right>a.right)a.right=c.right;if(c.bottom>a.bottom)a.bottom=c.bottom}}}i=i.nextSibling}return d!==void 0?r[d]:r},_getLineBoundingClientRect:function(d,k){var r=new n(d.getBoundingClientRect());if(!this.view._wrapMode){r.right=r.left;for(var i=d.lastChild;i&&i.ignoreChars===i.firstChild.length;)i=i.previousSibling;if(i)i=i.getBoundingClientRect(),r.right=i.right+q(d).right}k&&(i=q(d),r.left+=i.left,r.right-=i.right);return r},getLineCount:function(){return!this.view._wrapMode?
1:this.getClientRects().length},getLineIndex:function(d){if(!this.view._wrapMode)return 0;for(var k=this.getClientRects(),d=this.getBoundingClientRect(d),d=d.top+(d.bottom-d.top)/2,r=0;r<k.length;r++)if(k[r].top<=d&&d<k[r].bottom)return r;return k.length-1},getLineStart:function(d){if(!this.view._wrapMode||d===0)return this.view._model.getLineStart(d);var k=this.getClientRects();return this.getOffset(k[d].left+1,k[d].top+1)},getOffset:function(d,k){var r=this.view,i=r._model,a=this.lineIndex,m=i.getLineStart(a),
i=i.getLineEnd(a);if(m===i)return m;var c=this._ensureCreated(),a=this.getBoundingClientRect(),e,f;if(r._wrapMode){e=this.getClientRects();if(k<e[0].top)k=e[0].top;for(var l=0;l<e.length;l++)if(f=e[l],f.top<=k&&k<f.bottom)break;if(d<f.left)d=f.left;d>f.right&&(d=f.right-1)}else d<0&&(d=0),d>a.right-a.left&&(d=a.right-a.left);var q=c.ownerDocument,l=q.defaultView||q.parentWindow,g=b.isIE?l.screen.logicalXDPI/l.screen.deviceXDPI:1,h=b.isIE?l.screen.logicalYDPI/l.screen.deviceYDPI:1,l=m,n=c.firstChild;
a:for(;n;){var j=n.firstChild,c=j.length;n.ignoreChars&&(c-=n.ignoreChars);var u,t,o;e=this._getClientRects(n,a);for(var p=0;p<e.length;p++)if(f=e[p],f.left<=d&&d<f.right&&(!r._wrapMode||f.top<=k&&k<f.bottom)){if(b.isIE||r._isRangeRects){for(var q=r._isRangeRects?q.createRange():q.body.createTextRange(),p=c,s=-1;p-s>1;){var B=Math.floor((p+s)/2);f=s+1;e=B===c-1&&n.ignoreChars?j.length:B+1;r._isRangeRects?(q.setStart(j,f),q.setEnd(j,e)):(q.moveToElementText(n),q.move("character",f),q.moveEnd("character",
e-f));e=q.getClientRects();for(var H=!1,D=0;D<e.length;D++)if(f=e[D],u=f.left*g-a.left,o=f.right*g-a.left,t=f.top*h-a.top,f=f.bottom*h-a.top,u<=d&&d<o&&(!r._wrapMode||t<=k&&k<f)){H=!0;break}H?p=B:s=B}l+=p;f=p;e=p===c-1&&n.ignoreChars?j.length:Math.min(p+1,j.length);r._isRangeRects?(q.setStart(j,f),q.setEnd(j,e)):(q.moveToElementText(n),q.move("character",f),q.moveEnd("character",e-f));f=q.getClientRects()[0];u=f.left*g-a.left;o=f.right*g-a.left;d>u+(o-u)/2&&l++}else{f=[];for(g=0;g<c;g++)f.push("<span>"),
g===c-1?f.push(j.data.substring(g)):f.push(j.data.substring(g,g+1)),f.push("</span>");n.innerHTML=f.join("");for(g=n.firstChild;g;){f=g.getBoundingClientRect();u=f.left-a.left;o=f.right-a.left;if(u<=d&&d<o){d>u+(o-u)/2&&l++;break}l++;g=g.nextSibling}if(!this._createdDiv)n.innerHTML="",n.appendChild(j),a=r._getSelection(),(l<=a.start&&a.start<l+c||l<=a.end&&a.end<l+c)&&r._updateDOMSelection()}break a}l+=c;n=n.nextSibling}return Math.min(i,Math.max(m,l))},getNextOffset:function(d,k,r){return k==="line"?
(k=this.view._model,d=k.getLineAtOffset(d),r>0?k.getLineEnd(d):k.getLineStart(d)):k==="wordend"?this._getNextOffset_W3C(d,k,r):b.isIE?this._getNextOffset_IE(d,k,r):this._getNextOffset_W3C(d,k,r)},_getNextOffset_W3C:function(d,k,r){function a(d){return 33<=d&&d<=47||58<=d&&d<=64||91<=d&&d<=94||d===96||123<=d&&d<=126}if(k==="word"||k==="wordend"){var b=this.view._model,m=b.getLineAtOffset(d),c=b.getLine(m),e=b.getLineStart(m),m=b.getLineEnd(m),b=c.length;d-=e;var f,l;if(r>0){if(d===b)return m;f=c.charCodeAt(d);
l=a(f);r=!l&&!(f===32||f===9);for(d++;d<b;){f=c.charCodeAt(d);m=a(f);if(k==="wordend"){if(!m&&l)break}else if(m&&!l)break;f=!m&&!(f===32||f===9);if(k==="wordend"){if(!f&&r)break}else if(f&&!r)break;r=f;l=m;d++}}else{if(d===0)return e;d--;f=c.charCodeAt(d);l=a(f);for(r=!l&&!(f===32||f===9);0<d;){f=c.charCodeAt(d-1);m=a(f);if(k==="wordend"){if(m&&!l)break}else if(!m&&l)break;f=!m&&!(f===32||f===9);if(k==="wordend"){if(f&&!r)break}else if(!f&&r)break;r=f;l=m;d--}}return e+d}return d+r},_getNextOffset_IE:function(d,
k,r){var a=this._ensureCreated(),b=this.view._model,m=this.lineIndex,c=0,e;e=b.getLineStart(m);var f=a.ownerDocument;if(d===b.getLineEnd(m))c=f.body.createTextRange(),c.moveToElementText(a.lastChild),e=c.text.length,c.moveEnd(k,r),c=d+c.text.length-e;else if(d===e&&r<0)c=e;else for(a=a.firstChild;a;){b=a.firstChild.length;a.ignoreChars&&(b-=a.ignoreChars);if(e+b>d){c=f.body.createTextRange();d===e&&r<0?c.moveToElementText(a.previousSibling):(c.moveToElementText(a),c.collapse(),c.moveEnd("character",
d-e));e=c.text.length;c.moveEnd(k,r);c=d+c.text.length-e;break}e=b+e;a=a.nextSibling}return c},destroy:function(){var d=this._createdDiv;if(d)d.parentNode.removeChild(d),this._createdDiv=null}};t.prototype={addRuler:function(d,k){d.setView(this);var r=this._rulers;if(k!==void 0){var a,b;for(a=0,b=0;a<r.length&&b<k;a++)d.getLocation()===r[a].getLocation()&&b++;r.splice(b,0,d);k=b}else r.push(d);this._createRuler(d,k);this._update()},computeSize:function(){var d=0,k=0,r=this._model,a=this._clientDiv;
if(!a)return{width:d,height:k};var c=a.style.width;if(b.isWebkit)a.style.width="0x7fffffffpx";for(var r=r.getLineCount(),m=0;m<r;m++){var e=this._getLine(m),f=e.getBoundingClientRect(),d=Math.max(d,f.right-f.left);k+=f.bottom-f.top;e.destroy()}if(b.isWebkit)a.style.width=c;a=this._getViewPadding();d+=a.right+a.left;k+=a.bottom+a.top;return{width:d,height:k}},convert:function(d,k,a){if(this._clientDiv){var i=this._getScroll(),b=this._getViewPadding(),m=this._viewDiv.getBoundingClientRect();k==="document"&&
(d.x!==void 0&&(d.x+=-i.x+m.left+b.left),d.y!==void 0&&(d.y+=-i.y+m.top+b.top));a==="document"&&(d.x!==void 0&&(d.x+=i.x-m.left-b.left),d.y!==void 0&&(d.y+=i.y-m.top-b.top));return d}},destroy:function(){for(var d=0;d<this._rulers.length;d++)this._rulers[d].setView(null);this.rulers=null;this._destroyView();this.onDestroy({type:"Destroy"});this._actions=this._keyBindings=this._doubleClickSelection=this._selection=this._theme=this._model=this._parent=null},focus:function(){this._clientDiv&&(this._updateDOMSelection(),
b.isOpera&&this._clientDiv.blur(),this._clientDiv.focus(),this._updateDOMSelection())},hasFocus:function(){return this._hasFocus},getActionDescription:function(d){if(d=this._actions[d])return d.actionDescription},getActions:function(d){var k=[],a=this._actions,i;for(i in a)a.hasOwnProperty(i)&&(d||!a[i].defaultHandler)&&k.push(i);return k},getBottomIndex:function(d){return!this._clientDiv?0:this._getBottomIndex(d)},getBottomPixel:function(){return!this._clientDiv?0:this._getScroll().y+this._getClientHeight()},
getCaretOffset:function(){return this._getSelection().getCaret()},getClientArea:function(){if(!this._clientDiv)return{x:0,y:0,width:0,height:0};var d=this._getScroll();return{x:d.x,y:d.y,width:this._getClientWidth(),height:this._getClientHeight()}},getHorizontalPixel:function(){return!this._clientDiv?0:this._getScroll().x},getKeyBindings:function(d){for(var k=[],a=this._keyBindings,i=0;i<a.length;i++)a[i].actionID===d&&k.push(a[i].keyBinding);return k},getLineHeight:function(d){return!this._clientDiv?
0:this._getLineHeight(d)},getLineIndex:function(d){return!this._clientDiv?0:this._getLineIndex(d)},getLinePixel:function(d){return!this._clientDiv?0:this._getLinePixel(d)},getLocationAtOffset:function(d){if(!this._clientDiv)return{x:0,y:0};var k=this._model,d=Math.min(Math.max(0,d),k.getCharCount()),k=k.getLineAtOffset(d),a=this._getLine(k),d=a.getBoundingClientRect(d);a.destroy();a=d.left;k=this._getLinePixel(k)+d.top;return{x:a,y:k}},getOptions:function(){var d;if(arguments.length===0)d=this._defaultOptions();
else if(arguments.length===1){if(d=arguments[0],typeof d==="string")return h(this["_"+d])}else{d={};for(var k in arguments)arguments.hasOwnProperty(k)&&(d[arguments[k]]=void 0)}for(var a in d)d.hasOwnProperty(a)&&(d[a]=h(this["_"+a]));return d},getModel:function(){return this._model},getOffsetAtLocation:function(d,k){if(!this._clientDiv)return 0;var a=this._getLineIndex(k),i=this._getLine(a),a=i.getOffset(d,k-this._getLinePixel(a));i.destroy();return a},getRulers:function(){return this._rulers.slice(0)},
getSelection:function(){var d=this._getSelection();return{start:d.start,end:d.end}},getText:function(d,k){return this._model.getText(d,k)},getTopIndex:function(d){return!this._clientDiv?0:this._getTopIndex(d)},getTopPixel:function(){return!this._clientDiv?0:this._getScroll().y},invokeAction:function(d,k){if(this._clientDiv){var a=this._actions[d];if(a){if(!k&&a.handler&&a.handler())return;if(a.defaultHandler)return a.defaultHandler()}return!1}},isDestroyed:function(){return!this._clientDiv},onContextMenu:function(d){return this.dispatchEvent(d)},
onDragStart:function(d){return this.dispatchEvent(d)},onDrag:function(d){return this.dispatchEvent(d)},onDragEnd:function(d){return this.dispatchEvent(d)},onDragEnter:function(d){return this.dispatchEvent(d)},onDragOver:function(d){return this.dispatchEvent(d)},onDragLeave:function(d){return this.dispatchEvent(d)},onDrop:function(d){return this.dispatchEvent(d)},onDestroy:function(d){return this.dispatchEvent(d)},onLineStyle:function(d){return this.dispatchEvent(d)},onModelChanged:function(d){return this.dispatchEvent(d)},
onModelChanging:function(d){return this.dispatchEvent(d)},onModify:function(d){return this.dispatchEvent(d)},onMouseDown:function(d){return this.dispatchEvent(d)},onMouseUp:function(d){return this.dispatchEvent(d)},onMouseMove:function(d){return this.dispatchEvent(d)},onMouseOver:function(d){return this.dispatchEvent(d)},onMouseOut:function(d){return this.dispatchEvent(d)},onSelection:function(d){return this.dispatchEvent(d)},onScroll:function(d){return this.dispatchEvent(d)},onVerify:function(d){return this.dispatchEvent(d)},
onFocus:function(d){return this.dispatchEvent(d)},onBlur:function(d){return this.dispatchEvent(d)},redraw:function(){if(!(this._redrawCount>0)){var d=this._model.getLineCount();this.redrawRulers(0,d);this.redrawLines(0,d)}},redrawRulers:function(d,k){if(!(this._redrawCount>0))for(var a=this.getRulers(),i=0;i<a.length;i++)this.redrawLines(d,k,a[i])},redrawLines:function(d,k,a){if(!(this._redrawCount>0)&&(d===void 0&&(d=0),k===void 0&&(k=this._model.getLineCount()),d!==k)){var i=this._clientDiv;if(i){if(a)for(var b=
(a.getLocation()==="left"?this._leftDiv:this._rightDiv).firstChild.rows[0].cells,m=0;m<b.length;m++)if(b[m].firstChild._ruler===a){i=b[m].firstChild;break}a?i.rulerChanged=!0:this._lineHeight&&this._resetLineHeight(d,k);if(!a||a.getOverview()==="page")for(i=i.firstChild;i;){b=i.lineIndex;if(d<=b&&b<k)i.lineChanged=!0;i=i.nextSibling}if(!a&&!this._wrapMode&&d<=this._maxLineIndex&&this._maxLineIndex<k)this._checkMaxLineIndex=this._maxLineIndex,this._maxLineIndex=-1,this._maxLineWidth=0;this._queueUpdate()}}},
redrawRange:function(d,k){if(!(this._redrawCount>0)){var a=this._model;d===void 0&&(d=0);k===void 0&&(k=a.getCharCount());var i=a.getLineAtOffset(d),a=a.getLineAtOffset(Math.max(d,k-1))+1;this.redrawLines(i,a)}},removeRuler:function(d){for(var k=this._rulers,a=0;a<k.length;a++)if(k[a]===d){k.splice(a,1);d.setView(null);this._destroyRuler(d);this._update();break}},resize:function(){this._clientDiv&&this._handleResize(null)},setAction:function(d,k,a){if(d){var i=this._actions,b=i[d];b||(b=i[d]={});
b.handler=k;b.actionDescription=a}},setKeyBinding:function(d,k){for(var a=this._keyBindings,i=0;i<a.length;i++){var b=a[i];if(b.keyBinding.equals(d)){k?b.actionID=k:b.predefined?b.actionID=null:a.splice(i,1);return}}k&&a.push({keyBinding:d,actionID:k})},setCaretOffset:function(d,k){var a=this._model.getCharCount(),d=Math.max(0,Math.min(d,a));this._setSelection(new l(d,d,!1),k===void 0||k)},setHorizontalPixel:function(d){this._clientDiv&&(d=Math.max(0,d),this._scrollView(d-this._getScroll().x,0))},
setRedraw:function(d){d?--this._redrawCount===0&&this.redraw():this._redrawCount++},setModel:function(d){if(d&&d!==this._model){this._model.removeEventListener("preChanging",this._modelListener.onChanging);this._model.removeEventListener("postChanged",this._modelListener.onChanged);var k=this._model.getLineCount(),a=this._model.getCharCount(),i=d.getLineCount(),b=d.getCharCount(),m={type:"ModelChanging",text:d.getText(),start:0,removedCharCount:a,addedCharCount:b,removedLineCount:k,addedLineCount:i};
this.onModelChanging(m);this._model=d;m={type:"ModelChanged",start:0,removedCharCount:a,addedCharCount:b,removedLineCount:k,addedLineCount:i};this.onModelChanged(m);this._model.addEventListener("preChanging",this._modelListener.onChanging);this._model.addEventListener("postChanged",this._modelListener.onChanged);this._reset();this._update()}},setOptions:function(d){var k=this._defaultOptions(),a;for(a in d)if(d.hasOwnProperty(a)){var i=d[a];if(!g(this["_"+a],i)){var b=k[a]?k[a].update:null;b?b.call(this,
i):this["_"+a]=h(i)}}},setSelection:function(d,k,a){var i=d>k;if(i)var b=d,d=k,k=b;b=this._model.getCharCount();d=Math.max(0,Math.min(d,b));k=Math.max(0,Math.min(k,b));this._setSelection(new l(d,k,i),a===void 0||a)},setText:function(d,k,a){var i=k===void 0&&a===void 0;k===void 0&&(k=0);a===void 0&&(a=this._model.getCharCount());this._modifyContent({text:d,start:k,end:a,_code:!0},!i);if(i)this._columnX=-1,this._setSelection(new l(0,0,!1),!0),b.isFirefox&&this._fixCaret()},setTopIndex:function(d){this._clientDiv&&
this._scrollView(0,this._getLinePixel(Math.max(0,d))-this._getScroll().y)},setTopPixel:function(d){this._clientDiv&&this._scrollView(0,Math.max(0,d)-this._getScroll().y)},showSelection:function(){return this._showCaret(!0)},update:function(d,k){this._clientDiv&&(d&&this._updateStyle(),k===void 0||k?this._update():this._queueUpdate())},_handleRootMouseDown:function(d){if(b.isFirefox&&d.which===1)this._clientDiv.contentEditable=!1,this._ignoreBlur=(this._overlayDiv||this._clientDiv).draggable=!0;var k=
this._overlayDiv||this._clientDiv;if(b.isIE<9)k=this._viewDiv;for(var a=d.target?d.target:d.srcElement;a;){if(k===a)return;a=a.parentNode}d.preventDefault&&d.preventDefault();d.stopPropagation&&d.stopPropagation();if(!this._isW3CEvents){var i=this;this._getWindow().setTimeout(function(){i._clientDiv.focus()},0)}},_handleRootMouseUp:function(d){if(b.isFirefox&&d.which===1)this._clientDiv.contentEditable=!0,(this._overlayDiv||this._clientDiv).draggable=!1,this._fixCaret(),this._ignoreBlur=!1},_handleBlur:function(){if(!this._ignoreBlur){this._hasFocus=
!1;if(b.isIE<9&&!this._getSelection().isEmpty()){var d=this._rootDiv,k=b.createElement(d.ownerDocument,"div");d.appendChild(k);d.removeChild(k)}if(this._selDiv1)if(this._selDiv1.style.background="lightgray",this._selDiv2.style.background="lightgray",this._selDiv3.style.background="lightgray",d=this._getWindow(),k=this._selDiv1.ownerDocument,d.getSelection){k=d.getSelection();for(d=k.anchorNode;d;){if(d===this._clientDiv){k.rangeCount>0&&k.removeAllRanges();break}d=d.parentNode}}else if(k.selection){this._ignoreSelect=
!1;for(d=k.selection.createRange().parentElement();d;){if(d===this._clientDiv){k.selection.empty();break}d=d.parentNode}this._ignoreSelect=!0}if(!this._ignoreFocus)this.onBlur({type:"Blur"})}},_handleContextMenu:function(d){b.isIE&&this._lastMouseButton===3&&this._updateDOMSelection();var k=!1;if(this.isListening("ContextMenu"))k=this._createMouseEvent("ContextMenu",d),k.screenX=d.screenX,k.screenY=d.screenY,this.onContextMenu(k),k=k.defaultPrevented;if(k)return d.preventDefault&&d.preventDefault(),
!1},_handleCopy:function(d){if(!this._ignoreCopy&&this._doCopy(d))return d.preventDefault&&d.preventDefault(),!1},_handleCut:function(d){if(this._doCut(d))return d.preventDefault&&d.preventDefault(),!1},_handleDataModified:function(){this._startIME()},_handleDblclick:function(d){this._lastMouseTime=d.timeStamp?d.timeStamp:(new Date).getTime();if(this._clickCount!==2)this._clickCount=2,this._handleMouse(d)},_handleDragStart:function(d){if(b.isFirefox){var k=this;this._getWindow().setTimeout(function(){k._clientDiv.contentEditable=
!0;k._clientDiv.draggable=!1;k._ignoreBlur=!1},0)}if(this.isListening("DragStart")&&this._dragOffset!==-1)this._isMouseDown=!1,this.onDragStart(this._createMouseEvent("DragStart",d)),this._dragOffset=-1;else return d.preventDefault&&d.preventDefault(),!1},_handleDrag:function(d){if(this.isListening("Drag"))this.onDrag(this._createMouseEvent("Drag",d))},_handleDragEnd:function(d){this._dropTarget=!1;this._dragOffset=-1;if(this.isListening("DragEnd"))this.onDragEnd(this._createMouseEvent("DragEnd",
d));b.isFirefox&&(this._fixCaret(),d.dataTransfer.dropEffect==="none"&&!d.dataTransfer.mozUserCancelled&&this._fixCaret())},_handleDragEnter:function(d){var k=!0;this._dropTarget=!0;this.isListening("DragEnter")&&(k=!1,this.onDragEnter(this._createMouseEvent("DragEnter",d)));if(b.isWebkit||k)return d.preventDefault&&d.preventDefault(),!1},_handleDragOver:function(d){var k=!0;this.isListening("DragOver")&&(k=!1,this.onDragOver(this._createMouseEvent("DragOver",d)));if(b.isWebkit||k){if(k)d.dataTransfer.dropEffect=
"none";d.preventDefault&&d.preventDefault();return!1}},_handleDragLeave:function(d){this._dropTarget=!1;if(this.isListening("DragLeave"))this.onDragLeave(this._createMouseEvent("DragLeave",d))},_handleDrop:function(d){this._dropTarget=!1;if(this.isListening("Drop"))this.onDrop(this._createMouseEvent("Drop",d));d.preventDefault&&d.preventDefault();return!1},_handleFocus:function(){this._hasFocus=!0;b.isIOS&&this._lastTouchOffset!==void 0?(this.setCaretOffset(this._lastTouchOffset,!0),this._lastTouchOffset=
void 0):this._updateDOMSelection();if(this._selDiv1){var d=this._highlightRGB;this._selDiv1.style.background=d;this._selDiv2.style.background=d;this._selDiv3.style.background=d}if(!this._ignoreFocus)this.onFocus({type:"Focus"})},_handleKeyDown:function(d){var k=!1;switch(d.keyCode){case 16:case 17:case 18:case 91:k=!0;break;default:this._setLinksVisible(!1)}if(d.keyCode===229){if(this._readonly)return d.preventDefault&&d.preventDefault(),!1;k=!0;b.isSafari&&b.isMac&&d.ctrlKey&&(k=!1);k&&this._startIME()}else k||
this._commitIME();if((b.isMac||b.isLinux)&&b.isFirefox<4||b.isOpera)return this._keyDownEvent=d,!0;if(this._doAction(d))return d.preventDefault?(d.preventDefault(),d.stopPropagation()):(d.cancelBubble=!0,d.returnValue=!1,d.keyCode=0),!1},_handleKeyPress:function(d){if(b.isMac&&b.isWebkit&&(63232<=d.keyCode&&d.keyCode<=63487||d.keyCode===13||d.keyCode===8))return d.preventDefault&&d.preventDefault(),!1;if(((b.isMac||b.isLinux)&&b.isFirefox<4||b.isOpera)&&this._doAction(this._keyDownEvent))return d.preventDefault&&
d.preventDefault(),!1;var k=b.isMac?d.metaKey:d.ctrlKey;if(d.charCode!==void 0&&k)switch(d.charCode){case 99:case 118:case 120:return!0}k=!1;if(b.isMac){if(d.ctrlKey||d.metaKey)k=!0}else if(b.isFirefox){if(d.ctrlKey||d.altKey)k=!0}else d.ctrlKey^d.altKey&&(k=!0);if(!k&&(k=b.isOpera?d.which:d.charCode!==void 0?d.charCode:d.keyCode,k>31))return this._doContent(String.fromCharCode(k)),d.preventDefault&&d.preventDefault(),!1},_handleKeyUp:function(d){(b.isMac?d.metaKey:d.ctrlKey)||this._setLinksVisible(!1);
d.keyCode===13&&this._commitIME()},_handleLinkClick:function(d){if(!(b.isMac?d.metaKey:d.ctrlKey))return d.preventDefault&&d.preventDefault(),!1},_handleMouse:function(d){var k=this._getWindow(),a=!0,i=k;if(b.isIE||b.isFirefox&&!this._overlayDiv)i=this._clientDiv;if(this._overlayDiv){if(this._hasFocus)this._ignoreFocus=!0;var c=this;k.setTimeout(function(){c.focus();c._ignoreFocus=!1},0)}this._clickCount===1?(a=this._setSelectionTo(d.clientX,d.clientY,d.shiftKey,!b.isOpera&&this._hasFocus&&this.isListening("DragStart")))&&
this._setGrab(i):(this._isW3CEvents&&this._setGrab(i),this._doubleClickSelection=null,this._setSelectionTo(d.clientX,d.clientY,d.shiftKey),this._doubleClickSelection=this._getSelection());return a},_handleMouseDown:function(d){if(this._linksVisible)if((d.target||d.srcElement).tagName!=="A")this._setLinksVisible(!1);else return;this._commitIME();var k=d.which;k||(d.button===4&&(k=2),d.button===2&&(k=3),d.button===1&&(k=1));var a=k!==2&&d.timeStamp?d.timeStamp:(new Date).getTime(),i=a-this._lastMouseTime,
c=Math.abs(this._lastMouseX-d.clientX),m=Math.abs(this._lastMouseY-d.clientY),e=this._lastMouseButton===k;this._lastMouseX=d.clientX;this._lastMouseY=d.clientY;this._lastMouseTime=a;this._lastMouseButton=k;if(k===1)this._isMouseDown=!0,e&&i<=this._clickTime&&c<=this._clickDist&&m<=this._clickDist?this._clickCount++:this._clickCount=1;if(this.isListening("MouseDown")&&(a=this._createMouseEvent("MouseDown",d),this.onMouseDown(a),a.defaultPrevented)){d.preventDefault();return}if(k===1&&this._handleMouse(d)&&
(b.isIE>=9||b.isOpera||b.isChrome||b.isSafari||b.isFirefox&&!this._overlayDiv))this._hasFocus||this.focus(),d.preventDefault();b.isFirefox&&this._lastMouseButton===3&&this._updateDOMSelection()},_handleMouseOver:function(d){if(this.isListening("MouseOver"))this.onMouseOver(this._createMouseEvent("MouseOver",d))},_handleMouseOut:function(d){if(this.isListening("MouseOut"))this.onMouseOut(this._createMouseEvent("MouseOut",d))},_handleMouseMove:function(d){var k=this._isClientDiv(d);if(this.isListening("MouseMove")&&
k)this.onMouseMove(this._createMouseEvent("MouseMove",d));if(!this._dropTarget){var a=this._linksVisible||this._lastMouseMoveX!==d.clientX||this._lastMouseMoveY!==d.clientY;this._lastMouseMoveX=d.clientX;this._lastMouseMoveY=d.clientY;this._setLinksVisible(a&&!this._isMouseDown&&(b.isMac?d.metaKey:d.ctrlKey));if(!this._isW3CEvents){if(d.button===0)return this._setGrab(null),!0;if(!this._isMouseDown&&d.button===1&&(this._clickCount&1)!==0&&k)return this._clickCount=2,this._handleMouse(d,this._clickCount)}if(this._isMouseDown&&
this._dragOffset===-1){var k=d.clientX,d=d.clientY,i=this._getViewPadding(),c=this._viewDiv.getBoundingClientRect(),m=this._getClientWidth(),e=this._getClientHeight(),a=c.left+i.left,f=c.top+i.top,m=c.left+i.left+m,i=c.top+i.top+e,c=this._model,e=c.getLineAtOffset(this._getSelection().getCaret());d<f&&e!==0?this._doAutoScroll("up",k,d-f):d>i&&e!==c.getLineCount()-1?this._doAutoScroll("down",k,d-i):k<a&&!this._wrapMode?this._doAutoScroll("left",k-a,d):k>m&&!this._wrapMode?this._doAutoScroll("right",
k-m,d):(this._endAutoScroll(),this._setSelectionTo(k,d,!0))}}},_isClientDiv:function(d){for(var k=this._overlayDiv||this._clientDiv,d=d.target?d.target:d.srcElement;d;){if(k===d)return!0;d=d.parentNode}return!1},_createMouseEvent:function(d,k){var a=this.convert({x:k.clientX,y:k.clientY},"page","document");return{type:d,event:k,clickCount:this._clickCount,x:a.x,y:a.y,preventDefault:function(){this.defaultPrevented=!0}}},_handleMouseUp:function(d){var k=d.which?d.button===0:d.button===1;if(this.isListening("MouseUp")&&
(this._isClientDiv(d)||k&&this._isMouseDown))this.onMouseUp(this._createMouseEvent("MouseUp",d));if(!this._linksVisible&&k&&this._isMouseDown){if(this._dragOffset!==-1)k=this._getSelection(),k.extend(this._dragOffset),k.collapse(),this._setSelection(k,!0,!0),this._dragOffset=-1;this._isMouseDown=!1;this._endAutoScroll();this._isW3CEvents&&this._setGrab(null);b.isFirefox&&d.preventDefault()}},_handleMouseWheel:function(d){var k=this._getLineHeight(),a=0,i=0;b.isIE||b.isOpera?i=-d.wheelDelta/40*k:b.isFirefox?
(k=b.isMac?d.detail*3:Math.max(-256,Math.min(256,d.detail))*k,d.axis===d.HORIZONTAL_AXIS?a=k:i=k):b.isMac?(i=a=40,d.wheelDeltaX%120!==0&&(a=1),d.wheelDeltaY%120!==0&&(i=1),a=-d.wheelDeltaX/a,-1<a&&a<0&&(a=-1),0<a&&a<1&&(a=1),i=-d.wheelDeltaY/i,-1<i&&i<0&&(i=-1),0<i&&i<1&&(i=1)):(a=-d.wheelDeltaX,i=-d.wheelDeltaY/120*8*k);if(b.isSafari){for(k=d.target;k&&k.lineIndex===void 0;)k=k.parentNode;this._mouseWheelLine=k}k=this._getScroll();this._scrollView(a,i);a=this._getScroll();if(k.x!==a.x||k.y!==a.y)return d.preventDefault&&
d.preventDefault(),!1},_handlePaste:function(d){if(!this._ignorePaste&&this._doPaste(d)){if(b.isIE){var k=this;this._ignoreFocus=!0;this._getWindow().setTimeout(function(){k._updateDOMSelection();k._ignoreFocus=!1},0)}d.preventDefault&&d.preventDefault();return!1}},_handleResize:function(){var d=this._parent.clientWidth,k=this._parent.clientHeight;if(this._parentWidth!==d||this._parentHeight!==k)this._parentWidth!==d&&this._resetLineHeight(),this._parentWidth=d,this._parentHeight=k,b.isIE<9?this._queueUpdate():
this._update()},_handleRulerEvent:function(d){for(var k=d.target?d.target:d.srcElement,a=k.lineIndex;k&&!k._ruler;){if(a===void 0&&k.lineIndex!==void 0)a=k.lineIndex;k=k.parentNode}k=k?k._ruler:null;if(a===void 0&&k&&k.getOverview()==="document"){var a=this._getClientHeight(),i=this._model.getLineCount(),b=this._getViewPadding(),m=this._viewDiv.getBoundingClientRect(),a=Math.floor((d.clientY-m.top-this._metrics.scrollWidth)*i/(a+b.top+b.bottom-2*this._metrics.scrollWidth));0<=a&&a<i||(a=void 0)}if(k)switch(d.type){case "click":if(k.onClick)k.onClick(a,
d);break;case "dblclick":if(k.onDblClick)k.onDblClick(a,d);break;case "mousemove":if(k.onMouseMove)k.onMouseMove(a,d);break;case "mouseover":if(k.onMouseOver)k.onMouseOver(a,d);break;case "mouseout":if(k.onMouseOut)k.onMouseOut(a,d)}},_handleScroll:function(){var d=this._getScroll(),k=this._hScroll,a=this._vScroll;if(k!==d.x||a!==d.y)this._hScroll=d.x,this._vScroll=d.y,this._commitIME(),this._update(a===d.y),this.onScroll({type:"Scroll",oldValue:{x:k,y:a},newValue:d})},_handleSelectStart:function(d){if(this._ignoreSelect)return d&&
d.preventDefault&&d.preventDefault(),!1},_getModelOffset:function(d,k){if(d){var a;a=d.tagName==="DIV"?d:d.parentNode.parentNode;var i=0,b=a.lineIndex;if(d.tagName!=="DIV")for(a=a.firstChild;a;){var m=a.firstChild;if(m===d){a.ignoreChars&&(i-=a.ignoreChars);i+=k;break}a.ignoreChars&&(i-=a.ignoreChars);i+=m.data.length;a=a.nextSibling}return Math.max(0,i)+this._model.getLineStart(b)}},_updateSelectionFromDOM:function(){var d=this._getWindow().getSelection(),k=this._getModelOffset(d.anchorNode,d.anchorOffset),
d=this._getModelOffset(d.focusNode,d.focusOffset);k===void 0||d===void 0||this._setSelection(new l(k,d),!1,!1)},_handleSelectionChange:function(){if(this._imeOffset===-1)if(b.isAndroid){var d=this._getWindow();this._selTimer&&d.clearTimeout(this._selTimer);var k=this;this._selTimer=d.setTimeout(function(){if(k._clientDiv)k._selTimer=null,k._updateSelectionFromDOM()},250)}else this._updateSelectionFromDOM()},_handleTextInput:function(d){this._imeOffset=-1;if(b.isAndroid){for(var k=this._getWindow().getSelection(),
a=k.anchorNode;a;){if(a.lineIndex!==void 0)break;a=a.parentNode}if(a){var i=this._model,c=a.lineIndex,m=i.getLine(c),e=m,f=0,i=i.getLineStart(c);if(k.rangeCount>0)k.getRangeAt(0).deleteContents(),c=a.ownerDocument.createTextNode(d.data),k.getRangeAt(0).insertNode(c),f=this._getDOMText(a,c),e=f.text,f=f.offset,c.parentNode.removeChild(c);a.lineRemoved=!0;for(a=0;m.charCodeAt(a)===e.charCodeAt(a)&&a<f;)a++;k=m.length-1;for(c=e.length-m.length;m.charCodeAt(k)===e.charCodeAt(k+c)&&k+c>=f+d.data.length;)k--;
k++;m=e.substring(a,k+c);a+=i;k+=i;this._modifyContent({text:m,start:a,end:k,_ignoreDOMSelection:!0},!0)}}else this._doContent(d.data);d.preventDefault()},_handleTouchStart:function(d){this._commitIME();var k=this._getWindow();if(this._touchScrollTimer)this._vScrollDiv.style.display="none",this._hScrollDiv.style.display="none",k.clearInterval(this._touchScrollTimer),this._touchScrollTimer=null;var a=d.touches;if(a.length===1){var a=a[0],i=a.clientX,c=a.clientY;this._touchStartX=i;this._touchStartY=
c;if(b.isAndroid&&(c<a.pageY-k.pageYOffset||i<a.pageX-k.pageXOffset))i=a.pageX-k.pageXOffset,c=a.pageY-k.pageYOffset;k=this.convert({x:i,y:c},"page","document");this._lastTouchOffset=this.getOffsetAtLocation(k.x,k.y);this._touchStartTime=d.timeStamp;this._touching=!0}},_handleTouchMove:function(d){var k=d.touches;if(k.length===1){k=k[0];this._touchCurrentX=k.clientX;this._touchCurrentY=k.clientY;if(!this._touchScrollTimer&&d.timeStamp-this._touchStartTime<200){this._vScrollDiv.style.display="block";
if(!this._wrapMode)this._hScrollDiv.style.display="block";var a=this,i=this._getWindow();this._touchScrollTimer=i.setInterval(function(){var d=0,k=0;if(a._touching)d=a._touchStartX-a._touchCurrentX,k=a._touchStartY-a._touchCurrentY,a._touchSpeedX=d/10,a._touchSpeedY=k/10,a._touchStartX=a._touchCurrentX,a._touchStartY=a._touchCurrentY;else if(Math.abs(a._touchSpeedX)<0.1&&Math.abs(a._touchSpeedY)<0.1){a._vScrollDiv.style.display="none";a._hScrollDiv.style.display="none";i.clearInterval(a._touchScrollTimer);
a._touchScrollTimer=null;return}else d=a._touchSpeedX*10,k=a._touchSpeedY*10,a._touchSpeedX*=0.95,a._touchSpeedY*=0.95;a._scrollView(d,k)},10)}this._touchScrollTimer&&d.preventDefault()}},_handleTouchEnd:function(d){if(d.touches.length===0)this._touching=!1},_doAction:function(d){for(var k=this._keyBindings,a=0;a<k.length;a++){var i=k[a];if(i.keyBinding.match(d)){if(i.actionID&&(d=this._actions[i.actionID]))if(d.handler){if(!d.handler())return d.defaultHandler?typeof d.defaultHandler()==="boolean":
!1}else if(d.defaultHandler)return typeof d.defaultHandler()==="boolean";return!0}}return!1},_doBackspace:function(d){var k=this._getSelection();if(k.isEmpty()){var a=this._model,i=k.getCaret(),b=a.getLineAtOffset(i),m=a.getLineStart(b);if(i===m)b>0&&k.extend(a.getLineEnd(b-1));else{var c=!1;this._expandTab&&d.unit==="character"&&(i-m)%this._tabSize===0&&(c=!/[^ ]/.test(a.getText(m,i)));c?k.extend(i-this._tabSize):(a=this._getLine(b),k.extend(a.getNextOffset(i,d.unit,-1)),a.destroy())}}this._modifyContent({text:"",
start:k.start,end:k.end},!0);return!0},_doContent:function(d){var a=this._getSelection();this._modifyContent({text:d,start:a.start,end:a.end,_ignoreDOMSelection:!0},!0)},_doCopy:function(d){var a=this._getSelection();return!a.isEmpty()?this._setClipboardText(this._getBaseText(a.start,a.end),d):!0},_doCursorNext:function(d){if(!d.select&&this._clearSelection("next"))return!0;var a=this._model,b=this._getSelection(),i=b.getCaret(),c=a.getLineAtOffset(i);i===a.getLineEnd(c)?c+1<a.getLineCount()&&b.extend(a.getLineStart(c+
1)):(a=this._getLine(c),b.extend(a.getNextOffset(i,d.unit,1)),a.destroy());d.select||b.collapse();this._setSelection(b,!0);return!0},_doCursorPrevious:function(d){if(!d.select&&this._clearSelection("previous"))return!0;var a=this._model,b=this._getSelection(),i=b.getCaret(),c=a.getLineAtOffset(i);i===a.getLineStart(c)?c>0&&b.extend(a.getLineEnd(c-1)):(a=this._getLine(c),b.extend(a.getNextOffset(i,d.unit,-1)),a.destroy());d.select||b.collapse();this._setSelection(b,!0);return!0},_doCut:function(d){var a=
this._getSelection();return!a.isEmpty()?(a=this._getBaseText(a.start,a.end),this._doContent(""),this._setClipboardText(a,d)):!0},_doDelete:function(d){var a=this._getSelection();if(a.isEmpty()){var b=this._model,i=a.getCaret(),c=b.getLineAtOffset(i);i===b.getLineEnd(c)?c+1<b.getLineCount()&&a.extend(b.getLineStart(c+1)):(b=this._getLine(c),a.extend(b.getNextOffset(i,d.unit,1)),b.destroy())}this._modifyContent({text:"",start:a.start,end:a.end},!0);return!0},_doEnd:function(d){var a=this._getSelection(),
b=this._model;if(d.ctrl)a.extend(b.getCharCount());else{var i=a.getCaret(),c=b.getLineAtOffset(i);if(this._wrapMode){var m=this._getLine(c),i=m.getLineIndex(i),i=i===m.getLineCount()-1?b.getLineEnd(c):m.getLineStart(i+1)-1;m.destroy()}else i=b.getLineEnd(c);a.extend(i)}d.select||a.collapse();this._setSelection(a,!0);return!0},_doEnter:function(d){var a=this._model,b=this._getSelection();this._doContent(a.getLineDelimiter());if(d&&d.noCursor)b.end=b.start,this._setSelection(b);return!0},_doHome:function(d){var a=
this._getSelection(),b=this._model;if(d.ctrl)a.extend(0);else{var i=a.getCaret(),c=b.getLineAtOffset(i);this._wrapMode?(b=this._getLine(c),i=b.getLineIndex(i),i=b.getLineStart(i),b.destroy()):i=b.getLineStart(c);a.extend(i)}d.select||a.collapse();this._setSelection(a,!0);return!0},_doLineDown:function(d){var a=this._model,c=this._getSelection(),i=c.getCaret(),e=a.getLineAtOffset(i),m=this._getLine(e),f=this._columnX,l=1,q=!1;if(f===-1||d.wholeLine||d.select&&b.isIE)f=d.wholeLine?a.getLineEnd(e+1):
i,f=m.getBoundingClientRect(f).left;(i=m.getLineIndex(i))<m.getLineCount()-1?l=m.getClientRects(i+1).top+1:(q=e===a.getLineCount()-1,e++);q?d.select&&(c.extend(a.getCharCount()),this._setSelection(c,!0,!0)):(m.lineIndex!==e&&(m.destroy(),m=this._getLine(e)),c.extend(m.getOffset(f,l)),d.select||c.collapse(),this._setSelection(c,!0,!0));this._columnX=f;m.destroy();return!0},_doLineUp:function(d){var a=this._model,c=this._getSelection(),i=c.getCaret(),e=a.getLineAtOffset(i),m=this._getLine(e),f=this._columnX,
l=!1,q;if(f===-1||d.wholeLine||d.select&&b.isIE)f=d.wholeLine?a.getLineStart(e-1):i,f=m.getBoundingClientRect(f).left;(i=m.getLineIndex(i))>0?q=m.getClientRects(i-1).top+1:(l=e===0,l||(e--,q=this._getLineHeight(e)-1));l?d.select&&(c.extend(0),this._setSelection(c,!0,!0)):(m.lineIndex!==e&&(m.destroy(),m=this._getLine(e)),c.extend(m.getOffset(f,q)),d.select||c.collapse(),this._setSelection(c,!0,!0));this._columnX=f;m.destroy();return!0},_doPageDown:function(d){var a=this._model,c=this._getSelection(),
i=c.getCaret(),e=a.getLineAtOffset(i),m=a.getLineCount(),f=this._getScroll(),l=this._getClientHeight(),q;if(this._lineHeight){a=this._columnX;f=this._getBoundsAtOffset(i);if(a===-1||d.select&&b.isIE)a=f.left;i=this._getLineIndex(f.top+l);q=this._getLine(i);e=this._getLinePixel(i);i=q.getOffset(a,f.top+l-e);l=q.getBoundingClientRect(i);q.destroy();c.extend(i);d.select||c.collapse();this._setSelection(c,!0,!0,l.top+e-f.top);this._columnX=a;return!0}if(e<m-1){var g=this._getLineHeight(),h=Math.min(m-
e-1,Math.floor(l/g)),h=Math.max(1,h),a=this._columnX;if(a===-1||d.select&&b.isIE)q=this._getLine(e),a=q.getBoundingClientRect(i).left,q.destroy();q=this._getLine(e+h);c.extend(q.getOffset(a,0));q.destroy();d.select||c.collapse();d=m*g;i=f.y+h*g;i+l>d&&(i=d-l);this._setSelection(c,!0,!0,i-f.y);this._columnX=a}return!0},_doPageUp:function(d){var a=this._model,c=this._getSelection(),i=c.getCaret(),e=a.getLineAtOffset(i),m=this._getScroll(),f=this._getClientHeight(),l;if(this._lineHeight){a=this._columnX;
m=this._getBoundsAtOffset(i);if(a===-1||d.select&&b.isIE)a=m.left;i=this._getLineIndex(m.bottom-f);l=this._getLine(i);e=this._getLinePixel(i);i=l.getOffset(a,m.bottom-f-e);f=l.getBoundingClientRect(i);l.destroy();c.extend(i);d.select||c.collapse();this._setSelection(c,!0,!0,f.top+e-m.top);this._columnX=a;return!0}if(e>0){var q=this._getLineHeight(),f=Math.max(1,Math.min(e,Math.floor(f/q))),a=this._columnX;if(a===-1||d.select&&b.isIE)l=this._getLine(e),a=l.getBoundingClientRect(i).left,l.destroy();
l=this._getLine(e-f);c.extend(l.getOffset(a,this._getLineHeight(e-f)-1));l.destroy();d.select||c.collapse();d=Math.max(0,m.y-f*q);this._setSelection(c,!0,!0,d-m.y);this._columnX=a}return!0},_doPaste:function(d){var a=this;return this._getClipboardText(d,function(d){d&&(b.isLinux&&a._lastMouseButton===2&&(new Date).getTime()-a._lastMouseTime<=a._clickTime&&a._setSelectionTo(a._lastMouseX,a._lastMouseY),a._doContent(d))})!==null},_doScroll:function(d){var a=d.type,b=this._model,i=b.getLineCount(),d=
this._getClientHeight(),c=this._getLineHeight();i*=c;var m=this._getScroll().y,e;switch(a){case "textStart":e=0;break;case "textEnd":e=i-d;break;case "pageDown":e=m+d;break;case "pageUp":e=m-d;break;case "centerLine":a=this._getSelection(),e=b.getLineAtOffset(a.start),b=(b.getLineAtOffset(a.end)-e+1)*c,e=e*c-d/2+b/2}e!==void 0&&(e=Math.min(Math.max(0,e),i-d),this._scrollView(0,e-m));return!0},_doSelectAll:function(){var d=this._model,a=this._getSelection();a.setCaret(0);a.extend(d.getCharCount());
this._setSelection(a,!1);return!0},_doTab:function(){if(this._tabMode&&!this._readonly){var d="\t";if(this._expandTab)var a=this._model,d=this._getSelection().getCaret(),b=a.getLineAtOffset(d),a=a.getLineStart(b),d=Array(this._tabSize-(d-a)%this._tabSize+1).join(" ");this._doContent(d);return!0}},_doShiftTab:function(){return!this._tabMode||this._readonly?void 0:!0},_doTabMode:function(){this._tabMode=!this._tabMode;return!0},_doWrapMode:function(){this.setOptions({wrapMode:!this.getOptions("wrapMode")});
return!0},_autoScroll:function(){var d=this._getSelection(),a=this.convert({x:this._autoScrollX,y:this._autoScrollY},"page","document"),b=d.getCaret(),i=this._model.getLineAtOffset(b),c;if(this._autoScrollDir==="up"||this._autoScrollDir==="down")b=this._autoScrollY/this._getLineHeight(),b=b<0?Math.floor(b):Math.ceil(b),c=i,c=Math.max(0,Math.min(this._model.getLineCount()-1,c+b));else if(this._autoScrollDir==="left"||this._autoScrollDir==="right")c=this._getLineIndex(a.y),i=this._getLine(i),a.x+=i.getBoundingClientRect(b,
!1).left,i.destroy();i=this._getLine(c);d.extend(i.getOffset(a.x,a.y-this._getLinePixel(c)));i.destroy();this._setSelection(d,!0)},_autoScrollTimer:function(){this._autoScroll();var d=this;this._autoScrollTimerID=this._getWindow().setTimeout(function(){d._autoScrollTimer()},this._AUTO_SCROLL_RATE)},_calculateLineHeightTimer:function(d){if(this._lineHeight&&!this._calculateLHTimer){var a=this._model.getLineCount(),b=0;if(d){for(var d=0,i=(new Date).getTime(),c=0;b<a;)if(this._lineHeight[b]||(d++,c||
(c=b),this._lineHeight[b]=this._calculateLineHeight(b)),b++,(new Date).getTime()-i>100)break;this.redrawRulers(0,a);this._queueUpdate()}d=this._getWindow();if(b!==a){var m=this;this._calculateLHTimer=d.setTimeout(function(){m._calculateLHTimer=null;m._calculateLineHeightTimer(!0)},0)}else if(this._calculateLHTimer)d.clearTimeout(this._calculateLHTimer),this._calculateLHTimer=void 0}},_calculateLineHeight:function(d){var d=this._getLine(d),a=d.getBoundingClientRect();d.destroy();return Math.max(1,
Math.ceil(a.bottom-a.top))},_calculateMetrics:function(){var d=this._clientDiv,a=d.ownerDocument,f=b.createElement(a,"div");f.style.lineHeight="normal";var i={type:"LineStyle",textView:this,0:0,lineText:this._model.getLine(0),lineStart:0};this.onLineStyle(i);e(i.style,f);f.style.position="fixed";f.style.left="-1000px";var l=b.createElement(a,"span");l.appendChild(a.createTextNode(" "));f.appendChild(l);var m=b.createElement(a,"span");m.style.fontStyle="italic";m.appendChild(a.createTextNode(" "));
f.appendChild(m);var g=b.createElement(a,"span");g.style.fontWeight="bold";g.appendChild(a.createTextNode(" "));f.appendChild(g);i=b.createElement(a,"span");i.style.fontWeight="bold";i.style.fontStyle="italic";i.appendChild(a.createTextNode(" "));f.appendChild(i);d.appendChild(f);var h=f.getBoundingClientRect(),l=l.getBoundingClientRect(),m=m.getBoundingClientRect(),g=g.getBoundingClientRect(),i=i.getBoundingClientRect(),l=l.bottom-l.top,m=m.bottom-m.top,g=g.bottom-g.top,n=i.bottom-i.top,j=0,i=h.bottom-
h.top<=0,h=Math.max(1,h.bottom-h.top);m>l&&(j=1);g>m&&(j=2);n>g&&(j=3);var u;if(j!==0){u={style:{}};if((j&1)!==0)u.style.fontStyle="italic";if((j&2)!==0)u.style.fontWeight="bold"}l=q(f);d.removeChild(f);m=c(this._viewDiv);f=b.createElement(a,"div");f.style.position="fixed";f.style.left="-1000px";f.style.paddingLeft=m.left+"px";f.style.paddingTop=m.top+"px";f.style.paddingRight=m.right+"px";f.style.paddingBottom=m.bottom+"px";f.style.width="100px";f.style.height="100px";g=b.createElement(a,"div");
g.style.width="100%";g.style.height="100%";f.appendChild(g);d.appendChild(f);a=f.getBoundingClientRect();m=g.getBoundingClientRect();f.style.overflow="hidden";g.style.height="200px";g=f.clientWidth;f.style.overflow="scroll";n=f.clientWidth;d.removeChild(f);m={left:m.left-a.left,top:m.top-a.top,right:a.right-m.right,bottom:a.bottom-m.bottom};return{lineHeight:h,largestFontStyle:u,lineTrim:l,viewPadding:m,scrollWidth:g-n,invalid:i}},_clearSelection:function(d){var a=this._getSelection();if(a.isEmpty())return!1;
d==="next"?a.start=a.end:a.end=a.start;this._setSelection(a,!0);return!0},_commitIME:function(){if(this._imeOffset!==-1){this._scrollDiv.focus();this._clientDiv.focus();var d=this._model,a=d.getLineAtOffset(this._imeOffset),b=d.getLineStart(a),i=this._getDOMText(this._getLineNode(a)).text,d=d.getLine(a),b=this._imeOffset-b,d=b+i.length-d.length;b!==d&&this._doContent(i.substring(b,d));this._imeOffset=-1}},_createActions:function(){var d=p.KeyBinding,a=this._keyBindings=[];a.push({actionID:"lineUp",
keyBinding:new d(38),predefined:!0});a.push({actionID:"lineDown",keyBinding:new d(40),predefined:!0});a.push({actionID:"charPrevious",keyBinding:new d(37),predefined:!0});a.push({actionID:"charNext",keyBinding:new d(39),predefined:!0});b.isMac?(a.push({actionID:"scrollPageUp",keyBinding:new d(33),predefined:!0}),a.push({actionID:"scrollPageDown",keyBinding:new d(34),predefined:!0}),a.push({actionID:"pageUp",keyBinding:new d(33,null,null,!0),predefined:!0}),a.push({actionID:"pageDown",keyBinding:new d(34,
null,null,!0),predefined:!0}),a.push({actionID:"lineStart",keyBinding:new d(37,!0),predefined:!0}),a.push({actionID:"lineEnd",keyBinding:new d(39,!0),predefined:!0}),a.push({actionID:"wordPrevious",keyBinding:new d(37,null,null,!0),predefined:!0}),a.push({actionID:"wordNext",keyBinding:new d(39,null,null,!0),predefined:!0}),a.push({actionID:"scrollTextStart",keyBinding:new d(36),predefined:!0}),a.push({actionID:"scrollTextEnd",keyBinding:new d(35),predefined:!0}),a.push({actionID:"textStart",keyBinding:new d(38,
!0),predefined:!0}),a.push({actionID:"textEnd",keyBinding:new d(40,!0),predefined:!0}),a.push({actionID:"scrollPageUp",keyBinding:new d(38,null,null,null,!0),predefined:!0}),a.push({actionID:"scrollPageDown",keyBinding:new d(40,null,null,null,!0),predefined:!0}),a.push({actionID:"lineStart",keyBinding:new d(37,null,null,null,!0),predefined:!0}),a.push({actionID:"lineEnd",keyBinding:new d(39,null,null,null,!0),predefined:!0}),a.push({actionID:"lineStart",keyBinding:new d(38,null,null,!0),predefined:!0}),
a.push({actionID:"lineEnd",keyBinding:new d(40,null,null,!0),predefined:!0})):(a.push({actionID:"pageUp",keyBinding:new d(33),predefined:!0}),a.push({actionID:"pageDown",keyBinding:new d(34),predefined:!0}),a.push({actionID:"lineStart",keyBinding:new d(36),predefined:!0}),a.push({actionID:"lineEnd",keyBinding:new d(35),predefined:!0}),a.push({actionID:"wordPrevious",keyBinding:new d(37,!0),predefined:!0}),a.push({actionID:"wordNext",keyBinding:new d(39,!0),predefined:!0}),a.push({actionID:"textStart",
keyBinding:new d(36,!0),predefined:!0}),a.push({actionID:"textEnd",keyBinding:new d(35,!0),predefined:!0}));b.isFirefox&&b.isLinux&&(a.push({actionID:"lineUp",keyBinding:new d(38,!0),predefined:!0}),a.push({actionID:"lineDown",keyBinding:new d(40,!0),predefined:!0}));a.push({actionID:"selectLineUp",keyBinding:new d(38,null,!0),predefined:!0});a.push({actionID:"selectLineDown",keyBinding:new d(40,null,!0),predefined:!0});a.push({actionID:"selectCharPrevious",keyBinding:new d(37,null,!0),predefined:!0});
a.push({actionID:"selectCharNext",keyBinding:new d(39,null,!0),predefined:!0});a.push({actionID:"selectPageUp",keyBinding:new d(33,null,!0),predefined:!0});a.push({actionID:"selectPageDown",keyBinding:new d(34,null,!0),predefined:!0});b.isMac?(a.push({actionID:"selectLineStart",keyBinding:new d(37,!0,!0),predefined:!0}),a.push({actionID:"selectLineEnd",keyBinding:new d(39,!0,!0),predefined:!0}),a.push({actionID:"selectWordPrevious",keyBinding:new d(37,null,!0,!0),predefined:!0}),a.push({actionID:"selectWordNext",
keyBinding:new d(39,null,!0,!0),predefined:!0}),a.push({actionID:"selectTextStart",keyBinding:new d(36,null,!0),predefined:!0}),a.push({actionID:"selectTextEnd",keyBinding:new d(35,null,!0),predefined:!0}),a.push({actionID:"selectTextStart",keyBinding:new d(38,!0,!0),predefined:!0}),a.push({actionID:"selectTextEnd",keyBinding:new d(40,!0,!0),predefined:!0}),a.push({actionID:"selectLineStart",keyBinding:new d(37,null,!0,null,!0),predefined:!0}),a.push({actionID:"selectLineEnd",keyBinding:new d(39,
null,!0,null,!0),predefined:!0}),a.push({actionID:"selectLineStart",keyBinding:new d(38,null,!0,!0),predefined:!0}),a.push({actionID:"selectLineEnd",keyBinding:new d(40,null,!0,!0),predefined:!0})):(b.isLinux&&(a.push({actionID:"selectWholeLineUp",keyBinding:new d(38,!0,!0),predefined:!0}),a.push({actionID:"selectWholeLineDown",keyBinding:new d(40,!0,!0),predefined:!0})),a.push({actionID:"selectLineStart",keyBinding:new d(36,null,!0),predefined:!0}),a.push({actionID:"selectLineEnd",keyBinding:new d(35,
null,!0),predefined:!0}),a.push({actionID:"selectWordPrevious",keyBinding:new d(37,!0,!0),predefined:!0}),a.push({actionID:"selectWordNext",keyBinding:new d(39,!0,!0),predefined:!0}),a.push({actionID:"selectTextStart",keyBinding:new d(36,!0,!0),predefined:!0}),a.push({actionID:"selectTextEnd",keyBinding:new d(35,!0,!0),predefined:!0}));a.push({actionID:"undo",keyBinding:new p.KeyBinding("z",!0),predefined:!0});b.isMac?a.push({actionID:"redo",keyBinding:new p.KeyBinding("z",!0,!0),predefined:!0}):
a.push({actionID:"redo",keyBinding:new p.KeyBinding("y",!0),predefined:!0});a.push({actionID:"deletePrevious",keyBinding:new d(8),predefined:!0});a.push({actionID:"deletePrevious",keyBinding:new d(8,null,!0),predefined:!0});a.push({actionID:"deleteNext",keyBinding:new d(46),predefined:!0});a.push({actionID:"deleteWordPrevious",keyBinding:new d(8,!0),predefined:!0});a.push({actionID:"deleteWordPrevious",keyBinding:new d(8,!0,!0),predefined:!0});a.push({actionID:"deleteWordNext",keyBinding:new d(46,
!0),predefined:!0});a.push({actionID:"tab",keyBinding:new d(9),predefined:!0});a.push({actionID:"shiftTab",keyBinding:new d(9,null,!0),predefined:!0});a.push({actionID:"enter",keyBinding:new d(13),predefined:!0});a.push({actionID:"enter",keyBinding:new d(13,null,!0),predefined:!0});a.push({actionID:"selectAll",keyBinding:new d("a",!0),predefined:!0});a.push({actionID:"toggleTabMode",keyBinding:new d("m",!0),predefined:!0});b.isMac&&(a.push({actionID:"deleteNext",keyBinding:new d(46,null,!0),predefined:!0}),
a.push({actionID:"deleteWordPrevious",keyBinding:new d(8,null,null,!0),predefined:!0}),a.push({actionID:"deleteWordNext",keyBinding:new d(46,null,null,!0),predefined:!0}));if(!b.isFirefox){var c=b.isMac&&b.isChrome;a.push({actionID:null,keyBinding:new d("u",!c,!1,!1,c),predefined:!0});a.push({actionID:null,keyBinding:new d("i",!c,!1,!1,c),predefined:!0});a.push({actionID:null,keyBinding:new d("b",!c,!1,!1,c),predefined:!0})}b.isFirefox&&(a.push({actionID:"copy",keyBinding:new d(45,!0),predefined:!0}),
a.push({actionID:"paste",keyBinding:new d(45,null,!0),predefined:!0}),a.push({actionID:"cut",keyBinding:new d(46,null,!0),predefined:!0}));b.isMac&&(a.push({actionID:"lineStart",keyBinding:new d("a",!1,!1,!1,!0),predefined:!0}),a.push({actionID:"lineEnd",keyBinding:new d("e",!1,!1,!1,!0),predefined:!0}),a.push({actionID:"lineUp",keyBinding:new d("p",!1,!1,!1,!0),predefined:!0}),a.push({actionID:"lineDown",keyBinding:new d("n",!1,!1,!1,!0),predefined:!0}),a.push({actionID:"charPrevious",keyBinding:new d("b",
!1,!1,!1,!0),predefined:!0}),a.push({actionID:"charNext",keyBinding:new d("f",!1,!1,!1,!0),predefined:!0}),a.push({actionID:"deletePrevious",keyBinding:new d("h",!1,!1,!1,!0),predefined:!0}),a.push({actionID:"deleteNext",keyBinding:new d("d",!1,!1,!1,!0),predefined:!0}),a.push({actionID:"deleteLineEnd",keyBinding:new d("k",!1,!1,!1,!0),predefined:!0}),b.isFirefox?(a.push({actionID:"scrollPageDown",keyBinding:new d("v",!1,!1,!1,!0),predefined:!0}),a.push({actionID:"deleteLineStart",keyBinding:new d("u",
!1,!1,!1,!0),predefined:!0}),a.push({actionID:"deleteWordPrevious",keyBinding:new d("w",!1,!1,!1,!0),predefined:!0})):(a.push({actionID:"pageDown",keyBinding:new d("v",!1,!1,!1,!0),predefined:!0}),a.push({actionID:"centerLine",keyBinding:new d("l",!1,!1,!1,!0),predefined:!0}),a.push({actionID:"enterNoCursor",keyBinding:new d("o",!1,!1,!1,!0),predefined:!0})));var i=this;this._actions={lineUp:{defaultHandler:function(){return i._doLineUp({select:!1})}},lineDown:{defaultHandler:function(){return i._doLineDown({select:!1})}},
lineStart:{defaultHandler:function(){return i._doHome({select:!1,ctrl:!1})}},lineEnd:{defaultHandler:function(){return i._doEnd({select:!1,ctrl:!1})}},charPrevious:{defaultHandler:function(){return i._doCursorPrevious({select:!1,unit:"character"})}},charNext:{defaultHandler:function(){return i._doCursorNext({select:!1,unit:"character"})}},pageUp:{defaultHandler:function(){return i._doPageUp({select:!1})}},pageDown:{defaultHandler:function(){return i._doPageDown({select:!1})}},scrollPageUp:{defaultHandler:function(){return i._doScroll({type:"pageUp"})}},
scrollPageDown:{defaultHandler:function(){return i._doScroll({type:"pageDown"})}},wordPrevious:{defaultHandler:function(){return i._doCursorPrevious({select:!1,unit:"word"})}},wordNext:{defaultHandler:function(){return i._doCursorNext({select:!1,unit:"word"})}},textStart:{defaultHandler:function(){return i._doHome({select:!1,ctrl:!0})}},textEnd:{defaultHandler:function(){return i._doEnd({select:!1,ctrl:!0})}},scrollTextStart:{defaultHandler:function(){return i._doScroll({type:"textStart"})}},scrollTextEnd:{defaultHandler:function(){return i._doScroll({type:"textEnd"})}},
centerLine:{defaultHandler:function(){return i._doScroll({type:"centerLine"})}},selectLineUp:{defaultHandler:function(){return i._doLineUp({select:!0})}},selectLineDown:{defaultHandler:function(){return i._doLineDown({select:!0})}},selectWholeLineUp:{defaultHandler:function(){return i._doLineUp({select:!0,wholeLine:!0})}},selectWholeLineDown:{defaultHandler:function(){return i._doLineDown({select:!0,wholeLine:!0})}},selectLineStart:{defaultHandler:function(){return i._doHome({select:!0,ctrl:!1})}},
selectLineEnd:{defaultHandler:function(){return i._doEnd({select:!0,ctrl:!1})}},selectCharPrevious:{defaultHandler:function(){return i._doCursorPrevious({select:!0,unit:"character"})}},selectCharNext:{defaultHandler:function(){return i._doCursorNext({select:!0,unit:"character"})}},selectPageUp:{defaultHandler:function(){return i._doPageUp({select:!0})}},selectPageDown:{defaultHandler:function(){return i._doPageDown({select:!0})}},selectWordPrevious:{defaultHandler:function(){return i._doCursorPrevious({select:!0,
unit:"word"})}},selectWordNext:{defaultHandler:function(){return i._doCursorNext({select:!0,unit:"word"})}},selectTextStart:{defaultHandler:function(){return i._doHome({select:!0,ctrl:!0})}},selectTextEnd:{defaultHandler:function(){return i._doEnd({select:!0,ctrl:!0})}},deletePrevious:{defaultHandler:function(){return i._doBackspace({unit:"character"})}},deleteNext:{defaultHandler:function(){return i._doDelete({unit:"character"})}},deleteWordPrevious:{defaultHandler:function(){return i._doBackspace({unit:"word"})}},
deleteWordNext:{defaultHandler:function(){return i._doDelete({unit:"word"})}},deleteLineStart:{defaultHandler:function(){return i._doBackspace({unit:"line"})}},deleteLineEnd:{defaultHandler:function(){return i._doDelete({unit:"line"})}},tab:{defaultHandler:function(){return i._doTab()}},shiftTab:{defaultHandler:function(){return i._doShiftTab()}},enter:{defaultHandler:function(){return i._doEnter()}},enterNoCursor:{defaultHandler:function(){return i._doEnter({noCursor:!0})}},selectAll:{defaultHandler:function(){return i._doSelectAll()}},
copy:{defaultHandler:function(){return i._doCopy()}},cut:{defaultHandler:function(){return i._doCut()}},paste:{defaultHandler:function(){return i._doPaste()}},toggleWrapMode:{defaultHandler:function(){return i._doWrapMode()}},toggleTabMode:{defaultHandler:function(){return i._doTabMode()}}}},_createRuler:function(d,a){if(this._clientDiv){var c=d.getLocation()==="left"?this._leftDiv:this._rightDiv;c.style.display="block";var i=b.createElement(c.ownerDocument,"div");i._ruler=d;i.rulerChanged=!0;i.style.position=
"relative";var c=c.firstChild.rows[0],e=c.cells.length,c=c.insertCell(a===void 0||a<0||a>e?e:a);c.vAlign="top";c.style.verticalAlign="top";c.style.borderWidth="0px";c.style.margin="0px";c.style.padding="0px";c.style.outline="none";c.appendChild(i)}},_createView:function(){if(!this._clientDiv){for(var d=this._parent;d.hasChildNodes();)d.removeChild(d.lastChild);var a=d.ownerDocument,c=b.createElement(a,"div");this._rootDiv=c;c.tabIndex=-1;c.style.position="relative";c.style.overflow="hidden";c.style.width=
"100%";c.style.height="100%";d.style.overflow="hidden";c.setAttribute("role","application");d.appendChild(c);d=b.createElement(a,"div");d.className="textviewLeftRuler";this._leftDiv=d;d.tabIndex=-1;d.style.overflow="hidden";d.style.MozUserSelect="none";d.style.WebkitUserSelect="none";d.style.position="absolute";d.style.top="0px";d.style.bottom="0px";d.style.cursor="default";d.style.display="none";d.setAttribute("aria-hidden","true");var i=b.createElement(a,"table");d.appendChild(i);i.cellPadding=
"0px";i.cellSpacing="0px";i.border="0px";i.style.borderWidth="0px";i.style.margin="0px";i.style.padding="0px";i.style.outline="none";i.style.lineHeight="normal";i=i.insertRow(0);i.style.borderWidth="0px";i.style.margin="0px";i.style.padding="0px";i.style.outline="none";i.style.lineHeight="normal";c.appendChild(d);d=b.createElement(a,"div");d.className="textviewScroll";this._viewDiv=d;d.tabIndex=-1;d.style.overflow="auto";d.style.position="absolute";d.style.top="0px";d.style.bottom="0px";d.style.borderWidth=
"0px";d.style.margin="0px";d.style.outline="none";d.style.background="transparent";if(b.isMac&&b.isWebkit)d.style.pointerEvents="none",d.style.zIndex="2";c.appendChild(d);var e=b.createElement(a,"div");e.className="textviewRightRuler";this._rightDiv=e;e.tabIndex=-1;e.style.display="none";e.style.overflow="hidden";e.style.MozUserSelect="none";e.style.WebkitUserSelect="none";e.style.position="absolute";e.style.top="0px";e.style.bottom="0px";e.style.cursor="default";e.style.right="0px";e.setAttribute("aria-hidden",
"true");i=b.createElement(a,"table");e.appendChild(i);i.cellPadding="0px";i.cellSpacing="0px";i.border="0px";i.style.borderWidth="0px";i.style.margin="0px";i.style.padding="0px";i.style.outline="none";i.style.lineHeight="normal";i=i.insertRow(0);i.style.borderWidth="0px";i.style.margin="0px";i.style.padding="0px";i.style.outline="none";i.style.lineHeight="normal";c.appendChild(e);this._scrollDiv=i=b.createElement(a,"div");i.style.margin="0px";i.style.borderWidth="0px";i.style.padding="0px";d.appendChild(i);
if(b.isFirefox)this._clipboardDiv=d=b.createElement(a,"div"),d.style.position="fixed",d.style.whiteSpace="pre",d.style.left="-1000px",c.appendChild(d);if(!b.isIE&&!b.isIOS)this._clipDiv=d=b.createElement(a,"div"),d.style.position="absolute",d.style.overflow="hidden",d.style.margin="0px",d.style.borderWidth="0px",d.style.padding="0px",d.style.background="transparent",c.appendChild(d),this._clipScrollDiv=i=b.createElement(a,"div"),i.style.position="absolute",i.style.height="1px",i.style.top="-1000px",
i.style.background="transparent",d.appendChild(i);this._setFullSelection(this._fullSelection,!0);d=b.createElement(a,"div");d.className="textviewContent";this._clientDiv=d;d.style.position="absolute";d.style.borderWidth="0px";d.style.margin="0px";d.style.padding="0px";d.style.outline="none";d.style.zIndex="1";d.style.WebkitUserSelect="text";d.setAttribute("spellcheck","false");if(b.isIOS||b.isAndroid)d.style.WebkitTapHighlightColor="transparent";(this._clipDiv||c).appendChild(d);if(b.isIOS||b.isAndroid)this._vScrollDiv=
i=b.createElement(a,"div"),i.style.position="absolute",i.style.borderWidth="1px",i.style.borderColor="white",i.style.borderStyle="solid",i.style.borderRadius="4px",i.style.backgroundColor="black",i.style.opacity="0.5",i.style.margin="0px",i.style.padding="0px",i.style.outline="none",i.style.zIndex="3",i.style.width="8px",i.style.display="none",c.appendChild(i),this._hScrollDiv=i=b.createElement(a,"div"),i.style.position="absolute",i.style.borderWidth="1px",i.style.borderColor="white",i.style.borderStyle=
"solid",i.style.borderRadius="4px",i.style.backgroundColor="black",i.style.opacity="0.5",i.style.margin="0px",i.style.padding="0px",i.style.outline="none",i.style.zIndex="3",i.style.height="8px",i.style.display="none",c.appendChild(i);if(b.isFirefox&&!d.setCapture)this._overlayDiv=i=b.createElement(a,"div"),i.style.position=d.style.position,i.style.borderWidth=d.style.borderWidth,i.style.margin=d.style.margin,i.style.padding=d.style.padding,i.style.cursor="text",i.style.zIndex="2",(this._clipDiv||
c).appendChild(i);d.contentEditable="true";d.setAttribute("role","textbox");d.setAttribute("aria-multiline","true");this._setWrapMode(this._wrapMode,!0);this._setReadOnly(this._readonly);this._setThemeClass(this._themeClass,!0);this._setTabSize(this._tabSize,!0);if(!a.getElementById("_textviewStyle")&&(c="",b.isWebkit&&this._metrics.scrollWidth>0&&(c+="\n.textview ::-webkit-scrollbar-corner {background: #eeeeee;}"),b.isFirefox&&b.isMac&&this._highlightRGB&&this._highlightRGB!=="Highlight"&&(c+="\n.textview ::-moz-selection {background: "+
this._highlightRGB+";}"),c))d=b.createElement(a,"style"),d.id="_textviewStyle",i=a.getElementsByTagName("head")[0]||a.documentElement,d.appendChild(a.createTextNode(c)),i.insertBefore(d,i.firstChild);this._hookEvents();a=this._rulers;for(c=0;c<a.length;c++)this._createRuler(a[c]);this._update()}},_defaultOptions:function(){return{parent:{value:void 0,update:null},model:{value:void 0,update:this.setModel},readonly:{value:!1,update:this._setReadOnly},fullSelection:{value:!0,update:this._setFullSelection},
tabMode:{value:!0,update:null},tabSize:{value:8,update:this._setTabSize},expandTab:{value:!1,update:null},wrapMode:{value:!1,update:this._setWrapMode},theme:{value:j.TextTheme.getTheme(),update:this._setTheme},themeClass:{value:void 0,update:this._setThemeClass}}},_destroyRuler:function(d){var a=d.getLocation()==="left"?this._leftDiv:this._rightDiv;if(a){for(var b=a.firstChild.rows[0],c=b.cells,e=0;e<c.length;e++)if(c[e].firstChild._ruler===d)break;if(e!==c.length&&(b.cells[e]._ruler=void 0,b.deleteCell(e),
c.length===0))a.style.display="none"}},_destroyView:function(){if(this._clientDiv){this._setGrab(null);this._unhookEvents();var d=this._getWindow();if(this._autoScrollTimerID)d.clearTimeout(this._autoScrollTimerID),this._autoScrollTimerID=null;if(this._updateTimer)d.clearTimeout(this._updateTimer),this._updateTimer=null;d=this._rootDiv;d.parentNode.removeChild(d);this._hScrollDiv=this._vScrollDiv=this._rightDiv=this._leftDiv=this._overlayDiv=this._clientDiv=this._clipScrollDiv=this._clipDiv=this._viewDiv=
this._scrollDiv=this._rootDiv=this._clipboardDiv=this._selDiv3=this._selDiv2=this._selDiv1=null}},_doAutoScroll:function(d,a,c){this._autoScrollDir=d;this._autoScrollX=a;this._autoScrollY=c;this._autoScrollTimerID||this._autoScrollTimer()},_endAutoScroll:function(){this._autoScrollTimerID&&this._getWindow().clearTimeout(this._autoScrollTimerID);this._autoScrollTimerID=this._autoScrollDir=void 0},_fixCaret:function(){var d=this._clientDiv;if(d){var a=this._hasFocus;this._ignoreFocus=!0;a&&d.blur();
d.contentEditable=!1;d.contentEditable=!0;a&&d.focus();this._ignoreFocus=!1}},_getBaseText:function(d,a){var c=this._model;c.getBaseModel&&(d=c.mapOffset(d),a=c.mapOffset(a),c=c.getBaseModel());return c.getText(d,a)},_getBottomIndex:function(d){var a=this._bottomChild;if(d&&this._getClientHeight()>this._getLineHeight()){var d=a.getBoundingClientRect(),c=this._clientDiv.getBoundingClientRect();d.bottom>c.bottom&&(a=this._getLinePrevious(a)||a)}return a.lineIndex},_getBoundsAtOffset:function(d){var a=
this._getLine(this._model.getLineAtOffset(d)),d=a.getBoundingClientRect(d),c=this._getLinePixel(a.lineIndex);d.top+=c;d.bottom+=c;a.destroy();return d},_getClientHeight:function(){var d=this._getViewPadding();return Math.max(0,this._viewDiv.clientHeight-d.top-d.bottom)},_getClientWidth:function(){var d=this._getViewPadding();return Math.max(0,this._viewDiv.clientWidth-d.left-d.right)},_getClipboardText:function(d,c){var e=this._model.getLineDelimiter(),i,f,m=this._getWindow();if(m.clipboardData)return i=
[],f=m.clipboardData.getData("Text"),a(f,function(d){i.push(d)},function(){i.push(e)}),f=i.join(""),c&&c(f),f;if(b.isFirefox){this._ignoreFocus=!0;var l=this._clipboardDiv;l.innerHTML="<pre contenteditable=''></pre>";l.firstChild.focus();var q=this,g=function(){var d=q._getTextFromElement(l);l.innerHTML="";i=[];a(d,function(d){i.push(d)},function(){i.push(e)});return i.join("")},h=!1;this._ignorePaste=!0;if(!b.isLinux||this._lastMouseButton!==2)try{h=l.ownerDocument.execCommand("paste",!1,null)}catch(n){h=
l.childNodes.length>1||l.firstChild&&l.firstChild.childNodes.length>0}this._ignorePaste=!1;if(!h)return d?(m.setTimeout(function(){q.focus();(f=g())&&c&&c(f);q._ignoreFocus=!1},0),null):(this.focus(),this._ignoreFocus=!1,"");this.focus();this._ignoreFocus=!1;(f=g())&&c&&c(f);return f}return d&&d.clipboardData?(i=[],f=d.clipboardData.getData("text/plain"),a(f,function(d){i.push(d)},function(){i.push(e)}),(f=i.join(""))&&c&&c(f),f):""},_getDOMText:function(d,a){for(var c=d.firstChild,b="",e=0;c;){var m;
if(c.ignoreChars){m=c.lastChild;for(var f=0,l=[],q=-1;m;){for(var g=m.data,h=g.length-1;h>=0;h--){var n=g.substring(h,h+1);f<c.ignoreChars&&(n===" "||n==="\u200c"||n==="\ufeff")?f++:l.push(n==="\u00a0"?"\t":n)}if(a===m)q=l.length;m=m.previousSibling}l=l.reverse().join("");q!==-1&&(e=b.length+l.length-q);b+=l}else for(m=c.firstChild;m;){if(a===m)e=b.length;b+=m.data;m=m.nextSibling}c=c.nextSibling}return{text:b,offset:e}},_getTextFromElement:function(d){var a=d.ownerDocument,c=a.defaultView;if(!c.getSelection)return d.innerText||
d.textContent;a=a.createRange();a.selectNode(d);var d=c.getSelection(),c=[],b;for(b=0;b<d.rangeCount;b++)c.push(d.getRangeAt(b));this._ignoreSelect=!0;d.removeAllRanges();d.addRange(a);a=d.toString();d.removeAllRanges();for(b=0;b<c.length;b++)d.addRange(c[b]);this._ignoreSelect=!1;return a},_getViewPadding:function(){return this._metrics.viewPadding},_getLine:function(d){var a=this._getLineNode(d);return a&&!a.lineChanged&&!a.lineRemoved?a._line:new u(this,d)},_getLineHeight:function(d,a){if(d!==
void 0&&this._lineHeight){var c=this._lineHeight[d];if(c)return c;if(a||a===void 0)return this._lineHeight[d]=this._calculateLineHeight(d)}return this._metrics.lineHeight},_getLineNode:function(d){for(var a=this._clientDiv.firstChild;a;){if(d===a.lineIndex)return a;a=a.nextSibling}},_getLineNext:function(d){for(d=d?d.nextSibling:this._clientDiv.firstChild;d&&d.lineIndex===-1;)d=d.nextSibling;return d},_getLinePrevious:function(d){for(d=d?d.previousSibling:this._clientDiv.lastChild;d&&d.lineIndex===
-1;)d=d.previousSibling;return d},_getLinePixel:function(d){d=Math.min(Math.max(0,d),this._model.getLineCount());if(this._lineHeight){var a=this._getTopIndex(),c=-this._topIndexY+this._getScroll().y;if(d>a)for(;a<d;a++)c+=this._getLineHeight(a);else for(a-=1;a>=d;a--)c-=this._getLineHeight(a);return c}return this._getLineHeight()*d},_getLineIndex:function(d){var a,c=0,b=this._model.getLineCount();if(this._lineHeight){var c=this._getTopIndex(),e=-this._topIndexY+this._getScroll().y;if(d!==e)if(d<e)for(;d<
e&&c>0;)d+=this._getLineHeight(--c);else for(a=this._getLineHeight(c);d-a>=e&&c<b-1;)d-=a,a=this._getLineHeight(++c)}else a=this._getLineHeight(),c=Math.floor(d/a);return Math.max(0,Math.min(b-1,c))},_getScroll:function(){var a=this._viewDiv;return{x:a.scrollLeft,y:a.scrollTop}},_getSelection:function(){return this._selection.clone()},_getTopIndex:function(a){var c=this._topChild;if(a&&this._getClientHeight()>this._getLineHeight()){var a=c.getBoundingClientRect(),b=this._getViewPadding(),i=this._viewDiv.getBoundingClientRect();
a.top<i.top+b.top&&(c=this._getLineNext(c)||c)}return c.lineIndex},_hookEvents:function(){var a=this;this._modelListener={onChanging:function(c){a._onModelChanging(c)},onChanged:function(c){a._onModelChanged(c)}};this._model.addEventListener("preChanging",this._modelListener.onChanging);this._model.addEventListener("postChanged",this._modelListener.onChanged);this._themeListener={onChanged:function(){a._setThemeClass(a._themeClass)}};this._theme.addEventListener("ThemeChanged",this._themeListener.onChanged);
var c=this._handlers=[],e=this._clientDiv,i=this._viewDiv,l=this._rootDiv,m=this._overlayDiv||e,q=e.ownerDocument,g=this._getWindow(),h=b.isIE?q:g;c.push({target:g,type:"resize",handler:function(c){return a._handleResize(c?c:g.event)}});c.push({target:e,type:"blur",handler:function(c){return a._handleBlur(c?c:g.event)}});c.push({target:e,type:"focus",handler:function(c){return a._handleFocus(c?c:g.event)}});c.push({target:i,type:"focus",handler:function(){e.focus()}});c.push({target:i,type:"scroll",
handler:function(c){return a._handleScroll(c?c:g.event)}});c.push({target:e,type:"textInput",handler:function(c){return a._handleTextInput(c?c:g.event)}});c.push({target:e,type:"keydown",handler:function(c){return a._handleKeyDown(c?c:g.event)}});c.push({target:e,type:"keypress",handler:function(c){return a._handleKeyPress(c?c:g.event)}});c.push({target:e,type:"keyup",handler:function(c){return a._handleKeyUp(c?c:g.event)}});c.push({target:e,type:"contextmenu",handler:function(c){return a._handleContextMenu(c?
c:g.event)}});c.push({target:e,type:"copy",handler:function(c){return a._handleCopy(c?c:g.event)}});c.push({target:e,type:"cut",handler:function(c){return a._handleCut(c?c:g.event)}});c.push({target:e,type:"paste",handler:function(c){return a._handlePaste(c?c:g.event)}});if(b.isIOS||b.isAndroid)c.push({target:q,type:"selectionchange",handler:function(c){return a._handleSelectionChange(c?c:g.event)}}),c.push({target:e,type:"touchstart",handler:function(c){return a._handleTouchStart(c?c:g.event)}}),
c.push({target:e,type:"touchmove",handler:function(c){return a._handleTouchMove(c?c:g.event)}}),c.push({target:e,type:"touchend",handler:function(c){return a._handleTouchEnd(c?c:g.event)}});else{c.push({target:e,type:"selectstart",handler:function(c){return a._handleSelectStart(c?c:g.event)}});c.push({target:e,type:"mousedown",handler:function(c){return a._handleMouseDown(c?c:g.event)}});c.push({target:e,type:"mouseover",handler:function(c){return a._handleMouseOver(c?c:g.event)}});c.push({target:e,
type:"mouseout",handler:function(c){return a._handleMouseOut(c?c:g.event)}});c.push({target:h,type:"mouseup",handler:function(c){return a._handleMouseUp(c?c:g.event)}});c.push({target:h,type:"mousemove",handler:function(c){return a._handleMouseMove(c?c:g.event)}});c.push({target:l,type:"mousedown",handler:function(c){return a._handleRootMouseDown(c?c:g.event)}});c.push({target:l,type:"mouseup",handler:function(c){return a._handleRootMouseUp(c?c:g.event)}});c.push({target:m,type:"dragstart",handler:function(c){return a._handleDragStart(c?
c:g.event)}});c.push({target:m,type:"drag",handler:function(c){return a._handleDrag(c?c:g.event)}});c.push({target:m,type:"dragend",handler:function(c){return a._handleDragEnd(c?c:g.event)}});c.push({target:m,type:"dragenter",handler:function(c){return a._handleDragEnter(c?c:g.event)}});c.push({target:m,type:"dragover",handler:function(c){return a._handleDragOver(c?c:g.event)}});c.push({target:m,type:"dragleave",handler:function(c){return a._handleDragLeave(c?c:g.event)}});c.push({target:m,type:"drop",
handler:function(c){return a._handleDrop(c?c:g.event)}});c.push({target:this._clientDiv,type:b.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(c){return a._handleMouseWheel(c?c:g.event)}});if(b.isFirefox&&(!b.isWindows||b.isFirefox>=15))(i=g.MutationObserver||g.MozMutationObserver)?(this._mutationObserver=new i(function(c){a._handleDataModified(c)}),this._mutationObserver.observe(e,{subtree:!0,characterData:!0})):c.push({target:this._clientDiv,type:"DOMCharacterDataModified",handler:function(c){return a._handleDataModified(c?
c:g.event)}});this._overlayDiv&&(c.push({target:this._overlayDiv,type:"mousedown",handler:function(c){return a._handleMouseDown(c?c:g.event)}}),c.push({target:this._overlayDiv,type:"mouseover",handler:function(c){return a._handleMouseOver(c?c:g.event)}}),c.push({target:this._overlayDiv,type:"mouseout",handler:function(c){return a._handleMouseOut(c?c:g.event)}}),c.push({target:this._overlayDiv,type:"contextmenu",handler:function(c){return a._handleContextMenu(c?c:g.event)}}));this._isW3CEvents||c.push({target:this._clientDiv,
type:"dblclick",handler:function(c){return a._handleDblclick(c?c:g.event)}})}i=this._leftDiv;l=this._rightDiv;b.isIE&&c.push({target:i,type:"selectstart",handler:function(){return!1}});c.push({target:i,type:b.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(c){return a._handleMouseWheel(c?c:g.event)}});c.push({target:i,type:"click",handler:function(c){a._handleRulerEvent(c?c:g.event)}});c.push({target:i,type:"dblclick",handler:function(c){a._handleRulerEvent(c?c:g.event)}});c.push({target:i,
type:"mousemove",handler:function(c){a._handleRulerEvent(c?c:g.event)}});c.push({target:i,type:"mouseover",handler:function(c){a._handleRulerEvent(c?c:g.event)}});c.push({target:i,type:"mouseout",handler:function(c){a._handleRulerEvent(c?c:g.event)}});b.isIE&&c.push({target:l,type:"selectstart",handler:function(){return!1}});c.push({target:l,type:b.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(c){return a._handleMouseWheel(c?c:g.event)}});c.push({target:l,type:"click",handler:function(c){a._handleRulerEvent(c?
c:g.event)}});c.push({target:l,type:"dblclick",handler:function(c){a._handleRulerEvent(c?c:g.event)}});c.push({target:l,type:"mousemove",handler:function(c){a._handleRulerEvent(c?c:g.event)}});c.push({target:l,type:"mouseover",handler:function(c){a._handleRulerEvent(c?c:g.event)}});c.push({target:l,type:"mouseout",handler:function(c){a._handleRulerEvent(c?c:g.event)}});for(i=0;i<c.length;i++)l=c[i],f(l.target,l.type,l.handler,l.capture)},_getWindow:function(){return this._parent.ownerDocument.defaultView||
this._parent.ownerDocument.parentWindow},_init:function(a){var c=a.parent;typeof c==="string"&&(c=(a.document||document).getElementById(c));if(!c)throw"no parent";a.parent=c;a.model=a.model||new s.TextModel;var e=this._defaultOptions(),i;for(i in e)e.hasOwnProperty(i)&&(this["_"+i]=a[i]!==void 0?a[i]:e[i].value);this._rulers=[];this._selection=new l(0,0,!1);this._linksVisible=!1;this._maxLineWidth=this._redrawCount=0;this._maxLineIndex=-1;this._ignoreSelect=!0;this._hasFocus=this._ignoreFocus=!1;
this._dragOffset=this._columnX=-1;this._isRangeRects=(!b.isIE||b.isIE>=9)&&typeof c.ownerDocument.createRange().getBoundingClientRect==="function";this._isW3CEvents=c.addEventListener;this._autoScrollTimerID=this._autoScrollY=this._autoScrollX=null;this._AUTO_SCROLL_RATE=50;this._mouseUpClosure=this._moseMoveClosure=this._grabControl=null;this._clickCount=this._lastMouseTime=this._lastMouseY=this._lastMouseX=0;this._clickTime=250;this._clickDist=5;this._isMouseDown=!1;this._doubleClickSelection=null;
this._vScroll=this._hScroll=0;this._imeOffset=-1;this._createActions();this._createView()},_modifyContent:function(a,c){if(!this._readonly||a._code)if(a.type="Verify",this.onVerify(a),!(a.text===null||a.text===void 0)){var b=this._model;try{if(a._ignoreDOMSelection)this._ignoreDOMSelection=!0;b.setText(a.text,a.start,a.end)}finally{if(a._ignoreDOMSelection)this._ignoreDOMSelection=!1}c&&(b=this._getSelection(),b.setCaret(a.start+a.text.length),this._setSelection(b,!0));this.onModify({type:"Modify"})}},
_onModelChanged:function(a){a.type="ModelChanged";this.onModelChanged(a);a.type="Changed";var c=a.start,b=a.addedCharCount,i=a.removedCharCount,e=a.addedLineCount,m=a.removedLineCount,f=this._getSelection();f.end>c&&(f.end>c&&f.start<c+i?f.setCaret(c+b):(f.start+=b-i,f.end+=b-i),this._setSelection(f,!1,!1));c=this._model.getLineAtOffset(c);for(b=this._getLineNext();b;){i=b.lineIndex;if(c<=i&&i<=c+m)c===i&&!b.modelChangedEvent&&!b.lineRemoved?(b.modelChangedEvent=a,b.lineChanged=!0):(b.lineRemoved=
!0,b.lineChanged=!1,b.modelChangedEvent=null);if(i>c+m)b.lineIndex=i+e-m,b._line.lineIndex=b.lineIndex;b=this._getLineNext(b)}if(!this._wrapMode&&c<=this._maxLineIndex&&this._maxLineIndex<=c+m)this._checkMaxLineIndex=this._maxLineIndex,this._maxLineIndex=-1,this._maxLineWidth=0;this._update()},_onModelChanging:function(a){a.type="ModelChanging";this.onModelChanging(a);a.type="Changing"},_queueUpdate:function(){if(!this._updateTimer&&!this._ignoreQueueUpdate){var a=this;this._updateTimer=this._getWindow().setTimeout(function(){a._updateTimer=
null;a._update()},0)}},_resetLineHeight:function(a,c){if(this._wrapMode){if(a!==void 0&&c!==void 0)for(var b=a;b<c;b++)this._lineHeight[b]=void 0;else this._lineHeight=Array(this._model.getLineCount());this._calculateLineHeightTimer()}else this._lineHeight=null},_resetLineWidth:function(){var a=this._clientDiv;if(a)for(a=a.firstChild;a;)a.lineWidth=void 0,a=a.nextSibling},_reset:function(){this._maxLineIndex=-1;this._maxLineWidth=0;this._columnX=-1;this._bottomChild=this._topChild=null;this._topIndexY=
0;this._resetLineHeight();this._setSelection(new l(0,0,!1),!1,!1);if(this._viewDiv)this._viewDiv.scrollLeft=0,this._viewDiv.scrollTop=0;var a=this._clientDiv;if(a){for(var c=a.firstChild;c;)c.lineRemoved=!0,c=c.nextSibling;if(b.isFirefox)this._ignoreFocus=!1,(c=this._hasFocus)&&a.blur(),a.contentEditable=!1,a.contentEditable=!0,c&&a.focus(),this._ignoreFocus=!1}},_scrollView:function(a,c){this._ensureCaretVisible=!1;var b=this._viewDiv;a&&(b.scrollLeft+=a);c&&(b.scrollTop+=c)},_setClipboardText:function(d,
c){var e,i=this._parent.ownerDocument,f=this._getWindow();if(f.clipboardData)return e=[],a(d,function(a){e.push(a)},function(){e.push(b.platformDelimiter)}),f.clipboardData.setData("Text",e.join(""));if(c&&c.clipboardData&&(e=[],a(d,function(a){e.push(a)},function(){e.push(b.platformDelimiter)}),c.clipboardData.setData("text/plain",e.join(""))))return!0;var m=b.createElement(i,"pre");m.style.position="fixed";m.style.left="-1000px";a(d,function(a){m.appendChild(i.createTextNode(a))},function(){m.appendChild(b.createElement(i,
"br"))});m.appendChild(i.createTextNode(" "));this._clientDiv.appendChild(m);var l=i.createRange();l.setStart(m.firstChild,0);l.setEndBefore(m.lastChild);var g=f.getSelection();g.rangeCount>0&&g.removeAllRanges();g.addRange(l);var q=this,l=function(){m&&m.parentNode===q._clientDiv&&q._clientDiv.removeChild(m);q._updateDOMSelection()},g=!1;this._ignoreCopy=!0;try{g=i.execCommand("copy",!1,null)}catch(h){}this._ignoreCopy=!1;if(!g&&c)return f.setTimeout(l,0),!1;l();return!0},_setDOMSelection:function(a,
c,e,i){for(var f,m,l,g,q=0,h=a.firstChild,n,j,u=this._model.getLine(a.lineIndex).length;h;){n=h.firstChild;j=n.length;h.ignoreChars&&(j-=h.ignoreChars);if(q+j>c||q+j>=u){f=n;m=c-q;h.ignoreChars&&j>0&&m===j&&(m+=h.ignoreChars);break}q+=j;h=h.nextSibling}for(var q=0,h=e.firstChild,t=this._model.getLine(e.lineIndex).length;h;){n=h.firstChild;j=n.length;h.ignoreChars&&(j-=h.ignoreChars);if(j+q>i||q+j>=t){l=n;g=i-q;h.ignoreChars&&j>0&&g===j&&(g+=h.ignoreChars);break}q+=j;h=h.nextSibling}this._setDOMFullSelection(a,
c,u,e,i,t);if(this._hasFocus)if(c=this._getWindow(),a=this._parent.ownerDocument,c.getSelection){if(c=c.getSelection(),!(c.anchorNode===f&&c.anchorOffset===m&&c.focusNode===l&&c.focusOffset===g||c.anchorNode===l&&c.anchorOffset===g&&c.focusNode===f&&c.focusOffset===m))a=a.createRange(),a.setStart(f,m),a.setEnd(l,g),this._ignoreSelect=!1,c.rangeCount>0&&c.removeAllRanges(),c.addRange(a),this._ignoreSelect=!0}else if(a.selection)c=a.body,a=b.createElement(a,"div"),c.appendChild(a),c.removeChild(a),
a=c.createTextRange(),a.moveToElementText(f.parentNode),a.moveStart("character",m),f=c.createTextRange(),f.moveToElementText(l.parentNode),f.moveStart("character",g),a.setEndPoint("EndToStart",f),this._ignoreSelect=!1,a.select(),this._ignoreSelect=!0},_setDOMFullSelection:function(a,c,b,i,e){if(this._selDiv1&&(b=this._selDiv1,b.style.width="0px",b.style.height="0px",b=this._selDiv2,b.style.width="0px",b.style.height="0px",b=this._selDiv3,b.style.width="0px",b.style.height="0px",!(a===i&&c===e))){var m=
this._model,f=this._getViewPadding(),l=this._clientDiv.getBoundingClientRect(),g=this._viewDiv.getBoundingClientRect(),b=g.left+f.left,q=l.right,f=g.top+f.top,h=l.bottom,g=l=0;this._clipDiv?(g=this._clipDiv.getBoundingClientRect(),l=g.left-this._clipDiv.scrollLeft):(g=this._rootDiv.getBoundingClientRect(),l=g.left);g=g.top;this._ignoreDOMSelection=!0;var a=(new u(this,a.lineIndex,a)).getBoundingClientRect(m.getLineStart(a.lineIndex)+c,!1),n=a.left,e=(new u(this,i.lineIndex,i)).getBoundingClientRect(m.getLineStart(i.lineIndex)+
e,!1),c=e.left;this._ignoreDOMSelection=!1;var m=this._selDiv1,n=Math.min(q,Math.max(b,n)),j=Math.min(h,Math.max(f,a.top)),t=q,i=Math.min(h,Math.max(f,a.bottom));m.style.left=n-l+"px";m.style.top=j-g+"px";m.style.width=Math.max(0,t-n)+"px";m.style.height=Math.max(0,i-j)+"px";if(a.top===e.top)t=Math.min(c,q),m.style.width=Math.max(0,t-n)+"px";else if(a=Math.min(h,Math.max(f,e.top)),c=Math.min(q,Math.max(b,c)),f=Math.min(h,Math.max(f,e.bottom)),h=this._selDiv3,h.style.left=b-l+"px",h.style.top=a-g+
"px",h.style.width=Math.max(0,c-b)+"px",h.style.height=Math.max(0,f-a)+"px",a-i>0)f=this._selDiv2,f.style.left=b-l+"px",f.style.top=i-g+"px",f.style.width=Math.max(0,q-b)+"px",f.style.height=Math.max(0,a-i)+"px"}},_setGrab:function(a){if(a!==this._grabControl)a?(a.setCapture&&a.setCapture(),this._grabControl=a):(this._grabControl.releaseCapture&&this._grabControl.releaseCapture(),this._grabControl=null)},_setLinksVisible:function(a){if(this._linksVisible!==a){this._linksVisible=a;if(b.isIE&&a)this._hadFocus=
this._hasFocus;var c=this._clientDiv;c.contentEditable=!a;this._hadFocus&&!a&&c.focus();if(this._overlayDiv)this._overlayDiv.style.zIndex=a?"-1":"1";for(a=this._getLineNext();a;){if(a.hasLink)for(c=a.firstChild;c;){var e=c.nextSibling,i=c.viewStyle;i&&i.tagName==="A"&&a.replaceChild(a._line._createSpan(a,c.firstChild.data,i),c);c=e}a=this._getLineNext(a)}}},_setSelection:function(a,c,b,i){if(a){this._columnX=-1;b===void 0&&(b=!0);var e=this._selection;this._selection=a;c&&this._showCaret(!1,i);b&&
this._updateDOMSelection();if(!e.equals(a))this.onSelection({type:"Selection",oldValue:{start:e.start,end:e.end},newValue:{start:a.start,end:a.end}})}},_setSelectionTo:function(a,c,b,i){var e=this._model,m=this._getSelection(),c=this.convert({x:a,y:c},"page","document"),a=this._getLineIndex(c.y);if(this._clickCount===1){e=this._getLine(a);a=e.getOffset(c.x,c.y-this._getLinePixel(a));e.destroy();if(i&&!b&&m.start<=a&&a<m.end)return this._dragOffset=a,!1;m.extend(a);b||m.collapse()}else(this._clickCount&
1)===0?(e=this._getLine(a),a=e.getOffset(c.x,c.y-this._getLinePixel(a)),this._doubleClickSelection?a>=this._doubleClickSelection.start?(b=this._doubleClickSelection.start,i=e.getNextOffset(a,"wordend",1)):(b=e.getNextOffset(a,"word",-1),i=this._doubleClickSelection.end):(b=e.getNextOffset(a,"word",-1),i=e.getNextOffset(b,"wordend",1)),e.destroy()):this._doubleClickSelection?(i=e.getLineAtOffset(this._doubleClickSelection.start),a>=i?(b=e.getLineStart(i),i=e.getLineEnd(a)):(b=e.getLineStart(a),i=e.getLineEnd(i))):
(b=e.getLineStart(a),i=e.getLineEnd(a)),m.setCaret(b),m.extend(i);this._setSelection(m,!0,!0);return!0},_setFullSelection:function(a,c){this._fullSelection=a;if(b.isWebkit)this._fullSelection=!0;var e=this._clipDiv||this._rootDiv;if(e)if(this._fullSelection){if(!this._selDiv1&&this._fullSelection&&!b.isIOS){var i=e.ownerDocument;this._highlightRGB=b.isWebkit?"transparent":"Highlight";var f=b.createElement(i,"div");this._selDiv1=f;f.style.position="absolute";f.style.borderWidth="0px";f.style.margin=
"0px";f.style.padding="0px";f.style.outline="none";f.style.background=this._highlightRGB;f.style.width="0px";f.style.height="0px";f.style.zIndex="0";e.appendChild(f);var m=b.createElement(i,"div");this._selDiv2=m;m.style.position="absolute";m.style.borderWidth="0px";m.style.margin="0px";m.style.padding="0px";m.style.outline="none";m.style.background=this._highlightRGB;m.style.width="0px";m.style.height="0px";m.style.zIndex="0";e.appendChild(m);this._selDiv3=i=b.createElement(i,"div");i.style.position=
"absolute";i.style.borderWidth="0px";i.style.margin="0px";i.style.padding="0px";i.style.outline="none";i.style.background=this._highlightRGB;i.style.width="0px";i.style.height="0px";i.style.zIndex="0";e.appendChild(i);if(b.isFirefox&&b.isMac){e=this._getWindow().getComputedStyle(i,null).getPropertyValue("background-color");switch(e){case "rgb(119, 141, 168)":e="rgb(199, 208, 218)";break;case "rgb(127, 127, 127)":e="rgb(198, 198, 198)";break;case "rgb(255, 193, 31)":e="rgb(250, 236, 115)";break;case "rgb(243, 70, 72)":e=
"rgb(255, 176, 139)";break;case "rgb(255, 138, 34)":e="rgb(255, 209, 129)";break;case "rgb(102, 197, 71)":e="rgb(194, 249, 144)";break;case "rgb(140, 78, 184)":e="rgb(232, 184, 255)";break;default:e="rgb(180, 213, 255)"}this._highlightRGB=e;f.style.background=e;m.style.background=e;i.style.background=e}c||this._updateDOMSelection()}}else{if(this._selDiv1)e.removeChild(this._selDiv1),this._selDiv1=null;if(this._selDiv2)e.removeChild(this._selDiv2),this._selDiv2=null;if(this._selDiv3)e.removeChild(this._selDiv3),
this._selDiv3=null}},_setReadOnly:function(a){this._readonly=a;this._clientDiv.setAttribute("aria-readonly",a?"true":"false")},_setTabSize:function(a,c){this._tabSize=a;this._customTabSize=void 0;var e=this._clientDiv;if(b.isOpera){if(e)e.style.OTabSize=this._tabSize+""}else if(b.isWebkit>=537.1){if(e)e.style.tabSize=this._tabSize+""}else if(b.isFirefox>=4){if(e)e.style.MozTabSize=this._tabSize+""}else if(this._tabSize!==8)this._customTabSize=this._tabSize;c||(this.redrawLines(),this._resetLineWidth())},
_setTheme:function(a){this._theme&&this._theme.removeEventListener("ThemeChanged",this._themeListener.onChanged);(this._theme=a)&&this._theme.addEventListener("ThemeChanged",this._themeListener.onChanged);this._setThemeClass(this._themeClass)},_setThemeClass:function(a,c){this._themeClass=a;var b="textview",e=this._theme.getThemeClass();e&&(b+=" "+e);this._themeClass&&e!==this._themeClass&&(b+=" "+this._themeClass);this._rootDiv.className=b;this._updateStyle(c)},_setWrapMode:function(a,c){this._wrapMode=
a;var b=this._clientDiv,e=this._viewDiv;a?(b.style.whiteSpace="pre-wrap",b.style.wordWrap="break-word",e.style.overflowX="hidden",e.style.overflowY="scroll"):(b.style.whiteSpace="pre",b.style.wordWrap="normal",e.style.overflowX="auto",e.style.overflowY="auto");c||(this.redraw(),this._resetLineWidth());this._resetLineHeight()},_showCaret:function(a,c){if(this._clientDiv){var b=this._model,e=this._getSelection(),f=this._getScroll(),m=e.getCaret(),l=e.start,g=e.end,q=b.getLineAtOffset(g),h=Math.max(Math.max(l,
b.getLineStart(q)),g-1),b=this._getClientWidth(),q=this._getClientHeight(),n=b/4,j=this._getBoundsAtOffset(m===l?l:h),u=j.left,t=j.right,o=j.top,p=j.bottom;a&&!e.isEmpty()&&(j=this._getBoundsAtOffset(m===g?l:h),j.top===o?m===l?t=u+Math.min(j.right-u,b):u=t-Math.min(t-j.left,b):m===l?p=o+Math.min(j.bottom-o,q):o=p-Math.min(p-j.top,q));e=0;u<f.x&&(e=Math.min(u-f.x,-n));t>f.x+b&&(e=Math.max(t-f.x-b,n));m=0;o<f.y?m=o-f.y:p>f.y+q&&(m=p-f.y-q);c&&(c>0?m>0&&(m=Math.max(m,c)):m<0&&(m=Math.min(m,c)));return e!==
0||m!==0?(this._scrollView(e,m),q!==this._getClientHeight()||b!==this._getClientWidth()?this._showCaret():this._ensureCaretVisible=!0,!0):!1}},_startIME:function(){if(this._imeOffset===-1){var a=this._getSelection();a.isEmpty()||this._modifyContent({text:"",start:a.start,end:a.end},!0);this._imeOffset=a.start}},_unhookEvents:function(){this._model.removeEventListener("preChanging",this._modelListener.onChanging);this._model.removeEventListener("postChanged",this._modelListener.onChanged);this._theme.removeEventListener("ThemeChanged",
this._themeListener.onChanged);this._modelListener=null;for(var a=0;a<this._handlers.length;a++){var c=this._handlers[a],b=c.target,e=c.type,c=c.handler;typeof b.removeEventListener==="function"?b.removeEventListener(e,c,!1):b.detachEvent("on"+e,c)}this._handlers=null;if(this._mutationObserver)this._mutationObserver.disconnect(),this._mutationObserver=null},_updateDOMSelection:function(){if(!this._ignoreDOMSelection&&this._clientDiv){var a=this._getSelection(),c=this._model,b=c.getLineAtOffset(a.start),
e=c.getLineAtOffset(a.end),f=this._getLineNext();if(f){var m=this._getLinePrevious(),l;b<f.lineIndex?(l=f,b=0):b>m.lineIndex?(l=m,b=0):(l=this._getLineNode(b),b=a.start-c.getLineStart(b));e<f.lineIndex?a=0:e>m.lineIndex?(f=m,a=0):(f=this._getLineNode(e),a=a.end-c.getLineStart(e));this._setDOMSelection(l,b,f,a)}}},_update:function(a){if(!(this._redrawCount>0)){if(this._updateTimer)this._getWindow().clearTimeout(this._updateTimer),this._updateTimer=null,a=!1;var c=this._clientDiv;if(c){if(this._metrics.invalid)this._ignoreQueueUpdate=
!0,this._updateStyle(),this._ignoreQueueUpdate=!1;var e=this._model,i=this._getScroll(),f=this._getViewPadding(),m=e.getLineCount(),l=this._getLineHeight(),g=this._getClientWidth();if(this._wrapMode)c.style.width=g+"px";var q,h,n,j,t=0,o=0;if(this._lineHeight){for(;o<m;){n=this._getLineHeight(o);if(t+n>i.y)break;t+=n;o++}q=o;h=Math.max(0,q-1);n=e=i.y-t;q>0&&(e+=this._getLineHeight(q-1))}else j=Math.max(0,i.y)/l,q=Math.floor(j),h=Math.max(0,q-1),e=Math.round((j-h)*l),n=Math.round((j-q)*l);this._topIndexY=
n;j=this._parent;var p=j.clientWidth,s=j.clientHeight;j=this._getClientHeight();if(a){h=0;this._leftDiv&&(q=this._leftDiv.getBoundingClientRect(),h=q.right-q.left);q=g;for(this._wrapMode||(q=Math.max(this._maxLineWidth,q));o<m;)n=this._getLineHeight(o,!1),t+=n,o++;m=t}else{var g=this._viewDiv,l=Math.min(q+Math.floor((j+n)/l),m-1),i=Math.min(l+1,m-1),v;for(n=c.firstChild;n;){v=n.lineIndex;var w=n.nextSibling;if(!(h<=v&&v<=i)||n.lineRemoved||n.lineIndex===-1)this._mouseWheelLine===n?(n.style.display=
"none",n.lineIndex=-1):c.removeChild(n);n=w}n=this._getLineNext();var w=g.ownerDocument,z=w.createDocumentFragment();for(v=h;v<=i;v++)if(!n||n.lineIndex>v)(new u(this,v)).create(z,null);else{z.firstChild&&(c.insertBefore(z,n),z=w.createDocumentFragment());if(n&&n.lineChanged)n=(new u(this,v)).create(z,n),n.lineChanged=!1;n=this._getLineNext(n)}z.firstChild&&c.insertBefore(z,n);if(b.isWebkit&&!this._wrapMode)c.style.width="0x7fffffffpx";n=this._getLineNext();v=j+e;for(z=!1;n;){h=n.lineWidth;if(h===
void 0)w=n._line.getBoundingClientRect(),h=n.lineWidth=Math.ceil(w.right-w.left),this._lineHeight&&(this._lineHeight[n.lineIndex]=Math.ceil(w.bottom-w.top));if(this._lineHeight&&!z&&(v-=this._lineHeight[n.lineIndex],v<0))l=n.lineIndex,z=!0;if(!this._wrapMode){if(h>=this._maxLineWidth)this._maxLineWidth=h,this._maxLineIndex=n.lineIndex;if(this._checkMaxLineIndex===n.lineIndex)this._checkMaxLineIndex=-1}if(n.lineIndex===q)this._topChild=n;if(n.lineIndex===l)this._bottomChild=n;n=this._getLineNext(n)}if(this._checkMaxLineIndex!==
-1&&(v=this._checkMaxLineIndex,this._checkMaxLineIndex=-1,0<=v&&v<m)){n=new u(this,v);w=n.getBoundingClientRect();h=w.right-w.left;if(h>=this._maxLineWidth)this._maxLineWidth=h,this._maxLineIndex=v;n.destroy()}for(;o<m;)n=this._getLineHeight(o,o<=l),t+=n,o++;m=t;this._updateRuler(this._leftDiv,q,i,s);this._updateRuler(this._rightDiv,q,i,s);h=0;this._leftDiv&&(q=this._leftDiv.getBoundingClientRect(),h=q.right-q.left);i=0;this._rightDiv&&(i=this._rightDiv.getBoundingClientRect(),i=i.right-i.left);g.style.left=
h+"px";g.style.right=i+"px";i=this._scrollDiv;i.style.height=m+"px";t=g=this._getClientWidth();this._wrapMode||(t=Math.max(this._maxLineWidth,t));q=t;if((!b.isIE||b.isIE>=9)&&this._maxLineWidth>g)t+=f.right+f.left;i.style.width=t+"px";if(this._clipScrollDiv)this._clipScrollDiv.style.width=t+"px";i=this._getScroll()}if(this._vScrollDiv)t=j-8,o=Math.max(15,Math.ceil(Math.min(1,t/(m+f.top+f.bottom))*t)),this._vScrollDiv.style.left=h+g-8+"px",this._vScrollDiv.style.top=Math.floor(Math.max(0,i.y*t/m))+
"px",this._vScrollDiv.style.height=o+"px";if(!this._wrapMode&&this._hScrollDiv)t=g-8,o=Math.max(15,Math.ceil(Math.min(1,t/(this._maxLineWidth+f.left+f.right))*t)),this._hScrollDiv.style.left=h+Math.floor(Math.max(0,Math.floor(i.x*t/this._maxLineWidth)))+"px",this._hScrollDiv.style.top=j-9+"px",this._hScrollDiv.style.width=o+"px";v=i.x;n=this._clipDiv;t=this._overlayDiv;if(n){n.scrollLeft=v;o=h+f.left;l=f.top;a=g;h=j;v=0;w=-e;if(i.x===0)o-=f.left,a+=f.left,v=f.left;i.x+g===q&&(a+=f.right);i.y===0&&
(l-=f.top,h+=f.top,w+=f.top);i.y+j===m&&(h+=f.bottom);n.style.left=o+"px";n.style.top=l+"px";n.style.right=p-a-o+"px";n.style.bottom=s-h-l+"px";c.style.left=v+"px";c.style.top=w+"px";c.style.width=q+"px";c.style.height=j+e+"px";if(t)t.style.left=c.style.left,t.style.top=c.style.top,t.style.width=c.style.width,t.style.height=c.style.height}else{o=v;l=e;p=v+g;s=e+j;o===0&&(o-=f.left);l===0&&(l-=f.top);p===q&&(p+=f.right);i.y+j===m&&(s+=f.bottom);c.style.clip="rect("+l+"px,"+p+"px,"+s+"px,"+o+"px)";
c.style.left=-v+h+f.left+"px";c.style.width=(b.isWebkit?q:g+v)+"px";if(!a)c.style.top=-e+f.top+"px",c.style.height=j+e+"px";if(t&&(t.style.clip=c.style.clip,t.style.left=c.style.left,t.style.width=c.style.width,!a))t.style.top=c.style.top,t.style.height=c.style.height}this._updateDOMSelection();c=this._ensureCaretVisible;this._ensureCaretVisible=!1;j!==this._getClientHeight()&&(this._update(),c&&this._showCaret())}}},_updateRuler:function(a,c,f,i){if(a)for(var a=a.firstChild.rows[0].cells,l=this._parent.ownerDocument,
m=this._getLineHeight(),g=this._getViewPadding(),q=0;q<a.length;q++){var h=a[q].firstChild,n=h._ruler,j=m,u=n.getOverview();u==="page"&&(j+=this._topIndexY);h.style.top=-j+"px";h.style.height=i+j+"px";h.rulerChanged&&e(n.getRulerStyle(),h);var t,o=h.firstChild;o?(t=o,o=o.nextSibling):(t=b.createElement(l,"div"),t.style.visibility="hidden",h.appendChild(t));var p;if(h.rulerChanged&&t){j=-1;if(p=n.getWidestAnnotation())if(e(p.style,t),p.html)t.innerHTML=p.html;t.lineIndex=j;t.style.height=m+g.top+"px"}var s;
if(u==="page"){for(n=n.getAnnotations(c,f+1);o;)j=o.lineIndex,p=o.nextSibling,(!(c<=j&&j<=f)||o.lineChanged)&&h.removeChild(o),o=p;o=h.firstChild.nextSibling;s=l.createDocumentFragment();for(j=c;j<=f;j++)if(!o||o.lineIndex>j){t=b.createElement(l,"div");if(p=n[j]){e(p.style,t);if(p.html)t.innerHTML=p.html;t.annotation=p}t.lineIndex=j;t.style.height=this._getLineHeight(j)+"px";s.appendChild(t)}else if(s.firstChild&&(h.insertBefore(s,o),s=l.createDocumentFragment()),o)o=o.nextSibling;s.firstChild&&h.insertBefore(s,
o)}else{p=this._getClientHeight();j=this._model.getLineCount();o=p+g.top+g.bottom-2*this._metrics.scrollWidth;u=m*j<o?m:o/j;if(h.rulerChanged){for(p=h.childNodes.length;p>1;)h.removeChild(h.lastChild),p--;n=n.getAnnotations(0,j);s=l.createDocumentFragment();for(var v in n)if(j=v>>>0,!(j<0)){t=b.createElement(l,"div");p=n[v];e(p.style,t);t.style.position="absolute";t.style.top=this._metrics.scrollWidth+m+Math.floor(j*u)+"px";if(p.html)t.innerHTML=p.html;t.annotation=p;t.lineIndex=j;s.appendChild(t)}h.appendChild(s)}else if(h._oldTrackHeight!==
o)for(t=h.firstChild?h.firstChild.nextSibling:null;t;)t.style.top=this._metrics.scrollWidth+m+Math.floor(t.lineIndex*u)+"px",t=t.nextSibling;h._oldTrackHeight=o}h.rulerChanged=!1}},_updateStyle:function(a){if(!a&&b.isIE)this._rootDiv.style.lineHeight="normal";var c=this._metrics=this._calculateMetrics();this._rootDiv.style.lineHeight=b.isIE?c.lineHeight-(c.lineTrim.top+c.lineTrim.bottom)+"px":"normal";a||(this.redraw(),this._resetLineWidth())}};o.EventTarget.addMixin(t.prototype);return{TextView:t}});
(function(){function s(b,f,e,h,g,a){f[b]&&(e.push(b),(f[b]===!0||f[b]===1)&&h.push(g+b+"/"+a))}function p(b,f,e,h,g){f=h+f+"/"+g;require._fileExists(b.toUrl(f))&&e.push(f)}var o=/(^.*(^|\/)nls(\/|$))([^\/]*)\/?([^\/]*)/,j={};define("i18n",{version:"1.0.0",load:function(b,f,e,h){var h=h||{},g=o.exec(b),a=g[1],c=g[4],q=g[5],l=c.split("-"),n=[],u={},t,d,k="";g[5]?(a=g[1],b=a+q):(q=g[4],c=h.locale||(h.locale=typeof navigator==="undefined"?"root":(navigator.language||navigator.userLanguage||"root").toLowerCase()),
l=c.split("-"));if(h.isBuild){n.push(b);p(f,"root",n,a,q);for(t=0;d=l[t];t++)k+=(k?"-":"")+d,p(f,k,n,a,q);f(n,function(){e()})}else f([b],function(c){var b=[];s("root",c,b,n,a,q);for(t=0;d=l[t];t++)k+=(k?"-":"")+d,s(k,c,b,n,a,q);f(n,function(){var l,m;for(l=b.length-1;l>-1&&(d=b[l]);l--){m=c[d];if(m===!0||m===1)m=f(a+d+"/"+q);var g=u,k=void 0;for(k in m)!(k in j)&&!(k in g)&&(g[k]=m[k])}e(u)})})}})})();
define("orion/editor/i18n",{load:function(s,p,o){p.specified&&p.specified("orion/bootstrap")?p(["orion/i18n!"+s],function(j){o(j)}):o({})}});
define("orion/editor/nls/root/messages",{multipleAnnotations:"Multiple annotations:",line:"Line: ${0}",breakpoint:"Breakpoint",bookmark:"Bookmark",task:"Task",error:"Error",warning:"Warning",matchingSearch:"Matching Search",currentSearch:"Current Search",currentLine:"Current Line",matchingBracket:"Matching Bracket",currentBracket:"Current Bracket",Comment:"Comment","Flat outline":"Flat outline",incrementalFind:"Incremental find: ${0}",incrementalFindNotFound:"Incremental find: ${0} (not found)",find:"Find...",
undo:"Undo",redo:"Redo",cancelMode:"Cancel Current Mode",findNext:"Find Next Occurrence",findPrevious:"Find Previous Occurrence",incrementalFindKey:"Incremental Find",indentLines:"Indent Lines",unindentLines:"Unindent Lines",moveLinesUp:"Move Lines Up",moveLinesDown:"Move Lines Down",copyLinesUp:"Copy Lines Up",copyLinesDown:"Copy Lines Down",deleteLines:"Delete Lines",gotoLine:"Goto Line...",gotoLinePrompty:"Goto Line:",nextAnnotation:"Next Annotation",prevAnnotation:"Previous Annotation",expand:"Expand",
collapse:"Collapse",expandAll:"Expand All",collapseAll:"Collapse All",lastEdit:"Last Edit Location",toggleLineComment:"Toggle Line Comment",addBlockComment:"Add Block Comment",removeBlockComment:"Remove Block Comment",linkedModeEntered:"Linked Mode entered",linkedModeExited:"Linked Mode exited",syntaxError:"Syntax Error",contentAssist:"Content Assist",lineColumn:"Line ${0} : Col ${1}"});
define("orion/editor/nls/messages",["orion/editor/i18n!orion/editor/nls/messages","orion/editor/nls/root/messages"],function(s,p){var o={root:p},j;for(j in s)s.hasOwnProperty(j)&&typeof o[j]==="undefined"&&(o[j]=s[j]);return o});
define("orion/editor/annotations",["i18n!orion/editor/nls/messages","orion/editor/eventTarget"],function(s,p){function o(a,c,b){this.start=a;this.end=c;this._projectionModel=b;this.html=this._expandedHTML;this.style=this._expandedStyle;this.expanded=!0}function j(){}function b(a,c){var b=a.lastIndexOf("."),b=a.substring(b+1),e={title:s[b],style:{styleClass:"annotation "+b},html:"<div class='annotationHTML "+b+"'></div>",overviewStyle:{styleClass:"annotationOverview "+b}};c?e.lineStyle={styleClass:"annotationLine "+
b}:e.rangeStyle={styleClass:"annotationRange "+b};j.registerType(a,e)}function f(){}function e(a){this._annotations=[];var c=this;this._listener={onChanged:function(a){c._onChanged(a)}};this.setTextModel(a)}function h(a,c){this._view=a;this._annotationModel=c;var b=this;this._listener={onDestroy:function(a){b._onDestroy(a)},onLineStyle:function(a){b._onLineStyle(a)},onChanged:function(a){b._onAnnotationModelChanged(a)}};a.addEventListener("Destroy",this._listener.onDestroy);a.addEventListener("postLineStyle",
this._listener.onLineStyle);c.addEventListener("Changed",this._listener.onChanged)}o.prototype={_expandedHTML:"<div class='annotationHTML expanded'></div>",_expandedStyle:{styleClass:"annotation expanded"},_collapsedHTML:"<div class='annotationHTML collapsed'></div>",_collapsedStyle:{styleClass:"annotation collapsed"},collapse:function(){if(this.expanded){this.expanded=!1;this.html=this._collapsedHTML;this.style=this._collapsedStyle;var a=this._projectionModel,c=a.getBaseModel();this._projection=
{start:c.getLineStart(c.getLineAtOffset(this.start)+1),end:c.getLineEnd(c.getLineAtOffset(this.end),!0)};a.addProjection(this._projection)}},expand:function(){if(!this.expanded)this.expanded=!0,this.html=this._expandedHTML,this.style=this._expandedStyle,this._projectionModel.removeProjection(this._projection)}};j.ANNOTATION_ERROR="orion.annotation.error";j.ANNOTATION_WARNING="orion.annotation.warning";j.ANNOTATION_TASK="orion.annotation.task";j.ANNOTATION_BREAKPOINT="orion.annotation.breakpoint";
j.ANNOTATION_BOOKMARK="orion.annotation.bookmark";j.ANNOTATION_FOLDING="orion.annotation.folding";j.ANNOTATION_CURRENT_BRACKET="orion.annotation.currentBracket";j.ANNOTATION_MATCHING_BRACKET="orion.annotation.matchingBracket";j.ANNOTATION_CURRENT_LINE="orion.annotation.currentLine";j.ANNOTATION_CURRENT_SEARCH="orion.annotation.currentSearch";j.ANNOTATION_MATCHING_SEARCH="orion.annotation.matchingSearch";j.ANNOTATION_READ_OCCURRENCE="orion.annotation.readOccurrence";j.ANNOTATION_WRITE_OCCURRENCE="orion.annotation.writeOccurrence";
var g={};j.registerType=function(a,c){var b=c;if(typeof b!=="function")b=function(a,c,b){this.start=a;this.end=c;if(b)this.title=b},b.prototype=c;b.prototype.type=a;g[a]=b;return a};j.createAnnotation=function(a,c,b,e){return new (this.getType(a))(c,b,e)};j.getType=function(a){return g[a]};b(j.ANNOTATION_ERROR);b(j.ANNOTATION_WARNING);b(j.ANNOTATION_TASK);b(j.ANNOTATION_BREAKPOINT);b(j.ANNOTATION_BOOKMARK);b(j.ANNOTATION_CURRENT_BRACKET);b(j.ANNOTATION_MATCHING_BRACKET);b(j.ANNOTATION_CURRENT_SEARCH);
b(j.ANNOTATION_MATCHING_SEARCH);b(j.ANNOTATION_READ_OCCURRENCE);b(j.ANNOTATION_WRITE_OCCURRENCE);b(j.ANNOTATION_CURRENT_LINE,!0);j.registerType(j.ANNOTATION_FOLDING,o);f.addMixin=function(a){var c=f.prototype,b;for(b in c)c.hasOwnProperty(b)&&(a[b]=c[b])};f.prototype={addAnnotationType:function(a){if(!this._annotationTypes)this._annotationTypes=[];this._annotationTypes.push(a)},getAnnotationTypePriority:function(a){if(this._annotationTypes)for(var c=0;c<this._annotationTypes.length;c++)if(this._annotationTypes[c]===
a)return c+1;return 0},getAnnotationsByType:function(a,c,b){a=a.getAnnotations(c,b);for(b=[];a.hasNext();)c=a.next(),this.getAnnotationTypePriority(c.type)!==0&&b.push(c);var e=this;b.sort(function(a,c){return e.getAnnotationTypePriority(a.type)-e.getAnnotationTypePriority(c.type)});return b},isAnnotationTypeVisible:function(a){return this.getAnnotationTypePriority(a)!==0},removeAnnotationType:function(a){if(this._annotationTypes)for(var c=0;c<this._annotationTypes.length;c++)if(this._annotationTypes[c]===
a){this._annotationTypes.splice(c,1);break}}};e.prototype={addAnnotation:function(a){if(a){var c=this._annotations,b=this._binarySearch(c,a.start);c.splice(b,0,a);this.onChanged({type:"Changed",added:[a],removed:[],changed:[]})}},getTextModel:function(){return this._model},getAnnotations:function(a,c){var b=this._annotations,e,f=0,g=function(){for(;f<b.length;){var e=b[f++];if(a===e.start||(a>e.start?a<e.end:e.start<c))return e;if(e.start>=c)break}return null};e=g();return{next:function(){var a=e;
a&&(e=g());return a},hasNext:function(){return e!==null}}},modifyAnnotation:function(a){if(a&&!(this._getAnnotationIndex(a)<0))this.onChanged({type:"Changed",added:[],removed:[],changed:[a]})},onChanged:function(a){return this.dispatchEvent(a)},removeAnnotations:function(a){var c=this._annotations,b,e;if(a){b=[];for(e=c.length-1;e>=0;e--){var f=c[e];f.type===a&&c.splice(e,1);b.splice(0,0,f)}}else b=c;this.onChanged({type:"Changed",removed:b,added:[],changed:[]})},removeAnnotation:function(a){if(a&&
(a=this._getAnnotationIndex(a),!(a<0)))this.onChanged({type:"Changed",removed:this._annotations.splice(a,1),added:[],changed:[]})},replaceAnnotations:function(a,c){var b=this._annotations,e,f,g,h=[];if(a)for(e=a.length-1;e>=0;e--)g=a[e],f=this._getAnnotationIndex(g),f<0||(b.splice(f,1),h.splice(0,0,g));c||(c=[]);for(e=0;e<c.length;e++)g=c[e],f=this._binarySearch(b,g.start),b.splice(f,0,g);this.onChanged({type:"Changed",removed:h,added:c,changed:[]})},setTextModel:function(a){this._model&&this._model.removeEventListener("Changed",
this._listener.onChanged);(this._model=a)&&this._model.addEventListener("Changed",this._listener.onChanged)},_binarySearch:function(a,c){for(var b=a.length,e=-1,f;b-e>1;)f=Math.floor((b+e)/2),c<=a[f].start?b=f:e=f;return b},_getAnnotationIndex:function(a){for(var c=this._annotations,b=this._binarySearch(c,a.start);b<c.length&&c[b].start===a.start;){if(c[b]===a)return b;b++}return-1},_onChanged:function(a){var c=a.start,b=a.removedCharCount,e=this._annotations,f=c+b;if(0<e.length){for(var g={type:"Changed",
added:[],removed:[],changed:[],textModelChangedEvent:a},a=a.addedCharCount-b,b=0;b<e.length;b++){var h=e[b];h.start>=f?(h.start+=a,h.end+=a,g.changed.push(h)):h.end<=c||(h.start<c&&f<h.end?(h.end+=a,g.changed.push(h)):(e.splice(b,1),g.removed.push(h),b--))}if(g.added.length>0||g.removed.length>0||g.changed.length>0)this.onChanged(g)}}};p.EventTarget.addMixin(e.prototype);h.prototype={destroy:function(){var a=this._view;if(a)a.removeEventListener("Destroy",this._listener.onDestroy),a.removeEventListener("LineStyle",
this._listener.onLineStyle),this.view=null;(a=this._annotationModel)&&a.removeEventListener("Changed",this._listener.onChanged)},_mergeStyle:function(a,c){if(c){a||(a={});a.styleClass&&c.styleClass&&a.styleClass!==c.styleClass?a.styleClass+=" "+c.styleClass:a.styleClass=c.styleClass;var b;if(c.style){if(!a.style)a.style={};for(b in c.style)a.style[b]||(a.style[b]=c.style[b])}if(c.attributes){if(!a.attributes)a.attributes={};for(b in c.attributes)a.attributes[b]||(a.attributes[b]=c.attributes[b])}}return a},
_mergeStyleRanges:function(a,c){a||(a=[]);var b,e;for(e=0;e<a.length&&c;e++){var f=a[e];if(c.end<=f.start)break;if(!(c.start>=f.end)){b=this._mergeStyle({},f.style);b=this._mergeStyle(b,c.style);var g=[];g.push(e,1);c.start<f.start&&g.push({start:c.start,end:f.start,style:c.style});c.start>f.start&&g.push({start:f.start,end:c.start,style:f.style});g.push({start:Math.max(f.start,c.start),end:Math.min(f.end,c.end),style:b});c.end<f.end&&g.push({start:c.end,end:f.end,style:f.style});c=c.end>f.end?{start:f.end,
end:c.end,style:c.style}:null;Array.prototype.splice.apply(a,g)}}c&&(b=this._mergeStyle({},c.style),a.splice(e,0,{start:c.start,end:c.end,style:b}));return a},_onAnnotationModelChanged:function(a){function c(a){for(var c=0;c<a.length;c++)if(e.isAnnotationTypeVisible(a[c].type)){var d=a[c].start,g=a[c].end;f.getBaseModel&&(d=f.mapOffset(d,!0),g=f.mapOffset(g,!0));d!==-1&&g!==-1&&b.redrawRange(d,g)}}if(!a.textModelChangedEvent){var b=this._view;if(b){var e=this,f=b.getModel();c(a.added);c(a.removed);
c(a.changed)}}},_onDestroy:function(){this.destroy()},_onLineStyle:function(a){var c=this._annotationModel,b=a.textView.getModel(),e=c.getTextModel(),f=a.lineStart,g=a.lineStart+a.lineText.length;e!==b&&(f=b.mapOffset(f),g=b.mapOffset(g));for(c=c.getAnnotations(f,g);c.hasNext();)if(f=c.next(),this.isAnnotationTypeVisible(f.type)){if(f.rangeStyle){var g=f.start,h=f.end;e!==b&&(g=b.mapOffset(g,!0),h=b.mapOffset(h,!0));a.ranges=this._mergeStyleRanges(a.ranges,{start:g,end:h,style:f.rangeStyle})}if(f.lineStyle)a.style=
this._mergeStyle({},a.style),a.style=this._mergeStyle(a.style,f.lineStyle)}}};f.addMixin(h.prototype);return{FoldingAnnotation:o,AnnotationType:j,AnnotationTypeList:f,AnnotationModel:e,AnnotationStyler:h}});
define("orion/editor/tooltip",["i18n!orion/editor/nls/messages","orion/editor/textView","orion/editor/textModel","orion/editor/projectionTextModel","orion/util"],function(s,p,o,j,b){function f(b){this._view=b;this._create(b.getOptions("parent").ownerDocument);b.addEventListener("Destroy",this,this.destroy)}f.getTooltip=function(b){if(!b._tooltip)b._tooltip=new f(b);return b._tooltip};f.prototype={_create:function(e){if(!this._tooltipDiv){var f=this._tooltipDiv=b.createElement(e,"div");f.className=
"textviewTooltip";f.setAttribute("aria-live","assertive");f.setAttribute("aria-atomic","true");var g=this._tooltipContents=b.createElement(e,"div");f.appendChild(g);e.body.appendChild(f);this.hide()}},_getWindow:function(){var b=this._tooltipDiv.ownerDocument;return b.defaultView||b.parentWindow},destroy:function(){if(this._tooltipDiv){this.hide();var b=this._tooltipDiv.parentNode;b&&b.removeChild(this._tooltipDiv);this._tooltipDiv=null}},hide:function(){if(this._contentsView)this._contentsView.destroy(),
this._contentsView=null;if(this._tooltipContents)this._tooltipContents.innerHTML="";if(this._tooltipDiv)this._tooltipDiv.style.visibility="hidden";var b=this._getWindow();if(this._showTimeout)b.clearTimeout(this._showTimeout),this._showTimeout=null;if(this._hideTimeout)b.clearTimeout(this._hideTimeout),this._hideTimeout=null;if(this._fadeTimeout)b.clearInterval(this._fadeTimeout),this._fadeTimeout=null},isVisible:function(){return this._tooltipDiv&&this._tooltipDiv.style.visibility==="visible"},setTarget:function(b,
f){if(this.target!==b&&(this._target=b,this.hide(),b)){var g=this;if(f===0)g.show(!0);else{var a=this._getWindow();g._showTimeout=a.setTimeout(function(){g.show(!0)},f?f:500)}}},show:function(b){if(this._target){var f=this._target.getTooltipInfo();if(f){var g=this._tooltipDiv,a=this._tooltipContents;g.style.left=g.style.right=g.style.width=g.style.height=a.style.width=a.style.height="auto";var c=f.contents;c instanceof Array&&(c=this._getAnnotationContents(c));if(typeof c==="string")a.innerHTML=c;
else if(this._isNode(c))a.appendChild(c);else if(c instanceof j.ProjectionTextModel){var q=this._view,l=q.getOptions();l.wrapMode=!1;l.parent=a;var n=l.themeClass;n?((n=n.replace("tooltip",""))&&(n=" "+n),n="tooltip"+n):n="tooltip";l.themeClass=n;l=this._contentsView=new p.TextView(l);l._clientDiv.contentEditable=!1;l.addEventListener("LineStyle",function(a){q.onLineStyle(a)});l.setModel(c);c=l.computeSize();a.style.width=c.width+20+"px";a.style.height=c.height+"px";l.resize()}else return;a=g.ownerDocument.documentElement;
f.anchor==="right"?(c=a.clientWidth-f.x,g.style.right=c+"px"):(c=parseInt(this._getNodeStyle(g,"padding-left","0"),10),c+=parseInt(this._getNodeStyle(g,"border-left-width","0"),10),c=f.x-c,g.style.left=c+"px");g.style.maxWidth=a.clientWidth-c-10+"px";c=parseInt(this._getNodeStyle(g,"padding-top","0"),10);c+=parseInt(this._getNodeStyle(g,"border-top-width","0"),10);c=f.y-c;g.style.top=c+"px";g.style.maxHeight=a.clientHeight-c-10+"px";g.style.opacity="1";g.style.visibility="visible";if(b){var u=this,
t=this._getWindow();u._hideTimeout=t.setTimeout(function(){var a=parseFloat(u._getNodeStyle(g,"opacity","1"));u._fadeTimeout=t.setInterval(function(){g.style.visibility==="visible"&&a>0?(a-=0.1,g.style.opacity=a):u.hide()},50)},5E3)}}}},_getAnnotationContents:function(b){function f(c){var b=c.title;if(b==="")return null;var e="<div>";c.html&&(e+=c.html+"&nbsp;");if(!b)b=c.end,c=a.getLineStart(a.getLineAtOffset(c.start)),b=a.getLineEnd(a.getLineAtOffset(b),!0),b=a.getText(c,b);b=b.replace(/</g,"&lt;").replace(/>/g,
"&gt;");e+="<span style='vertical-align:middle;'>"+b+"</span><div>";return e}if(b.length===0)return null;var g=this._view.getModel(),a=g.getBaseModel?g.getBaseModel():g;if(b.length===1)if(g=b[0],g.title!==void 0)return f(g);else{var b=new j.ProjectionTextModel(a),c=a.getLineStart(a.getLineAtOffset(g.start)),q=a.getCharCount();g.end!==q&&b.addProjection({start:g.end,end:q});c>0&&b.addProjection({start:0,end:c});return b}else{c="<div><em>"+s.multipleAnnotations+"</em></div>";for(q=0;q<b.length;q++)g=
b[q],(g=f(g))&&(c+=g);return c}},_getNodeStyle:function(b,f,g){var a;if(b&&(a=b.style[f],!a))if(b.currentStyle){for(a=0;(a=f.indexOf("-",a))!==-1;)f=f.substring(0,a)+f.substring(a+1,a+2).toUpperCase()+f.substring(a+2);a=b.currentStyle[f]}else a=(b=b.ownerDocument.defaultView.getComputedStyle(b,null))?b.getPropertyValue(f):null;return a||g},_isNode:function(b){return typeof Node==="object"?b instanceof Node:b&&typeof b==="object"&&typeof b.nodeType==="number"&&typeof b.nodeName==="string"}};return{Tooltip:f}});
define("orion/editor/rulers",["i18n!orion/editor/nls/messages","orion/editor/annotations","orion/editor/tooltip","orion/util"],function(s,p,o,j){function b(a,c,b,e){this._location=c||"left";this._overview=b||"page";this._rulerStyle=e;this._view=null;var f=this;this._listener={onTextModelChanged:function(a){f._onTextModelChanged(a)},onAnnotationModelChanged:function(a){f._onAnnotationModelChanged(a)}};this.setAnnotationModel(a)}function f(a,c,e,f,g){b.call(this,a,c,"page",e);this._oddStyle=f||{style:{backgroundColor:"white"}};
this._evenStyle=g||{style:{backgroundColor:"white"}};this._numOfDigits=0}function e(a,c,e){b.call(this,a,c,"page",e)}function h(a,c,e){b.call(this,a,c,"document",e)}function g(a,c,b){e.call(this,a,c,b)}b.prototype={getAnnotations:function(a,c){var b=this._annotationModel;if(!b)return[];var e=this._view.getModel(),f=e.getLineStart(a),g=e.getLineEnd(c-1),h=e;e.getBaseModel&&(h=e.getBaseModel(),f=e.mapOffset(f),g=e.mapOffset(g));for(var d=[],b=this.getAnnotationsByType(b,f,g),f=0;f<b.length;f++)for(var g=
b[f],k=h.getLineAtOffset(g.start),j=h.getLineAtOffset(Math.max(g.start,g.end-1)),i=k;i<=j;i++){var x=i;if(e!==h){x=h.getLineStart(i);x=e.mapOffset(x,!0);if(x===-1)continue;x=e.getLineAtOffset(x)}if(a<=x&&x<c){var m=this._mergeAnnotation(d[x],g,i-k,j-k+1);m&&(d[x]=m)}}if(!this._multiAnnotation&&this._multiAnnotationOverlay)for(var y in d)d[y]._multiple&&(d[y].html+=this._multiAnnotationOverlay.html);return d},getAnnotationModel:function(){return this._annotationModel},getLocation:function(){return this._location},
getOverview:function(){return this._overview},getRulerStyle:function(){return this._rulerStyle},getView:function(){return this._view},getWidestAnnotation:function(){return null},setAnnotationModel:function(a){this._annotationModel&&this._annotationModel.removEventListener("Changed",this._listener.onAnnotationModelChanged);(this._annotationModel=a)&&this._annotationModel.addEventListener("Changed",this._listener.onAnnotationModelChanged)},setMultiAnnotation:function(a){this._multiAnnotation=a},setMultiAnnotationOverlay:function(a){this._multiAnnotationOverlay=
a},setView:function(a){this._onTextModelChanged&&this._view&&this._view.removeEventListener("ModelChanged",this._listener.onTextModelChanged);this._view=a;this._onTextModelChanged&&this._view&&this._view.addEventListener("ModelChanged",this._listener.onTextModelChanged)},onClick:function(){},onDblClick:function(){},onMouseMove:function(a,c){var b=o.Tooltip.getTooltip(this._view);if(b&&!(b.isVisible()&&this._tooltipLineIndex===a)){this._tooltipLineIndex=a;var e=this;b.setTarget({y:c.clientY,getTooltipInfo:function(){return e._getTooltipInfo(e._tooltipLineIndex,
this.y)}})}},onMouseOver:function(a,c){this.onMouseMove(a,c)},onMouseOut:function(){var a=o.Tooltip.getTooltip(this._view);a&&a.setTarget(null)},_getTooltipInfo:function(a,c){if(a!==void 0){var b=this._view,e=b.getModel(),f=this._annotationModel,g=[];if(f){var g=e.getLineStart(a),h=e.getLineEnd(a);e.getBaseModel&&(g=e.mapOffset(g),h=e.mapOffset(h));g=this.getAnnotationsByType(f,g,h)}f=this._getTooltipContents(a,g);if(!f)return null;f={contents:f,anchor:this.getLocation()};g=b.getClientArea();g.y=
this.getOverview()==="document"?b.convert({y:c},"view","document").y:b.getLocationAtOffset(e.getLineStart(a)).y;b.convert(g,"document","page");f.x=g.x;f.y=g.y;f.anchor==="right"&&(f.x+=g.width);return f}},_getTooltipContents:function(a,c){return c},_onAnnotationModelChanged:function(a){function c(a){for(var c=0;c<a.length;c++)if(f.isAnnotationTypeVisible(a[c].type)){var g=a[c].start,h=a[c].end;e.getBaseModel&&(g=e.mapOffset(g,!0),h=e.mapOffset(h,!0));g!==-1&&h!==-1&&b.redrawLines(e.getLineAtOffset(g),
e.getLineAtOffset(Math.max(g,h-1))+1,f)}}var b=this._view;if(b){var e=b.getModel(),f=this,g=e.getLineCount();a.textModelChangedEvent?(a=a.textModelChangedEvent.start,e.getBaseModel&&(a=e.mapOffset(a,!0)),a=e.getLineAtOffset(a),b.redrawLines(a,g,f)):(c(a.added),c(a.removed),c(a.changed))}},_mergeAnnotation:function(a,c,b){a||(a={});if(b===0)if(a.html&&c.html){if(c.html!==a.html&&!a._multiple&&this._multiAnnotation)a.html=this._multiAnnotation.html;a._multiple=!0}else a.html=c.html;a.style=this._mergeStyle(a.style,
c.style);return a},_mergeStyle:function(a,c){if(c){a||(a={});a.styleClass&&c.styleClass&&a.styleClass!==c.styleClass?a.styleClass+=" "+c.styleClass:a.styleClass=c.styleClass;var b;if(c.style){if(!a.style)a.style={};for(b in c.style)a.style[b]||(a.style[b]=c.style[b])}if(c.attributes){if(!a.attributes)a.attributes={};for(b in c.attributes)a.attributes[b]||(a.attributes[b]=c.attributes[b])}}return a}};p.AnnotationTypeList.addMixin(b.prototype);f.prototype=new b;f.prototype.getAnnotations=function(a,
c){for(var e=b.prototype.getAnnotations.call(this,a,c),f=this._view.getModel(),g=a;g<c;g++){var h=g&1?this._oddStyle:this._evenStyle,j=g;f.getBaseModel&&(j=f.getLineStart(j),j=f.getBaseModel().getLineAtOffset(f.mapOffset(j)));e[g]||(e[g]={});e[g].html=j+1+"";if(!e[g].style)e[g].style=h}return e};f.prototype.getWidestAnnotation=function(){var a=this._view.getModel().getLineCount();return this.getAnnotations(a-1,a)[a-1]};f.prototype._onTextModelChanged=function(a){var a=a.start,c=this._view.getModel(),
b=((c.getBaseModel?c.getBaseModel().getLineCount():c.getLineCount())+"").length;if(this._numOfDigits!==b)this._numOfDigits=b,this._view.redrawLines(c.getLineAtOffset(a),c.getLineCount(),this)};e.prototype=new b;h.prototype=new b;h.prototype.getRulerStyle=function(){var a={style:{lineHeight:"1px",fontSize:"1px"}};return a=this._mergeStyle(a,this._rulerStyle)};h.prototype.onClick=function(a){a!==void 0&&this._view.setTopIndex(a)};h.prototype._getTooltipContents=function(a,c){if(c.length===0){var e=
this._view.getModel(),f=a;e.getBaseModel&&(f=e.getLineStart(f),f=e.getBaseModel().getLineAtOffset(e.mapOffset(f)));return j.formatMessage(s.line,f+1)}return b.prototype._getTooltipContents.call(this,a,c)};h.prototype._mergeAnnotation=function(a,c,b,e){if(b===0){if(!a)a={html:"&nbsp;",style:{style:{height:3*e+"px"}}},a.style=this._mergeStyle(a.style,c.overviewStyle);return a}};g.prototype=new e;g.prototype.onClick=function(a){if(a!==void 0){var c=this._annotationModel;if(c){var b=this._view.getModel(),
e=b.getLineStart(a),a=b.getLineEnd(a,!0);b.getBaseModel&&(e=b.mapOffset(e),a=b.mapOffset(a),b=b.getBaseModel());for(var f,c=c.getAnnotations(e,a);!f&&c.hasNext();)a=c.next(),this.isAnnotationTypeVisible(a.type)&&(f=a);f&&b.getLineAtOffset(f.start)===b.getLineAtOffset(e)&&((b=o.Tooltip.getTooltip(this._view))&&b.setTarget(null),f.expanded?f.collapse():f.expand(),this._annotationModel.modifyAnnotation(f))}}};g.prototype._getTooltipContents=function(a,c){return c.length===1&&c[0].expanded?null:e.prototype._getTooltipContents.call(this,
a,c)};g.prototype._onAnnotationModelChanged=function(a){function c(a){for(h=0;h<a.length;h++)if(g.isAnnotationTypeVisible(a[h].type)){var c=a[h].start;f.getBaseModel&&(c=f.mapOffset(c,!0));c!==-1&&(d=Math.min(d,f.getLineAtOffset(c)))}}if(a.textModelChangedEvent)e.prototype._onAnnotationModelChanged.call(this,a);else{var b=this._view;if(b){var f=b.getModel(),g=this,h,j=f.getLineCount(),d=j;c(a.added);c(a.removed);c(a.changed);a=b.getRulers();for(h=0;h<a.length;h++)b.redrawLines(d,j,a[h])}}};return{Ruler:b,
AnnotationRuler:e,LineNumberRuler:f,OverviewRuler:h,FoldingRuler:g}});
define("orion/editor/undoStack",[],function(){function s(j,b,f){this.offset=j;this.text=b;this.previousText=f}function p(){this.changes=[]}function o(j,b){this.view=j;this.size=b!==void 0?b:100;this.reset();var f=j.getModel();f.getBaseModel&&(f=f.getBaseModel());this.model=f;var e=this;this._listener={onChanging:function(b){e._onChanging(b)},onDestroy:function(b){e._onDestroy(b)}};f.addEventListener("Changing",this._listener.onChanging);j.addEventListener("Destroy",this._listener.onDestroy)}s.prototype=
{undo:function(j,b){this._doUndoRedo(this.offset,this.previousText,this.text,j,b)},redo:function(j,b){this._doUndoRedo(this.offset,this.text,this.previousText,j,b)},_doUndoRedo:function(j,b,f,e,h){var g=e.getModel();if(g.mapOffset&&e.annotationModel){var a=g.mapOffset(j,!0);if(a<0)for(var c=e.annotationModel.getAnnotations(j,j+1);c.hasNext();){var q=c.next();if(q.type==="orion.annotation.folding"){q.expand();a=g.mapOffset(j,!0);break}}if(a<0)return;j=a}e.setText(b,j,j+f.length);h&&e.setSelection(j,
j+b.length)}};p.prototype={add:function(j){this.changes.push(j)},end:function(j){this.endSelection=j.getSelection();this.endCaret=j.getCaretOffset()},undo:function(j,b){for(var f=this.changes.length-1;f>=0;f--)this.changes[f].undo(j,!1);if(b){var f=this.startSelection.start,e=this.startSelection.end;j.setSelection(this.startCaret?f:e,this.startCaret?e:f)}},redo:function(j,b){for(var f=0;f<this.changes.length;f++)this.changes[f].redo(j,!1);if(b){var f=this.endSelection.start,e=this.endSelection.end;
j.setSelection(this.endCaret?f:e,this.endCaret?e:f)}},start:function(j){this.startSelection=j.getSelection();this.startCaret=j.getCaretOffset()}};o.prototype={add:function(j){this.compoundChange?this.compoundChange.add(j):(this.stack.splice(this.index,this.stack.length-this.index,j),this.index++,this.stack.length>this.size&&(this.stack.shift(),this.index--,this.cleanIndex--))},markClean:function(){this.endCompoundChange();this._commitUndo();this.cleanIndex=this.index},isClean:function(){return this.cleanIndex===
this.getSize().undo},canUndo:function(){return this.getSize().undo>0},canRedo:function(){return this.getSize().redo>0},endCompoundChange:function(){this.compoundChange&&this.compoundChange.end(this.view);this.compoundChange=void 0},getSize:function(){var j=this.index,b=this.stack.length;this._undoStart!==void 0&&j++;return{undo:j,redo:b-j}},undo:function(){this._commitUndo();if(this.index<=0)return!1;var j=this.stack[--this.index];this._ignoreUndo=!0;j.undo(this.view,!0);this._ignoreUndo=!1;return!0},
redo:function(){this._commitUndo();if(this.index>=this.stack.length)return!1;var j=this.stack[this.index++];this._ignoreUndo=!0;j.redo(this.view,!0);this._ignoreUndo=!1;return!0},reset:function(){this.index=this.cleanIndex=0;this.stack=[];this._undoStart=void 0;this._undoText="";this._undoType=0;this._ignoreUndo=!1;this._compoundChange=void 0},startCompoundChange:function(){this._commitUndo();var j=new p;this.add(j);this.compoundChange=j;this.compoundChange.start(this.view)},_commitUndo:function(){if(this._undoStart!==
void 0)this._undoType===-1?this.add(new s(this._undoStart,"",this._undoText)):this.add(new s(this._undoStart,this._undoText,"")),this._undoStart=void 0,this._undoText="",this._undoType=0},_onDestroy:function(){this.model.removeEventListener("Changing",this._listener.onChanging);this.view.removeEventListener("Destroy",this._listener.onDestroy)},_onChanging:function(j){var b=j.text,f=j.start,e=j.removedCharCount,j=j.addedCharCount;if(!this._ignoreUndo){this._undoStart!==void 0&&!(j===1&&e===0&&this._undoType===
1&&f===this._undoStart+this._undoText.length||j===0&&e===1&&this._undoType===-1&&(f+1===this._undoStart||f===this._undoStart))&&this._commitUndo();if(!this.compoundChange)if(j===1&&e===0){if(this._undoStart===void 0)this._undoStart=f;this._undoText+=b;this._undoType=1;return}else if(j===0&&e===1){b=this._undoText.length>0&&this._undoStart===f;this._undoStart=f;this._undoType=-1;b?this._undoText+=this.model.getText(f,f+e):this._undoText=this.model.getText(f,f+e)+this._undoText;return}this.add(new s(f,
b,this.model.getText(f,f+e)))}}};return{UndoStack:o}});
define("orion/editor/textDND",[],function(){function s(p,o){this._view=p;this._undoStack=o;this._dragSelection=null;this._dropOffset=-1;this._dropText=null;var j=this;this._listener={onDragStart:function(b){j._onDragStart(b)},onDragEnd:function(b){j._onDragEnd(b)},onDragEnter:function(b){j._onDragEnter(b)},onDragOver:function(b){j._onDragOver(b)},onDrop:function(b){j._onDrop(b)},onDestroy:function(b){j._onDestroy(b)}};p.addEventListener("DragStart",this._listener.onDragStart);p.addEventListener("DragEnd",
this._listener.onDragEnd);p.addEventListener("DragEnter",this._listener.onDragEnter);p.addEventListener("DragOver",this._listener.onDragOver);p.addEventListener("Drop",this._listener.onDrop);p.addEventListener("Destroy",this._listener.onDestroy)}s.prototype={destroy:function(){var p=this._view;if(p)p.removeEventListener("DragStart",this._listener.onDragStart),p.removeEventListener("DragEnd",this._listener.onDragEnd),p.removeEventListener("DragEnter",this._listener.onDragEnter),p.removeEventListener("DragOver",
this._listener.onDragOver),p.removeEventListener("Drop",this._listener.onDrop),p.removeEventListener("Destroy",this._listener.onDestroy),this._view=null},_onDestroy:function(){this.destroy()},_onDragStart:function(p){var o=this._view,j=o.getSelection(),o=o.getModel();if(o.getBaseModel)j.start=o.mapOffset(j.start),j.end=o.mapOffset(j.end),o=o.getBaseModel();if(o=o.getText(j.start,j.end))this._dragSelection=j,p.event.dataTransfer.effectAllowed="copyMove",p.event.dataTransfer.setData("Text",o)},_onDragEnd:function(p){var o=
this._view;if(this._dragSelection){this._undoStack&&this._undoStack.startCompoundChange();(p=p.event.dataTransfer.dropEffect==="move")&&o.setText("",this._dragSelection.start,this._dragSelection.end);if(this._dropText){var j=this._dropText,b=this._dropOffset;if(p)if(b>=this._dragSelection.end)b-=this._dragSelection.end-this._dragSelection.start;else if(b>=this._dragSelection.start)b=this._dragSelection.start;o.setText(j,b,b);o.setSelection(b,b+j.length);this._dropText=null;this._dropOffset=-1}this._undoStack&&
this._undoStack.endCompoundChange()}this._dragSelection=null},_onDragEnter:function(p){this._onDragOver(p)},_onDragOver:function(p){var o=p.event.dataTransfer.types;if(o){var j=!this._view.getOptions("readonly");j&&(j=o.contains?o.contains("text/plain"):o.indexOf("text/plain")!==-1);if(!j)p.event.dataTransfer.dropEffect="none"}},_onDrop:function(p){var o=this._view,j=p.event.dataTransfer.getData("Text");if(j)p=o.getOffsetAtLocation(p.x,p.y),this._dragSelection?(this._dropOffset=p,this._dropText=j):
(o.setText(j,p,p),o.setSelection(p,p+j.length))}};return{TextDND:s}});
define("orion/editor/editor","i18n!orion/editor/nls/messages,orion/keyBinding,orion/editor/eventTarget,orion/editor/tooltip,orion/editor/annotations,orion/util".split(","),function(s,p,o,j,b,f){function e(a){this._textViewFactory=a.textViewFactory;this._undoStackFactory=a.undoStackFactory;this._textDNDFactory=a.textDNDFactory;this._annotationFactory=a.annotationFactory;this._foldingRulerFactory=a.foldingRulerFactory;this._lineNumberRulerFactory=a.lineNumberRulerFactory;this._contentAssistFactory=
a.contentAssistFactory;this._keyBindingFactory=a.keyBindingFactory;this._statusReporter=a.statusReporter;this._domNode=a.domNode;this._foldingRuler=this._overviewRuler=this._lineNumberRuler=this._annotationRuler=this._annotationModel=this._annotationStyler=null;this._dirty=!1;this._title=this._contentAssist=null;this._keyModes=[]}function h(a){var c=this,b=Array.prototype.slice.call(arguments,1);return b.length?function(){return arguments.length?c.apply(a,b.concat(Array.prototype.slice.call(arguments))):
c.apply(a,b)}:function(){return arguments.length?c.apply(a,arguments):c.call(a)}}var g;e.prototype={destroy:function(){this.uninstallTextView();this._textViewFactory=this._undoStackFactory=this._textDNDFactory=this._annotationFactory=this._foldingRulerFactory=this._lineNumberRulerFactory=this._contentAssistFactory=this._keyBindingFactory=this._statusReporter=this._domNode=null},getAnnotationModel:function(){return this._annotationModel},getAnnotationRuler:function(){return this._annotationRuler},
getAnnotationStyler:function(){return this._annotationStyler},getFoldingRuler:function(){return this._foldingRuler},getLineNumberRuler:function(){return this._lineNumberRuler},getModel:function(){var a=this._textView.getModel();a.getBaseModel&&(a=a.getBaseModel());return a},getOverviewRuler:function(){return this._overviewRuler},getTextView:function(){return this._textView},getTitle:function(){return this._title},getKeyModes:function(){return this._keyModes},isDirty:function(){return this._dirty},
setAnnotationRulerVisible:function(a){if(this._annotationRulerVisible!==a&&(this._annotationRulerVisible=a,this._annotationRuler)){var c=this._textView;a?c.addRuler(this._annotationRuler,0):c.removeRuler(this._annotationRuler)}},setFoldingRulerVisible:function(a){if(this._foldingRulerVisible!==a&&(this._foldingRulerVisible=a,this._foldingRuler)){var c=this._textView;c.getModel().getBaseModel&&(a?c.addRuler(this._foldingRuler,100):c.removeRuler(this._foldingRuler))}},setDirty:function(a){if(this._dirty!==
a)this._dirty=a,this.onDirtyChanged({type:"DirtyChanged"})},setLineNumberRulerVisible:function(a){if(this._lineNumberRulerVisible!==a&&(this._lineNumberRulerVisible=a,this._lineNumberRuler)){var c=this._textView;a?c.addRuler(this._lineNumberRuler,1):c.removeRuler(this._lineNumberRuler)}},setOverviewRulerVisible:function(a){if(this._overviewRulerVisible!==a&&(this._overviewRulerVisible=a,this._overviewRuler)){var c=this._textView;a?c.addRuler(this._overviewRuler):c.removeRuler(this._overviewRuler)}},
mapOffset:function(a,c){var b=this._textView.getModel();b.getBaseModel&&(a=b.mapOffset(a,c));return a},getCaretOffset:function(){return this.mapOffset(this._textView.getCaretOffset())},getSelection:function(){var a=this._textView,c=a.getSelection(),a=a.getModel();if(a.getBaseModel)c.start=a.mapOffset(c.start),c.end=a.mapOffset(c.end);return c},getText:function(a,c){var b=this._textView.getModel();b.getBaseModel&&(b=b.getBaseModel());return b.getText(a,c)},_expandOffset:function(a){var c=this._textView.getModel(),
e=this._annotationModel;if(e&&c.getBaseModel)for(a=e.getAnnotations(a,a+1);a.hasNext();)c=a.next(),c.type===b.AnnotationType.ANNOTATION_FOLDING&&c.expand&&(c.expand(),e.modifyAnnotation(c))},setCaretOffset:function(a){var c=this._textView,b=c.getModel();b.getBaseModel&&(this._expandOffset(a),a=b.mapOffset(a,!0));c.setCaretOffset(a)},setText:function(a,c,b){var e=this._textView,f=e.getModel();f.getBaseModel&&(c!==void 0&&(this._expandOffset(c),c=f.mapOffset(c,!0)),b!==void 0&&(this._expandOffset(b),
b=f.mapOffset(b,!0)));e.setText(a,c,b)},setFoldingEnabled:function(a){this.setFoldingRulerVisible(a)},setSelection:function(a,c,b){var e=this._textView,f=e.getModel();f.getBaseModel&&(this._expandOffset(a),this._expandOffset(c),a=f.mapOffset(a,!0),c=f.mapOffset(c,!0));e.setSelection(a,c,b)},moveSelection:function(a,c,b,e){var f=this._textView;this.setSelection(a,c||a,!1);var c=f.getTopPixel(),h=f.getBottomPixel(),a=this.getModel().getLineAtOffset(a),a=f.getLinePixel(a);a<c||a>h?(h=Math.max(0,a-Math.floor((a<
c?3:1)*(h-c)/4)),(new g({node:f,duration:300,curve:[c,h],onAnimate:function(a){f.setTopPixel(Math.floor(a))},onEnd:function(){f.showSelection();(e===void 0||e)&&f.focus();b&&b()}})).play()):(f.showSelection(),(e===void 0||e)&&f.focus(),b&&b())},checkDirty:function(){this.setDirty(!this._undoStack.isClean())},reportStatus:function(a,c,b){this._statusReporter&&this._statusReporter(a,c,b)},_getTooltipInfo:function(a,c){var b=this._textView,e=this.getAnnotationModel();if(!e)return null;var f=this._annotationStyler;
if(!f)return null;var g=b.getOffsetAtLocation(a,c);if(g===-1)return null;g=this.mapOffset(g);f=f.getAnnotationsByType(e,g,g+1);e=[];for(g=0;g<f.length;g++)f[g].rangeStyle&&e.push(f[g]);if(e.length===0)return null;b=b.convert({x:a,y:c},"document","page");return{contents:e,anchor:"left",x:b.x+10,y:b.y+20}},_highlightCurrentLine:function(a,c){var e=this._annotationModel;if(e){var f=this._textView.getModel(),g=c?f.getLineAtOffset(c.start):-1,h=f.getLineAtOffset(a.start),j=a.start===a.end,d=!c||c.start===
c.end,k=f.getLineStart(h),r=f.getLineEnd(h);f.getBaseModel&&(k=f.mapOffset(k),r=f.mapOffset(r));f=this._currentLineAnnotation;if(!(g===h&&d&&j&&f&&f.start===k&&f.end===r)){var g=f?[f]:null,i;j&&(f=b.AnnotationType.createAnnotation(b.AnnotationType.ANNOTATION_CURRENT_LINE,k,r),i=[f]);this._currentLineAnnotation=f;e.replaceAnnotations(g,i)}}},installTextView:function(){this._textView=this._textViewFactory();if(this._undoStackFactory)this._undoStack=this._undoStackFactory.createUndoStack(this);if(this._textDNDFactory)this._textDND=
this._textDNDFactory.createTextDND(this,this._undoStack);if(this._contentAssistFactory){var a=this._contentAssistFactory.createContentAssistMode(this);this._keyModes.push(a);this._contentAssist=a.getContentAssist()}var c=this,e=this._textView,f=this;this._listener={onModelChanged:function(){f.checkDirty()},onMouseOver:function(a){f._listener.onMouseMove(a)},onMouseMove:function(a){var c=j.Tooltip.getTooltip(e);if(c&&!(f._listener.lastMouseX===a.event.clientX&&f._listener.lastMouseY===a.event.clientY))f._listener.lastMouseX=
a.event.clientX,f._listener.lastMouseY=a.event.clientY,c.setTarget({x:a.x,y:a.y,getTooltipInfo:function(){return f._getTooltipInfo(this.x,this.y)}})},onMouseOut:function(a){var c=j.Tooltip.getTooltip(e);if(c&&!(f._listener.lastMouseX===a.event.clientX&&f._listener.lastMouseY===a.event.clientY))f._listener.lastMouseX=a.event.clientX,f._listener.lastMouseY=a.event.clientY,c.setTarget(null)},onScroll:function(){var a=j.Tooltip.getTooltip(e);a&&a.setTarget(null)},onSelection:function(a){f._updateCursorStatus();
f._highlightCurrentLine(a.newValue,a.oldValue)}};e.addEventListener("ModelChanged",this._listener.onModelChanged);e.addEventListener("Selection",this._listener.onSelection);e.addEventListener("MouseOver",this._listener.onMouseOver);e.addEventListener("MouseOut",this._listener.onMouseOut);e.addEventListener("MouseMove",this._listener.onMouseMove);e.addEventListener("Scroll",this._listener.onScroll);this._keyBindingFactory&&this._keyBindingFactory(this,this._keyModes,this._undoStack,this._contentAssist);
e.setKeyBinding(new p.KeyBinding(27),"cancelMode");e.setAction("cancelMode",function(){for(var a=!1,c=0;c<this._keyModes.length;c++)this._keyModes[c].isActive()&&(a=this._keyModes[c].cancel()||a);return a}.bind(this),{name:s.cancelMode});e.setAction("lineUp",function(){for(var a=0;a<this._keyModes.length;a++)if(this._keyModes[a].isActive())return this._keyModes[a].lineUp();return!1}.bind(this));e.setAction("lineDown",function(){for(var a=0;a<this._keyModes.length;a++)if(this._keyModes[a].isActive())return this._keyModes[a].lineDown();
return!1}.bind(this));e.setAction("enter",function(){for(var a=0;a<this._keyModes.length;a++)if(this._keyModes[a].isActive())return this._keyModes[a].enter();return!1}.bind(this));a=function(a){if(a!==void 0&&a!==-1){for(var d=this.getView().getModel(),e=this.getAnnotationModel(),f=c.mapOffset(d.getLineStart(a)),a=c.mapOffset(d.getLineEnd(a)),d=e.getAnnotations(f,a),i=null;d.hasNext();){var g=d.next();if(g.type===b.AnnotationType.ANNOTATION_BOOKMARK){i=g;break}}i?e.removeAnnotation(i):(i=b.AnnotationType.createAnnotation(b.AnnotationType.ANNOTATION_BOOKMARK,
f,a),i.title=void 0,e.addAnnotation(i))}};if(this._annotationFactory){var g=e.getModel();g.getBaseModel&&(g=g.getBaseModel());if(this._annotationModel=this._annotationFactory.createAnnotationModel(g))if(g=this._annotationStyler=this._annotationFactory.createAnnotationStyler(e,this._annotationModel))g.addAnnotationType(b.AnnotationType.ANNOTATION_CURRENT_SEARCH),g.addAnnotationType(b.AnnotationType.ANNOTATION_MATCHING_SEARCH),g.addAnnotationType(b.AnnotationType.ANNOTATION_ERROR),g.addAnnotationType(b.AnnotationType.ANNOTATION_WARNING),
g.addAnnotationType(b.AnnotationType.ANNOTATION_MATCHING_BRACKET),g.addAnnotationType(b.AnnotationType.ANNOTATION_CURRENT_BRACKET),g.addAnnotationType(b.AnnotationType.ANNOTATION_CURRENT_LINE),g.addAnnotationType(b.AnnotationType.ANNOTATION_READ_OCCURRENCE),g.addAnnotationType(b.AnnotationType.ANNOTATION_WRITE_OCCURRENCE),g.addAnnotationType("orion.annotation.highlightError");e.annotationModel=this._annotationModel;var g=this._annotationFactory.createAnnotationRulers(this._annotationModel),h=this._annotationRuler=
g.annotationRuler;if(h)h.onClick=function(a){if(a!==void 0&&a!==-1)for(var b=this.getView().getModel(),e=this.getAnnotationModel(),f=c.mapOffset(b.getLineStart(a)),a=c.mapOffset(b.getLineEnd(a)),a=e.getAnnotations(f,a);a.hasNext();)if(e=a.next(),this.isAnnotationTypeVisible(e.type)){a=c.getModel();c.onGotoLine(a.getLineAtOffset(f),e.start-f,e.end-f);break}},h.onDblClick=a,h.setMultiAnnotationOverlay({html:"<div class='annotationHTML overlay'></div>"}),h.addAnnotationType(b.AnnotationType.ANNOTATION_ERROR),
h.addAnnotationType(b.AnnotationType.ANNOTATION_WARNING),h.addAnnotationType(b.AnnotationType.ANNOTATION_TASK),h.addAnnotationType(b.AnnotationType.ANNOTATION_BOOKMARK);this.setAnnotationRulerVisible(!0);if(h=this._overviewRuler=g.overviewRuler)h.onClick=function(a){a!==void 0&&(a=e.getModel().getLineStart(a),c.moveSelection(c.mapOffset(a)))},h.addAnnotationType(b.AnnotationType.ANNOTATION_CURRENT_SEARCH),h.addAnnotationType(b.AnnotationType.ANNOTATION_MATCHING_SEARCH),h.addAnnotationType(b.AnnotationType.ANNOTATION_ERROR),
h.addAnnotationType(b.AnnotationType.ANNOTATION_WARNING),h.addAnnotationType(b.AnnotationType.ANNOTATION_TASK),h.addAnnotationType(b.AnnotationType.ANNOTATION_BOOKMARK),h.addAnnotationType(b.AnnotationType.ANNOTATION_MATCHING_BRACKET),h.addAnnotationType(b.AnnotationType.ANNOTATION_CURRENT_BRACKET),h.addAnnotationType(b.AnnotationType.ANNOTATION_CURRENT_LINE),h.addAnnotationType(b.AnnotationType.ANNOTATION_READ_OCCURRENCE),h.addAnnotationType(b.AnnotationType.ANNOTATION_WRITE_OCCURRENCE);this.setOverviewRulerVisible(!0)}if(this._lineNumberRulerFactory)this._lineNumberRuler=
this._lineNumberRulerFactory.createLineNumberRuler(this._annotationModel),this._lineNumberRuler.onDblClick=a,this.setLineNumberRulerVisible(!0);if(this._foldingRulerFactory)this._foldingRuler=this._foldingRulerFactory.createFoldingRuler(this._annotationModel),this._foldingRuler.addAnnotationType(b.AnnotationType.ANNOTATION_FOLDING),this.setFoldingRulerVisible(!1);this.dispatchEvent({type:"TextViewInstalled",textView:e})},uninstallTextView:function(){var a=this._textView;if(a)a.destroy(),this._textView=
this._undoStack=this._textDND=this._contentAssist=this._listener=this._annotationModel=this._annotationStyler=this._annotationRuler=this._overviewRuler=this._lineNumberRuler=this._foldingRuler=this._currentLineAnnotation=this._title=null,this._dirty=!1,this._keyModes=[],this.dispatchEvent({type:"TextViewUninstalled",textView:a})},_updateCursorStatus:function(){var a=this.getModel(),c=this.getCaretOffset(),b=a.getLineAtOffset(c),a=a.getLineStart(b);c-=a;for(a=0;a<this._keyModes.length;a++){var e=this._keyModes[a];
if(e.isActive()&&e.isStatusActive&&e.isStatusActive())return}this.reportStatus(f.formatMessage(s.lineColumn,b+1,c+1))},showProblems:function(a){var c=this._annotationModel;if(c){for(var e=[],f=[],g=c.getTextModel(),h=c.getAnnotations(0,g.getCharCount()),j;h.hasNext();)j=h.next(),(j.type===b.AnnotationType.ANNOTATION_ERROR||j.type===b.AnnotationType.ANNOTATION_WARNING)&&e.push(j);if(a)for(h=0;h<a.length;h++)if(j=a[h]){var d=j.description.replace(/'/g,"&#39;").replace(/"/g,"&#34;"),k=g.getLineStart(j.line-
1);j=b.AnnotationType.createAnnotation(j.severity==="error"?b.AnnotationType.ANNOTATION_ERROR:b.AnnotationType.ANNOTATION_WARNING,k+j.start-1,k+j.end,d);f.push(j)}c.replaceAnnotations(e,f)}},showOccurrences:function(a){var c=this._annotationModel;if(c){for(var e=[],f=[],g=c.getTextModel(),h=c.getAnnotations(0,g.getCharCount()),j;h.hasNext();)j=h.next(),(j.type===b.AnnotationType.ANNOTATION_READ_OCCURRENCE||j.type===b.AnnotationType.ANNOTATION_WRITE_OCCURRENCE)&&e.push(j);if(a)for(h=0;h<a.length;h++)if(j=
a[h]){var d=g.getLineStart(j.line-1);j=b.AnnotationType.createAnnotation(j.readAccess===!0?b.AnnotationType.ANNOTATION_READ_OCCURRENCE:b.AnnotationType.ANNOTATION_WRITE_OCCURRENCE,d+j.start-1,d+j.end,j.description);f.push(j)}c.replaceAnnotations(e,f)}},showSelection:function(a,c,b,e,f){typeof a==="number"?(typeof c!=="number"&&(c=a),this.moveSelection(a,c)):typeof b==="number"&&(a=this.getModel().getLineStart(b-1),typeof e==="number"&&(a+=e),typeof f!=="number"&&(f=0),this.moveSelection(a,a+f))},
setInput:function(a,c,b,e){this._title=a;this._textView&&(e?(this._undoStack.markClean(),this.checkDirty()):(c?this._textView.setText(c):b!==null&&b!==void 0&&(this._textView.setText(b),this._textView.getModel().setLineDelimiter("auto"),this._highlightCurrentLine(this._textView.getSelection())),this._undoStack.reset(),this.checkDirty(),this._textView.focus()));this.onInputChanged({type:"InputChanged",title:a,message:c,contents:b,contentsSaved:e})},onInputChanged:function(a){return this.dispatchEvent(a)},
onGotoLine:function(a,c,b){if(this._textView){var e=this.getModel(),f=e.getLineStart(a),g=0;b===void 0&&(b=0);typeof c==="string"?(a=e.getLine(a).indexOf(c),a!==-1&&(g=a,b=g+c.length)):(g=c,c=e.getLineEnd(a)-f,g=Math.min(g,c),b=Math.min(b,c));this.moveSelection(f+g,f+b)}},onDirtyChanged:function(a){return this.dispatchEvent(a)}};o.EventTarget.addMixin(e.prototype);g=function(){function a(a){this.options=a}a.prototype.play=function(){var a=typeof this.options.duration==="number"?this.options.duration:
350,b=this.options.easing||this.defaultEasing,e=this.options.onAnimate||function(){},f=this.options.onEnd||function(){},g=this.options.curve[0],h=this.options.curve[1]-g,d,k,j=-1;k=setInterval(function(){j=j===-1?(new Date).getTime():j;var i=((new Date).getTime()-j)/a;i<1?(i=b(i),d=g+i*h,e(d)):(clearInterval(k),f())},typeof this.options.rate==="number"?this.options.rate:20)};a.prototype.defaultEasing=function(a){return Math.sin(a*(Math.PI/2))};return a}();if(!Function.prototype.bind)Function.prototype.bind=
h;return{Editor:e}});define("orion/editor/regex",[],function(){return{escape:function(s){return s.replace(/([\\$\^*\/+?\.\(\)|{}\[\]])/g,"\\$&")},parse:function(s){return(s=/^\s*\/(.+)\/([gim]{0,3})\s*$/.exec(s))?{pattern:s[1],flags:s[2]}:null}}});
define("orion/editor/editorFeatures","i18n!orion/editor/nls/messages,orion/editor/undoStack,orion/keyBinding,orion/editor/rulers,orion/editor/annotations,orion/editor/tooltip,orion/editor/textDND,orion/editor/regex,orion/util".split(","),function(s,p,o,j,b,f,e,h,g){function a(){}function c(){}function q(){}function l(){}function n(){}function u(a,c,b){this.editor=a;this.textView=a.getTextView();this.undoStack=c;this._incrementalFindActive=!1;this._incrementalFindSuccess=!0;this._incrementalFindIgnoreSelection=
!1;this._incrementalFindPrefix="";this._searcher=b;this._lastEditLocation=null;this.init()}function t(a,c,b,d){this.editor=a;this.textView=a.getTextView();this.undoStack=c;this.contentAssist=b;this.linkedMode=d;this.contentAssist&&this.contentAssist.addEventListener("ProposalApplied",this.contentAssistProposalApplied.bind(this));this.init()}function d(a){this.editor=a;this.textView=a.getTextView();this.linkedModeActive=!1;this.linkedModePositions=[];this.linkedModeEscapePosition=this.linkedModeCurrentPositionIndex=
0;this.linkedModeListener={onVerify:function(a){for(var c=!1,b=0,d=0;d<this.linkedModePositions.length;++d){var e=this.linkedModePositions[d];if(c)e.offset+=b;else if(a.start>=e.offset&&a.end<=e.offset+e.length)c=e.length,e.length=a.start-e.offset+a.text.length+(e.offset+e.length-a.end),b=e.length-c,c=!0}c?this.linkedModeEscapePosition+=b:this.cancel()}.bind(this)}}a.prototype={createUndoStack:function(a){var a=a.getTextView(),c=new p.UndoStack(a,200);a.setAction("undo",function(){c.undo();return!0},
{name:s.undo});a.setAction("redo",function(){c.redo();return!0},{name:s.redo});return c}};c.prototype={createLineNumberRuler:function(a){return new j.LineNumberRuler(a,"left",{styleClass:"ruler lines"},{styleClass:"rulerLines odd"},{styleClass:"rulerLines even"})}};q.prototype={createFoldingRuler:function(a){return new j.FoldingRuler(a,"left",{styleClass:"ruler folding"})}};l.prototype={createAnnotationModel:function(a){return new b.AnnotationModel(a)},createAnnotationStyler:function(a,c){return new b.AnnotationStyler(a,
c)},createAnnotationRulers:function(a){var c=new j.AnnotationRuler(a,"left",{styleClass:"ruler annotations"}),a=new j.OverviewRuler(a,"right",{styleClass:"ruler overview"});return{annotationRuler:c,overviewRuler:a}}};n.prototype={createTextDND:function(a,c){return new e.TextDND(a.getTextView(),c)}};u.prototype={init:function(){function a(d){var e=c.editor,m=e.getAnnotationModel();if(!m)return!0;for(var g=e.getModel(),h=e.getCaretOffset(),m=m.getAnnotations(d?h:0,d?g.getCharCount():h),k=null;m.hasNext();){var j=
m.next();if(d){if(j.start<=h)continue}else if(j.start>=h)continue;switch(j.type){case b.AnnotationType.ANNOTATION_ERROR:case b.AnnotationType.ANNOTATION_WARNING:case b.AnnotationType.ANNOTATION_TASK:case b.AnnotationType.ANNOTATION_BOOKMARK:break;default:continue}k=j;if(d)break}if(k){var l=c.textView,n=g.getLineAtOffset(k.start),q=f.Tooltip.getTooltip(l);if(!q)return e.moveSelection(k.start),!0;e.moveSelection(k.start,k.start,function(){q.setTarget({getTooltipInfo:function(){var a=l.convert({x:l.getLocationAtOffset(k.start).x,
y:l.getLocationAtOffset(g.getLineStart(n)).y},"document","page");return{contents:[k],x:a.x,y:a.y+Math.floor(l.getLineHeight(n)*1.33)}}},0)})}return!0}var c=this;this._incrementalFindListener={onVerify:function(a){var b=c.editor,d=b.getModel(),e=b.mapOffset(a.start),f=b.mapOffset(a.end),e=d.getText(e,f),d=c._incrementalFindPrefix;if((d=d.match(RegExp("^"+h.escape(e),"i")))&&d.length>0)d=c._incrementalFindPrefix+=a.text,c.editor.reportStatus(g.formatMessage(s.incrementalFind,d)),e=b.getSelection().start,
(e=b.getModel().find({string:d,start:e,caseInsensitive:d.toLowerCase()===d}).next())?(c._incrementalFindSuccess=!0,c._incrementalFindIgnoreSelection=!0,b.moveSelection(e.start,e.end),c._incrementalFindIgnoreSelection=!1):(b.reportStatus(g.formatMessage(s.incrementalFindNotFound,d),"error"),c._incrementalFindSuccess=!1),a.text=null},onSelection:function(){c._incrementalFindIgnoreSelection||c.toggleIncrementalFind()}};this._lastEditListener={onModelChanged:function(a){if(c.editor.isDirty())c._lastEditLocation=
a.start+a.addedCharCount}};this.textView.addEventListener("ModelChanged",this._lastEditListener.onModelChanged);this.textView.setKeyBinding(new o.KeyBinding("k",!0),"findNext");this.textView.setAction("findNext",function(){if(this._searcher){var a=this.textView.getSelection();a.start<a.end?this._searcher.findNext(!0,this.textView.getText(a.start,a.end)):this._searcher.findNext(!0);return!0}return!1}.bind(this),{name:s.findNext});this.textView.setKeyBinding(new o.KeyBinding("k",!0,!0),"findPrevious");
this.textView.setAction("findPrevious",function(){if(this._searcher){var a=this.textView.getSelection();a.start<a.end?this._searcher.findNext(!1,this.textView.getText(a.start,a.end)):this._searcher.findNext(!1);return!0}return!1}.bind(this),{name:s.findPrevious});this.textView.setKeyBinding(new o.KeyBinding("j",!0),"incrementalFind");this.textView.setAction("incrementalFind",function(){if(this._searcher&&this._searcher.visible())return!0;var a=this.editor;if(this._incrementalFindActive){var c=this._incrementalFindPrefix;
if(c.length!==0){var b;b=0;this._incrementalFindSuccess&&(b=a.getSelection().start+1);(b=a.getModel().find({string:c,start:b,caseInsensitive:c.toLowerCase()===c}).next())?(this._incrementalFindIgnoreSelection=this._incrementalFindSuccess=!0,a.moveSelection(b.start,b.end),this._incrementalFindIgnoreSelection=!1,a.reportStatus(g.formatMessage(s.incrementalFind,c))):(a.reportStatus(g.formatMessage(s.incrementalFindNotFound,c),"error"),this._incrementalFindSuccess=!1)}}else a.setCaretOffset(a.getCaretOffset()),
this.toggleIncrementalFind();return!0}.bind(this),{name:s.incrementalFindKey});this.textView.setAction("deletePrevious",function(){if(this._incrementalFindActive){var a=this.editor,c=this._incrementalFindPrefix,c=this._incrementalFindPrefix=c.substring(0,c.length-1);if(c.length===0)return this._incrementalFindIgnoreSelection=this._incrementalFindSuccess=!0,a.setCaretOffset(a.getSelection().start),this._incrementalFindIgnoreSelection=!1,this.toggleIncrementalFind(),!0;a.reportStatus(g.formatMessage(s.incrementalFind,
c));var b=a.getModel().find({string:c,start:a.getCaretOffset()-c.length-1,reverse:!0,caseInsensitive:c.toLowerCase()===c}).next();b?(this._incrementalFindIgnoreSelection=this._incrementalFindSuccess=!0,a.moveSelection(b.start,b.end),this._incrementalFindIgnoreSelection=!1):a.reportStatus(g.formatMessage(s.incrementalFindNotFound,c),"error");return!0}return!1}.bind(this));this.textView.setAction("tab",function(){if(this.textView.getOptions("readonly"))return!1;if(this.textView.getOptions("tabMode")){var a=
this.editor,c=a.getModel(),b=a.getSelection(),d=c.getLineAtOffset(b.start),e=c.getLineAtOffset(b.end>b.start?b.end-1:b.end);if(d!==e){var f=[];f.push("");for(var g=d;g<=e;g++)f.push(c.getLine(g,!0));var g=c.getLineStart(d),c=c.getLineEnd(e,!0),h=this.textView.getOptions("tabSize","expandTab"),h=h.expandTab?Array(h.tabSize+1).join(" "):"\t";a.setText(f.join(h),g,c);a.setSelection(g===b.start?b.start:b.start+h.length,b.end+(e-d+1)*h.length);return!0}a=a.getKeyModes();for(b=0;b<a.length;b++)if(a[b].isActive())return a[b].tab();
return!1}}.bind(this));this.textView.setAction("shiftTab",function(){if(this.textView.getOptions("readonly"))return!1;if(this.textView.getOptions("tabMode")){for(var a=this.editor,c=a.getModel(),b=a.getSelection(),d=c.getLineAtOffset(b.start),e=c.getLineAtOffset(b.end>b.start?b.end-1:b.end),f=this.textView.getOptions("tabSize"),g=Array(f+1).join(" "),h=[],k=0,j=0,l=d;l<=e;l++){var n=c.getLine(l,!0);if(c.getLineStart(l)!==c.getLineEnd(l))if(n.indexOf("\t")===0)n=n.substring(1),k++;else if(n.indexOf(g)===
0)n=n.substring(f),k+=f;else return!0;l===d&&(j=k);h.push(n)}d=c.getLineStart(d);f=c.getLineEnd(e,!0);c=c.getLineStart(e);a.setText(h.join(""),d,f);h=d===b.start?b.start:b.start-j;b=Math.max(h,b.end-k+(b.end===c+1&&b.start!==b.end?1:0));a.setSelection(h,b);return!0}}.bind(this),{name:s.unindentLines});this.textView.setKeyBinding(new o.KeyBinding(38,!1,!1,!0),"moveLinesUp");this.textView.setAction("moveLinesUp",function(){if(this.textView.getOptions("readonly"))return!1;var a=this.editor,c=a.getModel(),
b=a.getSelection(),d=c.getLineAtOffset(b.start);if(d===0)return!0;var e=c.getLineAtOffset(b.end>b.start?b.end-1:b.end),f=c.getLineCount(),b=c.getLineStart(d-1),g=c.getLineStart(d),h=c.getLineEnd(e,!0),k=c.getText(g,h),j=0;e===f-1&&(e=c.getLineEnd(d-1),d=c.getLineEnd(d-1,!0),k+=c.getText(e,d),g=e,j=d-e);this.startUndo();a.setText("",g,h);a.setText(k,b,b);a.setSelection(b,b+k.length-j);this.endUndo();return!0}.bind(this),{name:s.moveLinesUp});this.textView.setKeyBinding(new o.KeyBinding(40,!1,!1,!0),
"moveLinesDown");this.textView.setAction("moveLinesDown",function(){if(this.textView.getOptions("readonly"))return!1;var a=this.editor,c=a.getModel(),b=a.getSelection(),d=c.getLineAtOffset(b.start),e=c.getLineAtOffset(b.end>b.start?b.end-1:b.end),f=c.getLineCount();if(e===f-1)return!0;var d=c.getLineStart(d),b=c.getLineEnd(e,!0),g=c.getLineEnd(e+1,!0)-(b-d),h=0;e!==f-2?c=c.getText(d,b):(e=c.getLineEnd(e),c=c.getText(e,b)+c.getText(d,e),h+=b-e);this.startUndo();a.setText("",d,b);a.setText(c,g,g);a.setSelection(g+
h,g+h+c.length);this.endUndo();return!0}.bind(this),{name:s.moveLinesDown});this.textView.setKeyBinding(new o.KeyBinding(38,!0,!1,!0),"copyLinesUp");this.textView.setAction("copyLinesUp",function(){if(this.textView.getOptions("readonly"))return!1;var a=this.editor,c=a.getModel(),b=a.getSelection(),d=c.getLineAtOffset(b.start),b=c.getLineAtOffset(b.end>b.start?b.end-1:b.end),d=c.getLineStart(d),e=c.getLineEnd(b,!0),f=c.getLineCount(),g="",e=c.getText(d,e);b===f-1&&(e+=g=c.getLineDelimiter());a.setText(e,
d,d);a.setSelection(d,d+e.length-g.length);return!0}.bind(this),{name:s.copyLinesUp});this.textView.setKeyBinding(new o.KeyBinding(40,!0,!1,!0),"copyLinesDown");this.textView.setAction("copyLinesDown",function(){if(this.textView.getOptions("readonly"))return!1;var a=this.editor,c=a.getModel(),b=a.getSelection(),d=c.getLineAtOffset(b.start),b=c.getLineAtOffset(b.end>b.start?b.end-1:b.end),e=c.getLineStart(d),d=c.getLineEnd(b,!0),f=c.getLineCount(),g="",e=c.getText(e,d);b===f-1&&(e=(g=c.getLineDelimiter())+
e);a.setText(e,d,d);a.setSelection(d+g.length,d+e.length);return!0}.bind(this),{name:s.copyLinesDown});this.textView.setKeyBinding(new o.KeyBinding("d",!0,!1,!1),"deleteLines");this.textView.setAction("deleteLines",function(){if(this.textView.getOptions("readonly"))return!1;var a=this.editor,c=a.getSelection(),b=a.getModel(),d=b.getLineAtOffset(c.start),c=b.getLineAtOffset(c.end>c.start?c.end-1:c.end),d=b.getLineStart(d),b=b.getLineEnd(c,!0);a.setText("",d,b);return!0}.bind(this),{name:s.deleteLines});
this.textView.setKeyBinding(new o.KeyBinding("l",!0),"gotoLine");this.textView.setAction("gotoLine",function(){var a=this.editor,c=a.getModel().getLineAtOffset(a.getCaretOffset());if(c=prompt(s.gotoLinePrompty,c+1))c=parseInt(c,10),a.onGotoLine(c-1,0);return!0}.bind(this),{name:s.gotoLine});this.textView.setKeyBinding(new o.KeyBinding(190,!0),"nextAnnotation");this.textView.setAction("nextAnnotation",function(){return a(!0)}.bind(this),{name:s.nextAnnotation});this.textView.setKeyBinding(new o.KeyBinding(188,
!0),"previousAnnotation");this.textView.setAction("previousAnnotation",function(){return a(!1)}.bind(this),{name:s.prevAnnotation});this.textView.setKeyBinding(new o.KeyBinding("e",!0,!1,!0,!1),"expand");this.textView.setAction("expand",function(){var a=this.editor,c=a.getAnnotationModel();if(!c)return!0;var d=a.getModel(),a=a.getCaretOffset(),e=d.getLineAtOffset(a),a=d.getLineStart(e),e=d.getLineEnd(e,!0);d.getBaseModel&&(a=d.mapOffset(a),e=d.mapOffset(e),d.getBaseModel());for(var f,d=c.getAnnotations(a,
e);!f&&d.hasNext();)a=d.next(),a.type===b.AnnotationType.ANNOTATION_FOLDING&&(a.expanded||(f=a));f&&!f.expanded&&(f.expand(),c.modifyAnnotation(f));return!0}.bind(this),{name:s.expand});this.textView.setKeyBinding(new o.KeyBinding("c",!0,!1,!0,!1),"collapse");this.textView.setAction("collapse",function(){var a=this.editor,c=a.getAnnotationModel();if(!c)return!0;var d=a.getModel(),e=a.getCaretOffset(),f=d.getLineAtOffset(e),e=d.getLineStart(f),f=d.getLineEnd(f,!0);d.getBaseModel&&(e=d.mapOffset(e),
f=d.mapOffset(f),d.getBaseModel());for(var g,d=c.getAnnotations(e,f);!g&&d.hasNext();)e=d.next(),e.type===b.AnnotationType.ANNOTATION_FOLDING&&(g=e);g&&g.expanded&&(a.setCaretOffset(g.start),g.collapse(),c.modifyAnnotation(g));return!0}.bind(this),{name:s.collapse});this.textView.setKeyBinding(new o.KeyBinding("e",!0,!0,!0,!1),"expandAll");this.textView.setAction("expandAll",function(){var a=this.editor,c=a.getAnnotationModel();if(!c)return!0;var a=a.getModel(),d=c.getAnnotations(0,a.getCharCount());
for(this.textView.setRedraw(!1);d.hasNext();)a=d.next(),a.type===b.AnnotationType.ANNOTATION_FOLDING&&!a.expanded&&(a.expand(),c.modifyAnnotation(a));this.textView.setRedraw(!0);return!0}.bind(this),{name:s.expandAll});this.textView.setKeyBinding(new o.KeyBinding("c",!0,!0,!0,!1),"collapseAll");this.textView.setAction("collapseAll",function(){var a=this.editor,c=a.getAnnotationModel();if(!c)return!0;var a=a.getModel(),d=c.getAnnotations(0,a.getCharCount());for(this.textView.setRedraw(!1);d.hasNext();)a=
d.next(),a.type===b.AnnotationType.ANNOTATION_FOLDING&&a.expanded&&(a.collapse(),c.modifyAnnotation(a));this.textView.setRedraw(!0);return!0}.bind(this),{name:s.collapseAll});this.textView.setKeyBinding(new o.KeyBinding("q",!g.isMac,!1,!1,g.isMac),"lastEdit");this.textView.setAction("lastEdit",function(){typeof this._lastEditLocation==="number"&&this.editor.showSelection(this._lastEditLocation);return!0}.bind(this),{name:s.lastEdit})},toggleIncrementalFind:function(){(this._incrementalFindActive=
!this._incrementalFindActive)?(this.editor.reportStatus(g.formatMessage(s.incrementalFind,this._incrementalFindPrefix)),this.textView.addEventListener("Verify",this._incrementalFindListener.onVerify),this.textView.addEventListener("Selection",this._incrementalFindListener.onSelection)):(this._incrementalFindPrefix="",this.editor.reportStatus(""),this.textView.removeEventListener("Verify",this._incrementalFindListener.onVerify),this.textView.removeEventListener("Selection",this._incrementalFindListener.onSelection),
this.textView.setCaretOffset(this.textView.getCaretOffset()))},startUndo:function(){this.undoStack&&this.undoStack.startCompoundChange()},endUndo:function(){this.undoStack&&this.undoStack.endCompoundChange()},cancel:function(){this.toggleIncrementalFind()},isActive:function(){return this._incrementalFindActive},isStatusActive:function(){return this._incrementalFindActive},lineUp:function(){if(this._incrementalFindActive){var a=this._incrementalFindPrefix;if(a.length===0)return!1;var c=this.editor,
b=c.getModel(),b=this._incrementalFindSuccess?c.getCaretOffset()-a.length-1:b.getCharCount()-1;(b=c.getModel().find({string:a,start:b,reverse:!0,caseInsensitive:a.toLowerCase()===a}).next())?(this._incrementalFindIgnoreSelection=this._incrementalFindSuccess=!0,c.moveSelection(b.start,b.end),this._incrementalFindIgnoreSelection=!1,c.reportStatus(g.formatMessage(s.incrementalFind,a))):(c.reportStatus(g.formatMessage(s.incrementalFindNotFound,a),"error"),this._incrementalFindSuccess=!1);return!0}return!1},
lineDown:function(){if(this._incrementalFindActive){var a=this._incrementalFindPrefix;if(a.length===0)return!1;var c=this.editor,b=0;this._incrementalFindSuccess&&(b=c.getSelection().start+1);(b=c.getModel().find({string:a,start:b,caseInsensitive:a.toLowerCase()===a}).next())?(this._incrementalFindIgnoreSelection=this._incrementalFindSuccess=!0,c.moveSelection(b.start,b.end),this._incrementalFindIgnoreSelection=!1,c.reportStatus(g.formatMessage(s.incrementalFind,a))):(c.reportStatus(g.formatMessage(s.incrementalFindNotFound,
a),"error"),this._incrementalFindSuccess=!1);return!0}return!1},enter:function(){return!1}};t.prototype={startUndo:function(){this.undoStack&&this.undoStack.startCompoundChange()},endUndo:function(){this.undoStack&&this.undoStack.endCompoundChange()},init:function(){function a(c,b,d){var e=c.getLineAtOffset(b),f=c.getLineAtOffset(d),g,h,k,j,l,n;for(g=e;g>=0;g--)if(h=c.getLine(g),k=g===e?b-c.getLineStart(e):h.length,j=h.lastIndexOf("/*",k),h=h.lastIndexOf("*/",k),h>j)break;else if(j!==-1){l=c.getLineStart(g)+
j;break}for(g=f;g<c.getLineCount();g++)if(h=c.getLine(g),k=g===f?d-c.getLineStart(f):0,j=h.indexOf("/*",k),h=h.indexOf("*/",k),j!==-1&&j<h)break;else if(h!==-1){n=c.getLineStart(g)+h;break}return{commentStart:l,commentEnd:n}}this.textView.setAction("lineStart",function(){for(var a=this.editor,c=a.getModel(),b=a.getCaretOffset(),d=c.getLineAtOffset(b),e=c.getLineStart(d),c=c.getLine(d),d=0;d<c.length;d++){var f=c.charCodeAt(d);if(!(f===32||f===9))break}d+=e;return b!==d?(a.setSelection(d,d),!0):!1}.bind(this));
this.textView.setKeyBinding(new o.KeyBinding(191,!0),"toggleLineComment");this.textView.setAction("toggleLineComment",function(){if(this.textView.getOptions("readonly"))return!1;for(var a=this.editor,c=a.getModel(),b=a.getSelection(),d=c.getLineAtOffset(b.start),e=c.getLineAtOffset(b.end>b.start?b.end-1:b.end),f=!0,g=[],h,k,j=d;j<=e;j++)if(h=c.getLine(j,!0),g.push(h),!f||(k=h.indexOf("//"))===-1)f=!1;else if(k!==0){var l;for(l=0;l<k;l++)if(f=h.charCodeAt(l),!(f===32||f===9))break;f=l===k}j=c.getLineStart(d);
l=c.getLineEnd(e,!0);if(f){for(f=0;f<g.length;f++)h=g[f],k=h.indexOf("//"),g[f]=h.substring(0,k)+h.substring(k+2);g=g.join("");h=c.getLineStart(e);c=j===b.start?b.start:b.start-2;b=b.end-2*(e-d+1)+(b.end===h+1?2:0)}else g.splice(0,0,""),g=g.join("//"),c=j===b.start?b.start:b.start+2,b=b.end+2*(e-d+1);a.setText(g,j,l);a.setSelection(c,b);return!0}.bind(this),{name:s.toggleLineComment});this.textView.setKeyBinding(new o.KeyBinding(191,!0,!g.isMac,!1,g.isMac),"addBlockComment");this.textView.setAction("addBlockComment",
function(){if(this.textView.getOptions("readonly"))return!1;var c=this.editor,b=c.getModel(),d=c.getSelection(),e=RegExp("/\\*|\\*/","g"),f=a(b,d.start,d.end);if(f.commentStart!==void 0&&f.commentEnd!==void 0)return!0;b=b.getText(d.start,d.end);if(b.length===0)return!0;f=b.length;b=b.replace(e,"");e=b.length;c.setText("/*"+b+"*/",d.start,d.end);c.setSelection(d.start+2,d.end+2+(e-f));return!0}.bind(this),{name:s.addBlockComment});this.textView.setKeyBinding(new o.KeyBinding(220,!0,!g.isMac,!1,g.isMac),
"removeBlockComment");this.textView.setAction("removeBlockComment",function(){if(this.textView.getOptions("readonly"))return!1;var c=this.editor,b=c.getModel(),d=c.getSelection(),e=b.getText(d.start,d.end),f,g,h;for(h=0;h<e.length;h++)if(e.substring(h,h+2)==="/*"){f=d.start+h;break}for(;h<e.length;h++)if(e.substring(h,h+2)==="*/"){g=d.start+h;break}if(f!==void 0&&g!==void 0)c.setText(b.getText(f+2,g),f,g+2),c.setSelection(f,g);else{e=a(b,d.start,d.end);if(e.commentStart===void 0||e.commentEnd===void 0)return!0;
b=b.getText(e.commentStart+2,e.commentEnd);c.setText(b,e.commentStart,e.commentEnd+2);c.setSelection(d.start-2,d.end-2)}return!0}.bind(this),{name:s.removeBlockComment})},contentAssistProposalApplied:function(a){a=a.data.proposal;if(a.positions&&this.linkedMode){for(var c=[],b=0;b<a.positions.length;++b)c[b]={positions:[{offset:a.positions[b].offset,length:a.positions[b].length}]};this.linkedMode.enterLinkedMode({groups:c,escapePosition:a.escapePosition})}else a.escapePosition&&this.textView.setCaretOffset(a.escapePosition);
return!0},cancel:function(){return!1},isActive:function(){return!0},isStatusActive:function(){return!1},lineUp:function(){return!1},lineDown:function(){return!1},enter:function(){if(this.textView.getOptions("readonly"))return!1;var a=this.editor,c=a.getSelection();if(c.start===c.end){for(var b=a.getModel(),d=b.getLineAtOffset(c.start),e=b.getLine(d,!0),f=b.getLineStart(d),d=0,f=c.start-f,g;d<f&&((g=e.charCodeAt(d))===32||g===9);)d++;if(d>0){for(var h=e.substring(0,d),d=f;d<e.length&&((g=e.charCodeAt(d++))===
32||g===9);)c.end++;a.setText(b.getLineDelimiter()+h,c.start,c.end);return!0}}return!1},tab:function(){return!1}};d.prototype={enterLinkedMode:function(a){if(!this.linkedModeActive){this.linkedModeActive=!0;this.linkedModePositions=[];for(var c=0;c<a.groups.length;++c){var b=a.groups[c];this.linkedModePositions[c]={offset:b.positions[0].offset,length:b.positions[0].length}}this.linkedModeEscapePosition=a.escapePosition;this.linkedModeCurrentPositionIndex=0;this.selectTextForLinkedModePosition(this.linkedModePositions[this.linkedModeCurrentPositionIndex]);
this.textView.addEventListener("Verify",this.linkedModeListener.onVerify);this.textView.setKeyBinding(new o.KeyBinding(9),"nextLinkedModePosition");this.textView.setAction("nextLinkedModePosition",function(){this.linkedModeCurrentPositionIndex=++this.linkedModeCurrentPositionIndex%this.linkedModePositions.length;this.selectTextForLinkedModePosition(this.linkedModePositions[this.linkedModeCurrentPositionIndex]);return!0}.bind(this));this.textView.setKeyBinding(new o.KeyBinding(9,!1,!0),"previousLinkedModePosition");
this.textView.setAction("previousLinkedModePosition",function(){this.linkedModeCurrentPositionIndex=this.linkedModeCurrentPositionIndex>0?this.linkedModeCurrentPositionIndex-1:this.linkedModePositions.length-1;this.selectTextForLinkedModePosition(this.linkedModePositions[this.linkedModeCurrentPositionIndex]);return!0}.bind(this));this.editor.reportStatus(s.linkedModeEntered,null,!0)}},isActive:function(){return this.linkedModeActive},isStatusActive:function(){return this.linkedModeActive},enter:function(){this.cancel();
return!0},cancel:function(a){if(this.linkedModeActive)this.linkedModeActive=!1,this.textView.removeEventListener("Verify",this.linkedModeListener.onVerify),this.textView.setKeyBinding(new o.KeyBinding(9),"tab"),this.textView.setKeyBinding(new o.KeyBinding(9,!1,!0),"shiftTab"),a||this.textView.setCaretOffset(this.linkedModeEscapePosition,!1),this.editor.reportStatus(s.linkedModeExited,null,!0)},lineUp:function(){this.cancel(!0);return!1},lineDown:function(){this.cancel(!0);return!1},selectTextForLinkedModePosition:function(a){this.textView.setSelection(a.offset,
a.offset+a.length)}};return{UndoFactory:a,LineNumberRulerFactory:c,FoldingRulerFactory:q,AnnotationFactory:l,TextDNDFactory:n,TextActions:u,SourceCodeActions:t,LinkedMode:d}});
(function(s,p){typeof define==="function"&&define.amd?define("orion/Deferred",[],p):typeof exports==="object"?module.exports=p():(s.orion=s.orion||{},s.orion.Deferred=p())})(this,function(){function s(){for(var a;a=e.shift()||h.shift();)a();g=!1}function p(a,c){(c?h:e).push(a);g||(g=!0,c?setTimeout(s,0):s())}function o(a){return function(){a.apply(null,arguments)}}function j(){}function b(){var a=Error("Cancel");a.name="Cancel";return a}function f(){function a(){for(var a;a=g.shift();){var b=a.deferred,
d=e==="resolved"?"resolve":"reject";if(typeof a[d]==="function")try{var f=a[d](c);f&&typeof f.then==="function"?(b.cancel=f.cancel||j,f.then(o(b.resolve),o(b.reject),b.progress)):b.resolve(f)}catch(h){b.reject(h)}else b[d](c)}}var c,e,g=[],h=this;this.reject=function(b){e||(e="rejected",c=b,g.length&&p(a));return h.promise};this.resolve=function(b){e||(e="resolved",c=b,g.length&&p(a));return h.promise};this.progress=function(a){e||g.forEach(function(c){c.progress&&c.progress(a)});return h.promise};
this.cancel=function(){e||h.reject(b())};this.then=function(c,b,d){var c={resolve:c,reject:b,progress:d,deferred:new f},h=c.deferred,j=this.cancel.bind(this),i=function(){p(function(){(h.cancel===i?j:h.cancel)()},!0)};h.cancel=i;b=h.promise;b.cancel=function(){h.cancel()};g.push(c);e&&p(a,!0);return b};this.promise={then:this.then,cancel:this.cancel}}var e=[],h=[],g=!1;f.all=function(a,c){function b(a,c){j||(h[a]=c,--g===0&&d.resolve(h))}function e(a,f){if(!j){if(c)try{b(a,c(f));return}catch(g){f=
g}d.reject(f)}}var g=a.length,h=[],j=!1,d=new f;d.then(null,function(){j=!0;a.forEach(function(a){a.cancel&&a.cancel()})});g===0?d.resolve(h):a.forEach(function(a,c){a.then(b.bind(null,c),e.bind(null,c))});return d.promise};f.when=function(a,c,b,e){var g;if(!(a&&typeof a.then==="function"))g=new f,g.resolve(a),a=g.promise;return a.then(c,b,e)};return f});
define("orion/editor/contentAssist",["i18n!orion/editor/nls/messages","orion/keyBinding","orion/editor/eventTarget","orion/Deferred","orion/util"],function(s,p,o,j,b){var f,e,h;function g(a){this.textView=a;this.state=f;this.providers=[];var c=this;this.contentAssistListener={onModelChanging:function(a){c.isDeactivatingChange(a)?c.setState(f):c.state===e&&c.setState(h)},onScroll:function(){c.setState(f)},onSelection:function(){var a=c.state;if(a===e||a===h)c.computeProposals(),c.setState(h)}};a.setKeyBinding(b.isMac?
new p.KeyBinding(" ",!1,!1,!1,!0):new p.KeyBinding(" ",!0),"contentAssist");a.setAction("contentAssist",function(){c.activate();return!0},{name:s.contentAssist})}function a(a,c){this.contentAssist=a;this.widget=c;this.proposals=[];var b=this;this.contentAssist.addEventListener("ProposalsComputed",function(a){b.proposals=a.data.proposals;b.selectedIndex=b.proposals.length?0:-1})}function c(a,c){this.contentAssist=a;this.textView=this.contentAssist.getTextView();this.isShowing=this.textViewListenerAdded=
!1;var e=this.textView.getOptions("parent").ownerDocument;this.parentNode=typeof c==="string"?e.getElementById(c):c;if(!this.parentNode){this.parentNode=b.createElement(e,"div");this.parentNode.className="contentassist";var f=e.getElementsByTagName("body")[0];if(f)f.appendChild(this.parentNode);else throw Error("parentNode is required");}var d=this;this.textViewListener={onMouseDown:function(a){a.event.target.parentElement!==d.parentNode&&d.contentAssist.deactivate()}};this.contentAssist.addEventListener("ProposalsComputed",
function(a){d.setProposals(a.data.proposals);d.show();if(!d.textViewListenerAdded)d.textView.addEventListener("MouseDown",d.textViewListener.onMouseDown),d.textViewListenerAdded=!0});this.contentAssist.addEventListener("Deactivating",function(){d.setProposals([]);d.hide();if(d.textViewListenerAdded)d.textView.removeEventListener("MouseDown",d.textViewListener.onMouseDown),d.textViewListenerAdded=!1;d.textViewListenerAdded=!1});this.scrollListener=function(){d.isShowing&&d.position()};e.addEventListener("scroll",
this.scrollListener)}f=1;e=2;h=3;var q={selected:" selected",hr:"proposal-hr",emphasis:"proposal-emphasis",noemphasis:"proposal-noemphasis",dfault:"proposal-default"};g.prototype={apply:function(a){if(!a)return!1;var c=this.textView.getCaretOffset(),b={proposal:a,start:c,end:c};this.setState(f);this.textView.setText(a.proposal||a,c,c);this.dispatchEvent({type:"ProposalApplied",data:b});return!0},activate:function(){this.state===f&&this.setState(e)},deactivate:function(){this.setState(f)},getTextView:function(){return this.textView},
isActive:function(){return this.state===e||this.state===h},isDeactivatingChange:function(a){var c=a.removedCharCount>0&&a.addedCharCount===0,b=this.textView,b=a.start+1<=b.getModel().getCharCount()&&/^\s*$/.test(b.getText(a.start,a.start+1));return a.removedLineCount>0||a.addedLineCount>0||c&&b},setState:function(a){var c;a===e?c="Activating":a===f&&(c="Deactivating");c&&this.dispatchEvent({type:c});this.state=a;this.onStateChange(a)},onStateChange:function(a){if(a===f){if(this.listenerAdded)this.textView.removeEventListener("ModelChanging",
this.contentAssistListener.onModelChanging),this.textView.removeEventListener("Scroll",this.contentAssistListener.onScroll),this.textView.removeEventListener("Selection",this.contentAssistListener.onSelection),this.listenerAdded=!1}else if(a===e){if(!this.listenerAdded)this.textView.addEventListener("ModelChanging",this.contentAssistListener.onModelChanging),this.textView.addEventListener("Scroll",this.contentAssistListener.onScroll),this.textView.addEventListener("Selection",this.contentAssistListener.onSelection),
this.listenerAdded=!0;this.computeProposals()}},computeProposals:function(){var a=this;this._computeProposals(this.textView.getCaretOffset()).then(function(c){a.dispatchEvent({type:"ProposalsComputed",data:{proposals:c}})})},getPrefixStart:function(a){for(;a>0&&/[A-Za-z0-9_]/.test(this.textView.getText(a-1,a));)a--;return a},handleError:function(a){typeof console!=="undefined"&&(console.log("Error retrieving content assist proposals"),console.log(a))},_computeProposals:function(a){var c=this.providers,
b=this.textView,e=b.getModel(),d=b.getText(),f={line:e.getLine(e.getLineAtOffset(a)),prefix:b.getText(this.getPrefixStart(a),a),selection:b.getSelection()},g=this,c=c.map(function(c){var b=c.computeProposals||c.getProposals,e;try{typeof b==="function"&&(e=g.progress?g.progress.progress(b.apply(c,[d,a,f]),"Generating content assist proposal"):b.apply(c,[d,a,f]))}catch(h){g.handleError(h)}return j.when(e)});return j.all(c,this.handleError).then(function(a){return a.reduce(function(a,c){return c instanceof
Array?a.concat(c):a},[])})},setProviders:function(a){this.providers=a.slice(0)},setProgress:function(a){this.progress=a}};o.EventTarget.addMixin(g.prototype);a.prototype={cancel:function(){this.getContentAssist().deactivate()},getContentAssist:function(){return this.contentAssist},isActive:function(){return this.getContentAssist().isActive()},lineUp:function(){for(var a=this.selectedIndex===0?this.proposals.length-1:this.selectedIndex-1;this.proposals[a].unselectable&&a>0;)a--;this.selectedIndex=
a;this.widget&&this.widget.setSelectedIndex(this.selectedIndex);return!0},lineDown:function(){for(var a=this.selectedIndex===this.proposals.length-1?0:this.selectedIndex+1;this.proposals[a].unselectable&&a<this.proposals.length-1;)a++;this.selectedIndex=a;this.widget&&this.widget.setSelectedIndex(this.selectedIndex);return!0},enter:function(){return this.contentAssist.apply(this.proposals[this.selectedIndex]||null)},tab:function(){return this.widget?(this.widget.createAccessible(this),this.widget.parentNode.focus(),
!0):!1}};c.prototype={onClick:function(a){this.contentAssist.apply(this.getProposal(a.target));this.textView.focus()},createDiv:function(a,c,e,f){var d=e.ownerDocument,g=b.createElement(d,"div");g.id="contentoption"+f;g.setAttribute("role","option");a.style==="hr"?a=b.createElement(d,"hr"):(g.className=this.calculateClasses(a.style,c),a=d.createTextNode(this.getDisplayString(a)),c&&this.parentNode.setAttribute("aria-activedescendant",g.id));g.appendChild(a,g);e.appendChild(g)},createAccessible:function(a){this._isAccessible||
this.parentNode.addEventListener("keydown",function(c){c.preventDefault();if(c.keyCode===27)return a.cancel();else if(c.keyCode===38)return a.lineUp();else if(c.keyCode===40)return a.lineDown();else if(c.keyCode===13)return a.enter();return!1});this._isAccessible=!0},calculateClasses:function(a,c){var b=q[a];if(!b)b=q.dfault;return c?b+q.selected:b},getDisplayString:function(a){return typeof a==="string"?a:a.description&&typeof a.description==="string"?a.description:a.proposal},getProposal:function(a){for(var c=
0,b=this.parentNode.firstChild;b!==null;b=b.nextSibling){if(b===a)return this.proposals[c]||null;c++}return null},setSelectedIndex:function(a){this.selectedIndex=a;this.selectNode(this.parentNode.childNodes[this.selectedIndex])},selectNode:function(a){for(var c=this.parentNode.childNodes,b=0;b<c.length;b++){var e=c[b],d=e.className.indexOf(q.selected);if(d>=0)e.className=e.className.substring(0,d)+e.className.substring(d+q.selected.length);e===a&&(e.className+=q.selected,this.parentNode.setAttribute("aria-activedescendant",
e.id),e.focus(),e.offsetTop<this.parentNode.scrollTop?e.scrollIntoView(!0):e.offsetTop+e.offsetHeight>this.parentNode.scrollTop+this.parentNode.clientHeight&&e.scrollIntoView(!1))}},setProposals:function(a){this.proposals=a},show:function(){if(this.proposals.length===0)this.hide();else{this.parentNode.innerHTML="";for(var a=0;a<this.proposals.length;a++)this.createDiv(this.proposals[a],a===0,this.parentNode,a);this.position();this.parentNode.onclick=this.onClick.bind(this);this.isShowing=!0}},hide:function(){this.parentNode.ownerDocument.activeElement===
this.parentNode&&this.textView.focus();this.parentNode.style.display="none";this.parentNode.onclick=null;this.isShowing=!1},position:function(){var a=this.textView.getLocationAtOffset(this.textView.getCaretOffset());a.y+=this.textView.getLineHeight();this.textView.convert(a,"document","page");this.parentNode.style.position="fixed";this.parentNode.style.left=a.x+"px";this.parentNode.style.top=a.y+"px";this.parentNode.style.display="block";this.parentNode.scrollTop=0;var c=this.parentNode.ownerDocument,
b=c.documentElement.clientWidth;if(a.y+this.parentNode.offsetHeight>c.documentElement.clientHeight)this.parentNode.style.top=a.y-this.parentNode.offsetHeight-this.textView.getLineHeight()+"px";if(a.x+this.parentNode.offsetWidth>b)this.parentNode.style.left=b-this.parentNode.offsetWidth+"px"}};return{ContentAssist:g,ContentAssistMode:a,ContentAssistWidget:c}});
define("orion/editor/cssContentAssist",[],function(){function s(){}var p="alignment-adjust,alignment-baseline,animation,animation-delay,animation-direction,animation-duration,animation-iteration-count,animation-name,animation-play-state,animation-timing-function,appearance,azimuth,backface-visibility,background,background-attachment,background-clip,background-color,background-image,background-origin,background-position,background-repeat,background-size,baseline-shift,binding,bleed,bookmark-label,bookmark-level,bookmark-state,bookmark-target,border,border-bottom,border-bottom-color,border-bottom-left-radius,border-bottom-right-radius,border-bottom-style,border-bottom-width,border-collapse,border-color,border-image,border-image-outset,border-image-repeat,border-image-slice,border-image-source,border-image-width,border-left,border-left-color,border-left-style,border-left-width,border-radius,border-right,border-right-color,border-right-style,border-right-width,border-spacing,border-style,border-top,border-top-color,border-top-left-radius,border-top-right-radius,border-top-style,border-top-width,border-width,bottom,box-align,box-decoration-break,box-direction,box-flex,box-flex-group,box-lines,box-ordinal-group,box-orient,box-pack,box-shadow,box-sizing,break-after,break-before,break-inside,caption-side,clear,clip,color,color-profile,column-count,column-fill,column-gap,column-rule,column-rule-color,column-rule-style,column-rule-width,column-span,column-width,columns,content,counter-increment,counter-reset,crop,cue,cue-after,cue-before,cursor,direction,display,dominant-baseline,drop-initial-after-adjust,drop-initial-after-align,drop-initial-before-adjust,drop-initial-before-align,drop-initial-size,drop-initial-value,elevation,empty-cells,fit,fit-position,flex-align,flex-flow,flex-inline-pack,flex-order,flex-pack,float,float-offset,font,font-family,font-size,font-size-adjust,font-stretch,font-style,font-variant,font-weight,grid-columns,grid-rows,hanging-punctuation,height,hyphenate-after,hyphenate-before,hyphenate-character,hyphenate-lines,hyphenate-resource,hyphens,icon,image-orientation,image-rendering,image-resolution,inline-box-align,left,letter-spacing,line-height,line-stacking,line-stacking-ruby,line-stacking-shift,line-stacking-strategy,list-style,list-style-image,list-style-position,list-style-type,margin,margin-bottom,margin-left,margin-right,margin-top,mark,mark-after,mark-before,marker-offset,marks,marquee-direction,marquee-loop,marquee-play-count,marquee-speed,marquee-style,max-height,max-width,min-height,min-width,move-to,nav-down,nav-index,nav-left,nav-right,nav-up,opacity,orphans,outline,outline-color,outline-offset,outline-style,outline-width,overflow,overflow-style,overflow-x,overflow-y,padding,padding-bottom,padding-left,padding-right,padding-top,page,page-break-after,page-break-before,page-break-inside,page-policy,pause,pause-after,pause-before,perspective,perspective-origin,phonemes,pitch,pitch-range,play-during,position,presentation-level,punctuation-trim,quotes,rendering-intent,resize,rest,rest-after,rest-before,richness,right,rotation,rotation-point,ruby-align,ruby-overhang,ruby-position,ruby-span,size,speak,speak-header,speak-numeral,speak-punctuation,speech-rate,stress,string-set,table-layout,target,target-name,target-new,target-position,text-align,text-align-last,text-decoration,text-emphasis,text-height,text-indent,text-justify,text-outline,text-shadow,text-transform,text-wrap,top,transform,transform-origin,transform-style,transition,transition-delay,transition-duration,transition-property,transition-timing-function,unicode-bidi,vertical-align,visibility,voice-balance,voice-duration,voice-family,voice-pitch,voice-pitch-range,voice-rate,voice-stress,voice-volume,volume,white-space,white-space-collapse,widows,width,word-break,word-spacing,word-wrap,z-index".split(",");s.prototype=
{computeProposals:function(o,j){var b;for(b=j;b&&/[A-Za-z\-]/.test(o.charAt(b-1));)b--;b=b?o.substring(b,j):"";for(var f=[],e=0;e<p.length;e++){var h=p[e];h.indexOf(b)===0&&f.push({proposal:h.substring(b.length),description:h})}return f}};return{CssContentAssistProvider:s}});
define("orion/editor/htmlContentAssist",[],function(){function s(){}s.prototype={leadingWhitespace:function(p,o){var j="";for(o-=1;o>0;){var b=p.charAt(o--);if(b==="\n"||b==="\r")break;j=/\s/.test(b)?b.concat(j):""}return j},computeProposals:function(p,o,j){function b(a){return a.substring(j.prefix.length)}var f=[];if(p.length===0)return f.push({proposal:'<!DOCTYPE html>\n<html lang="en">\n\t<head>\n\t\t<meta charset=utf-8>\n\t\t<title>My Document</title>\n\t</head>\n\t<body>\n\t\t<h1>A basic HTML document</h1>\n\t\t<p>\n\t\t\t\n\t\t</p>\n\t</body>\n</html>',
description:"Simple HTML document",escapePosition:o+152}),f;var e=j.prefix;if(p.charAt(o-e.length-1)!=="<")return f;for(var h,g,a="abbr,b,button,canvas,cite,command,dd,del,dfn,dt,em,embed,font,h1,h2,h3,h4,h5,h6,i,ins,kbd,label,li,mark,meter,object,option,output,progress,q,rp,rt,samp,small,strong,sub,sup,td,time,title,tt,u,var".split(","),c=0;c<a.length;c++)h=a[c],h.indexOf(e)===0&&(g=h+"></"+h+">",h=o+h.length-e.length+1,f.push({proposal:b(g),description:"<"+g,escapePosition:h}));a="address,article,aside,audio,bdo,blockquote,body,caption,code,colgroup,datalist,details,div,fieldset,figure,footer,form,head,header,hgroup,iframe,legend,map,menu,nav,noframes,noscript,optgroup,p,pre,ruby,script,section,select,span,style,tbody,textarea,tfoot,th,thead,tr,video".split(",");
p=this.leadingWhitespace(p,o);for(c=0;c<a.length;c++)h=a[c],h.indexOf(e)===0&&(g=h+">\n"+p+"\t\n"+p+"</"+h+">",h=o+h.length-e.length+p.length+3,f.push({proposal:b(g),description:"<"+g,escapePosition:h}));a="area,base,br,col,hr,input,link,meta,param,keygen,source".split(",");for(c=0;c<a.length;c++)h=a[c],h.indexOf(e)===0&&(g=h+"/>",h=o+h.length-e.length+2,f.push({proposal:b(g),description:"<"+g,escapePosition:h}));"img".indexOf(e)===0&&(g='img src="" alt="Image"/>',f.push({proposal:b(g),description:"<"+
g,escapePosition:o+9-e.length}));e==="a"&&f.push({proposal:b('a href=""></a>'),description:"<a></a> - HTML anchor element",escapePosition:o+7});"ul".indexOf(e)===0&&(g="<ul> - unordered list",h=o-e.length+p.length+9,f.push({proposal:b("ul>\n"+p+"\t<li></li>\n"+p+"</ul>"),description:g,escapePosition:h}));"ol".indexOf(e)===0&&(g="<ol> - ordered list",h=o-e.length+p.length+9,f.push({proposal:b("ol>\n"+p+"\t<li></li>\n"+p+"</ol>"),description:g,escapePosition:h}));"dl".indexOf(e)===0&&(g="<dl> - definition list",
h=o-e.length+p.length+9,f.push({proposal:b("dl>\n"+p+"\t<dt></dt>\n"+p+"\t<dd></dd>\n"+p+"</dl>"),description:g,escapePosition:h}));"table".indexOf(e)===0&&(g="<table> - basic HTML table",h=o-e.length+p.length*2+19,f.push({proposal:b("table>\n"+p+"\t<tr>\n"+p+"\t\t<td></td>\n"+p+"\t</tr>\n"+p+"</table>"),description:g,escapePosition:h}));return f}};return{HTMLContentAssistProvider:s}});
define("orion/editor/jsTemplateContentAssist",[],function(){function s(b,f,e){var h=e-b.length,g=[],a="";for(e-=1;e>0;){var c=f.charAt(e--);if(c==="\n"||c==="\r")break;a=/\s/.test(c)?c.concat(a):""}f=a;"if".indexOf(b)===0&&(e="if - if statement",a=[{offset:h+4,length:9}],c=h+f.length+18,g.push({proposal:("if (condition) {\n"+f+"\t\n"+f+"}").substring(b.length),description:e,positions:a,escapePosition:c}),e="if - if else statement",a=[{offset:h+4,length:9}],c=h+f.length+18,g.push({proposal:("if (condition) {\n"+
f+"\t\n"+f+"} else {\n"+f+"\t\n"+f+"}").substring(b.length),description:e,positions:a,escapePosition:c}));"for".indexOf(b)===0&&(e="for - iterate over array",a=[{offset:h+9,length:1},{offset:h+20,length:5}],c=h+f.length+42,g.push({proposal:("for (var i = 0; i < array.length; i++) {\n"+f+"\t\n"+f+"}").substring(b.length),description:e,positions:a,escapePosition:c}),e="for..in - iterate over properties of an object",a=[{offset:h+9,length:8},{offset:h+21,length:6}],c=h+2*f.length+73,g.push({proposal:("for (var property in object) {\n"+
f+"\tif (object.hasOwnProperty(property)) {\n"+f+"\t\t\n"+f+"\t}\n"+f+"}").substring(b.length),description:e,positions:a,escapePosition:c}));"while".indexOf(b)===0&&(e="while - while loop with condition",a=[{offset:h+7,length:9}],c=h+f.length+21,g.push({proposal:("while (condition) {\n"+f+"\t\n"+f+"}").substring(b.length),description:e,positions:a,escapePosition:c}));"do".indexOf(b)===0&&(e="do - do while loop with condition",a=[{offset:h+16,length:9}],c=h+f.length+6,g.push({proposal:("do {\n"+f+
"\t\n"+f+"} while (condition);").substring(b.length),description:e,positions:a,escapePosition:c}));"switch".indexOf(b)===0&&(e="switch - switch case statement",a=[{offset:h+8,length:10},{offset:h+28,length:6}],c=h+2*f.length+38,g.push({proposal:("switch (expression) {\n"+f+"\tcase value1:\n"+f+"\t\t\n"+f+"\t\tbreak;\n"+f+"\tdefault:\n"+f+"}").substring(b.length),description:e,positions:a,escapePosition:c}));"try".indexOf(b)===0&&(e="try - try..catch statement",c=h+f.length+7,g.push({proposal:("try {\n"+
f+"\t\n"+f+"} catch (err) {\n"+f+"}").substring(b.length),description:e,escapePosition:c}),e="try - try..catch statement with finally block",c=h+f.length+7,g.push({proposal:("try {\n"+f+"\t\n"+f+"} catch (err) {\n"+f+"} finally {\n"+f+"}").substring(b.length),description:e,escapePosition:c}));return g}function p(b){for(var f="break,case,catch,continue,debugger,default,delete,do,else,finally,for,function,if,in,instanceof,new,return,switch,this,throw,try,typeof,var,void,while,with".split(","),e=[],
h=0;h<f.length;h++)f[h].indexOf(b)===0&&e.push({proposal:f[h].substring(b.length),description:f[h]});return e}function o(){}var j={":":":","!":"!","@":"@","#":"#",$:"$","^":"^","&":"&","*":"*",".":".","?":"?","<":"<",">":">"};o.prototype={computeProposals:function(b,f,e){for(var e=e.prefix,h=[],g=f-e.length-1,a="";g>=0;)if(a=b[g],a==="\n"||a==="\r")break;else if(/\s/.test(a))g--;else break;if(j[a])return h;h=h.concat(s(e,b,f));return h=h.concat(p(e,b,f))}};return{JSTemplateContentAssistProvider:o}});
define("orion/editor/AsyncStyler",["i18n!orion/editor/nls/messages","orion/editor/annotations"],function(s,p){function o(e){return e.getProperty("objectClass").indexOf(b)!==-1&&e.getProperty("type")==="highlighter"}function j(b,f,g){this.initialize(b,f,g);this.lineStyles=[]}var b="orion.edit.highlighter",f=b+" service must be an event emitter";p.AnnotationType.registerType("orion.annotation.highlightError",{title:s.syntaxError,html:"<div class='annotationHTML error'></div>",rangeStyle:{styleClass:"annotationRange error"}});
j.prototype={initialize:function(e,f,g){this.textView=e;this.serviceRegistry=f;this.annotationModel=g;this.services=[];var a=this;this.listener={onModelChanging:function(c){a.onModelChanging(c)},onModelChanged:function(c){a.onModelChanged(c)},onDestroy:function(c){a.onDestroy(c)},onLineStyle:function(c){a.onLineStyle(c)},onStyleReady:function(c){a.onStyleReady(c)},onServiceAdded:function(c){a.onServiceAdded(c.serviceReference,a.serviceRegistry.getService(c.serviceReference))},onServiceRemoved:function(c){a.onServiceRemoved(c.serviceReference,
a.serviceRegistry.getService(c.serviceReference))}};e.addEventListener("ModelChanging",this.listener.onModelChanging);e.addEventListener("ModelChanged",this.listener.onModelChanged);e.addEventListener("Destroy",this.listener.onDestroy);e.addEventListener("LineStyle",this.listener.onLineStyle);f.addEventListener("registered",this.listener.onServiceAdded);f.addEventListener("unregistering",this.listener.onServiceRemoved);e=f.getServiceReferences(b);for(g=0;g<e.length;g++){var c=e[g];o(c)&&this.addServiceListener(f.getService(c))}},
onDestroy:function(){this.destroy()},destroy:function(){if(this.textView)this.textView.removeEventListener("ModelChanging",this.listener.onModelChanging),this.textView.removeEventListener("ModelChanged",this.listener.onModelChanged),this.textView.removeEventListener("Destroy",this.listener.onDestroy),this.textView.removeEventListener("LineStyle",this.listener.onLineStyle),this.textView=null;if(this.services){for(var b=0;b<this.services.length;b++)this.removeServiceListener(this.services[b]);this.services=
null}if(this.serviceRegistry)this.serviceRegistry.removeEventListener("registered",this.listener.onServiceAdded),this.serviceRegistry.removeEventListener("unregistering",this.listener.onServiceRemoved),this.serviceRegistry=null;this.lineStyles=this.listener=null},onModelChanging:function(b){this.startLine=this.textView.getModel().getLineAtOffset(b.start)},onModelChanged:function(b){var f=this.startLine;(b.addedLineCount||b.removedLineCount)&&Array.prototype.splice.apply(this.lineStyles,[f,b.removedLineCount].concat(this._getEmptyStyle(b.addedLineCount)))},
onStyleReady:function(b){var f=b.lineStyles||b.style,b=Number.MAX_VALUE,g=-1,a=this.textView.getModel(),c;for(c in f)f.hasOwnProperty(c)&&(this.lineStyles[c]=f[c],b=Math.min(b,c),g=Math.max(g,c));b=Math.max(b,0);g=Math.min(g,a.getLineCount());if(f=this.annotationModel){for(var j=f.getAnnotations(a.getLineStart(b),a.getLineEnd(g)),l=[];j.hasNext();){var n=j.next();n.type==="orion.annotation.highlightError"&&l.push(n)}j=[];for(n=b;n<=g;n++){c=n;var o=this.lineStyles[c],o=o&&o.errors;c=a.getLineStart(c);
if(o)for(var t=0;t<o.length;t++){var d=o[t];j.push(p.AnnotationType.createAnnotation("orion.annotation.highlightError",d.start+c,d.end+c))}}f.replaceAnnotations(l,j)}this.textView.redrawLines(b,g+1)},onLineStyle:function(b){function f(a,c){for(var b=a.length,e=[],g=0;g<b;g++){var h=a[g];e.push({start:h.start+c,end:h.end+c,style:h.style})}return e}var g=this.lineStyles[b.lineIndex];if(g)if(g.ranges)b.ranges=f(g.ranges,b.lineStart);else if(g.style)b.style=g.style},_getEmptyStyle:function(b){for(var f=
[],g=0;g<b;g++)f.push(null);return f},setContentType:function(b){this.contentType=b;if(this.services)for(b=0;b<this.services.length;b++){var f=this.services[b];if(f.setContentType){var g=this.serviceRegistry.getService("orion.page.progress");g?g.progress(f.setContentType(this.contentType),"Styling content type: "+this.contentType.id?this.contentType.id:this.contentType):f.setContentType(this.contentType)}}},onServiceAdded:function(b,f){o(b)&&this.addServiceListener(f)},onServiceRemoved:function(b,
f){this.services.indexOf(f)!==-1&&this.removeServiceListener(f)},addServiceListener:function(b){if(typeof b.addEventListener==="function"){if(b.addEventListener("orion.edit.highlighter.styleReady",this.listener.onStyleReady),this.services.push(b),b.setContentType&&this.contentType){var h=this.serviceRegistry.getService("orion.page.progress");h?h.progress(b.setContentType(this.contentType),"Styling content type: "+this.contentType.id?this.contentType.id:this.contentType):b.setContentType(this.contentType)}}else typeof console!==
"undefined"&&console.log(Error(f))},removeServiceListener:function(b){typeof b.removeEventListener==="function"?(b.removeEventListener("orion.edit.highlighter.styleReady",this.listener.onStyleReady),b=this.services.indexOf(b),b!==-1&&this.services.splice(b,1)):typeof console!=="undefined"&&console.log(Error(f))}};return j});
define("orion/editor/mirror",["i18n!orion/editor/nls/messages","orion/editor/eventTarget","orion/editor/annotations"],function(s,p,o){function j(b){this.string=b;this.tokenStart=this.pos=0}function b(){this._modes={};this.mimeModes={};this.options={};this.StringStream=j}function f(b){var a=[],c;for(c in b)Object.prototype.hasOwnProperty.call(b,c)&&a.push(c);return a}function e(b,a,c){c=c||{};this.model=b;this.codeMirror=a;this.isWhitespaceVisible=typeof c.whitespacesVisible==="undefined"?!1:c.whitespacesVisible;
this.mode=null;this.isModeLoaded=!1;this.lines=[];this.dirtyLines=[];this.startLine=Number.MAX_VALUE;this.endLine=-1;this.timer=null;this.initialize(b)}function h(b,a,c){this.init(b,a,c)}j.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return this.pos===0},peek:function(){return this.string[this.pos]},next:function(){return this.string[this.pos++]},eat:function(b){var a=this.string[this.pos];return typeof a==="string"&&(a===b||b.test&&b.test(a)||typeof b==="function"&&
b(a))?this.string[this.pos++]:void 0},eatWhile:function(b){for(var a=!1;this.eat(b)!==void 0;)a=!0;return a},eatSpace:function(){return this.eatWhile(/\s/)},skipToEnd:function(){this.pos=this.string.length},skipTo:function(b){b=this.string.indexOf(b,this.pos);return b!==-1?(this.pos=b,!0):!1},match:function(b,a,c){a=a===!0||typeof a==="undefined";if(typeof b==="string"){var e=c?this.string.toLowerCase():this.string,b=c?b.toLowerCase():b,c=e.indexOf(b,this.pos);if(c!==-1&&a)this.pos=c+b.length;return c!==
-1}else return(b=this.string.substring(this.pos).match(b))&&a&&typeof b[0]==="string"&&(this.pos+=b.index+b[0].length),b},backUp:function(b){this.pos-=b},column:function(){for(var b=0,a=0;a<this.tokenStart;)b+=this.string[a++]==="\t"?4:1;return b},indentation:function(){for(var b=this.string.search(/\S/),a=0,c=0;c<b;)a+=this.string[c++]==="\t"?4:1;return a},current:function(){return this.string.substring(this.tokenStart,this.pos)},advance:function(){this.tokenStart=this.pos}};b.prototype={options:{},
setOption:function(b,a){this.options[b]=a},getOption:function(b){return this.options[b]},copyState:function(b,a){if(typeof b.copyState==="function")return b.copyState(a);var c={},e;for(e in a){var f=a[e];c[e]=f instanceof Array?f.slice():f}return c},defineMode:function(b,a){this._modes[b]=a},defineMIME:function(b,a){this.mimeModes[b]=a},getMode:function(b,a){var c={},e;typeof a==="string"&&this.mimeModes[a]&&(a=this.mimeModes[a]);typeof a==="object"&&(c=a,e=this._modes[a.name]);e=e||this._modes[a];
if(typeof e!=="function")throw"Mode not found "+a;return e(b,c)},listModes:function(){return f(this._modes)},listMIMEs:function(){return f(this.mimeModes)},_getModeName:function(b){b=this.mimeModes[b];if(typeof b==="object")b=b.name;return b}};e.prototype={initialize:function(){var b=this;this.listener={onModelChanging:function(a){b._onModelChanging(a)},onModelChanged:function(a){b._onModelChanged(a)},onDestroy:function(a){b._onDestroy(a)}};this.model.addEventListener("Changing",this.listener.onModelChanging);
this.model.addEventListener("Changed",this.listener.onModelChanged);this.model.addEventListener("Destroy",this.listener.onDestroy)},destroy:function(){this.model&&(this.model.removeEventListener("Changing",this.listener.onModelChanging),this.model.removeEventListener("Changed",this.listener.onModelChanged),this.model.removeEventListener("Destroy",this.listener.onDestroy));this.dirtyLines=this.lines=this.mode=this.codeMirror=this.model=null;clearTimeout(this.timer);this.timer=null},_onModelChanging:function(b){this.startLine=
this.model.getLineAtOffset(b.start)},_onModelChanged:function(b){this._dbgEvent(b);var a=this.startLine;(b.removedLineCount||b.addedLineCount)&&Array.prototype.splice.apply(this.lines,[a+1,b.removedLineCount].concat(this._newLines(b.addedLineCount)));this.mode&&(b=Math.max(b.addedLineCount,b.removedLineCount),b=a+Math.min(b,500),this.highlight(a,b),this.highlightLater(b+1))},_onDestroy:function(){this.destroy()},setViewportIndex:function(b){this.viewportIndex=b},_dbgEvent:function(){},_dbgStyle:function(){},
_newLines:function(b){for(var a=[],c=0;c<b;c++)a.push({style:null,eolState:null});return a},setMode:function(b,a){if(b)this.mode=this.codeMirror.getMode(this.codeMirror.options,b),this.lines=this._newLines(this.model.getLineCount()),a&&this.highlight()},highlight:function(b,a,c){if(this.mode){for(var e=this.model.getLineCount(),b=typeof b==="undefined"?0:b,a=typeof a==="undefined"?e-1:Math.min(a,e-1),e=this.mode,f=this.getState(b),h=b;h<=a;h++){var j=this.lines[h];this.highlightLine(h,j,f);j.eolState=
this.codeMirror.copyState(e,f)}this._expandRange(b,a);if(!c)this.onHighlightDone()}},highlightLater:function(b){this.dirtyLines.push(b);var a=this;this.timer=setTimeout(function(){a._highlightJob()},50)},_highlightJob:function(){for(var b=+new Date+30,a=this.mode.compareStates,c=this.model.getLineCount();this.dirtyLines.length;){var e=this.viewportIndex,f=this.lines[e],e=f&&!f.eolState?e:this.dirtyLines.pop();if(e>=c)break;this._expandRange(e,e);for(var f=this._getResumeLineIndex(e),e=f+1,f=(f=f>=
0&&this.lines[f].eolState)?this.codeMirror.copyState(this.mode,f):this.mode.startState(),h=0,j=e;j<c;j++){var o=this.lines[j],d=o.eolState,k=this.highlightLine(j,o,f);o.eolState=this.codeMirror.copyState(this.mode,f);k&&this._expandRange(e,j+1);var o=a&&d&&a(d,o.eolState),r=!a&&!k&&h++>3;if(o||r)break;else if(!d||k)h=0;d=j<c||this.dirtyLines.length;if(+new Date>b&&d){this.highlightLater(j+1);this.onHighlightDone();return}}}this.onHighlightDone()},onHighlightDone:function(){this.startLine!==Number.MAX_VALUE&&
this.endLine!==-1&&this.dispatchEvent({type:"Highlight",start:this.startLine,end:this.endLine});this.startLine=Number.MAX_VALUE;this.endLine=-1},_getResumeLineIndex:function(b){for(var a=this.lines,c=b-1;c>=0;c--)if(a[c].eolState||b-c>40)return c;return-1},getState:function(b){var a=this.mode,c=this.lines,e,f;for(e=b-1;e>=0;e--)if(f=c[e],f.eolState||b-e>40)break;var h=e>=0&&c[e].eolState;if(h){h=this.codeMirror.copyState(a,h);for(e=Math.max(0,e);e<b-1;e++)f=c[e],this.highlightLine(e,f,h),f.eolState=
this.codeMirror.copyState(a,h);return h}else return a.startState()},highlightLine:function(b,a,c){if(this.mode){var e=this.model;e.getLineStart(b)===e.getLineEnd(b)&&this.mode.blankLine&&this.mode.blankLine(c);for(var f=a.style||[],b=e.getLine(b),b=new j(b),e=!a.style,h=[],o=0;!b.eol();o++){var p=this.mode.token(b,c)||null,d=b.current();this._whitespaceStyle(p,d,b.tokenStart);p=[b.tokenStart,b.pos,p];d=f[o];h.push(p);e=e||!d||d[0]!==p[0]||d[1]!==p[1]||d[2]!==p[2];b.advance()}if(e=e||h.length!==f.length)a.style=
h.length?h:null;return e}},_whitespaceStyle:function(b,a,c){if(!b&&this.isWhitespaceVisible&&/\s+/.test(a)){for(var b=[],e,f,h=0;h<a.length;h++){var j=a[h];j!==f&&(f&&b.push([c+e,c+h,f==="\t"?"token_tab":"token_space"]),e=h,f=j)}b.push([c+e,c+h,f==="\t"?"token_tab":"token_space"]);return b}return null},_expandRange:function(b,a){this.startLine=Math.min(this.startLine,b);this.endLine=Math.max(this.endLine,a)},toStyleRangesAndErrors:function(b,a){var c=b.style;if(!c)return null;for(var e=[],f=[],h=
typeof a==="undefined"?0:this.model.getLineStart(a),j=0;j<c.length;j++){var o=c[j],d=!o[2]?null:o[2]==="token_tab"||o[2]==="token_space"?o[2]:"cm-"+o[2];d&&(o={start:h+o[0],end:h+o[1],style:{styleClass:d}},e.push(o),d==="cm-error"&&f.push(o))}return[e,f]},getLineStyle:function(b){return this.lines[b]},getLineStyles:function(){return this.lines}};p.EventTarget.addMixin(e.prototype);o.AnnotationType.registerType("orion.annotation.highlightError",{title:s.syntaxError,html:"<div class='annotationHTML error'></div>",
rangeStyle:{styleClass:"annotationRange error"}});h.prototype={init:function(b,a,c){this.textView=b;this.annotationModel=c;this.modeApplier=new e(b.getModel(),a);var f=this;this.listener={onLineStyle:function(a){f.onLineStyle(a)},onDestroy:function(a){f.onDestroy(a)},onHighlight:function(a){f.onHighlight(a)}};b.addEventListener("LineStyle",this.listener.onLineStyle);b.addEventListener("Destroy",this.listener.onDestroy);this.modeApplier.addEventListener("Highlight",this.listener.onHighlight)},destroy:function(){this.modeApplier&&
(this.modeApplier.removeEventListener("Highlight",this.listener.onHighlight),this.modeApplier.destroy());this.textView&&(this.textView.removeEventListener("LineStyle",this.listener.onLineStyle),this.textView.removeEventListener("Destroy",this.listener.onDestroy));this.listener=this.modeApplier=this.annotationModel=this.textView=null},setMode:function(b){this.modeApplier.setMode(b)},onLineStyle:function(b){var a=b.lineIndex,c=this.modeApplier,e=c.getLineStyle(a);if(!e||!e.eolState){var f=this.textView.getModel().getLineCount();
c.highlight(a,Math.min(a+20,f-1),!0);e=c.getLineStyle(a)}f=this.textView.getModel();if(e){var h=c.toStyleRangesAndErrors(e,a);if(h&&(b.ranges=h[0],b=this.annotationModel)){c=[];e=[];if(h=h[1])for(var j=0;j<h.length;j++){var p=h[j];p.style.styleClass==="cm-error"&&e.push(o.AnnotationType.createAnnotation("orion.annotation.highlightError",p.start,p.end))}for(a=b.getAnnotations(f.getLineStart(a),f.getLineEnd(a));a.hasNext();)f=a.next(),f.type==="orion.annotation.highlightError"&&c.push(f);b.replaceAnnotations(c,
e)}}},onHighlight:function(b){this.textView.redrawLines(b.start,b.end)},onDestroy:function(){this.destroy()}};return{Mirror:b,ModeApplier:e,CodeMirrorStyler:h}});
define("orion/editor/textMateStyler",["orion/editor/regex"],function(s){function p(b){var f;if(b instanceof Array){f=Array(b.length);for(var e=0;e<b.length;e++)f[e]=p(b[e])}else for(e in f={},b)if(Object.prototype.hasOwnProperty.call(b,e)){var h=b[e];f[e]=typeof h==="object"&&h!==null?p(h):h}return f}function o(b,f,e){this.initialize(b);this.grammar=p(f);this.externalGrammars=e?p(e):[];this._styles={};this._tree=null;this._allGrammars={};this.preprocess(this.grammar)}var j={unsupported:[{regex:/\(\?[ims\-]:/,
func:function(){return"option on/off for subexp"}},{regex:/\(\?<([=!])/,func:function(b){return b[1]==="="?"lookbehind":"negative lookbehind"}},{regex:/\(\?>/,func:function(){return"atomic group"}}],toRegExp:function(b){function f(a,b){throw Error('Unsupported regex feature "'+a+'": "'+b[0]+'" at index: '+b.index+" in "+b.input);}var e="",h,b=j.processGlobalFlag("x",b,function(a){for(var b="",e=!1,f=a.length,g=0;g<f;){var h=a.charAt(g);if(!e&&h==="#")for(;g<f&&h!=="\r"&&h!=="\n";)h=a.charAt(++g);
else if(!e&&/\s/.test(h))for(;g<f&&/\s/.test(h);)h=a.charAt(++g);else h==="\\"?(b+=h,/\s/.test(a.charAt(g+1))||(b+=a.charAt(g+1),g+=1)):(h==="["?e=!0:h==="]"&&(e=!1),b+=h),g+=1}return b}),b=j.processGlobalFlag("i",b,function(a){e+="i";return a});for(h=0;h<this.unsupported.length;h++){var g;(g=this.unsupported[h].regex.exec(b))&&f(this.unsupported[h].func(g),g)}return RegExp(b,e)},processGlobalFlag:function(b,f,e){function h(a,b){for(var e=0,f=a.length,g=-1,h=b;h<f&&g===-1;h++)switch(a.charAt(h)){case "\\":h++;
break;case "(":e++;break;case ")":e--,e===0&&(g=h)}return g}var g="(?"+b+")",b="(?"+b+":";if(f.substring(0,g.length)===g)return e(f.substring(g.length));else if(f.substring(0,b.length)===b){g=h(f,0);if(g<f.length-1)throw Error("Only a "+b+") group that encloses the entire regex is supported in: "+f);return e(f.substring(b.length,g))}return f},hasBackReference:function(b){return/\\\d+/.test(b.source)},getSubstitutedRegex:function(b,f,e){for(var e=typeof e==="undefined"?!0:!1,b=b.source.split(/(\\\d+)/g),
h=[],g=0;g<b.length;g++){var a=b[g],c=/\\(\d+)/.exec(a);c?(a=f[c[1]]||"",h.push(e?s.escape(a):a)):h.push(a)}return RegExp(h.join(""))},groupify:function(b,f){for(var e=b.source,h=e.length,g=[],a=0,c=[],j=1,l=1,n=[],o={},p={},d=0;d<h;d++){var k=g[g.length-1],r=e.charAt(d);switch(r){case "(":if(k===4)g.pop(),n.push(")"),c[c.length-1].end=d;var i=d+2<h?e.charAt(d+1)+""+e.charAt(d+2):null;if(i==="?:"||i==="?="||i==="?!"){var s;i==="?:"?s=1:(s=3,a++);g.push(s);c.push({start:d,end:-1,type:s});n.push(r);
n.push(i);d+=i.length}else g.push(2),c.push({start:d,end:-1,type:2,oldNum:j,num:l}),n.push(r),a===0&&(p[l]=null),o[j]=l,j++,l++;break;case ")":k=g.pop();k===3&&a--;c[c.length-1].end=d;n.push(r);break;case "*":case "+":case "?":case "}":var m=r,y=e.charAt(d-1),i=d-1;if(r==="}"){for(s=d-1;e.charAt(s)!=="{"&&s>=0;s--);y=e.charAt(s-1);i=s-1;m=e.substring(s,d+1)}s=c[c.length-1];if(y===")"&&(s.type===2||s.type===4)){n.splice(s.start,0,"(");n.push(m);n.push(")");r={start:s.start,end:n.length-1,type:4,num:s.num};
for(y=0;y<c.length;y++)if(k=c[y],(k.type===2||k.type===4)&&k.start>=s.start&&k.end<=i)if(k.start+=1,k.end+=1,k.num+=1,k.type===2)o[k.oldNum]=k.num;c.push(r);l++;break}default:r!=="|"&&k!==2&&k!==4&&a===0&&(g.push(4),c.push({start:d,end:-1,type:4,num:l}),n.push("("),p[l]=null,l++),n.push(r),r==="\\"&&(r=e.charAt(d+1),n.push(r),d+=1)}}for(;g.length;)g.pop(),n.push(")");var e=RegExp(n.join("")),h={},f=f||o,A;for(A in f)f.hasOwnProperty(A)&&(h[A]="\\"+f[A]);e=this.getSubstitutedRegex(e,h,!1);return[e,
o,p]},complexCaptures:function(b){if(!b)return!1;for(var f in b)if(b.hasOwnProperty(f)&&f!=="0")return!0;return!1}};o.prototype={initialize:function(b){this.textView=b;this.textView.stylerOptions=this;var f=this;this._listener={onModelChanged:function(b){f.onModelChanged(b)},onDestroy:function(b){f.onDestroy(b)},onLineStyle:function(b){f.onLineStyle(b)},onStorage:function(b){f.onStorage(b)}};b.addEventListener("ModelChanged",this._listener.onModelChanged);b.addEventListener("Destroy",this._listener.onDestroy);
b.addEventListener("LineStyle",this._listener.onLineStyle);b.redrawLines()},onDestroy:function(){this.destroy()},destroy:function(){if(this.textView)this.textView.removeEventListener("ModelChanged",this._listener.onModelChanged),this.textView.removeEventListener("Destroy",this._listener.onDestroy),this.textView.removeEventListener("LineStyle",this._listener.onLineStyle),this.textView=null;this._listener=this._tree=this._styles=this.grammar=null},preprocess:function(b){for(b=[b];b.length!==0;){var f=
b.pop();if(!f._resolvedRule||!f._typedRule)if(f._resolvedRule=this._resolve(f),f._typedRule=this._createTypedRule(f),this.addStyles(f.name),this.addStyles(f.contentName),this.addStylesForCaptures(f.captures),this.addStylesForCaptures(f.beginCaptures),this.addStylesForCaptures(f.endCaptures),f._resolvedRule!==f&&b.push(f._resolvedRule),f.patterns)for(var e=0;e<f.patterns.length;e++)b.push(f.patterns[e])}},addStyles:function(b){if(b&&!this._styles[b]){this._styles[b]=[];for(var f=b.split("."),e=0;e<
f.length;e++)this._styles[b].push(f.slice(0,e+1).join("-"))}},addStylesForCaptures:function(b){for(var f in b)b.hasOwnProperty(f)&&this.addStyles(b[f].name)},ContainerRule:function(){function b(b){this.rule=b;this.subrules=b.patterns}b.prototype.valueOf=function(){return"aa"};return b}(),BeginEndRule:function(){function b(b){this.rule=b;this.beginRegex=j.toRegExp(b.begin);this.endRegex=j.toRegExp(b.end);this.subrules=b.patterns||[];this.endRegexHasBackRef=j.hasBackReference(this.endRegex);var e=j.complexCaptures(b.captures),
b=j.complexCaptures(b.beginCaptures)||j.complexCaptures(b.endCaptures);if(this.isComplex=e||b)e=j.groupify(this.beginRegex),this.beginRegex=e[0],this.beginOld2New=e[1],this.beginConsuming=e[2],e=j.groupify(this.endRegex,this.beginOld2New),this.endRegex=e[0],this.endOld2New=e[1],this.endConsuming=e[2]}b.prototype.valueOf=function(){return this.beginRegex};return b}(),MatchRule:function(){function b(b){this.rule=b;this.matchRegex=j.toRegExp(b.match);if(this.isComplex=j.complexCaptures(b.captures))b=
j.groupify(this.matchRegex),this.matchRegex=b[0],this.matchOld2New=b[1],this.matchConsuming=b[2]}b.prototype.valueOf=function(){return this.matchRegex};return b}(),_createTypedRule:function(b){return b.match?new this.MatchRule(b):b.begin?new this.BeginEndRule(b):new this.ContainerRule(b)},_resolve:function(b){var f=b;if(b.include){if(b.begin||b.end||b.match)throw Error('Unexpected regex pattern in "include" rule '+b.include);b=b.include;if(b.charAt(0)==="#"){if(f=this.grammar.repository&&this.grammar.repository[b.substring(1)],
!f)throw Error("Couldn't find included rule "+b+" in grammar repository");}else if(b==="$self")f=this.grammar;else if(b==="$base")throw Error('Include "$base" is not supported');else if(f=this._allGrammars[b],!f)for(var e=0;e<this.externalGrammars.length;e++){var h=this.externalGrammars[e];if(h.scopeName===b){this.preprocess(h);f=this._allGrammars[b]=h;break}}}return f},ContainerNode:function(){function b(b,e){this.parent=b;this.rule=e;this.children=[];this.end=this.start=null}b.prototype.addChild=
function(b){this.children.push(b)};b.prototype.valueOf=function(){var b=this.rule;return"ContainerNode { "+(b.include||"")+" "+(b.name||"")+(b.comment||"")+"}"};return b}(),BeginEndNode:function(){function b(b,e,h){this.parent=b;this.rule=e;this.children=[];this.setStart(h);this.endMatch=this.end=null;this.endRegexSubstituted=e.endRegexHasBackRef?j.getSubstitutedRegex(e.endRegex,h):null}b.prototype.addChild=function(b){this.children.push(b)};b.prototype.getIndexInParent=function(){return this.parent?
this.parent.children.indexOf(this):-1};b.prototype.setStart=function(b){this.start=b.index;this.beginMatch=b};b.prototype.setEnd=function(b){b&&typeof b==="object"?(this.endMatch=b,this.end=b.index+b[0].length):(this.endMatch=null,this.end=b)};b.prototype.shiftStart=function(b){this.start+=b;this.beginMatch.index+=b};b.prototype.shiftEnd=function(b){this.end+=b;this.endMatch&&(this.endMatch.index+=b)};b.prototype.valueOf=function(){return"{"+this.rule.beginRegex+" range="+this.start+".."+this.end+
"}"};return b}(),push:function(b,f){if(f)for(var e=f.length;e>0;)b.push(f[--e])},exec:function(b,f,e){(f=b.exec(f))&&(f.index+=e);b.lastIndex=0;return f},afterMatch:function(b){return b.index+b[0].length},getEndMatch:function(b,f,e){if(b instanceof this.BeginEndNode){var h=b.rule,b=b.endRegexSubstituted||h.endRegex;return!b?null:this.exec(b,f,e)}return null},initialParse:function(){this.textView.getModel().getCharCount();this._tree=new this.ContainerNode(null,this.grammar._typedRule);this.parse(this._tree,
!1,0)},onModelChanged:function(b){var f=b.addedCharCount,e=b.removedCharCount,b=b.start;if(this._tree){var h=this.textView.getModel(),g=h.getCharCount(),h=h.getLineEnd(h.getLineAtOffset(b)-1),a=this.getFirstDamaged(h,h),h=h===-1?0:h,f=a?this.parse(a,!0,h,b,f,e):g;this.textView.redrawRange(h,f)}else this.initialParse()},getFirstDamaged:function(b,f){if(b<0)return this._tree;for(var e=[this._tree],h=null;e.length;){var g=e.pop();if(!g.parent||this.isDamaged(g,b,f)){g instanceof this.BeginEndNode&&(h=
g);for(var a=0;a<g.children.length;a++)e.push(g.children[a])}}return h||this._tree},isDamaged:function(b,f,e){return b.start<=e&&b.end>f},parse:function(b,f,e,h,g,a){var c=this.textView.getModel(),j=c.getLineStart(c.getLineCount()-1),l=c.getCharCount(),n=this.getInitialExpected(b,e),o=-1;if(f)b.repaired=!0,b.endNeedsUpdate=!0,o=(o=b.children[b.children.length-1])?c.getLineEnd(c.getLineAtOffset(o.end+(g-a))):-1,h=c.getLineEnd(c.getLineAtOffset(h+a)),o=Math.max(o,h);for(var o=o===-1?l:o,h=n,p=b,d=!1,
k=e,r=-1;p&&(!f||k<o);){var i=this.getNextMatch(c,p,k);i||(k=k>=j?l:c.getLineStart(c.getLineAtOffset(k)+1));var s=i&&i.match,m=i&&i.rule,y=i&&i.isEnd;if(i&&i.isSub){if(k=this.afterMatch(s),m instanceof this.BeginEndRule)d=!0,f&&m===h.rule&&p===h.parent?(p=h,p.setStart(s),p.repaired=!0,p.endNeedsUpdate=!0,h=this.getNextExpected(h,"begin")):(f&&(this.prune(p,h),f=!1),s=new this.BeginEndNode(p,m,s),p.addChild(s),p=s)}else if(y||k===l){if(p instanceof this.BeginEndNode)s?(d=!0,r=Math.max(r,p.end),p.setEnd(s),
k=this.afterMatch(s),f&&p===h&&p.parent===h.parent?(p.repaired=!0,delete p.endNeedsUpdate,h=this.getNextExpected(h,"end")):f&&(this.prune(p,h),f=!1)):(p.setEnd(l),delete p.endNeedsUpdate);p=p.parent}f&&k>=o&&!d&&(this.prune(b,n),f=!1)}this.removeUnrepairedChildren(b,f,e);this.cleanup(f,b,e,o,l,g,a);return f?Math.max(r,k):k},removeUnrepairedChildren:function(b,f,e){if(f){for(var f=b.children,h=-1,g=0;g<f.length;g++){var a=f[g];if(!a.repaired&&this.isDamaged(a,e,Number.MAX_VALUE)){h=g;break}}if(h!==
-1)b.children.length=h}},cleanup:function(b,f,e,h,g,a,c){if(b){b=a-c;g=this.getIntersecting(h-b+1,g);f=this.getIntersecting(e,h);for(e=0;e<g.length;e++)h=g[e],!h.repaired&&h instanceof this.BeginEndNode&&(h.shiftEnd(b),h.shiftStart(b));for(e=0;e<f.length;e++)h=f[e],h.repaired&&h.endNeedsUpdate&&h.shiftEnd(b),delete h.endNeedsUpdate,delete h.repaired}else{f=this.getIntersecting(e,h);for(e=0;e<f.length;e++)delete f[e].repaired}},getNextMatch:function(b,f,e,h){var g=b.getLineAtOffset(e),g=b.getLineEnd(g),
a=b.getText(e,g),c=[],j=[],b=[],g=[];for(this.push(c,f.rule.subrules);c.length;){var l=c.length?c.pop():null,l=l&&l._resolvedRule._typedRule;if(l instanceof this.ContainerRule&&j.indexOf(l)===-1)j.push(l),this.push(c,l.subrules);else if(!l||!h||l.matchRegex){var n=l&&this.exec(l.matchRegex||l.beginRegex,a,e);n&&(b.push(n),g.push(l))}}c=Number.MAX_VALUE;j=-1;for(l=0;l<b.length;l++)if(n=b[l],n.index<c)c=n.index,j=l;if(!h&&(e=this.getEndMatch(f,a,e)))if(h=f.rule.applyEndPatternLast,j===-1||e.index<c||
!h&&e.index===c)return{isEnd:!0,rule:f.rule,match:e};return j===-1?null:{isSub:!0,rule:g[j],match:b[j]}},getInitialExpected:function(b,f){var e,h;if(b===this._tree)for(e=0;e<b.children.length;e++){if(h=b.children[e],h.start>=f)return h}else if(b instanceof this.BeginEndNode&&b.endMatch){var g=b.endMatch.index;for(e=0;e<b.children.length;e++)if(h=b.children[e],h.start>=f)break;if(h&&h.start<g)return h}return b},getNextExpected:function(b,f){if(f==="begin"){var e=b.children[0];return e?e:b}else if(f===
"end"&&(e=b.parent)){var h=e.children[e.children.indexOf(b)+1];return h?h:e}return null},prune:function(b,f){if(f.parent===b)b.children.length=f.getIndexInParent();else if(b instanceof this.BeginEndNode)b.endMatch=null,b.end=null;if(b.parent)b.parent.children.length=b.getIndexInParent()+1},onLineStyle:function(b){this._tree||this.initialParse();var f=b.lineStart,e=this.textView.getModel(),h=e.getLineEnd(b.lineIndex),g=e.getLineEnd(e.getLineAtOffset(f)-1),g=this.getFirstDamaged(g,g),f=this.getLineScope(e,
g,f,h);b.ranges=this.toStyleRanges(f);b.ranges.sort(function(a,b){return a.start-b.start})},getLineScope:function(b,f,e,h){for(var g=e,a=this.getInitialExpected(f,e),c=[],j=[];f&&g<h;){var l=this.getNextMatch(b,f,g);if(!l)break;var n=l&&l.match,o=l&&l.rule,p=l&&l.isSub,l=l&&l.isEnd;n.index!==g&&j.push({start:g,end:n.index,node:f});if(p)g=this.afterMatch(n),o instanceof this.BeginEndRule?(this.addBeginScope(c,n,o),f=a,a=this.getNextExpected(a,"begin")):this.addMatchScope(c,n,o);else if(l)g=this.afterMatch(n),
this.addEndScope(c,n,o),a=this.getNextExpected(a,"end"),f=f.parent}g<h&&j.push({start:g,end:h,node:f});b=this.getInheritedLineScope(j,e,h);return c.concat(b)},getInheritedLineScope:function(b){for(var f=[],e=0;e<b.length;e++)for(var h=b[e],g=h.node;g;){var a=g.rule.rule,c=a.name;if(a=a.contentName||c){this.addScopeRange(f,h.start,h.end,a);break}g=g.parent}return f},addBeginScope:function(b,f,e){var h=e.rule;this.addCapturesScope(b,f,h.beginCaptures||h.captures,e.isComplex,e.beginOld2New,e.beginConsuming)},
addEndScope:function(b,f,e){var h=e.rule;this.addCapturesScope(b,f,h.endCaptures||h.captures,e.isComplex,e.endOld2New,e.endConsuming)},addMatchScope:function(b,f,e){var h=e.rule,g=h.name;(h=h.captures)?this.addCapturesScope(b,f,h,e.isComplex,e.matchOld2New,e.matchConsuming):this.addScope(b,f,g)},addScope:function(b,f,e){e&&b.push({start:f.index,end:this.afterMatch(f),scope:e})},addScopeRange:function(b,f,e,h){h&&b.push({start:f,end:e,scope:h})},addCapturesScope:function(b,f,e,h,g,a){if(e)if(h){for(var h=
{1:0},c=0,j=1;f[j]!==void 0;j++)a[j]!==void 0&&(c+=f[j].length),f[j+1]!==void 0&&(h[j+1]=c);a=f.index;for(c=1;e[c];c++){var j=e[c].name,l=g[c],n=a+h[l];typeof f[l]!=="undefined"&&this.addScopeRange(b,n,n+f[l].length,j)}}else this.addScope(b,f,e[0]&&e[0].name)},getIntersecting:function(b,f){for(var e=[],h=this._tree?[this._tree]:[];h.length;){var g=h.pop(),a=!1;g instanceof this.ContainerNode?a=!0:this.isDamaged(g,b,f)&&(a=!0,e.push(g));if(a)for(var a=g.children.length,c=0;c<a;c++)h.push(g.children[c])}return e.reverse()},
toStyleRanges:function(b){for(var f=[],e=0;e<b.length;e++){var h=b[e],g=this._styles[h.scope];if(!g)throw Error("styles not found for "+h.scope);g=g.join(" ");f.push({start:h.start,end:h.end,style:{styleClass:g}})}return f}};return{RegexUtil:j,TextMateStyler:o}});
define("orion/editor/htmlGrammar",[],function(){return{HtmlGrammar:function(){return{scopeName:"source.html",uuid:"3B5C76FB-EBB5-D930-F40C-047D082CE99B",patterns:[{begin:"<!(doctype|DOCTYPE)",end:">",contentName:"entity.name.tag.doctype.html",beginCaptures:{0:{name:"entity.name.tag.doctype.html"}},endCaptures:{0:{name:"entity.name.tag.doctype.html"}}},{begin:"<\!--",end:"--\>",beginCaptures:{0:{name:"punctuation.definition.comment.html"}},endCaptures:{0:{name:"punctuation.definition.comment.html"}},
patterns:[{match:"--",name:"invalid.illegal.badcomment.html"}],contentName:"comment.block.html"},{match:"<[A-Za-z0-9_\\-:]+(?= ?)",name:"entity.name.tag.html"},{include:"#attrName"},{include:"#qString"},{include:"#qqString"},{include:"#entity"},{match:"</[A-Za-z0-9_\\-:]+>",name:"entity.name.tag.html"},{match:">",name:"entity.name.tag.html"}],repository:{attrName:{match:"[A-Za-z\\-:]+(?=\\s*=\\s*['\"])",name:"entity.other.attribute.name.html"},qqString:{match:'(")[^"]+(")',name:"string.quoted.double.html"},
qString:{match:"(')[^']+(')",name:"string.quoted.single.html"},entity:{match:"&[A-Za-z0-9]+;",name:"constant.character.entity.html"}}}}}});
define("examples/editor/textStyler",["orion/editor/annotations"],function(s){function p(a,b){this.keywords=a;this.whitespacesVisible=b;this.setText("")}function o(){p.call(this,null,!0)}function j(a){p.call(this,null,a)}function b(){p.call(this,null,!1)}function f(a,c,d){this.commentStart="/*";this.commentEnd="*/";var f=[];switch(c){case "java":f=h;break;case "js":f=e;break;case "css":f=g}this.whitespacesVisible=!1;this.detectHyperlinks=!0;this.highlightCaretLine=!1;this.detectTasks=this.foldingEnabled=
!0;this._scanner=new p(f,this.whitespacesVisible);this._firstScanner=new b;this._commentScanner=new j(this.whitespacesVisible);this._whitespaceScanner=new o;if(c==="css")this._scanner.isCSS=!0,this._firstScanner.isCSS=!0;this.view=a;this.annotationModel=d;this._bracketAnnotations=void 0;var i=this;this._listener={onChanged:function(a){i._onModelChanged(a)},onDestroy:function(a){i._onDestroy(a)},onLineStyle:function(a){i._onLineStyle(a)},onMouseDown:function(a){i._onMouseDown(a)},onSelection:function(a){i._onSelection(a)}};
c=a.getModel();c.getBaseModel&&(c=c.getBaseModel());c.addEventListener("Changed",this._listener.onChanged);a.addEventListener("MouseDown",this._listener.onMouseDown);a.addEventListener("Selection",this._listener.onSelection);a.addEventListener("Destroy",this._listener.onDestroy);a.addEventListener("LineStyle",this._listener.onLineStyle);this._computeComments();this._computeFolding();a.redrawLines()}var e="break,case,class,catch,continue,const,debugger,default,delete,do,else,enum,export,extends,false,finally,for,function,if,implements,import,in,instanceof,interface,let,new,null,package,private,protected,public,return,static,super,switch,this,throw,true,try,typeof,undefined,var,void,while,with,yield".split(","),
h="abstract,boolean,break,byte,case,catch,char,class,continue,default,do,double,else,extends,false,final,finally,float,for,if,implements,import,instanceof,int,interface,long,native,new,null,package,private,protected,public,return,short,static,super,switch,synchronized,this,throw,throws,transient,true,try,void,volatile,while".split(","),g="alignment-adjust,alignment-baseline,animation,animation-delay,animation-direction,animation-duration,animation-iteration-count,animation-name,animation-play-state,animation-timing-function,appearance,azimuth,backface-visibility,background,background-attachment,background-clip,background-color,background-image,background-origin,background-position,background-repeat,background-size,baseline-shift,binding,bleed,bookmark-label,bookmark-level,bookmark-state,bookmark-target,border,border-bottom,border-bottom-color,border-bottom-left-radius,border-bottom-right-radius,border-bottom-style,border-bottom-width,border-collapse,border-color,border-image,border-image-outset,border-image-repeat,border-image-slice,border-image-source,border-image-width,border-left,border-left-color,border-left-style,border-left-width,border-radius,border-right,border-right-color,border-right-style,border-right-width,border-spacing,border-style,border-top,border-top-color,border-top-left-radius,border-top-right-radius,border-top-style,border-top-width,border-width,bottom,box-align,box-decoration-break,box-direction,box-flex,box-flex-group,box-lines,box-ordinal-group,box-orient,box-pack,box-shadow,box-sizing,break-after,break-before,break-inside,caption-side,clear,clip,color,color-profile,column-count,column-fill,column-gap,column-rule,column-rule-color,column-rule-style,column-rule-width,column-span,column-width,columns,content,counter-increment,counter-reset,crop,cue,cue-after,cue-before,cursor,direction,display,dominant-baseline,drop-initial-after-adjust,drop-initial-after-align,drop-initial-before-adjust,drop-initial-before-align,drop-initial-size,drop-initial-value,elevation,empty-cells,fit,fit-position,flex-align,flex-flow,flex-inline-pack,flex-order,flex-pack,float,float-offset,font,font-family,font-size,font-size-adjust,font-stretch,font-style,font-variant,font-weight,grid-columns,grid-rows,hanging-punctuation,height,hyphenate-after,hyphenate-before,hyphenate-character,hyphenate-lines,hyphenate-resource,hyphens,icon,image-orientation,image-rendering,image-resolution,inline-box-align,left,letter-spacing,line-height,line-stacking,line-stacking-ruby,line-stacking-shift,line-stacking-strategy,list-style,list-style-image,list-style-position,list-style-type,margin,margin-bottom,margin-left,margin-right,margin-top,mark,mark-after,mark-before,marker-offset,marks,marquee-direction,marquee-loop,marquee-play-count,marquee-speed,marquee-style,max-height,max-width,min-height,min-width,move-to,nav-down,nav-index,nav-left,nav-right,nav-up,opacity,orphans,outline,outline-color,outline-offset,outline-style,outline-width,overflow,overflow-style,overflow-x,overflow-y,padding,padding-bottom,padding-left,padding-right,padding-top,page,page-break-after,page-break-before,page-break-inside,page-policy,pause,pause-after,pause-before,perspective,perspective-origin,phonemes,pitch,pitch-range,play-during,position,presentation-level,punctuation-trim,quotes,rendering-intent,resize,rest,rest-after,rest-before,richness,right,rotation,rotation-point,ruby-align,ruby-overhang,ruby-position,ruby-span,size,speak,speak-header,speak-numeral,speak-punctuation,speech-rate,stress,string-set,table-layout,target,target-name,target-new,target-position,text-align,text-align-last,text-decoration,text-emphasis,text-height,text-indent,text-justify,text-outline,text-shadow,text-transform,text-wrap,top,transform,transform-origin,transform-style,transition,transition-delay,transition-duration,transition-property,transition-timing-function,unicode-bidi,vertical-align,visibility,voice-balance,voice-duration,voice-family,voice-pitch,voice-pitch-range,voice-rate,voice-stress,voice-volume,volume,white-space,white-space-collapse,widows,width,word-break,word-spacing,word-wrap,z-index".split(","),
a={styleClass:"comment"},c={styleClass:"token_multiline_comment"},q={styleClass:"token_doc_comment"},l={styleClass:"token_doc_html_markup"},n={styleClass:"token_task_tag"},u={styleClass:"token_doc_tag"},t={styleClass:"token_string"},d={styleClass:"token_number"},k={styleClass:"token_keyword"},r={styleClass:"token_space"},i={styleClass:"token_tab"},x={styleClass:"line_caret"};p.prototype={getOffset:function(){return this.offset},getStartOffset:function(){return this.startOffset},getData:function(){return this.text.substring(this.startOffset,
this.offset)},getDataLength:function(){return this.offset-this.startOffset},_default:function(a){switch(a){case 32:case 9:if(this.whitespacesVisible)return a===32?11:10;do a=this._read();while(a===32||a===9);this._unread(a);return 9;case 123:case 125:case 40:case 41:case 91:case 93:case 60:case 62:return a;default:var b=this.isCSS,c=this.offset-1;if(!b&&48<=a&&a<=57){var d=b=!1,e=!1,f=a;do if(a=this._read(),a===46&&!b)b=!0;else if(a===101&&!d)b=d=!0,a=this._read(),a!==45&&this._unread(a);else if(a===
120&&f===48&&this.offset-c===2)b=d=e=!0;else if(!(48<=a&&a<=57||e&&(65<=a&&a<=70||97<=a&&a<=102)))break;while(1);this._unread(a);return 3}if(97<=a&&a<=122||65<=a&&a<=90||a===95||45===a&&b){do a=this._read();while(97<=a&&a<=122||65<=a&&a<=90||a===95||48<=a&&a<=57||45===a&&b);this._unread(a);a=this.keywords;if(a.length>0){c=this.text.substring(c,this.offset);for(b=0;b<a.length;b++)if(this.keywords[b]===c)return 2}}return 1}},_read:function(){return this.offset<this.text.length?this.text.charCodeAt(this.offset++):
-1},_unread:function(a){a!==-1&&this.offset--},nextToken:function(){for(this.startOffset=this.offset;;){var a=this._read(),b;switch(a){case -1:return null;case 47:a=this._read();if(!this.isCSS&&a===47)for(;;)if(a=this._read(),a===-1||a===10||a===13)return this._unread(a),6;if(a===42){a=this._read();b=7;for(a===42&&(b=8);;){for(;a===42;)if(a=this._read(),a===47)return b;if(a===-1)return this._unread(a),b;a=this._read()}}this._unread(a);return 1;case 39:for(b=4;;)switch(a=this._read(),a){case 39:return b;
case 13:case 10:case -1:return this._unread(a),b;case 92:switch(a=this._read(),a){case 10:b=5;break;case 13:b=5,a=this._read(),a!==10&&this._unread(a)}}break;case 34:for(b=4;;)switch(a=this._read(),a){case 34:return b;case 13:case 10:case -1:return this._unread(a),b;case 92:switch(a=this._read(),a){case 10:b=5;break;case 13:b=5,a=this._read(),a!==10&&this._unread(a)}}break;default:return this._default(a)}}},setText:function(a){this.text=a;this.startOffset=this.offset=0}};o.prototype=new p(null);o.prototype.nextToken=
function(){for(this.startOffset=this.offset;;){var a=this._read();switch(a){case -1:return null;case 32:return 11;case 9:return 10;default:do a=this._read();while(!(a===32||a===9||a===-1));this._unread(a);return 1}}};j.prototype=new p(null);j.prototype.setType=function(a){this._type=a};j.prototype.nextToken=function(){for(this.startOffset=this.offset;;){var a=this._read();switch(a){case -1:return null;case 32:case 9:if(this.whitespacesVisible)return a===32?11:10;do a=this._read();while(a===32||a===
9);this._unread(a);return 9;case 60:if(this._type===8){do a=this._read();while(!(a===62||a===-1));if(a===62)return 12}return 1;case 64:if(this._type===8){do a=this._read();while(97<=a&&a<=122||65<=a&&a<=90||a===95||48<=a&&a<=57);this._unread(a);return 13}return 1;case 84:if((a=this._read())===79)if((a=this._read())===68)if((a=this._read())===79)if(a=this._read(),!(97<=a&&a<=122||65<=a&&a<=90||a===95||48<=a&&a<=57))return this._unread(a),14;this._unread(a);default:do a=this._read();while(!(a===32||
a===9||a===-1||a===60||a===64||a===84));this._unread(a);return 1}}};b.prototype=new p(null);b.prototype._default=function(a){for(;;)switch(a=this._read(),a){case 47:case 34:case 39:case -1:return this._unread(a),1}};f.prototype={destroy:function(){var a=this.view;if(a){var b=a.getModel();b.getBaseModel&&(b=b.getBaseModel());b.removeEventListener("Changed",this._listener.onChanged);a.removeEventListener("MouseDown",this._listener.onMouseDown);a.removeEventListener("Selection",this._listener.onSelection);
a.removeEventListener("Destroy",this._listener.onDestroy);a.removeEventListener("LineStyle",this._listener.onLineStyle);this.view=null}},setHighlightCaretLine:function(a){this.highlightCaretLine=a},setWhitespacesVisible:function(a){this.whitespacesVisible=a;this._scanner.whitespacesVisible=a;this._commentScanner.whitespacesVisible=a},setDetectHyperlinks:function(a){this.detectHyperlinks=a},setFoldingEnabled:function(a){this.foldingEnabled=a},setDetectTasks:function(a){this.detectTasks=a},_binarySearch:function(a,
b,c,d,e){var f;d===void 0&&(d=-1);if(e===void 0)e=a.length;for(;e-d>1;)if(f=Math.floor((e+d)/2),b<=a[f].start)e=f;else if(c&&b<a[f].end){e=f;break}else d=f;return e},_computeComments:function(){var a=this.view.getModel();a.getBaseModel&&(a=a.getBaseModel());this.comments=this._findComments(a.getText())},_computeFolding:function(){if(this.foldingEnabled){var a=this.view.getModel();if(a.getBaseModel){var b=this.annotationModel;if(b){b.removeAnnotations(s.AnnotationType.ANNOTATION_FOLDING);for(var c=
[],d=a.getBaseModel(),e=this.comments,f=0;f<e.length;f++){var g=e[f];(g=this._createFoldingAnnotation(a,d,g.start,g.end))&&c.push(g)}b.replaceAnnotations(null,c)}}}},_createFoldingAnnotation:function(a,b,c,d){var e=b.getLineAtOffset(c),b=b.getLineAtOffset(d);return e===b?null:new (s.AnnotationType.getType(s.AnnotationType.ANNOTATION_FOLDING))(c,d,a)},_computeTasks:function(a,b,c){if(this.detectTasks){var d=this.annotationModel;if(d){var e=this.view.getModel(),f=e;e.getBaseModel&&(f=e.getBaseModel());
for(var g=d.getAnnotations(b,c),e=[],h=s.AnnotationType.ANNOTATION_TASK;g.hasNext();){var i=g.next();i.type===h&&e.push(i)}g=[];i=this._commentScanner;i.setText(f.getText(b,c));for(var j;j=i.nextToken();){var k=i.getStartOffset()+b;j===14&&(j=f.getLineEnd(f.getLineAtOffset(k)),a!==6&&(j=Math.min(j,c-this.commentEnd.length)),g.push(s.AnnotationType.createAnnotation(h,k,j,f.getText(k,j))))}d.replaceAnnotations(e,g)}}},_getLineStyle:function(a){if(this.highlightCaretLine){var b=this.view,c=b.getModel(),
b=b.getSelection();if(b.start===b.end&&c.getLineAtOffset(b.start)===a)return x}return null},_getStyles:function(a,b,d){a.getBaseModel&&(d=a.mapOffset(d));for(var e=d+b.length,f=[],g=d,h=this.comments,i=this._binarySearch(h,d,!0);i<h.length;i++){if(h[i].start>=e)break;var j=h[i].start,k=h[i].end;g<j&&this._parse(b.substring(g-d,j-d),g,f);var l=h[i].type,n;switch(l){case 8:n=q;break;case 7:n=c;break;case 5:n=t}g=Math.max(g,j);j=Math.min(e,k);(l===8||l===7)&&(this.whitespacesVisible||this.detectHyperlinks)?
this._parseComment(b.substring(g-d,j-d),g,f,n,l):l===5&&this.whitespacesVisible?this._parseString(b.substring(g-d,j-d),g,f,t):f.push({start:g,end:j,style:n});g=k}g<e&&this._parse(b.substring(g-d,e-d),g,f);if(a.getBaseModel)for(b=0;b<f.length;b++)d=f[b].end-f[b].start,f[b].start=a.mapOffset(f[b].start,!0),f[b].end=f[b].start+d;return f},_parse:function(b,e,f){var g=this._scanner;for(g.setText(b);b=g.nextToken();){var h=g.getStartOffset()+e,j=null;switch(b){case 2:j=k;break;case 3:j=d;break;case 5:case 4:if(this.whitespacesVisible){this._parseString(g.getData(),
h,f,t);continue}else j=t;break;case 8:this._parseComment(g.getData(),h,f,q,b);continue;case 6:this._parseComment(g.getData(),h,f,a,b);continue;case 7:this._parseComment(g.getData(),h,f,c,b);continue;case 10:this.whitespacesVisible&&(j=i);break;case 11:this.whitespacesVisible&&(j=r)}f.push({start:h,end:g.getOffset()+e,style:j})}},_parseComment:function(a,b,c,d,e){var f=this._commentScanner;f.setText(a);for(f.setType(e);a=f.nextToken();){var e=f.getStartOffset()+b,g=d;switch(a){case 10:this.whitespacesVisible&&
(g=i);break;case 11:this.whitespacesVisible&&(g=r);break;case 12:g=l;break;case 13:g=u;break;case 14:g=n;break;default:this.detectHyperlinks&&(g=this._detectHyperlinks(f.getData(),e,c,g))}g&&c.push({start:e,end:f.getOffset()+b,style:g})}},_parseString:function(a,b,c,d){var e=this._whitespaceScanner;for(e.setText(a);a=e.nextToken();){var f=e.getStartOffset()+b,g=d;switch(a){case 10:this.whitespacesVisible&&(g=i);break;case 11:this.whitespacesVisible&&(g=r)}g&&c.push({start:f,end:e.getOffset()+b,style:g})}},
_detectHyperlinks:function(a,b,c,d){var e=null,f;if((f=a.indexOf("://"))>0){for(var e=a,g=f;g>0;){f=e.charCodeAt(g-1);if(!(97<=f&&f<=122||65<=f&&f<=90||45===f||48<=f&&f<=57))break;g--}if(g>0&&(f="\"\"''(){}[]<>".indexOf(e.substring(g-1,g)),f!==-1&&(f&1)===0&&(f=e.lastIndexOf("\"\"''(){}[]<>".substring(f+1,f+2)))!==-1)){var h=f;f=this._clone(d);f.tagName="A";f.attributes={href:e.substring(g,h)};c.push({start:b,end:b+g,style:d});c.push({start:b+g,end:b+h,style:f});c.push({start:b+h,end:b+a.length,style:d});
return null}}else a.toLowerCase().indexOf("bug#")===0&&(e="https://bugs.eclipse.org/bugs/show_bug.cgi?id="+parseInt(a.substring(4),10));return e?(f=this._clone(d),f.tagName="A",f.attributes={href:e},f):d},_clone:function(a){if(!a)return a;var b={},c;for(c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},_findComments:function(a,b){var b=b||0,c=this._firstScanner,d;c.setText(a);for(var e=[];d=c.nextToken();)(d===7||d===8||d===5)&&e.push({start:c.getStartOffset()+b,end:c.getOffset()+b,type:d}),(d===
6||d===7||d===8)&&this._computeTasks(d,c.getStartOffset()+b,c.getOffset()+b);return e},_findMatchingBracket:function(a,b){var c="{}()[]<>",d=a.getText(b,b+1),e=c.indexOf(d,0);if(e===-1)return-1;var f;f=e&1?c.substring(e-1,e):c.substring(e+1,e+2);for(var g=a.getLineAtOffset(b),c=a.getLine(g),h=a.getLineStart(g),i=a.getLineEnd(g),c=this._findBrackets(d,f,c,h,h,i),i=0;i<c.length;i++)if(h=c[i]>=0?1:-1,c[i]*h-1===b){var j=1;if(e&1){for(i--;i>=0;i--)if(h=c[i]>=0?1:-1,j+=h,j===0)return c[i]*h-1;for(g-=1;g>=
0;){c=a.getLine(g);h=a.getLineStart(g);i=a.getLineEnd(g);c=this._findBrackets(d,f,c,h,h,i);for(e=c.length-1;e>=0;e--)if(h=c[e]>=0?1:-1,j+=h,j===0)return c[e]*h-1;g--}}else{for(i++;i<c.length;i++)if(h=c[i]>=0?1:-1,j+=h,j===0)return c[i]*h-1;g+=1;for(e=a.getLineCount();g<e;){c=a.getLine(g);h=a.getLineStart(g);i=a.getLineEnd(g);c=this._findBrackets(d,f,c,h,h,i);for(i=0;i<c.length;i++)if(h=c[i]>=0?1:-1,j+=h,j===0)return c[i]*h-1;g++}}break}return-1},_findBrackets:function(a,b,c,d,e,f){for(var g=[],a=
a.charCodeAt(0),b=b.charCodeAt(0),h=e,i=this._scanner,j,k=this.comments,l=this._binarySearch(k,e,!0);l<k.length;l++){if(k[l].start>=f)break;j=k[l].start;var n=k[l].end;if(h<j)for(i.setText(c.substring(h-e,j-e));j=i.nextToken();)j===a?g.push(i.getStartOffset()+h-e+d+1):j===b&&g.push(-(i.getStartOffset()+h-e+d+1));h=n}if(h<f)for(i.setText(c.substring(h-e,f-e));j=i.nextToken();)j===a?g.push(i.getStartOffset()+h-e+d+1):j===b&&g.push(-(i.getStartOffset()+h-e+d+1));return g},_onDestroy:function(){this.destroy()},
_onLineStyle:function(a){if(a.textView===this.view)a.style=this._getLineStyle(a.lineIndex);a.ranges=this._getStyles(a.textView.getModel(),a.lineText,a.lineStart)},_onSelection:function(a){var b=a.oldValue,c=a.newValue,d=this.view,a=d.getModel(),e;if(this.highlightCaretLine){var f=a.getLineAtOffset(b.start);e=a.getLineAtOffset(c.start);var g=c.start===c.end,b=b.start===b.end;f===e&&b&&g||(b&&d.redrawLines(f,f+1),(f!==e||!b)&&g&&d.redrawLines(e,e+1))}if(this.annotationModel){var b=this._bracketAnnotations,
h,i;if(c.start===c.end&&(i=d.getCaretOffset())>0)i-=1,a.getBaseModel&&(i=a.mapOffset(i),a=a.getBaseModel()),a=this._findMatchingBracket(a,i),a!==-1&&(h=[s.AnnotationType.createAnnotation(s.AnnotationType.ANNOTATION_MATCHING_BRACKET,a,a+1),s.AnnotationType.createAnnotation(s.AnnotationType.ANNOTATION_CURRENT_BRACKET,i,i+1)]);this._bracketAnnotations=h;this.annotationModel.replaceAnnotations(b,h)}},_onMouseDown:function(a){if(a.clickCount===2){var b=this.view,c=b.getModel(),d=b.getOffsetAtLocation(a.x,
a.y);if(d>0){var e=d-1,f=c;c.getBaseModel&&(e=c.mapOffset(e),f=c.getBaseModel());e=this._findMatchingBracket(f,e);e!==-1&&(a.preventDefault(),a=e,c.getBaseModel&&(a=c.mapOffset(a,!0)),d>a&&(d--,a++),b.setSelection(a,d))}}},_onModelChanged:function(a){var b=a.start,c=a.removedCharCount,d=a.addedCharCount-c,e=this.view,a=e.getModel(),f=a.getBaseModel?a.getBaseModel():a,c=b+c,g=f.getCharCount(),h=this.comments.length,i=f.getLineStart(f.getLineAtOffset(b)),j=this._binarySearch(this.comments,i,!0),k=this._binarySearch(this.comments,
c,!1,j-1,h);j<h&&this.comments[j].start<=i&&i<this.comments[j].end?(i=this.comments[j].start,i>b&&(i+=d)):i=j===h&&h>0&&g-d===this.comments[h-1].end?this.comments[h-1].start:i;var l;k<h?(l=this.comments[k].end,l>b&&(l+=d),k+=1):(k=h,l=g);for(var n,g=this._findComments(f.getText(i,l),i),h=j;h<this.comments.length;h++)n=this.comments[h],n.start>b&&(n.start+=d),n.start>b&&(n.end+=d);var o=k-j!==g.length;if(!o)for(h=0;h<g.length;h++){n=this.comments[j+h];var p=g[h];if(n.start!==p.start||n.end!==p.end||
n.type!==p.type){o=!0;break}}h=[j,k-j].concat(g);Array.prototype.splice.apply(this.comments,h);o&&(h=i,n=l,a!==f&&(h=a.mapOffset(h,!0),n=a.mapOffset(n,!0)),e.redrawRange(h,n));if(this.foldingEnabled&&f!==a&&this.annotationModel){e=this.annotationModel;j=e.getAnnotations(i,l);i=[];for(l=[];j.hasNext();)if(n=j.next(),n.type===s.AnnotationType.ANNOTATION_FOLDING){l.push(n);for(h=0;h<g.length;h++)if(n.start===g[h].start&&n.end===g[h].end)break;h===g.length?(i.push(n),n.expand()):(h=n.start,k=n.end,h>
b&&(h-=d),k>b&&(k-=d),h<=b&&b<k&&h<=c&&c<k&&(h=f.getLineAtOffset(n.start),k=f.getLineAtOffset(n.end),h!==k?n.expanded||(n.expand(),e.modifyAnnotation(n)):e.removeAnnotation(n)))}b=[];for(h=0;h<g.length;h++){n=g[h];for(d=0;d<l.length;d++)if(l[d].start===n.start&&l[d].end===n.end)break;d===l.length&&(n=this._createFoldingAnnotation(a,f,n.start,n.end))&&b.push(n)}e.replaceAnnotations(i,b)}}};return{TextStyler:f}});
define("orion/editor/edit","orion/editor/textView,orion/editor/textModel,orion/editor/textTheme,orion/editor/projectionTextModel,orion/editor/eventTarget,orion/keyBinding,orion/editor/rulers,orion/editor/annotations,orion/editor/tooltip,orion/editor/undoStack,orion/editor/textDND,orion/editor/editor,orion/editor/editorFeatures,orion/editor/contentAssist,orion/editor/cssContentAssist,orion/editor/htmlContentAssist,orion/editor/jsTemplateContentAssist,orion/editor/AsyncStyler,orion/editor/mirror,orion/editor/textMateStyler,orion/editor/htmlGrammar,examples/editor/textStyler".split(","),function(s,
p,o,j,b,f,e,h,g,a,c,q,l,n,u,t,d,k,r,i,x,m){function y(a){var b=a.firstChild;if(b&&b.tagName==="TEXTAREA")return b.value;var b=a.ownerDocument,c=b.defaultView||b.parentWindow;if(!c.getSelection)return a.innerText||a.textContent;b=b.createRange();b.selectNode(a);var a=c.getSelection(),c=[],d;for(d=0;d<a.rangeCount;d++)c.push(a.getRangeAt(d));a.removeAllRanges();a.addRange(b);b=a.toString();a.removeAllRanges();for(d=0;d<c.length;d++)a.addRange(c[d]);return b}function A(a){if(a.substring(0,12)==="data-editor-")return a=
a.substring(12),a=a.replace(/-([a-z])/ig,function(a,b){return b.toUpperCase()})}function E(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}function I(a,b){var c={};E(c,b);for(var d,e=0,f=a.attributes,g=f.length;e<g;e++){d=f.item(e);var h=A(d.nodeName);if(h){d=d.nodeValue;if(d==="true"||d==="false")d=d==="true";c[h]=d}}return c}function J(a){var b=a.ownerDocument,b=b.defaultView||b.parentWindow,c;if(b.getComputedStyle)c=b.getComputedStyle(a,null).getPropertyValue("height");else if(a.currentStyle)c=
a.currentStyle.height;return parseInt(c,10)||0}function F(a){var b=a.parent;b||(b="editor");typeof b==="string"&&(b=(a.document||document).getElementById(b));if(!b&&a.className){var c=(a.document||document).getElementsByClassName(a.className);if(c){a.className=void 0;for(var e=[],f=0;f<c.length;f++)a.parent=c[f],e.push(F(a));return e}}if(!b)throw"no parent";a=I(b,a);if(typeof a.theme==="string"){var c=o.TextTheme.getTheme(a.theme),f=a.theme.lastIndexOf("/"),g=a.theme;f!==-1&&(g=g.substring(f+1));
c.setThemeClass(g,{href:a.theme});a.theme=c}var h;a.readonly||(e={createContentAssistMode:function(a){h=new n.ContentAssist(a.getTextView());a=new n.ContentAssistWidget(h);return new n.ContentAssistMode(h,a)}});e=new q.Editor({textViewFactory:function(){return new s.TextView({parent:b,model:new j.ProjectionTextModel(new p.TextModel("")),tabSize:a.tabSize?a.tabSize:4,readonly:a.readonly,fullSelection:a.fullSelection,tabMode:a.tabMode,expandTab:a.expandTab,themeClass:a.themeClass,theme:a.theme,wrapMode:a.wrapMode})},
undoStackFactory:new l.UndoFactory,annotationFactory:new l.AnnotationFactory,lineNumberRulerFactory:new l.LineNumberRulerFactory,foldingRulerFactory:new l.FoldingRulerFactory,textDNDFactory:new l.TextDNDFactory,contentAssistFactory:e,keyBindingFactory:function(a,b,c,d){var e=new l.TextActions(a,c);b.push(e);a=new l.SourceCodeActions(a,c,d);b.push(a)},statusReporter:a.statusReporter,domNode:b});c=a.contents;c===void 0&&(c=y(b));c||(c="");e.installTextView();e.setLineNumberRulerVisible(a.showLinesRuler===
void 0||a.showLinesRuler);e.setAnnotationRulerVisible(a.showAnnotationRuler===void 0||a.showFoldingRuler);e.setOverviewRulerVisible(a.showOverviewRuler===void 0||a.showOverviewRuler);e.setFoldingRulerVisible(a.showFoldingRuler===void 0||a.showFoldingRuler);e.setInput(a.title,null,c);({styler:null,highlight:function(b,c){if(this.styler)this.styler.destroy(),this.styler=null;if(b){var d=c.getTextView(),e=c.getAnnotationModel();switch(b){case "js":case "java":case "css":this.styler=new m.TextStyler(d,
b,e);c.setFoldingRulerVisible(a.showFoldingRuler===void 0||a.showFoldingRuler);break;case "html":this.styler=new i.TextMateStyler(d,new x.HtmlGrammar)}}}}).highlight(a.lang,e);if(h){var k=new u.CssContentAssistProvider,r=new d.JSTemplateContentAssistProvider;h.addEventListener("Activating",function(){/css$/.test(a.lang)?h.setProviders([k]):/js$/.test(a.lang)&&h.setProviders([r])})}if(J(b)<=50)c=e.getTextView().computeSize().height,b.style.height=c+"px";return e}var G=this.orion?this.orion.editor:
void 0;if(G)for(var C=0;C<arguments.length;C++)E(G,arguments[C]);return F});define(["orion/editor/edit"],function(s){return s});