(function(e,t){typeof define=="function"&&define.amd?define("orion/Deferred",t):typeof exports=="object"?module.exports=t():(e.orion=e.orion||{},e.orion.Deferred=t())})(this,function(){function r(){var r;while(r=e.shift()||t.shift())r();n=!1}function i(i,s){var o=s?t:e;o.push(i),n||(n=!0,s?setTimeout(r,0):r())}function s(e){return function(){e.apply(null,arguments)}}function o(){}function u(){var e=new Error("Cancel");return e.name="Cancel",e}function a(){function f(){var r;while(r=n.shift()){var i=r.deferred,u=t==="resolved"?"resolve":"reject";if(typeof r[u]=="function")try{var a=r[u](e);a&&typeof a.then=="function"?(i.cancel=a.cancel||o,a.then(s(i.resolve),s(i.reject),i.progress)):i.resolve(a)}catch(f){i.reject(f)}else i[u](e)}}var e,t,n=[],r=this;this.reject=function(s,o){return t||(t="rejected",e=s,n.length&&i(f)),r.promise},this.resolve=function(s,o){return t||(t="resolved",e=s,n.length&&i(f)),r.promise},this.progress=function(e,i){return t||n.forEach(function(t){t.progress&&t.progress(e)}),r.promise},this.cancel=function(){t||r.reject(u())},this.then=function(e,r,s){var o={resolve:e,reject:r,progress:s,deferred:new a},u=o.deferred,l=this.cancel.bind(this),c=function(){i(function(){var e=u.cancel===c?l:u.cancel;e()},!0)};u.cancel=c;var h=u.promise;return h.cancel=function(){u.cancel()},n.push(o),t&&i(f,!0),h},this.promise={then:this.then,cancel:this.cancel}}var e=[],t=[],n=!1;return a.all=function(e,t){function o(e,t){i||(r[e]=t,--n===0&&s.resolve(r))}function u(e,n){if(!i){if(t)try{o(e,t(n));return}catch(r){n=r}s.reject(n)}}var n=e.length,r=[],i=!1,s=new a;return s.then(null,function(){i=!0,e.forEach(function(e){e.cancel&&e.cancel()})}),n===0?s.resolve(r):e.forEach(function(e,t){e.then(o.bind(null,t),u.bind(null,t))}),s.promise},a.when=function(e,t,n,r){var i,s;return e&&typeof e.then=="function"?i=e:(s=new a,s.resolve(e),i=s.promise),i.then(t,n,r)},a}),define("orion/EventTarget",[],function(){function e(){this._namedListeners={}}return e.prototype={dispatchEvent:function(e){if(!e.type)throw new Error("unspecified type");var t=this._namedListeners[e.type];return t&&t.forEach(function(t){try{typeof t=="function"?t(e):t.handleEvent(e)}catch(n){typeof console!="undefined"&&console.log(n)}}),!e.defaultPrevented},addEventListener:function(e,t){if(typeof t=="function"||t.handleEvent)this._namedListeners[e]=this._namedListeners[e]||[],this._namedListeners[e].push(t)},removeEventListener:function(e,t){var n=this._namedListeners[e];if(n)for(var r=0;r<n.length;r++)if(n[r]===t){n.length===1?delete this._namedListeners[e]:n.splice(r,1);break}}},e.prototype.constructor=e,e.attach=function(t){var n=new e;t.dispatchEvent=n.dispatchEvent.bind(n),t.addEventListener=n.addEventListener.bind(n),t.removeEventListener=n.removeEventListener.bind(n)},e}),define("orion/serviceregistry",["orion/Deferred","orion/EventTarget"],function(e,t){function n(e,t,n){this._properties=n||{},this._properties["service.id"]=e,this._properties.objectClass=t,this._properties["service.names"]=t}function r(e,t,n){this._serviceId=e,this._serviceReference=t,this._internalRegistry=n}function i(t,n){function r(r){return function(){var i;try{if(!n())throw new Error("Service was unregistered");var s=t[r].apply(t,Array.prototype.slice.call(arguments));if(s&&typeof s.then=="function")return s;i=new e,i.resolve(s)}catch(o){i=new e,i.reject(o)}return i.promise}}var i;for(i in t)typeof t[i]=="function"&&(this[i]=r(i))}function s(e,t){this.type=e,this.serviceReference=t}function o(){this._entries=[],this._namedReferences={},this._serviceEventTarget=new t;var e=this;this._internalRegistry={isRegistered:function(t){return e._entries[t]?!0:!1},unregisterService:function(t){var n=e._entries[t];if(!n)throw new Error("already unregistered");var r=n.reference;e._serviceEventTarget.dispatchEvent(new s("unregistering",r)),e._entries[t]=null;var i=r.getProperty("objectClass");i.forEach(function(t){var n=e._namedReferences[t];for(var i=0;i<n.length;i++)if(n[i]===r){n.length===1?delete e._namedReferences[t]:n.splice(i,1);break}})},modifyService:function(t){var n=e._entries[t];if(!n)throw new Error("already unregistered");var r=n.reference;e._serviceEventTarget.dispatchEvent(new s("modified",r))}}}return n.prototype={getPropertyKeys:function(){var e=[],t;for(t in this._properties)this._properties.hasOwnProperty(t)&&e.push(t);return e},getProperty:function(e){return this._properties[e]}},n.prototype.constructor=n,r.prototype={unregister:function(){this._internalRegistry.unregisterService(this._serviceId)},getReference:function(){if(!this._internalRegistry.isRegistered(this._serviceId))throw new Error("already unregistered");return this._serviceReference},setProperties:function(e){var t=this._serviceReference._properties;this._serviceReference._properties=e||{},e["service.id"]=this._serviceId,e.objectClass=t.objectClass,e["service.names"]=t["service.names"],this._internalRegistry.modifyService(this._serviceId)}},r.prototype.constructor=r,o.prototype={getService:function(e){var t;if(typeof e=="string"){var n=this._namedReferences[e];n&&n.some(function(e){return t=this._entries[e.getProperty("service.id")].service,!!t},this)}else{var r=this._entries[e.getProperty("service.id")];r&&(t=r.service)}return t||null},getServiceReferences:function(e){if(e)return this._namedReferences[e]?this._namedReferences[e]:[];var t=[];return this._entries.forEach(function(e){e&&t.push(e.reference)}),t},registerService:function(e,t,o){if(typeof t=="undefined"||t===null)throw new Error("invalid service");typeof e=="string"?e=[e]:Array.isArray(e)||(e=[]);var u=this._entries.length,a=new n(u,e,o),f=this._namedReferences;e.forEach(function(e){f[e]=f[e]||[],f[e].push(a)});var l=new i(t,this._internalRegistry.isRegistered.bind(null,u));this._entries.push({reference:a,service:l});var c=this._internalRegistry;return this._serviceEventTarget.dispatchEvent(new s("registered",a)),new r(u,a,c)},addEventListener:function(e,t){this._serviceEventTarget.addEventListener(e,t)},removeEventListener:function(e,t){this._serviceEventTarget.removeEventListener(e,t)}},o.prototype.constructor=o,{ServiceRegistry:o}}),define("orion/webui/littlelib",["require"],function(e){function t(e,t){return t||(t=document),t.querySelector(e)}function n(e,t){return t||(t=document),t.querySelectorAll(e)}function r(e,t){return Array.prototype.slice.call(n(e,t))}function i(e){var t=e;return typeof e=="string"&&(t=document.getElementById(e)),t}function s(e,t){var n=e.compareDocumentPosition(t);return e===t||Boolean(n&16)}function o(e){var t=e.getBoundingClientRect();return{left:t.left+document.body.scrollLeft,top:t.top+document.body.scrollTop,width:t.width,height:t.height}}function u(e){while(e.hasChildNodes()){var t=e.firstChild;e.removeChild(t)}}function a(e){if(e.tabIndex>=0)return e;if(e.hasChildNodes())for(var t=0;t<e.childNodes.length;t++){var n=a(e.childNodes[t]);if(n)return n}return null}function f(e){if(e.tabIndex>=0)return e;if(e.hasChildNodes())for(var t=e.childNodes.length-1;t>=0;t--){var n=f(e.childNodes[t]);if(n)return n}return null}function c(e,t){if(e.nodeType===3){var n=l.exec(e.nodeValue);if(n&&n.length>1){var r=t[n[1]]||n[1];e.parentNode.replaceChild(document.createTextNode(r),e)}}if(e.hasChildNodes())for(var i=0;i<e.childNodes.length;i++)c(e.childNodes[i],t)}function p(e,t){h.length===0&&document.addEventListener("click",function(e){var t=[];for(var n=0;n<h.length;n++){var r=h[n].excludeNodes,i=h[n].dismiss,o=!1,u=!0;for(var a=0;a<r.length;a++){o=document.compareDocumentPosition(document,r[a])!==1;if(o&&s(r[a],e.target)){u=!1;break}}u&&(i(),o=document.compareDocumentPosition(document,r[a])!==1),o&&t.push(h[n])}h=t},!0),h.push({excludeNodes:e,dismiss:t})}function d(e){window.document.all?e.keyCode=0:(e.preventDefault(),e.stopPropagation())}var l=/\$\{([^\}]+)\}/,h=[],v={BKSPC:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DEL:46};return{$:t,$$:n,$$array:r,node:i,contains:s,bounds:o,empty:u,firstTabbable:a,lastTabbable:f,stop:d,processTextNodes:c,addAutoDismiss:p,KEY:v}}),function(){function n(e,t,n,r,i,s){t[e]&&(n.push(e),(t[e]===!0||t[e]===1)&&r.push(i+e+"/"+s))}function r(e,t,n,r,i){var s=r+t+"/"+i;require._fileExists(e.toUrl(s))&&n.push(s)}function i(e,n,r){for(var i in n)!(i in t)&&(!(i in e)||r)&&(e[i]=n[i])}var e=/(^.*(^|\/)nls(\/|$))([^\/]*)\/?([^\/]*)/,t={};define("i18n",{version:"1.0.0",load:function(t,s,o,u){u=u||{};var a,f=e.exec(t),l=f[1],c=f[4],h=f[5],p=c.split("-"),d=[],v={},m,g,y="";f[5]?(l=f[1],a=l+h):(a=t,h=f[4],c=u.locale||(u.locale=typeof navigator=="undefined"?"root":(navigator.language||navigator.userLanguage||"root").toLowerCase()),p=c.split("-"));if(u.isBuild){d.push(a),r(s,"root",d,l,h);for(m=0;g=p[m];m++)y+=(y?"-":"")+g,r(s,y,d,l,h);s(d,function(){o()})}else s([a],function(e){var t=[];n("root",e,t,d,l,h);for(m=0;g=p[m];m++)y+=(y?"-":"")+g,n(y,e,t,d,l,h);s(d,function(){var n,r;for(n=t.length-1;n>-1&&(g=t[n]);n--){r=e[g];if(r===!0||r===1)r=s(l+g+"/"+h);i(v,r)}o(v)})})}})}(),define("orion/i18n",[],function(){return{load:function(e,t,n,r){r=r||{};var i=/(^.*(?:^|\/)nls(?:\/|$))([^\/]*)\/?([^\/]*)/,s=i.exec(e);if(!s){n(null);return}if(t.defined(e)){n(t(e));return}if(r.isBuild||r.isTest){n({});return}var o=s[1],u=s[3]?s[2]:"",a=s[3]||s[2];t(["orion/bootstrap"],function(f){f.startup().then(function(f){var l=f.serviceRegistry,c=l.getServiceReferences("orion.i18n.message");if(!u){var h={},p;c.forEach(function(e){var n=e.getProperty("name");if((s=i.exec(n))&&o===s[1]&&a===(s[3]||s[2])){u=s[3]?s[2]:"";if(u){var f=r.locale||(typeof navigator!="undefined"?navigator.language||navigator.userLanguage:null);if(!f||f.indexOf(u)!==0)return;h[u]=!0,t.specified(n)||define(n,["orion/i18n!"+n],function(e){return e})}else p=e}}),t.specified(e)?n(h):p?l.getService(p).getMessageBundle().then(function(t){Object.keys(h).forEach(function(e){typeof t[e]=="undefined"&&(t[e]=h[e])}),define(e,[],t),n(t)},function(){define(e,[],h),n(h)}):(define(e,[],h),n(h))}else{var d=c.some(function(t){return e===t.getProperty("name")?(l.getService(t).getMessageBundle().then(function(e){n(e)},function(){n({})}),!0):!1});d||n({})}})})}}}),define("orion/nls/root/messages",{Navigator:"Navigator",Sites:"Sites",Repositories:"Repositories",Shell:"Shell","Get Plugins":"Get Plugins",Global:"Global",Editor:"Editor","Orion Editor":"Orion Editor","View on Site":"View on Site","View this file or folder on a web site hosted by Orion":"View this file or folder on a web site hosted by Orion","Show a list of all the keybindings on this page":"Show a list of all the keybindings on this page","Show Keys":"Show Keys","Hide or show the page banner and footer":"Hide or show the page banner and footer","Toggle banner and footer":"Toggle banner and footer","Choose a file by name and open an editor on it":"Choose a file by name and open an editor on it","Find File Named...":"Find File Named...","System Configuration Details":"System Configuration Details","System Config Tooltip":"Go to the System Configuration Details page","Background Operations":"Background Operations","Background Operations Tooltip":"Go to the Background Operations page","Operation status is unknown":"Operation status is unknown"," is already a favorite.":" is already a favorite.","Add to the favorites list":"Add to the favorites list","Make Favorite":"Make Favorite","Unknown item":"Unknown item","Can't search: no search service is available":"Can't search: no search service is available","could not find banner parent, id was ":"could not find banner parent, id was "," has been added to the favorites list.":" has been added to the favorites list.",Related:"Related",Options:"Options",FAQ:"FAQ","Report a Bug":"Report a Bug","Privacy Policy":"Privacy Policy","Terms of Use":"Terms of Use","Copyright Agent":"Copyright Agent","Orion Logo":"Orion Logo","Type a keyword or wild card to search in root":"Type a keyword or wild card to search in root","Orion is in Beta. Please try it out but BEWARE your data may be lost.":"Orion build @buildLabel@. See the FAQ for terms of service","Add this page to the favorites list":"Add this page to the favorites list","LOG: ":"LOG: ",Switch:"Switch","Switch the type of outliner used":"Switch the type of outliner used",Outliner:"Outliner","no parent":"no parent","no tree model":"no tree model","no renderer":"no renderer","could not find table row ":"could not find table row ","Resource is out of sync with the server. Do you want to save it anyway?":"Resource is out of sync with the server. Do you want to save it anyway?","Orion Home":"Orion Home","Operations - Press spacebar to show current operations":"Operations - Press spacebar to show current operations",Operations:"Operations","Operations running":"Operations running","Some operations finished with warning":"Some operations finished with warning","Some operations finished with error":"Some operations finished with error","no service registry":"no service registry","Are you sure you want to delete '${0}' from the favorites?":"Are you sure you want to delete '${0}' from the favorites?","Are you sure you want to delete these ${0} favorites?":"Are you sure you want to delete these ${0} favorites?","You can create favorites by selecting any file or folder in the navigator and choosing ${0} from the More menu.":"You can create favorites by selecting any file or folder in the navigator and choosing ${0} from the More menu.",Tasks:"Tasks",Close:"Close","Expand all":"Expand all","Collapse all":"Collapse all",Search:"Search","Advanced search":"Advanced search",Submit:"Submit",More:"More","Saved searches":"Saved searches","Recent searches":"Recent searches","Open in new tab":"Open in new tab","Regular expression":"Regular expression","Search options":"Search options","Global search":"Global search","Orion Home":"Orion Home","Close notification":"Close notification","Operations - Press spacebar to show current operations":"Operations - Press spacebar to show current operations","Type a keyword or wild card to search in root":"Type a keyword or wild card to search in root","Toggle side panel":"Toggle side panel","Open or close the side panel":"Open or close the side panel",Projects:"Projects","Toggle Outliner":"Toggle Outliner","Sample HTML5 Site":"Sample HTML5 Site","Generate an HTML5 'Hello World' website, including JavaScript, HTML, and CSS files.":"Generate an HTML5 'Hello World' website, including JavaScript, HTML, and CSS files.","Sample Orion Plugin":"Sample Orion Plugin","Generate a sample plugin for integrating with Orion.":"Generate a sample plugin for integrating with Orion."}),define("orion/nls/messages",["orion/i18n!orion/nls/messages","orion/nls/root/messages"],function(e,t){var n={root:t};return Object.keys(e).forEach(function(t){typeof n[t]=="undefined"&&(n[t]=e[t])}),n}),function(){var e=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],t=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,n=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,r=typeof location!="undefined"&&location.href,i=r&&location.protocol&&location.protocol.replace(/\:/,""),s=r&&location.hostname,o=r&&(location.port||undefined),u=[];define("text",[],function(){var a,f,l;return typeof window!="undefined"&&window.navigator&&window.document?f=function(e,t){var n=a.createXhr();n.open("GET",e,!0),n.onreadystatechange=function(e){n.readyState===4&&t(n.responseText)},n.send(null)}:typeof process!="undefined"&&process.versions&&!!process.versions.node?(l=require.nodeRequire("fs"),f=function(e,t){var n=l.readFileSync(e,"utf8");n.indexOf("\ufeff")===0&&(n=n.substring(1)),t(n)}):typeof Packages!="undefined"&&(f=function(e,t){var n="utf-8",r=new java.io.File(e),i=java.lang.System.getProperty("line.separator"),s=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(r),n)),o,u,a="";try{o=new java.lang.StringBuffer,u=s.readLine(),u&&u.length()&&u.charAt(0)===65279&&(u=u.substring(1)),o.append(u);while((u=s.readLine())!==null)o.append(i),o.append(u);a=String(o.toString())}finally{s.close()}t(a)}),a={version:"1.0.7",strip:function(e){if(e){e=e.replace(t,"");var r=e.match(n);r&&(e=r[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r")},createXhr:function(){var t,n,r;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;for(n=0;n<3;n++){r=e[n];try{t=new ActiveXObject(r)}catch(i){}if(t){e=[r];break}}if(!t)throw new Error("createXhr(): XMLHttpRequest not available");return t},get:f,parseName:function(e){var t=!1,n=e.indexOf("."),r=e.substring(0,n),i=e.substring(n+1,e.length);return n=i.indexOf("!"),n!==-1&&(t=i.substring(n+1,i.length),t=t==="strip",i=i.substring(0,n)),{moduleName:r,ext:i,strip:t}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,t,n,r){var i=a.xdRegExp.exec(e),s,o,u;return i?(s=i[2],o=i[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===t)&&(!o||o===n)&&(!u&&!o||u===r)):!0},finishLoad:function(e,t,n,r,i){n=t?a.strip(n):n,i.isBuild&&(u[e]=n),r(n)},load:function(e,t,n,u){if(u.isBuild&&!u.inlineText){n();return}var f=a.parseName(e),l=f.moduleName+"."+f.ext,c=t.toUrl(l),h=u&&u.text&&u.text.useXhr||a.useXhr;!r||h(c,i,s,o)?a.get(c,function(t){a.finishLoad(e,f.strip,t,n,u)}):t([l],function(e){a.finishLoad(f.moduleName+"."+f.ext,f.strip,e,n,u)})},write:function(e,t,n,r){if(t in u){var i=a.jsEscape(u[t]);n.asModule(e+"!"+t,"define(function () { return '"+i+"';});\n")}},writeFile:function(e,t,n,r,i){var s=a.parseName(t),o=s.moduleName+"."+s.ext,u=n.toUrl(s.moduleName+"."+s.ext)+".js";a.load(o,n,function(t){var n=function(e){return r(u,e)};n.asModule=function(e,t){return r.asModule(e,u,t)},a.write(e,o,n,i)},i)}},a})}(),define("text!orion/banner/slideout.html",[],function(){return'<div id="slideContainer" class="slideParameters slideContainer">\n	<span id="pageCommandParameters" class="layoutLeft parameters"></span>\n	<span id="pageCommandDismiss" class="layoutRight parametersDismiss"></span>\n</div>'}),define("orion/commonHTMLFragments",["require","orion/webui/littlelib","text!orion/banner/slideout.html"],function(e,t,n){function r(e){var r=document.createElement("div");r.innerHTML=n;var i=t.$("#slideContainer",r);return i.id=e+i.id,i=t.$("#pageCommandParameters",r),i.id=e+i.id,i=t.$("#pageCommandDismiss",r),i.id=e+i.id,r.innerHTML}return{slideoutHTMLFragment:r}}),define("orion/uiUtils",["i18n!orion/nls/messages","orion/webui/littlelib"],function(e,t){function n(e){var n="",r=navigator.platform.indexOf("Mac")!==-1;e.mod1&&(r?n+="Cmd+":n+="Ctrl+"),e.mod2&&(n+="Shift+"),e.mod3&&(n+="Alt+"),e.mod4&&r&&(n+="Ctrl+");if(e.alphaKey)return n+e.alphaKey;for(var i in t.KEY)if(typeof (t.KEY[i]==="number")&&t.KEY[i]===e.keyCode)return n+i;var s;switch(e.keyCode){case 59:s=e.mod2?":":";";break;case 61:s=e.mod2?"+":"=";break;case 188:s=e.mod2?"<":",";break;case 190:s=e.mod2?">":".";break;case 191:s=e.mod2?"?":"/";break;case 192:s=e.mod2?"~":"`";break;case 219:s=e.mod2?"{":"[";break;case 220:s=e.mod2?"|":"\\";break;case 221:s=e.mod2?"}":"]";break;case 222:s=e.mod2?'"':"'"}return s?n+s:e.keyCode>=112&&e.keyCode<=123?n+"F"+(e.keyCode-111):n+String.fromCharCode(e.keyCode)}function r(e,n,r,i,s,o,u,a,f){var l=!1,c=function(u){return function(a){if(l)return;var c=t.node(e),h=c.value;if(!c)return;if(u&&a.keyCode===t.KEY.ESCAPE){r&&(n.style.display="inline"),c.parentNode.removeChild(c),l=!0,o&&o();return}if(u&&a.keyCode!==t.KEY.ENTER)return;h.length===0||!f&&h===i?(r&&(n.style.display="inline"),l=!0):(s(h),l=!0),c.parentNode&&c.parentNode.removeChild(c),o&&o()}},h=document.createElement("input");h.id=e,h.value=i||"",n.parentNode.insertBefore(h,n.nextSibling),h.classList.add("userEditBoxPrompt"),r&&(n.style.display="none"),h.addEventListener("keydown",c(!0),!1),h.addEventListener("blur",c(!1),!1),window.setTimeout(function(){h.focus();if(i){var n=t.node(e),r=a?i.indexOf(a):-1;if(r>0)if(n.createTextRange){var s=n.createTextRange();s.collapse(!0),s.moveStart("character",0),s.moveEnd("character",r),s.select()}else n.setSelectionRange?n.setSelectionRange(0,r):n.selectionStart!==undefined&&(n.selectionStart=0,n.selectionEnd=r);else n.select()}},0)}function i(e){var t=window.navigator.platform.indexOf("Mac")!==-1;return t&&e.metaKey||!t&&e.ctrlKey}function s(e,t){t&&i(t)?window.open(e):window.location=e}function o(e,n){var r=document.createElement("span");return r.role="button",r.tabIndex=0,r.appendChild(document.createTextNode(e)),r.className="commandButton commandMargins",r.addEventListener("click",function(e){n(),t.stop(e)},!1),r.addEventListener("keydown",function(e){if(e.keyCode===t.KEY.ENTER||e.keyCode===t.KEY.SPACE)n(),t.stop(e)},!1),r}return{getUserKeyString:n,getUserText:r,openInNewWindow:i,followLink:s,createButton:o}}),define("orion/PageUtil",[],function(){function e(e){e=e||window.location.toString();var t={resource:""},n=e.indexOf("#");if(n!==-1){var r=e.substring(n+1);if(r.length!==0){var i=r.split(",");Object.defineProperty(t,"resourceRaw",{value:i[0]}),t.resource=decodeURIComponent(i[0]);for(var s=1;s<i.length;s++){var o=i[s],u=/([^=]*)(=?)(.*)/.exec(o),a=decodeURIComponent(u[1]||""),f=decodeURIComponent(u[3]||"");a!==""&&a!=="resource"&&(t[a]=f)}}}return t}function n(e,n){var r=e;if(e.indexOf("://")===-1){var i=document.createElement("a");i.href=e,r=i.href}var s=!1;return n?s=n.some(function(e){return(new RegExp("^"+e+":","i")).test(r)}):s=t.test(r),s?e:(console.log("Illegal URL Scheme: '"+e+"'"),"")}var t=new RegExp("^http[s]?","i");return{matchResourceParameters:e,validateURLScheme:n}}),define("orion/webui/dropdown",["require","orion/webui/littlelib"],function(e,t){function n(e){this._init(e)}return n.prototype={_init:function(e){this._dropdownNode=t.node(e.dropdown);if(!this._dropdownNode)throw"no dom node for dropdown found";this._triggerNode=t.$(".dropdownTrigger",this._dropdownNode.parentNode);if(!this._triggerNode)throw"no dom node for dropdown trigger found";this._populate=e.populate;var n=this;this._triggerNode.addEventListener("click",function(e){n.toggle()&&t.stop(e)},!1),this._triggerNode.tagName.toLowerCase()==="span"&&this._triggerNode.addEventListener("keydown",function(e){if(e.keyCode===t.KEY.ENTER||e.keyCode===t.KEY.SPACE)n.toggle(),t.stop(e)},!1),this._dropdownNode.addEventListener("keydown",this._dropdownKeyDown.bind(this),!1)},toggle:function(e){return this._triggerNode.classList.contains("dropdownTriggerOpen")?this.close():this.open()},open:function(){this._populate&&(this.empty(),this._populate(this._dropdownNode));var e=this.getItems();return e.length>0?(this._hookedAutoDismiss||(t.addAutoDismiss([this._triggerNode,this._dropdownNode],this.close.bind(this)),this._hookedAutoDismiss=!0),this._positionDropdown(),this._triggerNode.classList.add("dropdownTriggerOpen"),this._dropdownNode.classList.add("dropdownMenuOpen"),e[0].focus(),!0):!1},_positionDropdown:function(){this._dropdownNode.style.left="";var e=t.bounds(this._dropdownNode),n=t.bounds(this._boundingNode(this._triggerNode));e.left+e.width>n.left+n.width&&(this._dropdownNode.style.right=0)},_boundingNode:function(e){return e.style.right!==""||e.style.position==="absolute"||!e.parentNode||!e.parentNode.style?e:this._boundingNode(e.parentNode)},close:function(e){return this._triggerNode.classList.remove("dropdownTriggerOpen"),this._dropdownNode.classList.remove("dropdownMenuOpen"),e&&this._triggerNode.focus(),!0},getItems:function(){var e=t.$$array("li:not(.dropdownSeparator) > .dropdownMenuItem",this._dropdownNode,!0),n=[],r=this;return e.forEach(function(e){e.parentNode.parentNode===r._dropdownNode&&n.push(e)}),n},empty:function(){var e=t.$$array("li",this._dropdownNode),n=this;e.forEach(function(e){e.parentNode===n._dropdownNode&&e.parentNode.removeChild(e)})},_dropdownKeyDown:function(e){if(e.keyCode===t.KEY.UP||e.keyCode===t.KEY.DOWN||e.keyCode===t.KEY.RIGHT||e.keyCode===t.KEY.ENTER||e.keyCode===t.KEY.LEFT){var n=this.getItems(),r=document.activeElement;if(n.length&&n.length>0&&r){var i=n.indexOf(r);i>=0&&(e.keyCode===t.KEY.UP&&i>0?(i--,n[i].focus()):e.keyCode===t.KEY.DOWN&&i<n.length-1?(i++,n[i].focus()):e.keyCode===t.KEY.ENTER||e.keyCode===t.KEY.RIGHT?r.classList.contains("dropdownTrigger")&&r.dropdown&&r.dropdown.open():e.keyCode===t.KEY.LEFT&&r.parentNode.parentNode.classList.contains("dropdownMenuOpen")&&this.close(!0),t.stop(e))}}else e.keyCode===t.KEY.ESCAPE&&(this.close(!0),t.stop(e))}},n.prototype.constructor=n,{Dropdown:n}}),define("orion/webui/tooltip",["require","orion/webui/littlelib"],function(e,t){function n(e){this._init(e)}return n.prototype={_init:function(e){this._node=t.node(e.node);if(!this._node)throw"no dom node for tooltip found";this._position=e.position||["right","above","below","left"],this._text=e.text,this._hideDelay=e.hideDelay===undefined?200:e.hideDelay,this._tailSize=e.tailSize||10,this._trigger=e.trigger||"mouseover",this._afterShowing=e.afterShowing,this._afterHiding=e.afterHiding;var n=this;if(this._trigger==="click")this._showDelay=0,this._node.addEventListener("click",function(e){e.target===n._node&&(n.show(),t.stop(e))},!1);else if(this._trigger==="mouseover"){this._showDelay=e.showDelay===undefined?1e3:e.showDelay;var r=["mouseout","click"];this._node.addEventListener("mouseover",function(e){t.contains(n._node,e.target)&&(n.show(),t.stop(e))},!1);for(var i=0;i<r.length;i++)this._node.addEventListener(r[i],function(e){t.contains(n._node,e.target)&&n.hide()},!1)}},_makeTipNode:function(){if(!this._tip){this._tip=document.createElement("span"),this._tip.classList.add("tooltipContainer"),this._tipInner=document.createElement("span"),this._tipInner.classList.add("tooltip");if(this._text){var e=document.createTextNode(this._text);this._tipInner.appendChild(e)}this._tip.appendChild(this._tipInner),document.body.appendChild(this._tip);var n=this;t.addAutoDismiss([this._tip,this._node],function(){n.hide()}),this._trigger==="mouseover"&&(this._tipInner.role="tooltip",this._tipInner.id="tooltip"+(new Date).getTime().toString(),this._node.setAttribute("aria-describedby",this._tipInner.id),this._tip.addEventListener("mouseover",function(e){n._timeout&&(window.clearTimeout(n._timeout),n._timeout=null),n._tip.addEventListener("mouseout",function(e){t.contains(n._tip,e.target)&&(n.hide(),t.stop(e))},!1)},!1))}return this._tip},_positionTip:function(e,n){this._makeTipNode(),this._tailBorder&&(this._tip.removeChild(this._tailBorder),this._tailBorder=null,this._tip.removeChild(this._tail),this._tail=null),e==="left"?this._tipInner.classList.add("left"):this._tipInner.classList.remove("left");var r=t.bounds(this._node),i=t.bounds(this._tipInner),s,o;switch(e){case"above":s=r.top-i.height-this._tailSize-1,o=r.left-this._tailSize;break;case"below":s=r.top+r.height+this._tailSize+1,o=r.left-this._tailSize;break;case"left":s=r.top-this._tailSize/2,o=r.left-i.width-this._tailSize-1;break;default:s=r.top-this._tailSize/2,o=r.left+r.width+this._tailSize+1}var u=t.bounds(document.documentElement);if(s+i.height>u.height){if(!n)return!1;s=u.height-i.height-1}if(o+i.width>u.width){if(!n)return!1;o=u.width-i.width-1}if(o<0){if(!n)return!1;o=4}if(s<0){if(!n)return!1;s=4}return this._tailBorder=document.createElement("span"),this._tailBorder.classList.add("tooltipTailBorderFrom"+e),this._tail=document.createElement("span"),this._tail.classList.add("tooltipTailFrom"+e),e==="above"||e==="left"?(this._tip.appendChild(this._tailBorder),this._tip.appendChild(this._tail)):(this._tip.insertBefore(this._tailBorder,this._tipInner),this._tip.insertBefore(this._tail,this._tipInner)),this._tip.style.top=s+"px",this._tip.style.left=o+"px",this._tip.style.width=i.width+"px",this._tip.style.height=i.height+"px",!0},contentContainer:function(){return this._makeTipNode(),this._tipInner},show:function(){if(this._tip&&this._tip.classList.contains("tooltipShowing"))return;var e=this;this._timeout&&(window.clearTimeout(this._timeout),this._timeout=null),this._timeout=window.setTimeout(function(){var t=!1,n=0;while(!t&&n<e._position.length)t=e._positionTip(e._position[n]),n++;t||e._positionTip(e._position[0],!0),e._tip.classList.add("tooltipShowing"),e._afterShowing&&e._afterShowing()},this._showDelay)},hide:function(e){this._timeout&&(window.clearTimeout(this._timeout),this._timeout=null);if(!this._tip||!this._tip.classList.contains("tooltipShowing"))return;e===undefined&&(e=this._hideDelay);var t=this;this._timeout=window.setTimeout(function(){t._tip.classList.remove("tooltipShowing"),t._afterHiding&&t._afterHiding()},e)},destroy:function(){this._timeout&&(window.clearTimeout(this._timeout),this._timeout=null),this._tip&&(document.body.removeChild(this._tip),this._tip=null,this._tipInner=null,this._tail=null,this._tailBorder=null)}},n.prototype.constructor=n,{Tooltip:n}}),define("orion/explorers/navigationUtils",[],function(){function n(e,n,r,i){if(t)return;if(!e)return;e.push({domNode:n}),n.tabIndex=-1,n.style.outline="none"}function r(e,t,r){if(!e)return;var i=e.getGridNavHolder(t,!0);i&&n(i,r)}function i(e,t){if(!e)return;for(var n=0;n<e.length;n++)if(e[n].domNode===t){e.splice(n,1);return}}var e=navigator.userAgent,t=e.indexOf("iPad")!==-1;return{addNavGrid:r,generateNavGrid:n,removeNavGrid:i}}),define("orion/commands",["i18n!orion/nls/messages","require","orion/uiUtils","orion/PageUtil","orion/webui/littlelib","orion/webui/dropdown","orion/webui/tooltip","orion/explorers/navigationUtils"],function(e,t,n,r,i,s,o,u){function f(e,t,n,r,i){this.commandService=e,this.handler=t,this.items=n,this.userData=r,this.command=i,i.parameters&&(this.parameters=i.parameters.makeCopy()),this.id=i.id}function l(e){this._commandList={},this._contributionsByScopeId={},this._activeBindings={},this._urlBindings={},this._init(e),this._parameterCollector=null}function c(e,t,n){t.classList.add("commandImage");var r;return e.imageClass?(r=document.createElement("span"),t.appendChild(r),r.classList.add(e.spriteClass),r.classList.add(e.imageClass)):(r=new Image,r.alt=e.name,r.name=n,r.id=n,r.src=e.image,t.appendChild(r)),r}function h(e){this._init(e)}function p(e,t,n,r,s,o,u){typeof e=="string"?this.keyCode=e.toUpperCase().charCodeAt(0):this.keyCode=e,this.mod1=t!==undefined&&t!==null?t:!1,this.mod2=n!==undefined&&n!==null?n:!1,this.mod3=r!==undefined&&r!==null?r:!1,this.mod4=s!==undefined&&s!==null?s:!1,this.domScope=i.node(o),this.scopeName=u||(o?o.id:null)}function d(e,t){this.token=e,this.parameterName=t}function v(e,t,n,r,i){this.name=e,this.type=t,this.label=n,this.value=r,this.lines=i||1}function m(e,t,n){this._storeParameters(e),this._hasOptionalParameters=t&&t.hasOptionalParameters,this._options=t,this.optionsRequested=!1,this.getParameters=n,this.clientCollect=t&&t.clientCollect}var a=window.navigator.platform.indexOf("Mac")!==-1;return f.prototype={collectsParameters:function(){return this.commandService&&this.commandService.collectsParameters()},makeCopy:function(e){var t=new f(this.commandService,this.handler,this.items,this.userData,this.command);return t.domNode=this.domNode,t.domParent=this.domParent,e?t.parameters=e.makeCopy():this.parameters&&(t.parameters=this.parameters.makeCopy()),t}},f.prototype.constructor=f,l.prototype={_init:function(e){this._registry=e.serviceRegistry,this._serviceRegistration=this._registry.registerService("orion.page.command",this),this._defaultSelectionService=e.selection;var t=this;window.document.addEventListener("keydown",function(e){function n(e){if(a){if(e.metaKey&&!e.altKey)return!e.shiftKey&&!e.ctrlKey&&(e.keyCode===65||e.keyCode===67||e.keyCode===86||e.keyCode===88||e.keyCode===90)?!0:!1}else{if(e.ctrlKey&&!e.altKey)return!!e.shiftKey||e.keyCode!==65&&e.keyCode!==67&&e.keyCode!==86&&e.keyCode!==88&&e.keyCode!==90?!1:!0;if(e.altKey&&!e.ctrlKey)return!1}if(e["char"])return e["char"].length>0;if(e.charCode||e.keyCode){var t=e.charCode||e.keyCode;switch(t){case 8:case 9:case 13:case 46:return!0;default:return t>=32&&t<112||t>123}}return!1}e=e||window.event;if(n(e)){if(e.target.contentEditable==="true")return;var r=e.target.nodeName.toLowerCase();if(r==="input"){var i=e.target.type.toLowerCase();switch(i){case"text":case"password":case"search":case"color":case"date":case"datetime":case"datetime-local":case"email":case"month":case"number":case"range":case"tel":case"time":case"url":case"week":return}}else if(r==="textarea")return}t._processKey(e)},!1)},_processKey:function(e){function t(e){window.document.all?e.keyCode=0:(e.preventDefault(),e.stopPropagation())}for(var n in this._activeBindings)if(this._activeBindings[n]&&this._activeBindings[n].keyBinding&&this._activeBindings[n].command&&this._activeBindings[n].keyBinding.match(e)){var r=this._activeBindings[n],i=r.invocation;if(i){var s=r.command;if(s.hrefCallback){t(e);var o=s.hrefCallback.call(i.handler||window,i);o.then?o.then(function(e){window.open(e)}):window.open(o);return}if(s.callback){t(e);var u=this;window.setTimeout(function(){u._invoke(i)},0);return}}}},processURL:function(e){for(var t in this._urlBindings)if(this._urlBindings[t]&&this._urlBindings[t].urlBinding&&this._urlBindings[t].command){var n=this._urlBindings[t].urlBinding.match(e);if(n){var r=this._urlBindings[t],i=r.command,s=r.invocation;if(s&&s.parameters&&i.callback){s.parameters.setValue(n.parameterName,n.parameterValue);var o=this;window.setTimeout(function(){o._invoke(s)},0);return}}}},findCommand:function(e){return this._commandList[e]},runCommand:function(e,t,n,r){var i=this;if(t){var s=this._commandList[e],o=s&&(s.visibleWhen?s.visibleWhen(t):!0);o&&s.callback&&i._invoke(new f(i,n,t,null,s),r)}else{var u=this._urlBindings[e];u&&u.command&&u.command.callback&&i._invoke(u.invocation,r)}},getSelectionService:function(){return this._defaultSelectionService},setParameterCollector:function(e){this._parameterCollector=e},openParameterCollector:function(e,t,n){this._parameterCollector&&(this._parameterCollector.close(),this._parameterCollector.open(e,t,n))},closeParameterCollector:function(){this._parameterCollector&&this._parameterCollector.close()},collectsParameters:function(){return this._parameterCollector},_invoke:function(e,t){return this._collectAndInvoke(e.makeCopy(t),!1)},_collectAndInvoke:function(e,t){if(e)if(this._parameterCollector&&e.parameters&&e.parameters.hasParameters()&&(t||e.parameters.shouldCollectParameters())){var n=!1;e.parameters.updateParameters(e),n=this._parameterCollector.collectParameters(e);if(!n){var r=new o.Tooltip({node:e.domNode,trigger:"click",position:["below","right","above","left"]}),i=r.contentContainer();i.classList.add("parameterPopup");var s=window.document.activeElement,u=this._parameterCollector.getFillFunction(e,function(){s&&s.focus(),r.destroy()})(i);r.show(),window.setTimeout(function(){u.focus(),u.select()},0),n=!0}n||e.command.callback.call(e.handler||window,e)}else e.command.callback.call(e.handler||window,e);else window.console.log("Client attempted to invoke command without an available (rendered) command invocation")},collectParameters:function(e){this._collectAndInvoke(e,!0)},showKeyBindings:function(e){var t={},r,i,s;for(var o in this._activeBindings)i=this._activeBindings[o],i&&i.keyBinding&&i.command&&(i.keyBinding.scopeName?(t[i.keyBinding.scopeName]||(t[i.keyBinding.scopeName]=[]),t[i.keyBinding.scopeName].push(i)):(r=n.getUserKeyString(i.keyBinding),s=document.createElement("span"),s.role="listitem",s.appendChild(document.createTextNode(r+" = "+i.command.name)),s.appendChild(document.createElement("br")),e.appendChild(s)));for(var u in t)if(t[u].length&&t[u].length>0){var a=document.createElement("h2");e.appendChild(a),a.appendChild(document.createTextNode(u));for(var f=0;f<t[u].length;f++)i=t[u][f],r=n.getUserKeyString(i.keyBinding),s=document.createElement("span"),s.role="listitem",s.appendChild(document.createTextNode(r+" = "+i.command.name)),s.appendChild(document.createElement("br")),e.appendChild(s)}},addCommand:function(e){this._commandList[e.id]=e},addCommandGroup:function(e,t,n,r,i,s){this._contributionsByScopeId[e]||(this._contributionsByScopeId[e]={});var o=this._contributionsByScopeId[e];i&&(o=this._createEntryForPath(o,i)),o[t]?(r&&(o[t].title=r),n&&(o[t].position=n),o[t].emptyGroupMessage=s):(o[t]={title:r,position:n,emptyGroupMessage:s,children:{}},o.sortedContributions=null)},_createEntryForPath:function(e,t){if(t){var n=t.split("/");for(var r=0;r<n.length;r++)n[r].length>1&&(e[n[r]]||(e[n[r]]={position:0,children:{}}),e=e[n[r]].children)}return e},registerSelectionService:function(e,t){this._contributionsByScopeId[e]||(this._contributionsByScopeId[e]={}),this._contributionsByScopeId[e].localSelectionService=t},registerCommandContribution:function(e,t,n,r,i,s,o){this._contributionsByScopeId[e]||(this._contributionsByScopeId[e]={});var u=this._contributionsByScopeId[e];r&&(u=this._createEntryForPath(u,r)),u[t]={position:n};var a;s&&(a=this._commandList[t],a&&(this._activeBindings[t]={command:a,keyBinding:s,bindingOnly:i})),o&&(a=this._commandList[t],a&&(this._urlBindings[t]={command:a,urlBinding:o,bindingOnly:i})),u.sortedContributions=null},_checkForTrailingSeparator:function(e,t,n){var r;if(t==="tool"||t==="button"){r=e.childNodes.length>0?e.childNodes[e.childNodes.length-1]:null;if(r&&r.classList.contains("commandSeparator"))return n?(e.removeChild(r),!1):!0}if(t==="menu"){var s=i.$$array("li > *",e);if(s.length>0&&s[s.length-1].classList.contains("dropdownSeparator"))return r=s[s.length-1],n?(r.parentNode.parentNode.removeChild(r.parentNode),!1):!0}return!1},renderCommands:function(e,t,n,r,s,o,u){if(typeof e!="string")throw"a scope id for rendering must be specified";t=i.node(t);if(!t)throw"no parent";var a=this._contributionsByScopeId[e];if(!n&&a){var f=a.localSelectionService||this._defaultSelectionService,l=this;f&&f.getSelections(function(n){l.renderCommands(e,t,n,r,s,o)});return}a&&(this._render(this._contributionsByScopeId[e],t,n,r,s||"button",o,u),this._checkForTrailingSeparator(t,s,!0))},destroy:function(e){e=i.node(e);if(!e)throw"no parent";while(e.hasChildNodes()){var t=e.firstChild;t.commandTooltip&&t.commandTooltip.destroy(),t.emptyGroupTooltip&&t.emptyGroupTooltip.destroy(),this.destroy(t),e.removeChild(t)}},_render:function(e,t,n,r,i,s,a){var l=e.sortedContributions;if(!l){l=[];var c=!1;for(var h in e)if(!e.hasOwnProperty||e.hasOwnProperty(h)){var p=e[h];p&&typeof p.position=="number"&&(p.id=h,l.push(p),c=!0)}c&&(l.sort(function(e,t){return e.position-t.position}),e.sortedContributions=l)}for(var d=0;d<l.length;d++){var v,m;if(l[d].children&&Object.getOwnPropertyNames(l[d].children).length>0){var g=l[d],y=l[d].children,b=this,w;if(i==="tool"||i==="button")if(g.title){w=this._createDropdownMenu(t,g.title),a&&u.generateNavGrid(a,w.menuButton);var E={contributions:y,group:g,parent:t};window.setTimeout(function(){b._render(E.contributions,w.menu,n,r,"menu",s,a),b._checkForTrailingSeparator(w.menu,"menu",!0),w.menu.childNodes.length===0?E.group.emptyGroupMessage?w.menuButton.emptyGroupTooltip||(w.menuButton.emptyGroupTooltip=new o.Tooltip({node:w.menuButton,text:E.group.emptyGroupMessage,trigger:"click",position:["below","right","above","left"]})):(a&&u.removeNavGrid(a,w.menuButton),w.menu.parentNode&&w.menu.parentNode.removeChild(w.menu),w.destroyButton&&w.destroyButton.parentNode&&w.destroyButton.parentNode.removeChild(w.destroyButton)):w.menuButton.style.visibility="visible"},0)}else{var S;t.childNodes.length>0&&!this._checkForTrailingSeparator(t,i)&&(S=this.generateSeparatorImage(t)),b._render(y,t,n,r,i,s,a);if(t.childNodes.length>0){var x=t.childNodes[t.childNodes.length-1];x!==S&&(S=this.generateSeparatorImage(t))}}else if(g.title){var T=document.createElement("li");t.appendChild(T);var N=this._createDropdownMenu(T,g.title,!0);b._render(y,N.menu,n,r,"menu",s,a),N.menu.childNodes.length===0&&t.removeChild(T)}else t.childNodes.length>0&&this._generateMenuSeparator(t),b._render(y,t,n,r,i,s,a),this._generateMenuSeparator(t)}else{var C=this._commandList[l[d].id],k=C?!0:!1,L=null,A=null;if(C){m=new f(this,r,n,s,C),m.domParent=t;var O=k&&(C.visibleWhen?C.visibleWhen(n):!0);this._activeBindings[C.id]&&this._activeBindings[C.id].keyBinding&&(L=this._activeBindings[C.id],O?L.invocation=m:L.invocation=null,L.bindingOnly&&(k=!1)),this._urlBindings[C.id]&&this._urlBindings[C.id].urlBinding&&(A=this._urlBindings[C.id],O?A.invocation=m:A.invocation=null,A.bindingOnly&&(k=!1)),k=k&&O}if(k)if(C.choiceCallback){var M,_,D;i==="tool"||i==="button"?(M=t,D=!1,t.nodeName.toLowerCase()==="ul"?(M=document.createElement("li"),t.appendChild(M)):_="commandMargins"):(M=t,D=!0);var P=this,H=function(e){this.populateChoicesMenu(e,n,r,s,P)};this._createDropdownMenu(M,C.name,D,H.bind(C))}else i==="tool"?(v="tool"+C.id+d,C._addTool(t,v,m,a)):i==="button"?(v="button"+C.id+d,C._addButton(t,v,m,a)):i==="menu"&&C._addMenuItem(t,m,a)}}},_createDropdownMenu:function(e,t,n,r){e=i.node(e);var o,u,a,f=document.createElement("span");f.classList.add("dropdownTrigger"),n?(f.classList.add("dropdownMenuItem"),a="dropdownSubMenu",u="dropdownArrowRight",f.tabIndex=0,f.role="menuitem"):(f.classList.add("commandButton"),u="dropdownArrowDown",f.tabIndex=0,f.role="button");var l=document.createTextNode(t);f.appendChild(l);var c=document.createElement("span");c.classList.add(u),f.appendChild(c);var h=e;e.nodeName.toLowerCase()==="ul"?(h=document.createElement("li"),e.appendChild(h),o=h):(f.classList.add("commandMargins"),o=f),h.appendChild(f),a&&h.classList.add(a);var p=document.createElement("ul");return h.appendChild(p),p.classList.add("dropdownMenu"),f.dropdown=new s.Dropdown({dropdown:p,populate:r}),p.dropdown=f.dropdown,{menuButton:f,menu:p,dropdown:f.dropdown,destroyButton:o}},_generateCheckedMenuItem:function(e,t,n,r){var i=document.createElement("li");e.appendChild(i);var s=document.createElement("label");s.classList.add("dropdownMenuItem");var o=document.createElement("input");o.type="checkbox",o.role="menuitem",o.checked=n,o.classList.add("checkedMenuItem"),s.appendChild(o);var u=document.createTextNode(t);s.appendChild(u),i.appendChild(s),o.addEventListener("change",r,!1)},_generateMenuSeparator:function(e){if(!this._checkForTrailingSeparator(e,"menu")){var t=document.createElement("li");t.classList.add("dropdownSeparator");var n=document.createElement("span");n.classList.add("dropdownSeparator"),t.appendChild(n),e.appendChild(t)}},generateSeparatorImage:function(e){var t;return e.nodeName.toLowerCase()==="ul"?(t=document.createElement("li"),e.appendChild(t)):(t=document.createElement("span"),e.appendChild(t)),t.classList.add("core-sprite-sep"),t.classList.add("imageSprite"),t.classList.add("commandSeparator"),t}},l.prototype.constructor=l,h.prototype={_init:function(e){this.id=e.id,this.name=e.name,this.tooltip=e.tooltip||e.name,this.callback=e.callback,this.hrefCallback=e.hrefCallback,this.choiceCallback=e.choiceCallback,this.image=e.image||t.toUrl("images/none.png"),this.imageClass=e.imageClass,this.spriteClass=e.spriteClass||"commandSprite",this.visibleWhen=e.visibleWhen,this.parameters=e.parameters},_addTool:function(e,t,n,r){n.handler=n.handler||this;var i,s;if(this.hrefCallback){i=this._makeLink(e,n,"commandLink");if(!i)return}else{i=document.createElement("span"),i.tabIndex=r?-1:0,i.role="button";if(!this.hasImage()){var a=window.document.createTextNode(this.name);i.appendChild(a),i.classList.add("commandMissingImageButton"),i.classList.add("commandButton")}else s=c(this,i,t),this.name&&i.setAttribute("aria-label",this.name);this._hookCallback(i,n)}n.domNode=i,n.domParent=e,this.tooltip&&(i.commandTooltip=new o.Tooltip({node:i,text:this.tooltip,position:["above","below","right","left"]}));if(e.nodeName.toLowerCase()==="ul"){var f=document.createElement("li");e.appendChild(f),e=f}else i.classList.add("commandMargins");e.appendChild(i),u.generateNavGrid(r,n.domNode)},_addButton:function(e,t,n,r){n.handler=n.handler||this;var i;this.hrefCallback?i=this._makeLink(e,n,"commandLink"):!this.name&&this.hasImage()?(i=document.createElement("span"),i.tabIndex=0,i.role="button",c(this,i,t),this.tooltip&&i.setAttribute("aria-label",this.tooltip),this._hookCallback(i,n),this.tooltip&&(i.commandTooltip=new o.Tooltip({node:i,text:this.tooltip,position:["above","below","right","left"]}))):(i=this._makeButton(e,n,"commandButton"),this._hookCallback(i,n)),n.domParent=e;if(e.nodeName.toLowerCase()==="ul"){var s=document.createElement("li");e.appendChild(s),e=s}else i.classList.add("commandMargins");e.appendChild(i),u.generateNavGrid(r,n.domNode)},_addMenuItem:function(e,t,n){t.domParent=e;var r,i=e.dropdown;this.hrefCallback?r=this._makeLink(e,t,"dropdownMenuItem",["right","left","above","below"]):(r=this._makeButton(e,t,"dropdownMenuItem",["right","left","above","below"]),this.callback&&this._hookCallback(r,t,function(){i.close(!0)})),r.role="menuitem",u.generateNavGrid(n,t.domNode);if(e.nodeName.toLowerCase()==="ul"){var s=document.createElement("li");e.appendChild(s),e=s}else r.classList.add("commandMargins");e.appendChild(r)},_makeButton:function(e,t,n,r){var i=document.createElement("span");i.role="button",i.tabIndex=0,i.id=this.name;var s=document.createTextNode(this.name);return i.appendChild(s),n&&i.classList.add(n),this.tooltip&&(i.commandTooltip=new o.Tooltip({node:i,text:this.tooltip,position:r||["above","below","right","left"]})),t.domNode=i,i},_makeLink:function(e,t,n,r){var i=document.createElement("a");i.id=this.name,n&&i.classList.add(n),i.appendChild(document.createTextNode(this.name));if(this.hrefCallback){var s=this.hrefCallback.call(t.handler,t);s.then?s.then(function(e){i.href=e}):s?i.href=s:i.href="#"}return this.tooltip&&(i.commandTooltip=new o.Tooltip({node:i,text:this.tooltip,position:r||["above","below","right","left"]})),t.domNode=i,i},_hookCallback:function(e,t,n,r){e.addEventListener("click",function(e){n&&n(),t.commandService._invoke(t),r&&r(),i.stop(e)},!1),e.addEventListener("keydown",function(e){if(e.keyCode===i.KEY.ENTER||e.keyCode===i.KEY.SPACE)n&&n(),t.commandService._invoke(t),r&&r(),i.stop(e)},!1)},populateChoicesMenu:function(e,t,n,r,s){var o=this.getChoices(t,n,r);for(var u=0;u<o.length;u++){var a=o[u];if(a.name){var f=document.createElement("li");e.appendChild(f);var l=document.createElement("span");l.tabIndex=0,l.role="menuitem",l.classList.add("dropdownMenuItem");var c=document.createTextNode(a.name);l.appendChild(c),f.appendChild(l),l.choice=a,l.addEventListener("click",function(e){e.target.choice&&e.target.choice.callback.call(e.target.choice,t)},!1),l.addEventListener("keydown",function(e){(e.keyCode===i.KEY.ENTER||e.keyCode===i.KEY.SPACE)&&e.target.choice&&e.target.choice.callback.call(e.target.choice,t)},!1)}else s._generateMenuSeparator(e)}},getChoices:function(e,t,n){return this.choiceCallback?this.choiceCallback.call(t,e,n):null},makeChoiceCallback:function(e,t){return function(n){e.callback&&e.callback.call(e,t,n)}},hasImage:function(){return this.imageClass||this.image!==t.toUrl("images/none.png")}},h.prototype.constructor=h,p.prototype={match:function(e){if(this.keyCode===e.keyCode){var t=a?e.metaKey:e.ctrlKey;if(this.mod1!==t)return!1;if(this.mod2!==e.shiftKey)return!1;if(this.mod3!==e.altKey)return!1;if(a&&this.mod4!==e.ctrlKey)return!1;if(!this.domScope)return!0;var n=e.target;while(n){if(n===window.document)return!1;if(n===this.domScope)return!0;n=n.parentNode}}return!1},equals:function(e){return e?this.keyCode!==e.keyCode?!1:this.mod1!==e.mod1?!1:this.mod2!==e.mod2?!1:this.mod3!==e.mod3?!1:this.mod4!==e.mod4?!1:this.domScope!==e.domScope?!1:!0:!1}},p.prototype.constructor=p,d.prototype={match:function(e){var t=r.matchResourceParameters(e);return typeof t[this.token]!="undefined"?(this.parameterValue=t[this.token],this):null}},d.prototype.constructor=d,v.prototype={optionsRequested:function(){return this.optionsRequested}},v.prototype.constructor=v,m.prototype={_storeParameters:function(e){this.parameterTable=null;if(e){this.parameterTable={};for(var t=0;t<e.length;t++)this.parameterTable[e[t].name]=e[t]}},updateParameters:function(e){typeof this.getParameters=="function"&&this._storeParameters(this.getParameters(e))},hasParameters:function(){return this.parameterTable!==null},shouldCollectParameters:function(){return!this.clientCollect&&this.hasParameters()},parameterNamed:function(e){return this.parameterTable[e]},valueFor:function(e){var t=this.parameterTable[e];return t?t.value:null},setValue:function(e,t){var n=this.parameterTable[e];n&&(n.value=t)},forEach:function(e){for(var t in this.parameterTable)this.parameterTable[t].type&&this.parameterTable[t].name&&e(this.parameterTable[t])},makeCopy:function(){var e=[];this.forEach(function(t){var n=new v(t.name,t.type,t.label,t.value,t.lines);e.push(n)});var t=new m(e,this._options,this.getParameters);return t.clientCollect=this.clientCollect,t},hasOptionalParameters:function(){return this._hasOptionalParameters}},m.prototype.constructor=m,{CommandService:l,CommandKeyBinding:p,Command:h,CommandInvocation:f,URLBinding:d,ParametersDescription:m,CommandParameter:v}}),define("orion/parameterCollectors",["i18n!orion/nls/messages","require","orion/webui/littlelib"],function(e,t,n){function r(e,t){this._activeContainer=null,this._getElementsFunction=e,this._toolbarLayoutFunction=t}return r.prototype={close:function(){this._activeElements&&(this._activeElements.parameterArea&&n.empty(this._activeElements.parameterArea),this._activeElements.slideContainer&&this._activeElements.slideContainer.classList.remove("slideContainerActive"),this._activeElements.dismissArea&&n.empty(this._activeElements.dismissArea),this._activeElements.commandNode&&this._activeElements.commandNode.classList.remove("activeCommand"),this._toolbarLayoutFunction(this._activeElements),this._activeElements.onClose&&this._activeElements.onClose(),this._oldFocusNode&&(this._oldFocusNode.focus(),this._oldFocusNode=null)),this._activeElements=null},open:function(t,r,i){typeof t=="string"&&(t=n.node(t));if(this._activeElements&&this._activeElements.slideContainer&&this._activeElements.commandNode===t)return this._activeElements.focusNode&&this._activeElements.focusNode.focus(),!0;this.close(),this._activeElements=null,this._activeElements=this._getElementsFunction(t);if(this._activeElements&&this._activeElements.parameterArea&&this._activeElements.slideContainer){this._activeElements.onClose=i;var s=r(this._activeElements.parameterArea,this._activeElements.dismissArea);if(!s)return!1;this._activeElements.focusNode=s;var o=n.$$array("#closebox",this._activeElements.dismissArea||this._activeElements.parameterArea);if(o.length===0){var u=this._activeElements.dismissArea||this._activeElements.parameterArea;o=document.createElement("span"),o.id="closebox",o.role="button",o.tabIndex=0,o.classList.add("imageSprite"),o.classList.add("core-sprite-close"),o.classList.add("dismiss"),o.title=e.Close,u.appendChild(o);var a=this;o.addEventListener("click",function(e){a.close()},!1),o.addEventListener("keydown",function(e){(e.keyCode===n.KEY.ENTER||e.keyCode===n.KEY.SPACE)&&a.close()},!1)}return this._activeElements.slideContainer.classList.add("slideContainerActive"),this._toolbarLayoutFunction(this._activeElements),s&&(this._oldFocusNode=window.document.activeElement,window.setTimeout(function(){s.focus(),s.select()},0)),this._activeElements.commandNode&&this._activeElements.commandNode.classList.add("activeCommand"),!0}return!1},_collectAndCall:function(e,t){n.$$array("input",t).forEach(function(t){t.type==="checkbox"?e.parameters.setValue(t.parameterName,t.checked):t.type!=="button"&&e.parameters.setValue(t.parameterName,t.value.trim())}),n.$$array("textArea",t).forEach(function(t){e.parameters.setValue(t.parameterName,t.value.trim())}),e.command.callback&&e.command.callback.call(e.handler,e)},collectParameters:function(e){return e.parameters?(e.domNode&&e.domNode.classList.add("commandMarker"),this.open(e.domNode||e.domParent,this.getFillFunction(e))):!1},getFillFunction:function(t,r){var i=this;return function(s,o){var u=null,a=function(){r&&r(),i.close()},f=function(e){e.keyCode===n.KEY.ENTER&&i._collectAndCall(t,s);if(e.keyCode===n.KEY.ESCAPE||e.keyCode===n.KEY.ENTER)a(),n.stop(e)};t.parameters.forEach(function(e){var t=null;e.label&&(t=document.createElement("label"),t.classList.add("parameterInput"),t.setAttribute("for",e.name+"parameterCollector"),t.textContent=e.label,s.appendChild(t));var r=e.type,i=e.name+"parameterCollector",o,l=t||s;r==="text"&&typeof e.lines=="number"&&e.lines>1?(o=document.createElement("textarea"),o.rows=e.lines,o.type="textarea",o.id=i,l.appendChild(o),f=function(e){e.keyCode===n.KEY.ESCAPE&&(a(),n.stop(e))}):e.type==="boolean"?(o=document.createElement("input"),o.type="checkbox",o.id=i,l.appendChild(o),e.value&&(o.checked=!0)):(o=document.createElement("input"),o.type=e.type,o.id=i,l.appendChild(o),e.value&&(o.value=e.value)),o.classList.add("parameterInput"),o.classList.add("parameterInput"+o.type),o.setAttribute("speech","speech"),o.setAttribute("x-webkit-speech","x-webkit-speech"),o.parameterName=e.name,u||(u=o),o.addEventListener("keydown",f,!1)});var l=o;l||(l=document.createElement("span"),l.className="layoutRight parametersDismiss",s.appendChild(l));var c=function(e){e._collectAndCall(t,s),a()},h=function(e,t){var n=document.createElement("span");return n.role="button",n.tabIndex=0,t.appendChild(n),e&&n.appendChild(document.createTextNode(e)),n.classList.add("dismiss"),n};if(t.parameters.hasOptionalParameters()){t.parameters.optionsRequested=!1;var p=h(e.More,l);p.addEventListener("click",function(){t.parameters.optionsRequested=!0,c(i)},!1),p.addEventListener("keydown",function(e){if(e.keyCode===n.KEY.ENTER||e.keyCode===n.KEY.SPACE)t.parameters.optionsRequested=!0,c(i)},!1)}var d=h(e.Submit,l);d.addEventListener("click",function(){c(i)},!1),d.addEventListener("keydown",function(e){(e.keyCode===n.KEY.ENTER||e.keyCode===n.KEY.SPACE)&&c(i)},!1);var v=h(null,l);return v.id="closebox",v.classList.add("imageSprite"),v.classList.add("core-sprite-close"),v.title=e.Close,v.addEventListener("click",function(e){a()},!1),v.addEventListener("keydown",function(e){(e.keyCode===n.KEY.ENTER||e.keyCode===n.KEY.SPACE)&&a()},!1),u}}},r.prototype.constructor=r,{CommandParameterCollector:r}}),define("orion/editor/regex",[],function(){function e(e){return e.replace(/([\\$\^*\/+?\.\(\)|{}\[\]])/g,"\\$&")}function t(e){var t=/^\s*\/(.+)\/([gim]{0,3})\s*$/.exec(e);return t?{pattern:t[1],flags:t[2]}:null}return{escape:e,parse:t}}),define("orion/contentTypes",[],function(){function r(e,t){function n(e,t,n,r){var i=t.filename.indexOf(n)>=0,s=t.extension.indexOf(r)>=0;if(i||s)if(!e||i&&e.extension.indexOf(r)>=0)return t;return e}var r=e&&e.split(".").pop(),i=null;for(var s=0;s<t.length;s++){var o=t[s];n(i,o,e,r)===o&&(i=o)}return i}function i(r){function i(e){function r(e){return e===null||typeof e=="undefined"?[]:e instanceof Array?e:[e]}var i=e.getServiceReferences(t).concat(e.getServiceReferences(n)),s={};for(var o=0;o<i.length;o++){var u=i[o],a=r(u.getProperty("contentTypes"));for(var f=0;f<a.length;f++){var l=a[f];s[l.id]||(s[l.id]={id:l.id,name:l.name,image:l.image,"extends":l["extends"],extension:r(l.extension),filename:r(l.filename)})}}return s}this.serviceRegistry=r,this.map=i(r),r.registerService(e,this)}var e="orion.core.contenttypes",t="orion.core.contenttype",n="orion.file.contenttype";return i.prototype={getContentTypes:function(){var e=this.getContentTypesMap(),t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t},getContentTypesMap:function(){return this.map},getFileContentType:function(e){return r(e.Name,this.getContentTypes())},getFilenameContentType:function(e){return r(e,this.getContentTypes())},getContentType:function(e){return this.map[e]||null},isExtensionOf:function(e,t){e=typeof e=="string"?this.getContentType(e):e,t=typeof t=="string"?this.getContentType(t):t;if(!e||!t)return!1;if(e.id===t.id)return!0;var n=e,r={};while(n&&(n=this.getContentType(n["extends"]))){if(n.id===t.id)return!0;if(r[n.id])throw new Error("Cycle: "+n.id);r[n.id]=!0}return!1},isSomeExtensionOf:function(e,t){for(var n=0;n<t.length;n++)if(this.isExtensionOf(e,t[n]))return!0;return!1}},{ContentTypeService:i,getFilenameContentType:r}}),define("orion/URITemplate",[],function(){function n(e){this._text=e}function r(e,t){if(t==="U")return encodeURIComponent(e).replace(/[!'()*]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()});if(t==="U+R")return encodeURI(e).replace(/%5B/g,"[").replace(/%5D/g,"]");if(t==="U+R-,")return encodeURI(e).replace(/%5B/g,"[").replace(/%5D/g,"]").replace(/,/g,"%2C");throw new Error("Unknown allowed character set: "+t)}function i(e,t,n){var i=[];for(var s=0;s<e.length;s++)typeof e[s]!="undefined"&&i.push(r(e[s],t));return i.join(n)}function s(e,t,n,i){var s=Object.keys(e),o=[];for(var u=0;u<s.length;u++)typeof e[s[u]]!="undefined"&&o.push(r(s[u],t)+n+r(e[s[u]],t));return o.join(i)}function o(e){var n=[],r=e.split(",");for(var i=0;i<r.length;i++){var s=r[i].match(t);if(s===null)throw new Error("Bad VarSpec: "+e);n.push({name:s[1],explode:!!s[2],prefix:s[3]?parseInt(s[3],10):-1})}return n}function u(t){if(t.length===0)throw new Error("Invalid Expression: 0 length expression");this._operator=e[t[0]],this._operator?t=t.substring(1):this._operator=e.NUL,this._varSpecList=o(t)}function a(e){var t=[],r=0,i=e.indexOf("{",r);while(i!==-1){t.push(new n(e.substring(r,i)));var s=e.indexOf("}",i+1);if(s===-1)throw new Error("Invalid template: "+e);t.push(new u(e.substring(i+1,s))),r=s+1,i=e.indexOf("{",r)}return t.push(new n(e.substring(r))),t}function f(e){this._templateComponents=a(e)}var e={NUL:{first:"",sep:",",named:!1,ifemp:"",allow:"U"},"+":{first:"",sep:",",named:!1,ifemp:"",allow:"U+R"},".":{first:".",sep:",",named:!1,ifemp:"",allow:"U"},"/":{first:"/",sep:"/",named:!1,ifemp:"",allow:"U"},";":{first:";",sep:";",named:!0,ifemp:"",allow:"U"},"?":{first:"?",sep:"&",named:!0,ifemp:"=",allow:"U"},"&":{first:"&",sep:"&",named:!0,ifemp:"=",allow:"U"},"#":{first:"#",sep:",",named:!1,ifemp:"",allow:"U+R"},",":{first:"",sep:",",named:!1,ifemp:"",allow:"U+R-,"}},t=/^((?:(?:[a-zA-Z0-9_])|(?:%[0-9A-F][0-9A-F]))(?:(?:[a-zA-Z0-9_.])|(?:%[0-9A-F][0-9A-F]))*)(?:(\*)|:([0-9]+))?$/;return n.prototype={expand:function(e){return encodeURI(this._text)}},u.prototype={expand:function(e){var t=[];for(var n=0;n<this._varSpecList.length;n++){var o=this._varSpecList[n],u=o.name,a=e[u],f=typeof a;if(f!=="undefined"&&a!==null){var l=t.length===0?this._operator.first:this._operator.sep;if(f==="string")this._operator.named&&(l+=r(u,"U+R"),l+=a.length===0?this._operator.ifemp:"="),o.prefix!==-1&&o.prefix<a.length&&(a=a.substring(0,o.prefix)),l+=r(a,this._operator.allow);else if(Array.isArray(a))o.explode?l+=i(a,this._operator.allow,this._operator.sep):(this._operator.named&&(l+=r(u,"U+R"),l+=a.length===0?this._operator.ifemp:"="),l+=i(a,this._operator.allow,","));else{if(f!=="object")throw new Error("bad param type: "+u+" : "+f);o.explode?l+=s(a,this._operator.allow,"=",this._operator.sep):(this._operator.named&&(l+=r(u,"U+R"),l+=Object.keys(a).length===0?this._operator.ifemp:"="),l+=s(a,this._operator.allow,",",","))}t.push(l)}}return t.join("")}},f.prototype={expand:function(e){var t=[];for(var n=0;n<this._templateComponents.length;n++)t.push(this._templateComponents[n].expand(e));return t.join("")}},f}),define("orion/i18nUtil",["require","orion/Deferred"],function(e,t){function r(e){var t=arguments;return e.replace(/\$\{([^\}]+)\}/g,function(e,n){return t[(n<<0)+1]})}function i(e){var t=localStorage.getItem("orion/messageBundle/"+e);if(t){var n=JSON.parse(t);if(n._expires&&n._expires>(new Date).getTime())return delete n._expires,n}return null}function s(e,t){t._expires=(new Date).getTime()+9e5,localStorage.setItem("orion/messageBundle/"+e,JSON.stringify(t)),delete t._expires}function o(r){function a(){e(["i18n!"+r],function(e){e&&s(r,e),o.resolve(e)})}if(n[r])return n[r];var o=new t;n[r]=o;var u=i(r);if(u)return o.resolve(u),o;try{e([r],a)}catch(f){e(["orion/i18n!"+r],a)}return o}var n={};return{getMessageBundle:o,formatMessage:r}}),function(){function r(e){return e?e.slice(1).split("&"):[]}function i(e){return e.length===0?"":"?"+e.join("&")}function s(e){var t=/([^=]*)(?:=?)(.*)/.exec(e),n=t[1]?decodeURIComponent(t[1]):"",r=t[2]?decodeURIComponent(t[2]):"";return[n,r]}function o(e){var t=encodeURIComponent(e[0]);return e[1]&&(t+="="+encodeURIComponent(e[1])),t}function u(e,t){var i="",o=[],u=0;return{next:function(){i!==e.search&&(i=e.search,o=r(i));if(u<o.length){var a=s(o[u++]);switch(t){case"keys":return a[0];case"values":return a[1];case"keys+values":return[a[0],a[1]];default:throw new TypeError}}throw n}}}function a(e){if(typeof e!="string")throw new TypeError}function f(e){var t=e.protocol;return!t||t===":"||t==="http:"&&!e.hostname?!1:!0}function l(e){Object.defineProperty(this,"_anchor",{value:e})}function c(e,t){e=e||"";if(typeof e!="string")throw new TypeError("url");t=t?t.href||t:"";if(typeof t!="string")throw new TypeError("base");Object.defineProperty(this,"_input",{value:e,writable:!0});var n=document.implementation.createHTMLDocument("");if(t){var r=n.createElement("a");r.href=t;if(r.protocol.length<2||!r.host)throw new Error("InvalidStateError");var i=n.createElement("base");i.href=r.href,n.head.appendChild(i)}var s=n.createElement("a");s.href=e,n.body.appendChild(s),Object.defineProperty(this,"_urlAnchor",{value:s});var o=new l(s);Object.defineProperty(this,"query",{get:function(){return f(s)?o:null},enumerable:!0})}try{if(typeof window.URL=="function"&&window.URL.length!==0&&(new window.URL("http://www.w3.org")).protocol==="http:")return}catch(e){}var t=/([^:]*):?(.*)/,n=typeof StopIteration!="undefined"?StopIteration:new Error("Stop Iteration");Object.defineProperties(l.prototype,{get:{value:function(e){a(e);var t,n=r(this._anchor.search);return n.some(function(n){var r=s(n);if(r[0]===e)return t=r[1],!0}),t},enumerable:!0},set:{value:function(e,t){a(e),a(t);var n=r(this._anchor.search),u=n.some(function(r,i){var u=s(r);if(u[0]===e)return u[1]=t,n[i]=o(u),!0});u||n.push(o([e,t])),this._anchor.search=i(n)},enumerable:!0},has:{value:function(e){a(e);var t=r(this._anchor.search);return t.some(function(t){var n=s(t);if(n[0]===e)return!0})},enumerable:!0},"delete":{value:function(e){a(e);var t=r(this._anchor.search),n=t.filter(function(t){var n=s(t);return n[0]!==e});return n.length!==t.length?(this._anchor.search=i(n),!0):!1},enumerable:!0},clear:{value:function(){this._anchor.search=""},enumerable:!0},forEach:{value:function(e,t){if(typeof e!="function")throw new TypeError;var r=u(this._anchor,"keys+values");try{for(;;){var i=r.next();e.call(t,i[1],i[0],this)}}catch(s){if(s!==n)throw s}},enumerable:!0},keys:{value:function(){return u(this._anchor,"keys")},enumerable:!0},values:{value:function(){return u(this._anchor,"values")},enumerable:!0},items:{value:function(){return u(this._anchor,"keys+values")}},size:{get:function(){return r(this._anchor.search).length},enumerable:!0},getAll:{value:function(e){a(e);var t=[],n=r(this._anchor.search);return n.forEach(function(n){var r=s(n);r[0]===e&&t.push(r[1])}),t},enumerable:!0},append:{value:function(e,t){a(e),a(t);var n=r(this._anchor.search);n.push(o([e,t])),this._anchor.search=i(n)},enumerable:!0}}),Object.defineProperties(c.prototype,{href:{get:function(){return f(this._urlAnchor)?this._urlAnchor.href:this._input},set:function(e){a(e),this._input=e,this._urlAnchor.href=e},enumerable:!0},origin:{get:function(){return f(this._urlAnchor)?this._urlAnchor.protocol+"//"+this._urlAnchor.host:""},enumerable:!0},protocol:{get:function(){return f(this._urlAnchor)?this._urlAnchor.protocol:":"},set:function(e){a(e),this._urlAnchor.protocol=e},enumerable:!0},_userinfo:{get:function(){if(!f(this._urlAnchor))return"";var e=new RegExp("^"+this._urlAnchor.protocol+"(\\/\\/)(?:([^@]*)?@)?"+this._urlAnchor.host),t=e.exec(this._urlAnchor.href),n=t[2];return n||""},set:function(e){a(e);var t=new RegExp("^"+this._urlAnchor.protocol+"(\\/\\/)(?:([^@]*)?@)?"+this._urlAnchor.host),n=this._urlAnchor.protocol+"//"+(e?e+"@":"")+this._urlAnchor.host;this._urlAnchor.href=this._urlAnchor.href.replace(t,n)}},username:{get:function(){if(!f(this._urlAnchor))return"";var e=t.exec(this._userinfo),n=decodeURIComponent(e[1]||"");return n},set:function(e){a(e);var n=t.exec(this._userinfo),r=[encodeURIComponent(e||"")];n[2]&&r.push(n[2]),this._userinfo=r.join(":")},enumerable:!0},password:{get:function(){if(!f(this._urlAnchor))return"";var e=t.exec(this._userinfo),n=decodeURIComponent(e[2]||"");return n},set:function(e){a(e);var n=t.exec(this._userinfo),r=[n[1]||""];e&&r.push(encodeURIComponent(e)),this._userinfo=r.join(":")},enumerable:!0},host:{get:function(){return f(this._urlAnchor)?this._urlAnchor.host:""},set:function(e){a(e),this._urlAnchor.host=e},enumerable:!0},hostname:{get:function(){return f(this._urlAnchor)?this._urlAnchor.hostname:""},set:function(e){a(e),this._urlAnchor.hostname=e},enumerable:!0},port:{get:function(){return f(this._urlAnchor)?this._urlAnchor.port:""},set:function(e){a(e),this._urlAnchor.port=e},enumerable:!0},pathname:{get:function(){return f(this._urlAnchor)?this._urlAnchor.pathname:""},set:function(e){a(e),this._urlAnchor.pathname=e},enumerable:!0},search:{get:function(){return f(this._urlAnchor)?this._urlAnchor.search:""},set:function(e){a(e),this._urlAnchor.search=e},enumerable:!0},hash:{get:function(){return f(this._urlAnchor)?this._urlAnchor.hash:""},set:function(e){a(e),this._urlAnchor.hash=e},enumerable:!0}}),window.URL&&window.URL.createObjectURL&&(Object.defineProperty(c,"createObjectURL",{value:window.URL.createObjectURL.bind(window.URL),enumerable:!1}),Object.defineProperty(c,"revokeObjectURL",{value:window.URL.revokeObjectURL.bind(window.URL),enumerable:!1})),window.URL=c}(),define("orion/URL-shim",function(){}),define("orion/extensionCommands",["require","orion/Deferred","orion/commands","orion/editor/regex","orion/contentTypes","orion/URITemplate","orion/i18nUtil","orion/URL-shim"],function(e,t,n,r,i,s,o){var u={},a=(new URL(e.toUrl("."),window.location)).href.slice(0,-1);return u._cloneItemWithoutChildren=function f(e){if(e===null||typeof e!="object")return e;var t=e.constructor();for(var n in e)n!=="children"&&n!=="Children"&&(t[n]=f(e[n]));return t},u._createOpenWithCommands=function(e,t){function n(){var t=e.getServiceReferences("orion.edit.editor"),n=[];for(var r=0;r<t.length;r++){var i=t[r],s=i.getProperty("id");n.push({id:s,name:i.getProperty("name"),nameKey:i.getProperty("nameKey"),nls:i.getProperty("nls"),uriTemplate:i.getProperty("orionTemplate")||i.getProperty("uriTemplate")})}return n}function r(e,t){var n=e.getServiceReferences("orion.navigate.openWith"),r=[];for(var i=0;i<n.length;i++){var s=n[i];if(s.getProperty("editor")===t.id){var o=s.getProperty("contentType");o instanceof Array?r=r.concat(o):o!==null&&typeof o!="undefined"&&r.push(o)}}return r}function i(e){var t=e.getServiceReferences("orion.navigate.openWith.default");for(var n=0;n<t.length;n++)return{editor:t[n].getProperty("editor")};return null}var s=n(),o=i(e),u=[];for(var a=0;a<s.length;a++){var f=s[a],l=o&&o.editor===f.id,c=r(e,f);if(c.length){var h={name:f.name||f.id,nameKey:f.nameKey,id:"eclipse.openWithCommand."+f.id,tooltip:f.name,tooltipKey:f.nameKey,contentType:c,uriTemplate:f.uriTemplate,nls:f.nls,forceSingleItem:!0,isEditor:l?"default":"editor"};u.push({properties:h,service:{}})}}return u},u._makeValidator=function(e,t,n,r){function o(e,t,n,r,i){var s=!1,o;if(e[t]){if(!n)o=e[t],s=!0;else if(typeof n=="string"){if(!typeof (e[t]==="string"))return!1;if(!r.variableName)return(new RegExp(n)).test(e[t]);var u=(new RegExp(n)).exec(e[t]);if(u){var a=u[0];r.variableMatchPosition==="before"?o=e[t].substring(0,u.index):r.variableMatchPosition==="after"?o=e[t].substring(u.index+a.length):r.variableMatchPosition==="only"?o=a:o=e[t],s=!0}}else e[t]===n&&(o=e[t],s=!0);if(s&&r.variableName){i[r.variableName]=o,i.itemCached=e;if(r.replacements)for(var f=0;f<r.replacements.length;f++){var l=!1;if(r.replacements[f].pattern){var c=r.replacements[f].pattern,h=r.replacements[f].replacement||"";i[r.variableName]=i[r.variableName].replace(new RegExp(c),h)}else l=!0;l&&window.console.log("Invalid replacements specified in validation property.  "+r.replacements[f])}}return s}return!1}function u(e,t,n,r){var i=n.match,s,a;return t.indexOf("|")>=0?(s=t.substring(0,t.indexOf("|")),a=t.substring(t.indexOf("|")+1),u(e,s,n,r)?!0:u(e,a,n,r)):t.indexOf(":")>=0?(s=t.substring(0,t.indexOf(":")),a=t.substring(t.indexOf(":")+1),e[s]?u(e[s],a,n,r):!1):o(e,t,i,n,r)}function f(t,n,r){if(r.info.validationProperties)for(var s=0;s<r.info.validationProperties.length;s++){var o=r.info.validationProperties[s];if(!o.source)return window.console.log("Invalid validationProperties in "+e.id+".  No source property specified."),!1;var a=u(t,o.source,o,r);if(!a)return!1}if(r.info.contentType&&n){var f=!1,l=i.getFilenameContentType(t.Name,n);if(l)for(var s=0;s<r.info.contentType.length;s++)if(l.id===r.info.contentType[s]){f=!0;break}return f}return!0}var l={info:e};return l.validationFunction=function(e){typeof r=="function"&&(e=r.call(this,e));if(e){if(Array.isArray(e)){if((this.info.forceSingleItem||this.info.uriTemplate)&&e.length!==1)return!1;if(e.length<1)return!1}else e=[e];for(var t=0;t<e.length;t++)if(!f(e[t],n,this))return!1;return!0}return!1},l.generatesURI=function(){return!!this.info.uriTemplate},l.getURI=function(e){if(this.info.uriTemplate){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);if(this.info.validationProperties)for(var r=0;r<this.info.validationProperties.length;r++){var i=this.info.validationProperties[r];if(i.source&&i.variableName){var o=this.itemCached===e&&this[i.variableName];o||u(e,i.source,i,this),e[i.variableName]?window.console.log("Variable name "+i.variableName+" in the extension "+this.info.id+" conflicts with an existing property in the item metadata."):t[i.variableName]=this[i.variableName]}}t.OrionHome=a;var f=new s(this.info.uriTemplate);return window.decodeURIComponent(f.expand(t))}return null},l},u._createCommandOptions=function(e,n,r,i,s,a){function l(t,o){var f=u._makeValidator(e,r,i,a);t.visibleWhen=f.validationFunction.bind(f);if(s)if(f.generatesURI.bind(f)())t.hrefCallback=function(e){var t=Array.isArray(e.items)?e.items[0]:e.items;return f.getURI.bind(f)(t)};else{var l=e;t.callback=function(e){var i;if(l.forceSingleItem){var s=Array.isArray(e.items)?e.items[0]:e.items;i=u._cloneItemWithoutChildren(s)}else if(Array.isArray(e.items)){i=[];for(var o=0;o<e.items.length;o++)i.push(u._cloneItemWithoutChildren(e.items[o]))}else i=u._cloneItemWithoutChildren(e.items);if(r)var a=r.getService("orion.page.progress");n.run?a?a.progress(n.run(i),"Running command: "+t.name):n.run(i):r&&(a?a.progress(r.getService(n).run(i),"Running command: "+t.name):r.getService(n).run(i))}}o.resolve(t)}var f=new t;if(e.nls)o.getMessageBundle(e.nls).then(function(t){var n={name:e.nameKey?t[e.nameKey]:e.name,image:e.image,id:e.id||e.name,tooltip:e.tooltipKey?t[e.tooltipKey]:e.tooltip,isEditor:e.isEditor};l(n,f)});else{var c={name:e.name,image:e.image,id:e.id||e.name,tooltip:e.tooltip,isEditor:e.isEditor};l(c,f)}return f},u.getOpenWithCommands=function(e){var t=[];for(var n in e._commandList){var r=e._commandList[n];r.isEditor&&t.push(r)}return t},u}),define("orion/editor/util",[],function(){function v(e){var t=arguments;return e.replace(/\$\{([^\}]+)\}/g,function(e,n){return t[(n<<0)+1]})}function g(e,t){return e.createElementNS?e.createElementNS(m,t):e.createElement(t)}var e=navigator.userAgent,t=parseFloat(e.split("MSIE")[1])||undefined,n=parseFloat(e.split("Firefox/")[1]||e.split("Minefield/")[1])||undefined,r=e.indexOf("Opera")!==-1,i=parseFloat(e.split("Chrome/")[1])||undefined,s=e.indexOf("Safari")!==-1&&!i,o=parseFloat(e.split("WebKit/")[1])||undefined,u=e.indexOf("Android")!==-1,a=e.indexOf("iPad")!==-1,f=e.indexOf("iPhone")!==-1,l=a||f,c=navigator.platform.indexOf("Mac")!==-1,h=navigator.platform.indexOf("Win")!==-1,p=navigator.platform.indexOf("Linux")!==-1,d=h?"\r\n":"\n",m="http://www.w3.org/1999/xhtml";return{formatMessage:v,createElement:g,isIE:t,isFirefox:n,isOpera:r,isChrome:i,isSafari:s,isWebkit:o,isAndroid:u,isIPad:a,isIPhone:f,isIOS:l,isMac:c,isWindows:h,isLinux:p,platformDelimiter:d}}),define("orion/editor/keyBinding",["orion/editor/util"],function(e){function t(e,t,n,r,i){typeof e=="string"?this.keyCode=e.toUpperCase().charCodeAt(0):this.keyCode=e,this.mod1=t!==undefined&&t!==null?t:!1,this.mod2=n!==undefined&&n!==null?n:!1,this.mod3=r!==undefined&&r!==null?r:!1,this.mod4=i!==undefined&&i!==null?i:!1}return t.prototype={match:function(t){if(this.keyCode===t.keyCode){var n=e.isMac?t.metaKey:t.ctrlKey;return this.mod1!==n?!1:this.mod2!==t.shiftKey?!1:this.mod3!==t.altKey?!1:e.isMac&&this.mod4!==t.ctrlKey?!1:!0}return!1},equals:function(e){return e?this.keyCode!==e.keyCode?!1:this.mod1!==e.mod1?!1:this.mod2!==e.mod2?!1:this.mod3!==e.mod3?!1:this.mod4!==e.mod4?!1:!0:!1}},{KeyBinding:t}}),define("orion/breadcrumbs",["require","orion/webui/littlelib"],function(e,t){function n(e){this._init(e)}return n.prototype={_init:function(e){var n=t.node(e.container);if(!n)throw"no parent container";this._container=n,n.classList.remove("currentLocation"),this._id=e.id||"eclipse.breadcrumbs",this._resource=e.resource||null,this._rootSegmentName=e.rootSegmentName,this._workspaceRootSegmentName=e.workspaceRootSegmentName,this._makeHref=e.makeHref,this.path="",this.render()},getNavigatorWorkspaceRootSegment:function(){if(this._workspaceRootSegmentName){var n;return this._resource&&this._resource.Parents?(n=document.createElement("a"),this._makeHref?this._makeHref(n,""):n.href=e.toUrl("navigate/table.html")+"#"):n=document.createElement("span"),t.empty(n),n.appendChild(document.createTextNode(this._workspaceRootSegmentName)),n}return null},render:function(){var n=this._container,r=t.node(this._id);r?t.empty(r):(r=document.createElement("span"),r.id=this._id,n.appendChild(r));var i,s;i=this.getNavigatorWorkspaceRootSegment();if(i){i.classList.add("breadcrumb"),r.appendChild(i);if(!this._resource||!this._resource.Parents){i.href="",i.classList.remove("breadcrumb"),i.classList.add("currentLocation");return}s=document.createElement("span"),s.appendChild(document.createTextNode(" / ")),this.path+="/",s.classList.add("breadcrumbSeparator"),r.appendChild(s)}var o=this._rootSegmentName;if(this._resource){if(this._resource.Parents){var u=this._resource.Parents;for(var a=u.length;--a>=0;)i=document.createElement("a"),i.classList.add("breadcrumb"),o?(i.appendChild(document.createTextNode(o)),o=null):i.appendChild(document.createTextNode(u[a].Name)),this.path+=u[a].Name,this._makeHref?this._makeHref(i,u[a].Location):i.href=e.toUrl("navigate/table.html")+"#"+u[a].ChildrenLocation,r.appendChild(i),s=document.createElement("span"),s.appendChild(document.createTextNode(" / ")),this.path+="/",s.classList.add("breadcrumbSeparator"),r.appendChild(s)}i=document.createElement("span"),o?(i.appendChild(document.createTextNode(o)),o=null):i.appendChild(document.createTextNode(this._resource.Name)),i.classList.add("currentLocation"),this.path+=this._resource.Name,r.appendChild(i)}r.childNodes.length===0&&(i=document.createElement("span"),i.appendChild(document.createTextNode(o||document.title)),i.classList.add("breadcrumb"),i.classList.add("currentLocation"),r.appendChild(i))}},n.prototype.constructor=n,{BreadCrumbs:n}}),define("orion/webui/splitter",["require","orion/webui/littlelib"],function(e,t){function n(e){this._init(e)}return n.prototype={_init:function(e){this._tracking=null,this._resizeListeners=[],this._animationDelay=501,this.$node=t.node(e.node);if(!this.$node)throw"no dom node for splitter found";this.$sideNode=t.node(e.sidePanel);if(!this.$sideNode)throw"no dom node for side panel found";this.$mainNode=t.node(e.mainPanel);if(!this.$mainNode)throw"no dom node for main panel found";this._vertical=e.vertical,this._prefix="/orion/splitter/"+(this.$node.id||document.body.id||""),e.toggle&&(this._thumb=document.createElement("div"),this.$node.appendChild(this._thumb),this._thumb.classList.add("splitThumb"),this._thumb.classList.add("splitThumbLayout")),this._initializeFromStoredSettings(),this._closed?(this._closed=!1,this._thumbDown()):this._adjustToSplitPosition(),this.$node.style.visibility="visible",this.$mainNode.style.display="block",this.$sideNode.style.display="block",this.$node.addEventListener("mousedown",this._mouseDown.bind(this),!1),window.addEventListener("mouseup",this._mouseUp.bind(this),!1),window.addEventListener("resize",this._resize.bind(this),!1)},toggleSidePanel:function(){this._thumbDown()},openSidePanel:function(){this._closed||this._thumbDown()},addResizeListener:function(e){this._resizeListeners.push(e)},_initializeFromStoredSettings:function(){this._closed=localStorage.getItem(this._prefix+"/toggleState")==="closed";var e;this._vertical?(e=localStorage.getItem(this._prefix+"/yPosition"),e&&(this._splitTop=parseInt(e,10))):(e=localStorage.getItem(this._prefix+"/xPosition"),e&&(this._splitLeft=parseInt(e,10)))},_adjustToSplitPosition:function(e){var n=t.bounds(this.$node),r=t.bounds(this.$node.parentNode);if(this._vertical){this._splitHeight=n.height;if(e||!this._splitTop)this._splitTop=n.top,localStorage.setItem(this._prefix+"/yPosition",this._splitTop);var i=this._splitTop;this.$node.parentNode.style.position==="relative"&&(i=this._splitTop-r.top),this.$sideNode.style.height=i+"px",this.$sideNode.style.bottom=i-1+"px",this.$sideNode.style.display="block",this.$node.style.top=i+"px",this._resize()}else{this._splitWidth=n.width;if(e||!this._splitLeft)this._splitLeft=n.left,localStorage.setItem(this._prefix+"/xPosition",this._splitLeft);var s=this._splitLeft;this.$node.parentNode.style.position==="relative"&&(s=this._splitLeft-r.left),this.$sideNode.style.width=s+"px",this.$sideNode.style.right=s-1+"px",this.$sideNode.style.display="block",this.$node.style.left=s+"px",this._resize()}},_resize:function(e){e=e||0;var n=t.bounds(this.$node.parentNode),r=t.bounds(this.$node);this._vertical?this.$mainNode.style.height=n.height-(r.top-n.top+r.height)+"px":this.$mainNode.style.width=n.width-(r.left-n.left+r.width)+"px";var i=this;window.setTimeout(function(){i._notifyResizeListeners(i.$mainNode)},e),window.setTimeout(function(){i._notifyResizeListeners(i.$sideNode)},e)},_notifyResizeListeners:function(e){for(var t=0;t<this._resizeListeners.length;t++)this._resizeListeners[t](e)},_thumbDown:function(){this._closed?(this._closed=!1,this._addAnimation(),this._vertical?(this.$sideNode.style.height=this._splitTop+"px",this.$node.style.top=this._splitTop+"px"):(this.$sideNode.style.width=this._splitLeft+"px",this.$node.style.left=this._splitLeft+"px"),this._resize(this._animationDelay),this._removeAnimation()):(this._closed=!0,this._addAnimation(),this._vertical?(this.$sideNode.style.top=0,this.$node.style.top="1px"):(this.$sideNode.style.width=0,this.$node.style.left="1px"),this._resize(this._animationDelay),this._removeAnimation()),localStorage.setItem(this._prefix+"/toggleState",this._closed?"closed":null)},_removeAnimation:function(){var e=this;window.setTimeout(function(){e.$sideNode.classList.remove("sidePanelLayoutAnimation"),e.$mainNode.classList.remove("mainPanelLayoutAnimation"),e.$node.classList.remove("splitLayoutAnimation"),e._thumb.classList.remove("splitLayoutAnimation")},this._animationDelay)},_addAnimation:function(){this.$sideNode.classList.add("sidePanelLayoutAnimation"),this.$mainNode.classList.add("mainPanelLayoutAnimation"),this.$node.classList.add("splitLayoutAnimation"),this._thumb&&this._thumb.classList.add("splitLayoutAnimation")},_mouseDown:function(e){if(e.target===this._thumb)return t.stop(e),this._thumbDown(e);if(this._tracking)return;this.$node.classList.add("splitTracking"),this.$mainNode.classList.add("panelTracking"),this.$sideNode.classList.add("panelTracking"),this._tracking=this._mouseMove.bind(this),window.addEventListener("mousemove",this._tracking),t.stop(e)},_mouseMove:function(e){if(this._tracking){var n;if(this._vertical){this._splitTop=e.clientY;var r=this._splitTop;this.$node.parentNode.style.position==="relative"&&(n=t.bounds(this.$node.parentNode),r=this._splitTop-n.top),this.$node.style.top=r+"px"}else{this._splitLeft=e.clientX;var i=this._splitLeft;this.$node.parentNode.style.position==="relative"&&(n=t.bounds(this.$node.parentNode),i=this._splitLeft-n.left),this.$node.style.left=i+"px"}this._adjustToSplitPosition(!0),t.stop(e)}},_mouseUp:function(e){this._tracking&&(window.removeEventListener("mousemove",this._tracking),this._tracking=null,this.$node.classList.remove("splitTracking"),this.$mainNode.classList.remove("panelTracking"),this.$sideNode.classList.remove("panelTracking"),t.stop(e))}},n.prototype.constructor=n,{Splitter:n}}),define("orion/fileUtils",["i18n!orion/nls/messages"],function(e){function t(e){if(!e)return e;var t=window.location.protocol+"//"+window.location.host;return e.indexOf(t)===0?e.substring(t.length):e}function n(e){var t=this.makeRelative(e);return t.indexOf("/workspace")===0}return{makeRelative:t,isAtRoot:n}}),define("orion/favorites",["require","orion/fileUtils","orion/EventTarget"],function(e,t,n){function r(e){this._favorites=[],n.attach(this),this._init(e),this._initializeFavorites()}return r.prototype={_init:function(e){this._registry=e.serviceRegistry,this._serviceRegistration=this._registry.registerService("orion.core.favorite",this)},_notifyListeners:function(){this.dispatchEvent({type:"favoritesChanged",navigator:this._favorites,registry:this._registry})},makeFavorites:function(e){e=Array.isArray(e)?e:[e];for(var n=0;n<e.length;n++){var r=e[n],i=r.ChildrenLocation?r.ChildrenLocation:r.Location;i=t.makeRelative(i),this.addFavorite(r.Name,i,r.Directory)}this._storeFavorites(),this._notifyListeners()},addFavoriteUrl:function(e){this.addFavorite(e,e,!1,!0)},addFavorite:function(e,t,n){this._favorites.push({name:e,path:t,directory:n,isFavorite:!0}),this._favorites.sort(this._sorter),this._storeFavorites(),this._notifyListeners()},removeFavorite:function(e){for(var t in this._favorites)if(this._favorites[t].path===e){this._favorites.splice(t,1);break}this._favorites.sort(this._sorter),this._storeFavorites(),this._notifyListeners()},renameFavorite:function(e,t){var n=!1;for(var r in this._favorites)if(this._favorites[r].path===e){var i=this._favorites[r];i.name!==t&&(i.name=t,n=!0)}n&&(this._favorites.sort(this._sorter),this._storeFavorites(),this._notifyListeners())},hasFavorite:function(e){for(var t in this._favorites)if(this._favorites[t].path===e)return!0;return!1},_SPECIAL_CHARS:"^$\\+[]().",queryFavorites:function(e){var t;if(!e)return this._favorites;var n="";for(t=0;t<e.length;t++){var r=e.charAt(t);r==="*"?n+=".*":r==="?"?n+=".?":this._SPECIAL_CHARS.indexOf(r)>=0?n+="\\"+r:n+=r}n+=".*";var i=new RegExp(n),s=[];for(t in this._favorites)this._favorites[t].name.search(i)===0&&s.push(this._favorites[t]);return s},_initializeFavorites:function(){var e=this;this._registry.getService("orion.core.preference").getPreferences("/window/favorites").then(function(t){var n,r=t.get("navigate");typeof r=="string"&&(r=JSON.parse(r));if(r)for(n in r)r[n].isFavorite=!0,e._favorites.push(r[n]);e._favorites.sort(e._sorter),e._notifyListeners()})},_storeFavorites:function(){var e=this._favorites;this._registry.getService("orion.core.preference").getPreferences("/window/favorites").then(function(t){t.put("navigate",e)})},_sorter:function(e,t){var n=e.name.toLowerCase(),r=t.name.toLowerCase();return n>r?1:n<r?-1:0},getFavorites:function(){return{navigator:this._favorites}}},r.prototype.constructor=r,{FavoritesService:r}}),define("orion/widgets/themes/ThemeClass",[],function(){function o(e){this.attributes=[],this.element=document.createElement("div"),this.style=this.element.style,this.className=e,this.classString="."+e+"{ "}function u(){return this.classString=this.classString+this.style.cssText+this.closeString,this.classString}var e=null,t=[],n,r,i=" }\n",s;return o.prototype.className=e,o.prototype.classString=s,o.prototype.style=r,o.prototype.closeString=i,o.prototype.toString=u,{ThemeClass:o}}),define("orion/widgets/themes/container/ThemeSheetWriter",["orion/widgets/themes/ThemeClass"],function(e){function c(){}function h(){var t="",n=[],r=new e.ThemeClass("orionPage");r.style.backgroundColor="#fdfdfd",r.style.width="100%",r.style.height="100%",n.push(r);var i=new e.ThemeClass("topRowBanner");i.style.margin="0",i.style.border="0",i.style.backgroundColor=this.navbar,i.style.background="-webkit-gradient(linear, left top, left bottom, color-stop(0%,"+this.navbar+"), color-stop(100%,"+this.navbar+"))",i.style.background="-moz-linear-gradient(top,"+this.navbar+"0%,"+this.navbar+"100%)",i.style.height="28px",n.push(i);var s=new e.ThemeClass("a");s.style.textDecoration="none",s.style.color=this.content,n.push(s);var o=new e.ThemeClass("navlink");o.style.display="inline-block",o.style.padding="2px",o.style.color=this.content,n.push(o);var u=new e.ThemeClass("primaryNav");u.style.color=this.navtext,u.style.fontSize="8pt",u.style.fontWeight="normal",u.style.paddingTop="6px",u.style.verticalAlign="baseline",n.push(u);var a=new e.ThemeClass("primaryNav a");a.style.fontSize="8pt",a.style.color=this.navtext,a.style.marginRight="6px",a.style.marginLeft="6px",a.style.verticalAlign="baseline",a.style.textDecoration="none",n.push(a);var f=new e.ThemeClass("primaryNav a:hover");f.style.color="#bfbfbf",f.style.cursor="hand",f.style.color="white",f.style.fontWeight="normal",n.push(f);for(var l in n)t+=n[l].toString();return t}function p(){var t="",n=[],r=new e.ThemeClass("titleArea");r.style.margin="0",r.style.paddingTop="5px",r.style.border="0",r.style.background=this.location,r.style.background="-webkit-gradient(linear, left top, left bottom, color-stop(0%,"+this.location+"), color-stop(100%,"+this.location+"))",r.style.borderBottom="1px solid "+this.location,r.style.minHeight="20px",n.push(r);var i=new e.ThemeClass("breadcrumb");i.style.fontSize="8pt",i.style.textDecoration="none",i.style.color=this.content,i.style.paddingTop="2px",n.push(i);var s=new e.ThemeClass("a.breadcrumb:hover");s.style.textDecoration="none",s.style.borderBottom="1px dotted",s.style.color="#F58B0F",s.style.cursor="pointer",n.push(s);var o=new e.ThemeClass("breadcrumbSeparator");o.style.fontSize="8pt",o.style.textDecoration="none",o.style.color=this.navbar,o.style.fontWeight="bold",n.push(o);var u=new e.ThemeClass("currentLocation");u.style.fontWeight="bold",u.style.fontSize="8pt",u.style.color=this.navbar,u.style.textDecoration="none",u.style.textWrap="normal",u.style.lineHeight="10pt",n.push(u);var a=new e.ThemeClass("a.currentLocation:hover");a.style.fontWeight="bold",a.style.fontSize="10pt",a.style.color="#666666",a.style.textDecoration="none",a.style.borderBottom="0",n.push(a);var f=new e.ThemeClass("navlinkonpage");f.style.color=this.content,n.push(f);for(var l in n)t+=n[l].toString();return t}function d(){}function v(){var t="",n=[],r=new e.ThemeClass("commandButton");r.style.color="#222",r.style.border="1px solid #dedede",r.style.backgroundColor=this.button,r.style.textAlign="center",r.style.verticalAlign="baseline",r.style.cursor="pointer",r.style.display="inline-block",r.style.padding="6px",r.style.paddingTop="4px",r.style.borderRadius="1px",r.style.lineHeight="12px",r.style.fontSize="8pt",r.style.userSelect="none",n.push(r);var i=new e.ThemeClass("commandButton:over");i.style.backgroundColor="#e6e6e6",i.style.border="1px solid #808080",n.push(i);var s=new e.ThemeClass("commandMenu");s.style.color="#222",s.style.display="inline-block",s.style.verticalAlign="baseline",s.style.margin="0",s.style.fontSize="8pt",s.style.fontWeight="normal",s.style.border="1px solid #dedede",s.style.backgroundColor="#efefef",s.style.cursor="pointer",s.style.borderRadius="1px",n.push(s);var o=new e.ThemeClass("commandMenuItem");o.style.border="0",o.style.padding="0",o.style.margin="0",n.push(o);for(var u in n)t+=n[u].toString();return t}function m(){var t="",n=[],r=new e.ThemeClass("searchbox");r.style.backgroundImage="url(../images/core_sprites.png)",r.style.backgroundRepeat="no-repeat",r.style.backgroundPosition="4px -297px",r.style.width="12px",r.style.height="12px",r.style.backgroundColor=this.search,r.style.border="1px solid "+this.search,r.style.fontSize="11px",r.style.width="15em",r.style.height="16px",r.style.borderRadius="10px",r.style.color="#999",r.style.padding="0",r.style.paddingLeft="20px",r.style.marginLeft="5px",r.style.marginTop="6px !important",r.style.font="7pt Lucida Sans Unicode,Lucida Grande,Verdana,Arial,Helvetica,Myriad,Tahoma,clean,sans-serif !important",n.push(r);var i=new e.ThemeClass("searchbox:focus");i.style.color="white",i.style.outline="none",n.push(i);var s=new e.ThemeClass("checkedRow");s.style.cssText="background-color:"+this.selection+" !important;",n.push(s);var o=new e.ThemeClass("navbar-item-selected");o.style.background=this.selection,o.style.color=this.content,n.push(o);var u=new e.ThemeClass("auxpane");u.style.border="0",u.style.background=this.sidepanel,u.style.background="-webkit-gradient(linear, left top, left bottom, color-stop(0%,"+this.sidepanel+"), color-stop(100%,"+this.sidepanel+"))",u.style.background="-moz-linear-gradient(top, "+this.sidepanel+" 0%, "+this.sidepanel+" 100%)",u.style.overflowX="auto",u.style.minWidth="200px",u.style.paddingTop="16px",n.push(u);var a=new e.ThemeClass("mainpane");a.style.background=this.mainpanel,a.style.border=0,n.push(a);var f=new e.ThemeClass("mainToolbar");f.style.background=this.toolpanel,f.style.height="31px",f.style.borderBottom="1px solid #ebebeb",n.push(f);for(var l in n)t+=n[l].toString();return t}function g(e){console.log(this.writeNavigationStyle()),console.log(this.writeLocationStyle()),console.log(this.writeMainStyle()),console.log(this.writeButtonStyle())}function y(e){e.navbar.value?(this.navbar=e.navbar.value,this.button=e.button.value,this.location=e.location.value,this.selection=e.selection.value,this.sidepanel=e.sidepanel.value,this.mainpanel=e.mainpanel.value,this.navtext=e.navtext.value,this.search=e.search.value,this.content=e.content.value,this.toolpanel=e.toolpanel.value):(this.navbar=e.navbar,this.button=e.button,this.location=e.location,this.selection=e.selection,this.sidepanel=e.sidepanel,this.mainpanel=e.mainpanel,this.navtext=e.navtext,this.search=e.search,this.content=e.content,this.toolpanel=e.toolpanel);var t=this.writeNavigationStyle()+this.writeLocationStyle()+this.writeMainStyle()+this.writeButtonStyle();return t}var t="#333",n="#777777",r="#EFEFEF",i="FEC",s="#FBFBFB",o="white",u="#bfbfbf",a="#3087B3",f="#444",l="white";return c.prototype.navbar=t,c.prototype.button=n,c.prototype.location=r,c.prototype.selection=i,c.prototype.sidepanel=s,c.prototype.mainpanel=o,c.prototype.navtext=u,c.prototype.content=a,c.prototype.search=f,c.prototype.toolpanel=l,c.prototype.writeNavigationStyle=h,c.prototype.writeLocationStyle=p,c.prototype.writeButtonStyle=v,c.prototype.writeMainStyle=m,c.prototype.render=g,c.prototype.getSheet=y,{ThemeSheetWriter:c}}),define("orion/searchUtils",["i18n!orion/nls/messages","require","orion/editor/regex","orion/commands","orion/PageUtil","orion/URITemplate"],function(e,t,n,r,i,s){function u(e,t,r){var i="";r&&(i="^");var s=n.parse("/"+i+e.searchStr+"/");if(s){var o=s.pattern,u=s.flags;u.indexOf("i")===-1&&!t.caseSensitive&&(u+="i"),e.regExp={pattern:o,flags:u},e.wildCard=!0}}var o=o||{};o.searchUtils=o.searchUtils||{},o.searchUtils.ALL_FILE_TYPE="*.*",o.searchUtils.doSearch=function(t,n,r,i){if(t){var s=r,u=!0;s==="*"&&(s=""),s===""&&(u=i&&i.type!==o.searchUtils.ALL_FILE_TYPE);if(u){s!==""&&o.searchUtils.addRecentSearch(n,s,i?i.regEx:!1);var a=t.createSearchParams(s,!1,!1,i),f=o.searchUtils.generateSearchHref(a);o.searchUtils.getOpenSearchPref(n,function(e){e?window.open(f):window.location=f})}}else window.alert(e["Can't search: no search service is available"])},o.searchUtils.generateSearchHelper=function(e,t){var n=e.keyword,r=n,i={};e.fileType&&e.fileType!==o.searchUtils.ALL_FILE_TYPE&&n===""&&(r="*."+e.fileType);if(!e.regEx){var s=n.indexOf("*")>-1,a=n.indexOf("?")>-1;s&&(n=n.split("*").join(".*")),a&&(n=n.split("?").join(".")),!s&&!a&&!e.nameSearch?(i.searchStr=e.caseSensitive?n.split("\\").join(""):n.split("\\").join("").toLowerCase(),i.wildCard=!1):(i.searchStr=e.caseSensitive?n:n.toLowerCase(),u(i,e,t),i.wildCard=!0)}else i.searchStr=n,u(i,e,t);return i.searchStrLength=i.searchStr.length,{params:e,inFileQuery:i,displayedSearchTerm:r}},o.searchUtils.convertSearchParams=function(e){e.rows!==undefined&&(e.rows=parseInt(e.rows)),e.start!==undefined&&(e.start=parseInt(e.start)),typeof e.regEx=="string"&&(e.regEx=e.regEx.toLowerCase()==="true"),typeof e.caseSensitive=="string"&&(e.caseSensitive=e.caseSensitive.toLowerCase()==="true"),typeof e.nameSearch=="string"&&(e.nameSearch=e.nameSearch.toLowerCase()==="true")},o.searchUtils.copySearchParams=function(e,t){var n={};for(var r in e)if(e[r]!==undefined&&e[r]!==null){if(!t&&r==="replace")continue;n[r]=e[r]}return n},o.searchUtils.generateSearchHref=function(e){var n=t.toUrl("search/search.html"),r=o.searchUtils.copySearchParams(e,!0),i=r.resource;r.resource=undefined;var u=(new s(n+"#{,resource,params*}")).expand({resource:i,params:r});return u},o.searchUtils.generateFindURLBinding=function(e,t,n,r){var i={find:t.searchStr,regEx:t.wildCard?!0:undefined,caseSensitive:e.caseSensitive?!0:undefined,replaceWith:typeof r=="string"?r:undefined,atLine:typeof n=="number"?n:undefined},o=(new s("{,params*}")).expand({params:i});return","+o},o.searchUtils.convertFindURLBinding=function(e){typeof e.regEx=="string"&&(e.regEx=e.regEx.toLowerCase()==="true"),typeof e.caseSensitive=="string"&&(e.caseSensitive=e.caseSensitive.toLowerCase()==="true"),typeof e.atLine=="string"&&(e.atLine=parseInt(e.atLine))},o.searchUtils.replaceRegEx=function(e,t,n){var r=new RegExp(t.pattern,t.flags);return e.replace(r,n)},o.searchUtils.replaceStringLiteral=function(e,t,r){var i=n.parse("/"+t+"/gim");return o.searchUtils.replaceRegEx(e,i,r)},o.searchUtils.searchOnelineLiteral=function(e,t,n){var r,i=0,s=!1,o=[];for(;;){r=t.indexOf(e.searchStr,i);if(r<0)break;o.push({startIndex:r,length:e.searchStrLength}),s=!0;if(n)break;i=r+e.searchStrLength}return s?o:null},o.searchUtils.findRegExp=function(e,t,n,r){if(!t)return null;n=n||"",n+=(n.indexOf("g")===-1?"g":"")+(n.indexOf("m")===-1?"m":"");var i=new RegExp(t,n),s=null,o=null;return s=i.exec(e.substring(r)),s&&{startIndex:s.index+r,length:s[0].length}},o.searchUtils.searchOnelineRegEx=function(e,t,n){var r,i=0,s=!1,u=[];for(;;){var a=o.searchUtils.findRegExp(t,e.regExp.pattern,e.regExp.flags,i);if(!a)break;u.push(a),s=!0;if(n)break;i=a.startIndex+a.length}return s?u:null},o.searchUtils.generateNewContents=function(e,t,n,r,i,s){if(r&&t){e||(n.contents=[]);for(var u=0;u<t.length;u++){var a=t[u],f=!1,l=!1,c=!1,h=[],p,d=0;for(var v=0;v<r.children.length;v++){var m=r.children[v].lineNumber-1;if(m===u){d=v;for(var g=0;g<r.children[v].matches.length;g++)r.children[v+g].checked!==!1&&h.push(g);l=h.length>0,c=h.length===r.children[v].matches.length,p=r.children[v].matches,f=!0;break}}if(f){var y;if(!l){y=a;for(var g=0;g<r.children[d].matches.length;g++)r.children[d+g].newMatches=r.children[d+g].matches}else{var b=o.searchUtils.replaceCheckedMatches(a,i,p,h,s);y=b.replacedStr;for(var g=0;g<r.children[d].matches.length;g++)r.children[d+g].newMatches=b.newMatches}e?n.contents[u]=y:n.contents.push(y)}else e||n.contents.push(a)}}},o.searchUtils.generateMatchContext=function(e,t,n){var r=[],i=e*2+1,s,o;t.length<=i?(s=0,o=t.length-1):(s=n-e,s<0?(s=0,o=s+i-1):(o=n+e,o>t.length-1&&(o=t.length-1,s=o-i+1)));for(var u=s;u<=o;u++)r.push({context:t[u],current:u===n});return r},o.searchUtils.splitFile=function(e){var t=0,n=0,r=0,i=0,s=[];for(;;){t!==-1&&t<=r&&(t=e.indexOf("\r",r)),n!==-1&&n<=r&&(n=e.indexOf("\n",r));if(n===-1&&t===-1){s.push(e.substring(i));break}var o=1;t!==-1&&n!==-1?t+1===n?(o=2,r=n+1):r=(t<n?t:n)+1:t!==-1?r=t+1:r=n+1,s.push(e.substring(i,r-o)),i=r}return s},o.searchUtils.searchWithinFile=function(e,t,n,r,i,s){var u=o.searchUtils.splitFile(n);i&&(t.contents=u);if(t){t.children=[];var a=0;for(var f=0;f<u.length;f++){var l=u[f];if(l&&l.length>0){var c=s?l:l.toLowerCase(),h;e.wildCard?h=o.searchUtils.searchOnelineRegEx(e,c):h=o.searchUtils.searchOnelineLiteral(e,c);if(h){var p=f+1;if(!i){var d={parent:t,context:o.searchUtils.generateMatchContext(2,u,f),checked:t.checked,type:"detail",matches:h,lineNumber:p,name:l,location:t.location+"-"+p};t.children.push(d)}else for(var v=0;v<h.length;v++){var m=v+1,d={parent:t,checked:t.checked,type:"detail",matches:h,lineNumber:p,matchNumber:m,name:l,location:t.location+"-"+p+"-"+m};t.children.push(d)}a+=h.length}}}t.totalMatches=a}},o.searchUtils.replaceCheckedMatches=function(e,t,n,r,i){var s=i,o=0,u="",a=[];for(var f=0;f<n.length;f++){o!==n[f].startIndex&&(u+=e.substring(o,n[f].startIndex)),n[f].length&&(s=n[f].length);var l=!1;for(var c=0;c<r.length;c++)if(r[c]===f){l=!0;break}l?(a.push({startIndex:u.length,length:t.length}),u+=t):(a.push({startIndex:u.length,length:s}),u+=e.substring(n[f].startIndex,n[f].startIndex+s)),o=n[f].startIndex+s}return o<e.length&&(u+=e.substring(o)),{replacedStr:u,newMatches:a}},o.searchUtils.fullPathNameByMeta=function(e){var t=e.length,n="";if(t>0)for(var r=t-1;r>-1;r--){var i=n===""?"":"/";n=n+i+e[r].Name}return n},o.searchUtils.path2FolderName=function(e,t,n){var r=n?0:1;return e.substring(0,e.length-t.length-r)};var a=20;return o.searchUtils._storeRecentSearch=function(e,t){e.getService("orion.core.preference").getPreferences("/window/favorites").then(function(e){e.put("recentSearch",t)})},o.searchUtils.addRecentSearch=function(e,t,n){if(typeof t!="string"||!t)return;e.getService("orion.core.preference").getPreferences("/window/favorites").then(function(r){var i,s=r.get("recentSearch");typeof s=="string"&&(s=JSON.parse(s));if(s){var i;for(i in s)if(s[i].name===t)return;if(s.length>=a){var u=s.length;s.splice(a-1,u-a+1)}}else s=[];s.splice(0,0,{name:t,regEx:n}),o.searchUtils._storeRecentSearch(e,s)})},o.searchUtils.getSearches=function(e,t,n){e.getService("orion.core.preference").getPreferences("/window/favorites").then(function(e){var r,i=e.get(t);typeof i=="string"&&(i=JSON.parse(i)),i&&n&&n(i)})},o.searchUtils.getMixedSearches=function(e,t,n,r){e.getService("orion.core.preference").getPreferences("/window/favorites").then(function(e){var i,s=e.get("recentSearch");typeof s=="string"&&(s=JSON.parse(s));if(t){var u=e.get("search");typeof u=="string"&&(u=JSON.parse(u));for(var i in u)if(n){var a=o.searchUtils.parseQueryStr(u[i].query),f=s.some(function(e){return a.searchStrTitle===e.name});f||s.push({name:a.searchStrTitle,label:u[i].name})}else s.push({name:null,label:u[i].name,value:u[i].query})}s&&r&&r(s)})},o.searchUtils.getOpenSearchPref=function(e,t){e.getService("orion.core.preference").getPreferences("/cm/configurations").then(function(e){var n,r=e.get("nav.config"),i;r&&r["links.newtab"]!=="undefined"?i=r["links.newtab"]?!0:!1:i=!1,t(i)})},o.searchUtils.setOpenSearchPref=function(e,t){e.getService("orion.core.preference").getPreferences("/window/favorites").then(function(e){e.put("openSearchPref",{openInNewTab:t})})},o.searchUtils}),define("orion/inputCompletion/inputCompletion",[],function(){function e(e,t,n){this._inputField=e,typeof this._inputField=="string"&&(this._inputField=document.getElementById(this._inputField)),this._binderFunc=t;var r=n?n.group:null;r||(this._inputField.id?r=this._inputField.id:r="default__input__group"),this._completionIdPrefix=r+"__completion__",this._proposeFromStart=n?n.proposeFromStart:!1,this._extendedProvider=n?n.extendedProvider:null,this._proposalIndex=-1,this._dismissed=!0,this._mouseDown=!1,this._dataList=[],this._initUI();var i=this;this._completionUIContainer.addEventListener("mousedown",function(e){i._mouseDown=!0}),this._completionUIContainer.addEventListener("mouseup",function(e){i._mouseDown=!1}),this._inputField.addEventListener("blur",function(e){i._mouseDown?window.setTimeout(function(){i._inputField.focus()},200):i._dismiss()}),this._inputField.addEventListener("keydown",function(e){i.onKeyDown(e)}),this._inputField.addEventListener("input",function(e){i._proposeOn(i._inputField.value)}),this._inputField.addEventListener("focus",function(e){if(!i._dismissed||!i._binderFunc)return;if(i._dismissing){i._dismissing=!1;return}i._binderFunc&&i._binderFunc(function(e){i._bind(e),i._proposeOn(i._inputField.value)})})}return e.prototype.onKeyDown=function(e){if(this._dismissed)return!0;var t=e.charCode||e.keyCode;return t===13?this._proposalList&&this._proposalList.length>0&&this._proposalIndex>=0&&this._proposalIndex<this._proposalList.length?(e.preventDefault(),this._dismiss(this._proposalList[this._proposalIndex].item.value,e.ctrlKey),e.stopPropagation(),!1):!0:(t===40||t===38)&&this._proposalList&&this._proposalList.length>0?(e.preventDefault(),this._walk(t===40),e.stopPropagation(),!1):t===27?(e.preventDefault(),this._dismiss(),!1):!0},e.prototype._bind=function(e){this._dataList=e},e.prototype._getUIContainerID=function(){return this._completionIdPrefix+"UIContainer"},e.prototype._getUIProposalListId=function(){return this._completionIdPrefix+"UIProposalList"},e.prototype._initUI=function(){this._completionUIContainer=document.getElementById(this._getUIContainerID()),this._completionUIContainer||(this._completionUIContainer=document.createElement("div"),this._completionUIContainer.id=this._getUIContainerID(),this._completionUIContainer.style.display="none",this._completionUIContainer.className="inputCompletionContainer",this._completionUIContainer.setAttribute("role","list"),this._completionUIContainer.setAttribute("aria-atomic","true"),this._completionUIContainer.setAttribute("aria-live","assertive"),document.body.appendChild(this._completionUIContainer)),this._completionUIContainer.textContent="",this._completionUL=document.getElementById(this._getUIProposalListId()),this._completionUL||(this._completionUL=document.createElement("ul"),this._completionUL.id=this._getUIProposalListId(),this._completionUL.className="inputCompletionUL"),this._completionUL.textContent="",this._completionUIContainer.appendChild(this._completionUL)},e.prototype._createProposalLink=function(e,t,n,r){var i=document.createElement("a");return i.href=require.toUrl(t),i.appendChild(this._createBoldText(e,n,r)),i},e.prototype._createBoldText=function(e,t,n){if(t<0)return document.createTextNode(e);var r=document.createElement("span"),i=0,s;i!==t&&(s=document.createTextNode(e.substring(i,t)),r.appendChild(s));var o=document.createElement("b");return r.appendChild(o),s=document.createTextNode(e.substring(t,t+n)),o.appendChild(s),t+n<e.length-1&&(s=document.createTextNode(e.substring(t+n)),r.appendChild(s)),r},e.prototype._proposeOnCategory=function(e,t){if(t.length===0)return;var n=this;if(e){var r=document.createElement("li");r.className="inputCompletionLICategory";var i=document.createTextNode(e);r.appendChild(i),this._completionUL.appendChild(r)}for(var s=0;s<t.length;s++){var r=document.createElement("li");r.onmouseover=function(e){n._selectProposal(e.currentTarget)},r.onclick=function(e){n._dismiss(e.currentTarget.completionItem.value)},r.className="inputCompletionLINormal",r.completionItem=t[s].item;if(typeof t[s].item.value=="string"){var o=this._createBoldText(t[s].item.value,t[s].boldIndex,t[s].boldLength);r.appendChild(o)}else t[s].item.value.name&&t[s].item.value.type==="link"&&r.appendChild(this._createProposalLink(t[s].item.value.name,t[s].item.value.value,t[s].boldIndex,t[s].boldLength));this._completionUL.appendChild(r),this._proposalList.push({item:t[s].item,domNode:r})}},e.prototype._domNode2Index=function(e){for(var t=0;t<this._proposalList.length;t++)if(this._proposalList[t].domNode===e)return t;return-1},e.prototype._highlight=function(e,t){var n=e,r=!1;isNaN(n)||(r=!0,this._proposalList&&e>=0&&e<this._proposalList.length?n=this._proposalList[e].domNode:n=null),n&&(n.className=t?"inputCompletionLISelected":"inputCompletionLINormal",t&&r&&(n.offsetTop<this._completionUIContainer.scrollTop?n.scrollIntoView(!0):n.offsetTop+n.offsetHeight>this._completionUIContainer.scrollTop+this._completionUIContainer.clientHeight&&n.scrollIntoView(!1)))},e.prototype._selectProposal=function(e){var t=e;isNaN(t)&&(t=this._domNode2Index(e)),t!==this._proposalIndex&&(this._highlight(this._proposalIndex,!1),this._proposalIndex=t,this._highlight(this._proposalIndex,!0))},e.prototype._dismiss=function(e,t){if(this._mouseDown)return;this._dismissed=!0,this._proposalList=null,this._proposalIndex=-1,typeof e=="string"?(this._inputField.value=e,this._dismissing=!0,this._inputField.focus()):e&&e.name&&e.type==="link"&&(t?window.open(e.value):window.location.href=e.value);var n=this;window.setTimeout(function(){n._completionUIContainer.style.display="none"},200)},e.prototype._show=function(){if(this._proposalList&&this._proposalList.length>0){var e=0,t=0,n=this._inputField;while(n)e+=n.offsetLeft,t+=n.offsetTop,n=n.offsetParent;this._completionUIContainer.style.display="block",this._completionUIContainer.style.top=t+this._inputField.offsetHeight+2+"px",this._completionUIContainer.style.left=e+"px",this._completionUIContainer.style.width=this._inputField.offsetWidth+"px",this._mouseDown=!1,this._dismissed=!1}else this._dismissed=!0,this._proposalList=null,this._proposalIndex=-1,this._completionUIContainer.style.display="none"},e.prototype._walk=function(e){var t=this._proposalIndex+(e?1:-1);t<-1?t=this._proposalList.length-1:t>=this._proposalList.length&&(t=-1),this._selectProposal(t)},e.prototype._proposeOnList=function(e,t,n){var r="",i=[],s=t?t.length:0;for(var o=0;o<e.length;o++)if(e[o].type==="category")this._proposeOnCategory(r,i),r=e[o].label,i=[];else{var u=!0,a=-1;if(t&&n){var f;typeof e[o].value=="string"?f=e[o].value.toLowerCase():e[o].value.name&&(f=e[o].value.name.toLowerCase()),a=f.indexOf(t),a<0?u=!1:this._proposeFromStart&&(u=a===0)}u&&i.push({item:e[o],boldIndex:a,boldLength:s})}this._proposeOnCategory(r,i)},e.prototype._proposeOn=function(e){this._completionUL.textContent="";var t=e?e.toLowerCase():null;this._proposalList=[],this._proposeOnList(this._dataList,t,!0);if(this._extendedProvider&&t){var n=this;this._extendedProvider(e,function(r){if(r)for(var i=0;i<r.length;i++)n._proposeOnList(r[i].proposals,r[i].filterForMe?t:e,r[i].filterForMe);n._show()},[])}else this._show()},e.prototype.constructor=e,{InputCompletion:e}}),define("orion/globalSearch/nls/root/messages",{"Files that contain:":"Files that contain:",Search:"Search","All types":"All types","File type:":"File type:","All ${0} files":"All ${0} files","Type a search term":"Type a search term","Case sensitive":"Case sensitive","Regular expression":"Regular expression"}),define("orion/globalSearch/nls/messages",["orion/i18n!orion/globalSearch/nls/messages","orion/globalSearch/nls/root/messages"],function(e,t){var n={root:t};return Object.keys(e).forEach(function(t){typeof n[t]=="undefined"&&(n[t]=e[t])}),n}),define("orion/globalSearch/advSearchOptContainer",["i18n!orion/globalSearch/nls/messages","require","orion/searchUtils","orion/contentTypes","orion/i18nUtil"],function(e,t,n,r,i){function s(e,t,n,r){this._inputField=e,typeof this._inputField=="string"&&(this._inputField=document.getElementById(this._inputField));var i=r?r.group:null;i||(this._inputField.id?i=this._inputField.id:i="default__dropDown__group"),this._idPrefix=i+"__dropDown__",this.containerId=this._idPrefix+"UIContainer",this._dismissed=!0;var s=this;this._optRenderer=new o(t,n,function(){s.dismiss(),s._inputField.focus()}),this._initUI()}function o(e,t,n){this._searcher=e,this._serviceRegistry=t,this._cancelCallBack=n}return s.prototype._initUI=function(){this._optUIContainer=document.getElementById(this.containerId),this._optUIContainer||(this._optUIContainer=document.createElement("div"),this._optUIContainer.id=this.containerId,this._optUIContainer.style.display="none",this._optUIContainer.className="advSearchOptContainer",document.body.appendChild(this._optUIContainer),this._optRenderer.render(this._optUIContainer))},s.prototype.dismiss=function(e){this._dismissed=!0,this._optUIContainer.style.display="none"},s.prototype.show=function(e){var t=0,n=0,r=this._inputField;while(r)t+=r.offsetLeft,n+=r.offsetTop,r=r.offsetParent;this._optUIContainer.style.display="block",this._optUIContainer.style.top=n+this._inputField.offsetHeight+2+"px",this._optUIContainer.style.left=t+"px",this._optUIContainer.style.width=this._inputField.offsetWidth+"px",this._optRenderer._searchBox.value=e,this._optRenderer._searchBox.focus(),this._mouseDown=!1,this._dismissed=!1},s.prototype.toggle=function(){this._dismissed?this.show(this._inputField.value):this.dismiss()},s.prototype.constructor=s,o.prototype.getOptions=function(){return{searchStr:this._searchBox.value,caseSensitive:this._caseSensitiveCB.checked,regEx:this._regExCB.checked,type:this._fileTypes.options[this._fileTypes.selectedIndex].value}},o.prototype.render=function(e,t){this._parentDiv=e,typeof this._parentDiv=="string"&&(this._parentDiv=document.getElementById(this._parentDiv));var n=this._serviceRegistry.getService("orion.core.contenttypes");if(!n)n=new r.ContentTypeService(this._serviceRegistry),this.contentTypesCache=n.getContentTypes(),this._render(t);else{var i=this;n.getContentTypes().then(function(e){i.contentTypesCache=e,i._render(t)})}},o.prototype._render=function(e){e?this._renderHTML(e):this._renderRaw()},o.prototype._submitSearch=function(){var e=this.getOptions();n.doSearch(this._searcher,this._serviceRegistry,e.searchStr,e)},o.prototype._initControls=function(){this._searchBox=document.getElementById("advSearchInput"),this._fileTypes=document.getElementById("advSearchTypes"),this._caseSensitiveCB=document.getElementById("advSearchCaseSensitive"),this._regExCB=document.getElementById("advSearchRegEx"),this._submitButton=document.getElementById("advSearchSubmit");var t=[{label:e["All types"],value:n.ALL_FILE_TYPE}];for(var r=0;r<this.contentTypesCache.length;r++)if(this.contentTypesCache[r]["extends"]==="text/plain"||this.contentTypesCache[r].id==="text/plain")for(var s=0;s<this.contentTypesCache[r].extension.length;s++)t.push({label:this.contentTypesCache[r].extension[s],value:this.contentTypesCache[r].extension[s]});for(var o=0;o<t.length;o++){var u=document.createElement("option"),a=document.createTextNode(t[o].label);u.appendChild(a),this._fileTypes.appendChild(u),u.value=t[o].value}var f=this;this._searchBox.addEventListener("keydown",function(e){var t=e.charCode||e.keyCode;t===13&&f._submitSearch(),t===27&&f._cancelCallBack&&f._cancelCallBack()}),this._fileTypes.addEventListener("change",function(t){var r=f._fileTypes.options[f._fileTypes.selectedIndex].value;r===n.ALL_FILE_TYPE?f._searchBox.placeholder=e["Type a search term"]:f._searchBox.placeholder=i.formatMessage(e["All ${0} files"],r)}),this._submitButton.onclick=function(e){f._submitSearch()}},o.prototype._initHTMLLabels=function(){document.getElementById("advSearchLabel").appendChild(document.createTextNode(e["Files that contain:"])),document.getElementById("advSearchInput").placeholder=e["Type a search term"],document.getElementById("advSearchTypeLabel").appendChild(document.createTextNode(e["File type:"])),document.getElementById("advSearchCaseSensitiveLabel").appendChild(document.createTextNode(e["Case sensitive"])),document.getElementById("advSearchRegExLabel").appendChild(document.createTextNode(e["Regular expression"])),document.getElementById("advSearchSubmit").value=e.Search},o.prototype._renderHTML=function(e){var n=this,r=new XMLHttpRequest;r.open("GET",t.toUrl(e),!0),r.onreadystatechange=function(){if(this.readyState!==4)return;if(this.status!==200)return;n._parentDiv.innerHTML=this.responseText,n._initHTMLLabels(),n._initControls()},r.send()},o.prototype._htmlTemplate='<ul class="advSearchOptUL"><li class="advSearchOptLILabel"><label>'+e["Files that contain:"]+"</label>"+"</li>"+'<li class="advSearchOptLIControl">'+'<input type="text" id="advSearchInput" placeholder="'+e["Type a search term"]+'"></input>'+"</li>"+'<li class="advSearchOptLIControl">'+"<label>"+e["File type:"]+"</label>"+'<select id="advSearchTypes"></select>'+"</li>"+'<li class="advSearchOptLIControl">'+"<label>"+e["Case sensitive"]+"</label>"+'<input type="checkbox" id="advSearchCaseSensitive"></input>'+"</li>"+'<li class="advSearchOptLIControl">'+"<label>"+e["Regular expression"]+"</label>"+'<input type="checkbox" id="advSearchRegEx"></input>'+"</li>"+'<li class="advSearchOptLIControl">'+'<input type="button" class="advSearchOptButton" id="advSearchSubmit" value="'+e.Search+'"></input>'+"</li>"+"</ul>",o.prototype._renderRaw=function(){this._parentDiv.innerHTML=this._htmlTemplate,this._initControls()},o.prototype.constructor=o,{advSearchOptContainer:s,advSearchOptRenderer:o}}),define("orion/widgets/nls/root/messages",{"no input":"no input","no output":"no output","Choose a Folder":"Choose a Folder",OK:"OK",Profile:"Profile","Sign out":"Sign out","N/A":"N/A","logged in since ":"logged in since ","Sign in":"Sign in","Authentication required!":"Authentication required!","Name:":"Name:","Plug-ins":"Plug-ins"," <No available services or timed out, check URL and try reloading>":" <No available services or timed out, check URL and try reloading>",Properties:"Properties"," (Service Id: ":" (Service Id: ",Services:"Services","SFTP Transfer":"SFTP Transfer","Remote host:":"Remote host:","Port:":"SFTP Port:","Remote path:":"Remote path:","User name:":"User name:","Password:":"Password:","Start Transfer":"Start Transfer","Location:":"Location:","orion.sftpConnections":"orion.sftpConnections","Drag a file here":"Drag a file here","unzip zips":"Unzip *.zip files","or if you prefer":"(or upload a file using the buttons below)",Upload:"Upload","Browse...":"Browse...","Import a file or zip":"Import a file or zip","Missing required argument: searchRenderer":"Missing required argument: searchRenderer","Missing required argument: favService":"Missing required argument: favService","Find File Named":"Find File Named","Type the name of a file to open (? = any character, * = any string):":"Type the name of a file to open (? = any character, * = any string):",Search:"Search","Populating favorites...":"Populating favorites...",Favorite:"Favorite","Searching...":"Searching...",name:"name","orion.widgets.UserMenu":"orion.widgets.UserMenu",test:"test","Sign Out":"Sign Out","Sign Out ":"Sign Out ","</a>":"</a>",">":">","Sign In To ":"Sign In To ","Sign In":"Sign In",Help:"Help","Keyboard Shortcuts":"Keyboard Shortcuts",Settings:"Settings","View profile of ":"View profile of ",Profiles:"Profiles","Information Needed":"Information Needed",Cancel:"Cancel","If the same file exists in both the source and destination:":"If the same file exists in both the source and destination:","Cancel the transfer":"Cancel the transfer","Always overwrite destination":"Always overwrite destination","Overwrite if source is newer":"Overwrite if source is newer",New:"New","Building file skeleton...":"Building file skeleton...",Add:"Add","Upload...":"Upload...","For a list of available commands type '${0}'.":"For a list of available commands type '${0}'."}),define("orion/widgets/nls/messages",["orion/i18n!orion/widgets/nls/messages","orion/widgets/nls/root/messages"],function(e,t){var n={root:t};return Object.keys(e).forEach(function(t){typeof n[t]=="undefined"&&(n[t]=e[t])}),n}),define("orion/PageLinks",["require","orion/Deferred","orion/PageUtil","orion/URITemplate","orion/URL-shim"],function(e,t,n,r){function i(i,s){s=s||"orion.page.link";var o=i.getServiceReferences(s),u=n.matchResourceParameters(window.location.href),a=(new URL(e.toUrl("."),window.location)).href.slice(0,-1),f={OrionHome:a,Location:u.resource},l=[];for(var c=0;c<o.length;c++){var h={},p=o[c].getPropertyKeys();for(var d=0;d<p.length;d++)h[p[d]]=o[c].getProperty(p[d]);if(h.uriTemplate&&h.nls&&(h.name||h.nameKey)){var v=new t;e(["i18n!"+h.nls],function(e){var t=new r(h.uriTemplate),i=window.decodeURIComponent(t.expand(f));i=n.validateURLScheme(i),h.href=i,h.textContent=h.nameKey?e[h.nameKey]:h.name,v.resolve(h)}),l.push(v)}else if(h.uriTemplate&&h.name){var m=new r(h.uriTemplate),g=window.decodeURIComponent(m.expand(f));g=n.validateURLScheme(g),h.href=g,h.textContent=h.name,l.push((new t).resolve(h))}}return t.all(l)}function s(e,t,n){var r=document.createElement("a");return r.href=e,r.target=t,r.classList.add("targetSelector"),r.textContent=n,r}function o(e,t){return i(e,t).then(function(e){return e.map(function(e){return s(e.href,"_self",e.textContent)})})}return{createPageLinks:o,getPageLinksInfo:i}}),define("orion/widgets/UserMenu",["i18n!orion/widgets/nls/messages","require","orion/webui/littlelib","orion/PageLinks"],function(e,t,n,r){function i(e){this._init(e)}return i.prototype={_init:function(e){this._dropdownNode=n.node(e.dropdownNode);if(!this._dropdownNode)throw"no dom node for dropdown found";this._dropdown=e.dropdown,this._serviceRegistry=e.serviceRegistry,this.authenticatedServices={},this.unauthenticatedServices={}},isSingleService:function(){return this.length(this.unauthenticatedServices)+this.length(this.authenticatedServices)===1},hasServices:function(){return this.length(this.unauthenticatedServices)+this.length(this.authenticatedServices)>0},length:function(e){var t=0;for(var n in e)e.hasOwnProperty(n)&&t++;return t},_makeMenuItem:function(e,t){var r=document.createElement("span");r.role="menuitem",r.tabIndex=0;var i=document.createTextNode(e);return r.appendChild(i),r.classList.add("dropdownMenuItem"),r.addEventListener("click",t,!1),r.addEventListener("keydown",function(e){(e.keyCode===n.KEY.ENTER||e.keyCode===n.KEY.SPACE)&&t()},!1),r},_renderAuthenticatedService:function(t,n){var r=this,i=this.authenticatedServices[t].authService;if(i&&i.logout){var s=document.createElement("li"),o=this._makeMenuItem(e["Sign Out"],function(){i.logout().then(function(){r.addUserItem(t,i,r.authenticatedServices[t].label),localStorage.removeItem(t),localStorage.removeItem("lastLogin");for(var e=localStorage.length-1;e>=0;e--){var n=localStorage.key(e);n&&n.indexOf("/orion/preferences/user")===0&&localStorage.removeItem(n)}i.getAuthForm(window.location.href).then(function(e){window.location=e})})});s.appendChild(o),this._dropdownNode.appendChild(s)}},renderServices:function(){function i(e){return n[e]||(n[e]=t.createDocumentFragment()),n[e]}var t=document,n=[];r.getPageLinksInfo(this._serviceRegistry,"orion.page.link.user").then(function(r){this._dropdown.empty(),r.forEach(function(e){var n=typeof e.category=="number"?e.category:1,r=i(n),s=t.createElement("li"),o=t.createElement("a");o.role="menuitem",o.classList.add("dropdownMenuItem"),o.href=e.href,o.textContent=e.textContent,s.appendChild(o),r.appendChild(s)});if(this.keyAssistFunction){var s=document.createElement("li"),o=this._makeMenuItem(e["Keyboard Shortcuts"],this.keyAssistFunction);o.classList.add("key-assist-menuitem"),s.appendChild(o),i(0).appendChild(s)}var u=this;n.sort(function(e,t){return e-t}).forEach(function(e,t){if(t<n.length-1){var r=document.createElement("li");r.classList.add("dropdownSeparator");var i=document.createElement("span");i.classList.add("dropdownSeparator"),r.appendChild(i),e.appendChild(r)}u._dropdownNode.appendChild(e)});if(this.isSingleService())for(var a in this.authenticatedServices)this.authenticatedServices.hasOwnProperty(a)&&this._renderAuthenticatedService(a,0)}.bind(this))},setKeyAssist:function(e){this.keyAssistFunction=e,this.renderServices()},addUserItem:function(e,t,n,r){r?(this.unauthenticatedServices[e]&&delete this.unauthenticatedServices[e],this.authenticatedServices[e]={authService:t,label:n,data:r}):(this.authenticatedServices[e]&&delete this.authenticatedServices[e],this.unauthenticatedServices[e]?this.unauthenticatedServices[e]={authService:t,label:n,pending:this.unauthenticatedServices[e].pending}:this.unauthenticatedServices[e]={authService:t,label:n}),this.renderServices()}},i.prototype.constructor=i,{UserMenu:i}}),define("orion/crawler/nls/root/messages",{"Searching file:":"Searching file:","is not supported in this file system":"is not supported in this file system","${0} files found out of ${1}":"${0} files found out of ${1}","The search term on this location will not use indexed files.":"The search term on this location will not use indexed files.","It will take longer time. Do you want to proceed?":"It will take longer time. Do you want to proceed?"}),define("orion/crawler/nls/messages",["orion/i18n!orion/crawler/nls/messages","orion/crawler/nls/root/messages"],function(e,t){var n={root:t};return Object.keys(e).forEach(function(t){typeof n[t]=="undefined"&&(n[t]=e[t])}),n}),define("orion/crawler/searchCrawler",["i18n!orion/crawler/nls/messages","require","orion/i18nUtil","orion/searchUtils","orion/contentTypes","orion/Deferred"],function(e,t,n,r,i,s){function o(e,t,n,i){this.registry=e,this.fileClient=t,this.fileLocations=[],this.fileSkeleton=[],this._hitCounter=0,this._totalCounter=0,this._searchOnName=i&&i.searchOnName,this._buildSkeletonOnly=i&&i.buildSkeletonOnly,this._fetchChildrenCallBack=i&&i.fetchChildrenCallBack,this._searchParams=n,this.searchHelper=this._searchOnName||this._buildSkeletonOnly?null:r.generateSearchHelper(n),this._location=i&&i.location,this._childrenLocation=i&&i.childrenLocation?i.childrenLocation:this._location}return o.prototype.search=function(t){var n=this.registry.getService("orion.core.contenttypes");this._onSearchComplete=t;var r=this,i=this.registry.getService("orion.page.dialog");i.confirm(e["The search term on this location will not use indexed files."]+"\n"+e["It will take longer time. Do you want to proceed?"],function(e){if(!e)return;n.getContentTypes().then(function(e){r.contentTypesCache=e;var t=r._visitRecursively(r._childrenLocation).then(function(){r._sort(r.fileLocations);var e={numFound:r.fileLocations.length,docs:r.fileLocations};r._onSearchComplete({response:e})})})})},o.prototype.searchName=function(e,t){e&&(this.searchHelper=r.generateSearchHelper(e,!0)),t&&(this.onSearchNameComplete=t);var n=[];this._sort(this.fileSkeleton);if(this.fileSkeleton.length>0){for(var i=0;i<this.fileSkeleton.length;i++){var s=this.fileSkeleton[i].Name.toLowerCase(),o;this.searchHelper.inFileQuery.wildCard?o=r.searchOnelineRegEx(this.searchHelper.inFileQuery,s,!0):o=r.searchOnelineLiteral(this.searchHelper.inFileQuery,s,!0);if(o){n.push(this.fileSkeleton[i]);if(n.length>=this.searchHelper.params.rows)break}}var u={numFound:n.length,docs:n};this.onSearchNameComplete({response:u})}},o.prototype.buildSkeleton=function(e,t){this._buildingSkeleton=!0;var n=this.registry.getService("orion.core.contenttypes"),r=this;e(),n.getContentTypes().then(function(e){r.contentTypesCache=e;var n=r._visitRecursively(r._childrenLocation).then(function(){r._buildingSkeleton=!1,t(),r.searchHelper&&!r._buildSkeletonOnly&&r.searchName()})})},o.prototype._searchCompleted=function(){console.log("Search Completed.")},o.prototype._searchFiles=function(){var e=[],t=this;if(t.fileLocations.length>0){var t=this;for(var n=0;n<t.fileLocations.length;n++)e.push(t._sniffSearch(t.fileLocations[n]))}return s.all(e)},o.prototype._sort=function(e){e.sort(function(e,t){var n=e.Name&&e.Name.toLowerCase(),r=t.Name&&t.Name.toLowerCase();return n<r?-1:n>r?1:0})},o.prototype._onFileType=function(e){return this.searchHelper.params.fileType?this.searchHelper.params.fileType===r.ALL_FILE_TYPE?!0:e.extension.indexOf(this.searchHelper.params.fileType)>=0:!0},o.prototype._visitRecursively=function(e){var t=[],n=this;this._fetchChildrenCallBack&&this._fetchChildrenCallBack(e);var r=n.registry.getService("orion.page.progress");return(r?r.progress(n.fileClient.fetchChildren(e),"Crawling search for children of "+e):n.fileClient.fetchChildren(e)).then(function(e){var r=e.length;for(var o=0;o<e.length;o++)if(e[o].Directory!==undefined&&e[o].Directory===!1)if(n._searchOnName)t.push(n._buildSingleSkeleton(e[o]));else if(n._buildSkeletonOnly)t.push(n._buildSingleSkeleton(e[o]));else{var u=i.getFilenameContentType(e[o].Name,n.contentTypesCache);u&&(u["extends"]==="text/plain"||u.id==="text/plain")&&n._onFileType(u)&&t.push(n._sniffSearch(e[o]))}else e[o].Location&&t.push(n._visitRecursively(e[o].ChildrenLocation));return s.all(t)})},o.prototype._hitOnceWithinFile=function(e){var t=this._searchParams.caseSensitive?e:e.toLowerCase(),n;return this.searchHelper.inFileQuery.wildCard?n=r.searchOnelineRegEx(this.searchHelper.inFileQuery,t,!0):n=r.searchOnelineLiteral(this.searchHelper.inFileQuery,t,!0),n},o.prototype._reportSingleHit=function(e){e.LastModified=e.LocalTimeStamp,this.fileLocations.push(e),this._hitCounter++,this._sort(this.fileLocations);var t={numFound:this.fileLocations.length,docs:this.fileLocations};this._onSearchComplete({response:t},!0)},o.prototype._sniffSearch=function(t){this._totalCounter++;var r=this;if(this.searchHelper.params.keyword!=="")return this.registry.getService("orion.page.progress").progress(r.fileClient.read(t.Location),"Reading file "+t.Location).then(function(i){r._hitOnceWithinFile(i)&&r._reportSingleHit(t),r.registry.getService("orion.page.message").setProgressResult({Message:n.formatMessage(e["${0} files found out of ${1}"],r._hitCounter,r._totalCounter)})},function(e){console.error("Error loading file content: "+e.message)});this._reportSingleHit(t),this.registry.getService("orion.page.message").setProgressResult({Message:n.formatMessage(e["${0} files found out of ${1}"],this._hitCounter,this._totalCounter)})},o.prototype._buildSingleSkeleton=function(e){this._totalCounter++,this.fileSkeleton.push(e),this.searchHelper&&!this._buildSkeletonOnly&&this._totalCounter%100===0&&this.searchName();var t=new s;return t.resolve(this._totalCounter),t},o.prototype.constructor=o,{SearchCrawler:o}}),define("orion/webui/dialog",["i18n!orion/widgets/nls/messages","require","orion/webui/littlelib","orion/uiUtils"],function(e,t,n,r){function i(){}return i.prototype={DISABLED:"disabled",CONTAINERTEMPLATE:'<div class="dialog" role="dialog"><div class="dialogTitle"><span id="title" class="dialogTitleText layoutLeft"></span><span tabindex="0" role="button" aria-label="Close" class="dialogDismiss layoutRight core-sprite-close imageSprite" id="closeDialog"></span></div><div id="dialogContent" class="dialogContent layoutBlock"></div><div id="buttons" class="dialogButtons"></div></div>',_initialize:function(){var e=document.body;this.$frameParent=e,this.$$modalExclusions=this.$$modalExclusions||[];var t=document.createRange();t.selectNode(e);var r=t.createContextualFragment(this.CONTAINERTEMPLATE);e.appendChild(r),this.$frame=e.lastChild,this.title&&n.$("#title",this.$frame).appendChild(document.createTextNode(this.title)),this.$close=n.$("#closeDialog",this.$frame);var i=this;this.$close.addEventListener("click",function(e){i.hide()},!1),this.$parent=n.$(".dialogContent",this.$frame),t=document.createRange(),t.selectNode(this.$parent);var s=t.createContextualFragment(this.TEMPLATE);this.messages&&n.processTextNodes(s,this.messages),this.$parent.appendChild(s),this.$buttonContainer=n.$(".dialogButtons",this.$frame),this._makeButtons(),this.$close.addEventListener("keydown",function(e){(e.keyCode===n.KEY.ENTER||e.keyCode===n.KEY.SPACE)&&i.hide()},!1),this.$frame.addEventListener("keydown",function(e){e.keyCode===n.KEY.ESCAPE?i.hide():e.keyCode===n.KEY.ENTER&&typeof i._defaultCallback=="function"&&i._defaultCallback()},!1),this._bindElements(this.$parent),typeof this._bindToDom=="function"&&this._bindToDom(this.$parent),this.modal&&this._makeModal()},_makeButtons:function(){if(this.$buttonContainer&&Array.isArray(this.buttons)){var e=this;this.buttons.forEach(function(t){var n=r.createButton(t.text,t.callback);t.id&&(n.id=t.id,e["$"+n.id]=n),t.isDefault&&(e._defaultCallback=t.callback,e._defaultButton=n),e.$buttonContainer.appendChild(n)})}},_makeModal:function(e){var t=this;this.$frame.addEventListener("blur",function(e){t.$lastFocusedElement=e.target},!0),this._modalListener=function(e){var r=!n.contains(t.$frame,e.target);if(r)for(var i=0;i<t.$$modalExclusions.length;i++)if(n.contains(t.$$modalExclusions[i],e.target)){r=!1;break}r&&(window.setTimeout(function(){(t.$lastFocusedElement||t.$parent).focus()},0),n.stop(e))},this.$frameParent.addEventListener("focus",this._modalListener,!0),this.$frameParent.addEventListener("click",this._modalListener,!0);var r=this.$frameParent.childNodes,i=!1;this._addedBackdrop=[];for(var s=0;s<r.length;s++){for(var o=0;o<this.$$modalExclusions.length;o++)if(n.contains(this.$$modalExclusions[o],r[s])){i=!0;break}if(!i&&r[s]!==t.$frame&&r[s].classList&&!r[s].classList.contains("tooltipContainer")){var u=r[s];u.classList.contains("modalBackdrop")||(u.classList.add("modalBackdrop"),this._addedBackdrop.push(u))}}var a=n.lastTabbable(this.$buttonContainer)||n.lastTabbable(this.$parent);a&&a.addEventListener("keydown",function(e){if(e.keyCode===n.KEY.TAB){var r=t._getFirstFocusField();r&&r!==e.target&&r.focus(),n.stop(e)}},!1)},_addChildDialog:function(e){this.$$modalExclusions.push(e.$frame||e.$parent)},_bindElements:function(e){for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];n.id&&(this["$"+n.id]=n),this._bindElements(n)}},hide:function(){typeof this._beforeHiding=="function"&&this._beforeHiding(),this._modalListener&&(this.$frameParent.removeEventListener("focus",this._modalListener,!0),this.$frameParent.removeEventListener("click",this._modalListener,!0)),this.$frame.classList.remove("dialogShowing"),typeof this._afterHiding=="function"&&this._afterHiding();var e=this;this.keepAlive||window.setTimeout(function(){e.destroy()},0)},show:function(e){typeof this._beforeShowing=="function"&&this._beforeShowing();var t=n.bounds(this.$frame),r=n.bounds(document.documentElement),i,s;if(e){var o=n.bounds(e);s=o.top+o.height+4,i=o.left+4,s+t.height>r.height&&(s=Math.max(0,r.height-t.height-4)),i+t.width>r.width&&(i=Math.max(0,r.width-t.width-4))}else i=Math.max(0,(r.width-t.width)/2),s=Math.max(0,(r.height-t.height)/2);this.$lastFocusedElement=document.activeElement,this.$frame.style.top=s+"px",this.$frame.style.left=i+"px",this.$frame.classList.add("dialogShowing"),typeof this._afterShowing=="function"&&this._afterShowing();if(!this.customFocus){var u=this._getFirstFocusField();u.focus()}},_getFirstFocusField:function(){return n.firstTabbable(this.$parent)||this._defaultButton||n.firstTabbable(this.$buttonContainer)||this.$close},destroy:function(){this._addedBackdrop&&this._addedBackdrop.length>0&&this._addedBackdrop.forEach(function(e){e.classList.remove("modalBackdrop")}),this.$frameParent.removeEventListener("focus",this._modalListener,!0),this.$frameParent.removeEventListener("click",this._modalListener,!0),this.$frameParent.removeChild(this.$frame),this.$frame=undefined,this.$parent=undefined}},i.prototype.constructor=i,{Dialog:i}}),define("orion/webui/dialogs/OpenResourceDialog",["i18n!orion/widgets/nls/messages","orion/crawler/searchCrawler","orion/contentTypes","require","orion/webui/littlelib","orion/webui/dialog"],function(e,t,n,r,i,s){function o(e){this._init(e)}return o.prototype=new s.Dialog,o.prototype.TEMPLATE='<div role="search"><div><label for="fileName">${Type the name of a file to open (? = any character, * = any string):}</label></div><div><input id="fileName" type="text" class="setting-control" style="width:90%;"/></div><div id="progress" style="padding: 2px 0 0; width: 100%;"><img src="'+r.toUrl("../../../images/progress_running.gif")+'" class="progressPane_running_dialog" id="crawlingProgress"></img></div>'+'<div id="favresults" style="max-height:400px; height:auto; overflow-y:auto;"></div>'+'<div id="results" style="max-height:400px; height:auto; overflow-y:auto;" aria-live="off"></div>'+'<div id="statusbar"></div>'+"</div>",o.prototype._init=function(t){this.title=t.title||e["Find File Named"],this.modal=!0,this.messages=e,this._searcher=t.searcher,this._progress=t.progress,this._onHide=t.onHide,this._contentTypeService=new n.ContentTypeService(this._searcher.registry);if(!this._searcher)throw new Error("Missing required argument: searcher");this._searchDelay=t.searchDelay||500,this._time=0,this._searcher.setCrawler(null),this._forceUseCrawler=!1,this._searchOnRoot=!0,this._fileService=this._searcher.getFileService();if(!this._fileService)throw new Error(e["Missing required argument: fileService"]);this._searchRenderer=t.searchRenderer;if(!this._searchRenderer||typeof this._searchRenderer.makeRenderFunction!="function")throw new Error(e["Missing required argument: searchRenderer"]);this._favService=t.favoriteService;if(!this._favService)throw new Error(e["Missing required argument: favService"]);this._initialize()},o.prototype._bindToDom=function(n){var r=this;r.$crawlingProgress.style.display="none",this.$fileName.setAttribute("placeholder",e.Search),this.$fileName.addEventListener("input",function(e){r._time=+(new Date),r._timeoutId&&clearTimeout(r._timeoutId),r._timeoutId=setTimeout(r.checkSearch.bind(r),0)},!1),this.$fileName.addEventListener("keydown",function(e){if(e.keyCode===i.KEY.ENTER){var t=i.$("a",r.$results);t&&(i.stop(e),window.open(t.href),r.hide())}},!1),n.addEventListener("keydown",function(e){var t,n,s,o,u,a,f=function(e,t,n){return t<e.length-1?e[t+1]:n},l=function(e,t,n){return t>0?e[t-1]:n};if(e.keyCode===i.KEY.DOWN||e.keyCode===i.KEY.UP)n=i.$$array("a",r.$results),t=i.$$array("a",r.$favresults),o=document.activeElement,a=n.indexOf(o),u=t.indexOf(o),e.keyCode===i.KEY.DOWN?u>=0?f(t,u,n.length>0?n[0]:t[0]).focus():a>=0?f(n,a,t.length>0?t[0]:n[0]).focus():(n.length>0||t.length>0)&&f(t,-1,n[0]).focus():u>=0?(s=r.$fileName,l(t,u,s).focus()):a>=0?(s=r.$fileName,l(n,a,t.length>0?t[t.length-1]:s).focus()):n.length>0?n[n.length-1].focus():t.length>0&&t[t.length-1].focus(),i.stop(e)}),n.addEventListener("mouseup",function(e){e.target.focus()},!1),this.populateFavorites(),setTimeout(function(){if(r._forceUseCrawler||!r._fileService.getService(r._searcher.getSearchLocation()).search){var n=r._searchOnRoot?r._searcher.getSearchRootLocation():r._searcher.getChildrenLocation(),i=new t.SearchCrawler(r._searcher.registry,r._fileService,"",{searchOnName:!0,location:n});r._searcher.setCrawler(i),i.buildSkeleton(function(){r.$crawlingProgress.style.display="inline",r.$progress.appendChild(document.createTextNode(e["Building file skeleton..."]))},function(){r.$crawlingProgress.style.display="none",r.$progress.removeChild(r.$progress.lastChild)})}},0)},o.prototype.populateFavorites=function(){var t=document.createElement("div");t.appendChild(document.createTextNode(e["Populating favorites&#x2026;"])),i.empty(this.$favresults),this.$favresults.appendChild(t);var n=this;this._progress?this._progress.progress(this._favService.getFavorites(),"Getting favorites").then(n.showFavorites()):this._favService.getFavorites().then(n.showFavorites()),this._favService.addEventListener("favoritesChanged",n.showFavorites())},o.prototype.showFavorites=function(){var e=this;return function(t){var n=t;n.navigator&&(n=n.navigator);var r=e._searchRenderer.makeRenderFunction(e._contentTypeService,e.$favresults,!1,e.decorateResult.bind(e),e.showFavoritesImage);r(n);if(n&&n.length>0){var i=document.createElement("div");i.style.borderBottom="1px dashed #BBBBBB",i.style.padding="5px",e.$favresults.appendChild(i)}}},o.prototype.showFavoritesImage=function(t){var n=new Image;n.classList.add("modelDecorationSprite"),n.classList.add("core-sprite-makeFavorite"),n.src=r.toUrl("images/none.png"),n.title=e.Favorite,t.appendChild(n),n.style.verticalAlign="middle"},o.prototype.checkSearch=function(){clearTimeout(this._timeoutId);var e=(new Date).getTime();e-this._time>this._searchDelay?(this._time=e,this.doSearch()):this._timeoutId=setTimeout(this.checkSearch.bind(this),50)},o.prototype.doSearch=function(){var t=this.$fileName.value,n=this.showFavorites();this._progress?this._progress.progress(this._favService.queryFavorites(t),"Getting favorites for: "+t).then(function(e){n(e)}):this._favService.queryFavorites(t).then(function(e){n(e)});if(t){var r=document.createElement("div");r.appendChild(document.createTextNode(e["Searching..."])),i.empty(this.$favresults),this.$results.appendChild(r);var s=this;setTimeout(function(){var e=s._searcher.createSearchParams(t,!0,s._searchOnRoot),n=s._searchRenderer.makeRenderFunction(s._contentTypeService,s.$results,!1,s.decorateResult.bind(s));s._searcher.search(e,!1,n)},0)}},o.prototype.decorateResult=function(e){var t=this,n=i.$$array("a",e);for(var r=0;r<n.length;r++){var s=n[r];s.addEventListener("mouseup",function(e){e.button===0&&!e.ctrlKey&&!e.metaKey&&t.hide()},!1),s.addEventListener("keyup",function(e){e.keyCode===i.KEY.ENTER&&t.hide()},!1)}},o.prototype._beforeHiding=function(){clearTimeout(this._timeoutId)},o.prototype._afterHiding=function(){this._onHide&&this._onHide()},o.prototype.constructor=o,{OpenResourceDialog:o}}),define("text!orion/banner/banner.html",[],function(){return'<header id="banner" role="banner" class="headerLayout">\n	<!-- Requires some js code to bind the home link, link to progress image, and binding NLS variables  -->\n	<!-- Top row:  Logo + discovery links + search + user -->\n	<div id="staticBanner" class="primaryNav layoutBlock topRowBanner">\n		<a id="home" class="layoutLeft logo"></a>\n		<nav id="primaryNav" class="layoutLeft" role="navigation"></nav>\n		<div class="layoutRight">\n			<div id="globalActions" class="spacingLeft layoutLeft"></div>\n			<div id="relatedLinks" class="spacingLeft layoutLeft" style="padding-top:1px;">\n				<span tabindex="0" role="button" id="relatedTrigger" class="dropdownTrigger hidden">${Related}<span class="dropdownArrowDown"></span></span>\n				<ul id="relatedDropdown" class="dropdownMenu" role="menu"></ul>\n			</div>\n			<input type="text" id="search" autocomplete="off" class="layoutLeft spacingLeft searchbox" role="search">\n			<div id="searchOptions" class="layoutLeft" style="padding-top:1px;"></div>\n			<div id="userMenu" class="spacingLeft layoutLeft">\n				<span id="userTrigger" tabindex="0" role="button" class="dropdownTrigger">${Options}<span class="dropdownArrowDown"></span></span>\n				<ul id="userDropdown" class="dropdownMenu" role="menu"></ul>\n			</div>\n		</div>\n	</div>\n	<!-- Task + resource (title) area -->\n	<div id="titleArea" class="layoutBlock titleArea">\n		<div class="clear" style="padding-bottom:5px;display:inline;"><span id="location" class="currentLocation"></span><span id="dirty" class="currentLocation"></span></div>\n		<div class="layoutRight pageNav">\n			<img class="progressPane" id="progressPane" tabindex="0" role="progressbar"></img>\n		</div>\n	</div>\n</header>'}),define("text!orion/banner/footer.html",[],function(){return'<footer id="footerContent" class="layoutBlock footerLayout" role="contentinfo">\n	<!-- Requires some js code to bind the NLS variables  -->\n	<div class="footerBlock">${Orion is in Beta. Please try it out but BEWARE your data may be lost.}</div>\n	<div class="footerRightBlock">\n		<a href="http://wiki.eclipse.org/Orion/FAQ" target="_blank">${FAQ}</a>\n		<a href="https://bugs.eclipse.org/bugs/enter_bug.cgi?product=Orion&version=2.0" target="_blank">${Report a Bug}</a>|\n		<a href="http://www.eclipse.org/legal/privacy.php" target="_blank">${Privacy Policy}</a>|\n		<a href="http://www.eclipse.org/legal/termsofuse.php" target="_blank">${Terms of Use}</a>|\n		<a href="http://www.eclipse.org/legal/copyright.php" target="_blank">${Copyright Agent}</a>\n	</div>\n</footer>'}),define("text!orion/banner/toolbar.html",[],function(){return'<ul class="layoutLeft commandList pageActions" id="pageActions"></ul>\n<ul class="layoutLeft commandList pageActions" id="selectionTools"></ul>\n<div class="layoutRight" style="padding-left:7px;padding-right:7px;margin-top:3px;" id="settingsTab" style="visibility:hidden;">\n	<div class="layoutRight core-sprite-settings" id="settingsAction" role="settings" aria-live="off" style="visibility:hidden;"></div>\n</div>\n<div class="layoutRight status" id="statusPane" role="status" aria-live="off"></div>\n<ul class="layoutRight commandList pageActions" id="pageNavigationActions"></ul>\n<div id="notificationArea" class="layoutLeft layoutBlock slideContainer">\n	<div class="layoutLeft" id="notifications" aria-live="assertive" aria-atomic="true"></div>\n	<div class="layoutRight"><span tabindex="0" role="button" class="layoutRight core-sprite-close imageSprite" id="closeNotifications"></span></div>\n</div>\n		\n	\n'}),define("orion/globalCommands",["i18n!orion/nls/messages","require","orion/commonHTMLFragments","orion/commands","orion/parameterCollectors","orion/extensionCommands","orion/uiUtils","orion/editor/keyBinding","orion/breadcrumbs","orion/webui/littlelib","orion/webui/splitter","orion/webui/dropdown","orion/webui/tooltip","orion/favorites","orion/contentTypes","orion/URITemplate","orion/PageUtil","orion/widgets/themes/container/ThemeSheetWriter","orion/searchUtils","orion/inputCompletion/inputCompletion","orion/globalSearch/advSearchOptContainer","orion/Deferred","orion/widgets/UserMenu","orion/PageLinks","orion/webui/dialogs/OpenResourceDialog","text!orion/banner/banner.html","text!orion/banner/footer.html","text!orion/banner/toolbar.html"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k){function L(e){var t=document.createElement("a");return t.href=e,t.href}function M(e,t){if(e.getLabel)return e.getLabel();var n=new E;return n.resolve(t.properties.name),n}function D(t){var n=f.node("progressPane");n.setAttribute("aria-label",e["Operations - Press spacebar to show current operations"]);var r=t.getService("orion.page.progress");r&&r.init.bind(r)("progressPane")}function P(e,t){var n=e.getService("orion.core.auth");n!==null&&n.getUser().then(function(e){var n;e.Name?n=document.createTextNode(e.Name):e.login&&(n=document.createTextNode(e.login)),n&&(t.childNodes.length>0?t.childNodes[0].nodeType===3?t.replaceChild(n,t.childNodes[0]):t.insertBefore(n,t.childNodes[0]):t.appendChild(n))})}function H(t,n){var r=t.getServiceReferences("orion.core.auth");_=[];var i=f.node("userMenu");if(!i)return;var s=f.node("userDropdown"),o=new c.Dropdown({dropdown:s}),u=new S.UserMenu({dropdownNode:s,dropdown:o,serviceRegistry:t}),a=f.node("userTrigger");new h.Tooltip({node:a,text:e.Options,position:["below","left"]}),P(t,a),u.setKeyAssist(n);for(var l=0;l<r.length;l++){var p=r[l],d=t.getService(p);M(d,p).then(function(e){d.getKey().then(function(t){_.push(t),d.getUser().then(function(n){u.addUserItem(t,d,e,n)},function(n,r){u.addUserItem(t,d,e,r)}),window.addEventListener("storage",function(n){if(O[t]===localStorage.getItem(t))return;O[t]=localStorage.getItem(t),d.getUser().then(function(n){u.addUserItem(t,d,e,n)},function(n){u.addUserItem(t,d,e)})},!1)})})}}function B(t){var n=document.createElement("span");n.id="advancedSearchDropDown",f.node("searchOptions").appendChild(n),n.tabIndex=0,n.classList.add("advancedSearchDecorationSprite"),n.classList.add("core-sprite-openarrow"),n.title=e["Advanced search"],n.onclick=function(e){t.toggle()},n.addEventListener("keydown",function(e){var n=e.charCode||e.keyCode;n===13&&t.toggle()}),n.classList.add("bannerMenuSearchOptions")}function R(){var e=f.node("relatedLinks");if(!e)return;j&&(j.close(),j.empty())}function U(){var e=f.node("relatedTrigger");j&&e&&(j.getItems().length===0?e.style.visibility="hidden":e.style.visibility="visible")}function z(e,t){var n=f.node("relatedDropdown");j||(j=new c.Dropdown({dropdown:n})),e._addMenuItem(n,t)}function W(e,t,n,i,o){function a(){if(u)return u;var t=e.getService("orion.core.contenttypes");return t||(t=new d.ContentTypeService(e),t=e.getService("orion.core.contenttypes")),t.getContentTypes().then(function(e){return u=e,u})}var u,l=e.getServiceReferences("orion.page.link.related");if(l.length<=0)return;var c=f.node("relatedLinks");if(!c)return;E.when(a(),function(){var a;R();var f=[];for(var c=0;c<l.length;c++){var h={},p,d=l[c].getPropertyKeys();for(p=0;p<d.length;p++)h[d[p]]=l[c].getProperty(d[p]);if(h.id){function v(e){if(e)if(!e.visibleWhen||e.visibleWhen(t)){var n=new r.CommandInvocation(i,t,t,null,e);z(e,n)}else typeof o=="function"&&(a||(a=o()),E.when(a,function(n){n&&t===F&&(!e.visibleWhen||e.visibleWhen(n))&&z(e,new r.CommandInvocation(i,n,n,null,e))}))}var m=null,g=null,y=n.indexOf(h.id);if(y<0){if((h.nls&&h.nameKey||h.name)&&h.uriTemplate){g=s._createCommandOptions(h,l[c],e,u,!0),f.push(g),g.then(function(e){var t=new r.Command(e);v(t)});continue}if(!m){m=i.findCommand(h.id);if(m){v(m);continue}}if(!m){var b=e.getServiceReferences("orion.navigate.command");for(p=0;p<b.length;p++){var w=b[p].getProperty("id");if(w===h.id){var S={};d=b[p].getPropertyKeys();for(var x=0;x<d.length;x++)S[d[x]]=b[p].getProperty(d[x]);g=s._createCommandOptions(S,b[p],e,u,!0),f.push(g),g.then(function(e){m=new r.Command(e),v(m)});break}}}}}}E.all(f,function(e){return e}).then(function(){U()})})}function X(e){var t=f.node("globalActions");t&&(e.destroy(t),e.renderCommands(t.id,t,{},{},"tool"))}function V(e){I=e}function $(e){q&&(q.charAt(0)==="*"&&!e&&(q=q.substring(1)),e&&q.charAt(0)!=="*"&&(q="*"+q),window.document.title=q);var t=f.node("dirty");t&&(e?t.textContent="*":t.textContent="")}function J(e){var t,n,r=e.breadcrumbRootName;e.target?(e.searchService&&e.searchService.setLocationByMetaData(e.target),e.fileService&&!e.breadcrumbTarget&&(n=r?r+" ":"",n+=e.fileService.fileServiceName(e.target.Location),r=null),t=e.name||e.target.Name,F=e.target,W(e.serviceRegistry,e.target,I,e.commandService,e.makeAlternate)):(e.breadcrumbTarget||(r=r||e.task||e.name),t=e.name),q=e.title,q||(t?q=t+" - "+e.task:q=e.task),window.document.title=q,f.empty(f.node("location")),new a.BreadCrumbs({container:"location",resource:e.breadcrumbTarget||e.target,rootSegmentName:r,workspaceRootSegmentName:n,makeHref:e.makeBreadcrumbLink})}function K(e){e.getPreferences("/themes",2).then(function(e){var t=e.get("selected");if(t){var n=JSON.parse(t),r=e.get("styles");if(!r)return;var i=JSON.parse(r);for(var s in i){var o;if(i[s].name===n.selected){o=i[s];var u=new g.ThemeSheetWriter,a=u.getSheet(o),f=document.createElement("STYLE");f.appendChild(document.createTextNode(a));var l=document.getElementsByTagName("HEAD")[0]||document.documentElement;l.appendChild(f);break}}}})}function Q(e){var t={},n=null;typeof e=="string"&&(e=f.node(e)),e||(e=f.node("pageActions"));var r=e;while(r&&r.classList){if(r.classList.contains("toolComposite")){n=r;break}r=r.parentNode}e.classList.contains("commandMarker")&&(t.commandNode=e);if(n){t.slideContainer=f.$(".slideParameters",n),t.parameterArea=f.$(".parameters",n),t.dismissArea=f.$(".parametersDismiss",n),t.notifications=f.$("#notificationArea",n);if(n.parentNode){t.toolbarTarget=f.$(".toolbarTarget",n.parentNode);if(t.toolbarTarget){var i=f.bounds(n);t.toolbarTargetY=i.height+1}}}return t}function G(e){if(e.toolbarTarget&&e.toolbarTargetY){var t=0,n;e.notifications&&e.notifications.classList.contains("slideContainerActive")&&(n=f.bounds(e.notifications),t+=n.height),e.slideContainer&&e.slideContainer.classList.contains("slideContainerActive")&&(n=f.bounds(e.slideContainer),t+=n.height),t>0&&(t+=8),e.toolbarTarget.style.top=e.toolbarTargetY+t+"px",e.toolbarTarget.style.bottom=0}}function Y(e){var t=document.getElementById("settingsTab"),n=document.getElementById("settingsAction"),r=!1,i;t.style.visibility="",n.style.visibility="",n.onclick=function(){if(!r){r=!0;var s=24,o=150,u=150,a="3px",l="#555";t.style.backgroundColor=l,t.style.zIndex="99",t.style.borderTopRightRadius=a,t.style.borderTopLeftRadius=a,n.className="core-sprite-settings-white",t.id="settingsNode",n.id="settingsButton";var c=document.getElementById("innerPanels"),h=c.getBoundingClientRect(),p=t.getBoundingClientRect();i?i.style.visibility="visible":(i=document.createElement("div"),i.className="settingsPanel",i.style.width=u+"px",i.style.height=o+"px",i.style.backgroundColor=l,i.style.zIndex="99",i.style.top=p.top-h.top+s-4+"px",i.id="settingsPanel",i.style.borderTopLeftRadius=a,i.style.borderBottomRightRadius=a,i.style.borderBottomLeftRadius=a,c.appendChild(i),f.addAutoDismiss([n,t,i],function(){n.className="core-sprite-settings",t.style.backgroundColor="white",i.style.visibility="hidden",r=!1})),f.empty(i),e.appendTo(i)}}}function et(){return Z}function tt(s,a,c,d,v,m,g,S){function lt(e){e=e;var t=f.$$array(".targetSelector");for(var n=0;n<t.length;n++)t[n].target=e}function ct(e){e.registerService("orion.cm.managedservice",{updated:function(e){var t;e&&e["links.newtab"]!=="undefined"?t=e["links.newtab"]?"_blank":"_self":t="_self",lt(t)}},{pid:"nav.config"})}K(d);var L=f.node(s);if(!L)throw e["could not find banner parent, id was "]+s;var A=document.createRange();A.selectNode(L);var O=A.createContextualFragment(N);f.processTextNodes(O,e),L.firstChild?L.insertBefore(O,L.firstChild):L.appendChild(O);var M=f.node("home");M.href=t.toUrl("navigate/table.html"),M.setAttribute("aria-label",e["Orion Home"]);var _=f.node("progressPane");_.src=t.toUrl("images/none.png");var P=f.node("pageToolbar");P&&(P.classList.add("toolbarLayout"),P.innerHTML=k+n.slideoutHTMLFragment("mainToolbar"));var j=f.node("closeNotifications");j&&j.setAttribute("aria-label",e["Close notification"]);var F=f.node("footer");F&&(F.innerHTML=C,f.processTextNodes(F,e)),c.setParameterCollector(new i.CommandParameterCollector(Q,G));var I=document.createElement("div");I.id="keyAssist",I.style.display="none",I.classList.add("keyAssistFloat"),I.role="list",I.setAttribute("aria-atomic","true"),I.setAttribute("aria-live","assertive"),document.body.appendChild(I),document.addEventListener("keydown",function(e){e.charOrCode===f.KEY.ESCAPE&&(I.style.display="none")},!1),f.addAutoDismiss([I],function(){I.style.display="none"});var q=f.node("primaryNav");q&&x.createPageLinks(a,"orion.page.link").then(function(e){e.forEach(function(e){q.appendChild(e)})});var R=f.node("search");if(!R)throw"failed to generate HTML for banner";R.setAttribute("placeholder",e.Search),new h.Tooltip({node:R,text:e["Type a keyword or wild card to search in root"],position:["below","left"]});var U=new w.advSearchOptContainer(R,v,a,{group:"advancedSearch"}),z=function(n){y.getMixedSearches(a,!0,!1,function(r){var i,s=[],o=!1,u=!1;for(i in r)r[i].label&&r[i].value?(o||(s.push({type:"category",label:e["Saved searches"]}),o=!0),s.push({type:"proposal",value:{name:r[i].label,value:t.toUrl("search/search.html")+"#"+r[i].value,type:"link"}})):(u||(s.push({type:"category",label:e["Recent searches"]}),u=!0),s.push({type:"proposal",label:r[i].name,value:r[i].name}));n(s)})},W=function(e,t){var n=a.getServiceReferences("orion.search.proposal");if(!n||n.length===0){t(null);return}var r=[];n.forEach(function(t){var n=t.getProperty("filterForMe");r.push(a.getService(t).run(e).then(function(e){var t={filterForMe:n,proposals:[]};for(var r=0;r<e.length;r++){t.proposals.push({type:"category",label:e[r].category});for(var i=0;i<e[r].datalist.length;i++)t.proposals.push({type:"proposal",label:e[r].datalist[i],value:e[r].datalist[i]})}return t}))}),E.all(r).then(function(e){t(e)})};new b.InputCompletion(R,z,{group:"globalSearch",extendedProvider:W}),R.addEventListener("keydown",function(e){if(e.defaultPrevented)return;var t=e.charCode||e.keyCode;t===13&&y.doSearch(v,a,R.value)}),B(U),f.addAutoDismiss([f.node(U.containerId),f.node("advancedSearchDropDown")],function(){U.dismiss()});var V=f.$(".split");if(V){var $=f.$(".sidePanelLayout"),J=f.$(".mainPanelLayout");if($&&J){Z={side:$,main:J},Z.splitter=new l.Splitter({node:V,sidePanel:$,mainPanel:J,toggle:!0});var Y=new r.Command({name:e["Toggle side panel"],tooltip:e["Open or close the side panel"],id:"orion.toggleSidePane",callback:function(){Z.splitter.toggleSidePanel()}});c.addCommand(Y),c.registerCommandContribution("pageActions","orion.toggleSidePane",1,null,!0,new r.CommandKeyBinding("o",!0)),g&&(Z.splitter.addResizeListener(function(e){g&&e===J&&g.getTextView().resize()}),g.getTextView().setKeyBinding(new u.KeyBinding("o",!0),"toggleOutliner"),g.getTextView().setAction("toggleOutliner",function(){return Z.splitter.toggleSidePanel(),!0},{name:e["Toggle Outliner"]}))}}var et=new r.Command({name:e["Make Favorite"],tooltip:e["Add to the favorites list"],imageClass:"core-sprite-makeFavorite",id:"orion.makeFavorite",visibleWhen:function(e){var t=Array.isArray(e)?e:[e];if(t.length===0)return!1;for(var n=0;n<t.length;n++)if(!t[n].Location)return!1;return!0},callback:function(t){var n=Array.isArray(t.items)?t.items:[t.items],r=a.getService("orion.core.favorite"),i=a.getService("orion.page.progress"),s=function(t){return function(n){n?a.getService("orion.page.message").setMessage(t.Name+e[" is already a favorite."],2e3):i.progress(r.makeFavorites(t),"Making favorite "+t.Name)}};for(var o=0;o<n.length;o++){var u=n[o];i.progress(r.hasFavorite(u.ChildrenLocation||u.Location),"Checking favorite "+u.Name).then(s(u))}}});c.addCommand(et);var tt=function(e,t,n){var r=t.getService("orion.core.favorite"),i=t.getService("orion.page.progress");r||(r=new p.FavoritesService({serviceRegistry:t}),r=t.getService("orion.core.favorite"));var s=new T.OpenResourceDialog({searcher:e,progress:i,searchRenderer:e.defaultRenderer,favoriteService:r,onHide:function(){n&&n.getTextView().focus()}});window.setTimeout(function(){s.show()},0)},nt=new r.Command({name:e["Find File Named..."],tooltip:e["Choose a file by name and open an editor on it"],id:"eclipse.openResource",callback:function(e){tt(v,a,g)}});g&&(g.getTextView().setKeyBinding(new u.KeyBinding("f",!0,!0,!1),nt.id),g.getTextView().setAction(nt.id,function(){return tt(v,a,g),!0},nt)),c.addCommand(nt),c.registerCommandContribution("globalActions","eclipse.openResource",100,null,!0,new r.CommandKeyBinding("f",!0,!0));var rt=new r.Command({name:e["Global search"],tooltip:e["Global search"],id:"eclipse.globalSearch",callback:function(e){var t=f.node("search");t&&t.focus()}});g&&(g.getTextView().setKeyBinding(new u.KeyBinding("h",!0,!1,!0),rt.id),g.getTextView().setAction(rt.id,function(){var e=g.getSelection(),t=null;if(e.end>e.start){var n=g.getModel();t=n.getText(e.start,e.end)}var r=f.node("search");return r&&(t&&(r.value=t),r.focus()),!0},rt)),c.addCommand(rt),c.registerCommandContribution("globalActions","eclipse.globalSearch",101,null,!0,new r.CommandKeyBinding("h",!0,!1,!0));var it=new r.Command({name:e["Toggle banner and footer"],tooltip:e["Hide or show the page banner and footer"],id:"orion.toggleTrim",callback:function(){var e=f.node("banner"),t=f.node("footer"),n=f.$(".content-fixedHeight");return e.style.display==="none"?(e.style.display="block",t.style.display="block",n.classList.remove("content-fixedHeight-maximized")):(e.style.display="none",t.style.display="none",n.classList.add("content-fixedHeight-maximized")),g&&g.getTextView().resize(),!0}});c.addCommand(it),c.registerCommandContribution("globalActions","orion.toggleTrim",100,null,!0,new r.CommandKeyBinding("m",!0,!0)),g&&(g.getTextView().setKeyBinding(new r.CommandKeyBinding("m",!0,!0),it.id),g.getTextView().setAction(it.id,it.callback,it));if(S){var st={isActive:function(){return I.style.display==="block"},cancel:function(){return this.isActive()?(I.style.display="none",!0):!1}};S.addHandler(st)}var ot=new r.Command({name:e["System Configuration Details"],tooltip:e["System Config Tooltip"],id:"orion.configDetailsPage",hrefCallback:function(){return t.toUrl("help/about.html")}});c.addCommand(ot),c.registerCommandContribution("globalActions","orion.configDetailsPage",100,null,!0,new r.CommandKeyBinding(112,!0,!0));var ut=new r.Command({name:e["Background Operations"],tooltip:e["Background Operations Tooltip"],id:"orion.backgroundOperations",hrefCallback:function(){return t.toUrl("operations/list.html")}});c.addCommand(ut),c.registerCommandContribution("globalActions","orion.backgroundOperations",100,null,!0,new r.CommandKeyBinding("o",!0,!0));var at=new r.Command({name:e["Show Keys"],tooltip:e["Show a list of all the keybindings on this page"],id:"eclipse.keyAssist",callback:function(){if(I.style.display==="none"){var t;f.empty(I);if(g){t=document.createElement("h2"),t.appendChild(document.createTextNode(e.Editor)),I.appendChild(t);var n=g.getTextView().getActions(!1);for(var r=0;r<n.length;r++){var i=n[r],s=i,u=g.getTextView(),a=u.getActionDescription(i);a&&a.name&&(s=a.name);var l=u.getKeyBindings(i);for(var h=0;h<l.length;h++){var p=o.getUserKeyString(l[h]),d=document.createElement("span");d.role="listitem",d.appendChild(document.createTextNode(p+" = "+s)),d.appendChild(document.createElement("br")),I.appendChild(d)}}}t=document.createElement("h2"),t.appendChild(document.createTextNode(e.Global)),I.appendChild(t),c.showKeyBindings(I),I.style.display="block"}else I.style.display="none";return!0}});c.addCommand(at),c.registerCommandContribution("globalActions","eclipse.keyAssist",100,null,!0,new r.CommandKeyBinding(191,!1,!0));if(g){var ft=window.navigator.platform.indexOf("Mac")!==-1;g.getTextView().setKeyBinding(new r.CommandKeyBinding(191,!1,!0,!ft,ft),at.id),g.getTextView().setAction(at.id,at.callback,at)}X(c),H(a,at.callback),D(a),window.addEventListener("hashchange",function(){c.processURL(window.location.href)},!1),window.setTimeout(function(){ct(a)},0)}var A=L(t.toUrl("auth/NotifyAuthentication.html")),O={},_=[],j,F,I=[],q,Z=null;return{addSettings:Y,generateBanner:tt,getToolbarElements:Q,getMainSplitter:et,layoutToolbarElements:G,setPageTarget:J,setDirtyIndicator:$,setPageCommandExclusions:V,notifyAuthenticationSite:A}}),define("orion/status",["require","orion/webui/littlelib","orion/globalCommands"],function(e,t,n){function r(e,t,n,r,i){this._serviceRegistry=e,this._serviceRegistration=e.registerService("orion.page.message",this),this._operationsClient=t,this.notificationContainerDomId=i,this.domId=n,this.progressDomId=r||n,this._hookedClose=!1}function i(e,t,n,r){this.statusService=e,this.progressId=t;if(n){this.deferred=n,this.begin(r);var i=this;n.then(function(e,t){i.done.bind(i)()},function(e,t){i.done.bind(i)()})}}return r.prototype={_init:function(){var e=t.node("closeNotifications"),n=this;e&&!this._hookedClose&&(e.addEventListener("click",function(){n.setProgressMessage("")},!1),e.addEventListener("keydown",function(e){(e.keyCode===t.KEY.ENTER||e.keyCode===t.KEY.SPACE)&&n.setProgressMessage("")},!1))},_getNotifierElements:function(){return this._notifierElements||(this._notifierElements=n.getToolbarElements(this.notificationContainerDomId)),this._notifierElements},setMessage:function(e,n,r){this._init(),this.currentMessage=e;var i=t.node(this.domId);if(typeof r=="boolean"){var s=this,o=i.getAttribute("aria-live");i.setAttribute("aria-live",r?"polite":"off"),window.setTimeout(function(){e===s.currentMessage&&(t.empty(i),i.appendChild(document.createTextNode(e)),window.setTimeout(function(){i.setAttribute("aria-live",o)},100))},100)}else t.empty(i),i.appendChild(document.createTextNode(e));if(typeof n=="number"){var s=this;window.setTimeout(function(){e===s.currentMessage&&(t.empty(i),i.appendChild(document.createTextNode("")))},n)}},setErrorMessage:function(e){this.currentMessage=e,this._init();var n=e.responseText||e.message||e;try{n=JSON.parse(n)}catch(r){}var i=n.Message||n,s="red";if(n.Severity)switch(n.Severity){case"Warning":s="#FFCC00";break;case"Error":s="red";break;case"Info":case"Ok":s="green"}var o=document.createElement("span");o.style.color=s,o.appendChild(document.createTextNode(i));var u=t.node(this.domId);t.empty(u),u.appendChild(o)},setProgressMessage:function(e){this._init(),this.currentMessage=e;var r=document.createElement("span");r.classList.add("imageSprite"),r.classList.add("core-sprite-progress");var i=t.node(this.progressDomId);t.empty(i),i.appendChild(r),i.appendChild(document.createTextNode(e));var s=t.node(this.notificationContainerDomId);s.classList.add("progressNormal");if(e&&e.length>0)s.classList.add("slideContainerActive");else{if(this._progressMonitors&&this._progressMonitors.length>0)return this._renderOngoingMonitors();s.classList.remove("slideContainerActive")}n.layoutToolbarElements(this._getNotifierElements())},setProgressResult:function(e){this.currentMessage=e;var r=e.responseText||e;try{r=JSON.parse(r)}catch(i){}this._init();var s=r.Message||r,o="core-sprite-info",u="progressInfo",a=document.createElement("span");a.classList.add("imageSprite");var f=[],l="info";if(r.Severity)switch(r.Severity){case"Warning":o="core-sprite-warning",l="warning",u="progressWarning",f.push("progressInfo"),f.push("progressError"),f.push("progressNormal");break;case"Error":o="core-sprite-error",l="error",u="progressError",f.push("progressWarning"),f.push("progressInfo"),f.push("progressNormal");break;default:f.push("progressWarning"),f.push("progressError"),f.push("progressNormal")}a.classList.add(o);var c=t.node(this.progressDomId),h=t.node(this.notificationContainerDomId);t.empty(c),c.appendChild(a);if(r.HTML){var p=document.createElement("span");p.innerHTML=s,c.appendChild(p)}else c.appendChild(document.createTextNode("   "+s));if(u&&this.progressDomId!==this.domId){h.classList.add(u);for(var d=0;d<f.length;d++)h.classList.remove(f[d])}h.classList.add("slideContainerActive"),n.layoutToolbarElements(this._getNotifierElements())},showWhile:function(e,t){var n=this;if(t){n.setProgressMessage(t);var r=function(){t===n.currentMessage&&n.setProgressMessage("")};e.then(r,r)}return e},_lastProgressId:0,_progressMonitors:{length:0},createProgressMonitor:function(e,t){return new i(this,++this._lastProgressId,e,t)},_renderOngoingMonitors:function(){if(this._progressMonitors.length>0){var e="",t=!0;for(var n in this._progressMonitors)this._progressMonitors[n].status&&(t||(e+=", "),e+=this._progressMonitors[n].status,t=!1);this.setProgressMessage(e)}else this.setProgressMessage("")},_beginProgressMonitor:function(e){this._progressMonitors[e.progressId]=e,this._progressMonitors.length++,this._renderOngoingMonitors()},_workedProgressMonitor:function(e){this._progressMonitors[e.progressId]=e,this._renderOngoingMonitors()},_doneProgressMonitor:function(e){delete this._progressMonitors[e.progressId],this._progressMonitors.length--,e.status?this.setProgressResult(e.status):this._renderOngoingMonitors()}},r.prototype.constructor=r,i.prototype.begin=function(e){this.status=e,this.statusService._beginProgressMonitor(this)},i.prototype.done=function(e){this.status=e,this.statusService._doneProgressMonitor(this)},i.prototype.worked=function(e){this.status=e,this.statusService._workedProgressMonitor(this)},i.prototype.constructor=i,{StatusReportingService:r,ProgressMonitor:i}}),define("orion/operations/nls/root/messages",{More:"More","No Matching OperationService for location:":"No Matching OperationService for location:","No operations services registered.":"No operations services registered.","could not find toolbar ":"could not find toolbar ","Remove Completed":"Remove Completed","Remove all completed operations":"Remove all completed operations",Remove:"Remove","Remove operations from the operations list.":"Remove operations from the operations list.",Cancel:"Cancel","Cancel operations from the operations list.":"Cancel operations from the operations list.","Operation resulted in a warning.":"Operation resulted in a warning.","Operation resulted in an error.":"Operation resulted in an error.","Operation is running.":"Operation is running.","Operation is canceled.":"Operation is canceled.","Operation failed.":"Operation failed.",Name:"Name",Actions:"Actions",Status:"Status",Scheduled:"Scheduled"}),define("orion/operations/nls/messages",["orion/i18n!orion/operations/nls/messages","orion/operations/nls/root/messages"],function(e,t){var n={root:t};return Object.keys(e).forEach(function(t){typeof n[t]=="undefined"&&(n[t]=e[t])}),n}),define("orion/webui/popupdialog",["i18n!orion/widgets/nls/messages","require","orion/webui/littlelib","orion/webui/tooltip"],function(e,t,n,r){function i(){}return i.prototype={_initialize:function(t,i,s,o,u){this._tooltip=new r.Tooltip({node:t,hideDelay:u||0,afterShowing:this._afterShowingFunction(i).bind(this),afterHiding:s,trigger:o?o:"click"}),this.$parent=this._tooltip.contentContainer(),this.$parent.role="dialog";var a=document.createRange();a.selectNode(this.$parent);var f=a.createContextualFragment(this.TEMPLATE);this.messages&&n.processTextNodes(f,e),this.$parent.appendChild(f);var l=this._tooltip;this.$parent.addEventListener("keydown",function(e){e.keyCode===n.KEY.ESCAPE&&l.hide()},!1),this._bindElements(this.$parent),typeof this._bindToDom=="function"&&this._bindToDom(this.$parent)},_bindElements:function(e){for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];n.id&&(this["$"+n.id]=n),this._bindElements(n)}},_afterShowingFunction:function(e){return function(){e&&e.bind(this)();if(!this.customFocus){var t=n.firstTabbable(this.$parent);t&&t.focus()}}},hide:function(){this._tooltip.hide()},show:function(){this._tooltip.show()}},i.prototype.constructor=i,{PopupDialog:i}}),define("orion/operationsCommands",["i18n!orion/operations/nls/messages","require","orion/webui/littlelib","orion/commands"],function(e,t,n,r){var i={};return function(){var t=!1;i.updateNavTools=function(r,i,s,o,u){var a=r.getService("orion.page.command"),f=n.node(s);if(!f)throw e["could not find toolbar "]+s;a.destroy(f),a.renderCommands(s,f,u,i,"button");if(o){var l=n.node(o);l&&(a.destroy(l),a.renderCommands(o,l,null,i,"button"))}t||(t=!0,r.getService("orion.page.selection").addEventListener("selectionChanged",function(e){var t=n.node(o);if(t){var s=r.getService("orion.page.command");s.destroy(t),s.renderCommands(o,t,e.selections,i,"button")}}))},i.createOperationsCommands=function(t,n,i){function s(e){return!e.operation||!e.operation.type?!1:e.operation.type==="loadstart"||e.operation.type==="progress"}function o(e){return e.operation&&e.operation.cancelable?!0:!1}var u=new r.Command({name:e["Remove Completed"],tooltip:e["Remove all completed operations"],id:"eclipse.removeCompletedOperations",callback:function(e){i.removeCompletedOperations().then(function(e){n.loadOperations.bind(n)()})},visibleWhen:function(e){return!0}});t.addCommand(u);var a=new r.Command({name:e.Remove,tooltip:e["Remove operations from the operations list."],imageClass:"core-sprite-delete",id:"eclipse.removeOperation",callback:function(e){var t=Array.isArray(e.items)?e.items:[e.items];for(var r=0;r<t.length;r++){var s=t[r];i.removeOperation.bind(i)(s.Location).then(function(){n.loadOperations.bind(n)()},function(){n.loadOperations.bind(n)()})}},visibleWhen:function(e){if(!Array.isArray(e)||e.length===0)return!s(e);for(var t in e)if(s(e[t]))return!1;return!0}});t.addCommand(a);var f=new r.Command({name:e.Cancel,tooltip:e["Cancel operations from the operations list."],imageClass:"core-sprite-stop",id:"eclipse.cancelOperation",callback:function(e){var t=Array.isArray(e.items)?e.items:[e.items];for(var n=0;n<t.length;n++){var r=t[n];r.deferred&&r.deferred.cancel()}},visibleWhen:function(e){if(!Array.isArray(e)||e.length===0)return s(e)&&o(e);for(var t in e)if(!s(e[t])||!o(e[t]))return!1;return!0}});t.addCommand(f)}}(),i}),define("orion/webui/dialogs/OperationsDialog",["i18n!orion/operations/nls/messages","require","orion/webui/littlelib","orion/webui/popupdialog","orion/operationsCommands"],function(e,t,n,r,i){function s(e){this._options=e}return s.prototype=new r.PopupDialog,s.prototype.TEMPLATE='<table style="width: 360px;"><tr><td><h2>Recent operations</h2></td><td style="text-align: right;"><a id="allOperationsLink">All Operations</a></td></tr></table><span id="operationsExist"><span class="secondaryColumn" id="myOperationsListEmpty">No operations running on this page.</span><table id="myOperationsList" style="display: none;"></table></span><span class="secondaryColumn" id="operationsDontExist">No operations running.</span>',s.prototype._init=function(e){this._myOperations=[],this._operationsDeferreds=[],this._commandService=e.serviceRegistry.getService("orion.page.command"),i.createOperationsCommands(this._commandService),this._commandService.registerCommandContribution("operationsDialogItems","eclipse.cancelOperation",1),this._initialize(e.triggerNode)},s.prototype._bindToDom=function(e){this.$allOperationsLink.href=t.toUrl("operations/list.html"),this._setOperationsVisibility()},s.prototype.setOperations=function(e,t){this._myOperations||this._init(this._options),this._myOperations=[],this._operationsDeferreds=[];if(e)for(var n in e)this._myOperations.push(e[n]),this._operationsDeferreds.push(t[n]);this._renderOperations()},s.prototype.parseProgressResult=function(e){if(!e)return{};var t=e.responseText||e;try{t=JSON.parse(t)}catch(n){}var r={Message:t.Message||t,Severity:t.Severity};return t.DetailedMessage&&t.DetailedMessage!==r.Message&&(r.DetailedMessage=t.DetailedMessage),r},s.prototype._renderOperations=function(){this._renderOperationsTable(this.$myOperationsList,this._myOperations,this._operationsDeferreds)},s.prototype._renderOperationsTable=function(t,r,i){n.empty(t);for(var s=0;s<r.length;s++){var o=r[s],u=document.createElement("tr"),a=document.createElement("td");a.style.paddingLeft="5px;",a.style.paddingRight="5px;",a.textContent=o.Name,u.appendChild(a);var f=document.createElement("div");a.appendChild(f);var l=document.createElement("span");f.appendChild(l),l.classList.add("imageSprite");var c=document.createElement("span");c.classList.add("primaryColumn"),f.appendChild(c),c.appendChild(document.createTextNode(o.Name));switch(o.type){case"Warning":l.classList.add("core-sprite-warning"),l.setAttribute("aria-label",e["Operation resulted in a warning."]);break;case"error":l.classList.add("core-sprite-error"),l.setAttribute("aria-label",e["Operation resulted in an error."]);break;case"loadstart":case"progress":l.classList.add("core-sprite-start"),l.setAttribute("aria-label",e["Operation is running."]);break;case"abort":l.classList.add("core-sprite-stop"),l.setAttribute("aria-label",e["Operation is canceled."]);break;case"load":case"loadend":l.classList.add("core-sprite-ok"),l.setAttribute("aria-label","Operation ok.")}if(o.error){var h=o.error.Message||o.error;o.error.DetailedMessage&&o.error.DetailedMessage!==""&&(h+=": "+o.error.DetailedMessage),f.appendChild(document.createElement("br"));var p=document.createElement("span");p.classList.add("secondaryColumn"),p.style.marginLeft="18px;",f.appendChild(p),p.textContent=h}var d=document.createElement("span");f.appendChild(d),this._commandService.renderCommands("operationsDialogItems",f,{operation:o,deferred:i[s]},this,"tool"),t.appendChild(u)}this._setOperationsVisibility()},s.prototype._setOperationsVisibility=function(){this.$myOperationsList.style.display=this._myOperations.length>0?"":"none",this.$myOperationsListEmpty.style.display=this._myOperations.length>0?"none":"",this.$operationsDontExist.style.display=this._myOperations.length>0?"none":"",this.$operationsExist.style.display=this._myOperations.length>0?"":"none"},s.prototype.constructor=s,{OperationsDialog:s}}),define("orion/progress",["i18n!orion/nls/messages","require","orion/Deferred","orion/webui/littlelib","orion/webui/dialogs/OperationsDialog"],function(e,t,n,r,i){function s(e,t){if(this._progressPane)return;this._progressPane=r.node(e),this._operationsDialog=new i.OperationsDialog({triggerNode:this._progressPane,serviceRegistry:t});var n=this;this._progressPane.addEventListener("keydown",function(e){(e.charOrCode===" "||e.keyCode===r.KEY.ENTER)&&n._operationsDialog.show()})}function o(e,t,n){this._serviceRegistry=e,this._serviceRegistration=e.registerService("orion.page.progress",this),this._operationsClient=t,this._operations={},this._operationDeferrds={},this._operationsIndex=0,this._lastOperation=null,this._lastIconClass=null,this._progressMonitorClass=n}return s.prototype={_switchIconTo:function(e){this._lastIconClass&&this._progressPane.classList.remove(this._lastIconClass),this._lastIconClass=e,this._progressPane.classList.add(this._lastIconClass)},generateOperationsInfo:function(t,n){var r={};for(var i in t)t[i].progressMonitor||(r[i]=t[i]);if(this._isEmpty(r)){this._switchIconTo("progressPane_empty"),this._progressPane.title=e.Operations,this._progressPane.alt=e.Operations,this._progressPane.hasAttribute("aria-valuetext")&&this._progressPane.removeAttribute("aria-valuetext"),this._operationsDialog.setOperations(r,n);return}var s="";for(var i in r){var o=r[i];if(o.type&&(o.type==="loadstart"||o.type==="progress")){s="running";break}}s===""&&this._lastOperation!=null&&this._lastOperation.type&&this._lastOperation.type==="error"&&s=="error";switch(s){case"running":this._progressPane.title=e["Operations running"],this._progressPane.alt=e["Operations running"],this._progressPane.setAttribute("aria-valuetext",e["Operations running"]),this._switchIconTo("progressPane_running");break;case"warning":this._progressPane.title=e["Some operations finished with warning"],this._progressPane.alt=e["Some operations finished with warning"],this._progressPane.setAttribute("aria-valuetext",e["Some operations finished with warning"]),this._switchIconTo("progressPane_warning");break;case"error":this._progressPane.title=e["Some operations finished with error"],this._progressPane.alt=e["Some operations finished with error"],this._progressPane.setAttribute("aria-valuetext",e["Some operations finished with error"]),this._switchIconTo("progressPane_error");break;default:this._progressPane.title=e.Operations,this._progressPane.alt=e.Operations,this._progressPane.hasAttribute("aria-valuetext")&&this._progressPane.removeAttribute("aria-valuetext"),this._switchIconTo("progressPane_operations")}this._operationsDialog.setOperations(r,n)},_isEmpty:function(e){for(var t in e)return!1;return!0}},s.prototype.constructon=s,o.prototype={init:function(e){if(this._progressMonitorClass)return;this._progressMonitorTool=new s(e,this._serviceRegistry)},progress:function(e,t,n){var r=this,i=this._operationsIndex++;return!n&&this._progressMonitorClass&&(n=new this._progressMonitorClass,n.begin(t)),e.then(function(s){if(r._operations[i]){var o=r._operations[i];t&&(o.Name=t),r._lastOperation=o,o.type="loadend",n&&(o.progressMonitor=n),r.writeOperation.bind(r)(i,o,e),o.Location||r._removeOperationFromTheList.bind(r)(i)}},function(s){if(r._operations[i]){var o=r._operations[i];t&&(o.Name=t),n&&(o.progressMonitor=n),r._lastOperation=o,o.type=s.canceled?"abort":"error",o.error=s,r.writeOperation.bind(r)(i,o,e),o.Location||r._removeOperationFromTheList.bind(r)(i)}},function(s){t&&(s.Name=t),n&&(s.progressMonitor=n),r.writeOperation.bind(r)(i,s,e)}),e},removeOperation:function(e){var t=this;for(var n in this._operations)if(this._operations[n].Location&&this._operations[n].Location===e){this._removeOperationFromTheList(n);break}t._operationsClient.removeOperation.bind(t._operationsClient)(e)},_removeOperationFromTheList:function(e){var t=this._operations[e].progressMonitor;delete this._operations[e],delete this._operationDeferrds[e],t?t.done():this._progressMonitorTool.generateOperationsInfo(this._operations,this._operationDeferrds)},removeCompletedOperations:function(){for(var e in this._operations){var t=this._operations[e];if(t.type&&t.type!=="loadstart"&&t.type!=="progress"){var n=this._operations[e].progressMonitor;n&&n.done(),delete this._operations[e],delete this._operationDeferrds[e]}}this._progressMonitorTool.generateOperationsInfo(operations,this._operationDeferrds)},setProgressResult:function(e){this._serviceRegistry.getService("orion.page.message").setProgressResult(e)},showWhile:function(e,t){t&&this._serviceRegistry.getService("orion.page.message").setProgressMessage(t);var n=this;return e.then(function(e){n._serviceRegistry.getService("orion.page.message").setProgressMessage("")},function(e){return n.setProgressResult.bind(n)(e),e}),this.progress(e,t)},writeOperation:function(e,t,n){this._operations[e]=t,this._operationDeferrds[e]=n,t.Location&&serviceRegistry.getService("orion.core.preference").getPreferences("/operations").then(function(e){e.put(t.Location,{Name:t.Name,expires:t.expires})}),t.progressMonitor?t.progressMonitor.progress(t.Name):this._progressMonitorTool.generateOperationsInfo(this._operations,this._operationDeferrds)}},o.prototype.constructor=o,{ProgressService:o}}),define("orion/operationsClient",["i18n!orion/operations/nls/messages","orion/Deferred"],function(e,t){function n(e,t,n){return e[t].apply(e,n)}function r(e,t){return n(e,"getOperations",[t])}function i(e){this._location=e}function s(){var n=new t;return n.reject(e["No Matching OperationService for location:"]+this._location),n}function o(e){this._services=[],this._patterns=[],this._operationListeners=[],this._currentLongpollingIds=[],this._preferenceService=e.getService("orion.core.preference");var t=e.getServiceReferences("orion.core.operation");for(var n=0;n<t.length;n++){var r=t[n],s=e.getService(r);this._services[n]=s;var o=t[n].getProperty("pattern")||".*";o[0]!=="^"&&(o="^"+o),this._patterns[n]=new RegExp(o)}this._getService=function(e){if(!e)return this._services[0];for(var t=0;t<this._patterns.length;++t)if(this._patterns[t].test(e))return this._services[t];return new i(e)}}function u(e){var t={Children:[]};for(var n=0;n<e.length;n++)t.Children=t.Children.concat(e[n].Children);return t}function a(e){for(var t=0;t<this._operationListeners.length;t++)this._operationListeners[t](e)}return i.prototype={getOperation:s,getOperations:s,removeCompletedOperations:s,removeOperation:s,cancelOperation:s},i.prototype.constructor=i,o.prototype={getOperations:function(){var e=new t;if(this._operations)return e.resolve(this._operations),e;var n=this;return this._preferenceService.getPreferences("/operations").then(function(t){n._operations=t,e.resolve(n._operations)}),e},getOperation:function(e){return n(this._getService(e),"getOperation",arguments)},removeCompletedOperations:function(){var e=[],r=this;for(var i=0;i<this._services.length;i++){var s=this._patterns[i],o=new t;e[i]=o.promise,n(this._services[i],"removeCompletedOperations").then(function(e){return function(t){if(!Array.isArray(t))return;r.getOperations.bind(r)().then(function(n){var r=n.keys();for(var i=0;i<r.length;i++){var o=r[i];s.test(o)&&t.indexOf(o)<0&&n.remove(o)}e.resolve()})}}(o),function(e){return function(t){e.reject(t)}}(o))}return t.all(e)},removeOperation:function(e){var t=this;return n(this._getService(e),"removeOperation",arguments).then(function(n){t.getOperations.bind(t)().then(function(t){t.remove(e)})},function(e){return e},function(e){return e})}},o.prototype.constructor=o,{OperationsClient:o}}),define("orion/navigate/nls/root/messages",{"Click one of the tasks below to create an Orion folder.  You can upload, import, or generate files.":"Click one of the tasks below to create an Orion folder.  You can upload, import, or generate files.","Toggle Left Pane":"Toggle Left Pane","Open or close the left pane":"Open or close the left pane",Navigator:"Navigator","Strings Xtrnalizr":"Strings Xtrnalizr","Externalize Strings from JavaScript files in this folder":"Externalize Strings from JavaScript files in this folder","Choose a Folder":"Choose a Folder","Copy of ${0}":"Copy of ${0}","Enter a new name for '${0}'":"Enter a new name for '${0}'","Choose folder...":"Choose folder...",Rename:"Rename","Rename the selected files or folders":"Rename the selected files or folders","Compare with each other":"Compare with each other","Compare the selected 2 files with each other":"Compare the selected 2 files with each other","Compare with...":"Compare with...","Compare the selected folder with a specified folder":"Compare the selected folder with a specified folder",Delete:"Delete","Unknown item":"Unknown item","Make Favorite":"Make Favorite","Delete the selected files or folders":"Delete the selected files or folders","Are you sure you want to delete these ${0} items?":"Are you sure you want to delete these ${0} items?","Are you sure you want to delete '${0}'?":"Are you sure you want to delete '${0}'?","Are you sure you want to delete '${0}' from the favorites?":"Are you sure you want to delete '${0}' from the favorites?","Are you sure you want to delete these ${0} favorites?":"Are you sure you want to delete these ${0} favorites?","You can create favorites by selecting any file or folder in the navigator and choosing ${0} from the ${1} menu.":"You can create favorites by selecting any file or folder in the navigator and choosing ${0} from the ${1} menu.","Export as zip":"Export as zip","Create a zip file of the folder contents and download it":"Create a zip file of the folder contents and download it","New File":"New File","Create a new file":"Create a new file","Name:":"Name:","New Folder":"New Folder","Folder name:":"Folder name:","Create a new folder":"Create a new folder","Creating folder":"Creating folder",Folder:"Folder","Create an empty folder":"Create an empty folder","Create an empty folder on the Orion server.  You can import, upload, or create content in the editor.":"Create an empty folder on the Orion server.  You can import, upload, or create content in the editor.","Sample HTML5 Site":"Sample HTML5 Site","Generate a sample":"Generate a sample",'Generate an HTML5 "Hello World" website, including JavaScript, HTML, and CSS files.':'Generate an HTML5 "Hello World" website, including JavaScript, HTML, and CSS files.',"Creating a folder for ${0}":"Creating a folder for ${0}","SFTP Import":"SFTP Import","Import content from SFTP":"Import content from SFTP","Import content from an SFTP location into an Orion folder.  You will be prompted for the SFTP location and credentials.":"Import content from an SFTP location into an Orion folder.  You will be prompted for the SFTP location and credentials.","Imported Content":"Imported Content","Upload a Zip":"Upload a Zip","Upload content from a local zip file":"Upload content from a local zip file","Upload content from a local zip file into an Orion folder.  You will be prompted for the local zip file.":"Upload content from a local zip file into an Orion folder.  You will be prompted for the local zip file.","Uploaded Content":"Uploaded Content","Creating an upload folder for ":"Creating an upload folder for ","Clone Git Repository":"Clone Git Repository","Clone a git repository":"Clone a git repository","Go to the Orion repositories page to provide a git repository URL.  Once the repository is created, it will appear in the Navigator.":"Go to the Orion repositories page to provide a git repository URL.  Once the repository is created, it will appear in the Navigator.","Link to Server":"Link to Server","Link to existing content on the server":"Link to existing content on the server","Create a folder that links to an existing folder on the server.":"Create a folder that links to an existing folder on the server.","Server path:":"Server path:","The name and server location were not specified.":"The name and server location were not specified.","Go Up":"Go Up","Move up to the parent folder":"Move up to the parent folder","Import local file...":"Import local file...","Copy files and folders from your local file system":"Copy files and folders from your local file system","SFTP from...":"SFTP from...","Copy files and folders from a specified SFTP connection":"Copy files and folders from a specified SFTP connection","Importing from ${0}":"Importing from ${0}","SFTP to...":"SFTP to...","Copy files and folders to a specified SFTP location":"Copy files and folders to a specified SFTP location","Exporting from ${0}":"Exporting from ${0}","Pasting ${0}":"Pasting ${0}","Copy to":"Copy to","Move to":"Move to","Copying ${0}":"Copying ${0}","Moving ${0}":"Moving ${0}","Renaming ${0}":"Renaming ${0}","Deleting ${0}":"Deleting ${0}","Creating ${0}":"Creating ${0}","Linking to ${0}":"Linking to ${0}","Move files and folders to a new location":"Move files and folders to a new location","Copy Items":"Copy Items","Copy the selected items to the copy/paste buffer":"Copy the selected items to the copy/paste buffer","Paste Items":"Paste Items","Paste items from the copy/paste buffer":"Paste items from the copy/paste buffer","Cannot paste into the Workspace root":"Cannot paste into the Workspace root","Open With":"Open With","Loading ":"Loading ",New:"New","Click on an item to make a selection, then use this menu to see what actions are available.":"Click on an item to make a selection, then use this menu to see what actions are available.",Actions:"Actions","Orion Content":"Orion Content"," is not supported in this file system":" is not supported in this file system","Create new content":"Create new content",Favorites:"Favorites","Import from HTTP...":"Import from HTTP...","File URL:":"File URL:","Copy a file from a URL and optionally unzip it":"Copy a file from a URL and optionally unzip it","Unzip *.zip files:":"Unzip *.zip files:","Extracted from:":"Extracted from:","Did not drop ${0}.  Folder drop is not supported in this browser.":"Did not drop ${0}.  Folder drop is not supported in this browser.","You cannot copy files directly into the workspace.  Create a folder first.":"You cannot copy files directly into the workspace.  Create a folder first.","Unzip ${0}?":"Unzip ${0}?"}),define("orion/navigate/nls/messages",["orion/i18n!orion/navigate/nls/messages","orion/navigate/nls/root/messages"],function(e,t){var n={root:t};return Object.keys(e).forEach(function(t){typeof n[t]=="undefined"&&(n[t]=e[t])}),n}),define("orion/fileClient",["i18n!orion/navigate/nls/messages","orion/Deferred","orion/i18nUtil"],function(e,t,n){function r(t,n,r){if(!t[n])throw n+e[" is not supported in this file system"];return t[n].apply(t,r)}function i(n,s,o,u){if(!n.readBlob)throw e["source file service does not support binary read"];if(!o.writeBlob)throw e["target file service does not support binary write"];if(s[s.length-1]!=="/")return r(n,"readBlob",[s]).then(function(e){return r(o,"writeBlob",[u,e])});var a=u.substring(0,u.length-1),f=decodeURIComponent(a.substring(a.lastIndexOf("/")+1)),l=a.substring(0,a.lastIndexOf("/")+1);return r(o,"createFolder",[l,f]).then(function(){return},function(){return}).then(function(){return r(n,"fetchChildren",[s]).then(function(e){var r=[];for(var s=0;s<e.length;++s){var a=e[s].Location,f=a;e[s].Directory&&(f=a.substring(0,a.length-1));var l=decodeURIComponent(f.substring(f.lastIndexOf("/")+1)),c=u+encodeURIComponent(l);e[s].Directory&&(c+="/"),r[s]=i(n,a,o,c)}return t.all(r)})})}function s(r,i){function c(n){var r=new t;return r.reject(e["No Matching FileService for location:"]+n),r}var s=r.getServiceReferences("orion.core.file"),o=s;if(i){o=[];for(var u=0;u<s.length;++u)i(s[u])&&o.push(s[u])}var a=[],f=[],l=[],h=[],p={fetchChildren:function(){var e=new t;return e.resolve(h),e},createWorkspace:function(){var n=new t;return n.reject(e["no file service"]),n},loadWorkspaces:function(){var n=new t;return n.reject(e["no file service"]),n},loadWorkspace:function(n){var r=new t;return window.setTimeout(function(){r.resolve({Directory:!0,Length:0,LocalTimeStamp:0,Name:e["File Servers"],Location:"/",Children:h,ChildrenLocation:"/"})},100),r},search:c,createProject:c,createFolder:c,createFile:c,deleteFile:c,moveFile:c,copyFile:c,read:c,write:c};for(var d=0;d<o.length;++d){h[d]={Directory:!0,Length:0,LocalTimeStamp:0,Location:o[d].getProperty("top"),ChildrenLocation:o[d].getProperty("top"),Name:o[d].getProperty("Name")};var v=o[d].getProperty("pattern")||".*";v[0]!=="^"&&(v="^"+v),a[d]=new RegExp(v),f[d]=r.getService(o[d]),l[d]=o[d].getProperty("Name"),o[d].getProperty("NameKey")&&o[d].getProperty("nls")&&n.getMessageBundle(o[d].getProperty("nls")).then(function(e,t){h[e].Name=t[o[e].getProperty("NameKey")],l[e]=t[o[e].getProperty("NameKey")]}.bind(this,d))}this._getServiceIndex=function(t){if(t==="/")return-1;if(!t||t.length&&t.length===0)return f[0]?0:-1;for(var n=0;n<a.length;++n)if(a[n].test(t))return n;throw e["No Matching FileService for location:"]+t},this._getService=function(e){var t=this._getServiceIndex(e);return t===-1?p:f[t]},this._getServiceName=function(e){var t=this._getServiceIndex(e);return t===-1?p.Name:l[t]},this._getServiceRootURL=function(e){var t=this._getServiceIndex(e);return t===-1?p.Location:h[t].Location}}return s.prototype={getService:function(e){return this._getService(e)},fileServiceName:function(e){return this._getServiceName(e)},fileServiceRootURL:function(e){return this._getServiceRootURL(e)},fetchChildren:function(e){return r(this._getService(e),"fetchChildren",arguments)},createWorkspace:function(e){return r(this._getService(),"createWorkspace",arguments)},loadWorkspaces:function(){return r(this._getService(),"loadWorkspaces",arguments)},loadWorkspace:function(e){return r(this._getService(e),"loadWorkspace",arguments)},createProject:function(e,t,n,i){return r(this._getService(e),"createProject",arguments)},createFolder:function(e,t){return r(this._getService(e),"createFolder",arguments)},createFile:function(e,t){return r(this._getService(e),"createFile",arguments)},deleteFile:function(e){return r(this._getService(e),"deleteFile",arguments)},moveFile:function(e,t,n){var s=this._getService(e),o=this._getService(t);if(s===o)return r(s,"moveFile",arguments);var u=e[e.length-1]==="/",a=t;a[a.length-1]!=="/"&&(a+="/");if(n)a+=encodeURIComponent(n);else{var f=e;u&&(f=f.substring(0,f.length-1)),a+=f.substring(f.lastIndexOf("/")+1)}return u&&a[a.length-1]!=="/"&&(a+="/"),i(s,e,o,a).then(function(){return r(s,"deleteFile",[e])})},copyFile:function(e,t,n){var s=this._getService(e),o=this._getService(t);if(s===o)return r(s,"copyFile",arguments);var u=e[e.length-1]==="/",a=t;a[a.length-1]!=="/"&&(a+="/");if(n)a+=encodeURIComponent(n);else{var f=e;u&&(f=f.substring(0,f.length-1)),a+=f.substring(f.lastIndexOf("/")+1)}return u&&a[a.length-1]!=="/"&&(a+="/"),i(s,e,o,a)},read:function(e,t){return r(this._getService(e),"read",arguments)},write:function(e,t,n){return r(this._getService(e),"write",arguments)},remoteImport:function(e,t){return r(this._getService(e),"remoteImport",arguments)},remoteExport:function(e,t){return r(this._getService(e),"remoteExport",arguments)},search:function(e){return r(this._getService(e.resource),"search",arguments)}},s.prototype.constructor=s,{FileClient:s}}),define("orion/compare/nls/root/messages",{"Copy current change from right to left":"Copy current change from right to left","Switch to unified diff":"Switch to unified diff",Unified:"Unified","Switch to side by side diff":"Switch to side by side diff","Side by side":"Side by side","Generate link of the current diff":"Generate link of the current diff","Generate Link":"Generate Link","Next diff block":"Next diff block","Previous diff block":"Previous diff block","Next diff change":"Next diff change","Previous diff change":"Previous diff change","Copy the link URL:":"Copy the link URL:",Compare:"Compare","Open the compare page":"Open the compare page","fetching...":"fetching...","There are unsaved changes.":"There are unsaved changes.","ERROR: ":"ERROR: ","Compare...":"Compare...","files changed":" files changed",Location:"Location",Options:"Options","Sort by folders":"Sort by folders","Line 0 : Col 0":"Line 0 : Col 0","No Matching DiffService for location:":"No Matching DiffService for location:"}),define("orion/compare/nls/messages",["orion/i18n!orion/compare/nls/messages","orion/compare/nls/root/messages"],function(e,t){var n={root:t};return Object.keys(e).forEach(function(t){typeof n[t]=="undefined"&&(n[t]=e[t])}),n}),define("orion/compare/compareUtils",["orion/URITemplate"],function(e){var t=t||{};return t.compareUtils=t.compareUtils||{},t.compareUtils.lookUpMapper=function(e,t,n){var r=0;for(var i=0;i<e.length;i++){var s=e[i][t];s===0&&(s=1);if(n>=r&&n<r+s)return{mapperIndex:i,startFrom:r};if(i===e.length-1)break;r+=e[i][t]}return{mapperIndex:e.length-1,startFrom:r}},t.compareUtils.lookUpLineIndex=function(e,t,n){if(n===0)return 0;var r=0;for(var i=0;i<n;i++)r+=e[i][t];return r},t.compareUtils.updateMapper=function(e,n,r,i,s){if(i===s)return;if(i>0||s>0){var o=t.compareUtils.lookUpMapper(e,n,r);if(o.mapperIndex<0)return;if(i>0){var u=i,a=r-o.startFrom;for(var f=o.mapperIndex;f<e.length;f++){var l=e[f][n]-a;if(u<=l){e[f][n]-=u;break}e[f][n]-=l,u-=l,a=0}}s>0&&(e[o.mapperIndex][n]+=s)}},t.compareUtils.overlapMapper=function(e,t,n,r,i){var s=n+e[t]-1;return s<n&&(s=n),i<r&&(i=r),s<r||i<n?!1:!0},t.compareUtils.findFirstDiff=function(e,n,r,i){var s=0,o=undefined;for(var u=0;u<e.length;u++){if(s>i)break;if(t.compareUtils.overlapMapper(e[u],n,s,r,i)){o={mapperIndex:u,startFrom:s};if(e[u][2]!==0)break}s+=e[u][n]}return o},t.compareUtils.matchMapper=function(e,n,r,i){if(e.length===0)return r;var s=r+Math.round((i-r)/3),o=t.compareUtils.findFirstDiff(e,n,r,i),u=e[o.mapperIndex][n]===0?o.startFrom:o.startFrom+e[o.mapperIndex][n]-1,a=t.compareUtils.lookUpLineIndex(e,1-n,o.mapperIndex),f=o.startFrom-r;if(e[o.mapperIndex][2]===0)return a-f;if(s>=o.startFrom&&s<=u)return a-Math.round((i-r)/3);if(s<o.startFrom)return a-f;var l=e[o.mapperIndex][1-n]===0?a:a+e[o.mapperIndex][1-n]-1;return l-(u-r)},t.compareUtils.getMapperLineCount=function(e){var t=0;for(var n=0;n<e.length;n++)t+=Math.max(e[n][0],e[n][1]);return t},t.compareUtils.getAnnotationIndex=function(e,t){for(var n=0;n<e.length;n++)if(e[n][0]===t)return n;return-1},t.compareUtils.getAnnotationMapperIndex=function(e,t){return e[t][1]},t.compareUtils.getAnnotationIndexByMapper=function(e,t){for(var n=0;n<e.length;n++)if(e[n][1]===t)return{current:n,prev:n-1,next:n+1};return{current:-1,prev:-1,next:-1}},t.compareUtils.isMapperConflict=function(e,t){return t<0?!1:e[t][3]?e[t][3]===1:!1},t.compareUtils.mergeDiffBlocks=function(e,t,n,r,i,s){for(var o=0;o<t.length;o++){var u=t[o][0],a=t[o][1],f=n[a];if(f[0]>0){var l="";for(var c=0;c<f[0];c++){var h=r[f[2]-1+c];l=l+h.substring(i)+s}var p=e.getLineCount();u>=p&&(u=p-1);var d=e.getLineStart(u);e.setText(l,d,d)}}},t.compareUtils.generateCompareHref=function(t,n){var r=require.toUrl("compare/compare.html");n.conflict||(n.conflict=undefined),n.readonly||(n.readonly=undefined);var i=(new e(r+"#{,resource,params*}")).expand({resource:t,params:n});return i},t.compareUtils.generateCompareTreeHref=function(t,n){var r=require.toUrl("compare-tree/compare-tree.html"),i=(new e(r+"#{,resource,params*}")).expand({resource:t,params:n});return i},t.compareUtils}),define("text!orion/compare/compare-features.html",[],function(){return'<div id="topWidget_id" style="height:100%;width:100%;position:relative">\r\n	<div class="leftPanelLayout ">\r\n		<div class="titleContainer" id="left_title_id"></div>\r\n		<div class="compareEditorParent" id="left_editor_id"></div>\r\n		<div class="statusContainer" id="left_status_id"></div>\r\n	</div>\r\n	<div class="split compareSplitLayout"></div>\r\n	<div class="rightPanelLayout">\r\n		<div class="titleContainer" id="right_title_id"></div>\r\n		<div class="compareEditorParent"  id="right_editor_wrapper_id">\r\n			<div class="canvasContainer">\r\n				<canvas id="diff_canvas_id" class="compareCanvas" width="46" height="3000"></canvas>\r\n			</div>\r\n			<div class="compareEditorParentWithCanvas" id="right_editor_id"></div>\r\n		</div>\r\n		<div class="statusContainer" id="right_status_id"></div>\r\n	</div>\r\n</div>\r\n'}),define("orion/compare/compare-features",["i18n!orion/compare/nls/messages","orion/compare/compareUtils","orion/webui/littlelib","orion/webui/splitter","text!orion/compare/compare-features.html"],function(e,t,n,r,i){var s=s||{};return s.TwoWayCompareUIFactory=function(){function e(e){this._parentDivID=e.parentDivID,this._commandSpanId=e.commandSpanId,this._showTitle=e.showTitle,this._leftTitle=e.leftTitle,this._rightTitle=e.rightTitle,this._showLineStatus=e.showLineStatus}return e.prototype={_init:function(){var e=this._parentDivID+"_";this._topWidgetDiv=n.node("topWidget_id"),this._topWidgetDiv.id=e+"topWidget_id",this._leftEditorParentDiv=n.node("left_editor_id"),this._leftEditorParentDiv.id=e+"left_editor_id",this._rightEditorParentDiv=n.node("right_editor_id"),this._rightEditorParentDiv.id=e+"right_editor_id",this._rightEditorWrapperDiv=n.node("right_editor_wrapper_id"),this._rightEditorWrapperDiv.id=e+"right_editor_wrapper_id",this._leftTitleDiv=n.node("left_title_id"),this._leftTitleDiv.id=e+"left_title_id",this._rightTitleDiv=n.node("right_title_id"),this._rightTitleDiv.id=e+"right_title_id",this._leftStatusDiv=n.node("left_status_id"),this._leftStatusDiv.id=e+"left_status_id",this._rightStatusDiv=n.node("right_status_id"),this._rightStatusDiv.id=e+"right_status_id",this._diffCanvasDiv=n.node("diff_canvas_id"),this._diffCanvasDiv.id=e+"diff_canvas_id",this._splitterId=e+"orion_splitter",this._showTitle||(this._leftEditorParentDiv.style.top="0px",this._rightEditorWrapperDiv.style.top="0px",this._leftTitleDiv.style.height="0px",this._rightTitleDiv.style.height="0px"),this._showLineStatus||(this._leftEditorParentDiv.style.marginBottom="0px",this._rightEditorWrapperDiv.style.marginBottom="0px",this._leftStatusDiv.style.height="0px",this._rightStatusDiv.style.height="0px")},_createSplitter:function(){var e=n.$(".split",this._topWidgetDiv);e.id=this._splitterId;var t=n.$(".leftPanelLayout",this._topWidgetDiv),i=n.$(".rightPanelLayout",this._topWidgetDiv);e&&t&&i&&(this._splitter=new r.Splitter({node:e,sidePanel:t,mainPanel:i}))},buildUI:function(){n.node(this._parentDivID).innerHTML=i,this._init(),this._createSplitter()},destroy:function(){},getSplitter:function(){return this._splitter},isLeftPane:function(e){var t=n.$(".leftPanelLayout",this._topWidgetDiv);return t===e},getEditorParentDiv:function(e){return e?this._leftEditorParentDiv:this._rightEditorParentDiv},getTitleDiv:function(e){return e?this._leftTitleDiv:this._rightTitleDiv},getStatusDiv:function(e){return e?this._leftStatusDiv:this._rightStatusDiv},getCommandSpanId:function(){return this._commandSpanId},getDiffCanvasDiv:function(){return this._diffCanvasDiv}},e}(),s}),define("orion/compare/diff-parser",[],function(){var e=e||{};return e.DiffParser=function(){function n(t,n){this._lineDelimiter=t?t:e?"\r\n":"\n",this._diffLineDelimiter=n?n:this._lineDelimiter,this._DEBUG=!1}var e=navigator.platform.indexOf("Win")!==-1,t="\\ No newline at end of file";return n.prototype={_init:function(){this._oFileContents=[],this._diffContents=[],this._oBlocks=[],this._nBlocks=[],this._hunkRanges=[],this._lastToken=" ",this._deltaMap=[],this._nFileContents=[],this._oNewLineAtEnd=!0,this._nNewLineAtEnd=!0,this._diffContentIndex=1},setLineDelim:function(e){this._lineDelimiter=e,this._diffLineDelimiter=e},getDiffArray:function(){return{array:this._diffContents,index:this._diffContentIndex}},parse:function(e,t,n,r){this._init();if(t==="")return{outPutFile:e,mapper:[]};this._oFileContents=e===""?[]:e.split(this._lineDelimiter),this._diffContents=t.split(this._diffLineDelimiter);var i=this._diffContents.length;this._hunkRanges=[];for(var s=0;s<i;s++){var o=this._parseHunkRange(s);o&&this._hunkRanges.push(o)}if(0===this._hunkRanges.length)return{outPutFile:e,mapper:[]};if(this._DEBUG){console.log("***Diff contents: \n");for(var u=0;u<this._diffContents.length;u++)console.log(this._diffContents[u]);console.log("***Hunk ranges: \n"),console.log(JSON.stringify(this._hunkRanges))}for(var u=0;u<this._hunkRanges.length;u++)this._parseHunkBlock(u);return this._DEBUG&&(console.log("***Original Hunk range blocks: \n"),console.log(JSON.stringify(this._oBlocks)),console.log("***New Hunk range blocks: \n"),console.log(JSON.stringify(this._nBlocks))),this._buildMap(n),this._DEBUG&&(console.log("***New Line at end of file(original): \n"),console.log(JSON.stringify(this._oNewLineAtEnd)),console.log("***New Line at end of file(new): \n"),console.log(JSON.stringify(this._nNewLineAtEnd)),console.log("***Mapper: \n"),this._logMap(),console.log("***Total line number in original file: "+this._oFileContents.length)),(r===undefined||!r)&&this._buildNewFile(),this._DEBUG,{outPutFile:this._nFileContents.join(this._diffLineDelimiter),mapper:this._deltaMap}},_logMap:function(){for(var e=0;e<this._deltaMap.length;e++){console.log(JSON.stringify(this._deltaMap[e]));if(this._deltaMap[e][2]>0){console.log("    **Diff content on change/add: \n");for(var t=0;t<this._deltaMap[e][0];t++)console.log("    "+this._diffContents[this._deltaMap[e][2]+t-1])}}},_logNewFile:function(){for(var e=0;e<this._nFileContents.length;e++)console.log(this._nFileContents[e])},_createBlock:function(e,t,n,r){if(r===n&&e===" ")return;var i=[n,r-n,"s"];e==="-"?i[2]="r":e==="+"?i[2]="a":e==="c"&&(i[2]="c"),t.push(i)},_createMinusBlock:function(e,t,n){var r=this._oBlocks.length;r===0||e!==this._oBlocks[r-1][0]?(this._oBlocks.push([e===0?1:e,n]),this._nBlocks.push([t,0,-2])):this._oBlocks[r-1][1]=this._oBlocks[r-1][1]+n},_createPlusBlock:function(e,t,n,r){var i=this._nBlocks.length;i===0||t!==this._nBlocks[i-1][0]?(this._oBlocks.push([e===0?1:e,0]),this._nBlocks.push([t,n,r])):(this._nBlocks[i-1][1]=this._nBlocks[i-1][1]+n,this._nBlocks[i-1][2]=r)},_parseHunkBlock:function(e){var n=" ",r=this._hunkRanges[e][0]+1,i=e===this._hunkRanges.length-1?this._diffContents.length:this._hunkRanges[e+1][0],s=0,o=0,u=this._hunkRanges[e][1],a=this._hunkRanges[e][3],f=r;for(var l=r;l<i;l++){if(0===this._diffContents[l].length)continue;var c=this._diffContents[l][0];if(c==="\\")if(t===this._diffContents[l].substring(0,this._diffContents[l].length-1)||t===this._diffContents[l]){n==="-"?this._oNewLineAtEnd=!1:n===" "?(this._nNewLineAtEnd=!1,this._oNewLineAtEnd=!1):this._nNewLineAtEnd=!1,l>r&&this._diffContents[l-1][this._diffContents[l-1].length-1]==="\r"&&(this._diffContents[l-1]=this._diffContents[l-1].substring(0,this._diffContents[l-1].length-1));continue}switch(c){case"-":case"+":case" ":break;default:continue}if(n!==c){c==="+"&&(f=l);switch(n){case" ":u=this._hunkRanges[e][1]+s,a=this._hunkRanges[e][3]+o;break;case"-":this._createMinusBlock(u,a,this._hunkRanges[e][1]+s-u);break;case"+":this._createPlusBlock(u,a,this._hunkRanges[e][3]+o-a,f);break;default:}n=c}switch(c){case"-":s++;break;case"+":o++;break;case" ":s++,o++}}switch(n){case"-":this._createMinusBlock(u,a,this._hunkRanges[e][1]+s-u);break;case"+":this._createPlusBlock(u,a,this._hunkRanges[e][3]+o-a,f)}},_detectConflictes:function(e,t){if(e<0)return!1;var n=e+t;for(var r=e;r<n;r++){var i=this._diffContents[r];if(i.indexOf("<<<<<")>-1||i.indexOf(">>>>>")>-1)return!0}return!1},_buildMap:function(e){var t=this._oBlocks.length,n=this._oFileContents.length,r=0,i=1;for(var s=0;s<t;s++){var o=this._oBlocks[s][0]-i;o>0&&(this._deltaMap.push([o,o,0]),r+=o),e&&this._detectConflictes(this._nBlocks[s][2],this._nBlocks[s][1])?this._deltaMap.push([this._nBlocks[s][1],this._oBlocks[s][1],this._nBlocks[s][2]+1,1]):this._deltaMap.push([this._nBlocks[s][1],this._oBlocks[s][1],this._nBlocks[s][2]+1]),r+=this._oBlocks[s][1],i=this._oBlocks[s][0]+this._oBlocks[s][1]}0<n-i&&(this._deltaMap.push([n-i+1,n-i+1,0]),r+=n-i+1);if(r<n){var o=n-r,u=this._deltaMap[this._deltaMap.length-1];u[2]===0?(u[0]+=o,u[1]+=o):u[2]===-1?this._deltaMap.push([o,o,0]):this._nNewLineAtEnd===this._oNewLineAtEnd?this._deltaMap.push([o,o,0]):(this._nNewLineAtEnd&&(u[0]+=o),this._oNewLineAtEnd&&(u[1]+=o))}},_buildNewFile:function(){var e=1,t=!1,n=this._deltaMap.length;for(var r=0;r<n;r++){t=!1;if(this._deltaMap[r][2]===0){for(var i=0;i<this._deltaMap[r][0];i++)this._nFileContents.push(this._oFileContents[e+i-1]);t=!0}else if(this._deltaMap[r][2]>0)for(var i=0;i<this._deltaMap[r][0];i++)this._nFileContents.push(this._diffContents[this._deltaMap[r][2]+i-1].substring(1));e+=this._deltaMap[r][1]}this._nNewLineAtEnd&&!t&&this._nFileContents.push("")},_parseHRangeBody:function(e,t){if(0<e.indexOf(",")){var n=e.split(","),r=parseInt(n[0]),i=parseInt(n[1]);t.push(r>=0?r:1),t.push(i>=0?i:1)}else{var s=parseInt(e);t.push(s>=0?s:1),t.push(1)}},_parseHunkRange:function(e){var t=this._diffContents[e];if(8>t.length)return undefined;var n=t.substring(0,2);if("@@"!==n)return undefined;var r=t.substring(2),i=r.indexOf("@@");if(i<0)return undefined;var s=r.substring(0,i),o=s.indexOf("-"),u=s.indexOf("+");if(o<0||u<0)return undefined;var a=[e];if(o<u){var f=s.substring(o+1).split("+");this._parseHRangeBody(f[0],a),this._parseHRangeBody(f[1],a)}else f=s.substring(u+1).split("-"),this._parseHRangeBody(f[1],a),this._parseHRangeBody(f[0],a);return a}},n}(),e}),define("orion/treeModelIterator",[],function(){var e={};return e.TreeModelIterator=function(){function e(e,t){this.firstLevelChildren=e,this.reset(),this._init(t)}return e.prototype={_init:function(e){if(!e)return;this.isExpanded=e.isExpanded,this.isExpandable=e.isExpandable,this.forceExpandFunc=e.forceExpandFunc},topLevel:function(e){return e.parent?e.parent===this.root:!0},_expanded:function(e){if(!e)return!0;var t=e.children&&e.children.length>0;return this.isExpanded&&t&&(t=this.isExpanded(e)),t},_expandable:function(e){return e?this.isExpandable?this.isExpandable(e):!1:!0},_diveIn:function(e){return this._expanded(e)?(this.setCursor(e.children[0]),this.cursor()):null},_drillToLast:function(e){return this._expanded(e)?this._drillToLast(e.children[e.children.length-1]):e},_forward:function(e){if(!this._cursor)return null;var t=this._diveIn(this._cursor);if(!t){if(e&&this._expandable(this._cursor)&&this.forceExpandFunc){var n=this;return this.forceExpandFunc(this._cursor,"first",function(e){e&&n.setCursor(e)})}t=this._findSibling(this._cursor,!0),t&&this.setCursor(t)}return t},_backward:function(e){if(!this._cursor)return null;var t=this._findSibling(this._cursor,!1);t&&t!==this._cursor.parent&&(t=this._drillToLast(t));if(e&&t&&this._expandable(t)&&this.forceExpandFunc&&t!==this._cursor.parent){var n=this;return this.forceExpandFunc(t,"last",function(e){e&&n.setCursor(e)})}return t&&this.setCursor(t),t},_findSibling:function(e,t){var n=this.topLevel(e),r=n?this.firstLevelChildren:e.parent.children;for(var i=0;i<r.length;i++)if(r[i]===e)return i===0&&!t?n?null:e.parent:i===r.length-1&&t?n?null:this._findSibling(e.parent,t):t?r[i+1]:r[i-1];return null},_inParentChain:function(e,t){var n=e.parent;while(n){if(n===t)return!0;n=n.parent}return!1},_getTopLevelParent:function(e){if(this.topLevel(e))return e;var t=e.parent;while(t){if(this.topLevel(t))return t;t=t.parent}return null},_onCollapse:function(e){return this._expanded(e.parent)?e:this._onCollapse(e.parent)},_scan:function(e,t,n){this.setCursor(t);var r=[];r.push(t);for(;;){if(!this.iterate(e))break;r.push(this.cursor());if(n===this.cursor())return r}return r=[],null},setCursor:function(e){this._prevCursor=this._cursor,this._cursor=e},setTree:function(e){this.firstLevelChildren=e,this.firstLevelChildren.length>0&&(this.root=this.firstLevelChildren[0].parent)},scan:function(e,t){var n=this.cursor(),r=this._scan(!0,e,t);return r||(r=this._scan(!1,e,t)),this.setCursor(n),r},iterate:function(e,t){return e?this._forward(t):this._backward(t)},iterateOnTop:function(e,t){var n=this._findSibling(this._getTopLevelParent(this.cursor()),e);n?this.setCursor(n):t&&this.firstLevelChildren.length>0&&this.setCursor(e?this.firstLevelChildren[0]:this.firstLevelChildren[this.firstLevelChildren.length-1])},collapse:function(e){return this._cursor?this._inParentChain(this._cursor,e)?(this.setCursor(e),this._cursor):null:null},reset:function(){this._cursor=null,this._prevCursor=null,this.root=null,this.firstLevelChildren.length>0&&(this._cursor=this.firstLevelChildren[0],this.root=this.firstLevelChildren[0].parent)},cursorMoved:function(){return this._cursor!==this._prevCursor},cursor:function(){return this._cursor},prevCursor:function(){return this._prevCursor}},e}(),e}),define("orion/editor/i18n",{load:function(e,t,n,r){t.specified&&t.specified("orion/bootstrap")?t(["orion/i18n!"+e],function(e){n(e)}):n({})}}),define("orion/editor/nls/root/messages",{multipleAnnotations:"Multiple annotations:",line:"Line: ${0}",breakpoint:"Breakpoint",bookmark:"Bookmark",task:"Task",error:"Error",warning:"Warning",matchingSearch:"Matching Search",currentSearch:"Current Search",currentLine:"Current Line",matchingBracket:"Matching Bracket",currentBracket:"Current Bracket",Comment:"Comment","Flat outline":"Flat outline",incrementalFind:"Incremental find: ${0}",incrementalFindNotFound:"Incremental find: ${0} (not found)",find:"Find...",undo:"Undo",redo:"Redo",cancelMode:"Cancel Current Mode",findNext:"Find Next Occurrence",findPrevious:"Find Previous Occurrence",incrementalFindKey:"Incremental Find",indentLines:"Indent Lines",unindentLines:"Unindent Lines",moveLinesUp:"Move Lines Up",moveLinesDown:"Move Lines Down",copyLinesUp:"Copy Lines Up",copyLinesDown:"Copy Lines Down",deleteLines:"Delete Lines",gotoLine:"Goto Line...",gotoLinePrompty:"Goto Line:",nextAnnotation:"Next Annotation",prevAnnotation:"Previous Annotation",expand:"Expand",collapse:"Collapse",expandAll:"Expand All",collapseAll:"Collapse All",lastEdit:"Last Edit Location",toggleLineComment:"Toggle Line Comment",addBlockComment:"Add Block Comment",removeBlockComment:"Remove Block Comment",linkedModeEntered:"Linked Mode entered",linkedModeExited:"Linked Mode exited",syntaxError:"Syntax Error",contentAssist:"Content Assist",lineColumn:"Line ${0} : Col ${1}"}),define("orion/editor/nls/messages",["orion/editor/i18n!orion/editor/nls/messages","orion/editor/nls/root/messages"],function(e,t){var n={root:t};for(var r in e)e.hasOwnProperty(r)&&typeof n[r]=="undefined"&&(n[r]=e[r]);return n}),define("orion/editor/eventTarget",[],function(){function e(){}return e.addMixin=function(t){var n=e.prototype;for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r])},e.prototype={addEventListener:function(e,t,n){this._eventTypes||(this._eventTypes={});var r=this._eventTypes[e];r||(r=this._eventTypes[e]={level:0,listeners:[]});var i=r.listeners;i.push({listener:t,useCapture:n})},dispatchEvent:function(e){var t=e.type;this._dispatchEvent("pre"+t,e),this._dispatchEvent(t,e),this._dispatchEvent("post"+t,e)},_dispatchEvent:function(e,t){var n=this._eventTypes?this._eventTypes[e]:null;if(n){var r=n.listeners;try{n.level++;if(r)for(var i=0,s=r.length;i<s;i++)if(r[i]){var o=r[i].listener;typeof o=="function"?o.call(this,t):o.handleEvent&&typeof o.handleEvent=="function"&&o.handleEvent(t)}}finally{n.level--;if(n.compact&&n.level===0){for(var u=r.length-1;u>=0;u--)r[u]||r.splice(u,1);r.length===0&&delete this._eventTypes[e],n.compact=!1}}}},isListening:function(e){return this._eventTypes?this._eventTypes[e]!==undefined:!1},removeEventListener:function(e,t,n){if(!this._eventTypes)return;var r=this._eventTypes[e];if(r){var i=r.listeners;for(var s=0,o=i.length;s<o;s++){var u=i[s];if(u&&u.listener===t&&u.useCapture===n){r.level!==0?(i[s]=null,r.compact=!0):i.splice(s,1);break}}i.length===0&&delete this._eventTypes[e]}}},{EventTarget:e}}),define("orion/editor/annotations",["i18n!orion/editor/nls/messages","orion/editor/eventTarget"],function(e,t){function n(e,t,n){this.start=e,this.end=t,this._projectionModel=n,this.html=this._expandedHTML,this.style=this._expandedStyle,this.expanded=!0}function r(){}function s(t,n){var i=t.lastIndexOf("."),s=t.substring(i+1),o={title:e[s],style:{styleClass:"annotation "+s},html:"<div class='annotationHTML "+s+"'></div>",overviewStyle:{styleClass:"annotationOverview "+s}};n?o.lineStyle={styleClass:"annotationLine "+s}:o.rangeStyle={styleClass:"annotationRange "+s},r.registerType(t,o)}function o(){}function u(e){this._annotations=[];var t=this;this._listener={onChanged:function(e){t._onChanged(e)}},this.setTextModel(e)}function a(e,t){this._view=e,this._annotationModel=t;var n=this;this._listener={onDestroy:function(e){n._onDestroy(e)},onLineStyle:function(e){n._onLineStyle(e)},onChanged:function(e){n._onAnnotationModelChanged(e)}},e.addEventListener("Destroy",this._listener.onDestroy),e.addEventListener("postLineStyle",this._listener.onLineStyle),t.addEventListener("Changed",this._listener.onChanged)}n.prototype={_expandedHTML:"<div class='annotationHTML expanded'></div>",_expandedStyle:{styleClass:"annotation expanded"},_collapsedHTML:"<div class='annotationHTML collapsed'></div>",_collapsedStyle:{styleClass:"annotation collapsed"},collapse:function(){if(!this.expanded)return;this.expanded=!1,this.html=this._collapsedHTML,this.style=this._collapsedStyle;var e=this._projectionModel,t=e.getBaseModel();this._projection={start:t.getLineStart(t.getLineAtOffset(this.start)+1),end:t.getLineEnd(t.getLineAtOffset(this.end),!0)},e.addProjection(this._projection)},expand:function(){if(this.expanded)return;this.expanded=!0,this.html=this._expandedHTML,this.style=this._expandedStyle,this._projectionModel.removeProjection(this._projection)}},r.ANNOTATION_ERROR="orion.annotation.error",r.ANNOTATION_WARNING="orion.annotation.warning",r.ANNOTATION_TASK="orion.annotation.task",r.ANNOTATION_BREAKPOINT="orion.annotation.breakpoint",r.ANNOTATION_BOOKMARK="orion.annotation.bookmark",r.ANNOTATION_FOLDING="orion.annotation.folding",r.ANNOTATION_CURRENT_BRACKET="orion.annotation.currentBracket",r.ANNOTATION_MATCHING_BRACKET="orion.annotation.matchingBracket",r.ANNOTATION_CURRENT_LINE="orion.annotation.currentLine",r.ANNOTATION_CURRENT_SEARCH="orion.annotation.currentSearch",r.ANNOTATION_MATCHING_SEARCH="orion.annotation.matchingSearch",r.ANNOTATION_READ_OCCURRENCE="orion.annotation.readOccurrence",r.ANNOTATION_WRITE_OCCURRENCE="orion.annotation.writeOccurrence";var i={};return r.registerType=function(e,t){var n=t;return typeof n!="function"&&(n=function(e,t,n){this.start=e,this.end=t,n&&(this.title=n)},n.prototype=t),n.prototype.type=e,i[e]=n,e},r.createAnnotation=function(e,t,n,r){return new(this.getType(e))(t,n,r)},r.getType=function(e){return i[e]},s(r.ANNOTATION_ERROR),s(r.ANNOTATION_WARNING),s(r.ANNOTATION_TASK),s(r.ANNOTATION_BREAKPOINT),s(r.ANNOTATION_BOOKMARK),s(r.ANNOTATION_CURRENT_BRACKET),s(r.ANNOTATION_MATCHING_BRACKET),s(r.ANNOTATION_CURRENT_SEARCH),s(r.ANNOTATION_MATCHING_SEARCH),s(r.ANNOTATION_READ_OCCURRENCE),s(r.ANNOTATION_WRITE_OCCURRENCE),s(r.ANNOTATION_CURRENT_LINE,!0),r.registerType(r.ANNOTATION_FOLDING,n),o.addMixin=function(e){var t=o.prototype;for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},o.prototype={addAnnotationType:function(e){this._annotationTypes||(this._annotationTypes=[]),this._annotationTypes.push(e)},getAnnotationTypePriority:function(e){if(this._annotationTypes)for(var t=0;t<this._annotationTypes.length;t++)if(this._annotationTypes[t]===e)return t+1;return 0},getAnnotationsByType:function(e,t,n){var r=e.getAnnotations(t,n),i,s=[];while(r.hasNext()){i=r.next();var o=this.getAnnotationTypePriority(i.type);if(o===0)continue;s.push(i)}var u=this;return s.sort(function(e,t){return u.getAnnotationTypePriority(e.type)-u.getAnnotationTypePriority(t.type)}),s},isAnnotationTypeVisible:function(e){return this.getAnnotationTypePriority(e)!==0},removeAnnotationType:function(e){if(!this._annotationTypes)return;for(var t=0;t<this._annotationTypes.length;t++)if(this._annotationTypes[t]===e){this._annotationTypes.splice(t,1);break}}},u.prototype={addAnnotation:function(e){if(!e)return;var t=this._annotations,n=this._binarySearch(t,e.start);t.splice(n,0,e);var r={type:"Changed",added:[e],removed:[],changed:[]};this.onChanged(r)},getTextModel:function(){return this._model},getAnnotations:function(e,t){var n=this._annotations,r,i=0,s=function(){while(i<n.length){var r=n[i++];if(e===r.start||(e>r.start?e<r.end:r.start<t))return r;if(r.start>=t)break}return null};return r=s(),{next:function(){var e=r;return e&&(r=s()),e},hasNext:function(){return r!==null}}},modifyAnnotation:function(e){if(!e)return;var t=this._getAnnotationIndex(e);if(t<0)return;var n={type:"Changed",added:[],removed:[],changed:[e]};this.onChanged(n)},onChanged:function(e){return this.dispatchEvent(e)},removeAnnotations:function(e){var t=this._annotations,n,r;if(e){n=[];for(r=t.length-1;r>=0;r--){var i=t[r];i.type===e&&t.splice(r,1),n.splice(0,0,i)}}else n=t,t=[];var s={type:"Changed",removed:n,added:[],changed:[]};this.onChanged(s)},removeAnnotation:function(e){if(!e)return;var t=this._getAnnotationIndex(e);if(t<0)return;var n={type:"Changed",removed:this._annotations.splice(t,1),added:[],changed:[]};this.onChanged(n)},replaceAnnotations:function(e,t){var n=this._annotations,r,i,s,o=[];if(e)for(r=e.length-1;r>=0;r--){s=e[r],i=this._getAnnotationIndex(s);if(i<0)continue;n.splice(i,1),o.splice(0,0,s)}t||(t=[]);for(r=0;r<t.length;r++)s=t[r],i=this._binarySearch(n,s.start),n.splice(i,0,s);var u={type:"Changed",removed:o,added:t,changed:[]};this.onChanged(u)},setTextModel:function(e){this._model&&this._model.removeEventListener("Changed",this._listener.onChanged),this._model=e,this._model&&this._model.addEventListener("Changed",this._listener.onChanged)},_binarySearch:function(e,t){var n=e.length,r=-1,i;while(n-r>1)i=Math.floor((n+r)/2),t<=e[i].start?n=i:r=i;return n},_getAnnotationIndex:function(e){var t=this._annotations,n=this._binarySearch(t,e.start);while(n<t.length&&t[n].start===e.start){if(t[n]===e)return n;n++}return-1},_onChanged:function(e){var t=e.start,n=e.addedCharCount,r=e.removedCharCount,i=this._annotations,s=t+r,o=0;if(!(0<=o&&o<i.length))return;var u={type:"Changed",added:[],removed:[],changed:[],textModelChangedEvent:e},a=n-r,f;for(f=o;f<i.length;f++){var l=i[f];l.start>=s?(l.start+=a,l.end+=a,u.changed.push(l)):l.end<=t||(l.start<t&&s<l.end?(l.end+=a,u.changed.push(l)):(i.splice(f,1),u.removed.push(l),f--))}(u.added.length>0||u.removed.length>0||u.changed.length>0)&&this.onChanged(u)}},t.EventTarget.addMixin(u.prototype),a.prototype={destroy:function(){var e=this._view;e&&(e.removeEventListener("Destroy",this._listener.onDestroy),e.removeEventListener("LineStyle",this._listener.onLineStyle),this.view=null);var t=this._annotationModel;t&&(t.removeEventListener("Changed",this._listener.onChanged),t=null)},_mergeStyle:function(e,t){if(t){e||(e={}),e.styleClass&&t.styleClass&&e.styleClass!==t.styleClass?e.styleClass+=" "+t.styleClass:e.styleClass=t.styleClass;var n;if(t.style){e.style||(e.style={});for(n in t.style)e.style[n]||(e.style[n]=t.style[n])}if(t.attributes){e.attributes||(e.attributes={});for(n in t.attributes)e.attributes[n]||(e.attributes[n]=t.attributes[n])}}return e},_mergeStyleRanges:function(e,t){e||(e=[]);var n,r;for(r=0;r<e.length&&t;r++){var i=e[r];if(t.end<=i.start)break;if(t.start>=i.end)continue;n=this._mergeStyle({},i.style),n=this._mergeStyle(n,t.style);var s=[];s.push(r,1),t.start<i.start&&s.push({start:t.start,end:i.start,style:t.style}),t.start>i.start&&s.push({start:i.start,end:t.start,style:i.style}),s.push({start:Math.max(i.start,t.start),end:Math.min(i.end,t.end),style:n}),t.end<i.end&&s.push({start:t.end,end:i.end,style:i.style}),t.end>i.end?t={start:i.end,end:t.end,style:t.style}:t=null,Array.prototype.splice.apply(e,s)}return t&&(n=this._mergeStyle({},t.style),e.splice(r,0,{start:t.start,end:t.end,style:n})),e},_onAnnotationModelChanged:function(e){function i(e){for(var i=0;i<e.length;i++){if(!n.isAnnotationTypeVisible(e[i].type))continue;var s=e[i].start,o=e[i].end;r.getBaseModel&&(s=r.mapOffset(s,!0),o=r.mapOffset(o,!0)),s!==-1&&o!==-1&&t.redrawRange(s,o)}}if(e.textModelChangedEvent)return;var t=this._view;if(!t)return;var n=this,r=t.getModel();i(e.added),i(e.removed),i(e.changed)},_onDestroy:function(e){this.destroy()},_onLineStyle:function(e){var t=this._annotationModel,n=e.textView.getModel(),r=t.getTextModel(),i=e.lineStart,s=e.lineStart+e.lineText.length;r!==n&&(i=n.mapOffset(i),s=n.mapOffset(s));var o=t.getAnnotations(i,s);while(o.hasNext()){var u=o.next();if(!this.isAnnotationTypeVisible(u.type))continue;if(u.rangeStyle){var a=u.start,f=u.end;r!==n&&(a=n.mapOffset(a,!0),f=n.mapOffset(f,!0)),e.ranges=this._mergeStyleRanges(e.ranges,{start:a,end:f,style:u.rangeStyle})}u.lineStyle&&(e.style=this._mergeStyle({},e.style),e.style=this._mergeStyle(e.style,u.lineStyle))}}},o.addMixin(a.prototype),{FoldingAnnotation:n,AnnotationType:r,AnnotationTypeList:o,AnnotationModel:u,AnnotationStyler:a}});var JsDiff=function(){function e(e){return{newPos:e.newPos,components:e.components.slice(0)}}function t(e){var t=[];for(var n=0;n<e.length;n++)e[n]&&t.push(e[n]);return t}function n(e){var t=e;return t=t.replace(/&/g,"&amp;"),t=t.replace(/</g,"&lt;"),t=t.replace(/>/g,"&gt;"),t=t.replace(/"/g,"&quot;"),t}var r=function(e){this.ignoreWhitespace=e};r.prototype={diff:function(t,n){if(n==t)return[{value:n}];if(!n)return[{value:t,removed:!0}];if(!t)return[{value:n,added:!0}];n=this.tokenize(n),t=this.tokenize(t);var r=n.length,i=t.length,s=r+i,o=[{newPos:-1,components:[]}],u=this.extractCommon(o[0],n,t,0);if(o[0].newPos+1>=r&&u+1>=i)return o[0].components;for(var a=1;a<=s;a++)for(var f=-1*a;f<=a;f+=2){var l,c=o[f-1],h=o[f+1];u=(h?h.newPos:0)-f,c&&(o[f-1]=undefined);var p=c&&c.newPos+1<r,d=h&&0<=u&&u<i;if(!p&&!d){o[f]=undefined;continue}!p||d&&c.newPos<h.newPos?(l=e(h),this.pushComponent(l.components,t[u],undefined,!0)):(l=e(c),l.newPos++,this.pushComponent(l.components,n[l.newPos],!0,undefined));var u=this.extractCommon(l,n,t,f);if(l.newPos+1>=r&&u+1>=i)return l.components;o[f]=l}},pushComponent:function(e,t,n,r){var i=e[e.length-1];i&&i.added===n&&i.removed===r?e[e.length-1]={value:this.join(i.value,t),added:n,removed:r}:e.push({value:t,added:n,removed:r})},extractCommon:function(e,t,n,r){var i=t.length,s=n.length,o=e.newPos,u=o-r;while(o+1<i&&u+1<s&&this.equals(t[o+1],n[u+1]))o++,u++,this.pushComponent(e.components,t[o],undefined,undefined);return e.newPos=o,u},equals:function(e,t){var n=/\S/;return this.ignoreWhitespace&&!n.test(e)&&!n.test(t)?!0:e==t},join:function(e,t){return e+t},tokenize:function(e){return e}};var i=new r,s=new r(!1);s.tokenize=function(e){return t(e.split(/(\s+|\b)/))};var o=new r(!0);o.tokenize=function(e){return t(e.split(/([{}:;,]|\s+)/))};var u=new r;return u.tokenize=function(e){return e.split(/^/m)},{diffChars:function(e,t){return i.diff(e,t)},diffWords:function(e,t){return s.diff(e,t)},diffLines:function(e,t){return u.diff(e,t)},diffCss:function(e,t){return o.diff(e,t)},createPatch:function(e,t,n,r,i){var s=[];s.push("Index: "+e),s.push("==================================================================="),s.push("--- "+e+"	"+r),s.push("+++ "+e+"	"+i);var o=u.diff(t,n);o.push({value:"",lines:[]});var a=0,f=0,l=[],c=1,h=1;for(var p=0;p<o.length;p++){var d=o[p],v=d.lines||d.value.replace(/\n$/,"").split("\n");d.lines=v;if(d.added||d.removed){if(!a){var m=o[p-1];a=c,f=h,m&&(l.push.apply(l,m.lines.slice(-4).map(function(e){return" "+e})),a-=4,f-=4)}l.push.apply(l,v.map(function(e){return(d.added?"+":"-")+e})),d.added?h+=v.length:c+=v.length}else{if(a)if(v.length<=8&&p<o.length-1)l.push.apply(l,v.map(function(e){return" "+e}));else{var g=Math.min(v.length,4);s.push("@@ -"+a+","+(c-a+g)+" +"+f+","+(h-f+g)+" @@"),s.push.apply(s,l),s.push.apply(s,v.slice(0,g).map(function(e){return" "+e})),a=0,f=0,l=[]}c+=v.length,h+=v.length}}return o.length>1&&!/\n$/.test(o[o.length-2].value)&&s.push("\\ No newline at end of file\n"),s.join("\n")},convertChangesToXML:function(e){var t=[];for(var r=0;r<e.length;r++){var i=e[r];i.added?t.push("<ins>"):i.removed&&t.push("<del>"),t.push(n(i.value)),i.added?t.push("</ins>"):i.removed&&t.push("</del>")}return t.join("")}}}();typeof module!="undefined"&&(module.exports=JsDiff),typeof define=="function"&&define.amd&&define("jsdiff/diff",[],function(){return JsDiff}),define("orion/compare/jsdiffAdapter",["jsdiff/diff"],function(e){var t=t||{};return t.JSDiffAdapter=function(){function t(){}return t.prototype={adapt:function(t,n,r){r||(r="\n");var i=t.split(r),s=n.split(r),o=i[i.length-1]==="",u=s[s.length-1]==="",a=e.diffLines(t,n),f=[],l=[],c=0,h=0,p=-1,d=0,v=!0;for(var m=0;m<a.length;m++){var g=a[m],y=g.lines||g.value.split(r),b=y.length,w=0;y.length>1&&y[y.length-1]===""&&b--,b>1&&!v&&y[0]===""&&(b--,w++),g.lines=y;if(!g.added&&!g.removed){if(c||h)f.push([c,h,p]),c=0,h=0,p=-1,d+=h;f.push([b,b,0]),d+=b}else if(g.added){p===-1&&(p=l.length+1),c+=b;for(var E=w;E<b+w;E++)l.push(g.lines[E])}else h+=b;v=!1,y.length>1&&y[y.length-1]===""&&(v=!0)}if(c||h)f.push([c,h,p]),d+=h;if(d<i.length&&i.length>1){var S=f[f.length-1];S[2]===0?(S[0]+=1,S[1]+=1):S[2]===-1?f.push([1,1,0]):o===u?f.push([1,1,0]):(u&&(S[0]+=1),o&&(S[1]+=1))}return{mapper:f,changContents:{array:l,index:0}}},adaptCharDiff:function(t,n,r){var i=r?e.diffWords(t,n):e.diffChars(t,n),s=[],o=0,u=0,a=0,f=0;for(var l=0;l<i.length;l++){var c=i[l];if(!c.added&&!c.removed){if(a>0||f>0)s.push([u,u+a,o,o+f]),u+=a,o+=f,a=0,f=0;u+=c.value.length,o+=c.value.length}else c.added?a+=c.value.length:f+=c.value.length}return(a>0||f>0)&&s.push([u,u+a,o,o+f]),s}},t}(),t}),define("orion/compare/diffTreeNavigator",["orion/treeModelIterator","orion/compare/compareUtils","orion/editor/annotations","orion/compare/jsdiffAdapter"],function(e,t,n,r){var i={},s={};return i.DiffTreeNavigator=function(){function i(e,t,n,r,i,s){this._root={type:"root",children:[]},this._initialized=!1,this.initAll(e,t,n,r,i,s)}s.ANNO_DIFF_ADDED_BLOCK="orion.annotation.diff.addedBlock",s.ANNO_DIFF_CURRENT_ADDED_BLOCK="orion.annotation.diff.currentAddedBlock",s.ANNO_DIFF_DELETED_BLOCK="orion.annotation.diff.deletedBlock",s.ANNO_DIFF_CURRENT_DELETED_BLOCK="orion.annotation.diff.currentDeletedBlock",s.ANNO_DIFF_BLOCK_TOPONLY="orion.annotation.diff.blockTop",s.ANNO_DIFF_CURRENT_BLOCK_TOPONLY="orion.annotation.diff.currentBlockTop",s.ANNO_DIFF_BLOCK_CONFLICT="orion.annotation.diff.blockConflict",s.ANNO_DIFF_CURRENT_BLOCK_CONFLICT="orion.annotation.diff.currentBlockConflict",s.ANNO_DIFF_ADDED_WORD="orion.annotation.diff.addedWord",s.ANNO_DIFF_CURRENT_ADDED_WORD="orion.annotation.diff.currentAddedWord",s.ANNO_DIFF_DELETED_WORD="orion.annotation.diff.deletedWord",s.ANNO_DIFF_CURRENT_DELETED_WORD="orion.annotation.diff.currentDeletedWord",s.ANNO_DIFF_EMPTY_DELETED_WORD_LEFT="orion.annotation.diff.emptyDeletedWordLeft",s.ANNO_DIFF_EMPTY_DELETED_WORD_RIGHT="orion.annotation.diff.emptyDeletedWordRight",s.ANNO_DIFF_EMPTY_ADDED_WORD_LEFT="orion.annotation.diff.emptyAddedWordLeft",s.ANNO_DIFF_EMPTY_ADDED_WORD_RIGHT="orion.annotation.diff.emptyAddedWordRight",n.AnnotationType.registerType(s.ANNO_DIFF_ADDED_BLOCK,{title:"",html:"",lineStyle:{styleClass:"annotationLine addedBlockDiff"}}),n.AnnotationType.registerType(s.ANNO_DIFF_CURRENT_ADDED_BLOCK,{title:"",html:"",lineStyle:{styleClass:"annotationLine currentAddedBlockDiff"}}),n.AnnotationType.registerType(s.ANNO_DIFF_DELETED_BLOCK,{title:"",html:"",lineStyle:{styleClass:"annotationLine deletedBlockDiff"}}),n.AnnotationType.registerType(s.ANNO_DIFF_CURRENT_DELETED_BLOCK,{title:"",html:"",lineStyle:{styleClass:"annotationLine currentDeletedBlockDiff"}}),n.AnnotationType.registerType(s.ANNO_DIFF_BLOCK_TOPONLY,{title:"",html:"",lineStyle:{styleClass:"annotationLine blockDiffTopOnly"}}),n.AnnotationType.registerType(s.ANNO_DIFF_CURRENT_BLOCK_TOPONLY,{title:"",html:"",lineStyle:{styleClass:"annotationLine currentBlockDiffTopOnly"}}),n.AnnotationType.registerType(s.ANNO_DIFF_BLOCK_CONFLICT,{title:"",html:"",lineStyle:{styleClass:"annotationLine blockDiffConflict"}}),n.AnnotationType.registerType(s.ANNO_DIFF_CURRENT_BLOCK_CONFLICT,{title:"",html:"",lineStyle:{styleClass:"annotationLine currentBlockDiffConflict"}}),n.AnnotationType.registerType(s.ANNO_DIFF_ADDED_WORD,{title:"word added",html:"",rangeStyle:{styleClass:"annotationRange addedWordDiff"}}),n.AnnotationType.registerType(s.ANNO_DIFF_CURRENT_ADDED_WORD,{title:"",html:"",rangeStyle:{styleClass:"annotationRange currentAddedWordDiff"}}),n.AnnotationType.registerType(s.ANNO_DIFF_DELETED_WORD,{title:"word deleted",html:"",rangeStyle:{styleClass:"annotationRange deletedWordDiff"}}),n.AnnotationType.registerType(s.ANNO_DIFF_CURRENT_DELETED_WORD,{title:"",html:"",rangeStyle:{styleClass:"annotationRange currentDeletedWordDiff"}}),n.AnnotationType.registerType(s.ANNO_DIFF_EMPTY_DELETED_WORD_LEFT,{title:"",html:"",rangeStyle:{styleClass:"annotationRange emptyDeletedWordDiffLeft"}}),n.AnnotationType.registerType(s.ANNO_DIFF_EMPTY_DELETED_WORD_RIGHT,{title:"",html:"",rangeStyle:{styleClass:"annotationRange emptyDeletedWordDiffRight"}}),n.AnnotationType.registerType(s.ANNO_DIFF_EMPTY_ADDED_WORD_LEFT,{title:"",html:"",rangeStyle:{styleClass:"annotationRange emptyAddedWordDiffLeft"}}),n.AnnotationType.registerType(s.ANNO_DIFF_EMPTY_ADDED_WORD_RIGHT,{title:"",html:"",rangeStyle:{styleClass:"annotationRange emptyAddedWordDiffRight"}});var o=5e3;return i.prototype={initAll:function(e,t,n,r,i,s,o){e?this._charOrWordDiff=e:this._charOrWordDiff="word",t&&(this._initialized=!0),this.editorWrapper=[{editor:t,diffFeeder:r},{editor:n,diffFeeder:i}],this._curveRuler=o,this._overviewRuler=s,this._overviewRuler&&this._overviewRuler.setDiffNavigator(this)},initMapper:function(e){if(e)for(var t=0;t<this.editorWrapper.length;t++)this.editorWrapper[t].diffFeeder.init(this.editorWrapper[t].editor.getTextView().getModel(),e)},destroy:function(){this.initAll(this._charOrWordDiff)},renderAnnotations:function(){var t;for(t=0;t<this.editorWrapper.length;t++){this.editorWrapper[t].annoTypes=[],this.editorWrapper[t].diffFeeder.getBlockAnnoTypes(this.editorWrapper[t].annoTypes),this.editorWrapper[t].diffFeeder.getWordAnnoTypes(this.editorWrapper[t].annoTypes);for(var n=0;n<this.editorWrapper[t].annoTypes.length;n++)this.editorWrapper[t].annoTypes[n].current&&this.editorWrapper[t].editor.getAnnotationStyler().addAnnotationType(this.editorWrapper[t].annoTypes[n].current),this.editorWrapper[t].annoTypes[n].normal&&this.editorWrapper[t].editor.getAnnotationStyler().addAnnotationType(this.editorWrapper[t].annoTypes[n].normal)}this._root.children=[];var i=this.editorWrapper[0].diffFeeder.getDiffBlocks();if(!i||i.length===0){this.replaceAllAnnotations(!0,0,"block",!1,[]),this.replaceAllAnnotations(!0,1,"block",!1,[]),this.replaceAllAnnotations(!0,0,"word",!1,[]),this.replaceAllAnnotations(!0,1,"word",!1,[]),this.replaceAllAnnotations(!0,0,"block",!0,[]),this.replaceAllAnnotations(!0,1,"block",!0,[]),this.replaceAllAnnotations(!0,0,"word",!0,[]),this.replaceAllAnnotations(!0,1,"word",!0,[]);return}var s=new r.JSDiffAdapter;for(t=0;t<i.length;t++){var o=this.generatePairBlockAnnotations(this._root,t);this._root.children.push(o);var u=this.generatePairWordAnnotations(o,t,s);u&&(o.children=u)}this.replaceAllAnnotations(!1,0,"block",!0),this.replaceAllAnnotations(!1,1,"block",!0),this.replaceAllAnnotations(!1,0,"word",!0),this.replaceAllAnnotations(!1,1,"word",!0),this.iterator=new e.TreeModelIterator(this._root.children)},replaceAllAnnotations:function(e,t,n,r,i){if(!this.editorWrapper[t].annoTypes)return;for(var s=0;s<this.editorWrapper[t].annoTypes.length;s++)this.editorWrapper[t].annoTypes[s].type===n&&this.replaceDiffAnnotations(this.editorWrapper[t].editor,i?i:this.editorWrapper[t].annoTypes[s].list,r?this.editorWrapper[t].annoTypes[s].normal:this.editorWrapper[t].annoTypes[s].current,e)},getMapper:function(){return this.editorWrapper[0].diffFeeder.getMapper()},getFeeder:function(e){return e?this.editorWrapper[1].diffFeeder:this.editorWrapper[0].diffFeeder},iterateOnBlock:function(e,t){if(!this.iterator)return;this.iterator.iterateOnTop(e,t),this.updateCurrentAnnotation(!0)},iterateOnChange:function(e){if(!this.iterator)return;this.iterator.iterate(e);var t=this.iterator.cursor();t.type==="block"&&t.children&&t.children.length>0&&this.iterator.iterate(e),this.updateCurrentAnnotation(!0)},gotoBlock:function(e,t){if(!this.iterator)return;if(e<0||e>=this._root.children.length||this._root.children.length===0)e=0;t!==undefined&&t>=0&&this._root.children[e].children&&t<this._root.children[e].children.length?this.iterator.setCursor(this._root.children[e].children[t]):this.iterator.setCursor(this._root.children[e]),this.updateCurrentAnnotation(!1),this._positionDiffBlock()},_hitDiffAnnotation:function(e,t,n){if(n!==this.editorWrapper[e].editor.getTextView())return;for(var r=0;r<this._root.children.length;r++){var i=this._root.children[r],s=e===0?i.oldA:i.newA;if(t>=s.start&&t<=s.end){var o=i;if(i.children&&i.children.length>0)for(var u=0;u<i.children.length;u++){var a=i.children[u],f=e===0?a.oldA:a.newA;if(t>=f.start&&t<=f.end){o=a;break}}return o}}return null},gotoChange:function(e,t){for(var n=0;n<this.editorWrapper.length;n++){var r=this._hitDiffAnnotation(n,e,t);if(r)return this.iterator.setCursor(r),this.updateCurrentAnnotation(!1,t),!0}return!1},getCurrentBlockIndex:function(){if(!this.iterator)return-1;var e=this.iterator.cursor();return e?e.type==="block"?e.index:e.parent.index:-1},getCurrentPosition:function(){if(!this.iterator)return{};var e=this.iterator.cursor();return e.type==="block"?{block:e.index+1}:{block:e.parent.index+1,change:e.index+1}},getCurrentMapperIndex:function(){var e=this.getCurrentBlockIndex();e<0&&(e=0);var t=this.getFeeder().getDiffBlocks();return!t||t.length===0?-1:(e>t.length-1&&(e=0),t[e][1])},replaceDiffAnnotations:function(e,t,n,r){if(!t||!n)return;var i=e.getAnnotationModel();if(!i)return;var s=i.getAnnotations(0,i.getTextModel().getCharCount()),o=[];while(r&&s.hasNext()){var u=s.next();u.type===n&&o.push(u)}i.replaceAnnotations(o,t)},updateCurrentAnnotation:function(e,t){this.replaceAllAnnotations(!0,0,"block",!1,[]),this.replaceAllAnnotations(!0,1,"block",!1,[]),this.replaceAllAnnotations(!0,0,"word",!1,[]),this.replaceAllAnnotations(!0,1,"word",!1,[]);if(!this.iterator)return;var r=this.iterator.cursor();if(!r)return;var i,s,o={start:r.oldA.start,end:r.oldA.end},u={start:r.newA.start,end:r.newA.end};r.type==="word"?(i=this.editorWrapper[0].diffFeeder.getCurrentWordAnnoType(o,this.editorWrapper[0].editor.getTextView().getModel()),s=this.editorWrapper[1].diffFeeder.getCurrentWordAnnoType(u,this.editorWrapper[1].editor.getTextView().getModel())):(i=this.editorWrapper[0].diffFeeder.getCurrentBlockAnnoType(r.index),s=this.editorWrapper[1].diffFeeder.getCurrentBlockAnnoType(r.index)),i&&this.replaceDiffAnnotations(this.editorWrapper[0].editor,[new(n.AnnotationType.getType(i.current))(o.start,o.end)],i,!0),s&&this.replaceDiffAnnotations(this.editorWrapper[1].editor,[new(n.AnnotationType.getType(s.current))(u.start,u.end)],s,!0),e?(this.autoSelecting=!0,this.editorWrapper[0].editor.setSelection(r.oldA.start,r.oldA.end,!0),this.editorWrapper[1].editor.setSelection(r.newA.start,r.newA.end,!0),this.autoSelecting=!1):t&&(this.autoSelecting=!0,t!==this.editorWrapper[0].editor.getTextView()&&this.editorWrapper[0].editor.setSelection(r.oldA.start,r.oldA.end,!0),t!==this.editorWrapper[1].editor.getTextView()&&this.editorWrapper[1].editor.setSelection(r.newA.start,r.newA.end,!0),this.autoSelecting=!1)},generatePairBlockAnnotations:function(e,t){var n=this.generateBlockDiffAnnotations(0,t),r=this.generateBlockDiffAnnotations(1,t);return{parent:e,index:t,type:"block",oldA:n,newA:r}},generatePairWordAnnotations:function(e,t,n){var r=this.editorWrapper[0].diffFeeder.getTextOnBlock(t),i=this.editorWrapper[1].diffFeeder.getTextOnBlock(t),s=null,u=0,a=0;if(!(r&&i&&r.text&&i.text&&r.text.length<=o&&i.text.length<=o))return null;s=n.adaptCharDiff(r.text,i.text,this._charOrWordDiff==="word"),a=i.start,u=r.start;var f=[],l=[];this.generateWordDiffAnnotations(0,f,u,s,2,3),this.generateWordDiffAnnotations(1,l,a,s,0,1);var c=[];for(var h=0;h<f.length;h++)c.push({parent:e,index:h,type:"word",oldA:f[h],newA:l[h]});return c},getAnnoModelList:function(e,t,n){for(var r=0;r<this.editorWrapper[e].annoTypes.length;r++)if(this.editorWrapper[e].annoTypes[r].type===t&&this.editorWrapper[e].annoTypes[r].normal===n)return this.editorWrapper[e].annoTypes[r].list;return null},generateBlockDiffAnnotations:function(e,t){var r=this.editorWrapper[e].diffFeeder.getCurrentBlockAnnoType(t),i=this.getAnnoModelList(e,"block",r.normal),s=this.editorWrapper[e].diffFeeder.getCharRange(t),o=n.AnnotationType.createAnnotation(r.normal,s.start,s.end);return i&&i.push(o),o},generateWordDiffAnnotations:function(e,t,r,i,s,o){if(i){var u=this.editorWrapper[e].diffFeeder.getCurrentWordAnnoType({start:-1,end:-1}),a=this.getAnnoModelList(e,"word",u.normal);for(var f=0;f<i.length;f++){var l=i[f][s]+r,c=i[f][o]+r,h=n.AnnotationType.createAnnotation(u.normal,l,c);a.push(h),t.push(h)}}},_updateOverviewRuler:function(){if(this._overviewRuler){var e=this.editorWrapper[0].editor.getTextView().getTopIndex();this.editorWrapper[0].editor.getTextView().redrawLines(e,e+1,this._overviewRuler)}},_updateCurveRuler:function(){this._curveRuler&&this._curveRuler.render()},_setTextViewPosition:function(e,t){var n=e.getLineHeight(),r=e.getClientArea(),i=Math.floor(r.height/n/3);e.setTopIndex(t-i>0?t-i:0)},_positionDiffBlock:function(){var e=this.getCurrentBlockIndex();e<0&&(e=0);var n=this.getFeeder().getDiffBlocks();if(n.length===0)return;this._setTextViewPosition(this.editorWrapper[0].editor.getTextView(),n[e][0]);if(this.editorWrapper[0].editor!==this.editorWrapper[1].editor){var r=t.lookUpLineIndex(this.getMapper(),0,n[e][1]);this._setTextViewPosition(this.editorWrapper[1].editor.getTextView(),r)}this._updateOverviewRuler(),this._updateCurveRuler()},matchPositionFromOverview:function(e){if(!this._initialized)return;var n;e<0?n=0:n=t.getAnnotationIndex(this.getFeeder().getDiffBlocks(),e),this.gotoBlock(n)},gotoDiff:function(e,t){this.gotoChange(e,t)&&(this._updateOverviewRuler(),this._updateCurveRuler())},nextDiff:function(){this.iterateOnBlock(!0,!0),this._positionDiffBlock()},prevDiff:function(){this.iterateOnBlock(!1,!0),this._positionDiffBlock()},nextChange:function(){this.iterateOnChange(!0),this._positionDiffBlock()},prevChange:function(){this.iterateOnChange(!1),this._positionDiffBlock()}},i}(),i.DiffBlockFeeder=function(){function e(){}return e.prototype={getWordAnnoTypes:function(e){this._mapperColumnIndex===0?e.push({type:"word",current:s.ANNO_DIFF_CURRENT_ADDED_WORD,normal:s.ANNO_DIFF_ADDED_WORD,list:[]}):e.push({type:"word",current:s.ANNO_DIFF_CURRENT_DELETED_WORD,normal:s.ANNO_DIFF_DELETED_WORD,list:[]}),e.push({type:"word",current:s.ANNO_DIFF_EMPTY_DELETED_WORD_LEFT}),e.push({type:"word",current:s.ANNO_DIFF_EMPTY_DELETED_WORD_RIGHT}),e.push({type:"word",current:s.ANNO_DIFF_EMPTY_ADDED_WORD_LEFT}),e.push({type:"word",current:s.ANNO_DIFF_EMPTY_ADDED_WORD_RIGHT})},getCurrentWordAnnoType:function(e,t){return e.start===e.end&&t?this._mapperColumnIndex===0?{current:this._repositionEmptyWord(e,t),normal:s.ANNO_DIFF_ADDED_WORD}:{current:this._repositionEmptyWord(e,t),normal:s.ANNO_DIFF_DELETED_WORD}:this._mapperColumnIndex===0?{current:s.ANNO_DIFF_CURRENT_ADDED_WORD,normal:s.ANNO_DIFF_ADDED_WORD}:{current:s.ANNO_DIFF_CURRENT_DELETED_WORD,normal:s.ANNO_DIFF_DELETED_WORD}},_repositionEmptyWord:function(e,t){var n=t.getLineAtOffset(e.start),r=t.getLineStart(n),i=t.getLineEnd(n);if(r!==i)return e.start===i?(e.start--,this._mapperColumnIndex===0?s.ANNO_DIFF_EMPTY_ADDED_WORD_RIGHT:s.ANNO_DIFF_EMPTY_DELETED_WORD_RIGHT):(e.end++,this._mapperColumnIndex===0?s.ANNO_DIFF_EMPTY_ADDED_WORD_LEFT:s.ANNO_DIFF_EMPTY_DELETED_WORD_LEFT);if(n>0){n--,r=t.getLineStart(n),i=t.getLineEnd(n);if(r!==i)return e.start=i-1,e.end=i,this._mapperColumnIndex===0?s.ANNO_DIFF_EMPTY_ADDED_WORD_RIGHT:s.ANNO_DIFF_EMPTY_DELETED_WORD_RIGHT}return this._mapperColumnIndex===0?s.ANNO_DIFF_EMPTY_ADDED_WORD_LEFT:s.ANNO_DIFF_EMPTY_DELETED_WORD_LEFT},getMapper:function(){return this._mapper},getDiffBlocks:function(){return this._diffBlocks},getDiffBlockH:function(e){if(!this._diffBlocks||this._diffBlocks.length===0)return-1;var t=this._diffBlocks[e][1];return t===-1?0:this._mapper[t][this._mapperColumnIndex]},getOverviewLineCount:function(){return this._textModel.getLineCount()},getLineNumber:function(e){return e},getCharRange:function(e){if(!this._diffBlocks||this._diffBlocks.length===0)return null;var t=this._diffBlocks[e][1],n=this._diffBlocks[e][0],r=n+this._mapper[t][this._mapperColumnIndex]-1,i=this._textModel.getLineStart(n);if(r<n)return{start:i,end:i};var s=this._textModel.getLineEnd(r,!0);return{start:i,end:s}},getTextOnBlock:function(e){if(!this._diffBlocks||this._diffBlocks.length===0)return null;var t=this._diffBlocks[e][1];this._mapper[t][0]===0||this._mapper[t][1]===0||this._mapper[t][2]===0;var n=this.getCharRange(e);return{start:n.start,text:this._textModel.getText(n.start,n.end)}},isMapperEmpty:function(){return this._mapper.length===0}},e}(),i.TwoWayDiffBlockFeeder=function(){function e(e,t,n){this._mapperColumnIndex=n,this.init(e,t)}return e.prototype=new i.DiffBlockFeeder,e.prototype.init=function(e,t){this._textModel=e,this._diffBlocks=undefined;if(t){this._mapper=t,this._diffBlocks=[];var n=0;for(var r=0;r<this._mapper.length;r++)this._mapper[r][2]!==0&&this._diffBlocks.push([n,r]),n+=this._mapper[r][this._mapperColumnIndex]}},e.prototype.getBlockAnnoTypes=function(e){this._mapperColumnIndex===0?e.push({type:"block",normal:s.ANNO_DIFF_ADDED_BLOCK,current:s.ANNO_DIFF_CURRENT_ADDED_BLOCK,list:[]}):e.push({type:"block",normal:s.ANNO_DIFF_DELETED_BLOCK,current:s.ANNO_DIFF_CURRENT_DELETED_BLOCK,list:[]}),e.push({type:"block",normal:s.ANNO_DIFF_BLOCK_TOPONLY,current:s.ANNO_DIFF_CURRENT_BLOCK_TOPONLY,list:[]}),e.push({type:"block",normal:s.ANNO_DIFF_BLOCK_CONFLICT,current:s.ANNO_DIFF_CURRENT_BLOCK_CONFLICT,list:[]})},e.prototype.getCurrentBlockAnnoType=function(e){if(!this._diffBlocks||this._diffBlocks.length===0)return null;var n=this._diffBlocks[e][1];return this._mapper[n][this._mapperColumnIndex]===0?{normal:s.ANNO_DIFF_BLOCK_TOPONLY,current:s.ANNO_DIFF_CURRENT_BLOCK_TOPONLY}:t.isMapperConflict(this.getMapper(),n)?{normal:s.ANNO_DIFF_BLOCK_CONFLICT,current:s.ANNO_DIFF_CURRENT_BLOCK_CONFLICT}:this._mapperColumnIndex===0?{type:"block",normal:s.ANNO_DIFF_ADDED_BLOCK,current:s.ANNO_DIFF_CURRENT_ADDED_BLOCK,list:[]}:{type:"block",normal:s.ANNO_DIFF_DELETED_BLOCK,current:s.ANNO_DIFF_CURRENT_DELETED_BLOCK,list:[]}},e}(),i.inlineDiffBlockFeeder=function(){function e(e,t){this._mapperColumnIndex=t,this.init(e)}return e.prototype=new i.DiffBlockFeeder,e.prototype.setModel=function(e){this._textModel=e},e.prototype.init=function(e){this._diffBlocks=undefined;if(e){this._mapper=e,this._diffBlocks=[],this._gapBlocks=[];var t=0,n=0;for(var r=0;r<this._mapper.length;r++){if(this._mapper[r][2]!==0){if(this._mapperColumnIndex===0){var i=t+this._mapper[r][1];this._diffBlocks.push([i,r]),this._gapBlocks.push([i,i+this._mapper[r][0],n])}else this._diffBlocks.push([t,r]),this._gapBlocks.push([t,t+this._mapper[r][1],n]);t+=this._mapper[r][0]+this._mapper[r][1]}else this._gapBlocks.push([t,t+this._mapper[r][this._mapperColumnIndex],n]),t+=this._mapper[r][this._mapperColumnIndex];n+=this._mapper[r][this._mapperColumnIndex]}}},e.prototype.getBlockAnnoTypes=function(e){this._mapperColumnIndex===0?e.push({type:"block",normal:s.ANNO_DIFF_ADDED_BLOCK,current:s.ANNO_DIFF_CURRENT_ADDED_BLOCK,list:[]}):e.push({type:"block",normal:s.ANNO_DIFF_DELETED_BLOCK,current:s.ANNO_DIFF_CURRENT_DELETED_BLOCK,list:[]}),e.push({type:"block",normal:s.ANNO_DIFF_BLOCK_CONFLICT,current:s.ANNO_DIFF_CURRENT_BLOCK_CONFLICT,list:[]})},e.prototype.getCurrentBlockAnnoType=function(e){if(!this._diffBlocks||this._diffBlocks.length===0)return null;var n=this._diffBlocks[e][1];return this._mapper[n][this._mapperColumnIndex]===0?{current:s.ANNO_DIFF_CURRENT_ADDED_WORD,normal:s.ANNO_DIFF_ADDED_WORD}:t.isMapperConflict(this.getMapper(),n)?{normal:s.ANNO_DIFF_BLOCK_CONFLICT,current:s.ANNO_DIFF_CURRENT_BLOCK_CONFLICT}:this._mapperColumnIndex===0?{type:"block",normal:s.ANNO_DIFF_ADDED_BLOCK,current:s.ANNO_DIFF_CURRENT_ADDED_BLOCK,list:[]}:{type:"block",normal:s.ANNO_DIFF_DELETED_BLOCK,current:s.ANNO_DIFF_CURRENT_DELETED_BLOCK,list:[]}},e.prototype.getDiffBlockH=function(e){if(!this._diffBlocks||this._diffBlocks.length===0)return-1;var t=this._diffBlocks[e][1];return this._mapper[t][0]+this._mapper[t][1]},e.prototype.getLineNumber=function(e){for(var t=0;t<this._gapBlocks.length;t++)if(this._gapBlocks[t][0]!==this._gapBlocks[t][1]&&e>=this._gapBlocks[t][0]&&e<this._gapBlocks[t][1]){var n=e-this._gapBlocks[t][0];return n+this._gapBlocks[t][2]}return-1},e}(),i}),define("orion/compare/compare-rulers",["orion/compare/compareUtils","orion/compare/diffTreeNavigator"],function(e,t){var n=n||{};return n.CompareRuler=function(){function e(e,t,n){this._location=e||"left",this._overview=t||"page",this._rulerStyle=n,this._editor=null;var r=this;this._listener={onModelChanged:function(e){r._onModelChanged(e)}}}return e.prototype={setView:function(e){this._onModelChanged&&this._editor&&this._editor.removeEventListener("ModelChanged",this._listener.onModelChanged),this._editor=e,this._onModelChanged&&this._editor&&this._editor.addEventListener("ModelChanged",this._listener.onModelChanged)},getLocation:function(){return this._location},getOverview:function(e){return this._overview},getAnnotationModel:function(){return null},addAnnotationType:function(e){},isAnnotationTypeVisible:function(e){return!1},removeAnnotationType:function(e){},setAnnotationModel:function(e){},getAnnotations:function(e,t){var n=[];for(var r=e;r<t;r++){var i=this.getStyle(r);i&&(n[r]={html:this.getHTML(r),style:i})}return n},getWidestAnnotation:function(){return{html:this.getHTML(-1),style:this.getStyle(-1)}},getRulerStyle:function(){return this.getStyle(undefined)}},e}(),n.LineNumberCompareRuler=function(){function e(e,t,r,i,s,o){n.CompareRuler.call(this,r,"page",i),this._diffNavigator=e,this._oddStyle=s||{style:{backgroundColor:"white"}},this._evenStyle=o||{style:{backgroundColor:"white"}},this._numOfDigits=0,this._mapperColumnIndex=t}return e.prototype=new n.CompareRuler,e.prototype.getStyle=function(e){return e===undefined?this._rulerStyle:this._evenStyle},e.prototype.getHTML=function(e){var t=this._editor.getModel(),n=this._diffNavigator.getFeeder(this._mapperColumnIndex===0);if(!n)return"";if(e===-1)return t.getLineCount();if(n.getLineNumber){var r=n.getLineNumber(e);return r===-1?"":r+1}return e+1},e.prototype._onModelChanged=function(e){var t=e.start,n=this._editor.getModel(),r=n.getLineCount(),i=(r+"").length;if(this._numOfDigits!==i){this._numOfDigits=i;var s=n.getLineAtOffset(t);this._editor.redrawLines(s,r,this)}},e}(),n.CompareOverviewRuler=function(){function t(e,t,r,i){this._diffNavigator=r,this._onClick=i,n.CompareRuler.call(this,e,"document",t)}return t.prototype=new n.CompareRuler,t.prototype.getStyle=function(t){var n,r;if(t===undefined)n=this._rulerStyle||{},r=n.style||(n.style={}),r.lineHeight="1px",r.fontSize="1px",r.width="14px";else{t!==-1?n={styleClass:"annotationOverview breakpoint"}||{}:n={},r=n.style||(n.style={}),r.cursor="pointer",r.width="8px",r.left="2px";var i=this._editor.getModel();if(!(t>=0))return r.height="3px";var s;if(!this._diffNavigator||!this._diffNavigator.getFeeder())return null;s=this._diffNavigator.getFeeder().getDiffBlocks();var o=e.getAnnotationIndex(s,t);if(o===-1)return null;var u=e.getAnnotationMapperIndex(s,o),a;a=this._diffNavigator.getMapper();var f=e.isMapperConflict(a,u);f&&(r.border="1px #FF0000 solid"),o===this._diffNavigator.getCurrentBlockIndex()&&(r.backgroundColor=f?"red":"blue");var l=this._diffNavigator.getFeeder().getDiffBlockH(o),c=this._diffNavigator.getFeeder().getOverviewLineCount();if(l<0)return null;var h=this._editor.getClientArea(),p=Math.floor(h.height*l/c);p<2&&(p=2),r.height=p+"px"}return n},t.prototype.setDiffNavigator=function(e){this._diffNavigator=e},t.prototype.getHTML=function(e){return"&nbsp;"},t.prototype.onClick=function(e,t){if(e===undefined)return;this._onClick(e,this)},t.prototype._onModelChanged=function(e){var t=this._editor.getModel(),n=t.getLineCount();n>0&&this._editor.redrawLines(0,1,this)},t}(),n.CompareCurveRuler=function(){function t(e){this._canvasDiv=e,this._mapper=undefined,this._initialized=!1}return t.prototype={init:function(e,t,n,r){this._initialized=!0,this._initing=!0,this._mapper=e,this._leftEditor=t,this._rightEditor=n,this._leftTextView=t.getTextView(),this._rightTextView=n.getTextView(),this._diffNavigator=r,this.render()},matchPositionFrom:function(t){var n=t?this._leftTextView:this._rightTextView,r=t?this._rightTextView:this._leftTextView,i=n.getTopIndex(),s=n.getBottomIndex(),o=e.matchMapper(this._mapper,t?0:1,i,s);r.setTopIndex(o)},copyToLeft:function(){if(!this._diffNavigator.iterator)return;var e=this._diffNavigator.iterator.cursor();if(e){var t=this._rightTextView.getText(e.oldA.start,e.oldA.end);this._leftTextView.setText(t,e.newA.start,e.newA.end)}},render:function(){if(!this._mapper)return;var t=this._canvasDiv.getContext("2d");t.clearRect(0,0,this._canvasDiv.width,this._canvasDiv.height),t.strokeStyle="#AAAAAA",t.lineWidth=1,t.beginPath();var n=this._leftTextView.getTopIndex(),r=this._leftTextView.getBottomIndex(),i=this._rightTextView.getTopIndex(),s=this._rightTextView.getBottomIndex();this._leftLineH=this._leftTextView.getLineHeight(),this._rightLineH=this._rightTextView.getLineHeight();var o=0,u=0,a=!1;for(var f=0;f<this._mapper.length;f++){if(this._mapper[f][2]!==0)if(e.overlapMapper(this._mapper[f],0,o,n,r)||e.overlapMapper(this._mapper[f],1,u,i,s))this._renderCurve(f,o,u,this._canvasDiv,t,n,r,i,s),a=!0;else if(a)break;o+=this._mapper[f][0],u+=this._mapper[f][1]}t.stroke()},_renderCurve:function(e,t,n,r,i,s,o,u,a){var f=this._mapper[e],l=this._leftTextView.getLinePixel(t+f[0]/2)+f[0]%2*this._leftLineH/3-this._leftTextView.getTopPixel(),c=this._rightTextView.getLinePixel(n+f[1]/2)+f[1]%2*this._rightLineH/3-this._rightTextView.getTopPixel(),h=r.parentNode.clientWidth;if(e===this._diffNavigator.getCurrentMapperIndex()){i.stroke(),i.strokeStyle="#000",i.lineWidth=1,i.beginPath(),i.moveTo(0,l),i.bezierCurveTo(h/3,l,h*.666,c,h,c),i.stroke(),i.strokeStyle="#AAAAAA",i.lineWidth=1,i.beginPath();return}i.moveTo(0,l),i.bezierCurveTo(h/3,l,h*.666,c,h,c),i.stroke()},onChanged:function(t){if(t.removedLineCount===t.addedLineCount)return;this._initing||e.updateMapper(this._mapper,0,this._leftTextView.getModel().getLineAtOffset(t.start),t.removedLineCount,t.addedLineCount),this._initing=!1,(t.removedLineCount>0||t.addedLineCount>0)&&this.render()}},t}(),n}),define("orion/editor/contentAssist",["i18n!orion/editor/nls/messages","orion/editor/keyBinding","orion/editor/eventTarget","orion/Deferred","orion/editor/util"],function(e,t,n,r,i){function u(n){this.textView=n,this.state=s.INACTIVE,this.providers=[];var r=this;this.contentAssistListener={onModelChanging:function(e){r.isDeactivatingChange(e)?r.setState(s.INACTIVE):r.state===s.ACTIVE&&r.setState(s.FILTERING)},onScroll:function(e){r.setState(s.INACTIVE)},onSelection:function(e){var t=r.state;if(t===s.ACTIVE||t===s.FILTERING)r.computeProposals(),r.setState(s.FILTERING)}},n.setKeyBinding(i.isMac?new t.KeyBinding(" ",!1,!1,!1,!0):new t.KeyBinding(" ",!0),"contentAssist"),n.setAction("contentAssist",function(){return r.activate(),!0},{name:e.contentAssist})}function a(e,t){this.contentAssist=e,this.widget=t,this.proposals=[];var n=this;this.contentAssist.addEventListener("ProposalsComputed",function(e){n.proposals=e.data.proposals,n.selectedIndex=n.proposals.length?0:-1})}function f(e,t){this.contentAssist=e,this.textView=this.contentAssist.getTextView(),this.textViewListenerAdded=!1,this.isShowing=!1;var n=this.textView.getOptions("parent").ownerDocument;this.parentNode=typeof t=="string"?n.getElementById(t):t;if(!this.parentNode){this.parentNode=i.createElement(n,"div"),this.parentNode.className="contentassist";var r=n.getElementsByTagName("body")[0];if(!r)throw new Error("parentNode is required");r.appendChild(this.parentNode)}var s=this;this.textViewListener={onMouseDown:function(e){e.event.target.parentElement!==s.parentNode&&s.contentAssist.deactivate()}},this.contentAssist.addEventListener("ProposalsComputed",function(e){s.setProposals(e.data.proposals),s.show(),s.textViewListenerAdded||(s.textView.addEventListener("MouseDown",s.textViewListener.onMouseDown),s.textViewListenerAdded=!0)}),this.contentAssist.addEventListener("Deactivating",function(e){s.setProposals([]),s.hide(),s.textViewListenerAdded&&(s.textView.removeEventListener("MouseDown",s.textViewListener.onMouseDown),s.textViewListenerAdded=!1),s.textViewListenerAdded=!1}),this.scrollListener=function(e){s.isShowing&&s.position()},n.addEventListener("scroll",this.scrollListener)}var s={INACTIVE:1,ACTIVE:2,FILTERING:3},o={selected:" selected",hr:"proposal-hr",emphasis:"proposal-emphasis",noemphasis:"proposal-noemphasis",dfault:"proposal-default"};return u.prototype={apply:function(e){if(!e)return!1;var t=this.textView.getCaretOffset(),n={proposal:e,start:t,end:t};this.setState(s.INACTIVE);var r=e.proposal||e;return this.textView.setText(r,t,t),this.dispatchEvent({type:"ProposalApplied",data:n}),!0},activate:function(){this.state===s.INACTIVE&&this.setState(s.ACTIVE)},deactivate:function(){this.setState(s.INACTIVE)},getTextView:function(){return this.textView},isActive:function(){return this.state===s.ACTIVE||this.state===s.FILTERING},isDeactivatingChange:function(e){var t=e.removedCharCount>0&&e.addedCharCount===0,n=this.textView,r=e.start+1<=n.getModel().getCharCount()&&/^\s*$/.test(n.getText(e.start,e.start+1));return e.removedLineCount>0||e.addedLineCount>0||t&&r},setState:function(e){var t;e===s.ACTIVE?t="Activating":e===s.INACTIVE&&(t="Deactivating"),t&&this.dispatchEvent({type:t}),this.state=e,this.onStateChange(e)},onStateChange:function(e){e===s.INACTIVE?this.listenerAdded&&(this.textView.removeEventListener("ModelChanging",this.contentAssistListener.onModelChanging),this.textView.removeEventListener("Scroll",this.contentAssistListener.onScroll),this.textView.removeEventListener("Selection",this.contentAssistListener.onSelection),this.listenerAdded=!1):e===s.ACTIVE&&(this.listenerAdded||(this.textView.addEventListener("ModelChanging",this.contentAssistListener.onModelChanging),this.textView.addEventListener("Scroll",this.contentAssistListener.onScroll),this.textView.addEventListener("Selection",this.contentAssistListener.onSelection),this.listenerAdded=!0),this.computeProposals())},computeProposals:function(){var e=this,t=this.textView.getCaretOffset();this._computeProposals(t).then(function(t){e.dispatchEvent({type:"ProposalsComputed",data:{proposals:t}})})},getPrefixStart:function(e){var t=e;while(t>0&&/[A-Za-z0-9_]/.test(this.textView.getText(t-1,t)))t--;return t},handleError:function(e){typeof console!="undefined"&&(console.log("Error retrieving content assist proposals"),console.log(e))},_computeProposals:function(e){var t=this.providers,n=this.textView,i=n.getModel(),s=n.getText(),o={line:i.getLine(i.getLineAtOffset(e)),prefix:n.getText(this.getPrefixStart(e),e),selection:n.getSelection()},u=this,a=t.map(function(t){var n=t.computeProposals||t.getProposals,i;try{typeof n=="function"&&(i=u.progress?u.progress.progress(n.apply(t,[s,e,o]),"Generating content assist proposal"):n.apply(t,[s,e,o]))}catch(a){u.handleError(a)}return r.when(i)});return r.all(a,this.handleError).then(function(e){return e.reduce(function(e,t){return t instanceof Array?e.concat(t):e},[])})},setProviders:function(e){this.providers=e.slice(0)},setProgress:function(e){this.progress=e}},n.EventTarget.addMixin(u.prototype),a.prototype={cancel:function(){this.getContentAssist().deactivate()},getContentAssist:function(){return this.contentAssist},isActive:function(){return this.getContentAssist().isActive()},lineUp:function(){var e=this.selectedIndex===0?this.proposals.length-1:this.selectedIndex-1;while(this.proposals[e].unselectable&&e>0)e--;return this.selectedIndex=e,this.widget&&this.widget.setSelectedIndex(this.selectedIndex),!0},lineDown:function(){var e=this.selectedIndex===this.proposals.length-1?0:this.selectedIndex+1;while(this.proposals[e].unselectable&&e<this.proposals.length-1)e++;return this.selectedIndex=e,this.widget&&this.widget.setSelectedIndex(this.selectedIndex),!0},enter:function(){var e=this.proposals[this.selectedIndex]||null;return this.contentAssist.apply(e)},tab:function(){return this.widget?(this.widget.createAccessible(this),this.widget.parentNode.focus(),!0):!1}},f.prototype={onClick:function(e){this.contentAssist.apply(this.getProposal(e.target)),this.textView.focus()},createDiv:function(e,t,n,r){var s=n.ownerDocument,o=i.createElement(s,"div");o.id="contentoption"+r,o.setAttribute("role","option");var u;e.style==="hr"?u=i.createElement(s,"hr"):(o.className=this.calculateClasses(e.style,t),u=s.createTextNode(this.getDisplayString(e)),t&&this.parentNode.setAttribute("aria-activedescendant",o.id)),o.appendChild(u,o),n.appendChild(o)},createAccessible:function(e){this._isAccessible||this.parentNode.addEventListener("keydown",function(t){return t.preventDefault(),t.keyCode===27?e.cancel():t.keyCode===38?e.lineUp():t.keyCode===40?e.lineDown():t.keyCode===13?e.enter():!1}),this._isAccessible=!0},calculateClasses:function(e,t){var n=o[e];return n||(n=o.dfault),t?n+o.selected:n},getDisplayString:function(e){return typeof e=="string"?e:e.description&&typeof e.description=="string"?e.description:e.proposal},getProposal:function(e){var t=0;for(var n=this.parentNode.firstChild;n!==null;n=n.nextSibling){if(n===e)return this.proposals[t]||null;t++}return null},setSelectedIndex:function(e){this.selectedIndex=e,this.selectNode(this.parentNode.childNodes[this.selectedIndex])},selectNode:function(e){var t=this.parentNode.childNodes;for(var n=0;n<t.length;n++){var r=t[n],i=r.className.indexOf(o.selected);i>=0&&(r.className=r.className.substring(0,i)+r.className.substring(i+o.selected.length)),r===e&&(r.className=r.className+o.selected,this.parentNode.setAttribute("aria-activedescendant",r.id),r.focus(),r.offsetTop<this.parentNode.scrollTop?r.scrollIntoView(!0):r.offsetTop+r.offsetHeight>this.parentNode.scrollTop+this.parentNode.clientHeight&&r.scrollIntoView(!1))}},setProposals:function(e){this.proposals=e},show:function(){if(this.proposals.length===0){this.hide();return}this.parentNode.innerHTML="";for(var e=0;e<this.proposals.length;e++)this.createDiv(this.proposals[e],e===0,this.parentNode,e);this.position(),this.parentNode.onclick=this.onClick.bind(this),this.isShowing=!0},hide:function(){this.parentNode.ownerDocument.activeElement===this.parentNode&&this.textView.focus(),this.parentNode.style.display="none",this.parentNode.onclick=null,this.isShowing=!1},position:function(){var e=this.textView.getLocationAtOffset(this.textView.getCaretOffset());e.y+=this.textView.getLineHeight(),this.textView.convert(e,"document","page"),this.parentNode.style.position="fixed",this.parentNode.style.left=e.x+"px",this.parentNode.style.top=e.y+"px",this.parentNode.style.display="block",this.parentNode.scrollTop=0;var t=this.parentNode.ownerDocument,n=t.documentElement.clientWidth,r=t.documentElement.clientHeight;e.y+this.parentNode.offsetHeight>r&&(this.parentNode.style.top=e.y-this.parentNode.offsetHeight-this.textView.getLineHeight()+"px"),e.x+this.parentNode.offsetWidth>n&&(this.parentNode.style.left=n-this.parentNode.offsetWidth+"px")}},{ContentAssist:u,ContentAssistMode:a,ContentAssistWidget:f}}),define("orion/edit/nls/root/messages",{"Fetching ":"Fetching ","An error occurred: ":"An error occurred: ","No File Selected":"No File Selected","There are unsaved changes.  Do you still want to navigate away?":"There are unsaved changes.  Do you still want to navigate away?","Search Files":"Search Files","Enter search term:":"Enter search term:","Searching for occurrences of ":"Searching for occurrences of ","Toggle Outliner":"Toggle Outliner","There are unsaved changes.":"There are unsaved changes.",Save:"Save","Resource is out of sync with the server. Do you want to save it anyway?":"Resource is out of sync with the server. Do you want to save it anyway?","Save this file":"Save this file","Go to Line":"Go to Line","Go to specified line number":"Go to specified line number","Go to line:":"Go to line:",Undo:"Undo",Redo:"Redo",Find:"Find","No response from server.  Check your internet connection and try again.":"No response from server.  Check your internet connection and try again.","Saving file {0}":"Saving file {0}","Running {0}":"Running {0}"}),define("orion/edit/nls/messages",["orion/i18n!orion/edit/nls/messages","orion/edit/nls/root/messages"],function(e,t){var n={root:t};return Object.keys(e).forEach(function(t){typeof n[t]=="undefined"&&(n[t]=e[t])}),n}),define("orion/editor/undoStack",[],function(){function e(e,t,n){this.offset=e,this.text=t,this.previousText=n}function t(){this.changes=[]}function n(e,t){this.view=e,this.size=t!==undefined?t:100,this.reset();var n=e.getModel();n.getBaseModel&&(n=n.getBaseModel()),this.model=n;var r=this;this._listener={onChanging:function(e){r._onChanging(e)},onDestroy:function(e){r._onDestroy(e)}},n.addEventListener("Changing",this._listener.onChanging),e.addEventListener("Destroy",this._listener.onDestroy)}return e.prototype={undo:function(e,t){this._doUndoRedo(this.offset,this.previousText,this.text,e,t)},redo:function(e,t){this._doUndoRedo(this.offset,this.text,this.previousText,e,t)},_doUndoRedo:function(e,t,n,r,i){var s=r.getModel();if(s.mapOffset&&r.annotationModel){var o=s.mapOffset(e,!0);if(o<0){var u=r.annotationModel,a=u.getAnnotations(e,e+1);while(a.hasNext()){var f=a.next();if(f.type==="orion.annotation.folding"){f.expand(),o=s.mapOffset(e,!0);break}}}if(o<0)return;e=o}r.setText(t,e,e+n.length),i&&r.setSelection(e,e+t.length)}},t.prototype={add:function(e){this.changes.push(e)},end:function(e){this.endSelection=e.getSelection(),this.endCaret=e.getCaretOffset()},undo:function(e,t){for(var n=this.changes.length-1;n>=0;n--)this.changes[n].undo(e,!1);if(t){var r=this.startSelection.start,i=this.startSelection.end;e.setSelection(this.startCaret?r:i,this.startCaret?i:r)}},redo:function(e,t){for(var n=0;n<this.changes.length;n++)this.changes[n].redo(e,!1);if(t){var r=this.endSelection.start,i=this.endSelection.end;e.setSelection(this.endCaret?r:i,this.endCaret?i:r)}},start:function(e){this.startSelection=e.getSelection(),this.startCaret=e.getCaretOffset()}},n.prototype={add:function(e){if(this.compoundChange)this.compoundChange.add(e);else{var t=this.stack.length;this.stack.splice(this.index,t-this.index,e),this.index++,this.stack.length>this.size&&(this.stack.shift(),this.index--,this.cleanIndex--)}},markClean:function(){this.endCompoundChange(),this._commitUndo(),this.cleanIndex=this.index},isClean:function(){return this.cleanIndex===this.getSize().undo},canUndo:function(){return this.getSize().undo>0},canRedo:function(){return this.getSize().redo>0},endCompoundChange:function(){this.compoundChange&&this.compoundChange.end(this.view),this.compoundChange=undefined},getSize:function(){var e=this.index,t=this.stack.length;return this._undoStart!==undefined&&e++,{undo:e,redo:t-e}},undo:function(){this._commitUndo();if(this.index<=0)return!1;var e=this.stack[--this.index];return this._ignoreUndo=!0,e.undo(this.view,!0),this._ignoreUndo=!1,!0},redo:function(){this._commitUndo();if(this.index>=this.stack.length)return!1;var e=this.stack[this.index++];return this._ignoreUndo=!0,e.redo(this.view,!0),this._ignoreUndo=!1,!0},reset:function(){this.index=this.cleanIndex=0,this.stack=[],this._undoStart=undefined,this._undoText="",this._undoType=0,this._ignoreUndo=!1,this._compoundChange=undefined},startCompoundChange:function(){this._commitUndo();var e=new t;this.add(e),this.compoundChange=e,this.compoundChange.start(this.view)},_commitUndo:function(){this._undoStart!==undefined&&(this._undoType===-1?this.add(new e(this._undoStart,"",this._undoText)):this.add(new e(this._undoStart,this._undoText,"")),this._undoStart=undefined,this._undoText="",this._undoType=0)},_onDestroy:function(e){this.model.removeEventListener("Changing",this._listener.onChanging),this.view.removeEventListener("Destroy",this._listener.onDestroy)},_onChanging:function(t){var n=t.text,r=t.start,i=t.removedCharCount,s=t.addedCharCount;if(this._ignoreUndo)return;this._undoStart!==undefined&&(s!==1||i!==0||this._undoType!==1||r!==this._undoStart+this._undoText.length)&&(s!==0||i!==1||this._undoType!==-1||r+1!==this._undoStart&&r!==this._undoStart)&&this._commitUndo();if(!this.compoundChange){if(s===1&&i===0){this._undoStart===undefined&&(this._undoStart=r),this._undoText=this._undoText+n,this._undoType=1;return}if(s===0&&i===1){var o=this._undoText.length>0&&this._undoStart===r;this._undoStart=r,this._undoType=-1,o?this._undoText=this._undoText+this.model.getText(r,r+i):this._undoText=this.model.getText(r,r+i)+this._undoText;return}}this.add(new e(r,n,this.model.getText(r,r+i)))}},{UndoStack:n}}),define("orion/editorCommands",["i18n!orion/edit/nls/messages","orion/i18nUtil","orion/webui/littlelib","orion/Deferred","orion/URITemplate","orion/commands","orion/globalCommands","orion/extensionCommands","orion/contentTypes","orion/editor/keyBinding","orion/editor/undoStack","orion/searchUtils","orion/PageUtil"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){var p={},d=null;return p.EditorCommandFactory=function(){function o(e,t,n,r,i,s,o,u){this.serviceRegistry=e,this.commandService=t,this.fileClient=n,this.inputManager=r,this.toolbarId=i,this.pageNavId=o,this.isReadOnly=s,this._searcher=u}return o.prototype={generateEditorCommands:function(o){function l(e){if(d)return d;var t=e.getService("orion.core.contenttypes");return t||(t=new a.ContentTypeService(e),t=e.getService("orion.core.contenttypes")),t.getContentTypes().then(function(e){return d=e,d})}function p(e){var t=new f.KeyBinding;return f.KeyBinding.apply(t,e),t}function v(t){var n={};n.Severity="Error",t.status===0?n.Message=e["No response from server.  Check your internet connection and try again."]:n=t;var r=serviceRegistry.getService("orion.page.message");r?r.setProgressResult(n):window.console.log(n)}if(!this.isReadOnly){o.getTextView().setKeyBinding(new f.KeyBinding("s",!0),"save");var m=this;this.inputManager.onSave?o.getTextView().setAction("save",function(){var e=o.getText();return m.inputManager.onSave(m.inputManager.getInput(),e,function(t){o.setInput(m.inputManager.getInput(),null,e,!0),m.inputManager.afterSave&&m.inputManager.afterSave()},function(e){e.log=!0}),!0},{name:e.Save}):o.getTextView().setAction("save",function(){var n=o.getText(),r=m.inputManager.getFileMetadata().ETag,i={ETag:r},s=m.fileClient.write(m.inputManager.getInput(),n,i),u=m.serviceRegistry.getService("orion.page.progress");return u&&u.progress(s,t.formatMessage(e["Saving file {0}"],m.inputManager.getInput())),s.then(function(e){m.inputManager.getFileMetadata().ETag=e.ETag,o.setInput(m.inputManager.getInput(),null,n,!0),m.inputManager.afterSave&&m.inputManager.afterSave()},function(r){if(r.status===412){var i=confirm(e["Resource is out of sync with the server. Do you want to save it anyway?"]);if(i){var s=m.fileClient.write(m.inputManager.getInput(),n);u&&u.progress(s,t.formatMessage(e["Saving file {0}"],m.inputManager.getInput())),s.then(function(e){m.inputManager.getFileMetadata().ETag=e.ETag,o.setInput(m.inputManager.getInput(),null,n,!0),m.inputManager.afterSave&&m.inputManager.afterSave()},v)}}else v(r)}),!0},{name:e.Save});var g=new s.Command({name:e.Save,tooltip:e["Save this file"],id:"orion.save",callback:function(e){o.getTextView().invokeAction("save")}});this.commandService.addCommand(g),this.commandService.registerCommandContribution(this.toolbarId,"orion.save",1,null,!1,new s.CommandKeyBinding("s",!0));var y=new s.ParametersDescription([new s.CommandParameter("line","number","Line:")],{hasOptionalParameters:!1},function(){var e=o.getModel().getLineAtOffset(o.getCaretOffset())+1;return[new s.CommandParameter("line","number","Line:",e.toString())]}),b=new s.Command({name:e["Go to Line"],tooltip:e["Go to specified line number"],id:"orion.gotoLine",parameters:y,callback:function(t){var n,r=o.getModel();t.parameters&&t.parameters.valueFor("line")?n=t.parameters.valueFor("line"):(n=r.getLineAtOffset(o.getCaretOffset()),n=prompt(e["Go to line:"],n+1),n&&(n=parseInt(n,10))),n&&o.onGotoLine(n-1,0)}});this.commandService.addCommand(b),this.commandService.registerCommandContribution(this.pageNavId,"orion.gotoLine",1,null,!0,new s.CommandKeyBinding("l",!0),new s.URLBinding("gotoLine","line")),o.getTextView().setKeyBinding(new f.KeyBinding("l",!0),"gotoLine"),o.getTextView().setAction("gotoLine",function(){return m.commandService.runCommand("orion.gotoLine"),!0},b);var w=new s.ParametersDescription([new s.CommandParameter("find","text","Find:")],{clientCollect:!0},function(){var e=o.getSelection(),t="";if(e.end>e.start){var n=o.getModel();t=n.getText(e.start,e.end)}return[new s.CommandParameter("find","text","Find:",t)]}),E=this,S=new s.Command({name:e.Find,tooltip:e.Find,id:"orion.editor.find",parameters:w,callback:function(e){if(E._searcher){var t="",n=null,r=o.getSelection();if(r.end>r.start){var i=o.getModel();t=i.getText(r.start,r.end)}else e.parameters&&e.parameters.valueFor("find")&&(t=e.parameters.valueFor("find"),n=h.matchResourceParameters(),c.convertFindURLBinding(n));if(n){E._searcher.setOptions({useRegExp:n.regEx,ignoreCase:!n.caseSensitive});if(n.atLine){var s=o.getModel().getLineStart(n.atLine-1);o.moveSelection(s,s,function(){E._searcher.buildToolBar(t,n.replaceWith),E._searcher.findNext(!0)},focus)}else E._searcher.buildToolBar(t,n.replaceWith),E._searcher.findNext(!0)}else E._searcher.buildToolBar(t);return!0}return!1}});this.commandService.addCommand(S),this.commandService.registerCommandContribution(this.pageNavId,"orion.editor.find",2,null,!0,new s.CommandKeyBinding("f",!0),new s.URLBinding("find","find")),o.getTextView().setKeyBinding(new f.KeyBinding("f",!0),"find"),o.getTextView().setAction("find",function(){return m.commandService.runCommand("orion.editor.find"),!0},S);var x=this.serviceRegistry.getServiceReferences("orion.edit.command"),T=this.inputManager,N=this.serviceRegistry.getService("orion.page.progress"),C=function(n,r,u){return u.callback=function(s){o=this;var u=o.getSelection(),a=o.getModel(),f=a.getText(),l=function(e){e&&e.text?(o.setText(e.text),e.selection&&(o.setSelection(e.selection.start,e.selection.end),o.getTextView().focus())):typeof e=="string"&&(o.setText(e,u.start,u.end),o.setSelection(u.start,u.start+e.length),o.getTextView().focus())};return N.progress(r.run(a.getText(u.start,u.end),f,u,T.getInput()),t.formatMessage(e["Running {0}"],n.name)).then(function(e){if(e&&e.uriTemplate){var t=new i(e.uriTemplate),r=t.expand(T.getFileMetadata()),s=document.createElement("iframe");s.id=n.id,s.name=n.id,s.type="text/html",s.sandbox="allow-scripts allow-same-origin",s.frameborder=1,s.src=r,s.className="delegatedUI",e.width&&(s.style.width=e.width),e.height&&(s.style.height=e.height),window.document.body.appendChild(s),window.addEventListener("message",function o(e){if(e.source!==s.contentWindow)return;if(typeof e.data=="string"){var t=JSON.parse(e.data);t.pageService==="orion.page.delegatedUI"&&t.source===n.id&&(t.cancelled||t.result&&l(t.result),window.removeEventListener("message",o,!1),window.document.body.removeChild(s))}},!1)}else l(e)}),!0},u.callback=u.callback.bind(o),new s.Command(u)};r.when(l(this.serviceRegistry),function(){var e=[],t=100;x.forEach(function(n){var r=m.serviceRegistry.getService(n),i={},s=n.getPropertyKeys();for(var a=0;a<s.length;a++)i[s[a]]=n.getProperty(s[a]);i.forceSingleItem=!0;var f=u._createCommandOptions(i,n,m.serviceRegistry,d,!1,function(e){return T.getFileMetadata()});e.push(f),f.then(function(e){var n=C(i,r,e);m.commandService.addCommand(n),m.commandService.registerCommandContribution(m.toolbarId,n.id,t);if(i.key){var s=o.getTextView();s.setKeyBinding(p(i.key),n.id),s.setAction(n.id,n.callback,n)}}),t++}),r.all(e,function(e){return{_error:e}}).then(function(e){if(T.getFileMetadata()){var t=n.node("pageActions");t&&(m.commandService.destroy(t),m.commandService.renderCommands(t.id,t,o,o,"button")),t=n.node("pageNavigationActions"),t&&(m.commandService.destroy(t),m.commandService.renderCommands(t.id,t,o,o,"button"))}})})}}},o}(),p.UndoCommandFactory=function(){function t(e,t,n){this.serviceRegistry=e,this.commandService=t,this.toolbarId=n}return t.prototype={createUndoStack:function(t){var n=new l.UndoStack(t.getTextView(),200),r=new s.Command({name:e.Undo,id:"orion.undo",callback:function(e){this.getTextView().invokeAction("undo")}});t.getTextView().setAction("undo",function(){return n.undo(),!0},r),this.commandService.addCommand(r);var i=new s.Command({name:e.Redo,id:"orion.redo",callback:function(e){this.getTextView().invokeAction("redo")}});return t.getTextView().setAction("redo",function(){return n.redo(),!0},i),this.commandService.addCommand(i),this.commandService.registerCommandContribution(this.toolbarId,"orion.undo",400,null,!0,t.getTextView().getKeyBindings("undo")[0]),this.commandService.registerCommandContribution(this.toolbarId,"orion.redo",401,null,!0,t.getTextView().getKeyBindings("redo")[0]),n}},t}(),p}),define("orion/editor/textModel",["orion/editor/eventTarget","orion/editor/util"],function(e,t){function n(e,t){this._lastLineIndex=-1,this._text=[""],this._lineOffsets=[0],this.setText(e),this.setLineDelimiter(t)}return n.prototype={find:function(e){this._text.length>1&&(this._text=[this._text.join("")]);var t=e.string,n=e.regex,r=t;!n&&t&&(r=t.replace(/([\\$\^*\/+?\.\(\)|{}\[\]])/g,"\\$&"));var i=null,s;if(r){var o=e.reverse,u=e.wrap,a=e.wholeWord,f=e.caseInsensitive,l=e.start||0,c=e.end,h=e.end!==undefined,p="";p.indexOf("g")===-1&&(p+="g"),f&&p.indexOf("i")===-1&&(p+="i"),a&&(r="\\b"+r+"\\b");var d=this._text[0],v,m,g=0;h&&(d=d.substring(l,c),g=l);var y=new RegExp(r,p);o?s=function(){var e=null;y.lastIndex=0;for(;;){m=y.lastIndex,v=y.exec(d);if(m===y.lastIndex)return null;if(!v)break;if(v.index<l)e={start:v.index+g,end:y.lastIndex+g};else{if(!u||e)break;l=d.length,e={start:v.index+g,end:y.lastIndex+g}}}return e&&(l=e.start),e}:(h||(y.lastIndex=l),s=function(){for(;;){m=y.lastIndex,v=y.exec(d);if(m===y.lastIndex)return null;if(v)return{start:v.index+g,end:y.lastIndex+g};if(m!==0&&u)continue;break}return null}),i=s()}return{next:function(){var e=i;return e&&(i=s()),e},hasNext:function(){return i!==null}}},getCharCount:function(){var e=0;for(var t=0;t<this._text.length;t++)e+=this._text[t].length;return e},getLine:function(e,t){var n=this.getLineCount();if(0<=e&&e<n){var r=this._lineOffsets[e];if(e+1<n){var i=this.getText(r,this._lineOffsets[e+1]);if(t)return i;var s=i.length,o;while((o=i.charCodeAt(s-1))===10||o===13)s--;return i.substring(0,s)}return this.getText(r)}return null},getLineAtOffset:function(e){var t=this.getCharCount();if(0<=e&&e<=t){var n=this.getLineCount();if(e===t)return n-1;var r,i,s=this._lastLineIndex;if(0<=s&&s<n){r=this._lineOffsets[s],i=s+1<n?this._lineOffsets[s+1]:t;if(r<=e&&e<i)return s}var o=n,u=-1;while(o-u>1){s=Math.floor((o+u)/2),r=this._lineOffsets[s],i=s+1<n?this._lineOffsets[s+1]:t;if(e<=r)o=s;else{if(e<i){o=s;break}u=s}}return this._lastLineIndex=o,o}return-1},getLineCount:function(){return this._lineOffsets.length},getLineDelimiter:function(){return this._lineDelimiter},getLineEnd:function(e,t){var n=this.getLineCount();if(0<=e&&e<n){if(e+1<n){var r=this._lineOffsets[e+1];if(t)return r;var i=this.getText(Math.max(this._lineOffsets[e],r-2),r),s=i.length,o;while((o=i.charCodeAt(s-1))===10||o===13)s--;return r-(i.length-s)}return this.getCharCount()}return-1},getLineStart:function(e){return 0<=e&&e<this.getLineCount()?this._lineOffsets[e]:-1},getText:function(e,t){e===undefined&&(e=0),t===undefined&&(t=this.getCharCount());if(e===t)return"";var n=0,r=0,i;while(r<this._text.length){i=this._text[r].length;if(e<=n+i)break;n+=i,r++}var s=n,o=r;while(r<this._text.length){i=this._text[r].length;if(t<=n+i)break;n+=i,r++}var u=n,a=r;if(o===a)return this._text[o].substring(e-s,t-u);var f=this._text[o].substring(e-s),l=this._text[a].substring(0,t-u);return f+this._text.slice(o+1,a).join("")+l},onChanging:function(e){return this.dispatchEvent(e)},onChanged:function(e){return this.dispatchEvent(e)},setLineDelimiter:function(e,n){e==="auto"&&(e=undefined,this.getLineCount()>1&&(e=this.getText(this.getLineEnd(0),this.getLineEnd(0,!0)))),this._lineDelimiter=e?e:t.platformDelimiter;if(n){var r=this.getLineCount();if(r>1){var i=new Array(r);for(var s=0;s<r;s++)i[s]=this.getLine(s);this.setText(i.join(this._lineDelimiter))}}},setText:function(e,t,n){e===undefined&&(e=""),t===undefined&&(t=0),n===undefined&&(n=this.getCharCount());if(t===n&&e==="")return;var r=this.getLineAtOffset(t),i=this.getLineAtOffset(n),s=t,o=n-t,u=i-r,a=e.length,f=0,l=this.getLineCount(),c=0,h=0,p=0,d=[];for(;;){c!==-1&&c<=p&&(c=e.indexOf("\r",p)),h!==-1&&h<=p&&(h=e.indexOf("\n",p));if(h===-1&&c===-1)break;c!==-1&&h!==-1?c+1===h?p=h+1:p=(c<h?c:h)+1:c!==-1?p=c+1:p=h+1,d.push(t+p),f++}var v={type:"Changing",text:e,start:s,removedCharCount:o,addedCharCount:a,removedLineCount:u,addedLineCount:f};this.onChanging(v);if(d.length===0){var m=this.getLineStart(r),g;i+1<l?g=this.getLineStart(i+1):g=this.getCharCount(),t!==m&&(e=this.getText(m,t)+e,t=m),n!==g&&(e+=this.getText(n,g),n=g)}var y=a-o;for(var b=r+u+1;b<l;b++)this._lineOffsets[b]+=y;var w=[r+1,u].concat(d);Array.prototype.splice.apply(this._lineOffsets,w);var E=0,S=0,x;while(S<this._text.length){x=this._text[S].length;if(t<=E+x)break;E+=x,S++}var T=E,N=S;while(S<this._text.length){x=this._text[S].length;if(n<=E+x)break;E+=x,S++}var C=E,k=S,L=this._text[N],A=this._text[k],O=L.substring(0,t-T),M=A.substring(n-C),_=[N,k-N+1];O&&_.push(O),e&&_.push(e),M&&_.push(M),Array.prototype.splice.apply(this._text,_),this._text.length===0&&(this._text=[""]);var D={type:"Changed",start:s,removedCharCount:o,addedCharCount:a,removedLineCount:u,addedLineCount:f};this.onChanged(D)}},e.EventTarget.addMixin(n.prototype),{TextModel:n}}),define("orion/editor/textView",["orion/editor/textModel","orion/editor/keyBinding","orion/editor/eventTarget","orion/editor/util"],function(e,t,n,r){function i(e){return e.defaultView||e.parentWindow}function s(e,t,n,r){typeof e.addEventListener=="function"?e.addEventListener(t,n,r===!0):e.attachEvent("on"+t,n)}function o(e,t,n,r){typeof e.removeEventListener=="function"?e.removeEventListener(t,n,r===!0):e.detachEvent("on"+t,n)}function u(e,t,n){if(n){t.className="";var i=t.attributes;for(var s=i.length;s-->0;)(!r.isIE||r.isIE>=9||r.isIE<9&&i[s].specified)&&t.removeAttribute(i[s].name)}if(!e)return;e.styleClass&&(t.className=e.styleClass);var o=e.style;if(o)for(var u in o)o.hasOwnProperty(u)&&(t.style[u]=o[u]);var a=e.attributes;if(a)for(var f in a)a.hasOwnProperty(f)&&t.setAttribute(f,a[f])}function a(e){return e instanceof Array?e.slice(0):e}function f(e,t){if(e===t)return!0;if(e&&!t||!e&&t)return!1;if(e&&e.constructor===String||t&&t.constructor===String)return!1;if(e instanceof Array||t instanceof Array){if(e instanceof Array&&t instanceof Array){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!f(e[n],t[n]))return!1;return!0}return!1}if(e instanceof Object&&t instanceof Object){var r;for(r in e)if(e.hasOwnProperty(r)){if(!t.hasOwnProperty(r))return!1;if(!f(e[r],t[r]))return!1}for(r in t)if(!e.hasOwnProperty(r))return!1;return!0}return!1}function l(e,t,n){var r=0,i=0,s=0,o=e.length;while(s<o){r!==-1&&r<=s&&(r=e.indexOf("\r",s)),i!==-1&&i<=s&&(i=e.indexOf("\n",s));var u=s,a;if(i===-1&&r===-1){t(e.substring(s));break}r!==-1&&i!==-1?r+1===i?(a=r,s=i+1):(a=r<i?r:i,s=(r<i?r:i)+1):r!==-1?(a=r,s=r+1):(a=i,s=i+1),t(e.substring(u,a)),n()}}function c(e){var t,n,r,s,o=i(e.ownerDocument);if(o.getComputedStyle){var u=o.getComputedStyle(e,null);t=u.getPropertyValue("border-left-width"),n=u.getPropertyValue("border-top-width"),r=u.getPropertyValue("border-right-width"),s=u.getPropertyValue("border-bottom-width")}else e.currentStyle&&(t=e.currentStyle.borderLeftWidth,n=e.currentStyle.borderTopWidth,r=e.currentStyle.borderRightWidth,s=e.currentStyle.borderBottomWidth);return{left:parseInt(t,10)||0,top:parseInt(n,10)||0,right:parseInt(r,10)||0,bottom:parseInt(s,10)||0}}function h(e){var t,n,r,s,o=i(e.ownerDocument);if(o.getComputedStyle){var u=o.getComputedStyle(e,null);t=u.getPropertyValue("padding-left"),n=u.getPropertyValue("padding-top"),r=u.getPropertyValue("padding-right"),s=u.getPropertyValue("padding-bottom")}else e.currentStyle&&(t=e.currentStyle.paddingLeft,n=e.currentStyle.paddingTop,r=e.currentStyle.paddingRight,s=e.currentStyle.paddingBottom);return{left:parseInt(t,10)||0,top:parseInt(n,10)||0,right:parseInt(r,10)||0,bottom:parseInt(s,10)||0}}function p(e){var t=e._trim;if(!t){t=h(e);var n=c(e);t.left+=n.left,t.top+=n.top,t.right+=n.right,t.bottom+=n.bottom,e._trim=t}return t}function d(e,t,n){this.start=e,this.end=t,this.caret=n}function v(e){this.left=e.left,this.top=e.top,this.right=e.right,this.bottom=e.bottom}function m(e,t,n){this.view=e,this.lineIndex=t,this._lineDiv=n}function y(e){this._init(e)}d.prototype={clone:function(){return new d(this.start,this.end,this.caret)},collapse:function(){this.caret?this.end=this.start:this.start=this.end},extend:function(e){this.caret?this.start=e:this.end=e;if(this.start>this.end){var t=this.start;this.start=this.end,this.end=t,this.caret=!this.caret}},setCaret:function(e){this.start=e,this.end=e,this.caret=!1},getCaret:function(){return this.caret?this.start:this.end},toString:function(){return"start="+this.start+" end="+this.end+(this.caret?" caret is at start":" caret is at end")},isEmpty:function(){return this.start===this.end},equals:function(e){return this.caret===e.caret&&this.start===e.start&&this.end===e.end}},v.prototype={toString:function(){return"{l="+this.left+", t="+this.top+", r="+this.right+", b="+this.bottom+"}"}},m.prototype={create:function(e,t){if(this._lineDiv)return;var n=this._lineDiv=this._createLine(e,t,this.lineIndex);return n._line=this,n},_createLine:function(e,t,n){var i=this.view,s=i._model,o=s.getLine(n),a=s.getLineStart(n),l={type:"LineStyle",textView:i,lineIndex:n,lineText:o,lineStart:a};o.length<2e3&&i.onLineStyle(l);var c=t||r.createElement(e.ownerDocument,"div");if(!t||!f(t.viewStyle,l.style))u(l.style,c,t),t&&(t._trim=null),c.viewStyle=l.style,c.setAttribute("role","presentation");c.lineIndex=n;var h=[],p={tabOffset:0,ranges:h};this._createRanges(l.ranges,o,0,o.length,a,p);var d=" ";!i._fullSelection&&r.isIE<9&&(d="\ufeff"),r.isWebkit&&(d="\u200c"),h.push({text:d,style:i._metrics.largestFontStyle,ignoreChars:1});var v,m,g,y,b,w,E,S=0,x=0,T,N,C;if(t){var k=t.modelChangedEvent;k&&(k.removedLineCount===0&&k.addedLineCount===0?(C=k.start-a,N=k.addedCharCount-k.removedCharCount):C=-1,t.modelChangedEvent=undefined),y=t.firstChild}for(var L=0;L<h.length;L++){v=h[L],w=v.text,S+=w.length,g=v.style;if(y){E=y.firstChild.data,b=y.viewStyle;if(E===w&&f(g,b)){x+=E.length,y._rectsCache=undefined,m=y=y.nextSibling;continue}while(y){if(C!==-1){var A=S;A>=C&&(A-=N);var O=y.firstChild.data,M=O?O.length:0;if(x+M>A)break;x+=M}T=y.nextSibling,c.removeChild(y),y=T}}m=this._createSpan(c,w,g,v.ignoreChars),y?c.insertBefore(m,y):c.appendChild(m),t&&(t.lineWidth=undefined)}if(t){var _=m?m.nextSibling:null;while(_)T=_.nextSibling,t.removeChild(_),_=T}else e.appendChild(c);return c},_createRanges:function(e,t,n,r,i,s){if(n>=r)return;if(e)for(var o=0;o<e.length;o++){var u=e[o];if(u.end<=i+n)continue;var a=Math.max(i+n,u.start)-i;if(a>=r)break;var l=Math.min(i+r,u.end)-i;if(a<l){a=Math.max(n,a),l=Math.min(r,l),n<a&&this._createRange(t,n,a,null,s);while(o+1<e.length&&e[o+1].start-i===l&&f(u.style,e[o+1].style))u=e[o+1],l=Math.min(i+r,u.end)-i,o++;this._createRange(t,a,l,u.style,s),n=l}}n<r&&this._createRange(t,n,r,null,s)},_createRange:function(e,t,n,r,i){if(t>=n)return;var s=this.view._customTabSize,o;if(s&&s!==8){var u=e.indexOf("	",t);while(u!==-1&&u<n){t<u&&(o={text:e.substring(t,u),style:r},i.ranges.push(o),i.tabOffset+=o.text.length);var a=s-i.tabOffset%s;if(a>0){var f="\u00a0";for(var l=1;l<a;l++)f+=" ";o={text:f,style:r,ignoreChars:a-1},i.ranges.push(o),i.tabOffset+=o.text.length}t=u+1,u=e.indexOf("	",t)}}t<n&&(o={text:e.substring(t,n),style:r},i.ranges.push(o),i.tabOffset+=o.text.length)},_createSpan:function(e,t,n,i){var o=n&&n.tagName==="A";o&&(e.hasLink=!0);var a=o&&this.view._linksVisible?"a":"span",f=e.ownerDocument,l=r.createElement(e.ownerDocument,a);l.appendChild(f.createTextNode(t)),u(n,l);if(a==="A"){var c=this.view,h=this._getWindow();s(l,"click",function(e){return c._handleLinkClick(e?e:h.event)},!1)}return l.viewStyle=n,i&&(l.ignoreChars=i),l},_ensureCreated:function(){return this._lineDiv?this._lineDiv:this._createdDiv=this.create(this.view._clientDiv,null)},getBoundingClientRect:function(e,t){var n=this._ensureCreated(),s=this.view;if(e===undefined)return this._getLineBoundingClientRect(n,!0);var o=s._model,u=n.ownerDocument,a=this.lineIndex,f=null;if(e<o.getLineEnd(a)){var l=o.getLineStart(a),c=n.firstChild;while(c){var h=c.firstChild,p=h.length;c.ignoreChars&&(p-=c.ignoreChars);if(l+p>e){var d=e-l,m;if(s._isRangeRects)m=u.createRange(),m.setStart(h,d),m.setEnd(h,d+1),f=new v(m.getBoundingClientRect());else if(r.isIE)m=u.body.createTextRange(),m.moveToElementText(c),m.collapse(),m.moveEnd("character",d+1),m.moveStart("character",d),f=new v(m.getBoundingClientRect());else{var g=h.data;c.removeChild(h),c.appendChild(u.createTextNode(g.substring(0,d)));var y=r.createElement(u,"span");y.appendChild(u.createTextNode(g.substring(d,d+1))),c.appendChild(y),c.appendChild(u.createTextNode(g.substring(d+1))),f=new v(y.getBoundingClientRect()),c.innerHTML="",c.appendChild(h);if(!this._createdDiv){var b=s._getSelection();(l<=b.start&&b.start<l+p||l<=b.end&&b.end<l+p)&&s._updateDOMSelection()}}if(r.isIE){var w=i(n.ownerDocument),E=w.screen.logicalXDPI/w.screen.deviceXDPI,S=w.screen.logicalYDPI/w.screen.deviceYDPI;f.left=f.left*E,f.right=f.right*E,f.top=f.top*S,f.bottom=f.bottom*S}break}l+=p,c=c.nextSibling}}var x=this.getBoundingClientRect();if(!f)if(s._wrapMode){var T=this.getClientRects();f=T[T.length-1],f.left=f.right,f.left+=x.left,f.top+=x.top,f.right+=x.left,f.bottom+=x.top}else f=new v(x),f.left=f.right;if(t||t===undefined)f.left-=x.left,f.top-=x.top,f.right-=x.left,f.bottom-=x.top;return f},_getClientRects:function(e,t){var n,r,i,s;if(!e._rectsCache){n=e.getClientRects(),r=new Array(n.length);for(s=0;s<n.length;s++)i=r[s]=new v(n[s]),i.left-=t.left,i.top-=t.top,i.right-=t.left,i.bottom-=t.top;e._rectsCache=r}n=e._rectsCache,r=[n.length];for(s=0;s<n.length;s++)r[s]=new v(n[s]);return r},getClientRects:function(e){if(!this.view._wrapMode)return[this.getBoundingClientRect()];var t=this._ensureCreated(),n=[],r=t.firstChild,i,s,o=t.getBoundingClientRect();while(r){var u=this._getClientRects(r,o);for(i=0;i<u.length;i++){var a=u[i],f;if(a.top===a.bottom)continue;var l=a.top+(a.bottom-a.top)/2;for(f=0;f<n.length;f++){s=n[f];if(s.top<=l&&l<s.bottom)break}f===n.length?n.push(a):(a.left<s.left&&(s.left=a.left),a.top<s.top&&(s.top=a.top),a.right>s.right&&(s.right=a.right),a.bottom>s.bottom&&(s.bottom=a.bottom))}r=r.nextSibling}return e!==undefined?n[e]:n},_getLineBoundingClientRect:function(e,t){var n=new v(e.getBoundingClientRect());if(!this.view._wrapMode){n.right=n.left;var r=e.lastChild;while(r&&r.ignoreChars===r.firstChild.length)r=r.previousSibling;if(r){var i=r.getBoundingClientRect();n.right=i.right+p(e).right}}if(t){var s=p(e);n.left=n.left+s.left,n.right=n.right-s.right}return n},getLineCount:function(){return this.view._wrapMode?this.getClientRects().length:1},getLineIndex:function(e){if(!this.view._wrapMode)return 0;var t=this.getClientRects(),n=this.getBoundingClientRect(e),r=n.top+(n.bottom-n.top)/2;for(var i=0;i<t.length;i++)if(t[i].top<=r&&r<t[i].bottom)return i;return t.length-1},getLineStart:function(e){if(!this.view._wrapMode||e===0)return this.view._model.getLineStart(e);var t=this.getClientRects();return this.getOffset(t[e].left+1,t[e].top+1)},getOffset:function(e,t){var n=this.view,s=n._model,o=this.lineIndex,u=s.getLineStart(o),a=s.getLineEnd(o);if(u===a)return u;var f=this._ensureCreated(),l=this.getBoundingClientRect(),c,h;if(n._wrapMode){c=this.getClientRects(),t<c[0].top&&(t=c[0].top);for(var p=0;p<c.length;p++){h=c[p];if(h.top<=t&&t<h.bottom)break}e<h.left&&(e=h.left),e>h.right&&(e=h.right-1)}else e<0&&(e=0),e>l.right-l.left&&(e=l.right-l.left);var d=f.ownerDocument,v=i(d),m=r.isIE?v.screen.logicalXDPI/v.screen.deviceXDPI:1,g=r.isIE?v.screen.logicalYDPI/v.screen.deviceYDPI:1,y=u,b=f.firstChild;e:while(b){var w=b.firstChild,E=w.length;b.ignoreChars&&(E-=b.ignoreChars);var S,x,T,N;c=this._getClientRects(b,l);for(var C=0;C<c.length;C++){h=c[C];if(h.left<=e&&e<h.right&&(!n._wrapMode||h.top<=t&&t<h.bottom)){var k,L,A;if(r.isIE||n._isRangeRects){k=n._isRangeRects?d.createRange():d.body.createTextRange();var O=E,M=-1;while(O-M>1){var _=Math.floor((O+M)/2);L=M+1,A=_===E-1&&b.ignoreChars?w.length:_+1,n._isRangeRects?(k.setStart(w,L),k.setEnd(w,A)):(k.moveToElementText(b),k.move("character",L),k.moveEnd("character",A-L)),c=k.getClientRects();var D=!1;for(var P=0;P<c.length;P++){h=c[P],S=h.left*m-l.left,T=h.right*m-l.left,x=h.top*g-l.top,N=h.bottom*g-l.top;if(S<=e&&e<T&&(!n._wrapMode||x<=t&&t<N)){D=!0;break}}D?O=_:M=_}y+=O,L=O,A=O===E-1&&b.ignoreChars?w.length:Math.min(O+1,w.length),n._isRangeRects?(k.setStart(w,L),k.setEnd(w,A)):(k.moveToElementText(b),k.move("character",L),k.moveEnd("character",A-L)),h=k.getClientRects()[0],S=h.left*m-l.left,T=h.right*m-l.left,e>S+(T-S)/2&&y++}else{var H=[];for(var B=0;B<E;B++)H.push("<span>"),B===E-1?H.push(w.data.substring(B)):H.push(w.data.substring(B,B+1)),H.push("</span>");b.innerHTML=H.join("");var j=b.firstChild;while(j){h=j.getBoundingClientRect(),S=h.left-l.left,T=h.right-l.left;if(S<=e&&e<T){e>S+(T-S)/2&&y++;break}y++,j=j.nextSibling}if(!this._createdDiv){b.innerHTML="",b.appendChild(w);var F=n._getSelection();(y<=F.start&&F.start<y+E||y<=F.end&&F.end<y+E)&&n._updateDOMSelection()}}break e}}y+=E,b=b.nextSibling}return Math.min(a,Math.max(u,y))},getNextOffset:function(e,t,n){if(t==="line"){var i=this.view,s=i._model,o=s.getLineAtOffset(e);return n>0?s.getLineEnd(o):s.getLineStart(o)}return t==="wordend"?this._getNextOffset_W3C(e,t,n):r.isIE?this._getNextOffset_IE(e,t,n):this._getNextOffset_W3C(e,t,n)},_getNextOffset_W3C:function(e,t,n){function r(e){return 33<=e&&e<=47||58<=e&&e<=64||91<=e&&e<=94||e===96||123<=e&&e<=126}function i(e){return e===32||e===9}if(t==="word"||t==="wordend"){var s=this.view,o=s._model,u=o.getLineAtOffset(e),a=o.getLine(u),f=o.getLineStart(u),l=o.getLineEnd(u),c=a.length,h=e-f,p,d,v,m,g;if(n>0){if(h===c)return l;p=a.charCodeAt(h),d=r(p),v=!d&&!i(p),h++;while(h<c){p=a.charCodeAt(h),m=r(p);if(t==="wordend"){if(!m&&d)break}else if(m&&!d)break;g=!m&&!i(p);if(t==="wordend"){if(!g&&v)break}else if(g&&!v)break;v=g,d=m,h++}}else{if(h===0)return f;h--,p=a.charCodeAt(h),d=r(p),v=!d&&!i(p);while(0<h){p=a.charCodeAt(h-1),m=r(p);if(t==="wordend"){if(m&&!d)break}else if(!m&&d)break;g=!m&&!i(p);if(t==="wordend"){if(g&&!v)break}else if(!g&&v)break;v=g,d=m,h--}}return f+h}return e+n},_getNextOffset_IE:function(e,t,n){var r=this._ensureCreated(),i=this.view,s=i._model,o=this.lineIndex,u=0,a,f,l=s.getLineStart(o),c=r.ownerDocument;if(e===s.getLineEnd(o))a=c.body.createTextRange(),a.moveToElementText(r.lastChild),f=a.text.length,a.moveEnd(t,n),u=e+a.text.length-f;else if(e===l&&n<0)u=l;else{var h=r.firstChild;while(h){var p=h.firstChild,d=p.length;h.ignoreChars&&(d-=h.ignoreChars);if(l+d>e){a=c.body.createTextRange(),e===l&&n<0?a.moveToElementText(h.previousSibling):(a.moveToElementText(h),a.collapse(),a.moveEnd("character",e-l)),f=a.text.length,a.moveEnd(t,n),u=e+a.text.length-f;break}l=d+l,h=h.nextSibling}}return u},destroy:function(){var e=this._createdDiv;e&&(e.parentNode.removeChild(e),this._createdDiv=null)}};var g=15;return y.prototype={addRuler:function(e,t){e.setView(this);var n=this._rulers;if(t!==undefined){var r,i;for(r=0,i=0;r<n.length&&i<t;r++)e.getLocation()===n[r].getLocation()&&i++;n.splice(i,0,e),t=i}else n.push(e);this._createRuler(e,t),this._update()},computeSize:function(){var e=0,t=0,n=this._model,i=this._clientDiv;if(!i)return{width:e,height:t};var s=i.style.width;r.isWebkit&&(i.style.width="0x7fffffffpx");var o=n.getLineCount();for(var u=0;u<o;u++){var a=this._getLine(u),f=a.getBoundingClientRect();e=Math.max(e,f.right-f.left),t+=f.bottom-f.top,a.destroy()}r.isWebkit&&(i.style.width=s);var l=this._getViewPadding();return e+=l.right+l.left,t+=l.bottom+l.top,{width:e,height:t}},convert:function(e,t,n){if(!this._clientDiv)return;var r=this._getScroll(),i=this._getViewPadding(),s=this._viewDiv.getBoundingClientRect();return t==="document"&&(e.x!==undefined&&(e.x+=-r.x+s.left+i.left),e.y!==undefined&&(e.y+=-r.y+s.top+i.top)),n==="document"&&(e.x!==undefined&&(e.x+=r.x-s.left-i.left),e.y!==undefined&&(e.y+=r.y-s.top-i.top)),e},destroy:function(){for(var e=0;e<this._rulers.length;e++)this._rulers[e].setView(null);this.rulers=null,this._destroyView();var t={type:"Destroy"};this.onDestroy(t),this._parent=null,this._model=null,this._selection=null,this._doubleClickSelection=null,this._keyBindings=null,this._actions=null},focus:function(){if(!this._clientDiv)return;this._updateDOMSelection(),r.isOpera&&this._clientDiv.blur(),this._clientDiv.focus(),this._updateDOMSelection()},hasFocus:function(){return this._hasFocus},getActionDescription:function(e){var t=this._actions[e];return t?t.actionDescription:undefined},getActions:function(e){var t=[],n=this._actions;for(var r in n)if(n.hasOwnProperty(r)){if(!e&&n[r].defaultHandler)continue;t.push(r)}return t},getBottomIndex:function(e){return this._clientDiv?this._getBottomIndex(e):0},getBottomPixel:function(){return this._clientDiv?this._getScroll().y+this._getClientHeight():0},getCaretOffset:function(){var e=this._getSelection();return e.getCaret()},getClientArea:function(){if(!this._clientDiv)return{x:0,y:0,width:0,height:0};var e=this._getScroll();return{x:e.x,y:e.y,width:this._getClientWidth(),height:this._getClientHeight()}},getHorizontalPixel:function(){return this._clientDiv?this._getScroll().x:0},getKeyBindings:function(e){var t=[],n=this._keyBindings;for(var r=0;r<n.length;r++)n[r].actionID===e&&t.push(n[r].keyBinding);return t},getLineHeight:function(e){return this._clientDiv?this._getLineHeight(e):0},getLineIndex:function(e){return this._clientDiv?this._getLineIndex(e):0},getLinePixel:function(e){return this._clientDiv?this._getLinePixel(e):0},getLocationAtOffset:function(e){if(!this._clientDiv)return{x:0,y:0};var t=this._model;e=Math.min(Math.max(0,e),t.getCharCount());var n=t.getLineAtOffset(e),r=this._getLine(n),i=r.getBoundingClientRect(e);r.destroy();var s=i.left,o=this._getLinePixel(n)+i.top;return{x:s,y:o}},getOptions:function(){var e;if(arguments.length===0)e=this._defaultOptions();else if(arguments.length===1){var t=arguments[0];if(typeof t=="string")return a(this["_"+t]);e=t}else{e={};for(var n in arguments)arguments.hasOwnProperty(n)&&(e[arguments[n]]=undefined)}for(var r in e)e.hasOwnProperty(r)&&(e[r]=a(this["_"+r]));return e},getModel:function(){return this._model},getOffsetAtLocation:function(e,t){if(!this._clientDiv)return 0;var n=this._getLineIndex(t),r=this._getLine(n),i=r.getOffset(e,t-this._getLinePixel(n));return r.destroy(),i},getRulers:function(){return this._rulers.slice(0)},getSelection:function(){var e=this._getSelection();return{start:e.start,end:e.end}},getText:function(e,t){var n=this._model;return n.getText(e,t)},getTopIndex:function(e){return this._clientDiv?this._getTopIndex(e):0},getTopPixel:function(){return this._clientDiv?this._getScroll().y:0},invokeAction:function(e,t){if(!this._clientDiv)return;var n=this._actions[e];if(n){if(!t&&n.handler&&n.handler())return;if(n.defaultHandler)return n.defaultHandler()}return!1},isDestroyed:function(){return!this._clientDiv},onContextMenu:function(e){return this.dispatchEvent(e)},onDragStart:function(e){return this.dispatchEvent(e)},onDrag:function(e){return this.dispatchEvent(e)},onDragEnd:function(e){return this.dispatchEvent(e)},onDragEnter:function(e){return this.dispatchEvent(e)},onDragOver:function(e){return this.dispatchEvent(e)},onDragLeave:function(e){return this.dispatchEvent(e)},onDrop:function(e){return this.dispatchEvent(e)},onDestroy:function(e){return this.dispatchEvent(e)},onLineStyle:function(e){return this.dispatchEvent(e)},onModelChanged:function(e){return this.dispatchEvent(e)},onModelChanging:function(e){return this.dispatchEvent(e)},onModify:function(e){return this.dispatchEvent(e)},onMouseDown:function(e){return this.dispatchEvent(e)},onMouseUp:function(e){return this.dispatchEvent(e)},onMouseMove:function(e){return this.dispatchEvent(e)},onMouseOver:function(e){return this.dispatchEvent(e)},onMouseOut:function(e){return this.dispatchEvent(e)},onSelection:function(e){return this.dispatchEvent(e)},onScroll:function(e){return this.dispatchEvent(e)},onVerify:function(e){return this.dispatchEvent(e)},onFocus:function(e){return this.dispatchEvent(e)},onBlur:function(e){return this.dispatchEvent(e)},redraw:function(){if(this._redrawCount>0)return;var e=this._model.getLineCount();this.redrawRulers(0,e),this.redrawLines(0,e)},redrawRulers:function(e,t){if(this._redrawCount>0)return;var n=this.getRulers();for(var r=0;r<n.length;r++)this.redrawLines(e,t,n[r])},redrawLines:function(e,t,n){if(this._redrawCount>0)return;e===undefined&&(e=0),t===undefined&&(t=this._model.getLineCount());if(e===t)return;var r=this._clientDiv;if(!r)return;if(n){var i=n.getLocation(),s=i==="left"?this._leftDiv:this._rightDiv,o=s.firstChild.rows[0].cells;for(var u=0;u<o.length;u++)if(o[u].firstChild._ruler===n){r=o[u].firstChild;break}}n?r.rulerChanged=!0:this._lineHeight&&this._resetLineHeight(e,t);if(!n||n.getOverview()==="page"){var a=r.firstChild;while(a){var f=a.lineIndex;e<=f&&f<t&&(a.lineChanged=!0),a=a.nextSibling}}n||this._wrapMode||e<=this._maxLineIndex&&this._maxLineIndex<t&&(this._checkMaxLineIndex=this._maxLineIndex,this._maxLineIndex=-1,this._maxLineWidth=0),this._queueUpdate()},redrawRange:function(e,t){if(this._redrawCount>0)return;var n=this._model;e===undefined&&(e=0),t===undefined&&(t=n.getCharCount());var r=n.getLineAtOffset(e),i=n.getLineAtOffset(Math.max(e,t-1))+1;this.redrawLines(r,i)},removeRuler:function(e){var t=this._rulers;for(var n=0;n<t.length;n++)if(t[n]===e){t.splice(n,1),e.setView(null),this._destroyRuler(e),this._update();break}},resize:function(){if(!this._clientDiv)return;this._handleResize(null)},setAction:function(e,t,n){if(!e)return;var r=this._actions,i=r[e];i||(i=r[e]={}),i.handler=t,i.actionDescription=n},setKeyBinding:function(e,t){var n=this._keyBindings;for(var r=0;r<n.length;r++){var i=n[r];if(i.keyBinding.equals(e)){t?i.actionID=t:i.predefined?i.actionID=null:n.splice(r,1);return}}t&&n.push({keyBinding:e,actionID:t})},setCaretOffset:function(e,t){var n=this._model.getCharCount();e=Math.max(0,Math.min(e,n));var r=new d(e,e,!1);this._setSelection(r,t===undefined||t)},setHorizontalPixel:function(e){if(!this._clientDiv)return;e=Math.max(0,e),this._scrollView(e-this._getScroll().x,0)},setRedraw:function(e){e?--this._redrawCount===0&&this.redraw():this._redrawCount++},setModel:function(e){if(!e)return;if(e===this._model)return;this._model.removeEventListener("preChanging",this._modelListener.onChanging),this._model.removeEventListener("postChanged",this._modelListener.onChanged);var t=this._model.getLineCount(),n=this._model.getCharCount(),r=e.getLineCount(),i=e.getCharCount(),s=e.getText(),o={type:"ModelChanging",text:s,start:0,removedCharCount:n,addedCharCount:i,removedLineCount:t,addedLineCount:r};this.onModelChanging(o),this._model=e,o={type:"ModelChanged",start:0,removedCharCount:n,addedCharCount:i,removedLineCount:t,addedLineCount:r},this.onModelChanged(o),this._model.addEventListener("preChanging",this._modelListener.onChanging),this._model.addEventListener("postChanged",this._modelListener.onChanged),this._reset(),this._update()},setOptions:function(e){var t=this._defaultOptions();for(var n in e)if(e.hasOwnProperty(n)){var r=e[n],i=this["_"+n];if(f(i,r))continue;var s=t[n]?t[n].update:null;if(s){s.call(this,r);continue}this["_"+n]=a(r)}},setSelection:function(e,t,n){var r=e>t;if(r){var i=e;e=t,t=i}var s=this._model.getCharCount();e=Math.max(0,Math.min(e,s)),t=Math.max(0,Math.min(t,s));var o=new d(e,t,r);this._setSelection(o,n===undefined||n)},setText:function(e,t,n){var i=t===undefined&&n===undefined;t===undefined&&(t=0),n===undefined&&(n=this._model.getCharCount()),this._modifyContent({text:e,start:t,end:n,_code:!0},!i),i&&(this._columnX=-1,this._setSelection(new d(0,0,!1),!0),r.isFirefox&&this._fixCaret())},setTopIndex:function(e){if(!this._clientDiv)return;this._scrollView(0,this._getLinePixel(Math.max(0,e))-this._getScroll().y)},setTopPixel:function(e){if(!this._clientDiv)return;this._scrollView(0,Math.max(0,e)-this._getScroll().y)},showSelection:function(){return this._showCaret(!0)},update:function(e,t){if(!this._clientDiv)return;e&&this._updateStyle(),t===undefined||t?this._update():this._queueUpdate()},_handleRootMouseDown:function(e){r.isFirefox&&e.which===1&&(this._clientDiv.contentEditable=!1,(this._overlayDiv||this._clientDiv).draggable=!0,this._ignoreBlur=!0);var t=this._overlayDiv||this._clientDiv;r.isIE<9&&(t=this._viewDiv);var n=e.target?e.target:e.srcElement;while(n){if(t===n)return;n=n.parentNode}e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation();if(!this._isW3CEvents){var i=this,s=this._getWindow();s.setTimeout(function(){i._clientDiv.focus()},0)}},_handleRootMouseUp:function(e){r.isFirefox&&e.which===1&&(this._clientDiv.contentEditable=!0,(this._overlayDiv||this._clientDiv).draggable=!1,this._fixCaret(),this._ignoreBlur=!1)},_handleBlur:function(e){if(this._ignoreBlur)return;this._hasFocus=!1;if(r.isIE<9&&!this._getSelection().isEmpty()){var t=this._rootDiv,n=r.createElement(t.ownerDocument,"div");t.appendChild(n),t.removeChild(n)}if(this._selDiv1){var i="lightgray";this._selDiv1.style.background=i,this._selDiv2.style.background=i,this._selDiv3.style.background=i;var s,o=this._getWindow(),u=this._selDiv1.ownerDocument;if(o.getSelection){var a=o.getSelection();s=a.anchorNode;while(s){if(s===this._clientDiv){a.rangeCount>0&&a.removeAllRanges();break}s=s.parentNode}}else if(u.selection){this._ignoreSelect=!1,s=u.selection.createRange().parentElement();while(s){if(s===this._clientDiv){u.selection.empty();break}s=s.parentNode}this._ignoreSelect=!0}}this._ignoreFocus||this.onBlur({type:"Blur"})},_handleContextMenu:function(e){r.isIE&&this._lastMouseButton===3&&this._updateDOMSelection();var t=!1;if(this.isListening("ContextMenu")){var n=this._createMouseEvent("ContextMenu",e);n.screenX=e.screenX,n.screenY=e.screenY,this.onContextMenu(n),t=n.defaultPrevented}if(t)return e.preventDefault&&e.preventDefault(),!1},_handleCopy:function(e){if(this._ignoreCopy)return;if(this._doCopy(e))return e.preventDefault&&e.preventDefault(),!1},_handleCut:function(e){if(this._doCut(e))return e.preventDefault&&e.preventDefault(),!1},_handleDataModified:function(e){this._startIME()},_handleDblclick:function(e){var t=e.timeStamp?e.timeStamp:(new Date).getTime();this._lastMouseTime=t,this._clickCount!==2&&(this._clickCount=2,this._handleMouse(e))},_handleDragStart:function(e){if(r.isFirefox){var t=this,n=this._getWindow();n.setTimeout(function(){t._clientDiv.contentEditable=!0,t._clientDiv.draggable=!1,t._ignoreBlur=!1},0)}if(!this.isListening("DragStart")||this._dragOffset===-1)return e.preventDefault&&e.preventDefault(),!1;this._isMouseDown=!1,this.onDragStart(this._createMouseEvent("DragStart",e)),this._dragOffset=-1},_handleDrag:function(e){this.isListening("Drag")&&this.onDrag(this._createMouseEvent("Drag",e))},_handleDragEnd:function(e){this._dropTarget=!1,this._dragOffset=-1,this.isListening("DragEnd")&&this.onDragEnd(this._createMouseEvent("DragEnd",e)),r.isFirefox&&(this._fixCaret(),e.dataTransfer.dropEffect==="none"&&!e.dataTransfer.mozUserCancelled&&this._fixCaret())},_handleDragEnter:function(e){var t=!0;this._dropTarget=!0,this.isListening("DragEnter")&&(t=!1,this.onDragEnter(this._createMouseEvent("DragEnter",e)));if(r.isWebkit||t)return e.preventDefault&&e.preventDefault(),!1},_handleDragOver:function(e){var t=!0;this.isListening("DragOver")&&(t=!1,this.onDragOver(this._createMouseEvent("DragOver",e)));if(r.isWebkit||t)return t&&(e.dataTransfer.dropEffect="none"),e.preventDefault&&e.preventDefault(),!1},_handleDragLeave:function(e){this._dropTarget=!1,this.isListening("DragLeave")&&this.onDragLeave(this._createMouseEvent("DragLeave",e))},_handleDrop:function(e){return this._dropTarget=!1,this.isListening("Drop")&&this.onDrop(this._createMouseEvent("Drop",e)),e.preventDefault&&e.preventDefault(),!1},_handleFocus:function(e){this._hasFocus=!0,r.isIOS&&this._lastTouchOffset!==undefined?(this.setCaretOffset(this._lastTouchOffset,!0),this._lastTouchOffset=undefined):this._updateDOMSelection();if(this._selDiv1){var t=this._highlightRGB;this._selDiv1.style.background=t,this._selDiv2.style.background=t,this._selDiv3.style.background=t}this._ignoreFocus||this.onFocus({type:"Focus"})},_handleKeyDown:function(e){var t=!1;switch(e.keyCode){case 16:case 17:case 18:case 91:t=!0;break;default:this._setLinksVisible(!1)}if(e.keyCode===229){if(this._readonly)return e.preventDefault&&e.preventDefault(),!1;var n=!0;r.isSafari&&r.isMac&&e.ctrlKey&&(n=!1),n&&this._startIME()}else t||this._commitIME();if((r.isMac||r.isLinux)&&r.isFirefox<4||r.isOpera)return this._keyDownEvent=e,!0;if(this._doAction(e))return e.preventDefault?(e.preventDefault(),e.stopPropagation()):(e.cancelBubble=!0,e.returnValue=!1,e.keyCode=0),!1},_handleKeyPress:function(e){if(r.isMac&&r.isWebkit)if(63232<=e.keyCode&&e.keyCode<=63487||e.keyCode===13||e.keyCode===8)return e.preventDefault&&e.preventDefault(),!1;if((r.isMac||r.isLinux)&&r.isFirefox<4||r.isOpera)if(this._doAction(this._keyDownEvent))return e.preventDefault&&e.preventDefault(),!1;var t=r.isMac?e.metaKey:e.ctrlKey;if(e.charCode!==undefined&&t)switch(e.charCode){case 99:case 118:case 120:return!0}var n=!1;if(r.isMac){if(e.ctrlKey||e.metaKey)n=!0}else if(r.isFirefox){if(e.ctrlKey||e.altKey)n=!0}else e.ctrlKey^e.altKey&&(n=!0);if(!n){var i=r.isOpera?e.which:e.charCode!==undefined?e.charCode:e.keyCode;if(i>31)return this._doContent(String.fromCharCode(i)),e.preventDefault&&e.preventDefault(),!1}},_handleKeyUp:function(e){var t=r.isMac?e.metaKey:e.ctrlKey;t||this._setLinksVisible(!1),e.keyCode===13&&this._commitIME()},_handleLinkClick:function(e){var t=r.isMac?e.metaKey:e.ctrlKey;if(!t)return e.preventDefault&&e.preventDefault(),!1},_handleMouse:function(e){var t=this._getWindow(),n=!0,i=t;if(r.isIE||r.isFirefox&&!this._overlayDiv)i=this._clientDiv;if(this._overlayDiv){this._hasFocus&&(this._ignoreFocus=!0);var s=this;t.setTimeout(function(){s.focus(),s._ignoreFocus=!1},0)}return this._clickCount===1?(n=this._setSelectionTo(e.clientX,e.clientY,e.shiftKey,!r.isOpera&&this._hasFocus&&this.isListening("DragStart")),n&&this._setGrab(i)):(this._isW3CEvents&&this._setGrab(i),this._doubleClickSelection=null,this._setSelectionTo(e.clientX,e.clientY,e.shiftKey),this._doubleClickSelection=this._getSelection()),n},_handleMouseDown:function(e){if(this._linksVisible){var t=e.target||e.srcElement;if(t.tagName==="A")return;this._setLinksVisible(!1)}this._commitIME();var n=e.which;n||(e.button===4&&(n=2),e.button===2&&(n=3),e.button===1&&(n=1));var i=n!==2&&e.timeStamp?e.timeStamp:(new Date).getTime(),s=i-this._lastMouseTime,o=Math.abs(this._lastMouseX-e.clientX),u=Math.abs(this._lastMouseY-e.clientY),a=this._lastMouseButton===n;this._lastMouseX=e.clientX,this._lastMouseY=e.clientY,this._lastMouseTime=i,this._lastMouseButton=n,n===1&&(this._isMouseDown=!0,a&&s<=this._clickTime&&o<=this._clickDist&&u<=this._clickDist?this._clickCount++:this._clickCount=1);if(this.isListening("MouseDown")){var f=this._createMouseEvent("MouseDown",e);this.onMouseDown(f);if(f.defaultPrevented){e.preventDefault();return}}n===1&&this._handleMouse(e)&&(r.isIE>=9||r.isOpera||r.isChrome||r.isSafari||r.isFirefox&&!this._overlayDiv)&&(this._hasFocus||this.focus(),e.preventDefault()),r.isFirefox&&this._lastMouseButton===3&&this._updateDOMSelection()},_handleMouseOver:function(e){this.isListening("MouseOver")&&this.onMouseOver(this._createMouseEvent("MouseOver",e))},_handleMouseOut:function(e){this.isListening("MouseOut")&&this.onMouseOut(this._createMouseEvent("MouseOut",e))},_handleMouseMove:function(e){var t=this._isClientDiv(e);this.isListening("MouseMove")&&t&&this.onMouseMove(this._createMouseEvent("MouseMove",e));if(this._dropTarget)return;var n=this._linksVisible||this._lastMouseMoveX!==e.clientX||this._lastMouseMoveY!==e.clientY;this._lastMouseMoveX=e.clientX,this._lastMouseMoveY=e.clientY,this._setLinksVisible(n&&!this._isMouseDown&&(r.isMac?e.metaKey:e.ctrlKey));if(!this._isW3CEvents){if(e.button===0)return this._setGrab(null),!0;if(!this._isMouseDown&&e.button===1&&(this._clickCount&1)!==0&&t)return this._clickCount=2,this._handleMouse(e,this._clickCount)}if(!this._isMouseDown||this._dragOffset!==-1)return;var i=e.clientX,s=e.clientY,o=this._getViewPadding(),u=this._viewDiv.getBoundingClientRect(),a=this._getClientWidth(),f=this._getClientHeight(),l=u.left+o.left,c=u.top+o.top,h=u.left+o.left+a,p=u.top+o.top+f,d=this._model,v=d.getLineAtOffset(this._getSelection().getCaret());s<c&&v!==0?this._doAutoScroll("up",i,s-c):s>p&&v!==d.getLineCount()-1?this._doAutoScroll("down",i,s-p):i<l&&!this._wrapMode?this._doAutoScroll("left",i-l,s):i>h&&!this._wrapMode?this._doAutoScroll("right",i-h,s):(this._endAutoScroll(),this._setSelectionTo(i,s,!0))},_isClientDiv:function(e){var t=this._overlayDiv||this._clientDiv,n=e.target?e.target:e.srcElement;while(n){if(t===n)return!0;n=n.parentNode}return!1},_createMouseEvent:function(e,t){var n=this.convert({x:t.clientX,y:t.clientY},"page","document");return{type:e,event:t,clickCount:this._clickCount,x:n.x,y:n.y,preventDefault:function(){this.defaultPrevented=!0}}},_handleMouseUp:function(e){var t=e.which?e.button===0:e.button===1;this.isListening("MouseUp")&&(this._isClientDiv(e)||t&&this._isMouseDown)&&this.onMouseUp(this._createMouseEvent("MouseUp",e));if(this._linksVisible)return;if(t&&this._isMouseDown){if(this._dragOffset!==-1){var n=this._getSelection();n.extend(this._dragOffset),n.collapse(),this._setSelection(n,!0,!0),this._dragOffset=-1}this._isMouseDown=!1,this._endAutoScroll(),this._isW3CEvents&&this._setGrab(null),r.isFirefox&&e.preventDefault()}},_handleMouseWheel:function(e){var t=this._getLineHeight(),n=0,i=0;if(r.isIE||r.isOpera)i=-e.wheelDelta/40*t;else if(r.isFirefox){var s;if(r.isMac)s=e.detail*3;else{var o=256;s=Math.max(-o,Math.min(o,e.detail))*t}e.axis===e.HORIZONTAL_AXIS?n=s:i=s}else if(r.isMac){var u=40,a=40;e.wheelDeltaX%120!==0&&(u=1),e.wheelDeltaY%120!==0&&(a=1),n=-e.wheelDeltaX/u,-1<n&&n<0&&(n=-1),0<n&&n<1&&(n=1),i=-e.wheelDeltaY/a,-1<i&&i<0&&(i=-1),0<i&&i<1&&(i=1)}else{n=-e.wheelDeltaX;var f=8;i=-e.wheelDeltaY/120*f*t}if(r.isSafari){var l=e.target;while(l&&l.lineIndex===undefined)l=l.parentNode;this._mouseWheelLine=l}var c=this._getScroll();this._scrollView(n,i);var h=this._getScroll();if(c.x!==h.x||c.y!==h.y)return e.preventDefault&&e.preventDefault(),!1},_handlePaste:function(e){if(this._ignorePaste)return;if(this._doPaste(e)){if(r.isIE){var t=this;this._ignoreFocus=!0;var n=this._getWindow();n.setTimeout(function(){t._updateDOMSelection(),t._ignoreFocus=!1},0)}return e.preventDefault&&e.preventDefault(),!1}},_handleResize:function(e){var t=this._parent.clientWidth,n=this._parent.clientHeight;if(this._parentWidth!==t||this._parentHeight!==n)this._parentWidth!==t&&this._resetLineHeight(),this._parentWidth=t,this._parentHeight=n,r.isIE<9?this._queueUpdate():this._update()},_handleRulerEvent:function(e){var t=e.target?e.target:e.srcElement,n=t.lineIndex,r=t;while(r&&!r._ruler)n===undefined&&r.lineIndex!==undefined&&(n=r.lineIndex),r=r.parentNode;var i=r?r._ruler:null;if(n===undefined&&i&&i.getOverview()==="document"){var s=this._getClientHeight(),o=this._model.getLineCount(),u=this._getViewPadding(),a=this._viewDiv.getBoundingClientRect(),f=s+u.top+u.bottom-2*this._metrics.scrollWidth;n=Math.floor((e.clientY-a.top-this._metrics.scrollWidth)*o/f),0<=n&&n<o||(n=undefined)}if(i)switch(e.type){case"click":i.onClick&&i.onClick(n,e);break;case"dblclick":i.onDblClick&&i.onDblClick(n,e);break;case"mousemove":i.onMouseMove&&i.onMouseMove(n,e);break;case"mouseover":i.onMouseOver&&i.onMouseOver(n,e);break;case"mouseout":i.onMouseOut&&i.onMouseOut(n,e)}},_handleScroll:function(){var e=this._getScroll(),t=this._hScroll,n=this._vScroll;if(t!==e.x||n!==e.y){this._checkOverlayScroll(),this._hScroll=e.x,this._vScroll=e.y,this._commitIME(),this._update(n===e.y);var r={type:"Scroll",oldValue:{x:t,y:n},newValue:e};this.onScroll(r)}},_handleSelectStart:function(e){if(this._ignoreSelect)return e&&e.preventDefault&&e.preventDefault(),!1},_getModelOffset:function(e,t){if(!e)return;var n;e.tagName==="DIV"?n=e:n=e.parentNode.parentNode;var r=0,i=n.lineIndex;if(e.tagName!=="DIV"){var s=n.firstChild;while(s){var o=s.firstChild;if(o===e){s.ignoreChars&&(r-=s.ignoreChars),r+=t;break}s.ignoreChars&&(r-=s.ignoreChars),r+=o.data.length,s=s.nextSibling}}return Math.max(0,r)+this._model.getLineStart(i)},_updateSelectionFromDOM:function(){var e=this._getWindow(),t=e.getSelection(),n=this._getModelOffset(t.anchorNode,t.anchorOffset),r=this._getModelOffset(t.focusNode,t.focusOffset);if(n===undefined||r===undefined)return;this._setSelection(new d(n,r),!1,!1)},_handleSelectionChange:function(e){if(this._imeOffset!==-1)return;if(r.isAndroid){var t=this._getWindow();this._selTimer&&t.clearTimeout(this._selTimer);var n=this;this._selTimer=t.setTimeout(function(){if(!n._clientDiv)return;n._selTimer=null,n._updateSelectionFromDOM()},250)}else this._updateSelectionFromDOM()},_handleTextInput:function(e){this._imeOffset=-1;if(r.isAndroid){var t=this._getWindow().getSelection(),n=t.anchorNode;while(n){if(n.lineIndex!==undefined)break;n=n.parentNode}if(n){var i=this._model,s=n.lineIndex,o=i.getLine(s),u=o,a=0,f=i.getLineStart(s);if(t.rangeCount>0){t.getRangeAt(0).deleteContents();var l=n.ownerDocument.createTextNode(e.data);t.getRangeAt(0).insertNode(l);var c=this._getDOMText(n,l);u=c.text,a=c.offset,l.parentNode.removeChild(l)}n.lineRemoved=!0;var h=0;while(o.charCodeAt(h)===u.charCodeAt(h)&&h<a)h++;var p=o.length-1,d=u.length-o.length;while(o.charCodeAt(p)===u.charCodeAt(p+d)&&p+d>=a+e.data.length)p--;p++;var v=u.substring(h,p+d);h+=f,p+=f,this._modifyContent({text:v,start:h,end:p,_ignoreDOMSelection:!0},!0)}}else this._doContent(e.data);e.preventDefault()},_handleTouchStart:function(e){this._commitIME();var t=this._getWindow();this._touchScrollTimer&&(this._vScrollDiv.style.display="none",this._hScrollDiv.style.display="none",t.clearInterval(this._touchScrollTimer),this._touchScrollTimer=null);var n=e.touches;if(n.length===1){var i=n[0],s=i.clientX,o=i.clientY;this._touchStartX=s,this._touchStartY=o,r.isAndroid&&(o<i.pageY-t.pageYOffset||s<i.pageX-t.pageXOffset)&&(s=i.pageX-t.pageXOffset,o=i.pageY-t.pageYOffset);var u=this.convert({x:s,y:o},"page","document");this._lastTouchOffset=this.getOffsetAtLocation(u.x,u.y),this._touchStartTime=e.timeStamp,this._touching=!0}},_handleTouchMove:function(e){var t=e.touches;if(t.length===1){var n=t[0];this._touchCurrentX=n.clientX,this._touchCurrentY=n.clientY;var r=10;if(!this._touchScrollTimer&&e.timeStamp-this._touchStartTime<r*20){this._vScrollDiv.style.display="block",this._wrapMode||(this._hScrollDiv.style.display="block");var i=this,s=this._getWindow();this._touchScrollTimer=s.setInterval(function(){var e=0,t=0;if(i._touching)e=i._touchStartX-i._touchCurrentX,t=i._touchStartY-i._touchCurrentY,i._touchSpeedX=e/r,i._touchSpeedY=t/r,i._touchStartX=i._touchCurrentX,i._touchStartY=i._touchCurrentY;else{if(Math.abs(i._touchSpeedX)<.1&&Math.abs(i._touchSpeedY)<.1){i._vScrollDiv.style.display="none",i._hScrollDiv.style.display="none",s.clearInterval(i._touchScrollTimer),i._touchScrollTimer=null;return}e=i._touchSpeedX*r,t=i._touchSpeedY*r,i._touchSpeedX*=.95,i._touchSpeedY*=.95}i._scrollView(e,t)},r)}this._touchScrollTimer&&e.preventDefault()}},_handleTouchEnd:function(e){var t=e.touches;t.length===0&&(this._touching=!1)},_doAction:function(e){var t=this._keyBindings;for(var n=0;n<t.length;n++){var r=t[n];if(r.keyBinding.match(e)){if(r.actionID){var i=this._actions,s=i[r.actionID];if(s)if(s.handler){if(!s.handler())return s.defaultHandler?typeof s.defaultHandler()=="boolean":!1}else if(s.defaultHandler)return typeof s.defaultHandler()=="boolean"}return!0}}return!1},_doBackspace:function(e){var t=this._getSelection();if(t.isEmpty()){var n=this._model,r=t.getCaret(),i=n.getLineAtOffset(r),s=n.getLineStart(i);if(r===s)i>0&&t.extend(n.getLineEnd(i-1));else{var o=!1;if(this._expandTab&&e.unit==="character"&&(r-s)%this._tabSize===0){var u=n.getText(s,r);o=!/[^ ]/.test(u)}if(o)t.extend(r-this._tabSize);else{var a=this._getLine(i);t.extend(a.getNextOffset(r,e.unit,-1)),a.destroy()}}}return this._modifyContent({text:"",start:t.start,end:t.end},!0),!0},_doContent:function(e){var t=this._getSelection();this._modifyContent({text:e,start:t.start,end:t.end,_ignoreDOMSelection:!0},!0)},_doCopy:function(e){var t=this._getSelection();if(!t.isEmpty()){var n=this._getBaseText(t.start,t.end);return this._setClipboardText(n,e)}return!0},_doCursorNext:function(e){if(!e.select&&this._clearSelection("next"))return!0;var t=this._model,n=this._getSelection(),r=n.getCaret(),i=t.getLineAtOffset(r);if(r===t.getLineEnd(i))i+1<t.getLineCount()&&n.extend(t.getLineStart(i+1));else{var s=this._getLine(i);n.extend(s.getNextOffset(r,e.unit,1)),s.destroy()}return e.select||n.collapse(),this._setSelection(n,!0),!0},_doCursorPrevious:function(e){if(!e.select&&this._clearSelection("previous"))return!0;var t=this._model,n=this._getSelection(),r=n.getCaret(),i=t.getLineAtOffset(r);if(r===t.getLineStart(i))i>0&&n.extend(t.getLineEnd(i-1));else{var s=this._getLine(i);n.extend(s.getNextOffset(r,e.unit,-1)),s.destroy()}return e.select||n.collapse(),this._setSelection(n,!0),!0},_doCut:function(e){var t=this._getSelection();if(!t.isEmpty()){var n=this._getBaseText(t.start,t.end);return this._doContent(""),this._setClipboardText(n,e)}return!0},_doDelete:function(e){var t=this._getSelection();if(t.isEmpty()){var n=this._model,r=t.getCaret(),i=n.getLineAtOffset(r);if(r===n.getLineEnd(i))i+1<n.getLineCount()&&t.extend(n.getLineStart(i+1));else{var s=this._getLine(i);t.extend(s.getNextOffset(r,e.unit,1)),s.destroy()}}return this._modifyContent({text:"",start:t.start,end:t.end},!0),!0},_doEnd:function(e){var t=this._getSelection(),n=this._model;if(e.ctrl)t.extend(n.getCharCount());else{var r=t.getCaret(),i=n.getLineAtOffset(r);if(this._wrapMode){var s=this._getLine(i),o=s.getLineIndex(r);o===s.getLineCount()-1?r=n.getLineEnd(i):r=s.getLineStart(o+1)-1,s.destroy()}else r=n.getLineEnd(i);t.extend(r)}return e.select||t.collapse(),this._setSelection(t,!0),!0},_doEnter:function(e){var t=this._model,n=this._getSelection();return this._doContent(t.getLineDelimiter()),e&&e.noCursor&&(n.end=n.start,this._setSelection(n)),!0},_doHome:function(e){var t=this._getSelection(),n=this._model;if(e.ctrl)t.extend(0);else{var r=t.getCaret(),i=n.getLineAtOffset(r);if(this._wrapMode){var s=this._getLine(i),o=s.getLineIndex(r);r=s.getLineStart(o),s.destroy()}else r=n.getLineStart(i);t.extend(r)}return e.select||t.collapse(),this._setSelection(t,!0),!0},_doLineDown:function(e){var t=this._model,n=this._getSelection(),i=n.getCaret(),s=t.getLineAtOffset(i),o,u=this._getLine(s),a=this._columnX,f=1,l=!1;if(a===-1||e.wholeLine||e.select&&r.isIE){var c=e.wholeLine?t.getLineEnd(s+1):i;a=u.getBoundingClientRect(c).left}return(o=u.getLineIndex(i))<u.getLineCount()-1?f=u.getClientRects(o+1).top+1:(l=s===t.getLineCount()-1,s++),l?e.select&&(n.extend(t.getCharCount()),this._setSelection(n,!0,!0)):(u.lineIndex!==s&&(u.destroy(),u=this._getLine(s)),n.extend(u.getOffset(a,f)),e.select||n.collapse(),this._setSelection(n,!0,!0)),this._columnX=a,u.destroy(),!0},_doLineUp:function(e){var t=this._model,n=this._getSelection(),i=n.getCaret(),s=t.getLineAtOffset(i),o,u=this._getLine(s),a=this._columnX,f=!1,l;if(a===-1||e.wholeLine||e.select&&r.isIE){var c=e.wholeLine?t.getLineStart(s-1):i;a=u.getBoundingClientRect(c).left}return(o=u.getLineIndex(i))>0?l=u.getClientRects(o-1).top+1:(f=s===0,f||(s--,l=this._getLineHeight(s)-1)),f?e.select&&(n.extend(0),this._setSelection(n,!0,!0)):(u.lineIndex!==s&&(u.destroy(),u=this._getLine(s)),n.extend(u.getOffset(a,l)),e.select||n.collapse(),this._setSelection(n,!0,!0)),this._columnX=a,u.destroy(),!0},_doPageDown:function(e){var t=this._model,n=this._getSelection(),i=n.getCaret(),s=t.getLineAtOffset(i),o=t.getLineCount(),u=this._getScroll(),a=this._getClientHeight(),f,l;if(this._lineHeight){f=this._columnX;var c=this._getBoundsAtOffset(i);if(f===-1||e.select&&r.isIE)f=c.left;var h=this._getLineIndex(c.top+a);l=this._getLine(h);var p=this._getLinePixel(h),d=c.top+a-p;i=l.getOffset(f,d);var v=l.getBoundingClientRect(i);return l.destroy(),n.extend(i),e.select||n.collapse(),this._setSelection(n,!0,!0,v.top+p-c.top),this._columnX=f,!0}if(s<o-1){var m=this._getLineHeight(),g=Math.floor(a/m),y=Math.min(o-s-1,g);y=Math.max(1,y),f=this._columnX;if(f===-1||e.select&&r.isIE)l=this._getLine(s),f=l.getBoundingClientRect(i).left,l.destroy();l=this._getLine(s+y),n.extend(l.getOffset(f,0)),l.destroy(),e.select||n.collapse();var b=o*m,w=u.y+y*m;w+a>b&&(w=b-a),this._setSelection(n,!0,!0,w-u.y),this._columnX=f}return!0},_doPageUp:function(e){var t=this._model,n=this._getSelection(),i=n.getCaret(),s=t.getLineAtOffset(i),o=this._getScroll(),u=this._getClientHeight(),a,f;if(this._lineHeight){a=this._columnX;var l=this._getBoundsAtOffset(i);if(a===-1||e.select&&r.isIE)a=l.left;var c=this._getLineIndex(l.bottom-u);f=this._getLine(c);var h=this._getLinePixel(c),p=l.bottom-u-h;i=f.getOffset(a,p);var d=f.getBoundingClientRect(i);return f.destroy(),n.extend(i),e.select||n.collapse(),this._setSelection(n,!0,!0,d.top+h-l.top),this._columnX=a,!0}if(s>0){var v=this._getLineHeight(),m=Math.floor(u/v),g=Math.max(1,Math.min(s,m));a=this._columnX;if(a===-1||e.select&&r.isIE)f=this._getLine(s),a=f.getBoundingClientRect(i).left,f.destroy();f=this._getLine(s-g),n.extend(f.getOffset(a,this._getLineHeight(s-g)-1)),f.destroy(),e.select||n.collapse();var y=Math.max(0,o.y-g*v);this._setSelection(n,!0,!0,y-o.y),this._columnX=a}return!0},_doPaste:function(e){var t=this,n=this._getClipboardText(e,function(e){if(e){if(r.isLinux&&t._lastMouseButton===2){var n=(new Date).getTime()-t._lastMouseTime;n<=t._clickTime&&t._setSelectionTo(t._lastMouseX,t._lastMouseY)}t._doContent(e)}});return n!==null},_doScroll:function(e){var t=e.type,n=this._model,r=n.getLineCount(),i=this._getClientHeight(),s=this._getLineHeight(),o=r*s,u=this._getScroll().y,a;switch(t){case"textStart":a=0;break;case"textEnd":a=o-i;break;case"pageDown":a=u+i;break;case"pageUp":a=u-i;break;case"centerLine":var f=this._getSelection(),l=n.getLineAtOffset(f.start),c=n.getLineAtOffset(f.end),h=(c-l+1)*s;a=l*s-i/2+h/2}return a!==undefined&&(a=Math.min(Math.max(0,a),o-i),this._scrollView(0,a-u)),!0},_doSelectAll:function(e){var t=this._model,n=this._getSelection();return n.setCaret(0),n.extend(t.getCharCount()),this._setSelection(n,!1),!0},_doTab:function(e){if(!this._tabMode||this._readonly)return;var t="	";if(this._expandTab){var n=this._model,r=this._getSelection().getCaret(),i=n.getLineAtOffset(r),s=n.getLineStart(i),o=this._tabSize-(r-s)%this._tabSize;t=(new Array(o+1)).join(" ")}return this._doContent(t),!0},_doShiftTab:function(e){if(!this._tabMode||this._readonly)return;return!0},_doTabMode:function(e){return this._tabMode=!this._tabMode,!0},_doWrapMode:function(e){return this.setOptions({wrapMode:!this.getOptions("wrapMode")}),!0},_autoScroll:function(){var e=this._getSelection(),t=this.convert({x:this._autoScrollX,y:this._autoScrollY},"page","document"),n=e.getCaret(),r=this._model.getLineAtOffset(n),i,s;if(this._autoScrollDir==="up"||this._autoScrollDir==="down"){var o=this._autoScrollY/this._getLineHeight();o=o<0?Math.floor(o):Math.ceil(o),i=r,i=Math.max(0,Math.min(this._model.getLineCount()-1,i+o))}else if(this._autoScrollDir==="left"||this._autoScrollDir==="right")i=this._getLineIndex(t.y),s=this._getLine(r),t.x+=s.getBoundingClientRect(n,!1).left,s.destroy();s=this._getLine(i),e.extend(s.getOffset(t.x,t.y-this._getLinePixel(i))),s.destroy(),this._setSelection(e,!0)},_autoScrollTimer:function(){this._autoScroll();var e=this,t=this._getWindow();this._autoScrollTimerID=t.setTimeout(function(){e._autoScrollTimer()},this._AUTO_SCROLL_RATE)},_calculateLineHeightTimer:function(e){if(!this._lineHeight)return;if(this._calculateLHTimer)return;var t=this._model.getLineCount(),n=0;if(e){var r=0,i=100,s=(new Date).getTime(),o=0;while(n<t){this._lineHeight[n]||(r++,o||(o=n),this._lineHeight[n]=this._calculateLineHeight(n)),n++;if((new Date).getTime()-s>i)break}this.redrawRulers(0,t),this._queueUpdate()}var u=this._getWindow();if(n!==t){var a=this;this._calculateLHTimer=u.setTimeout(function(){a._calculateLHTimer=null,a._calculateLineHeightTimer(!0)},0);return}this._calculateLHTimer&&(u.clearTimeout(this._calculateLHTimer),this._calculateLHTimer=undefined)},_calculateLineHeight:function(e){var t=this._getLine(e),n=t.getBoundingClientRect();return t.destroy(),Math.max(1,Math.ceil(n.bottom-n.top))},_calculateMetrics:function(){var e=this._clientDiv,t=e.ownerDocument,n=" ",i=r.createElement(t,"div");i.style.lineHeight="normal";var s=this._model,o=s.getLine(0),a={type:"LineStyle",textView:this,0:0,lineText:o,lineStart:0};this.onLineStyle(a),u(a.style,i),i.style.position="fixed",i.style.left="-1000px";var f=r.createElement(t,"span");f.appendChild(t.createTextNode(n)),i.appendChild(f);var l=r.createElement(t,"span");l.style.fontStyle="italic",l.appendChild(t.createTextNode(n)),i.appendChild(l);var c=r.createElement(t,"span");c.style.fontWeight="bold",c.appendChild(t.createTextNode(n)),i.appendChild(c);var d=r.createElement(t,"span");d.style.fontWeight="bold",d.style.fontStyle="italic",d.appendChild(t.createTextNode(n)),i.appendChild(d),e.appendChild(i);var v=i.getBoundingClientRect(),m=f.getBoundingClientRect(),g=l.getBoundingClientRect(),y=c.getBoundingClientRect(),b=d.getBoundingClientRect(),w=m.bottom-m.top,E=g.bottom-g.top,S=y.bottom-y.top,x=b.bottom-b.top,T=0,N=v.bottom-v.top<=0,C=Math.max(1,v.bottom-v.top);E>w&&(T=1),S>E&&(T=2),x>S&&(T=3);var k;T!==0&&(k={style:{}},(T&1)!==0&&(k.style.fontStyle="italic"),(T&2)!==0&&(k.style.fontWeight="bold"));var L=p(i);e.removeChild(i);var A=h(this._viewDiv),O=r.createElement(t,"div");O.style.position="fixed",O.style.left="-1000px",O.style.paddingLeft=A.left+"px",O.style.paddingTop=A.top+"px",O.style.paddingRight=A.right+"px",O.style.paddingBottom=A.bottom+"px",O.style.width="100px",O.style.height="100px";var M=r.createElement(t,"div");M.style.width="100%",M.style.height="100%",O.appendChild(M),e.appendChild(O);var _=O.getBoundingClientRect(),D=M.getBoundingClientRect();O.style.overflow="hidden",M.style.height="200px";var P=O.clientWidth;O.style.overflow="scroll";var H=O.clientWidth;e.removeChild(O);var B=P-H;return A={left:D.left-_.left,top:D.top-_.top,right:_.right-D.right,bottom:_.bottom-D.bottom},{lineHeight:C,largestFontStyle:k,lineTrim:L,viewPadding:A,scrollWidth:B,invalid:N}},_checkOverlayScroll:function(){if(!r.isMac)return;var e=this,t=this._getWindow();this._overlayScrollTimer&&t.clearTimeout(this._overlayScrollTimer);var n=function(){var r=e._isOverOverlayScroll();r.vertical||r.horizontal?e._overlayScrollTimer=t.setTimeout(n,200):(e._overlayScrollTimer=undefined,e._update())};this._overlayScrollTimer=t.setTimeout(n,200)},_clearSelection:function(e){var t=this._getSelection();return t.isEmpty()?!1:(e==="next"?t.start=t.end:t.end=t.start,this._setSelection(t,!0),!0)},_commitIME:function(){if(this._imeOffset===-1)return;this._scrollDiv.focus(),this._clientDiv.focus();var e=this._model,t=e.getLineAtOffset(this._imeOffset),n=e.getLineStart(t),r=this._getDOMText(this._getLineNode(t)).text,i=e.getLine(t),s=this._imeOffset-n,o=s+r.length-i.length;if(s!==o){var u=r.substring(s,o);this._doContent(u)}this._imeOffset=-1},_createActions:function(){var e=t.KeyBinding,n=this._keyBindings=[];n.push({actionID:"lineUp",keyBinding:new e(38),predefined:!0}),n.push({actionID:"lineDown",keyBinding:new e(40),predefined:!0}),n.push({actionID:"charPrevious",keyBinding:new e(37),predefined:!0}),n.push({actionID:"charNext",keyBinding:new e(39),predefined:!0}),r.isMac?(n.push({actionID:"scrollPageUp",keyBinding:new e(33),predefined:!0}),n.push({actionID:"scrollPageDown",keyBinding:new e(34),predefined:!0}),n.push({actionID:"pageUp",keyBinding:new e(33,null,null,!0),predefined:!0}),n.push({actionID:"pageDown",keyBinding:new e(34,null,null,!0),predefined:!0}),n.push({actionID:"lineStart",keyBinding:new e(37,!0),predefined:!0}),n.push({actionID:"lineEnd",keyBinding:new e(39,!0),predefined:!0}),n.push({actionID:"wordPrevious",keyBinding:new e(37,null,null,!0),predefined:!0}),n.push({actionID:"wordNext",keyBinding:new e(39,null,null,!0),predefined:!0}),n.push({actionID:"scrollTextStart",keyBinding:new e(36),predefined:!0}),n.push({actionID:"scrollTextEnd",keyBinding:new e(35),predefined:!0}),n.push({actionID:"textStart",keyBinding:new e(38,!0),predefined:!0}),n.push({actionID:"textEnd",keyBinding:new e(40,!0),predefined:!0}),n.push({actionID:"scrollPageUp",keyBinding:new e(38,null,null,null,!0),predefined:!0}),n.push({actionID:"scrollPageDown",keyBinding:new e(40,null,null,null,!0),predefined:!0}),n.push({actionID:"lineStart",keyBinding:new e(37,null,null,null,!0),predefined:!0}),n.push({actionID:"lineEnd",keyBinding:new e(39,null,null,null,!0),predefined:!0}),n.push({actionID:"lineStart",keyBinding:new e(38,null,null,!0),predefined:!0}),n.push({actionID:"lineEnd",keyBinding:new e(40,null,null,!0),predefined:!0})):(n.push({actionID:"pageUp",keyBinding:new e(33),predefined:!0}),n.push({actionID:"pageDown",keyBinding:new e(34),predefined:!0}),n.push({actionID:"lineStart",keyBinding:new e(36),predefined:!0}),n.push({actionID:"lineEnd",keyBinding:new e(35),predefined:!0}),n.push({actionID:"wordPrevious",keyBinding:new e(37,!0),predefined:!0}),n.push({actionID:"wordNext",keyBinding:new e(39,!0),predefined:!0}),n.push({actionID:"textStart",keyBinding:new e(36,!0),predefined:!0}),n.push({actionID:"textEnd",keyBinding:new e(35,!0),predefined:!0})),r.isFirefox&&r.isLinux&&(n.push({actionID:"lineUp",keyBinding:new e(38,!0),predefined:!0}),n.push({actionID:"lineDown",keyBinding:new e(40,!0),predefined:!0})),n.push({actionID:"selectLineUp",keyBinding:new e(38,null,!0),predefined:!0}),n.push({actionID:"selectLineDown",keyBinding:new e(40,null,!0),predefined:!0}),n.push({actionID:"selectCharPrevious",keyBinding:new e(37,null,!0),predefined:!0}),n.push({actionID:"selectCharNext",keyBinding:new e(39,null,!0),predefined:!0}),n.push({actionID:"selectPageUp",keyBinding:new e(33,null,!0),predefined:!0}),n.push({actionID:"selectPageDown",keyBinding:new e(34,null,!0),predefined:!0}),r.isMac?(n.push({actionID:"selectLineStart",keyBinding:new e(37,!0,!0),predefined:!0}),n.push({actionID:"selectLineEnd",keyBinding:new e(39,!0,!0),predefined:!0}),n.push({actionID:"selectWordPrevious",keyBinding:new e(37,null,!0,!0),predefined:!0}),n.push({actionID:"selectWordNext",keyBinding:new e(39,null,!0,!0),predefined:!0}),n.push({actionID:"selectTextStart",keyBinding:new e(36,null,!0),predefined:!0}),n.push({actionID:"selectTextEnd",keyBinding:new e(35,null,!0),predefined:!0}),n.push({actionID:"selectTextStart",keyBinding:new e(38,!0,!0),predefined:!0}),n.push({actionID:"selectTextEnd",keyBinding:new e(40,!0,!0),predefined:!0}),n.push({actionID:"selectLineStart",keyBinding:new e(37,null,!0,null,!0),predefined:!0}),n.push({actionID:"selectLineEnd",keyBinding:new e(39,null,!0,null,!0),predefined:!0}),n.push({actionID:"selectLineStart",keyBinding:new e(38,null,!0,!0),predefined:!0}),n.push({actionID:"selectLineEnd",keyBinding:new e(40,null,!0,!0),predefined:!0})):(r.isLinux&&(n.push({actionID:"selectWholeLineUp",keyBinding:new e(38,!0,!0),predefined:!0}),n.push({actionID:"selectWholeLineDown",keyBinding:new e(40,!0,!0),predefined:!0})),n.push({actionID:"selectLineStart",keyBinding:new e(36,null,!0),predefined:!0}),n.push({actionID:"selectLineEnd",keyBinding:new e(35,null,!0),predefined:!0}),n.push({actionID:"selectWordPrevious",keyBinding:new e(37,!0,!0),predefined:!0}),n.push({actionID:"selectWordNext",keyBinding:new e(39,!0,!0),predefined:!0}),n.push({actionID:"selectTextStart",keyBinding:new e(36,!0,!0),predefined:!0}),n.push({actionID:"selectTextEnd",keyBinding:new e(35,!0,!0),predefined:!0})),n.push({actionID:"undo",keyBinding:new t.KeyBinding("z",!0),predefined:!0}),r.isMac?n.push({actionID:"redo",keyBinding:new t.KeyBinding("z",!0,!0),predefined:!0}):n.push({actionID:"redo",keyBinding:new t.KeyBinding("y",!0),predefined:!0}),n.push({actionID:"deletePrevious",keyBinding:new e(8),predefined:!0}),n.push({actionID:"deletePrevious",keyBinding:new e(8,null,!0),predefined:!0}),n.push({actionID:"deleteNext",keyBinding:new e(46),predefined:!0}),n.push({actionID:"deleteWordPrevious",keyBinding:new e(8,!0),predefined:!0}),n.push({actionID:"deleteWordPrevious",keyBinding:new e(8,!0,!0),predefined:!0}),n.push({actionID:"deleteWordNext",keyBinding:new e(46,!0),predefined:!0}),n.push({actionID:"tab",keyBinding:new e(9),predefined:!0}),n.push({actionID:"shiftTab",keyBinding:new e(9,null,!0),predefined:!0}),n.push({actionID:"enter",keyBinding:new e(13),predefined:!0}),n.push({actionID:"enter",keyBinding:new e(13,null,!0),predefined:!0}),n.push({actionID:"selectAll",keyBinding:new e("a",!0),predefined:!0}),n.push({actionID:"toggleTabMode",keyBinding:new e("m",!0),predefined:!0}),r.isMac&&(n.push({actionID:"deleteNext",keyBinding:new e(46,null,!0),predefined:!0}),n.push({actionID:"deleteWordPrevious",keyBinding:new e(8,null,null,!0),predefined:!0}),n.push({actionID:"deleteWordNext",keyBinding:new e(46,null,null,!0),predefined:!0}));if(!r.isFirefox){var i=r.isMac&&r.isChrome;n.push({actionID:null,keyBinding:new e("u",!i,!1,!1,i),predefined:!0}),n.push({actionID:null,keyBinding:new e("i",!i,!1,!1,i),predefined:!0}),n.push({actionID:null,keyBinding:new e("b",!i,!1,!1,i),predefined:!0})}r.isFirefox&&(n.push({actionID:"copy",keyBinding:new e(45,!0),predefined:!0}),n.push({actionID:"paste",keyBinding:new e(45,null,!0),predefined:!0}),n.push({actionID:"cut",keyBinding:new e(46,null,!0),predefined:!0})),r.isMac&&(n.push({actionID:"lineStart",keyBinding:new e("a",!1,!1,!1,!0),predefined:!0}),n.push({actionID:"lineEnd",keyBinding:new e("e",!1,!1,!1,!0),predefined:!0}),n.push({actionID:"lineUp",keyBinding:new e("p",!1,!1,!1,!0),predefined:!0}),n.push({actionID:"lineDown",keyBinding:new e("n",!1,!1,!1,!0),predefined:!0}),n.push({actionID:"charPrevious",keyBinding:new e("b",!1,!1,!1,!0),predefined:!0}),n.push({actionID:"charNext",keyBinding:new e("f",!1,!1,!1,!0),predefined:!0}),n.push({actionID:"deletePrevious",keyBinding:new e("h",!1,!1,!1,!0),predefined:!0}),n.push({actionID:"deleteNext",keyBinding:new e("d",!1,!1,!1,!0),predefined:!0}),n.push({actionID:"deleteLineEnd",keyBinding:new e("k",!1,!1,!1,!0),predefined:!0}),r.isFirefox?(n.push({actionID:"scrollPageDown",keyBinding:new e("v",!1,!1,!1,!0),predefined:!0}),n.push({actionID:"deleteLineStart",keyBinding:new e("u",!1,!1,!1,!0),predefined:!0}),n.push({actionID:"deleteWordPrevious",keyBinding:new e("w",!1,!1,!1,!0),predefined:!0})):(n.push({actionID:"pageDown",keyBinding:new e("v",!1,!1,!1,!0),predefined:!0}),n.push({actionID:"centerLine",keyBinding:new e("l",!1,!1,!1,!0),predefined:!0}),n.push({actionID:"enterNoCursor",keyBinding:new e("o",!1,!1,!1,!0),predefined:!0})));var s=this;this._actions={lineUp:{defaultHandler:function(){return s._doLineUp({select:!1})}},lineDown:{defaultHandler:function(){return s._doLineDown({select:!1})}},lineStart:{defaultHandler:function(){return s._doHome({select:!1,ctrl:!1})}},lineEnd:{defaultHandler:function(){return s._doEnd({select:!1,ctrl:!1})}},charPrevious:{defaultHandler:function(){return s._doCursorPrevious({select:!1,unit:"character"})}},charNext:{defaultHandler:function(){return s._doCursorNext({select:!1,unit:"character"})}},pageUp:{defaultHandler:function(){return s._doPageUp({select:!1})}},pageDown:{defaultHandler:function(){return s._doPageDown({select:!1})}},scrollPageUp:{defaultHandler:function(){return s._doScroll({type:"pageUp"})}},scrollPageDown:{defaultHandler:function(){return s._doScroll({type:"pageDown"})}},wordPrevious:{defaultHandler:function(){return s._doCursorPrevious({select:!1,unit:"word"})}},wordNext:{defaultHandler:function(){return s._doCursorNext({select:!1,unit:"word"})}},textStart:{defaultHandler:function(){return s._doHome({select:!1,ctrl:!0})}},textEnd:{defaultHandler:function(){return s._doEnd({select:!1,ctrl:!0})}},scrollTextStart:{defaultHandler:function(){return s._doScroll({type:"textStart"})}},scrollTextEnd:{defaultHandler:function(){return s._doScroll({type:"textEnd"})}},centerLine:{defaultHandler:function(){return s._doScroll({type:"centerLine"})}},selectLineUp:{defaultHandler:function(){return s._doLineUp({select:!0})}},selectLineDown:{defaultHandler:function(){return s._doLineDown({select:!0})}},selectWholeLineUp:{defaultHandler:function(){return s._doLineUp({select:!0,wholeLine:!0})}},selectWholeLineDown:{defaultHandler:function(){return s._doLineDown({select:!0,wholeLine:!0})}},selectLineStart:{defaultHandler:function(){return s._doHome({select:!0,ctrl:!1})}},selectLineEnd:{defaultHandler:function(){return s._doEnd({select:!0,ctrl:!1})}},selectCharPrevious:{defaultHandler:function(){return s._doCursorPrevious({select:!0,unit:"character"})}},selectCharNext:{defaultHandler:function(){return s._doCursorNext({select:!0,unit:"character"})}},selectPageUp:{defaultHandler:function(){return s._doPageUp({select:!0})}},selectPageDown:{defaultHandler:function(){return s._doPageDown({select:!0})}},selectWordPrevious:{defaultHandler:function(){return s._doCursorPrevious({select:!0,unit:"word"})}},selectWordNext:{defaultHandler:function(){return s._doCursorNext({select:!0,unit:"word"})}},selectTextStart:{defaultHandler:function(){return s._doHome({select:!0,ctrl:!0})}},selectTextEnd:{defaultHandler:function(){return s._doEnd({select:!0,ctrl:!0})}},deletePrevious:{defaultHandler:function(){return s._doBackspace({unit:"character"})}},deleteNext:{defaultHandler:function(){return s._doDelete({unit:"character"})}},deleteWordPrevious:{defaultHandler:function(){return s._doBackspace({unit:"word"})}},deleteWordNext:{defaultHandler:function(){return s._doDelete({unit:"word"})}},deleteLineStart:{defaultHandler:function(){return s._doBackspace({unit:"line"})}},deleteLineEnd:{defaultHandler:function(){return s._doDelete({unit:"line"})}},tab:{defaultHandler:function(){return s._doTab()}},shiftTab:{defaultHandler:function(){return s._doShiftTab()}},enter:{defaultHandler:function(){return s._doEnter()}},enterNoCursor:{defaultHandler:function(){return s._doEnter({noCursor:!0})}},selectAll:{defaultHandler:function(){return s._doSelectAll()}},copy:{defaultHandler:function(){return s._doCopy()}},cut:{defaultHandler:function(){return s._doCut()}},paste:{defaultHandler:function(){return s._doPaste()}},toggleWrapMode:{defaultHandler:function(){return s._doWrapMode()}},toggleTabMode:{defaultHandler:function(){return s._doTabMode()}}}},_createRuler:function(e,t){if(!this._clientDiv)return;var n=e.getLocation(),i=n==="left"?this._leftDiv:this._rightDiv;i.style.display="block";var s=r.createElement(i.ownerDocument,"div");s._ruler=e,s.rulerChanged=!0,s.style.position="relative";var o=i.firstChild.rows[0],u=o.cells.length;t=t===undefined||t<0||t>u?u:t;var a=o.insertCell(t);a.vAlign="top",a.style.verticalAlign="top",a.style.borderWidth="0px",a.style.margin="0px",a.style.padding="0px",a.style.outline="none",a.appendChild(s)},_createView:function(){if(this._clientDiv)return;var e=this._parent;while(e.hasChildNodes())e.removeChild(e.lastChild);var t=e.ownerDocument,n=r.createElement(t,"div");this._rootDiv=n,n.tabIndex=-1,n.style.position="relative",n.style.overflow="hidden",n.style.width="100%",n.style.height="100%",e.style.overflow="hidden",n.setAttribute("role","application"),e.appendChild(n);var i=r.createElement(t,"div");i.className="textviewLeftRuler",this._leftDiv=i,i.tabIndex=-1,i.style.overflow="hidden",i.style.MozUserSelect="none",i.style.WebkitUserSelect="none",i.style.position="absolute",i.style.cursor="default",i.style.display="none",i.setAttribute("aria-hidden","true");var s=r.createElement(t,"table");i.appendChild(s),s.cellPadding="0px",s.cellSpacing="0px",s.border="0px",s.style.borderWidth="0px",s.style.margin="0px",s.style.padding="0px",s.style.outline="none",s.style.lineHeight="normal";var o=s.insertRow(0);o.style.borderWidth="0px",o.style.margin="0px",o.style.padding="0px",o.style.outline="none",o.style.lineHeight="normal",n.appendChild(i);var u=r.createElement(t,"div");u.className="textview",this._viewDiv=u,u.tabIndex=-1,u.style.overflow="auto",u.style.position="absolute",u.style.top="0px",u.style.bottom="0px",u.style.borderWidth="0px",u.style.margin="0px",u.style.outline="none",n.appendChild(u);var a=r.createElement(t,"div");a.className="textviewRightRuler",this._rightDiv=a,a.tabIndex=-1,a.style.display="none",a.style.overflow="hidden",a.style.MozUserSelect="none",a.style.WebkitUserSelect="none",a.style.position="absolute",a.style.cursor="default",a.style.right="0px",a.setAttribute("aria-hidden","true"),s=r.createElement(t,"table"),a.appendChild(s),s.cellPadding="0px",s.cellSpacing="0px",s.border="0px",s.style.borderWidth="0px",s.style.margin="0px",s.style.padding="0px",s.style.outline="none",s.style.lineHeight="normal",o=s.insertRow(0),o.style.borderWidth="0px",o.style.margin="0px",o.style.padding="0px",o.style.outline="none",o.style.lineHeight="normal",n.appendChild(a);var f=r.createElement(t,"div");this._scrollDiv=f,f.style.margin="0px",f.style.borderWidth="0px",f.style.padding="0px",u.appendChild(f);if(r.isFirefox){var l=r.createElement(t,"div");this._clipboardDiv=l,l.style.position="fixed",l.style.whiteSpace="pre",l.style.left="-1000px",n.appendChild(l)}if(!r.isIE&&!r.isIOS){var c=r.createElement(t,"div");this._clipDiv=c,c.style.position="absolute",c.style.overflow="hidden",c.style.margin="0px",c.style.borderWidth="0px",c.style.padding="0px",n.appendChild(c);var h=r.createElement(t,"div");this._clipScrollDiv=h,h.style.position="absolute",h.style.height="1px",h.style.top="-1000px",c.appendChild(h)}this._setFullSelection(this._fullSelection,!0);var p=r.createElement(t,"div");p.className="textviewContent",this._clientDiv=p,p.style.position="absolute",p.style.borderWidth="0px",p.style.margin="0px",p.style.padding="0px",p.style.outline="none",p.style.zIndex="1",p.style.WebkitUserSelect="text",p.setAttribute("spellcheck","false");if(r.isIOS||r.isAndroid)p.style.WebkitTapHighlightColor="transparent";(this._clipDiv||n).appendChild(p);if(r.isIOS||r.isAndroid){var d=r.createElement(t,"div");this._vScrollDiv=d,d.style.position="absolute",d.style.borderWidth="1px",d.style.borderColor="white",d.style.borderStyle="solid",d.style.borderRadius="4px",d.style.backgroundColor="black",d.style.opacity="0.5",d.style.margin="0px",d.style.padding="0px",d.style.outline="none",d.style.zIndex="3",d.style.width="8px",d.style.display="none",n.appendChild(d);var v=r.createElement(t,"div");this._hScrollDiv=v,v.style.position="absolute",v.style.borderWidth="1px",v.style.borderColor="white",v.style.borderStyle="solid",v.style.borderRadius="4px",v.style.backgroundColor="black",v.style.opacity="0.5",v.style.margin="0px",v.style.padding="0px",v.style.outline="none",v.style.zIndex="3",v.style.height="8px",v.style.display="none",n.appendChild(v)}if(r.isFirefox&&!p.setCapture){var m=r.createElement(t,"div");this._overlayDiv=m,m.style.position=p.style.position,m.style.borderWidth=p.style.borderWidth,m.style.margin=p.style.margin,m.style.padding=p.style.padding,m.style.cursor="text",m.style.zIndex="2",(this._clipDiv||n).appendChild(m)}p.contentEditable="true",p.setAttribute("role","textbox"),p.setAttribute("aria-multiline","true"),this._setWrapMode(this._wrapMode,!0),this._setReadOnly(this._readonly),this._setThemeClass(this._themeClass,!0),this._setTabSize(this._tabSize,!0);if(!t.getElementById("_textviewStyle")){var g="";r.isWebkit&&this._metrics.scrollWidth>0&&(g+="\n.textviewContainer ::-webkit-scrollbar-corner {background: #eeeeee;}"),r.isFirefox&&r.isMac&&this._highlightRGB&&this._highlightRGB!=="Highlight"&&(g+="\n.textviewContainer ::-moz-selection {background: "+this._highlightRGB+";}");if(g){var y=r.createElement(t,"style");y.id="_textviewStyle";var b=t.getElementsByTagName("head")[0]||t.documentElement;y.appendChild(t.createTextNode(g)),b.insertBefore(y,b.firstChild)}}this._hookEvents();var w=this._rulers;for(var E=0;E<w.length;E++)this._createRuler(w[E]);this._update()},_defaultOptions:function(){return{parent:{value:undefined,update:null},model:{value:undefined,update:this.setModel},readonly:{value:!1,update:this._setReadOnly},fullSelection:{value:!0,update:this._setFullSelection},tabMode:{value:!0,update:null},tabSize:{value:8,update:this._setTabSize},expandTab:{value:!1,update:null},wrapMode:{value:!1,update:this._setWrapMode},themeClass:{value:undefined,update:this._setThemeClass}}},_destroyRuler:function(e){var t=e.getLocation(),n=t==="left"?this._leftDiv:this._rightDiv;if(n){var r=n.firstChild.rows[0],i=r.cells;for(var s=0;s<i.length;s++){var o=i[s];if(o.firstChild._ruler===e)break}if(s===i.length)return;r.cells[s]._ruler=undefined,r.deleteCell(s),i.length===0&&(n.style.display="none")}},_destroyView:function(){var e=this._clientDiv;if(!e)return;this._setGrab(null),this._unhookEvents();var t=this._getWindow();this._autoScrollTimerID&&(t.clearTimeout(this._autoScrollTimerID),this._autoScrollTimerID=null),this._updateTimer&&(t.clearTimeout(this._updateTimer),this._updateTimer=null);var n=this._rootDiv;n.parentNode.removeChild(n),this._selDiv1=null,this._selDiv2=null,this._selDiv3=null,this._clipboardDiv=null,this._rootDiv=null,this._scrollDiv=null,this._viewDiv=null,this._clipDiv=null,this._clipScrollDiv=null,this._clientDiv=null,this._overlayDiv=null,this._leftDiv=null,this._rightDiv=null,this._vScrollDiv=null,this._hScrollDiv=null},_doAutoScroll:function(e,t,n){this._autoScrollDir=e,this._autoScrollX=t,this._autoScrollY=n,this._autoScrollTimerID||this._autoScrollTimer()},_endAutoScroll:function(){if(this._autoScrollTimerID){var e=this._getWindow();e.clearTimeout(this._autoScrollTimerID)}this._autoScrollDir=undefined,this._autoScrollTimerID=undefined},_fixCaret:function(){var e=this._clientDiv;if(e){var t=this._hasFocus;this._ignoreFocus=!0,t&&e.blur(),e.contentEditable=!1,e.contentEditable=!0,t&&e.focus(),this._ignoreFocus=!1}},_getBaseText:function(e,t){var n=this._model;return n.getBaseModel&&(e=n.mapOffset(e),t=n.mapOffset(t),n=n.getBaseModel()),n.getText(e,t)},_getBottomIndex:function(e){var t=this._bottomChild;if(e&&this._getClientHeight()>this._getLineHeight()){var n=t.getBoundingClientRect(),r=this._clientDiv.getBoundingClientRect();n.bottom>r.bottom&&(t=this._getLinePrevious(t)||t)}return t.lineIndex},_getBoundsAtOffset:function(e){var t=this._model,n=this._getLine(t.getLineAtOffset(e)),r=n.getBoundingClientRect(e),i=this._getLinePixel(n.lineIndex);return r.top+=i,r.bottom+=i,n.destroy(),r},_getClientHeight:function(){var e=this._getViewPadding();return Math.max(0,this._viewDiv.clientHeight-e.top-e.bottom)},_getClientWidth:function(){var e=this._getViewPadding();return Math.max(0,this._viewDiv.clientWidth-e.left-e.right)},_getClipboardText:function(e,t){var n=this._model.getLineDelimiter(),i,s,o=this._getWindow();if(o.clipboardData)return i=[],s=o.clipboardData.getData("Text"),l(s,function(e){i.push(e)},function(){i.push(n)}),s=i.join(""),t&&t(s),s;if(r.isFirefox){this._ignoreFocus=!0;var u=this._clipboardDiv;u.innerHTML="<pre contenteditable=''></pre>",u.firstChild.focus();var a=this,f=function(){var e=a._getTextFromElement(u);return u.innerHTML="",i=[],l(e,function(e){i.push(e)},function(){i.push(n)}),i.join("")},c=!1;this._ignorePaste=!0;if(!r.isLinux||this._lastMouseButton!==2)try{var h=u.ownerDocument;c=h.execCommand("paste",!1,null)}catch(p){c=u.childNodes.length>1||u.firstChild&&u.firstChild.childNodes.length>0}return this._ignorePaste=!1,c?(this.focus(),this._ignoreFocus=!1,s=f(),s&&t&&t(s),s):e?(o.setTimeout(function(){a.focus(),s=f(),s&&t&&t(s),a._ignoreFocus=!1},0),null):(this.focus(),this._ignoreFocus=!1,"")}return e&&e.clipboardData?(i=[],s=e.clipboardData.getData("text/plain"),l(s,function(e){i.push(e)},function(){i.push(n)}),s=i.join(""),s&&t&&t(s),s):""},_getDOMText:function(e,t){var n=e.firstChild,r="",i=0;while(n){var s;if(n.ignoreChars){s=n.lastChild;var o=0,u=[],a=-1;while(s){var f=s.data;for(var l=f.length-1;l>=0;l--){var c=f.substring(l,l+1);o<n.ignoreChars&&(c===" "||c==="\u200c"||c==="\ufeff")?o++:u.push(c==="\u00a0"?"	":c)}t===s&&(a=u.length),s=s.previousSibling}u=u.reverse().join(""),a!==-1&&(i=r.length+u.length-a),r+=u}else{s=n.firstChild;while(s)t===s&&(i=r.length),r+=s.data,s=s.nextSibling}n=n.nextSibling}return{text:r,offset:i}},_getTextFromElement:function(e){var t=e.ownerDocument,n=t.defaultView;if(!n.getSelection)return e.innerText||e.textContent;var r=t.createRange();r.selectNode(e);var i=n.getSelection(),s=[],o;for(o=0;o<i.rangeCount;o++)s.push(i.getRangeAt(o));this._ignoreSelect=!0,i.removeAllRanges(),i.addRange(r);var u=i.toString();i.removeAllRanges();for(o=0;o<s.length;o++)i.addRange(s[o]);return this._ignoreSelect=!1,u},_getViewPadding:function(){return this._metrics.viewPadding},_getLine:function(e){var t=this._getLineNode(e);return t&&!t.lineChanged&&!t.lineRemoved?t._line:new m(this,e)},_getLineHeight:function(e,t){if(e!==undefined&&this._lineHeight){var n=this._lineHeight[e];if(n)return n;if(t||t===undefined){var r=this._lineHeight[e]=this._calculateLineHeight(e);return r}}return this._metrics.lineHeight},_getLineNode:function(e){var t=this._clientDiv,n=t.firstChild;while(n){if(e===n.lineIndex)return n;n=n.nextSibling}return undefined},_getLineNext:function(e){var t=e?e.nextSibling:this._clientDiv.firstChild;while(t&&t.lineIndex===-1)t=t.nextSibling;return t},_getLinePrevious:function(e){var t=e?e.previousSibling:this._clientDiv.lastChild;while(t&&t.lineIndex===-1)t=t.previousSibling;return t},_getLinePixel:function(e){e=Math.min(Math.max(0,e),this._model.getLineCount());if(this._lineHeight){var t=this._getTopIndex(),n=-this._topIndexY+this._getScroll().y,r;if(e>t)for(r=t;r<e;r++)n+=this._getLineHeight(r);else for(r=t-1;r>=e;r--)n-=this._getLineHeight(r);return n}var i=this._getLineHeight();return i*e},_getLineIndex:function(e){var t,n=0,r=this._model.getLineCount();if(this._lineHeight){n=this._getTopIndex();var i=-this._topIndexY+this._getScroll().y;if(e!==i)if(e<i)while(e<i&&n>0)e+=this._getLineHeight(--n);else{t=this._getLineHeight(n);while(e-t>=i&&n<r-1)e-=t,t=this._getLineHeight(++n)}}else t=this._getLineHeight(),n=Math.floor(e/t);return Math.max(0,Math.min(r-1,n))},_getScroll:function(){var e=this._viewDiv;return{x:e.scrollLeft,y:e.scrollTop}},_getSelection:function(){return this._selection.clone()},_getTopIndex:function(e){var t=this._topChild;if(e&&this._getClientHeight()>this._getLineHeight()){var n=t.getBoundingClientRect(),r=this._getViewPadding(),i=this._viewDiv.getBoundingClientRect();n.top<i.top+r.top&&(t=this._getLineNext(t)||t)}return t.lineIndex},_hookEvents:function(){var e=this;this._modelListener={onChanging:function(t){e._onModelChanging(t)},onChanged:function(t){e._onModelChanged(t)}},this._model.addEventListener("preChanging",this._modelListener.onChanging),this._model.addEventListener("postChanged",this._modelListener.onChanged);var t=this._handlers=[],n=this._clientDiv,i=this._viewDiv,o=this._rootDiv,u=this._overlayDiv||n,a=n.ownerDocument,f=this._getWindow(),l=r.isIE?a:f;t.push({target:f,type:"resize",handler:function(t){return e._handleResize(t?t:f.event)}}),t.push({target:n,type:"blur",handler:function(t){return e._handleBlur(t?t:f.event)}}),t.push({target:n,type:"focus",handler:function(t){return e._handleFocus(t?t:f.event)}}),t.push({target:i,type:"focus",handler:function(e){n.focus()}}),t.push({target:i,type:"scroll",handler:function(t){return e._handleScroll(t?t:f.event)}}),t.push({target:n,type:"textInput",handler:function(t){return e._handleTextInput(t?t:f.event)}}),t.push({target:n,type:"keydown",handler:function(t){return e._handleKeyDown(t?t:f.event)}}),t.push({target:n,type:"keypress",handler:function(t){return e._handleKeyPress(t?t:f.event)}}),t.push({target:n,type:"keyup",handler:function(t){return e._handleKeyUp(t?t:f.event)}}),t.push({target:n,type:"contextmenu",handler:function(t){return e._handleContextMenu(t?t:f.event)}}),t.push({target:n,type:"copy",handler:function(t){return e._handleCopy(t?t:f.event)}}),t.push({target:n,type:"cut",handler:function(t){return e._handleCut(t?t:f.event)}}),t.push({target:n,type:"paste",handler:function(t){return e._handlePaste(t?t:f.event)}});if(r.isIOS||r.isAndroid)t.push({target:a,type:"selectionchange",handler:function(t){return e._handleSelectionChange(t?t:f.event)}}),t.push({target:n,type:"touchstart",handler:function(t){return e._handleTouchStart(t?t:f.event)}}),t.push({target:n,type:"touchmove",handler:function(t){return e._handleTouchMove(t?t:f.event)}}),t.push({target:n,type:"touchend",handler:function(t){return e._handleTouchEnd(t?t:f.event)}});else{t.push({target:n,type:"selectstart",handler:function(t){return e._handleSelectStart(t?t:f.event)}}),t.push({target:n,type:"mousedown",handler:function(t){return e._handleMouseDown(t?t:f.event)}}),t.push({target:n,type:"mouseover",handler:function(t){return e._handleMouseOver(t?t:f.event)}}),t.push({target:n,type:"mouseout",handler:function(t){return e._handleMouseOut(t?t:f.event)}}),t.push({target:l,type:"mouseup",handler:function(t){return e._handleMouseUp(t?t:f.event)}}),t.push({target:l,type:"mousemove",handler:function(t){return e._handleMouseMove(t?t:f.event)}}),t.push({target:o,type:"mousedown",handler:function(t){return e._handleRootMouseDown(t?t:f.event)}}),t.push({target:o,type:"mouseup",handler:function(t){return e._handleRootMouseUp(t?t:f.event)}}),t.push({target:u,type:"dragstart",handler:function(t){return e._handleDragStart(t?t:f.event)}}),t.push({target:u,type:"drag",handler:function(t){return e._handleDrag(t?t:f.event)}}),t.push({target:u,type:"dragend",handler:function(t){return e._handleDragEnd(t?t:f.event)}}),t.push({target:u,type:"dragenter",handler:function(t){return e._handleDragEnter(t?t:f.event)}}),t.push({target:u,type:"dragover",handler:function(t){return e._handleDragOver(t?t:f.event)}}),t.push({target:u,type:"dragleave",handler:function(t){return e._handleDragLeave(t?t:f.event)}}),t.push({target:u,type:"drop",handler:function(t){return e._handleDrop(t?t:f.event)}}),t.push({target:this._clientDiv,type:r.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(t){return e._handleMouseWheel(t?t:f.event)}});if(r.isFirefox&&(!r.isWindows||r.isFirefox>=15)){var c=f.MutationObserver||f.MozMutationObserver;c?(this._mutationObserver=new c(function(t){e._handleDataModified(t)}),this._mutationObserver.observe(n,{subtree:!0,characterData:!0})):t.push({target:this._clientDiv,type:"DOMCharacterDataModified",handler:function(t){return e._handleDataModified(t?t:f.event)}})}this._overlayDiv&&(t.push({target:this._overlayDiv,type:"mousedown",handler:function(t){return e._handleMouseDown(t?t:f.event)}}),t.push({target:this._overlayDiv,type:"mouseover",handler:function(t){return e._handleMouseOver(t?t:f.event)}}),t.push({target:this._overlayDiv,type:"mouseout",handler:function(t){return e._handleMouseOut(t?t:f.event)}}),t.push({target:this._overlayDiv,type:"contextmenu",handler:function(t){return e._handleContextMenu(t?t:f.event)}})),this._isW3CEvents||t.push({target:this._clientDiv,type:"dblclick",handler:function(t){return e._handleDblclick(t?t:f.event)}})}var h=this._leftDiv,p=this._rightDiv;r.isIE&&t.push({target:h,type:"selectstart",handler:function(){return!1}}),t.push({target:h,type:r.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(t){return e._handleMouseWheel(t?t:f.event)}}),t.push({target:h,type:"click",handler:function(t){e._handleRulerEvent(t?t:f.event)}}),t.push({target:h,type:"dblclick",handler:function(t){e._handleRulerEvent(t?t:f.event)}}),t.push({target:h,type:"mousemove",handler:function(t){e._handleRulerEvent(t?t:f.event)}}),t.push({target:h,type:"mouseover",handler:function(t){e._handleRulerEvent(t?t:f.event)}}),t.push({target:h,type:"mouseout",handler:function(t){e._handleRulerEvent(t?t:f.event)}}),r.isIE&&t.push({target:p,type:"selectstart",handler:function(){return!1}}),t.push({target:p,type:r.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(t){return e._handleMouseWheel(t?t:f.event)}}),t.push({target:p,type:"click",handler:function(t){e._handleRulerEvent(t?t:f.event)}}),t.push({target:p,type:"dblclick",handler:function(t){e._handleRulerEvent(t?t:f.event)}}),t.push({target:p,type:"mousemove",handler:function(t){e._handleRulerEvent(t?t:f.event)}}),t.push({target:p,type:"mouseover",handler:function(t){e._handleRulerEvent(t?t:f.event)}}),t.push({target:p,type:"mouseout",handler:function(t){e._handleRulerEvent(t?t:f.event)}});for(var d=0;d<t.length;d++){var v=t[d];s(v.target,v.type,v.handler,v.capture)}},_getWindow:function(){return i(this._parent.ownerDocument)},_init:function(t){var n=t.parent;typeof n=="string"&&(n=(t.document||document).getElementById(n));if(!n)throw"no parent";t.parent=n,t.model=t.model||new e.TextModel;var i=this._defaultOptions();for(var s in i)if(i.hasOwnProperty(s)){var o;t[s]!==undefined?o=t[s]:o=i[s].value,this["_"+s]=o}this._rulers=[],this._selection=new d(0,0,!1),this._linksVisible=!1,this._redrawCount=0,this._maxLineWidth=0,this._maxLineIndex=-1,this._ignoreSelect=!0,this._ignoreFocus=!1,this._hasFocus=!1,this._columnX=-1,this._dragOffset=-1,this._isRangeRects=(!r.isIE||r.isIE>=9)&&typeof n.ownerDocument.createRange().getBoundingClientRect=="function",this._isW3CEvents=n.addEventListener,this._autoScrollX=null,this._autoScrollY=null,this._autoScrollTimerID=null,this._AUTO_SCROLL_RATE=50,this._grabControl=null,this._moseMoveClosure=null,this._mouseUpClosure=null,this._lastMouseX=0,this._lastMouseY=0,this._lastMouseTime=0,this._clickCount=0,this._clickTime=250,this._clickDist=5,this._isMouseDown=!1,this._doubleClickSelection=null,this._hScroll=0,this._vScroll=0,this._imeOffset=-1,this._createActions(),this._createView()},_isOverOverlayScroll:function(){if(!r.isMac)return{};var e=this._viewDiv.getBoundingClientRect(),t=this._lastMouseMoveX,n=this._lastMouseMoveY;return{vertical:e.top<=n&&n<e.bottom&&e.right-g<=t&&t<e.right,horizontal:e.bottom-g<=n&&n<e.bottom&&e.left<=t&&t<e.right}},_modifyContent:function(e,t){if(this._readonly&&!e._code)return;e.type="Verify",this.onVerify(e);if(e.text===null||e.text===undefined)return;var n=this._model;try{e._ignoreDOMSelection&&(this._ignoreDOMSelection=!0),n.setText(e.text,e.start,e.end)}finally{e._ignoreDOMSelection&&(this._ignoreDOMSelection=!1)}if(t){var r=this._getSelection();r.setCaret(e.start+e.text.length),this._setSelection(r,!0)}this.onModify({type:"Modify"})},_onModelChanged:function(e){e.type="ModelChanged",this.onModelChanged(e),e.type="Changed";var t=e.start,n=e.addedCharCount,r=e.removedCharCount,i=e.addedLineCount,s=e.removedLineCount,o=this._getSelection();o.end>t&&(o.end>t&&o.start<t+r?o.setCaret(t+n):(o.start+=n-r,o.end+=n-r),this._setSelection(o,!1,!1));var u=this._model,a=u.getLineAtOffset(t),f=this._getLineNext();while(f){var l=f.lineIndex;a<=l&&l<=a+s&&(a===l&&!f.modelChangedEvent&&!f.lineRemoved?(f.modelChangedEvent=e,f.lineChanged=!0):(f.lineRemoved=!0,f.lineChanged=!1,f.modelChangedEvent=null)),l>a+s&&(f.lineIndex=l+i-s,f._line.lineIndex=f.lineIndex),f=this._getLineNext(f)}this._wrapMode||a<=this._maxLineIndex&&this._maxLineIndex<=a+s&&(this._checkMaxLineIndex=this._maxLineIndex,this._maxLineIndex=-1,this._maxLineWidth=0),this._update()},_onModelChanging:function(e){e.type="ModelChanging",this.onModelChanging(e),e.type="Changing"},_queueUpdate:function(){if(this._updateTimer||this._ignoreQueueUpdate)return;var e=this,t=this._getWindow();this._updateTimer=t.setTimeout(function(){e._updateTimer=null,e._update()},0)},_resetLineHeight:function(e,t){if(this._wrapMode){if(e!==undefined&&t!==undefined)for(var n=e;n<t;n++)this._lineHeight[n]=undefined;else this._lineHeight=new Array(this._model.getLineCount());this._calculateLineHeightTimer()}else this._lineHeight=null},_resetLineWidth:function(){var e=this._clientDiv;if(e){var t=e.firstChild;while(t)t.lineWidth=undefined,t=t.nextSibling}},_reset:function(){this._maxLineIndex=-1,this._maxLineWidth=0,this._columnX=-1,this._topChild=null,this._bottomChild=null,this._topIndexY=0,this._resetLineHeight(),this._setSelection(new d(0,0,!1),!1,!1),this._viewDiv&&(this._viewDiv.scrollLeft=0,this._viewDiv.scrollTop=0);var e=this._clientDiv;if(e){var t=e.firstChild;while(t)t.lineRemoved=!0,t=t.nextSibling;if(r.isFirefox){this._ignoreFocus=!1;var n=this._hasFocus;n&&e.blur(),e.contentEditable=!1,e.contentEditable=!0,n&&e.focus(),this._ignoreFocus=!1}}},_scrollView:function(e,t){this._ensureCaretVisible=!1;var n=this._viewDiv;e&&(n.scrollLeft+=e),t&&(n.scrollTop+=t)},_setClipboardText:function(e,t){var n,i=this._parent.ownerDocument,s=this._getWindow();if(s.clipboardData)return n=[],l(e,function(e){n.push(e)},function(){n.push(r.platformDelimiter)}),s.clipboardData.setData("Text",n.join(""));if(t&&t.clipboardData){n=[],l(e,function(e){n.push(e)},function(){n.push(r.platformDelimiter)});if(t.clipboardData.setData("text/plain",n.join("")))return!0}var o=r.createElement(i,"pre");o.style.position="fixed",o.style.left="-1000px",l(e,function(e){o.appendChild(i.createTextNode(e))},function(){o.appendChild(r.createElement(i,"br"))}),o.appendChild(i.createTextNode(" ")),this._clientDiv.appendChild(o);var u=i.createRange();u.setStart(o.firstChild,0),u.setEndBefore(o.lastChild);var a=s.getSelection();a.rangeCount>0&&a.removeAllRanges(),a.addRange(u);var f=this,c=function(){o&&o.parentNode===f._clientDiv&&f._clientDiv.removeChild(o),f._updateDOMSelection()},h=!1;this._ignoreCopy=!0;try{h=i.execCommand("copy",!1,null)}catch(p){}return this._ignoreCopy=!1,!h&&t?(s.setTimeout(c,0),!1):(c(),!0)},_setDOMSelection:function(e,t,n,i){var s,o,u,a,f=0,l=e.firstChild,c,h,p=this._model,d=p.getLine(e.lineIndex).length;while(l){c=l.firstChild,h=c.length,l.ignoreChars&&(h-=l.ignoreChars);if(f+h>t||f+h>=d){s=c,o=t-f,l.ignoreChars&&h>0&&o===h&&(o+=l.ignoreChars);break}f+=h,l=l.nextSibling}f=0,l=n.firstChild;var v=this._model.getLine(n.lineIndex).length;while(l){c=l.firstChild,h=c.length,l.ignoreChars&&(h-=l.ignoreChars);if(h+f>i||f+h>=v){u=c,a=i-f,l.ignoreChars&&h>0&&a===h&&(a+=l.ignoreChars);break}f+=h,l=l.nextSibling}this._setDOMFullSelection(e,t,d,n,i,v);if(!this._hasFocus)return;var m,g=this._getWindow(),y=this._parent.ownerDocument;if(g.getSelection){var b=g.getSelection();if(b.anchorNode===s&&b.anchorOffset===o&&b.focusNode===u&&b.focusOffset===a||b.anchorNode===u&&b.anchorOffset===a&&b.focusNode===s&&b.focusOffset===o)return;m=y.createRange(),m.setStart(s,o),m.setEnd(u,a),this._ignoreSelect=!1,b.rangeCount>0&&b.removeAllRanges(),b.addRange(m),this._ignoreSelect=!0}else if(y.selection){var w=y.body,E=r.createElement(y,"div");w.appendChild(E),w.removeChild(E),m=w.createTextRange(),m.moveToElementText(s.parentNode),m.moveStart("character",o);var S=w.createTextRange();S.moveToElementText(u.parentNode),S.moveStart("character",a),m.setEndPoint("EndToStart",S),this._ignoreSelect=!1,m.select(),this._ignoreSelect=!0}},_setDOMFullSelection:function(e,t,n,r,i,s){if(!this._selDiv1)return;var o=this._selDiv1;o.style.width="0px",o.style.height="0px",o=this._selDiv2,o.style.width="0px",o.style.height="0px",o=this._selDiv3,o.style.width="0px",o.style.height="0px";if(e===r&&t===i)return;var u=this._model,a=this._getViewPadding(),f=this._clientDiv.getBoundingClientRect(),l=this._viewDiv.getBoundingClientRect(),c=l.left+a.left,h=f.right,p=l.top+a.top,d=f.bottom,v=0,g=0;if(this._clipDiv){var y=this._clipDiv.getBoundingClientRect();v=y.left-this._clipDiv.scrollLeft,g=y.top}else{var b=this._rootDiv.getBoundingClientRect();v=b.left,g=b.top}this._ignoreDOMSelection=!0;var w=new m(this,e.lineIndex,e),E=w.getBoundingClientRect(u.getLineStart(e.lineIndex)+t,!1),S=E.left,x=new m(this,r.lineIndex,r),T=x.getBoundingClientRect(u.getLineStart(r.lineIndex)+i,!1),N=T.left;this._ignoreDOMSelection=!1;var C=this._selDiv1,k=Math.min(h,Math.max(c,S)),L=Math.min(d,Math.max(p,E.top)),A=h,O=Math.min(d,Math.max(p,E.bottom));C.style.left=k-v+"px",C.style.top=L-g+"px",C.style.width=Math.max(0,A-k)+"px",C.style.height=Math.max(0,O-L)+"px";if(E.top===T.top)A=Math.min(N,h),C.style.width=Math.max(0,A-k)+"px";else{var M=c,_=Math.min(d,Math.max(p,T.top)),D=Math.min(h,Math.max(c,N)),P=Math.min(d,Math.max(p,T.bottom)),H=this._selDiv3;H.style.left=M-v+"px",H.style.top=_-g+"px",H.style.width=Math.max(0,D-M)+"px",H.style.height=Math.max(0,P-_)+"px";if(_-O>0){var B=this._selDiv2;B.style.left=c-v+"px",B.style.top=O-g+"px",B.style.width=Math.max(0,h-c)+"px",B.style.height=Math.max(0,_-O)+"px"}}},_setGrab:function(e){if(e===this._grabControl)return;e?(e.setCapture&&e.setCapture(),this._grabControl=e):(this._grabControl.releaseCapture&&this._grabControl.releaseCapture(),this._grabControl=null)},_setLinksVisible:function(e){if(this._linksVisible===e)return;this._linksVisible=e,r.isIE&&e&&(this._hadFocus=this._hasFocus);var t=this._clientDiv;t.contentEditable=!e,this._hadFocus&&!e&&t.focus(),this._overlayDiv&&(this._overlayDiv.style.zIndex=e?"-1":"1");var n=this._getLineNext();while(n){if(n.hasLink){var i=n.firstChild;while(i){var s=i.nextSibling,o=i.viewStyle;o&&o.tagName==="A"&&n.replaceChild(n._line._createSpan(n,i.firstChild.data,o),i),i=s}}n=this._getLineNext(n)}},_setSelection:function(e,t,n,r){if(e){this._columnX=-1,n===undefined&&(n=!0);var i=this._selection;this._selection=e,t&&this._showCaret(!1,r),n&&this._updateDOMSelection();if(!i.equals(e)){var s={type:"Selection",oldValue:{start:i.start,end:i.end},newValue:{start:e.start,end:e.end}};this.onSelection(s)}}},_setSelectionTo:function(e,t,n,r){var i=this._model,s,o=this._getSelection(),u=this.convert({x:e,y:t},"page","document"),a=this._getLineIndex(u.y),f;if(this._clickCount===1){f=this._getLine(a),s=f.getOffset(u.x,u.y-this._getLinePixel(a)),f.destroy();if(r&&!n&&o.start<=s&&s<o.end)return this._dragOffset=s,!1;o.extend(s),n||o.collapse()}else{var l=(this._clickCount&1)===0,c,h;if(l)f=this._getLine(a),s=f.getOffset(u.x,u.y-this._getLinePixel(a)),this._doubleClickSelection?s>=this._doubleClickSelection.start?(c=this._doubleClickSelection.start,h=f.getNextOffset(s,"wordend",1)):(c=f.getNextOffset(s,"word",-1),h=this._doubleClickSelection.end):(c=f.getNextOffset(s,"word",-1),h=f.getNextOffset(c,"wordend",1)),f.destroy();else if(this._doubleClickSelection){var p=i.getLineAtOffset(this._doubleClickSelection.start);a>=p?(c=i.getLineStart(p),h=i.getLineEnd(a)):(c=i.getLineStart(a),h=i.getLineEnd(p))}else c=i.getLineStart(a),h=i.getLineEnd(a);o.setCaret(c),o.extend(h)}return this._setSelection(o,!0,!0),!0},_setFullSelection:function(e,t){this._fullSelection=e,r.isWebkit&&(this._fullSelection=!0);var n=this._clipDiv||this._rootDiv;if(!n)return;if(!this._fullSelection){this._selDiv1&&(n.removeChild(this._selDiv1),this._selDiv1=null),this._selDiv2&&(n.removeChild(this._selDiv2),this._selDiv2=null),this._selDiv3&&(n.removeChild(this._selDiv3),this._selDiv3=null);return}if(!this._selDiv1&&this._fullSelection&&!r.isIOS){var i=n.ownerDocument;this._highlightRGB=r.isWebkit?"transparent":"Highlight";var s=r.createElement(i,"div");this._selDiv1=s,s.style.position="absolute",s.style.borderWidth="0px",s.style.margin="0px",s.style.padding="0px",s.style.outline="none",s.style.background=this._highlightRGB,s.style.width="0px",s.style.height="0px",s.style.zIndex="0",n.appendChild(s);var o=r.createElement(i,"div");this._selDiv2=o,o.style.position="absolute",o.style.borderWidth="0px",o.style.margin="0px",o.style.padding="0px",o.style.outline="none",o.style.background=this._highlightRGB,o.style.width="0px",o.style.height="0px",o.style.zIndex="0",n.appendChild(o);var u=r.createElement(i,"div");this._selDiv3=u,u.style.position="absolute",u.style.borderWidth="0px",u.style.margin="0px",u.style.padding="0px",u.style.outline="none",u.style.background=this._highlightRGB,u.style.width="0px",u.style.height="0px",u.style.zIndex="0",n.appendChild(u);if(r.isFirefox&&r.isMac){var a=this._getWindow(),f=a.getComputedStyle(u,null),l=f.getPropertyValue("background-color");switch(l){case"rgb(119, 141, 168)":l="rgb(199, 208, 218)";break;case"rgb(127, 127, 127)":l="rgb(198, 198, 198)";break;case"rgb(255, 193, 31)":l="rgb(250, 236, 115)";break;case"rgb(243, 70, 72)":l="rgb(255, 176, 139)";break;case"rgb(255, 138, 34)":l="rgb(255, 209, 129)";break;case"rgb(102, 197, 71)":l="rgb(194, 249, 144)";break;case"rgb(140, 78, 184)":l="rgb(232, 184, 255)";break;default:l="rgb(180, 213, 255)"}this._highlightRGB=l,s.style.background=l,o.style.background=l,u.style.background=l}t||this._updateDOMSelection()}},_setReadOnly:function(e){this._readonly=e,this._clientDiv.setAttribute("aria-readonly",e?"true":"false")},_setTabSize:function(e,t){this._tabSize=e,this._customTabSize=undefined;var n=this._clientDiv;r.isOpera?n&&(n.style.OTabSize=this._tabSize+""):r.isWebkit>=537.1?n&&(n.style.tabSize=this._tabSize+""):r.isFirefox>=4?n&&(n.style.MozTabSize=this._tabSize+""):this._tabSize!==8&&(this._customTabSize=this._tabSize),t||(this.redrawLines(),this._resetLineWidth())},_setThemeClass:function(e,t){this._themeClass=e;var n="textviewContainer";this._themeClass&&(n+=" "+this._themeClass),this._rootDiv.className=n,this._updateStyle(t)},_setWrapMode:function(e,t){this._wrapMode=e;var n=this._clientDiv,r=this._viewDiv;e?(n.style.whiteSpace="pre-wrap",n.style.wordWrap="break-word",r.style.overflowX="hidden",r.style.overflowY="scroll"):(n.style.whiteSpace="pre",n.style.wordWrap="normal",r.style.overflowX="auto",r.style.overflowY="auto"),t||(this.redraw(),this._resetLineWidth()),this._resetLineHeight()},_showCaret:function(e,t){if(!this._clientDiv)return;var n=this._model,r=this._getSelection(),i=this._getScroll(),s=r.getCaret(),o=r.start,u=r.end,a=n.getLineAtOffset(u),f=Math.max(Math.max(o,n.getLineStart(a)),u-1),l=this._getClientWidth(),c=this._getClientHeight(),h=l/4,p=this._getBoundsAtOffset(s===o?o:f),d=p.left,v=p.right,m=p.top,g=p.bottom;e&&!r.isEmpty()&&(p=this._getBoundsAtOffset(s===u?o:f),p.top===m?s===o?v=d+Math.min(p.right-d,l):d=v-Math.min(v-p.left,l):s===o?g=m+Math.min(p.bottom-m,c):m=g-Math.min(g-p.top,c));var y=0;d<i.x&&(y=Math.min(d-i.x,-h)),v>i.x+l&&(y=Math.max(v-i.x-l,h));var b=0;return m<i.y?b=m-i.y:g>i.y+c&&(b=g-i.y-c),t&&(t>0?b>0&&(b=Math.max(b,t)):b<0&&(b=Math.min(b,t))),y!==0||b!==0?(this._scrollView(y,b),c!==this._getClientHeight()||l!==this._getClientWidth()?this._showCaret():this._ensureCaretVisible=!0,!0):!1},_startIME:function(){if(this._imeOffset!==-1)return;var e=this._getSelection();e.isEmpty()||this._modifyContent({text:"",start:e.start,end:e.end},!0),this._imeOffset=e.start},_unhookEvents:function(){this._model.removeEventListener("preChanging",this._modelListener.onChanging),this._model.removeEventListener("postChanged",this._modelListener.onChanged),this._modelListener=null;for(var e=0;e<this._handlers.length;e++){var t=this._handlers[e];o(t.target,t.type,t.handler)}this._handlers=null,this._mutationObserver&&(this._mutationObserver.disconnect(),this._mutationObserver=null)},_updateDOMSelection:function(){if(this._ignoreDOMSelection)return;if(!this._clientDiv)return;var e=this._getSelection(),t=this._model,n=t.getLineAtOffset(e.start),r=t.getLineAtOffset(e.end),i=this._getLineNext();if(!i)return;var s=this._getLinePrevious(),o,u,a,f;n<i.lineIndex?(o=i,a=0):n>s.lineIndex?(o=s,a=0):(o=this._getLineNode(n),a=e.start-t.getLineStart(n)),r<i.lineIndex?(u=i,f=0):r>s.lineIndex?(u=s,f=0):(u=this._getLineNode(r),f=e.end-t.getLineStart(r)),this._setDOMSelection(o,a,u,f)},_update:function(e){if(this._redrawCount>0)return;if(this._updateTimer){var t=this._getWindow();t.clearTimeout(this._updateTimer),this._updateTimer=null,e=!1}var n=this._clientDiv;if(!n)return;this._metrics.invalid&&(this._ignoreQueueUpdate=!0,this._updateStyle(),this._ignoreQueueUpdate=!1);var i=this._model,s=this._getScroll(),o=this._getViewPadding(),u=i.getLineCount(),a=this._getLineHeight(),f=this._getClientWidth();this._wrapMode&&(n.style.width=f+"px");var l,c,h,p,d,v,y,b,w,E=0,S=0,x;if(this._lineHeight){while(S<u){x=this._getLineHeight(S);if(E+x>s.y)break;E+=x,S++}l=S,c=Math.max(0,l-1),p=h=s.y-E,l>0&&(h+=this._getLineHeight(l-1))}else{var T=Math.max(0,s.y)/a;l=Math.floor(T),c=Math.max(0,l-1),h=Math.round((T-c)*a),p=Math.round((T-l)*a),w=u*a}this._topIndexY=p;var N=this._parent,C=N.clientWidth,k=N.clientHeight;y=this._getClientHeight();if(e){d=0,this._leftDiv&&(v=this._leftDiv.getBoundingClientRect(),d=v.right-v.left),b=f,this._wrapMode||(b=Math.max(this._maxLineWidth,b));while(S<u)x=this._getLineHeight(S,!1),E+=x,S++;w=E}else{var L=this._viewDiv,A=Math.floor((y+p)/a),O=Math.min(l+A,u-1),M=Math.min(O+1,u-1),_,D,P=n.firstChild;while(P){_=P.lineIndex;var H=P.nextSibling;if(!(c<=_&&_<=M)||P.lineRemoved||P.lineIndex===-1)this._mouseWheelLine===P?(P.style.display="none",P.lineIndex=-1):n.removeChild(P);P=H}P=this._getLineNext();var B=L.ownerDocument,j=B.createDocumentFragment();for(_=c;_<=M;_++)!P||P.lineIndex>_?(new m(this,_)).create(j,null):(j.firstChild&&(n.insertBefore(j,P),j=B.createDocumentFragment()),P&&P.lineChanged&&(P=(new m(this,_)).create(j,P),P.lineChanged=!1),P=this._getLineNext(P));j.firstChild&&n.insertBefore(j,P),r.isWebkit&&!this._wrapMode&&(n.style.width="0x7fffffffpx");var F;P=this._getLineNext();var I=y+h,q=!1;while(P)D=P.lineWidth,D===undefined&&(F=P._line.getBoundingClientRect(),D=P.lineWidth=Math.ceil(F.right-F.left),this._lineHeight&&(this._lineHeight[P.lineIndex]=Math.ceil(F.bottom-F.top))),this._lineHeight&&!q&&(I-=this._lineHeight[P.lineIndex],I<0&&(O=P.lineIndex,q=!0)),this._wrapMode||(D>=this._maxLineWidth&&(this._maxLineWidth=D,this._maxLineIndex=P.lineIndex),this._checkMaxLineIndex===P.lineIndex&&(this._checkMaxLineIndex=-1)),P.lineIndex===l&&(this._topChild=P),P.lineIndex===O&&(this._bottomChild=P),P=this._getLineNext(P);if(this._checkMaxLineIndex!==-1){_=this._checkMaxLineIndex,this._checkMaxLineIndex=-1;if(0<=_&&_<u){var R=new m(this,_);F=R.getBoundingClientRect(),D=F.right-F.left,D>=this._maxLineWidth&&(this._maxLineWidth=D,this._maxLineIndex=_),R.destroy()}}while(S<u)x=this._getLineHeight(S,S<=O),E+=x,S++;w=E,this._updateRuler(this._leftDiv,l,O),this._updateRuler(this._rightDiv,l,O),d=0,this._leftDiv&&(v=this._leftDiv.getBoundingClientRect(),d=v.right-v.left);var U=0;if(this._rightDiv){var z=this._rightDiv.getBoundingClientRect();U=z.right-z.left}L.style.left=d+"px",L.style.right=U+"px";var W=this._scrollDiv;W.style.height=w+"px",f=this._getClientWidth();var X=f;this._wrapMode||(X=Math.max(this._maxLineWidth,X)),b=X,(!r.isIE||r.isIE>=9)&&this._maxLineWidth>f&&(X+=o.right+o.left),W.style.width=X+"px",this._clipScrollDiv&&(this._clipScrollDiv.style.width=X+"px"),s=this._getScroll();var V=y+o.top+o.bottom;this._updateRulerSize(this._leftDiv,V),this._updateRulerSize(this._rightDiv,V)}if(this._vScrollDiv){var $=y-8,J=Math.max(15,Math.ceil(Math.min(1,$/(w+o.top+o.bottom))*$));this._vScrollDiv.style.left=d+f-8+"px",this._vScrollDiv.style.top=Math.floor(Math.max(0,s.y*$/w))+"px",this._vScrollDiv.style.height=J+"px"}if(!this._wrapMode&&this._hScrollDiv){var K=f-8,Q=Math.max(15,Math.ceil(Math.min(1,K/(this._maxLineWidth+o.left+o.right))*K));this._hScrollDiv.style.left=d+Math.floor(Math.max(0,Math.floor(s.x*K/this._maxLineWidth)))+"px",this._hScrollDiv.style.top=y-9+"px",this._hScrollDiv.style.width=Q+"px"}var G=s.x,Y=this._clipDiv,Z=this._overlayDiv,et,tt;if(Y){Y.scrollLeft=G,et=d+o.left,tt=o.top;var nt=f,rt=y,it=0,st=-h;s.x===0&&(et-=o.left,nt+=o.left,it=o.left),s.x+f===b&&(nt+=o.right),s.y===0&&(tt-=o.top,rt+=o.top,st+=o.top),s.y+y===w&&(rt+=o.bottom),Y.style.left=et+"px",Y.style.top=tt+"px";var ot=this._isOverOverlayScroll();Y.style.right=C-nt-et+(this._overlayScrollTimer&&ot.vertical?g:0)+"px",Y.style.bottom=k-rt-tt+(this._overlayScrollTimer&&ot.horizontal?g:0)+"px",n.style.left=it+"px",n.style.top=st+"px",n.style.width=b+"px",n.style.height=y+h+"px",Z&&(Z.style.left=n.style.left,Z.style.top=n.style.top,Z.style.width=n.style.width,Z.style.height=n.style.height)}else{et=G,tt=h;var ut=G+f,at=h+y;et===0&&(et-=o.left),tt===0&&(tt-=o.top),ut===b&&(ut+=o.right),s.y+y===w&&(at+=o.bottom),n.style.clip="rect("+tt+"px,"+ut+"px,"+at+"px,"+et+"px)",n.style.left=-G+d+o.left+"px",n.style.width=(r.isWebkit?b:f+G)+"px",e||(n.style.top=-h+o.top+"px",n.style.height=y+h+"px"),Z&&(Z.style.clip=n.style.clip,Z.style.left=n.style.left,Z.style.width=n.style.width,e||(Z.style.top=n.style.top,Z.style.height=n.style.height))}this._updateDOMSelection();var ft=this._ensureCaretVisible;this._ensureCaretVisible=!1,y!==this._getClientHeight()&&(this._update(),ft&&this._showCaret())},_updateRulerSize:function(e,t){if(!e)return;var n=this._topIndexY,r=this._getLineHeight(),i=e.firstChild.rows[0].cells;for(var s=0;s<i.length;s++){var o=i[s].firstChild,u=r;o._ruler.getOverview()==="page"&&(u+=n),o.style.top=-u+"px",o.style.height=t+u+"px",o=o.nextSibling}e.style.height=t+"px"},_updateRuler:function(e,t,n){if(!e)return;var i=e.firstChild.rows[0].cells,s=this._parent.ownerDocument,o=this._getLineHeight(),a=this._getViewPadding();for(var f=0;f<i.length;f++){var l=i[f].firstChild,c=l._ruler;l.rulerChanged&&u(c.getRulerStyle(),l);var h,p=l.firstChild;p?(h=p,p=p.nextSibling):(h=r.createElement(s,"div"),h.style.visibility="hidden",l.appendChild(h));var d,v;l.rulerChanged&&h&&(d=-1,v=c.getWidestAnnotation(),v&&(u(v.style,h),v.html&&(h.innerHTML=v.html)),h.lineIndex=d,h.style.height=o+a.top+"px");var m=c.getOverview(),g,y,b;if(m==="page"){b=c.getAnnotations(t,n+1);while(p){d=p.lineIndex;var w=p.nextSibling;(!(t<=d&&d<=n)||p.lineChanged)&&l.removeChild(p),p=w}p=l.firstChild.nextSibling,y=s.createDocumentFragment();for(d=t;d<=n;d++)!p||p.lineIndex>d?(g=r.createElement(s,"div"),v=b[d],v&&(u(v.style,g),v.html&&(g.innerHTML=v.html),g.annotation=v),g.lineIndex=d,g.style.height=this._getLineHeight(d)+"px",y.appendChild(g)):(y.firstChild&&(l.insertBefore(y,p),y=s.createDocumentFragment()),p&&(p=p.nextSibling));y.firstChild&&l.insertBefore(y,p)}else{var E=this._getClientHeight(),S=this._model.getLineCount(),x=o*S,T=E+a.top+a.bottom-2*this._metrics.scrollWidth,N;x<T?N=o:N=T/S;if(l.rulerChanged){var C=l.childNodes.length;while(C>1)l.removeChild(l.lastChild),C--;b=c.getAnnotations(0,S),y=s.createDocumentFragment();for(var k in b){d=k>>>0;if(d<0)continue;g=r.createElement(s,"div"),v=b[k],u(v.style,g),g.style.position="absolute",g.style.top=this._metrics.scrollWidth+o+Math.floor(d*N)+"px",v.html&&(g.innerHTML=v.html),g.annotation=v,g.lineIndex=d,y.appendChild(g)}l.appendChild(y)}else if(l._oldTrackHeight!==T){g=l.firstChild?l.firstChild.nextSibling:null;while(g)g.style.top=this._metrics.scrollWidth+o+Math.floor(g.lineIndex*N)+"px",g=g.nextSibling}l._oldTrackHeight=T}l.rulerChanged=!1,l=l.nextSibling}},_updateStyle:function(e){!e&&r.isIE&&(this._rootDiv.style.lineHeight="normal");var t=this._metrics=this._calculateMetrics();r.isIE?this._rootDiv.style.lineHeight=t.lineHeight-(t.lineTrim.top+t.lineTrim.bottom)+"px":this._rootDiv.style.lineHeight="normal",e||(this.redraw(),this._resetLineWidth())}},n.EventTarget.addMixin(y.prototype),{TextView:y}}),define("orion/editor/projectionTextModel",["orion/editor/textModel","orion/editor/eventTarget"],function(e,t){function n(e){this._model=e,this._projections=[]}return n.prototype={addProjection:function(t){if(!t)return;var n=this._model,r=this._projections;t._lineIndex=n.getLineAtOffset(t.start),t._lineCount=n.getLineAtOffset(t.end)-t._lineIndex;var i=t.text;i||(i=""),typeof i=="string"?t._model=new e.TextModel(i,n.getLineDelimiter()):t._model=i;var s=this.mapOffset(t.start,!0),o=t.end-t.start,u=t._lineCount,a=t._model.getCharCount(),f=t._model.getLineCount()-1,l={type:"Changing",text:t._model.getText(),start:s,removedCharCount:o,addedCharCount:a,removedLineCount:u,addedLineCount:f};this.onChanging(l);var c=this._binarySearch(r,t.start);r.splice(c,0,t);var h={type:"Changed",start:s,removedCharCount:o,addedCharCount:a,removedLineCount:u,addedLineCount:f};this.onChanged(h)},getProjections:function(){return this._projections.slice(0)},getBaseModel:function(){return this._model},mapOffset:function(e,t){var n=this._projections,r=0,i,s;if(t){for(i=0;i<n.length;i++){s=n[i];if(s.start>e)break;if(s.end>e)return-1;r+=s._model.getCharCount()-(s.end-s.start)}return e+r}for(i=0;i<n.length;i++){s=n[i];if(s.start>e-r)break;var o=s._model.getCharCount();if(s.start+o>e-r)return-1;r+=o-(s.end-s.start)}return e-r},removeProjection:function(e){var t,n=0;for(t=0;t<this._projections.length;t++){var r=this._projections[t];if(r===e){e=r;break}n+=r._model.getCharCount()-(r.end-r.start)}if(t<this._projections.length){var i=this._model,s=e.start+n,o=e.end-e.start,u=e._lineCount,a=e._model.getCharCount(),f=e._model.getLineCount()-1,l={type:"Changing",text:i.getText(e.start,e.end),start:s,removedCharCount:a,addedCharCount:o,removedLineCount:f,addedLineCount:u};this.onChanging(l),this._projections.splice(t,1);var c={type:"Changed",start:s,removedCharCount:a,addedCharCount:o,removedLineCount:f,addedLineCount:u};this.onChanged(c)}},_binarySearch:function(e,t){var n=e.length,r=-1,i;while(n-r>1)i=Math.floor((n+r)/2),t<=e[i].start?n=i:r=i;return n},getCharCount:function(){var e=this._model.getCharCount(),t=this._projections;for(var n=0;n<t.length;n++){var r=t[n];e+=r._model.getCharCount()-(r.end-r.start)}return e},getLine:function(e,t){if(e<0)return null;var n=this._model,r=this._projections,i=0,s=[],o=0,u,a,f;for(u=0;u<r.length;u++){f=r[u];if(f._lineIndex>=e-i)break;a=f._model.getLineCount()-1;if(f._lineIndex+a>=e-i){var l=e-(f._lineIndex+i);if(l<a)return f._model.getLine(l,t);s.push(f._model.getLine(a))}o=f.end,i+=a-f._lineCount}o=Math.max(o,n.getLineStart(e-i));for(;u<r.length;u++){f=r[u];if(f._lineIndex>e-i)break;s.push(n.getText(o,f.start)),a=f._model.getLineCount()-1;if(f._lineIndex+a>e-i)return s.push(f._model.getLine(0,t)),s.join("");s.push(f._model.getText()),o=f.end,i+=a-f._lineCount}var c=n.getLineEnd(e-i,t);return o<c&&s.push(n.getText(o,c)),s.join("")},getLineAtOffset:function(e){var t=this._model,n=this._projections,r=0,i=0;for(var s=0;s<n.length;s++){var o=n[s];if(o.start>e-r)break;var u=o._model.getCharCount();if(o.start+u>e-r){var a=e-(o.start+r);i+=o._model.getLineAtOffset(a),r+=a;break}i+=o._model.getLineCount()-1-o._lineCount,r+=u-(o.end-o.start)}return t.getLineAtOffset(e-r)+i},getLineCount:function(){var e=this._model,t=this._projections,n=e.getLineCount();for(var r=0;r<t.length;r++){var i=t[r];n+=i._model.getLineCount()-1-i._lineCount}return n},getLineDelimiter:function(){return this._model.getLineDelimiter()},getLineEnd:function(e,t){if(e<0)return-1;var n=this._model,r=this._projections,i=0,s=0;for(var o=0;o<r.length;o++){var u=r[o];if(u._lineIndex>e-i)break;var a=u._model.getLineCount()-1;if(u._lineIndex+a>e-i){var f=e-(u._lineIndex+i);return u._model.getLineEnd(f,t)+u.start+s}s+=u._model.getCharCount()-(u.end-u.start),i+=a-u._lineCount}return n.getLineEnd(e-i,t)+s},getLineStart:function(e){if(e<0)return-1;var t=this._model,n=this._projections,r=0,i=0;for(var s=0;s<n.length;s++){var o=n[s];if(o._lineIndex>=e-r)break;var u=o._model.getLineCount()-1;if(o._lineIndex+u>=e-r){var a=e-(o._lineIndex+r);return o._model.getLineStart(a)+o.start+i}i+=o._model.getCharCount()-(o.end-o.start),r+=u-o._lineCount}return t.getLineStart(e-r)+i},getText:function(e,t){e===undefined&&(e=0);var n=this._model,r=this._projections,i=0,s=[],o,u,a;for(o=0;o<r.length;o++){u=r[o];if(u.start>e-i)break;a=u._model.getCharCount();if(u.start+a>e-i){if(t!==undefined&&u.start+a>t-i)return u._model.getText(e-(u.start+i),t-(u.start+i));s.push(u._model.getText(e-(u.start+i))),e=u.end+i+a-(u.end-u.start)}i+=a-(u.end-u.start)}var f=e-i;if(t!==undefined){for(;o<r.length;o++){u=r[o];if(u.start>t-i)break;s.push(n.getText(f,u.start)),a=u._model.getCharCount();if(u.start+a>t-i)return s.push(u._model.getText(0,t-(u.start+i))),s.join("");s.push(u._model.getText()),f=u.end,i+=a-(u.end-u.start)}s.push(n.getText(f,t-i))}else{for(;o<r.length;o++)u=r[o],s.push(n.getText(f,u.start)),s.push(u._model.getText()),f=u.end;s.push(n.getText(f))}return s.join("")},_onChanging:function(e,t,n,r,i,s){var o=this._model,u=this._projections,a,f,l=0,c,h=t+n;for(;a<u.length;a++){f=u[a];if(f.start>t)break;l+=f._model.getCharCount()-(f.end-f.start)}var p=t+l,d=a;for(;a<u.length;a++){f=u[a];if(f.start>h)break;l+=f._model.getCharCount()-(f.end-f.start),c+=f._model.getLineCount()-1-f._lineCount}var v=h+l,m=a;this.onChanging(p,v-p,r,i+c,s),u.splice(u,m-d);var g=e.length-(v-p);for(;a<u.length;a++)f=u[a],f.start+=g,f.end+=g,f._lineIndex=o.getLineAtOffset(f.start)},onChanging:function(e){return this.dispatchEvent(e)},onChanged:function(e){return this.dispatchEvent(e)},setLineDelimiter:function(e){this._model.setLineDelimiter(e)},setText:function(e,t,n){e===undefined&&(e=""),t===undefined&&(t=0);var r=t,i=n,s=this._model,o=this._projections,u=0,a=0,f,l,c,h,p,d=0;for(f=0;f<o.length;f++){l=o[f];if(l.start>t-u)break;c=l._model.getCharCount();if(l.start+c>t-u){if(n!==undefined&&l.start+c>n-u){l._model.setText(e,t-(l.start+u),n-(l.start+u));return}d=l._model.getLineCount()-1-l._model.getLineAtOffset(t-(l.start+u)),h={projection:l,start:t-(l.start+u)},t=l.end+u+c-(l.end-l.start)}a+=l._model.getLineCount()-1-l._lineCount,u+=c-(l.end-l.start)}var v=t-u,m=f,g=s.getLineAtOffset(v)+a-d;if(n!==undefined)for(;f<o.length;f++){l=o[f];if(l.start>n-u)break;c=l._model.getCharCount();if(l.start+c>n-u){a+=l._model.getLineAtOffset(n-(l.start+u)),c=n-(l.start+u),n=l.end+u,p={projection:l,end:c};break}a+=l._model.getLineCount()-1-l._lineCount,u+=c-(l.end-l.start)}else{for(;f<o.length;f++)l=o[f],a+=l._model.getLineCount()-1-l._lineCount,u+=l._model.getCharCount()-(l.end-l.start);n=i=s.getCharCount()+u}var y=n-u,b=f,w=s.getLineAtOffset(y)+a,E=i-r,S=w-g,x=e.length,T=0,N=0,C=0,k=0;for(;;){N!==-1&&N<=k&&(N=e.indexOf("\r",k)),C!==-1&&C<=k&&(C=e.indexOf("\n",k));if(C===-1&&N===-1)break;N!==-1&&C!==-1?N+1===C?k=C+1:k=(N<C?N:C)+1:N!==-1?k=N+1:k=C+1,T++}var L={type:"Changing",text:e,start:r,removedCharCount:E,addedCharCount:x,removedLineCount:S,addedLineCount:T};this.onChanging(L),s.setText(e,v,y),h&&(l=h.projection,l._model.setText("",h.start)),p&&(l=p.projection,l._model.setText("",0,p.end),l.start=l.end,l._lineCount=0),o.splice(m,b-m);var A=e.length-(y-v);for(f=b;f<o.length;f++)l=o[f],l.start+=A,l.end+=A,l._lineIndex=s.getLineAtOffset(l.start);var O={type:"Changed",start:r,removedCharCount:E,addedCharCount:x,removedLineCount:S,addedLineCount:T};this.onChanged(O)}},t.EventTarget.addMixin(n.prototype),{ProjectionTextModel:n}}),define("orion/editor/tooltip",["i18n!orion/editor/nls/messages","orion/editor/textView","orion/editor/textModel","orion/editor/projectionTextModel","orion/editor/util"],function(e,t,n,r,i){function s(e){this._view=e,this._create(e.getOptions("parent").ownerDocument),e.addEventListener("Destroy",this,this.destroy)}return s.getTooltip=function(e){return e._tooltip||(e._tooltip=new s(e)),e._tooltip},s.prototype={_create:function(e){if(this._tooltipDiv)return;var t=this._tooltipDiv=i.createElement(e,"div");t.className="textviewTooltip",t.setAttribute("aria-live","assertive"),t.setAttribute("aria-atomic","true");var n=this._tooltipContents=i.createElement(e,"div");t.appendChild(n),e.body.appendChild(t),this.hide()},_getWindow:function(){var e=this._tooltipDiv.ownerDocument;return e.defaultView||e.parentWindow},destroy:function(){if(!this._tooltipDiv)return;this.hide();var e=this._tooltipDiv.parentNode;e&&e.removeChild(this._tooltipDiv),this._tooltipDiv=null},hide:function(){this._contentsView&&(this._contentsView.destroy(),this._contentsView=null),this._tooltipContents&&(this._tooltipContents.innerHTML=""),this._tooltipDiv&&(this._tooltipDiv.style.visibility="hidden");var e=this._getWindow();this._showTimeout&&(e.clearTimeout(this._showTimeout),this._showTimeout=null),this._hideTimeout&&(e.clearTimeout(this._hideTimeout),this._hideTimeout=null),this._fadeTimeout&&(e.clearInterval(this._fadeTimeout),this._fadeTimeout=null)},isVisible:function(){return this._tooltipDiv&&this._tooltipDiv.style.visibility==="visible"},setTarget:function(e,t){if(this.target===e)return;this._target=e,this.hide();if(e){var n=this;if(t===0)n.show(!0);else{var r=this._getWindow();n._showTimeout=r.setTimeout(function(){n.show(!0)},t?t:500)}}},show:function(e){if(!this._target)return;var n=this._target.getTooltipInfo();if(!n)return;var i=this._tooltipDiv,s=this._tooltipContents;i.style.left=i.style.right=i.style.width=i.style.height=s.style.width=s.style.height="auto";var o=n.contents;o instanceof Array&&(o=this._getAnnotationContents(o));if(typeof o=="string")s.innerHTML=o;else if(this._isNode(o))s.appendChild(o);else{if(!(o instanceof r.ProjectionTextModel))return;var u=this._view,a=u.getOptions();a.wrapMode=!1,a.parent=s;var f="tooltip",l=a.themeClass;l?(l=l.replace(f,""),l&&(l=" "+l),l=f+l):l=f,a.themeClass=l;var c=this._contentsView=new t.TextView(a);c._clientDiv.contentEditable=!1;var h={onLineStyle:function(e){u.onLineStyle(e)}};c.addEventListener("LineStyle",h.onLineStyle),c.setModel(o);var p=c.computeSize();s.style.width=p.width+20+"px",s.style.height=p.height+"px",c.resize()}var d=i.ownerDocument.documentElement;if(n.anchor==="right"){var v=d.clientWidth-n.x;i.style.right=v+"px",i.style.maxWidth=d.clientWidth-v-10+"px"}else{var m=parseInt(this._getNodeStyle(i,"padding-left","0"),10);m+=parseInt(this._getNodeStyle(i,"border-left-width","0"),10),m=n.x-m,i.style.left=m+"px",i.style.maxWidth=d.clientWidth-m-10+"px"}var g=parseInt(this._getNodeStyle(i,"padding-top","0"),10);g+=parseInt(this._getNodeStyle(i,"border-top-width","0"),10),g=n.y-g,i.style.top=g+"px",i.style.maxHeight=d.clientHeight-g-10+"px",i.style.opacity="1",i.style.visibility="visible";if(e){var y=this,b=this._getWindow();y._hideTimeout=b.setTimeout(function(){var e=parseFloat(y._getNodeStyle(i,"opacity","1"));y._fadeTimeout=b.setInterval(function(){if(i.style.visibility==="visible"&&e>0){e-=.1,i.style.opacity=e;return}y.hide()},50)},5e3)}},_getAnnotationContents:function(t){function o(e,t){var n=s.getLineStart(s.getLineAtOffset(e)),r=s.getLineEnd(s.getLineAtOffset(t),!0);return s.getText(n,r)}function u(e){var t=e.title;if(t==="")return null;var n="<div>";return e.html&&(n+=e.html+"&nbsp;"),t||(t=o(e.start,e.end)),t=t.replace(/</g,"&lt;").replace(/>/g,"&gt;"),n+="<span style='vertical-align:middle;'>"+t+"</span><div>",n}if(t.length===0)return null;var n=this._view.getModel(),i,s=n.getBaseModel?n.getBaseModel():n;if(t.length===1){i=t[0];if(i.title!==undefined)return u(i);var a=new r.ProjectionTextModel(s),f=s.getLineStart(s.getLineAtOffset(i.start)),l=s.getCharCount();return i.end!==l&&a.addProjection({start:i.end,end:l}),f>0&&a.addProjection({start:0,end:f}),a}var c="<div><em>"+e.multipleAnnotations+"</em></div>";for(var h=0;h<t.length;h++){i=t[h];var p=u(i);p&&(c+=p)}return c},_getNodeStyle:function(e,t,n){var r;if(e){r=e.style[t];if(!r)if(e.currentStyle){var i=0,s=t;while((i=s.indexOf("-",i))!==-1)s=s.substring(0,i)+s.substring(i+1,i+2).toUpperCase()+s.substring(i+2);r=e.currentStyle[s]}else{var o=e.ownerDocument.defaultView.getComputedStyle(e,null);r=o?o.getPropertyValue(t):null}}return r||n},_isNode:function(e){return typeof Node=="object"?e instanceof Node:e&&typeof e=="object"&&typeof e.nodeType=="number"&&typeof e.nodeName=="string"}},{Tooltip:s}}),define("orion/editor/editor",["i18n!orion/editor/nls/messages","orion/editor/keyBinding","orion/editor/eventTarget","orion/editor/tooltip","orion/editor/annotations","orion/editor/util"],function(e,t,n,r,i,s){function a(e){this._textViewFactory=e.textViewFactory,this._undoStackFactory=e.undoStackFactory,this._textDNDFactory=e.textDNDFactory,this._annotationFactory=e.annotationFactory,this._foldingRulerFactory=e.foldingRulerFactory,this._lineNumberRulerFactory=e.lineNumberRulerFactory,this._contentAssistFactory=e.contentAssistFactory,this._keyBindingFactory=e.keyBindingFactory,this._statusReporter=e.statusReporter,this._domNode=e.domNode,this._annotationStyler=null,this._annotationModel=null,this._annotationRuler=null,this._lineNumberRuler=null,this._overviewRuler=null,this._foldingRuler=null,this._dirty=!1,this._contentAssist=null,this._title=null,this._keyModes=[]}function f(e){var t=this,n=Array.prototype.slice.call(arguments,1);return n.length?function(){return arguments.length?t.apply(e,n.concat(Array.prototype.slice.call(arguments))):t.apply(e,n)}:function(){return arguments.length?t.apply(e,arguments):t.call(e)}}var o,u="orion.annotation.highlightError";return a.prototype={destroy:function(){this.uninstallTextView(),this._textViewFactory=this._undoStackFactory=this._textDNDFactory=this._annotationFactory=this._foldingRulerFactory=this._lineNumberRulerFactory=this._contentAssistFactory=this._keyBindingFactory=this._statusReporter=this._domNode=null},getAnnotationModel:function(){return this._annotationModel},getAnnotationRuler:function(){return this._annotationRuler},getAnnotationStyler:function(){return this._annotationStyler},getFoldingRuler:function(){return this._foldingRuler},getLineNumberRuler:function(){return this._lineNumberRuler},getModel:function(){var e=this._textView.getModel();return e.getBaseModel&&(e=e.getBaseModel()),e},getOverviewRuler:function(){return this._overviewRuler},getTextView:function(){return this._textView},getTitle:function(){return this._title},getKeyModes:function(){return this._keyModes},isDirty:function(){return this._dirty},setAnnotationRulerVisible:function(e){if(this._annotationRulerVisible===e)return;this._annotationRulerVisible=e;if(!this._annotationRuler)return;var t=this._textView;e?t.addRuler(this._annotationRuler,0):t.removeRuler(this._annotationRuler)},setFoldingRulerVisible:function(e){if(this._foldingRulerVisible===e)return;this._foldingRulerVisible=e;if(!this._foldingRuler)return;var t=this._textView;if(!t.getModel().getBaseModel)return;e?t.addRuler(this._foldingRuler,100):t.removeRuler(this._foldingRuler)},setDirty:function(e){if(this._dirty===e)return;this._dirty=e,this.onDirtyChanged({type:"DirtyChanged"})},setLineNumberRulerVisible:function(e){if(this._lineNumberRulerVisible===e)return;this._lineNumberRulerVisible=e;if(!this._lineNumberRuler)return;var t=this._textView;e?t.addRuler(this._lineNumberRuler,1):t.removeRuler(this._lineNumberRuler)},setOverviewRulerVisible:function(e){if(this._overviewRulerVisible===e)return;this._overviewRulerVisible=e;if(!this._overviewRuler)return;var t=this._textView;e?t.addRuler(this._overviewRuler):t.removeRuler(this._overviewRuler)},mapOffset:function(e,t){var n=this._textView,r=n.getModel();return r.getBaseModel&&(e=r.mapOffset(e,t)),e},getCaretOffset:function(){return this.mapOffset(this._textView.getCaretOffset())},getSelection:function(){var e=this._textView,t=e.getSelection(),n=e.getModel();return n.getBaseModel&&(t.start=n.mapOffset(t.start),t.end=n.mapOffset(t.end)),t},getText:function(e,t){var n=this._textView,r=n.getModel();return r.getBaseModel&&(r=r.getBaseModel()),r.getText(e,t)},_expandOffset:function(e){var t=this._textView.getModel(),n=this._annotationModel;if(!n||!t.getBaseModel)return;var r=n.getAnnotations(e,e+1);while(r.hasNext()){var s=r.next();s.type===i.AnnotationType.ANNOTATION_FOLDING&&s.expand&&(s.expand(),n.modifyAnnotation(s))}},setCaretOffset:function(e){var t=this._textView,n=t.getModel();n.getBaseModel&&(this._expandOffset(e),e=n.mapOffset(e,!0)),t.setCaretOffset(e)},setText:function(e,t,n){var r=this._textView,i=r.getModel();i.getBaseModel&&(t!==undefined&&(this._expandOffset(t),t=i.mapOffset(t,!0)),n!==undefined&&(this._expandOffset(n),n=i.mapOffset(n,!0))),r.setText(e,t,n)},setFoldingEnabled:function(e){this.setFoldingRulerVisible(e)},setSelection:function(e,t,n){var r=this._textView,i=r.getModel();i.getBaseModel&&(this._expandOffset(e),this._expandOffset(t),e=i.mapOffset(e,!0),t=i.mapOffset(t,!0)),r.setSelection(e,t,n)},moveSelection:function(e,t,n,r){t=t||e;var i=this._textView;this.setSelection(e,t,!1);var s=i.getTopPixel(),u=i.getBottomPixel(),a=this.getModel(),f=a.getLineAtOffset(e),l=i.getLinePixel(f);if(l<s||l>u){var c=u-s,h=Math.max(0,l-Math.floor((l<s?3:1)*c/4)),p=new o({node:i,duration:300,curve:[s,h],onAnimate:function(e){i.setTopPixel(Math.floor(e))},onEnd:function(){i.showSelection(),(r===undefined||r)&&i.focus(),n&&n()}});p.play()}else i.showSelection(),(r===undefined||r)&&i.focus(),n&&n()},checkDirty:function(){this.setDirty(!this._undoStack.isClean())},reportStatus:function(e,t,n){this._statusReporter&&this._statusReporter(e,t,n)},_getTooltipInfo:function(e,t){var n=this._textView,r=this.getAnnotationModel();if(!r)return null;var i=this._annotationStyler;if(!i)return null;var s=n.getOffsetAtLocation(e,t);if(s===-1)return null;s=this.mapOffset(s);var o=i.getAnnotationsByType(r,s,s+1),u=[];for(var a=0;a<o.length;a++)o[a].rangeStyle&&u.push(o[a]);if(u.length===0)return null;var f=n.convert({x:e,y:t},"document","page"),l={contents:u,anchor:"left",x:f.x+10,y:f.y+20};return l},_highlightCurrentLine:function(e,t){var n=this._annotationModel;if(!n)return;var r=this._textView,s=r.getModel(),o=t?s.getLineAtOffset(t.start):-1,u=s.getLineAtOffset(e.start),a=e.start===e.end,f=!t||t.start===t.end,l=s.getLineStart(u),c=s.getLineEnd(u);s.getBaseModel&&(l=s.mapOffset(l),c=s.mapOffset(c));var h=this._currentLineAnnotation;if(o===u&&f&&a&&h&&h.start===l&&h.end===c)return;var p=h?[h]:null,d;if(a){var v=i.AnnotationType.ANNOTATION_CURRENT_LINE;h=i.AnnotationType.createAnnotation(v,l,c),d=[h]}this._currentLineAnnotation=h,n.replaceAnnotations(p,d)},installTextView:function(){this._textView=this._textViewFactory(),this._undoStackFactory&&(this._undoStack=this._undoStackFactory.createUndoStack(this)),this._textDNDFactory&&(this._textDND=this._textDNDFactory.createTextDND(this,this._undoStack));if(this._contentAssistFactory){var n=this._contentAssistFactory.createContentAssistMode(this);this._keyModes.push(n),this._contentAssist=n.getContentAssist()}var s=this,o=this._textView,a=this;this._listener={onModelChanged:function(e){a.checkDirty()},onMouseOver:function(e){a._listener.onMouseMove(e)},onMouseMove:function(e){var t=r.Tooltip.getTooltip(o);if(!t)return;t.setTarget({x:e.x,y:e.y,getTooltipInfo:function(){return a._getTooltipInfo(this.x,this.y)}})},onMouseOut:function(e,t){var n=r.Tooltip.getTooltip(o);if(!n)return;n.setTarget(null)},onSelection:function(e){a._updateCursorStatus(),a._highlightCurrentLine(e.newValue,e.oldValue)}},o.addEventListener("ModelChanged",this._listener.onModelChanged),o.addEventListener("Selection",this._listener.onSelection),o.addEventListener("MouseOver",this._listener.onMouseOver),o.addEventListener("MouseOut",this._listener.onMouseOut),o.addEventListener("MouseMove",this._listener.onMouseMove),this._keyBindingFactory&&this._keyBindingFactory(this,this._keyModes,this._undoStack,this._contentAssist),o.setKeyBinding(new t.KeyBinding(27),"cancelMode"),o.setAction("cancelMode",function(){var e=!1;for(var t=0;t<this._keyModes.length;t++)this._keyModes[t].isActive()&&(e=this._keyModes[t].cancel()||e);return e}.bind(this),{name:e.cancelMode}),o.setAction("lineUp",function(){for(var e=0;e<this._keyModes.length;e++)if(this._keyModes[e].isActive())return this._keyModes[e].lineUp();return!1}.bind(this)),o.setAction("lineDown",function(){for(var e=0;e<this._keyModes.length;e++)if(this._keyModes[e].isActive())return this._keyModes[e].lineDown();return!1}.bind(this)),o.setAction("enter",function(){for(var e=0;e<this._keyModes.length;e++)if(this._keyModes[e].isActive())return this._keyModes[e].enter();return!1}.bind(this));var f=function(e,t){if(e===undefined)return;if(e===-1)return;var n=this.getView(),r=n.getModel(),o=this.getAnnotationModel(),u=s.mapOffset(r.getLineStart(e)),a=s.mapOffset(r.getLineEnd(e)),f=o.getAnnotations(u,a),l=null;while(f.hasNext()){var c=f.next();if(c.type===i.AnnotationType.ANNOTATION_BOOKMARK){l=c;break}}l?o.removeAnnotation(l):(l=i.AnnotationType.createAnnotation(i.AnnotationType.ANNOTATION_BOOKMARK,u,a),l.title=undefined,o.addAnnotation(l))};if(this._annotationFactory){var l=o.getModel();l.getBaseModel&&(l=l.getBaseModel()),this._annotationModel=this._annotationFactory.createAnnotationModel(l);if(this._annotationModel){var c=this._annotationStyler=this._annotationFactory.createAnnotationStyler(o,this._annotationModel);c&&(c.addAnnotationType(i.AnnotationType.ANNOTATION_CURRENT_SEARCH),c.addAnnotationType(i.AnnotationType.ANNOTATION_MATCHING_SEARCH),c.addAnnotationType(i.AnnotationType.ANNOTATION_ERROR),c.addAnnotationType(i.AnnotationType.ANNOTATION_WARNING),c.addAnnotationType(i.AnnotationType.ANNOTATION_MATCHING_BRACKET),c.addAnnotationType(i.AnnotationType.ANNOTATION_CURRENT_BRACKET),c.addAnnotationType(i.AnnotationType.ANNOTATION_CURRENT_LINE),c.addAnnotationType(i.AnnotationType.ANNOTATION_READ_OCCURRENCE),c.addAnnotationType(i.AnnotationType.ANNOTATION_WRITE_OCCURRENCE),c.addAnnotationType(u))}o.annotationModel=this._annotationModel;var h=this._annotationFactory.createAnnotationRulers(this._annotationModel),p=this._annotationRuler=h.annotationRuler;p&&(p.onClick=function(e,t){if(e===undefined)return;if(e===-1)return;var n=this.getView(),r=n.getModel(),i=this.getAnnotationModel(),o=s.mapOffset(r.getLineStart(e)),u=s.mapOffset(r.getLineEnd(e)),a=i.getAnnotations(o,u);while(a.hasNext()){var f=a.next();if(!this.isAnnotationTypeVisible(f.type))continue;var l=s.getModel();s.onGotoLine(l.getLineAtOffset(o),f.start-o,f.end-o);break}},p.onDblClick=f,p.setMultiAnnotationOverlay({html:"<div class='annotationHTML overlay'></div>"}),p.addAnnotationType(i.AnnotationType.ANNOTATION_ERROR),p.addAnnotationType(i.AnnotationType.ANNOTATION_WARNING),p.addAnnotationType(i.AnnotationType.ANNOTATION_TASK),p.addAnnotationType(i.AnnotationType.ANNOTATION_BOOKMARK)),this.setAnnotationRulerVisible(!0),p=this._overviewRuler=h.overviewRuler,p&&(p.onClick=function(e,t){if(e===undefined)return;var n=o.getModel().getLineStart(e);s.moveSelection(s.mapOffset(n))},p.addAnnotationType(i.AnnotationType.ANNOTATION_CURRENT_SEARCH),p.addAnnotationType(i.AnnotationType.ANNOTATION_MATCHING_SEARCH),p.addAnnotationType(i.AnnotationType.ANNOTATION_ERROR),p.addAnnotationType(i.AnnotationType.ANNOTATION_WARNING),p.addAnnotationType(i.AnnotationType.ANNOTATION_TASK),p.addAnnotationType(i.AnnotationType.ANNOTATION_BOOKMARK),p.addAnnotationType(i.AnnotationType.ANNOTATION_MATCHING_BRACKET),p.addAnnotationType(i.AnnotationType.ANNOTATION_CURRENT_BRACKET),p.addAnnotationType(i.AnnotationType.ANNOTATION_CURRENT_LINE),p.addAnnotationType(i.AnnotationType.ANNOTATION_READ_OCCURRENCE),p.addAnnotationType(i.AnnotationType.ANNOTATION_WRITE_OCCURRENCE)),this.setOverviewRulerVisible(!0)}this._lineNumberRulerFactory&&(this._lineNumberRuler=this._lineNumberRulerFactory.createLineNumberRuler(this._annotationModel),this._lineNumberRuler.onDblClick=f,this.setLineNumberRulerVisible(!0)),this._foldingRulerFactory&&(this._foldingRuler=this._foldingRulerFactory.createFoldingRuler(this._annotationModel),this._foldingRuler.addAnnotationType(i.AnnotationType.ANNOTATION_FOLDING),this.setFoldingRulerVisible(!1));var d={type:"TextViewInstalled",textView:o};this.dispatchEvent(d)},uninstallTextView:function(){var e=this._textView;if(!e)return;e.destroy(),this._textView=this._undoStack=this._textDND=this._contentAssist=this._listener=this._annotationModel=this._annotationStyler=this._annotationRuler=this._overviewRuler=this._lineNumberRuler=this._foldingRuler=this._currentLineAnnotation=this._title=null,this._dirty=!1,this._keyModes=[];var t={type:"TextViewUninstalled",textView:e};this.dispatchEvent(t)},_updateCursorStatus:function(){var t=this.getModel(),n=this.getCaretOffset(),r=t.getLineAtOffset(n),i=t.getLineStart(r),o=n-i;for(var u=0;u<this._keyModes.length;u++){var a=this._keyModes[u];if(a.isActive()&&a.isStatusActive&&a.isStatusActive())return}this.reportStatus(s.formatMessage(e.lineColumn,r+1,o+1))},showProblems:function(e){var t=this._annotationModel;if(!t)return;var n=[],r=[],s=t.getTextModel(),o=t.getAnnotations(0,s.getCharCount()),u;while(o.hasNext())u=o.next(),(u.type===i.AnnotationType.ANNOTATION_ERROR||u.type===i.AnnotationType.ANNOTATION_WARNING)&&n.push(u);if(e)for(var a=0;a<e.length;a++){var f=e[a];if(f){var l=f.description.replace(/'/g,"&#39;").replace(/"/g,"&#34;"),c=f.line-1,h=s.getLineStart(c),p=f.severity,d=p==="error"?i.AnnotationType.ANNOTATION_ERROR:i.AnnotationType.ANNOTATION_WARNING,v=h+f.start-1,m=h+f.end;u=i.AnnotationType.createAnnotation(d,v,m,l),r.push(u)}}t.replaceAnnotations(n,r)},showOccurrences:function(e){var t=this._annotationModel;if(!t)return;var n=[],r=[],s=t.getTextModel(),o=t.getAnnotations(0,s.getCharCount()),u;while(o.hasNext())u=o.next(),(u.type===i.AnnotationType.ANNOTATION_READ_OCCURRENCE||u.type===i.AnnotationType.ANNOTATION_WRITE_OCCURRENCE)&&n.push(u);if(e)for(var a=0;a<e.length;a++){var f=e[a];if(f){var l=f.line-1,c=s.getLineStart(l),h=c+f.start-1,p=c+f.end,d=f.readAccess===!0?i.AnnotationType.ANNOTATION_READ_OCCURRENCE:i.AnnotationType.ANNOTATION_WRITE_OCCURRENCE,v=f.description;u=i.AnnotationType.createAnnotation(d,h,p,v),r.push(u)}}t.replaceAnnotations(n,r)},showSelection:function(e,t,n,r,i){if(typeof e=="number")typeof t!="number"&&(t=e),this.moveSelection(e,t);else if(typeof n=="number"){var s=this.getModel(),o=s.getLineStart(n-1);typeof r=="number"&&(o+=r),typeof i!="number"&&(i=0),this.moveSelection(o,o+i)}},setInput:function(e,t,n,r){this._title=e,this._textView&&(r?(this._undoStack.markClean(),this.checkDirty()):(t?this._textView.setText(t):n!==null&&n!==undefined&&(this._textView.setText(n),this._textView.getModel().setLineDelimiter("auto"),this._highlightCurrentLine(this._textView.getSelection())),this._undoStack.reset(),this.checkDirty(),this._textView.focus())),this.onInputChanged({type:"InputChanged",title:e,message:t,contents:n,contentsSaved:r})},onInputChanged:function(e){return this.dispatchEvent(e)},onGotoLine:function(e,t,n){if(this._textView){var r=this.getModel(),i=r.getLineStart(e),s=0;n===undefined&&(n=0);if(typeof t=="string"){var o=r.getLine(e).indexOf(t);o!==-1&&(s=o,n=s+t.length)}else{s=t;var u=r.getLineEnd(e)-i;s=Math.min(s,u),n=Math.min(n,u)}this.moveSelection(i+s,i+n)}},onDirtyChanged:function(e){return this.dispatchEvent(e)}},n.EventTarget.addMixin(a.prototype),o=function(){function e(e){this.options=e}return e.prototype.play=function(){function c(){l=l===-1?(new Date).getTime():l;var t=(new Date).getTime(),o=(t-l)/e;if(o<1){var c=n(o);a=s+c*u,r(a)}else clearInterval(f),i()}var e=typeof this.options.duration=="number"?this.options.duration:350,t=typeof this.options.rate=="number"?this.options.rate:20,n=this.options.easing||this.defaultEasing,r=this.options.onAnimate||function(){},i=this.options.onEnd||function(){},s=this.options.curve[0],o=this.options.curve[1],u=o-s,a,f,l=-1;f=setInterval(c,t)},e.prototype.defaultEasing=function(e){return Math.sin(e*(Math.PI/2))},e}(),Function.prototype.bind||(Function.prototype.bind=f),{Editor:a,util:{bind:f}}}),define("orion/editor/rulers",["i18n!orion/editor/nls/messages","orion/editor/annotations","orion/editor/tooltip","orion/editor/util"],function(e,t,n,r){function i(e,t,n,r){this._location=t||"left",this._overview=n||"page",this._rulerStyle=r,this._view=null;var i=this;this._listener={onTextModelChanged:function(e){i._onTextModelChanged(e)},onAnnotationModelChanged:function(e){i._onAnnotationModelChanged(e)}},this.setAnnotationModel(e)}function s(e,t,n,r,s){i.call(this,e,t,"page",n),this._oddStyle=r||{style:{backgroundColor:"white"}},this._evenStyle=s||{style:{backgroundColor:"white"}},this._numOfDigits=0}function o(e,t,n){i.call(this,e,t,"page",n)}function u(e,t,n){i.call(this,e,t,"document",n)}function a(e,t,n){o.call(this,e,t,n)}return i.prototype={getAnnotations:function(e,t){var n=this._annotationModel;if(!n)return[];var r=this._view.getModel(),i=r.getLineStart(e),s=r.getLineEnd(t-1),o=r;r.getBaseModel&&(o=r.getBaseModel(),i=r.mapOffset(i),s=r.mapOffset(s));var u=[],a=this.getAnnotationsByType(n,i,s);for(var f=0;f<a.length;f++){var l=a[f],c=o.getLineAtOffset(l.start),h=o.getLineAtOffset(Math.max(l.start,l.end-1));for(var p=c;p<=h;p++){var d=p;if(r!==o){var v=o.getLineStart(p);v=r.mapOffset(v,!0);if(v===-1)continue;d=r.getLineAtOffset(v)}if(!(e<=d&&d<t))continue;var m=this._mergeAnnotation(u[d],l,p-c,h-c+1);m&&(u[d]=m)}}if(!this._multiAnnotation&&this._multiAnnotationOverlay)for(var g in u)u[g]._multiple&&(u[g].html=u[g].html+this._multiAnnotationOverlay.html);return u},getAnnotationModel:function(){return this._annotationModel},getLocation:function(){return this._location},getOverview:function(){return this._overview},getRulerStyle:function(){return this._rulerStyle},getView:function(){return this._view},getWidestAnnotation:function(){return null},setAnnotationModel:function(e){this._annotationModel&&this._annotationModel.removEventListener("Changed",this._listener.onAnnotationModelChanged),this._annotationModel=e,this._annotationModel&&this._annotationModel.addEventListener("Changed",this._listener.onAnnotationModelChanged)},setMultiAnnotation:function(e){this._multiAnnotation=e},setMultiAnnotationOverlay:function(e){this._multiAnnotationOverlay=e},setView:function(e){this._onTextModelChanged&&this._view&&this._view.removeEventListener("ModelChanged",this._listener.onTextModelChanged),this._view=e,this._onTextModelChanged&&this._view&&this._view.addEventListener("ModelChanged",this._listener.onTextModelChanged)},onClick:function(e,t){},onDblClick:function(e,t){},onMouseMove:function(e,t){var r=n.Tooltip.getTooltip(this._view);if(!r)return;if(r.isVisible()&&this._tooltipLineIndex===e)return;this._tooltipLineIndex=e;var i=this;r.setTarget({y:t.clientY,getTooltipInfo:function(){return i._getTooltipInfo(i._tooltipLineIndex,this.y)}})},onMouseOver:function(e,t){this.onMouseMove(e,t)},onMouseOut:function(e,t){var r=n.Tooltip.getTooltip(this._view);if(!r)return;r.setTarget(null)},_getTooltipInfo:function(e,t){if(e===undefined)return;var n=this._view,r=n.getModel(),i=this._annotationModel,s=[];if(i){var o=r.getLineStart(e),u=r.getLineEnd(e);r.getBaseModel&&(o=r.mapOffset(o),u=r.mapOffset(u)),s=this.getAnnotationsByType(i,o,u)}var a=this._getTooltipContents(e,s);if(!a)return null;var f={contents:a,anchor:this.getLocation()},l=n.getClientArea();return this.getOverview()==="document"?l.y=n.convert({y:t},"view","document").y:l.y=n.getLocationAtOffset(r.getLineStart(e)).y,n.convert(l,"document","page"),f.x=l.x,f.y=l.y,f.anchor==="right"&&(f.x+=l.width),f},_getTooltipContents:function(e,t){return t},_onAnnotationModelChanged:function(e){function u(e){for(var i=0;i<e.length;i++){if(!r.isAnnotationTypeVisible(e[i].type))continue;var s=e[i].start,o=e[i].end;n.getBaseModel&&(s=n.mapOffset(s,!0),o=n.mapOffset(o,!0)),s!==-1&&o!==-1&&t.redrawLines(n.getLineAtOffset(s),n.getLineAtOffset(Math.max(s,o-1))+1,r)}}var t=this._view;if(!t)return;var n=t.getModel(),r=this,i=n.getLineCount();if(e.textModelChangedEvent){var s=e.textModelChangedEvent.start;n.getBaseModel&&(s=n.mapOffset(s,!0));var o=n.getLineAtOffset(s);t.redrawLines(o,i,r);return}u(e.added),u(e.removed),u(e.changed)},_mergeAnnotation:function(e,t,n,r){return e||(e={}),n===0&&(e.html&&t.html?(t.html!==e.html&&!e._multiple&&this._multiAnnotation&&(e.html=this._multiAnnotation.html),e._multiple=!0):e.html=t.html),e.style=this._mergeStyle(e.style,t.style),e},_mergeStyle:function(e,t){if(t){e||(e={}),e.styleClass&&t.styleClass&&e.styleClass!==t.styleClass?e.styleClass+=" "+t.styleClass:e.styleClass=t.styleClass;var n;if(t.style){e.style||(e.style={});for(n in t.style)e.style[n]||(e.style[n]=t.style[n])}if(t.attributes){e.attributes||(e.attributes={});for(n in t.attributes)e.attributes[n]||(e.attributes[n]=t.attributes[n])}}return e}},t.AnnotationTypeList.addMixin(i.prototype),s.prototype=new i,s.prototype.getAnnotations=function(e,t){var n=i.prototype.getAnnotations.call(this,e,t),r=this._view.getModel();for(var s=e;s<t;s++){var o=s&1?this._oddStyle:this._evenStyle,u=s;if(r.getBaseModel){var a=r.getLineStart(u);u=r.getBaseModel().getLineAtOffset(r.mapOffset(a))}n[s]||(n[s]={}),n[s].html=u+1+"",n[s].style||(n[s].style=o)}return n},s.prototype.getWidestAnnotation=function(){var e=this._view.getModel().getLineCount();return this.getAnnotations(e-1,e)[e-1]},s.prototype._onTextModelChanged=function(e){var t=e.start,n=this._view.getModel(),r=n.getBaseModel?n.getBaseModel().getLineCount():n.getLineCount(),i=(r+"").length;if(this._numOfDigits!==i){this._numOfDigits=i;var s=n.getLineAtOffset(t);this._view.redrawLines(s,n.getLineCount(),this)}},o.prototype=new i,u.prototype=new i,u.prototype.getRulerStyle=function(){var e={style:{lineHeight:"1px",fontSize:"1px"}};return e=this._mergeStyle(e,this._rulerStyle),e},u.prototype.onClick=function(e,t){if(e===undefined)return;this._view.setTopIndex(e)},u.prototype._getTooltipContents=function(t,n){if(n.length===0){var s=this._view.getModel(),o=t;if(s.getBaseModel){var u=s.getLineStart(o);o=s.getBaseModel().getLineAtOffset(s.mapOffset(u))}return r.formatMessage(e.line,o+1)}return i.prototype._getTooltipContents.call(this,t,n)},u.prototype._mergeAnnotation=function(e,t,n,r){if(n!==0)return undefined;var i=e;if(!i){var s=3*r;i={html:"&nbsp;",style:{style:{height:s+"px"}}},i.style=this._mergeStyle(i.style,t.overviewStyle)}return i},a.prototype=new o,a.prototype.onClick=function(e,t){if(e===undefined)return;var r=this._annotationModel;if(!r)return;var i=this._view,s=i.getModel(),o=s.getLineStart(e),u=s.getLineEnd(e,!0);s.getBaseModel&&(o=s.mapOffset(o),u=s.mapOffset(u),s=s.getBaseModel());var a,f=r.getAnnotations(o,u);while(!a&&f.hasNext()){var l=f.next();if(!this.isAnnotationTypeVisible(l.type))continue;a=l}if(a&&s.getLineAtOffset(a.start)===s.getLineAtOffset(o)){var c=n.Tooltip.getTooltip(this._view);c&&c.setTarget(null),a.expanded?a.collapse():a.expand(),this._annotationModel.modifyAnnotation(a)}},a.prototype._getTooltipContents=function(e,t){return t.length===1&&t[0].expanded?null:o.prototype._getTooltipContents.call(this,e,t)},a.prototype._onAnnotationModelChanged=function(e){function a(e){for(i=0;i<e.length;i++){if(!r.isAnnotationTypeVisible(e[i].type))continue;var t=e[i].start;n.getBaseModel&&(t=n.mapOffset(t,!0)),t!==-1&&(u=Math.min(u,n.getLineAtOffset(t)))}}if(e.textModelChangedEvent){o.prototype._onAnnotationModelChanged.call(this,e);return}var t=this._view;if(!t)return;var n=t.getModel(),r=this,i,s=n.getLineCount(),u=s;a(e.added),a(e.removed),a(e.changed);var f=t.getRulers();for(i=0;i<f.length;i++)t.redrawLines(u,s,f[i])},{Ruler:i,AnnotationRuler:o,LineNumberRuler:s,OverviewRuler:u,FoldingRuler:a}}),define("orion/editor/textDND",[],function(){function e(e,t){this._view=e,this._undoStack=t,this._dragSelection=null,this._dropOffset=-1,this._dropText=null;var n=this;this._listener={onDragStart:function(e){n._onDragStart(e)},onDragEnd:function(e){n._onDragEnd(e)},onDragEnter:function(e){n._onDragEnter(e)},onDragOver:function(e){n._onDragOver(e)},onDrop:function(e){n._onDrop(e)},onDestroy:function(e){n._onDestroy(e)}},e.addEventListener("DragStart",this._listener.onDragStart),e.addEventListener("DragEnd",this._listener.onDragEnd),e.addEventListener("DragEnter",this._listener.onDragEnter),e.addEventListener("DragOver",this._listener.onDragOver),e.addEventListener("Drop",this._listener.onDrop),e.addEventListener("Destroy",this._listener.onDestroy)}return e.prototype={destroy:function(){var e=this._view;if(!e)return;e.removeEventListener("DragStart",this._listener.onDragStart),e.removeEventListener("DragEnd",this._listener.onDragEnd),e.removeEventListener("DragEnter",this._listener.onDragEnter),e.removeEventListener("DragOver",this._listener.onDragOver),e.removeEventListener("Drop",this._listener.onDrop),e.removeEventListener("Destroy",this._listener.onDestroy),this._view=null},_onDestroy:function(e){this.destroy()},_onDragStart:function(e){var t=this._view,n=t.getSelection(),r=t.getModel();r.getBaseModel&&(n.start=r.mapOffset(n.start),n.end=r.mapOffset(n.end),r=r.getBaseModel());var i=r.getText(n.start,n.end);i&&(this._dragSelection=n,e.event.dataTransfer.effectAllowed="copyMove",e.event.dataTransfer.setData("Text",i))},_onDragEnd:function(e){var t=this._view;if(this._dragSelection){this._undoStack&&this._undoStack.startCompoundChange();var n=e.event.dataTransfer.dropEffect==="move";n&&t.setText("",this._dragSelection.start,this._dragSelection.end);if(this._dropText){var r=this._dropText,i=this._dropOffset;n&&(i>=this._dragSelection.end?i-=this._dragSelection.end-this._dragSelection.start:i>=this._dragSelection.start&&(i=this._dragSelection.start)),t.setText(r,i,i),t.setSelection(i,i+r.length),this._dropText=null,this._dropOffset=-1}this._undoStack&&this._undoStack.endCompoundChange()}this._dragSelection=null},_onDragEnter:function(e){this._onDragOver(e)},_onDragOver:function(e){var t=e.event.dataTransfer.types;if(t){var n=!this._view.getOptions("readonly");n&&(n=t.contains?t.contains("text/plain"):t.indexOf("text/plain")!==-1),n||(e.event.dataTransfer.dropEffect="none")}},_onDrop:function(e){var t=this._view,n=e.event.dataTransfer.getData("Text");if(n){var r=t.getOffsetAtLocation(e.x,e.y);this._dragSelection?(this._dropOffset=r,this._dropText=n):(t.setText(n,r,r),t.setSelection(r,r+n.length))}}},{TextDND:e}}),define("orion/editor/editorFeatures",["i18n!orion/editor/nls/messages","orion/editor/undoStack","orion/editor/keyBinding","orion/editor/rulers","orion/editor/annotations","orion/editor/tooltip","orion/editor/textDND","orion/editor/regex","orion/editor/util"],function(e,t,n,r,i,s,o,u,a){function f(){}function l(){}function c(){}function h(){}function p(){}function d(e,t,n){this.editor=e,this.textView=e.getTextView(),this.undoStack=t,this._incrementalFindActive=!1,this._incrementalFindSuccess=!0,this._incrementalFindIgnoreSelection=!1,this._incrementalFindPrefix="",this._searcher=n,this._lastEditLocation=null,this.init()}function v(e,t,n,r){this.editor=e,this.textView=e.getTextView(),this.undoStack=t,this.contentAssist=n,this.linkedMode=r,this.contentAssist&&this.contentAssist.addEventListener("ProposalApplied",this.contentAssistProposalApplied.bind(this)),this.init()}function m(e){this.editor=e,this.textView=e.getTextView(),this.linkedModeActive=!1,this.linkedModePositions=[],this.linkedModeCurrentPositionIndex=0,this.linkedModeEscapePosition=0,this.linkedModeListener={onVerify:function(e){var t=!1,n=0;for(var r=0;r<this.linkedModePositions.length;++r){var i=this.linkedModePositions[r];if(t)i.offset+=n;else if(e.start>=i.offset&&e.end<=i.offset+i.length){var s=i.length;i.length=e.start-i.offset+e.text.length+(i.offset+i.length-e.end),n=i.length-s,t=!0}}t?this.linkedModeEscapePosition+=n:this.cancel()}.bind(this)}}return f.prototype={createUndoStack:function(n){var r=n.getTextView(),i=new t.UndoStack(r,200);return r.setAction("undo",function(){return i.undo(),!0},{name:e.undo}),r.setAction("redo",function(){return i.redo(),!0},{name:e.redo}),i}},l.prototype={createLineNumberRuler:function(e){return new r.LineNumberRuler(e,"left",{styleClass:"ruler lines"},{styleClass:"rulerLines odd"},{styleClass:"rulerLines even"})}},c.prototype={createFoldingRuler:function(e){return new r.FoldingRuler(e,"left",{styleClass:"ruler folding"})}},h.prototype={createAnnotationModel:function(e){return new i.AnnotationModel(e)},createAnnotationStyler:function(e,t){return new i.AnnotationStyler(e,t)},createAnnotationRulers:function(e){var t=new r.AnnotationRuler(e,"left",{styleClass:"ruler annotations"}),n=new r.OverviewRuler(e,"right",{styleClass:"ruler overview"});return{annotationRuler:t,overviewRuler:n}}},p.prototype={createTextDND:function(e,t){return new o.TextDND(e.getTextView(),t)}},d.prototype={init:function(){var t=this;this._incrementalFindListener={onVerify:function(n){var r=t.editor,i=r.getModel(),s=r.mapOffset(n.start),o=r.mapOffset(n.end),f=i.getText(s,o),l=t._incrementalFindPrefix,c=l.match(new RegExp("^"+u.escape(f),"i"));if(c&&c.length>0){l=t._incrementalFindPrefix+=n.text,t.editor.reportStatus(a.formatMessage(e.incrementalFind,l));var h=r.getSelection().start,p=r.getModel().find({string:l,start:h,caseInsensitive:l.toLowerCase()===l}).next();p?(t._incrementalFindSuccess=!0,t._incrementalFindIgnoreSelection=!0,r.moveSelection(p.start,p.end),t._incrementalFindIgnoreSelection=!1):(r.reportStatus(a.formatMessage(e.incrementalFindNotFound,l),"error"),t._incrementalFindSuccess=!1),n.text=null}},onSelection:function(){t._incrementalFindIgnoreSelection||t.toggleIncrementalFind()}},this._lastEditListener={onModelChanged:function(e){t.editor.isDirty()&&(t._lastEditLocation=e.start+e.addedCharCount)}},this.textView.addEventListener("ModelChanged",this._lastEditListener.onModelChanged),this.textView.setKeyBinding(new n.KeyBinding("k",!0),"findNext"),this.textView.setAction("findNext",function(){if(this._searcher){var e=this.textView.getSelection();return e.start<e.end?this._searcher.findNext(!0,this.textView.getText(e.start,e.end)):this._searcher.findNext(!0),!0}return!1}.bind(this),{name:e.findNext}),this.textView.setKeyBinding(new n.KeyBinding("k",!0,!0),"findPrevious"),this.textView.setAction("findPrevious",function(){if(this._searcher){var e=this.textView.getSelection();return e.start<e.end?this._searcher.findNext(!1,this.textView.getText(e.start,e.end)):this._searcher.findNext(!1),!0}return!1}.bind(this),{name:e.findPrevious}),this.textView.setKeyBinding(new n.KeyBinding("j",!0),"incrementalFind"),this.textView.setAction("incrementalFind",function(){if(this._searcher&&this._searcher.visible())return!0;var t=this.editor;if(!this._incrementalFindActive)t.setCaretOffset(t.getCaretOffset()),this.toggleIncrementalFind();else{var n=this._incrementalFindPrefix;if(n.length!==0){var r,i=0;this._incrementalFindSuccess&&(i=t.getSelection().start+1),r=t.getModel().find({string:n,start:i,caseInsensitive:n.toLowerCase()===n}).next(),r?(this._incrementalFindSuccess=!0,this._incrementalFindIgnoreSelection=!0,t.moveSelection(r.start,r.end),this._incrementalFindIgnoreSelection=!1,t.reportStatus(a.formatMessage(e.incrementalFind,n))):(t.reportStatus(a.formatMessage(e.incrementalFindNotFound,n),"error"),this._incrementalFindSuccess=!1)}}return!0}.bind(this),{name:e.incrementalFindKey}),this.textView.setAction("deletePrevious",function(){if(this._incrementalFindActive){var t=this.editor,n=this._incrementalFindPrefix;n=this._incrementalFindPrefix=n.substring(0,n.length-1);if(n.length===0)return this._incrementalFindSuccess=!0,this._incrementalFindIgnoreSelection=!0,t.setCaretOffset(t.getSelection().start),this._incrementalFindIgnoreSelection=!1,this.toggleIncrementalFind(),!0;t.reportStatus(a.formatMessage(e.incrementalFind,n));var r=t.getModel().find({string:n,start:t.getCaretOffset()-n.length-1,reverse:!0,caseInsensitive:n.toLowerCase()===n}).next();return r?(this._incrementalFindSuccess=!0,this._incrementalFindIgnoreSelection=!0,t.moveSelection(r.start,r.end),this._incrementalFindIgnoreSelection=!1):t.reportStatus(a.formatMessage(e.incrementalFindNotFound,n),"error"),!0}return!1}.bind(this)),this.textView.setAction("tab",function(){if(this.textView.getOptions("readonly"))return!1;if(!this.textView.getOptions("tabMode"))return;var e=this.editor,t=e.getModel(),n=e.getSelection(),r=t.getLineAtOffset(n.start),i=t.getLineAtOffset(n.end>n.start?n.end-1:n.end);if(r!==i){var s=[];s.push("");for(var o=r;o<=i;o++)s.push(t.getLine(o,!0));var u=t.getLineStart(r),a=t.getLineEnd(i,!0),f=this.textView.getOptions("tabSize","expandTab"),l=f.expandTab?(new Array(f.tabSize+1)).join(" "):"	";return e.setText(s.join(l),u,a),e.setSelection(u===n.start?n.start:n.start+l.length,n.end+(i-r+1)*l.length),!0}var c=e.getKeyModes();for(var h=0;h<c.length;h++)if(c[h].isActive())return c[h].tab();return!1}.bind(this)),this.textView.setAction("shiftTab",function(){if(this.textView.getOptions("readonly"))return!1;if(!this.textView.getOptions("tabMode"))return;var e=this.editor,t=e.getModel(),n=e.getSelection(),r=t.getLineAtOffset(n.start),i=t.getLineAtOffset(n.end>n.start?n.end-1:n.end),s=this.textView.getOptions("tabSize"),o=(new Array(s+1)).join(" "),u=[],a=0,f=0;for(var l=r;l<=i;l++){var c=t.getLine(l,!0);if(t.getLineStart(l)!==t.getLineEnd(l))if(c.indexOf("	")===0)c=c.substring(1),a++;else{if(c.indexOf(o)!==0)return!0;c=c.substring(s),a+=s}l===r&&(f=a),u.push(c)}var h=t.getLineStart(r),p=t.getLineEnd(i,!0),d=t.getLineStart(i);e.setText(u.join(""),h,p);var v=h===n.start?n.start:n.start-f,m=Math.max(v,n.end-a+(n.end===d+1&&n.start!==n.end?1:0));return e.setSelection(v,m),!0}.bind(this),{name:e.unindentLines}),this.textView.setKeyBinding(new n.KeyBinding(38,!1,!1,!0),"moveLinesUp"),this.textView.setAction("moveLinesUp",function(){if(this.textView.getOptions("readonly"))return!1;var e=this.editor,t=e.getModel(),n=e.getSelection(),r=t.getLineAtOffset(n.start);if(r===0)return!0;var i=t.getLineAtOffset(n.end>n.start?n.end-1:n.end),s=t.getLineCount(),o=t.getLineStart(r-1),u=t.getLineStart(r),a=t.getLineEnd(i,!0),f=t.getText(u,a),l=0;if(i===s-1){var c=t.getLineEnd(r-1),h=t.getLineEnd(r-1,!0);f+=t.getText(c,h),u=c,l=h-c}return this.startUndo(),e.setText("",u,a),e.setText(f,o,o),e.setSelection(o,o+f.length-l),this.endUndo(),!0}.bind(this),{name:e.moveLinesUp}),this.textView.setKeyBinding(new n.KeyBinding(40,!1,!1,!0),"moveLinesDown"),this.textView.setAction("moveLinesDown",function(){if(this.textView.getOptions("readonly"))return!1;var e=this.editor,t=e.getModel(),n=e.getSelection(),r=t.getLineAtOffset(n.start),i=t.getLineAtOffset(n.end>n.start?n.end-1:n.end),s=t.getLineCount();if(i===s-1)return!0;var o=t.getLineStart(r),u=t.getLineEnd(i,!0),a=t.getLineEnd(i+1,!0)-(u-o),f,l=0;if(i!==s-2)f=t.getText(o,u);else{var c=t.getLineEnd(i);f=t.getText(c,u)+t.getText(o,c),l+=u-c}return this.startUndo(),e.setText("",o,u),e.setText(f,a,a),e.setSelection(a+l,a+l+f.length),this.endUndo(),!0}.bind(this),{name:e.moveLinesDown}),this.textView.setKeyBinding(new n.KeyBinding(38,!0,!1,!0),"copyLinesUp"),this.textView.setAction("copyLinesUp",function(){if(this.textView.getOptions("readonly"))return!1;var e=this.editor,t=e.getModel(),n=e.getSelection(),r=t.getLineAtOffset(n.start),i=t.getLineAtOffset(n.end>n.start?n.end-1:n.end),s=t.getLineStart(r),o=t.getLineEnd(i,!0),u=t.getLineCount(),a="",f=t.getText(s,o);i===u-1&&(f+=a=t.getLineDelimiter());var l=s;return e.setText(f,l,l),e.setSelection(l,l+f.length-a.length),!0}.bind(this),{name:e.copyLinesUp}),this.textView.setKeyBinding(new n.KeyBinding(40,!0,!1,!0),"copyLinesDown"),this.textView.setAction("copyLinesDown",function(){if(this.textView.getOptions("readonly"))return!1;var e=this.editor,t=e.getModel(),n=e.getSelection(),r=t.getLineAtOffset(n.start),i=t.getLineAtOffset(n.end>n.start?n.end-1:n.end),s=t.getLineStart(r),o=t.getLineEnd(i,!0),u=t.getLineCount(),a="",f=t.getText(s,o);i===u-1&&(f=(a=t.getLineDelimiter())+f);var l=o;return e.setText(f,l,l),e.setSelection(l+a.length,l+f.length),!0}.bind(this),{name:e.copyLinesDown}),this.textView.setKeyBinding(new n.KeyBinding("d",!0,!1,!1),"deleteLines"),this.textView.setAction("deleteLines",function(){if(this.textView.getOptions("readonly"))return!1;var e=this.editor,t=e.getSelection(),n=e.getModel(),r=n.getLineAtOffset(t.start),i=n.getLineAtOffset(t.end>t.start?t.end-1:t.end),s=n.getLineStart(r),o=n.getLineEnd(i,!0);return e.setText("",s,o),!0}.bind(this),{name:e.deleteLines}),this.textView.setKeyBinding(new n.KeyBinding("l",!0),"gotoLine"),this.textView.setAction("gotoLine",function(){var t=this.editor,n=t.getModel(),r=n.getLineAtOffset(t.getCaretOffset());return r=prompt(e.gotoLinePrompty,r+1),r&&(r=parseInt(r,10),t.onGotoLine(r-1,0)),!0}.bind(this),{name:e.gotoLine}),this.textView.setKeyBinding(new n.KeyBinding(190,!0),"nextAnnotation"),this.textView.setAction("nextAnnotation",function(){var e=this.editor,t=e.getAnnotationModel();if(!t)return!0;var n=e.getModel(),r=e.getCaretOffset(),o=t.getAnnotations(r,n.getCharCount());while(o.hasNext()){var u=o.next();if(u.start<=r)continue;if(u.type!==i.AnnotationType.ANNOTATION_ERROR&&u.type!==i.AnnotationType.ANNOTATION_WARNING&&u.type!==i.AnnotationType.ANNOTATION_TASK&&u.type!==i.AnnotationType.ANNOTATION_BOOKMARK)continue;var a=s.Tooltip.getTooltip(this.textView);if(!a)return e.moveSelection(u.start),!0;var f=n.getLineAtOffset(u.start),l=this.textView,c=function(){setTimeout(function(){a.setTarget({getTooltipInfo:function(){var e=l.convert({x:l.getLocationAtOffset(u.start).x,y:l.getLocationAtOffset(n.getLineStart(f)).y},"document","page");return{contents:[u],x:e.x,y:e.y+Math.floor(l.getLineHeight(f)*1.33)}}},0)},0)};e.moveSelection(u.start,u.start,c);break}return!0}.bind(this),{name:e.nextAnnotation}),this.textView.setKeyBinding(new n.KeyBinding(188,!0),"previousAnnotation"),this.textView.setAction("previousAnnotation",function(){var e=this.editor,t=e.getAnnotationModel();if(!t)return!0;var n=e.getModel(),r=e.getCaretOffset(),o=t.getAnnotations(0,r),u=null;while(o.hasNext()){var a=o.next();if(a.start>=r)continue;if(a.type!==i.AnnotationType.ANNOTATION_ERROR&&a.type!==i.AnnotationType.ANNOTATION_WARNING&&a.type!==i.AnnotationType.ANNOTATION_TASK&&a.type!==i.AnnotationType.ANNOTATION_BOOKMARK)continue;u=a}if(u){var f=n.getLineAtOffset(u.start),l=s.Tooltip.getTooltip(this.textView);if(!l)return e.moveSelection(u.start),!0;var c=this.textView,h=function(){setTimeout(function(){l.setTarget({getTooltipInfo:function(){var e=c.convert({x:c.getLocationAtOffset(u.start).x,y:c.getLocationAtOffset(n.getLineStart(f)).y},"document","page");return{contents:[u],x:e.x,y:e.y+Math.floor(c.getLineHeight(f)*1.33)}}},0)},0)};e.moveSelection(u.start,u.start,h)}return!0}.bind(this),{name:e.prevAnnotation}),this.textView.setKeyBinding(new n.KeyBinding("e",!0,!1,!0,!1),"expand"),this.textView.setAction("expand",function(){var e=this.editor,t=e.getAnnotationModel();if(!t)return!0;var n=e.getModel(),r=e.getCaretOffset(),s=n.getLineAtOffset(r),o=n.getLineStart(s),u=n.getLineEnd(s,!0);n.getBaseModel&&(o=n.mapOffset(o),u=n.mapOffset(u),n=n.getBaseModel());var a,f=t.getAnnotations(o,u);while(!a&&f.hasNext()){var l=f.next();if(l.type!==i.AnnotationType.ANNOTATION_FOLDING)continue;if(l.expanded)continue;a=l}return a&&!a.expanded&&(a.expand(),t.modifyAnnotation(a)),!0}.bind(this),{name:e.expand}),this.textView.setKeyBinding(new n.KeyBinding("c",!0,!1,!0,!1),"collapse"),this.textView.setAction("collapse",function(){var e=this.editor,t=e.getAnnotationModel();if(!t)return!0;var n=e.getModel(),r=e.getCaretOffset(),s=n.getLineAtOffset(r),o=n.getLineStart(s),u=n.getLineEnd(s,!0);n.getBaseModel&&(o=n.mapOffset(o),u=n.mapOffset(u),n=n.getBaseModel());var a,f=t.getAnnotations(o,u);while(!a&&f.hasNext()){var l=f.next();if(l.type!==i.AnnotationType.ANNOTATION_FOLDING)continue;a=l}return a&&a.expanded&&(e.setCaretOffset(a.start),a.collapse(),t.modifyAnnotation(a)),!0}.bind(this),{name:e.collapse}),this.textView.setKeyBinding(new n.KeyBinding("e",!0,!0,!0,!1),"expandAll"),this.textView.setAction("expandAll",function(){var e=this.editor,t=e.getAnnotationModel();if(!t)return!0;var n=e.getModel(),r,s=t.getAnnotations(0,n.getCharCount());this.textView.setRedraw(!1);while(s.hasNext()){r=s.next();if(r.type!==i.AnnotationType.ANNOTATION_FOLDING)continue;r.expanded||(r.expand(),t.modifyAnnotation(r))}return this.textView.setRedraw(!0),!0}.bind(this),{name:e.expandAll}),this.textView.setKeyBinding(new n.KeyBinding("c",!0,!0,!0,!1),"collapseAll"),this.textView.setAction("collapseAll",function(){var e=this.editor,t=e.getAnnotationModel();if(!t)return!0;var n=e.getModel(),r,s=t.getAnnotations(0,n.getCharCount());this.textView.setRedraw(!1);while(s.hasNext()){r=s.next();if(r.type!==i.AnnotationType.ANNOTATION_FOLDING)continue;r.expanded&&(r.collapse(),t.modifyAnnotation(r))}return this.textView.setRedraw(!0),!0}.bind(this),{name:e.collapseAll}),this.textView.setKeyBinding(new n.KeyBinding("q",!a.isMac,!1,!1,a.isMac),"lastEdit"),this.textView.setAction("lastEdit",function(){return typeof this._lastEditLocation=="number"&&this.editor.showSelection(this._lastEditLocation),!0}.bind(this),{name:e.lastEdit})},toggleIncrementalFind:function(){this._incrementalFindActive=!this._incrementalFindActive,this._incrementalFindActive?(this.editor.reportStatus(a.formatMessage(e.incrementalFind,this._incrementalFindPrefix)),this.textView.addEventListener("Verify",this._incrementalFindListener.onVerify),this.textView.addEventListener("Selection",this._incrementalFindListener.onSelection)):(this._incrementalFindPrefix="",this.editor.reportStatus(""),this.textView.removeEventListener("Verify",this._incrementalFindListener.onVerify),this.textView.removeEventListener("Selection",this._incrementalFindListener.onSelection),this.textView.setCaretOffset(this.textView.getCaretOffset()))},startUndo:function(){this.undoStack&&this.undoStack.startCompoundChange()},endUndo:function(){this.undoStack&&this.undoStack.endCompoundChange()},cancel:function(){this.toggleIncrementalFind()},isActive:function(){return this._incrementalFindActive},isStatusActive:function(){return this._incrementalFindActive},lineUp:function(){if(this._incrementalFindActive){var t=this._incrementalFindPrefix;if(t.length===0)return!1;var n=this.editor,r=n.getModel(),i;this._incrementalFindSuccess?i=n.getCaretOffset()-t.length-1:i=r.getCharCount()-1;var s=n.getModel().find({string:t,start:i,reverse:!0,caseInsensitive:t.toLowerCase()===t}).next();return s?(this._incrementalFindSuccess=!0,this._incrementalFindIgnoreSelection=!0,n.moveSelection(s.start,s.end),this._incrementalFindIgnoreSelection=!1,n.reportStatus(a.formatMessage(e.incrementalFind,t))):(n.reportStatus(a.formatMessage(e.incrementalFindNotFound,t),"error"),this._incrementalFindSuccess=!1),!0}return!1},lineDown:function(){if(this._incrementalFindActive){var t=this._incrementalFindPrefix;if(t.length===0)return!1;var n=this.editor,r=0;this._incrementalFindSuccess&&(r=n.getSelection().start+1);var i=n.getModel().find({string:t,start:r,caseInsensitive:t.toLowerCase()===t}).next();return i?(this._incrementalFindSuccess=!0,this._incrementalFindIgnoreSelection=!0,n.moveSelection(i.start,i.end),this._incrementalFindIgnoreSelection=!1,n.reportStatus(a.formatMessage(e.incrementalFind,t))):(n.reportStatus(a.formatMessage(e.incrementalFindNotFound,t),"error"),this._incrementalFindSuccess=!1),!0}return!1},enter:function(){return!1}},v.prototype={startUndo:function(){this.undoStack&&this.undoStack.startCompoundChange()},endUndo:function(){this.undoStack&&this.undoStack.endCompoundChange()},init:function(){function t(e,t,n){var r="/*",i="*/",s=e.getLineAtOffset(t),o=e.getLineAtOffset(n),u,a,f,l,c,h,p;for(u=s;u>=0;u--){a=e.getLine(u),f=u===s?t-e.getLineStart(s):a.length,l=a.lastIndexOf(r,f),c=a.lastIndexOf(i,f);if(c>l)break;if(l!==-1){h=e.getLineStart(u)+l;break}}for(u=o;u<e.getLineCount();u++){a=e.getLine(u),f=u===o?n-e.getLineStart(o):0,l=a.indexOf(r,f),c=a.indexOf(i,f);if(l!==-1&&l<c)break;if(c!==-1){p=e.getLineStart(u)+c;break}}return{commentStart:h,commentEnd:p}}this.textView.setAction("lineStart",function(){var e=this.editor,t=e.getModel(),n=e.getCaretOffset(),r=t.getLineAtOffset(n),i=t.getLineStart(r),s=t.getLine(r),o;for(o=0;o<s.length;o++){var u=s.charCodeAt(o);if(u!==32&&u!==9)break}return o+=i,n!==o?(e.setSelection(o,o),!0):!1}.bind(this)),this.textView.setKeyBinding(new n.KeyBinding(191,!0),"toggleLineComment"),this.textView.setAction("toggleLineComment",function(){if(this.textView.getOptions("readonly"))return!1;var e=this.editor,t=e.getModel(),n=e.getSelection(),r=t.getLineAtOffset(n.start),i=t.getLineAtOffset(n.end>n.start?n.end-1:n.end),s=!0,o=[],u,a;for(var f=r;f<=i;f++){u=t.getLine(f,!0),o.push(u);if(!s||(a=u.indexOf("//"))===-1)s=!1;else if(a!==0){var l;for(l=0;l<a;l++){var c=u.charCodeAt(l);if(c!==32&&c!==9)break}s=l===a}}var h,p,d,v=t.getLineStart(r),m=t.getLineEnd(i,!0);if(s){for(var g=0;g<o.length;g++)u=o[g],a=u.indexOf("//"),o[g]=u.substring(0,a)+u.substring(a+2);h=o.join("");var y=t.getLineStart(i);p=v===n.start?n.start:n.start-2,d=n.end-2*(i-r+1)+(n.end===y+1?2:0)}else o.splice(0,0,""),h=o.join("//"),p=v===n.start?n.start:n.start+2,d=n.end+2*(i-r+1);return e.setText(h,v,m),e.setSelection(p,d),!0}.bind(this),{name:e.toggleLineComment}),this.textView.setKeyBinding(new n.KeyBinding(191,!0,!a.isMac,!1,a.isMac),"addBlockComment"),this.textView.setAction("addBlockComment",function(){if(this.textView.getOptions("readonly"))return!1;var e=this.editor,n=e.getModel(),r=e.getSelection(),i="/*",s="*/",o=new RegExp("/\\*|\\*/","g"),u=t(n,r.start,r.end);if(u.commentStart!==undefined&&u.commentEnd!==undefined)return!0;var a=n.getText(r.start,r.end);if(a.length===0)return!0;var f=a.length;a=a.replace(o,"");var l=a.length;return e.setText(i+a+s,r.start,r.end),e.setSelection(r.start+i.length,r.end+i.length+(l-f)),!0}.bind(this),{name:e.addBlockComment}),this.textView.setKeyBinding(new n.KeyBinding(220,!0,!a.isMac,!1,a.isMac),"removeBlockComment"),this.textView.setAction("removeBlockComment",function(){if(this.textView.getOptions("readonly"))return!1;var e=this.editor,n=e.getModel(),r=e.getSelection(),i="/*",s="*/",o=n.getText(r.start,r.end),u,a,f;for(f=0;f<o.length;f++)if(o.substring(f,f+i.length)===i){u=r.start+f;break}for(;f<o.length;f++)if(o.substring(f,f+s.length)===s){a=r.start+f;break}if(u!==undefined&&a!==undefined)e.setText(n.getText(u+i.length,a),u,a+s.length),e.setSelection(u,a);else{var l=t(n,r.start,r.end);if(l.commentStart===undefined||l.commentEnd===undefined)return!0;var c=n.getText(l.commentStart+i.length,l.commentEnd);e.setText(c,l.commentStart,l.commentEnd+s.length),e.setSelection(r.start-i.length,r.end-s.length)}return!0}.bind(this),{name:e.removeBlockComment})},contentAssistProposalApplied:function(e){var t=e.data.proposal;if(t.positions&&this.linkedMode){var n=[];for(var r=0;r<t.positions.length;++r)n[r]={positions:[{offset:t.positions[r].offset,length:t.positions[r].length}]};var i={groups:n,escapePosition:t.escapePosition};this.linkedMode.enterLinkedMode(i)}else t.escapePosition&&this.textView.setCaretOffset(t.escapePosition);return!0},cancel:function(){return!1},isActive:function(){return!0},isStatusActive:function(){return!1},lineUp:function(){return!1},lineDown:function(){return!1},enter:function(){if(this.textView.getOptions("readonly"))return!1;var e=this.editor,t=e.getSelection();if(t.start===t.end){var n=e.getModel(),r=n.getLineAtOffset(t.start),i=n.getLine(r,!0),s=n.getLineStart(r),o=0,u=t.start-s,a;while(o<u&&((a=i.charCodeAt(o))===32||a===9))o++;if(o>0){var f=i.substring(0,o);o=u;while(o<i.length&&((a=i.charCodeAt(o++))===32||a===9))t.end++;return e.setText(n.getLineDelimiter()+f,t.start,t.end),!0}}return!1},tab:function(){return!1}},m.prototype={enterLinkedMode:function(t){if(this.linkedModeActive)return;this.linkedModeActive=!0,this.linkedModePositions=[];for(var r=0;r<t.groups.length;++r){var i=t.groups[r];this.linkedModePositions[r]={offset:i.positions[0].offset,length:i.positions[0].length}}this.linkedModeEscapePosition=t.escapePosition,this.linkedModeCurrentPositionIndex=0,this.selectTextForLinkedModePosition(this.linkedModePositions[this.linkedModeCurrentPositionIndex]),this.textView.addEventListener("Verify",this.linkedModeListener.onVerify),this.textView.setKeyBinding(new n.KeyBinding(9),"nextLinkedModePosition"),this.textView.setAction("nextLinkedModePosition",function(){return this.linkedModeCurrentPositionIndex=++this.linkedModeCurrentPositionIndex%this.linkedModePositions.length,this.selectTextForLinkedModePosition(this.linkedModePositions[this.linkedModeCurrentPositionIndex]),!0}.bind(this)),this.textView.setKeyBinding(new n.KeyBinding(9,!1,!0),"previousLinkedModePosition"),this.textView.setAction("previousLinkedModePosition",function(){return this.linkedModeCurrentPositionIndex=this.linkedModeCurrentPositionIndex>0?this.linkedModeCurrentPositionIndex-1:this.linkedModePositions.length-1,this.selectTextForLinkedModePosition(this.linkedModePositions[this.linkedModeCurrentPositionIndex]),!0}.bind(this)),this.editor.reportStatus(e.linkedModeEntered,null,!0)},isActive:function(){return this.linkedModeActive},isStatusActive:function(){return this.linkedModeActive},enter:function(){return this.cancel(),!0},cancel:function(t){if(!this.linkedModeActive)return;this.linkedModeActive=!1,this.textView.removeEventListener("Verify",this.linkedModeListener.onVerify),this.textView.setKeyBinding(new n.KeyBinding(9),"tab"),this.textView.setKeyBinding(new n.KeyBinding(9,!1,!0),"shiftTab"),t||this.textView.setCaretOffset(this.linkedModeEscapePosition,!1),this.editor.reportStatus(e.linkedModeExited,null,!0)},lineUp:function(){return this.cancel(!0),!1},lineDown:function(){return this.cancel(!0),!1},selectTextForLinkedModePosition:function(e){this.textView.setSelection(e.offset,e.offset+e.length)}},{UndoFactory:f,LineNumberRulerFactory:l,FoldingRulerFactory:c,AnnotationFactory:h,TextDNDFactory:p,TextActions:d,SourceCodeActions:v,LinkedMode:m}}),define("orion/compare/diff-provider",["i18n!orion/compare/nls/messages","orion/Deferred"],function(e,t){function n(e,n,r){var i=new t;return e[n].apply(e,r).then(function(e){i.resolve(e)},function(e){i.reject(e)}),i}function r(e){if(e.indexOf("://")===-1){var t=document.createElement("a");return t.href=e,t.href}return e}function i(t,n){var i=t.getServiceReferences("orion.core.diff"),s=i;if(n){s=[];for(var o=0;o<i.length;++o)n(i[o])&&s.push(i[o])}var u=[],a=[];for(var o=0;o<s.length;++o)u[o]=new RegExp(s[o].getProperty("pattern")||".*"),a[o]=t.getService(s[o]);this._getService=function(t){t=r(t);for(var n=0;n<u.length;++n)if(u[n].test(t))return a[n];throw e["No Matching DiffService for location:"]+t}}return i.prototype={getDiffContent:function(e){return n(this._getService(e),"getDiffContent",arguments)},getDiffFileURI:function(e){return n(this._getService(e),"getDiffFileURI",arguments)}},{DiffProvider:i}}),define("examples/editor/textStyler",["orion/editor/annotations"],function(e){function F(e,t){this.keywords=e,this.whitespacesVisible=t,this.setText("")}function I(){F.call(this,null,!0)}function q(e){F.call(this,null,e)}function R(){F.call(this,null,!1)}function U(e,i,s){this.commentStart="/*",this.commentEnd="*/";var o=[];switch(i){case"java":o=n;break;case"js":o=t;break;case"css":o=r}this.whitespacesVisible=!1,this.detectHyperlinks=!0,this.highlightCaretLine=!1,this.foldingEnabled=!0,this.detectTasks=!0,this._scanner=new F(o,this.whitespacesVisible),this._firstScanner=new R,this._commentScanner=new q(this.whitespacesVisible),this._whitespaceScanner=new I,i==="css"&&(this._scanner.isCSS=!0,this._firstScanner.isCSS=!0),this.view=e,this.annotationModel=s,this._bracketAnnotations=undefined;var u=this;this._listener={onChanged:function(e){u._onModelChanged(e)},onDestroy:function(e){u._onDestroy(e)},onLineStyle:function(e){u._onLineStyle(e)},onMouseDown:function(e){u._onMouseDown(e)},onSelection:function(e){u._onSelection(e)}};var a=e.getModel();a.getBaseModel&&(a=a.getBaseModel()),a.addEventListener("Changed",this._listener.onChanged),e.addEventListener("MouseDown",this._listener.onMouseDown),e.addEventListener("Selection",this._listener.onSelection),e.addEventListener("Destroy",this._listener.onDestroy),e.addEventListener("LineStyle",this._listener.onLineStyle),this._computeComments(),this._computeFolding(),e.redrawLines()}var t=["break","case","class","catch","continue","const","debugger","default","delete","do","else","enum","export","extends","false","finally","for","function","if","implements","import","in","instanceof","interface","let","new","null","package","private","protected","public","return","static","super","switch","this","throw","true","try","typeof","undefined","var","void","while","with","yield"],n=["abstract","boolean","break","byte","case","catch","char","class","continue","default","do","double","else","extends","false","final","finally","float","for","if","implements","import","instanceof","int","interface","long","native","new","null","package","private","protected","public","return","short","static","super","switch","synchronized","this","throw","throws","transient","true","try","void","volatile","while"],r=["alignment-adjust","alignment-baseline","animation","animation-delay","animation-direction","animation-duration","animation-iteration-count","animation-name","animation-play-state","animation-timing-function","appearance","azimuth","backface-visibility","background","background-attachment","background-clip","background-color","background-image","background-origin","background-position","background-repeat","background-size","baseline-shift","binding","bleed","bookmark-label","bookmark-level","bookmark-state","bookmark-target","border","border-bottom","border-bottom-color","border-bottom-left-radius","border-bottom-right-radius","border-bottom-style","border-bottom-width","border-collapse","border-color","border-image","border-image-outset","border-image-repeat","border-image-slice","border-image-source","border-image-width","border-left","border-left-color","border-left-style","border-left-width","border-radius","border-right","border-right-color","border-right-style","border-right-width","border-spacing","border-style","border-top","border-top-color","border-top-left-radius","border-top-right-radius","border-top-style","border-top-width","border-width","bottom","box-align","box-decoration-break","box-direction","box-flex","box-flex-group","box-lines","box-ordinal-group","box-orient","box-pack","box-shadow","box-sizing","break-after","break-before","break-inside","caption-side","clear","clip","color","color-profile","column-count","column-fill","column-gap","column-rule","column-rule-color","column-rule-style","column-rule-width","column-span","column-width","columns","content","counter-increment","counter-reset","crop","cue","cue-after","cue-before","cursor","direction","display","dominant-baseline","drop-initial-after-adjust","drop-initial-after-align","drop-initial-before-adjust","drop-initial-before-align","drop-initial-size","drop-initial-value","elevation","empty-cells","fit","fit-position","flex-align","flex-flow","flex-inline-pack","flex-order","flex-pack","float","float-offset","font","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","grid-columns","grid-rows","hanging-punctuation","height","hyphenate-after","hyphenate-before","hyphenate-character","hyphenate-lines","hyphenate-resource","hyphens","icon","image-orientation","image-rendering","image-resolution","inline-box-align","left","letter-spacing","line-height","line-stacking","line-stacking-ruby","line-stacking-shift","line-stacking-strategy","list-style","list-style-image","list-style-position","list-style-type","margin","margin-bottom","margin-left","margin-right","margin-top","mark","mark-after","mark-before","marker-offset","marks","marquee-direction","marquee-loop","marquee-play-count","marquee-speed","marquee-style","max-height","max-width","min-height","min-width","move-to","nav-down","nav-index","nav-left","nav-right","nav-up","opacity","orphans","outline","outline-color","outline-offset","outline-style","outline-width","overflow","overflow-style","overflow-x","overflow-y","padding","padding-bottom","padding-left","padding-right","padding-top","page","page-break-after","page-break-before","page-break-inside","page-policy","pause","pause-after","pause-before","perspective","perspective-origin","phonemes","pitch","pitch-range","play-during","position","presentation-level","punctuation-trim","quotes","rendering-intent","resize","rest","rest-after","rest-before","richness","right","rotation","rotation-point","ruby-align","ruby-overhang","ruby-position","ruby-span","size","speak","speak-header","speak-numeral","speak-punctuation","speech-rate","stress","string-set","table-layout","target","target-name","target-new","target-position","text-align","text-align-last","text-decoration","text-emphasis","text-height","text-indent","text-justify","text-outline","text-shadow","text-transform","text-wrap","top","transform","transform-origin","transform-style","transition","transition-delay","transition-duration","transition-property","transition-timing-function","unicode-bidi","vertical-align","visibility","voice-balance","voice-duration","voice-family","voice-pitch","voice-pitch-range","voice-rate","voice-stress","voice-volume","volume","white-space","white-space-collapse","widows","width","word-break","word-spacing","word-wrap","z-index"],i=1,s=2,o=3,u=4,a=5,f=6,l=7,c=8,h=9,p=10,d=11,v=12,m=13,g=14,y="{}()[]<>",b={styleClass:"comment"},w={styleClass:"token_multiline_comment"},E={styleClass:"token_doc_comment"},S={styleClass:"token_doc_html_markup"},x={styleClass:"token_task_tag"},T={styleClass:"token_doc_tag"},N={styleClass:"token-string"},C={styleClass:"token_number"},k={styleClass:"token_keyword"},L={styleClass:"token_space"},A={styleClass:"token_tab"},O={styleClass:"line_caret"},M={styleClass:"ruler"},_={styleCLass:"ruler.annotations"},D={styleClass:"ruler.lines"},P={styleClass:"ruler.overview"},H={styleCLass:"rulerLines"},B={styleClass:"rulerLines.even"},j={styleClass:"rulerLines.odd"};return F.prototype={getOffset:function(){return this.offset},getStartOffset:function(){return this.startOffset},getData:function(){return this.text.substring(this.startOffset,this.offset)},getDataLength:function(){return this.offset-this.startOffset},_default:function(e){switch(e){case 32:case 9:if(this.whitespacesVisible)return e===32?d:p;do e=this._read();while(e===32||e===9);return this._unread(e),h;case 123:case 125:case 40:case 41:case 91:case 93:case 60:case 62:return e;default:var t=this.isCSS,n=this.offset-1;if(!t&&48<=e&&e<=57){var r=!1,u=!1,a=!1,f=e;do{e=this._read();if(e===46&&!r)r=!0;else if(e===101&&!u)r=u=!0,e=this._read(),e!==45&&this._unread(e);else if(e===120&&f===48&&this.offset-n===2)r=u=a=!0;else if(!(48<=e&&e<=57||a&&(65<=e&&e<=70||97<=e&&e<=102)))break}while(!0);return this._unread(e),o}if(97<=e&&e<=122||65<=e&&e<=90||e===95||45===e&&t){do e=this._read();while(97<=e&&e<=122||65<=e&&e<=90||e===95||48<=e&&e<=57||45===e&&t);this._unread(e);var l=this.keywords;if(l.length>0){var c=this.text.substring(n,this.offset);for(var v=0;v<l.length;v++)if(this.keywords[v]===c)return s}}return i}},_read:function(){return this.offset<this.text.length?this.text.charCodeAt(this.offset++):-1},_unread:function(e){e!==-1&&this.offset--},nextToken:function(){this.startOffset=this.offset;for(;;){var e=this._read(),t;switch(e){case-1:return null;case 47:e=this._read();if(!this.isCSS&&e===47)for(;;){e=this._read();if(e===-1||e===10||e===13)return this._unread(e),f}if(e===42){e=this._read();var n=l;e===42&&(n=c);for(;;){while(e===42){e=this._read();if(e===47)return n}if(e===-1)return this._unread(e),n;e=this._read()}}return this._unread(e),i;case 39:t=u;for(;;){e=this._read();switch(e){case 39:return t;case 13:case 10:case-1:return this._unread(e),t;case 92:e=this._read();switch(e){case 10:t=a;break;case 13:t=a,e=this._read(),e!==10&&this._unread(e)}}}break;case 34:t=u;for(;;){e=this._read();switch(e){case 34:return t;case 13:case 10:case-1:return this._unread(e),t;case 92:e=this._read();switch(e){case 10:t=a;break;case 13:t=a,e=this._read(),e!==10&&this._unread(e)}}}break;default:return this._default(e)}}},setText:function(e){this.text=e,this.offset=0,this.startOffset=0}},I.prototype=new F(null),I.prototype.nextToken=function(){this.startOffset=this.offset;for(;;){var e=this._read();switch(e){case-1:return null;case 32:return d;case 9:return p;default:do e=this._read();while(e!==32&&e!==9&&e!==-1);return this._unread(e),i}}},q.prototype=new F(null),q.prototype.setType=function(e){this._type=e},q.prototype.nextToken=function(){this.startOffset=this.offset;for(;;){var e=this._read();switch(e){case-1:return null;case 32:case 9:if(this.whitespacesVisible)return e===32?d:p;do e=this._read();while(e===32||e===9);return this._unread(e),h;case 60:if(this._type===c){do e=this._read();while(e!==62&&e!==-1);if(e===62)return v}return i;case 64:if(this._type===c){do e=this._read();while(97<=e&&e<=122||65<=e&&e<=90||e===95||48<=e&&e<=57);return this._unread(e),m}return i;case 84:if((e=this._read())===79)if((e=this._read())===68)if((e=this._read())===79){e=this._read();if(!(97<=e&&e<=122||65<=e&&e<=90||e===95||48<=e&&e<=57))return this._unread(e),g;this._unread(e)}else this._unread(e);else this._unread(e);else this._unread(e);default:do e=this._read();while(e!==32&&e!==9&&e!==-1&&e!==60&&e!==64&&e!==84);return this._unread(e),i}}},R.prototype=new F(null),R.prototype._default=function(e){for(;;){e=this._read();switch(e){case 47:case 34:case 39:case-1:return this._unread(e),i}}},U.prototype={getClassNameForToken:function(e){switch(e){case"singleLineComment":return b.styleClass;case"multiLineComment":return w.styleClass;case"docComment":return E.styleClass;case"docHtmlComment":return S.styleClass;case"tasktag":return x.styleClass;case"doctag":return T.styleClass;case"string":return N.styleClass;case"number":return C.styleClass;case"keyword":return k.styleClass;case"space":return L.styleClass;case"tab":return A.styleClass;case"caretLine":return O.styleClass;case"rulerStyle":return M.styleClass;case"annotationsStyle":return _.styleClass;case"rulerFolding":return H.styleClass;case"rulerOverview":return P.styleClass;case"rulerLines":return H.styleClass;case"rulerLinesEven":return B.styleClass;case"rulerLinesOdd":return j.styleClass}return null},destroy:function(){var e=this.view;if(e){var t=e.getModel();t.getBaseModel&&(t=t.getBaseModel()),t.removeEventListener("Changed",this._listener.onChanged),e.removeEventListener("MouseDown",this._listener.onMouseDown),e.removeEventListener("Selection",this._listener.onSelection),e.removeEventListener("Destroy",this._listener.onDestroy),e.removeEventListener("LineStyle",this._listener.onLineStyle),this.view=null}},setHighlightCaretLine:function(e){this.highlightCaretLine=e},setWhitespacesVisible:function(e){this.whitespacesVisible=e,this._scanner.whitespacesVisible=e,this._commentScanner.whitespacesVisible=e},setDetectHyperlinks:function(e){this.detectHyperlinks=e},setFoldingEnabled:function(e){this.foldingEnabled=e},setDetectTasks:function(e){this.detectTasks=e},_binarySearch:function(e,t,n,r,i){var s;r===undefined&&(r=-1),i===undefined&&(i=e.length);while(i-r>1){s=Math.floor((i+r)/2);if(t<=e[s].start)i=s;else{if(n&&t<e[s].end){i=s;break}r=s}}return i},_computeComments:function(){var e=this.view.getModel();e.getBaseModel&&(e=e.getBaseModel()),this.comments=this._findComments(e.getText())},_computeFolding:function(){if(!this.foldingEnabled)return;var t=this.view,n=t.getModel();if(!n.getBaseModel)return;var r=this.annotationModel;if(!r)return;r.removeAnnotations(e.AnnotationType.ANNOTATION_FOLDING);var i=[],s=n.getBaseModel(),o=this.comments;for(var u=0;u<o.length;u++){var a=o[u],f=this._createFoldingAnnotation(n,s,a.start,a.end);f&&i.push(f)}r.replaceAnnotations(null,i)},_createFoldingAnnotation:function(t,n,r,i){var s=n.getLineAtOffset(r),o=n.getLineAtOffset(i);return s===o?null:new(e.AnnotationType.getType(e.AnnotationType.ANNOTATION_FOLDING))(r,i,t)},_computeTasks:function(t,n,r){if(!this.detectTasks)return;var i=this.annotationModel;if(!i)return;var s=this.view,o=s.getModel(),u=o;o.getBaseModel&&(u=o.getBaseModel());var a=i.getAnnotations(n,r),l=[],c=e.AnnotationType.ANNOTATION_TASK;while(a.hasNext()){var h=a.next();h.type===c&&l.push(h)}var p=[],d=this._commentScanner;d.setText(u.getText(n,r));var v;while(v=d.nextToken()){var m=d.getStartOffset()+n;if(v===g){var y=u.getLineEnd(u.getLineAtOffset(m));t!==f&&(y=Math.min(y,r-this.commentEnd.length)),p.push(e.AnnotationType.createAnnotation(c,m,y,u.getText(m,y)))}}i.replaceAnnotations(l,p)},_getLineStyle:function(e){if(this.highlightCaretLine){var t=this.view,n=t.getModel(),r=t.getSelection();if(r.start===r.end&&n.getLineAtOffset(r.start)===e)return O}return null},_getStyles:function(e,t,n){e.getBaseModel&&(n=e.mapOffset(n));var r=n+t.length,i=[],s=n,o=this.comments,u=this._binarySearch(o,n,!0);for(var f=u;f<o.length;f++){if(o[f].start>=r)break;var h=o[f].start,p=o[f].end;s<h&&this._parse(t.substring(s-n,h-n),s,i);var d=o[f].type,v;switch(d){case c:v=E;break;case l:v=w;break;case a:v=N}var m=Math.max(s,h),g=Math.min(r,p);d!==c&&d!==l||!this.whitespacesVisible&&!this.detectHyperlinks?d===a&&this.whitespacesVisible?this._parseString(t.substring(m-n,g-n),m,i,N):i.push({start:m,end:g,style:v}):this._parseComment(t.substring(m-n,g-n),m,i,v,d),s=p}s<r&&this._parse(t.substring(s-n,r-n),s,i);if(e.getBaseModel)for(var y=0;y<i.length;y++){var b=i[y].end-i[y].start;i[y].start=e.mapOffset(i[y].start,!0),i[y].end=i[y].start+b}return i},_parse:function(e,t,n){var r=this._scanner;r.setText(e);var i;while(i=r.nextToken()){var h=r.getStartOffset()+t,v=null;switch(i){case s:v=k;break;case o:v=C;break;case a:case u:if(this.whitespacesVisible){this._parseString(r.getData(),h,n,N);continue}v=N;break;case c:this._parseComment(r.getData(),h,n,E,i);continue;case f:this._parseComment(r.getData(),h,n,b,i);continue;case l:this._parseComment(r.getData(),h,n,w,i);continue;case p:this.whitespacesVisible&&(v=A);break;case d:this.whitespacesVisible&&(v=L)}n.push({start:h,end:r.getOffset()+t,style:v})}},_parseComment:function(e,t,n,r,i){var s=this._commentScanner;s.setText(e),s.setType(i);var o;while(o=s.nextToken()){var u=s.getStartOffset()+t,a=r;switch(o){case p:this.whitespacesVisible&&(a=A);break;case d:this.whitespacesVisible&&(a=L);break;case v:a=S;break;case m:a=T;break;case g:a=x;break;default:this.detectHyperlinks&&(a=this._detectHyperlinks(s.getData(),u,n,a))}a&&n.push({start:u,end:s.getOffset()+t,style:a})}},_parseString:function(e,t,n,r){var i=this._whitespaceScanner;i.setText(e);var s;while(s=i.nextToken()){var o=i.getStartOffset()+t,u=r;switch(s){case p:this.whitespacesVisible&&(u=A);break;case d:this.whitespacesVisible&&(u=L)}u&&n.push({start:o,end:i.getOffset()+t,style:u})}},_detectHyperlinks:function(e,t,n,r){var i=null,s,o;if((s=e.indexOf("://"))>0){i=e;var u=s;while(u>0){var a=i.charCodeAt(u-1);if(!(97<=a&&a<=122||65<=a&&a<=90||45===a||48<=a&&a<=57))break;u--}if(u>0){var f="\"\"''(){}[]<>";s=f.indexOf(i.substring(u-1,u));if(s!==-1&&(s&1)===0&&(s=i.lastIndexOf(f.substring(s+1,s+2)))!==-1){var l=s;return o=this._clone(r),o.tagName="A",o.attributes={href:i.substring(u,l)},n.push({start:t,end:t+u,style:r}),n.push({start:t+u,end:t+l,style:o}),n.push({start:t+l,end:t+e.length,style:r}),null}}}else e.toLowerCase().indexOf("bug#")===0&&(i="https://bugs.eclipse.org/bugs/show_bug.cgi?id="+parseInt(e.substring(4),10));return i?(o=this._clone(r),o.tagName="A",o.attributes={href:i},o):r},_clone:function(e){if(!e)return e;var t={};for(var n in e)if(e.hasOwnProperty(n)){var r=e[n];t[n]=r}return t},_findComments:function(e,t){t=t||0;var n=this._firstScanner,r;n.setText(e);var i=[];while(r=n.nextToken())(r===l||r===c||r===a)&&i.push({start:n.getStartOffset()+t,end:n.getOffset()+t,type:r}),(r===f||r===l||r===c)&&this._computeTasks(r,n.getStartOffset()+t,n.getOffset()+t);return i},_findMatchingBracket:function(e,t){var n=y,r=e.getText(t,t+1),i=n.indexOf(r,0);if(i===-1)return-1;var s;i&1?s=n.substring(i-1,i):s=n.substring(i+1,i+2);var o=e.getLineAtOffset(t),u=e.getLine(o),a=e.getLineStart(o),f=e.getLineEnd(o);n=this._findBrackets(r,s,u,a,a,f);for(var l=0;l<n.length;l++){var c=n[l]>=0?1:-1;if(n[l]*c-1===t){var h=1;if(i&1){l--;for(;l>=0;l--){c=n[l]>=0?1:-1,h+=c;if(h===0)return n[l]*c-1}o-=1;while(o>=0){u=e.getLine(o),a=e.getLineStart(o),f=e.getLineEnd(o),n=this._findBrackets(r,s,u,a,a,f);for(var p=n.length-1;p>=0;p--){c=n[p]>=0?1:-1,h+=c;if(h===0)return n[p]*c-1}o--}}else{l++;for(;l<n.length;l++){c=n[l]>=0?1:-1,h+=c;if(h===0)return n[l]*c-1}o+=1;var d=e.getLineCount();while(o<d){u=e.getLine(o),a=e.getLineStart(o),f=e.getLineEnd(o),n=this._findBrackets(r,s,u,a,a,f);for(var v=0;v<n.length;v++){c=n[v]>=0?1:-1,h+=c;if(h===0)return n[v]*c-1}o++}}break}}return-1},_findBrackets:function(e,t,n,r,i,s){var o=[],u=e.charCodeAt(0),a=t.charCodeAt(0),f=i,l=this._scanner,c,h=this.comments,p=this._binarySearch(h,i,!0);for(var d=p;d<h.length;d++){if(h[d].start>=s)break;var v=h[d].start,m=h[d].end;if(f<v){l.setText(n.substring(f-i,v-i));while(c=l.nextToken())c===u?o.push(l.getStartOffset()+f-i+r+1):c===a&&o.push(-(l.getStartOffset()+f-i+r+1))}f=m}if(f<s){l.setText(n.substring(f-i,s-i));while(c=l.nextToken())c===u?o.push(l.getStartOffset()+f-i+r+1):c===a&&o.push(-(l.getStartOffset()+f-i+r+1))}return o},_onDestroy:function(e){this.destroy()},_onLineStyle:function(e){e.textView===this.view&&(e.style=this._getLineStyle(e.lineIndex)),e.ranges=this._getStyles(e.textView.getModel(),e.lineText,e.lineStart)},_onSelection:function(t){var n=t.oldValue,r=t.newValue,i=this.view,s=i.getModel(),o;if(this.highlightCaretLine){var u=s.getLineAtOffset(n.start);o=s.getLineAtOffset(r.start);var a=r.start===r.end,f=n.start===n.end;if(u!==o||!f||!a)f&&i.redrawLines(u,u+1),(u!==o||!f)&&a&&i.redrawLines(o,o+1)}if(!this.annotationModel)return;var l=this._bracketAnnotations,c,h;if(r.start===r.end&&(h=i.getCaretOffset())>0){var p=h-1;s.getBaseModel&&(p=s.mapOffset(p),s=s.getBaseModel());var d=this._findMatchingBracket(s,p);d!==-1&&(c=[e.AnnotationType.createAnnotation(e.AnnotationType.ANNOTATION_MATCHING_BRACKET,d,d+1),e.AnnotationType.createAnnotation(e.AnnotationType.ANNOTATION_CURRENT_BRACKET,p,p+1)])}this._bracketAnnotations=c,this.annotationModel.replaceAnnotations(l,c)},_onMouseDown:function(e){if(e.clickCount!==2)return;var t=this.view,n=t.getModel(),r=t.getOffsetAtLocation(e.x,e.y);if(r>0){var i=r-1,s=n;n.getBaseModel&&(i=n.mapOffset(i),s=n.getBaseModel());var o=this._findMatchingBracket(s,i);if(o!==-1){e.preventDefault();var u=o;n.getBaseModel&&(u=n.mapOffset(u,!0)),r>u&&(r--,u++),t.setSelection(u,r)}}},_onModelChanged:function(t){var n=t.start,r=t.removedCharCount,i=t.addedCharCount,s=i-r,o=this.view,u=o.getModel(),a=u.getBaseModel?u.getBaseModel():u,f=n+r,l=a.getCharCount(),c=this.comments.length,h=a.getLineStart(a.getLineAtOffset(n)),p=this._binarySearch(this.comments,h,!0),d=this._binarySearch(this.comments,f,!1,p-1,c),v;p<c&&this.comments[p].start<=h&&h<this.comments[p].end?(v=this.comments[p].start,v>n&&(v+=s)):p===c&&c>0&&l-s===this.comments[c-1].end?v=this.comments[c-1].start:v=h;var m;d<c?(m=this.comments[d].end,m>n&&(m+=s),d+=1):(d=c,m=l);var g=a.getText(v,m),y,b=this._findComments(g,v),w;for(w=p;w<this.comments.length;w++)y=this.comments[w],y.start>n&&(y.start+=s),y.start>n&&(y.end+=s);var E=d-p!==b.length;if(!E)for(w=0;w<b.length;w++){y=this.comments[p+w];var S=b[w];if(y.start!==S.start||y.end!==S.end||y.type!==S.type){E=!0;break}}var x=[p,d-p].concat(b);Array.prototype.splice.apply(this.comments,x);if(E){var T=v,N=m;u!==a&&(T=u.mapOffset(T,!0),N=u.mapOffset(N,!0)),o.redrawRange(T,N)}if(this.foldingEnabled&&a!==u&&this.annotationModel){var C=this.annotationModel,k=C.getAnnotations(v,m),L=[],A=[],O;while(k.hasNext()){O=k.next();if(O.type===e.AnnotationType.ANNOTATION_FOLDING){A.push(O);for(w=0;w<b.length;w++)if(O.start===b[w].start&&O.end===b[w].end)break;if(w===b.length)L.push(O),O.expand();else{var M=O.start,_=O.end;M>n&&(M-=s),_>n&&(_-=s);if(M<=n&&n<_&&M<=f&&f<_){var D=a.getLineAtOffset(O.start),P=a.getLineAtOffset(O.end);D!==P?O.expanded||(O.expand(),C.modifyAnnotation(O)):C.removeAnnotation(O)}}}}var H=[];for(w=0;w<b.length;w++){y=b[w];for(var B=0;B<A.length;B++)if(A[B].start===y.start&&A[B].end===y.end)break;B===A.length&&(O=this._createFoldingAnnotation(u,a,y.start,y.end),O&&H.push(O))}C.replaceAnnotations(L,H)}}},{TextStyler:U}}),define("orion/editor/textMateStyler",["orion/editor/regex"],function(e){function n(e,t,n){var r="",i=t.textView._parent,s=i.ownerDocument,o=t._stylesheet=t.util.createElement(s,"style");o.appendChild(s.createTextNode(t._styleSheet(e,r,t.util)));var u=s.getElementsByTagName("head")[0]||s.documentElement;u.appendChild(o),t.textView.update(!0)}function r(e,t){var n,r="JavaScript Editor",i=this;e.getPreferences("/settings",2).then(function(e){var s=e.get(r);if(s!==undefined){n=JSON.parse(e.get(r));if(!n)return;i._stylesheet&&(i._stylesheet.parentNode.removeChild(i._stylesheet),i._stylesheet=null),i._update(n,i,t)}})}function i(e,t){var n=[];for(var r=0;r<e.length;r++)n[e[r].element]=e[r].value;var i=[];i.push("");var s=n.fontFamily;return s==="sans serif"?s='"Menlo", "Consolas", "Vera Mono", "monospace"':s="monospace",i.push(t+" .textviewContainer {"),i.push("\background-color:"+n.background+";"),i.push("	font-family: "+s+";"),i.push("	font-size: "+n.fontSize+";"),i.push("	min-width: 50px;"),i.push("	min-height: 50px;"),i.push("	color: "+n.text+";"),i.push("}"),i.push(t+" {"),i.push("	font-family: "+s+";"),i.push("	font-size: "+n.fontSize+";"),i.push("	color: "+n.text+";"),i.push("}"),i.push(t+" .textview {"),i.push("	background-color: "+n.background+";"),i.push("}"),i.push(t+".ruler.annotations{"),i.push("	background-color: white;"),i.push("}"),i.push(t+" .ruler {"),i.push("	background-color: "+n.annotationRuler+";"),i.push("}"),i.push(t+" .rulerLines {"),i.push("	color: "+n.lineNumber+";"),i.push("	background-color: "+n.annotationRuler+";"),i.push("}"),i.push(t+" .rulerLines.even {"),i.push("	color: "+n.lineNumber+";"),i.push("	background-color: "+n.annotationRuler+";"),i.push("}"),i.push(t+" .rulerLines.odd {"),i.push("	color: "+n.lineNumber+";"),i.push("	background-color: "+n.annotationRuler+";"),i.push("}"),i.push(t+" .annotationLine.currentLine {"),i.push("	background-color: "+n.currentLine+";"),i.push("}"),i.push(t+" .entity-name-tag {"),i.push("color: "+n.keyword+";"),i.push("}"),i.join("\n")}function o(e){var t;if(e instanceof Array){t=new Array(e.length);for(var n=0;n<e.length;n++)t[n]=o(e[n])}else{t={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var i=e[r];typeof i=="object"&&i!==null?t[r]=o(i):t[r]=i}}return t}function u(e,t,s,u,a){this.initialize(e,u),this.grammar=o(t),this.externalGrammars=s?o(s):[],this._styles={},this._tree=null,this._allGrammars={},this.preprocess(this.grammar),this._updateStylesheet=r,this._update=n,this._styleSheet=i,this.util=a}var t,s={unsupported:[{regex:/\(\?[ims\-]:/,func:function(e){return"option on/off for subexp"}},{regex:/\(\?<([=!])/,func:function(e){return e[1]==="="?"lookbehind":"negative lookbehind"}},{regex:/\(\?>/,func:function(e){return"atomic group"}}],toRegExp:function(e){function t(e,t){throw new Error('Unsupported regex feature "'+e+'": "'+t[0]+'" at index: '+t.index+" in "+t.input)}function n(e){var t="",n=!1,r=e.length;for(var i=0;i<r;){var s=e.charAt(i);if(!n&&s==="#")while(i<r&&s!=="\r"&&s!=="\n")s=e.charAt(++i);else if(!n&&/\s/.test(s))while(i<r&&/\s/.test(s))s=e.charAt(++i);else s==="\\"?(t+=s,/\s/.test(e.charAt(i+1))||(t+=e.charAt(i+1),i+=1),i+=1):s==="["?(n=!0,t+=s,i+=1):s==="]"?(n=!1,t+=s,i+=1):(t+=s,i+=1)}return t}var r="",i;e=s.processGlobalFlag("x",e,function(e){return n(e)}),e=s.processGlobalFlag("i",e,function(e){return r+="i",e});for(i=0;i<this.unsupported.length;i++){var o;(o=this.unsupported[i].regex.exec(e))&&t(this.unsupported[i].func(o),o)}return new RegExp(e,r)},processGlobalFlag:function(e,t,n){function r(e,t){var n=0,r=e.length,i=-1;for(var s=t;s<r&&i===-1;s++)switch(e.charAt(s)){case"\\":s++;break;case"(":n++;break;case")":n--,n===0&&(i=s)}return i}var i="(?"+e+")",s="(?"+e+":";if(t.substring(0,i.length)===i)return n(t.substring(i.length));if(t.substring(0,s.length)===s){var o=r(t,0);if(o<t.length-1)throw new Error("Only a "+s+") group that encloses the entire regex is supported in: "+t);return n(t.substring(s.length,o))}return t},hasBackReference:function(e){return/\\\d+/.test(e.source)},getSubstitutedRegex:function(t,n,r){r=typeof r=="undefined"?!0:!1;var i=t.source.split(/(\\\d+)/g),s=[];for(var o=0;o<i.length;o++){var u=i[o],a=/\\(\d+)/.exec(u);if(a){var f=n[a[1]]||"";s.push(r?e.escape(f):f)}else s.push(u)}return new RegExp(s.join(""))},groupify:function(e,t){var n=1,r=2,i=3,s=4,o=e.source,u=o.length,a=[],f=0,l=[],c=1,h=1,p=[],d={},v={};for(var m=0;m<u;m++){var g=a[a.length-1],y=o.charAt(m);switch(y){case"(":g===s&&(a.pop(),p.push(")"),l[l.length-1].end=m);var b=m+2<u?o.charAt(m+1)+""+o.charAt(m+2):null;if(b==="?:"||b==="?="||b==="?!"){var w;b==="?:"?w=n:(w=i,f++),a.push(w),l.push({start:m,end:-1,type:w}),p.push(y),p.push(b),m+=b.length}else a.push(r),l.push({start:m,end:-1,type:r,oldNum:c,num:h}),p.push(y),f===0&&(v[h]=null),d[c]=h,c++,h++;break;case")":var E=a.pop();E===i&&f--,l[l.length-1].end=m,p.push(y);break;case"*":case"+":case"?":case"}":var S=y,x=o.charAt(m-1),T=m-1;if(y==="}"){for(var N=m-1;o.charAt(N)!=="{"&&N>=0;N--);x=o.charAt(N-1),T=N-1,S=o.substring(N,m+1)}var C=l[l.length-1];if(x===")"&&(C.type===r||C.type===s)){p.splice(C.start,0,"("),p.push(S),p.push(")");var k={start:C.start,end:p.length-1,type:s,num:C.num};for(var L=0;L<l.length;L++)E=l[L],(E.type===r||E.type===s)&&E.start>=C.start&&E.end<=T&&(E.start+=1,E.end+=1,E.num=E.num+1,E.type===r&&(d[E.oldNum]=E.num));l.push(k),h++;break};default:y!=="|"&&g!==r&&g!==s&&f===0&&(a.push(s),l.push({start:m,end:-1,type:s,num:h}),p.push("("),v[h]=null,h++),p.push(y);if(y==="\\"){var A=o.charAt(m+1);p.push(A),m+=1}}}while(a.length)a.pop(),p.push(")");var O=new RegExp(p.join("")),M={};t=t||d;for(var _ in t)t.hasOwnProperty(_)&&(M[_]="\\"+t[_]);return O=this.getSubstitutedRegex(O,M,!1),[O,d,v]},complexCaptures:function(e){if(!e)return!1;for(var t in e)if(e.hasOwnProperty(t)&&t!=="0")return!0;return!1}};return u.prototype={initialize:function(e,n,r){this.textView=e,this.textView.stylerOptions=this;var i=this;this.textView&&n&&n.startup().then(function(e){t=e.preferences,i.preferences=t,i._updateStylesheet(t,r),i.storageKey=t.listenForChangedSettings(i._listener.onStorage)}),this._listener={onModelChanged:function(e){i.onModelChanged(e)},onDestroy:function(e){i.onDestroy(e)},onLineStyle:function(e){i.onLineStyle(e)},onStorage:function(e){i.onStorage(e)}},e.addEventListener("ModelChanged",this._listener.onModelChanged),e.addEventListener("Destroy",this._listener.onDestroy),e.addEventListener("LineStyle",this._listener.onLineStyle),e.redrawLines()},onDestroy:function(e){this.destroy()},onStorage:function(e){e.key===this.storageKey&&this._updateStylesheet(this.preferences)},destroy:function(){this.textView&&(this.textView.removeEventListener("ModelChanged",this._listener.onModelChanged),this.textView.removeEventListener("Destroy",this._listener.onDestroy),this.textView.removeEventListener("LineStyle",this._listener.onLineStyle),this.textView=null),this.grammar=null,this._styles=null,this._tree=null,this._listener=null},preprocess:function(e){var t=[e];for(;t.length!==0;){var n=t.pop();if(n._resolvedRule&&n._typedRule)continue;n._resolvedRule=this._resolve(n),n._typedRule=this._createTypedRule(n),this.addStyles(n.name),this.addStyles(n.contentName),this.addStylesForCaptures(n.captures),this.addStylesForCaptures(n.beginCaptures),this.addStylesForCaptures(n.endCaptures),n._resolvedRule!==n&&t.push(n._resolvedRule);if(n.patterns)for(var r=0;r<n.patterns.length;r++)t.push(n.patterns[r])}},addStyles:function(e){if(e&&!this._styles[e]){this._styles[e]=[];var t=e.split(".");for(var n=0;n<t.length;n++)this._styles[e].push(t.slice(0,n+1).join("-"))}},addStylesForCaptures:function(e){for(var t in e)if(e.hasOwnProperty(t)){var n=e[t].name;this.addStyles(n)}},ContainerRule:function(){function e(e){this.rule=e,this.subrules=e.patterns}return e.prototype.valueOf=function(){return"aa"},e}(),BeginEndRule:function(){function e(e){this.rule=e,this.beginRegex=s.toRegExp(e.begin),this.endRegex=s.toRegExp(e.end),this.subrules=e.patterns||[],this.endRegexHasBackRef=s.hasBackReference(this.endRegex);var t=s.complexCaptures(e.captures),n=s.complexCaptures(e.beginCaptures)||s.complexCaptures(e.endCaptures);this.isComplex=t||n;if(this.isComplex){var r=s.groupify(this.beginRegex);this.beginRegex=r[0],this.beginOld2New=r[1],this.beginConsuming=r[2];var i=s.groupify(this.endRegex,this.beginOld2New);this.endRegex=i[0],this.endOld2New=i[1],this.endConsuming=i[2]}}return e.prototype.valueOf=function(){return this.beginRegex},e}(),MatchRule:function(){function e(e){this.rule=e,this.matchRegex=s.toRegExp(e.match),this.isComplex=s.complexCaptures(e.captures);if(this.isComplex){var t=s.groupify(this.matchRegex);this.matchRegex=t[0],this.matchOld2New=t[1],this.matchConsuming=t[2]}}return e.prototype.valueOf=function(){return this.matchRegex},e}(),_createTypedRule:function(e){return e.match?new this.MatchRule(e):e.begin?new this.BeginEndRule(e):new this.ContainerRule(e)},_resolve:function(e){var t=e;if(e.include){if(e.begin||e.end||e.match)throw new Error('Unexpected regex pattern in "include" rule '+e.include);var n=e.include;if(n.charAt(0)==="#"){t=this.grammar.repository&&this.grammar.repository[n.substring(1)];if(!t)throw new Error("Couldn't find included rule "+n+" in grammar repository")}else if(n==="$self")t=this.grammar;else{if(n==="$base")throw new Error('Include "$base" is not supported');t=this._allGrammars[n];if(!t)for(var r=0;r<this.externalGrammars.length;r++){var i=this.externalGrammars[r];if(i.scopeName===n){this.preprocess(i),this._allGrammars[n]=i,t=i;break}}}}return t},ContainerNode:function(){function e(e,t){this.parent=e,this.rule=t,this.children=[],this.start=null,this.end=null}return e.prototype.addChild=function(e){this.children.push(e)},e.prototype.valueOf=function(){var e=this.rule;return"ContainerNode { "+(e.include||"")+" "+(e.name||"")+(e.comment||"")+"}"},e}(),BeginEndNode:function(){function e(e,t,n){this.parent=e,this.rule=t,this.children=[],this.setStart(n),this.end=null,this.endMatch=null,t.endRegexHasBackRef?this.endRegexSubstituted=s.getSubstitutedRegex(t.endRegex,n):this.endRegexSubstituted=null}return e.prototype.addChild=function(e){this.children.push(e)},e.prototype.getIndexInParent=function(e){return this.parent?this.parent.children.indexOf(this):-1},e.prototype.setStart=function(e){this.start=e.index,this.beginMatch=e},e.prototype.setEnd=function(e){if(e&&typeof e=="object"){var t=e;this.endMatch=t,this.end=t.index+t[0].length}else{var n=e;this.endMatch=null,this.end=n}},e.prototype.shiftStart=function(e){this.start+=e,this.beginMatch.index+=e},e.prototype.shiftEnd=function(e){this.end+=e,this.endMatch&&(this.endMatch.index+=e)},e.prototype.valueOf=function(){return"{"+this.rule.beginRegex+" range="+this.start+".."+this.end+"}"},e}(),push:function(e,t){if(!t)return;for(var n=t.length;n>0;)e.push(t[--n])},exec:function(e,t,n){var r=e.exec(t);return r&&(r.index+=n),e.lastIndex=0,r},afterMatch:function(e){return e.index+e[0].length},getEndMatch:function(e,t,n){if(e instanceof this.BeginEndNode){var r=e.rule,i=e.endRegexSubstituted||r.endRegex;return i?this.exec(i,t,n):null}return null},initialParse:function(){var e=this.textView.getModel().getCharCount(),t=new this.ContainerNode(null,this.grammar._typedRule);this._tree=t,this.parse(this._tree,!1,0)},onModelChanged:function(e){var t=e.addedCharCount,n=e.addedLineCount,r=e.removedCharCount,i=e.removedLineCount,s=e.start;if(!this._tree)this.initialParse();else{var o=this.textView.getModel(),u=o.getCharCount(),a=o.getLineEnd(o.getLineAtOffset(s)-1),f=this.getFirstDamaged(a,a);a=a===-1?0:a;var l;f?l=this.parse(f,!0,a,s,t,r):l=u,this.textView.redrawRange(a,l)}},getFirstDamaged:function(e,t){if(e<0)return this._tree;var n=[this._tree],r=null;while(n.length){var i=n.pop();if(!i.parent||this.isDamaged(i,e,t)){i instanceof this.BeginEndNode&&(r=i);for(var s=0;s<i.children.length;s++)n.push(i.children[s])}}return r||this._tree},isDamaged:function(e,t,n){return e.start<=n&&e.end>t},parse:function(e,t,n,r,i,s){var o=this.textView.getModel(),u=o.getLineStart(o.getLineCount()-1),a=o.getCharCount(),f=this.getInitialExpected(e,n),l=-1;if(t){e.repaired=!0,e.endNeedsUpdate=!0;var c=e.children[e.children.length-1],h=i-s,p=c?o.getLineEnd(o.getLineAtOffset(c.end+h)):-1,d=o.getLineEnd(o.getLineAtOffset(r+s));l=Math.max(p,d)}l=l===-1?a:l;var v=f,m=e,g=!1,y=n,b=-1;while(m&&(!t||y<l)){var w=this.getNextMatch(o,m,y);w||(y=y>=u?a:o.getLineStart(o.getLineAtOffset(y)+1));var E=w&&w.match,S=w&&w.rule,x=w&&w.isSub,T=w&&w.isEnd;if(x){y=this.afterMatch(E);if(S instanceof this.BeginEndRule){g=!0;if(t&&S===v.rule&&m===v.parent){var N=v;N.setStart(E),N.repaired=!0,N.endNeedsUpdate=!0,m=N,v=this.getNextExpected(v,"begin")}else{t&&(this.prune(m,v),t=!1);var C=new this.BeginEndNode(m,S,E);m.addChild(C),m=C}}}else if(T||y===a)m instanceof this.BeginEndNode&&(E?(g=!0,b=Math.max(b,m.end),m.setEnd(E),y=this.afterMatch(E),t&&m===v&&m.parent===v.parent?(m.repaired=!0,delete m.endNeedsUpdate,v=this.getNextExpected(v,"end")):t&&(this.prune(m,v),t=!1)):(m.setEnd(a),delete m.endNeedsUpdate)),m=m.parent;t&&y>=l&&!g&&(this.prune(e,f),t=!1)}return this.removeUnrepairedChildren(e,t,n),this.cleanup(t,e,n,l,a,i,s),t?Math.max(b,y):y},removeUnrepairedChildren:function(e,t,n){if(t){var r=e.children,i=-1;for(var s=0;s<r.length;s++){var o=r[s];if(!o.repaired&&this.isDamaged(o,n,Number.MAX_VALUE)){i=s;break}}i!==-1&&(e.children.length=i)}},cleanup:function(e,t,n,r,i,s,o){var u,a,f;if(e){var l=s-o,c=this.getIntersecting(r-l+1,i);f=this.getIntersecting(n,r);for(u=0;u<c.length;u++)a=c[u],!a.repaired&&a instanceof this.BeginEndNode&&(a.shiftEnd(l),a.shiftStart(l));for(u=0;u<f.length;u++)a=f[u],a.repaired&&a.endNeedsUpdate&&a.shiftEnd(l),delete a.endNeedsUpdate,delete a.repaired}else{f=this.getIntersecting(n,r);for(u=0;u<f.length;u++)delete f[u].repaired}},getNextMatch:function(e,t,n,r){var i=e.getLineAtOffset(n),s=e.getLineEnd(i),o=e.getText(n,s),u=[],a=[],f=[],l=[];this.push(u,t.rule.subrules);while(u.length){var c=u.length?u.pop():null,h=c&&c._resolvedRule._typedRule;if(h instanceof this.ContainerRule&&a.indexOf(h)===-1){a.push(h),this.push(u,h.subrules);continue}if(h&&r&&!h.matchRegex)continue;var p=h&&this.exec(h.matchRegex||h.beginRegex,o,n);p&&(f.push(p),l.push(h))}var d=Number.MAX_VALUE,v=-1;for(var m=0;m<f.length;m++){var g=f[m];g.index<d&&(d=g.index,v=m)}if(!r){var y=t,b=this.getEndMatch(t,o,n);if(b){var w=y.rule.applyEndPatternLast,E=v===-1||b.index<d||!w&&b.index===d;if(E)return{isEnd:!0,rule:y.rule,match:b}}}return v===-1?null:{isSub:!0,rule:l[v],match:f[v]}},getInitialExpected:function(e,t){var n,r;if(e===this._tree)for(n=0;n<e.children.length;n++){r=e.children[n];if(r.start>=t)return r}else if(e instanceof this.BeginEndNode&&e.endMatch){var i=e.endMatch.index;for(n=0;n<e.children.length;n++){r=e.children[n];if(r.start>=t)break}if(r&&r.start<i)return r}return e},getNextExpected:function(e,t){var n=e;if(t==="begin"){var r=n.children[0];return r?r:n}if(t==="end"){var i=n.parent;if(i){var s=i.children[i.children.indexOf(n)+1];return s?s:i}}return null},prune:function(e,t){var n=t.parent===e;n?e.children.length=t.getIndexInParent():e instanceof this.BeginEndNode&&(e.endMatch=null,e.end=null),e.parent&&(e.parent.children.length=e.getIndexInParent()+1)},onLineStyle:function(e){function t(e,t){return e.start-t.start}this._tree||this.initialParse();var n=e.lineStart,r=this.textView.getModel(),i=r.getLineEnd(e.lineIndex),s=r.getLineEnd(r.getLineAtOffset(n)-1),o=this.getFirstDamaged(s,s),u=this.getLineScope(r,o,n,i);e.ranges=this.toStyleRanges(u),e.ranges.sort(t)},getLineScope:function(e,t,n,r){var i=n,s=this.getInitialExpected(t,n),o=[],u=[];while(t&&i<r){var a=this.getNextMatch(e,t,i);if(!a)break;var f=a&&a.match,l=a&&a.rule,c=a&&a.isSub,h=a&&a.isEnd;f.index!==i&&u.push({start:i,end:f.index,node:t}),c?(i=this.afterMatch(f),l instanceof this.BeginEndRule?(this.addBeginScope(o,f,l),t=s,s=this.getNextExpected(s,"begin")):this.addMatchScope(o,f,l)):h&&(i=this.afterMatch(f),this.addEndScope(o,f,l),s=this.getNextExpected(s,"end"),t=t.parent)}i<r&&u.push({start:i,end:r,node:t});var p=this.getInheritedLineScope(u,n,r);return o.concat(p)},getInheritedLineScope:function(e,t,n){var r=[];for(var i=0;i<e.length;i++){var s=e[i],o=s.node;while(o){var u=o.rule.rule,a=u.name,f=u.contentName,l=f||a;if(l){this.addScopeRange(r,s.start,s.end,l);break}o=o.parent}}return r},addBeginScope:function(e,t,n){var r=n.rule;this.addCapturesScope(e,t,r.beginCaptures||r.captures,n.isComplex,n.beginOld2New,n.beginConsuming)},addEndScope:function(e,t,n){var r=n.rule;this.addCapturesScope(e,t,r.endCaptures||r.captures,n.isComplex,n.endOld2New,n.endConsuming)},addMatchScope:function(e,t,n){var r=n.rule,i=r.name,s=r.captures;s?this.addCapturesScope(e,t,s,n.isComplex,n.matchOld2New,n.matchConsuming):this.addScope(e,t,i)},addScope:function(e,t,n){if(!n)return;e.push({start:t.index,end:this.afterMatch(t),scope:n})},addScopeRange:function(e,t,n,r){if(!r)return;e.push({start:t,end:n,scope:r})},addCapturesScope:function(e,t,n,r,i,s){if(!n)return;if(!r)this.addScope(e,t,n[0]&&n[0].name);else{var o={1:0},u=0;for(var a=1;t[a]!==undefined;a++)s[a]!==undefined&&(u+=t[a].length),t[a+1]!==undefined&&(o[a+1]=u);var f=t.index;for(var l=1;n[l];l++){var c=n[l].name,h=i[l],p=f+o[h];if(typeof t[h]!="undefined"){var d=p+t[h].length;this.addScopeRange(e,p,d,c)}}}},getIntersecting:function(e,t){var n=[],r=this._tree?[this._tree]:[];while(r.length){var i=r.pop(),s=!1;i instanceof this.ContainerNode?s=!0:this.isDamaged(i,e,t)&&(s=!0,n.push(i));if(s){var o=i.children.length;for(var u=0;u<o;u++)r.push(i.children[u])}}return n.reverse()},toStyleRanges:function(e){var t=[];for(var n=0;n<e.length;n++){var r=e[n],i=this._styles[r.scope];if(!i)throw new Error("styles not found for "+r.scope);var s=i.join(" ");t.push({start:r.start,end:r.end,style:{styleClass:s}})}return t}},{RegexUtil:s,TextMateStyler:u}}),define("orion/editor/AsyncStyler",["i18n!orion/editor/nls/messages","orion/editor/annotations"],function(e,t){function s(e){return e.getProperty("objectClass").indexOf(n)!==-1&&e.getProperty("type")==="highlighter"}function o(e,t,n){this.initialize(e,t,n),this.lineStyles=[]}var n="orion.edit.highlighter",r="orion.annotation.highlightError",i=n+" service must be an event emitter";return t.AnnotationType.registerType(r,{title:e.syntaxError,html:"<div class='annotationHTML error'></div>",rangeStyle:{styleClass:"annotationRange error"}}),o.prototype={initialize:function(e,t,r){this.textView=e,this.serviceRegistry=t,this.annotationModel=r,this.services=[];var i=this;this.listener={onModelChanging:function(e){i.onModelChanging(e)},onModelChanged:function(e){i.onModelChanged(e)},onDestroy:function(e){i.onDestroy(e)},onLineStyle:function(e){i.onLineStyle(e)},onStyleReady:function(e){i.onStyleReady(e)},onServiceAdded:function(e){i.onServiceAdded(e.serviceReference,i.serviceRegistry.getService(e.serviceReference))},onServiceRemoved:function(e){i.onServiceRemoved(e.serviceReference,i.serviceRegistry.getService(e.serviceReference))}},e.addEventListener("ModelChanging",this.listener.onModelChanging),e.addEventListener("ModelChanged",this.listener.onModelChanged),e.addEventListener("Destroy",this.listener.onDestroy),e.addEventListener("LineStyle",this.listener.onLineStyle),t.addEventListener("registered",this.listener.onServiceAdded),t.addEventListener("unregistering",this.listener.onServiceRemoved);var o=t.getServiceReferences(n);for(var u=0;u<o.length;u++){var a=o[u];s(a)&&this.addServiceListener(t.getService(a))}},onDestroy:function(e){this.destroy()},destroy:function(){this.textView&&(this.textView.removeEventListener("ModelChanging",this.listener.onModelChanging),this.textView.removeEventListener("ModelChanged",this.listener.onModelChanged),this.textView.removeEventListener("Destroy",this.listener.onDestroy),this.textView.removeEventListener("LineStyle",this.listener.onLineStyle),this.textView=null);if(this.services){for(var e=0;e<this.services.length;e++)this.removeServiceListener(this.services[e]);this.services=null}this.serviceRegistry&&(this.serviceRegistry.removeEventListener("registered",this.listener.onServiceAdded),this.serviceRegistry.removeEventListener("unregistering",this.listener.onServiceRemoved),this.serviceRegistry=null),this.listener=null,this.lineStyles=null},onModelChanging:function(e){this.startLine=this.textView.getModel().getLineAtOffset(e.start)},onModelChanged:function(e){var t=this.startLine;(e.addedLineCount||e.removedLineCount)&&Array.prototype.splice.apply(this.lineStyles,[t,e.removedLineCount].concat(this._getEmptyStyle(e.addedLineCount)))},onStyleReady:function(e){var n=e.lineStyles||e.style,i=Number.MAX_VALUE,s=-1,o=this.textView.getModel();for(var u in n)n.hasOwnProperty(u)&&(this.lineStyles[u]=n[u],i=Math.min(i,u),s=Math.max(s,u));i=Math.max(i,0),s=Math.min(s,o.getLineCount());var a=this.annotationModel;if(a){var f=a.getAnnotations(o.getLineStart(i),o.getLineEnd(s)),l=[];while(f.hasNext()){var c=f.next();c.type===r&&l.push(c)}var h=[];for(var p=i;p<=s;p++){u=p;var d=this.lineStyles[u],v=d&&d.errors,m=o.getLineStart(u);if(v)for(var g=0;g<v.length;g++){var y=v[g];h.push(t.AnnotationType.createAnnotation(r,y.start+m,y.end+m))}}a.replaceAnnotations(l,h)}this.textView.redrawLines(i,s+1)},onLineStyle:function(e){function t(e,t){var n=e.length,r=[];for(var i=0;i<n;i++){var s=e[i];r.push({start:s.start+t,end:s.end+t,style:s.style})}return r}var n=this.lineStyles[e.lineIndex];n&&(n.ranges?e.ranges=t(n.ranges,e.lineStart):n.style&&(e.style=n.style))},_getEmptyStyle:function(e){var t=[];for(var n=0;n<e;n++)t.push(null);return t},setContentType:function(e){this.contentType=e;if(this.services)for(var t=0;t<this.services.length;t++){var n=this.services[t];if(n.setContentType){var r=this.serviceRegistry.getService("orion.page.progress");r?r.progress(n.setContentType(this.contentType),"Styling content type: "+this.contentType.id?this.contentType.id:this.contentType):n.setContentType(this.contentType)}}},onServiceAdded:function(e,t){s(e)&&this.addServiceListener(t)},onServiceRemoved:function(e,t){this.services.indexOf(t)!==-1&&this.removeServiceListener(t)},addServiceListener:function(e){if(typeof e.addEventListener=="function"){e.addEventListener("orion.edit.highlighter.styleReady",this.listener.onStyleReady),this.services.push(e);if(e.setContentType&&this.contentType){var t=this.serviceRegistry.getService("orion.page.progress");t?t.progress(e.setContentType(this.contentType),"Styling content type: "+this.contentType.id?this.contentType.id:this.contentType):e.setContentType(this.contentType)}}else typeof console!="undefined"&&console.log(new Error(i))},removeServiceListener:function(e){if(typeof e.removeEventListener=="function"){e.removeEventListener("orion.edit.highlighter.styleReady",this.listener.onStyleReady);var t=this.services.indexOf(e);t!==-1&&this.services.splice(t,1)}else typeof console!="undefined"&&console.log(new Error(i))}},o}),define("orion/xhr",["orion/Deferred"],function(e){function t(e,t,n,r){var i=typeof n.response!="undefined"?n.response:n.responseText,s=typeof i=="string"?i:null,o;try{o=n.status}catch(u){o=0}var a={args:t,response:i,responseText:s,status:o,url:e,xhr:n};return typeof r!="undefined"&&(a.error=r),a}function n(n,r,i){i=i||{};var s=arguments.length>3&&arguments[3]?arguments[3]:new XMLHttpRequest,o=new e,u=i.headers||{},a=i.log||!1,f;typeof u["X-Requested-With"]=="undefined"&&(u["X-Requested-With"]="XMLHttpRequest"),typeof i.data!="undefined"&&(n==="POST"||n==="PUT")&&(f=i.data),typeof i.responseType=="string"&&(s.responseType=i.responseType),s.onprogress=function(e){e.xhr=s,o.progress(e)},s.onreadystatechange=function(){if(s.readyState===4){var e=t(r,i,s),n=s.status;200<=n&&n<400?o.resolve(e):(a&&typeof console!="undefined"&&console.log(new Error(s.statusText)),o.reject(e))}};try{s.open(n,r,!0);if(typeof i.timeout=="number")if(typeof s.timeout=="number")s.timeout=i.timeout,s.addEventListener("timeout",function(e){o.reject(t(r,i,s,"Timeout exceeded"))});else{var l=setTimeout(function(){o.reject(t(r,i,s,"Timeout exceeded"))},i.timeout);o.then(clearTimeout.bind(null,l),clearTimeout.bind(null,l))}Object.keys(u).forEach(function(e){s.setRequestHeader(e,u[e])}),s.send(f)}catch(c){o.reject(t(r,i,s,c))}return o.promise}return n}),define("orion/preferences",["require","orion/Deferred","orion/xhr"],function(e,t,n){function r(e,t){this._name=e,this._providers=t,this._flushPending=!1,this._cached=null,this._stores=[],this._dirty=[]}function i(e,t){return{get:function(n,r){if(t===0)return null;var i=localStorage.getItem(e+n);if(i===null)return null;var s=JSON.parse(i);return r||t===-1||s._expires&&s._expires>(new Date).getTime()?(delete s._expires,s):null},set:function(n,r){if(t===0)return;t!==-1&&(r._expires=(new Date).getTime()+1e3*t);if(Object.keys(r).length===0)localStorage.removeItem(e+n);else{var i=JSON.stringify(r);localStorage.setItem(e+n,i),delete r._expires}},remove:function(t){localStorage.removeItem(e+t)}}}function s(e){this._currentPromises={},this._cache=new i("/orion/preferences/user",3600),this._service=null,this.available=function(){if(!this._service){var t=e.getServiceReferences("orion.core.preference.provider");t.length>0&&(this._service=e.getService(t[0]))}return!!this._service}}function o(e){this._location=e,this._currentPromise=null,this._cache=new i("/orion/preferences/default",3600)}function u(){this._cache=new i("/orion/preferences/local",-1)}function a(t,n){this._userProvider=new s(t),this._localProvider=new u,n=n||"defaults.pref",n.indexOf("://")===-1&&(n=e.toUrl(n)),this._defaultsProvider=new o(n),this._serviceRegistration=t.registerService("orion.core.preference",this)}return r.prototype={_flush:function(){var e=[];for(var n=0;n<this._stores.length;++n){var r=this._stores[n];this._dirty.indexOf(r)!==-1&&e.push(this._providers[n].put(this._name,r))}return this._dirty=[],t.all(e)},_scheduleFlush:function(e){this._dirty.indexOf(e)===-1&&this._dirty.push(e);if(this._flushPending)return;this._flushPending=!0,window.setTimeout(function(){this._flushPending&&(this._flushPending=!1,this._flush())}.bind(this),0)},_getCached:function(){if(!this._cached){this._cached={};for(var e=0;e<this._stores.length;++e){var t=this._stores[e];for(var n in t)t.hasOwnProperty(n)&&typeof this._cached[n]=="undefined"&&(this._cached[n]=t[n])}}return this._cached},keys:function(){return Object.keys(this._getCached())},get:function(e){var t=this._getCached();return t[e]},put:function(e,t){if(this._stores.length===0)return;var n=this._stores[0];n[e]!==t&&(n[e]=t,this._cached=null,this._scheduleFlush(n))},remove:function(e){for(var t=0;t<this._stores.length;++t){var n=this._stores[t];if(n.hasOwnProperty(e))return delete n[e],this._cached=null,this._scheduleFlush(n),!0}return!1},clear:function(){for(var e=0;e<this._stores.length;++e)this._stores[e]={},this._scheduleFlush(this._stores[e]);this._cached=null},sync:function(e){if(this._flushPending)return this._flushPending=!1,this._flush();var n=this,r=[];for(var i=0;i<this._providers.length;++i)r.push(this._providers[i].get(this._name,e).then(function(e){return function(t){n._stores[e]=t}}(i)));return t.all(r).then(function(){n._cached=null,n._getCached()})},flush:function(){this._flush()}},s.prototype={get:function(e,n){if(this._currentPromises[e])return this._currentPromises[e];var r=new t,i=null;n?this._cache.remove(e):i=this._cache.get(e);if(i!==null)r.resolve(i);else{this._currentPromises[e]=r;var s=this;this._service.get(e).then(function(t){s._cache.set(e,t),delete s._currentPromises[e],r.resolve(t)},function(t){if(t.status===404){var n={};s._cache.set(e,n),delete s._currentPromises[e],r.resolve(n)}else delete s._currentPromises[e],r.resolve(s._cache.get(e,!0)||{})})}return r},put:function(e,t){return this._cache.set(e,t),this._service.put(e,t)}},o.prototype={get:function(e,r){if(this._currentPromise)return this._currentPromise;var i=new t,s=null;r?this._cache.remove(e):s=this._cache.get(e);if(s!==null)i.resolve(s);else{this._currentPromise=i;var o=this;n("GET",this._location,{headers:{"Orion-Version":"1"},timeout:15e3}).then(function(t){var n=JSON.parse(t.response);o._cache.set(e,n[e]||{}),o._currentPromise=null,i.resolve(n[e]||{})},function(t){if(t.xhr.status===401||t.xhr.status===404)o._cache.set(e,{}),o._currentPromise=null,i.resolve({});else{o._currentPromise=null;var n=o._cache.get(e,!0);n!==null?i.resolve(n[e]||{}):i.resolve({})}})}return i},put:function(e,n){var r=new t;return r.resolve(),r}},u.prototype={get:function(e){var n=new t,r=this._cache.get(e);return r!==null?n.resolve(r):n.resolve({}),n},put:function(e,n){var r=new t;return this._cache.set(e,n),r.resolve(),r}},a.DEFAULT_SCOPE=1,a.LOCAL_SCOPE=2,a.USER_SCOPE=4,a.prototype={listenForChangedSettings:function(e){return window.addEventListener("storage",e,!1),"/orion/preferences/local/settings"},getPreferences:function(e,t){if(!t||typeof t!="number"||t>7||t<1)t=a.DEFAULT_SCOPE|a.LOCAL_SCOPE|a.USER_SCOPE;var n=[];a.USER_SCOPE&t&&this._userProvider.available()&&n.push(this._userProvider),a.LOCAL_SCOPE&t&&n.push(this._localProvider),a.DEFAULT_SCOPE&t&&n.push(this._defaultsProvider);var i=new r(e,n),s=i.sync().then(function(){return i});return s},getSetting:function(e,t,n){var r;for(var i=0;i<e.length;i++)if(e[i].label===t)for(var s=0;s<e[i].data.length;s++)if(e[i].data[s].label===n){r=e[i].data[s].value;break}return r}},{PreferencesService:a}}),define("orion/pluginregistry",["orion/Deferred","orion/EventTarget"],function(e,t){function n(e,t){var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;n.sort(),r.sort();for(var i=0,s=n.length;i<s;i++){var o=n[i];if(o!==r[i])return!1;var u=e[o],a=t[o];if(u===a)continue;if(JSON.stringify(u)!==JSON.stringify(a))return!1}return!0}function i(e){if(e.indexOf("://")===-1){var t=document.createElement("a");return t.href=e,t.href}return e}function s(e){function n(){return t=t||Object.keys(e)}var t=null;return{key:function(e){return n()[e]},getItem:function(t){return e[t]},setItem:function(n,r){e[n]=r,t=null},removeItem:function(n){delete e[n],t=null},clear:function(){n().forEach(function(t){delete e[t]}.bind(this)),t=null}}}function o(e,t){return{type:e,plugin:t}}function u(r,i,s){function w(t,n,r){if(!m)return(new e).reject(new Error("plugin not connected"));var i=y++,o=new e;o.then(null,function(e){p==="active"&&e instanceof Error&&e.name==="Cancel"&&s.postMessage({id:i,cancel:e.message||"Cancel"},m)}),b[String(i)]=o;var u={id:i,serviceId:t,method:n,params:r};return s.postMessage(u,m),o.promise}function E(e){var n={};if(e.methods){e.methods.forEach(function(t){n[t]=function(){var n=Array.prototype.slice.call(arguments);return p==="active"?w(e.serviceId,t,n):u.start({"transient":!0}).then(function(){return w(e.serviceId,t,n)})}});if(n.addEventListener&&n.removeEventListener){var r=new t;n.dispatchEvent=r.dispatchEvent.bind(r);var i=n.addEventListener;n.addEventListener=function(e,t){r._namedListeners[e]||i(e),r.addEventListener(e,t)};var s=n.removeEventListener;n.removeEventListener=function(e,t){r.removeEventListener(e,t),r._namedListeners[e]&&s(e)}}}return n}function S(e){var t=JSON.parse(JSON.stringify(e.properties));t.__plugin__=r;var n=e.names||e.type||[];return Array.isArray(n)||(n=[n]),t.objectClass=n,t}function x(e){var t=E(e),n=S(e),r=s.registerService(e.names||e.type,t,n);g[e.serviceId]={registration:r,proxy:t}}function T(){s.persist(r,{created:a,headers:f,services:l,autostart:c,lastModified:h})}function C(e){var t;try{if(e.method)if("manifest"===e.method||"plugin"===e.method){var n=e.params[0];N({headers:n.headers,services:n.services}).then(function(){v.resolve(u)})}else if("dispatchEvent"===e.method){var r=g[e.serviceId].proxy;r.dispatchEvent.apply(r,e.params)}else if("progress"===e.method)t=b[String(e.requestId)],t.progress.apply(t,e.params);else{if("timeout"!==e.method)throw new Error("Bad response method: "+e.method);v&&v.reject(e.error)}else{t=b[String(e.id)],delete b[String(e.id)];if(e.error){var i=s.handleServiceError(u,e.error);t.reject(i)}else t.resolve(e.result)}}catch(o){console.log("Plugin._responseHandler "+o)}}var u=this;i=i||{};var a=i.created||(new Date).getTime(),f=i.headers||{},l=i.services||[],c=i.autostart,h=i.lastModified||0,p="installed",d,v,m,g={},y=0,b={},N;this._persist=T,this._resolve=function(){p="resolved",s.dispatchEvent(new o("resolved",u))},this._getAutostart=function(){return c},this._getCreated=function(){return a},this.getLocation=function(){return r},this.getHeaders=function(){return JSON.parse(JSON.stringify(f))},this.getName=function(){var e=this.getHeaders();return e?e.name||"":null},this.getVersion=function(){var e=this.getHeaders();return e?e.version||"0.0.0":null},this.getLastModified=function(){return h},this.getServiceReferences=function(){var e=[];return Object.keys(g).forEach(function(t){e.push(g[t].registration.getReference())}),e},this.getState=function(){return p},this.start=function(t){if(p==="uninstalled")return(new e).reject(new Error("Plugin is uninstalled"));if(d)return d.promise.then(this.start.bind(this,t));if(p==="active")return(new e).resolve();if(!t||!t["transient"]){var n=t&&t.lazy?"lazy":"started";n!==c&&(c=n,T())}var i=s.getState();if(i!=="starting"&&i!=="active")return t["transient"]?(new e).reject(new Error("start transient error")):(new e).resolve();if(p==="installed")try{this._resolve()}catch(a){return(new e).reject(a)}p==="resolved"&&l.forEach(function(e){x(e)});if(t&&t.lazy)return p!=="starting"&&(p="starting",s.dispatchEvent(new o("lazy activation",u))),(new e).resolve();var f=new e;return d=f,p="starting",s.dispatchEvent(new o("starting",u)),v=new e,m=s.connect(r,C),v.then(function(){v=null,p="active",s.dispatchEvent(new o("started",u)),d=null,f.resolve()},function(){v=null,p="stopping",s.dispatchEvent(new o("stopping",u)),Object.keys(g).forEach(function(e){g[e].registration.unregister(),delete g[e]}),s.disconnect(m),m=null,p="resolved",d=null,s.dispatchEvent(new o("stopped",u)),f.reject(new Error("plugin activation error"))}),f.promise},this.stop=function(t){if(p==="uninstalled")return(new e).reject(new Error("Plugin is uninstalled"));if(d)return d.promise.then(this.stop.bind(this,t));(!t||!t["transient"])&&"stopped"!==c&&(c="stopped",T());if(p!=="active"&&p!=="starting")return(new e).resolve();var n=new e;return d=n,p="stopping",s.dispatchEvent(new o("stopping",u)),Object.keys(g).forEach(function(e){g[e].registration.unregister(),delete g[e]}),m&&(s.disconnect(m),m=null),p="resolved",d=null,s.dispatchEvent(new o("stopped",u)),n.resolve(),n.promise},N=function(t){if(p==="uninstalled")return(new e).reject(new Error("Plugin is uninstalled"));if(!t)return h===0&&(h=(new Date).getTime(),T()),s.loadManifest(r).then(N);var i=f,a=l,d=c;f=t.headers||{},l=t.services||{},c=t.autostart||c,t.lastModified?h=t.lastModified:(h=(new Date).getTime(),T());if(n(f,i)&&n(l,a)&&c===d)return(new e).resolve();if(p==="active"||p==="starting"){var y=[];Object.keys(l).forEach(function(e){var t=l[e];y.push(e);var r=g[e];if(r){if(n(t.methods,Object.keys(r.proxy))){var i=S(t),s=r.registration.getReference(),o={};s.getPropertyKeys().forEach(function(e){o[e]=s.getProperty(e)}),n(i,o)||r.registration.setProperties(i);return}r.registration.unregister(),delete g[e]}x(t)}),Object.keys(g).forEach(function(e){y.indexOf(e)===-1&&(g[e].registration.unregister(),delete g[e])})}return p==="active"&&(s.disconnect(m),v=new e,m=s.connect(r,C),v.then(function(){v=null},function(){v=null,p="stopping",s.dispatchEvent(new o("stopping"),u),Object.keys(g).forEach(function(e){g[e].registration.unregister(),delete g[e]}),s.disconnect(m),m=null,p="resolved",s.dispatchEvent(new o("stopped",u))})),(new e).resolve()},this.update=function(e){return N(e).then(function(){s.dispatchEvent(new o("updated",u))})},this.uninstall=function(){return p==="uninstalled"?(new e).reject(new Error("Plugin is uninstalled")):p==="active"||p==="starting"||p==="stopping"?this.stop().then(this.uninstall.bind(this),this.uninstall.bind(this)):(s.removePlugin(this),p="uninstalled",s.dispatchEvent(new o("uninstalled",u)),(new e).resolve())}}function a(n,a){function m(e){var t=e.source;h.some(function(n){if(t===n.target)return typeof n.useStructuredClone=="undefined"&&(n.useStructuredClone=typeof e.data!="string"),n.handler(n.useStructuredClone?e.data:JSON.parse(e.data)),!0})}a=a||{};var f=a.storage||localStorage;f.getItem||(f=s(f));var l="installed",c=[],h=[],p=new t,d={},v={registerService:n.registerService.bind(n),connect:function(e,t,n){function i(e){var n=new Error(e);n.name="timeout",t({method:"timeout",error:n})}var r={handler:t,url:e},s=setTimeout(i.bind(null,"Load timeout for: "+e),n||15e3),o=document.createElement("iframe");return o.name=e+"_"+(new Date).getTime(),a.visible||(o.style.display="none",o.style.visibility="hidden"),o.src=e,o.onload=function(){clearTimeout(s),setTimeout(i.bind(null,"Plugin handshake timeout for: "+e),5e3)},o.sandbox="allow-scripts allow-same-origin",document.body.appendChild(o),r.target=o.contentWindow,r.close=function(){o&&(document.body.removeChild(o),o=null)},h.push(r),r},disconnect:function(e){for(var t=0;t<h.length;t++)if(e===h[t]){h.splice(t,1);try{e.close()}catch(n){}break}},removePlugin:function(e){for(var t=0;t<c.length;t++)if(e===c[t]){c.splice(t,1);break}f.removeItem("plugin."+e.getLocation())},persist:function(e,t){f.setItem("plugin."+e,JSON.stringify(t))},postMessage:function(e,t){t.target.postMessage(t.useStructuredClone?e:JSON.stringify(e),t.url)},dispatchEvent:function(e){try{p.dispatchEvent(e)}catch(t){console&&console.log("PluginRegistry.dispatchEvent "+t)}},loadManifest:function(t){var n=new e,r=v.connect(t,function(e){if(!r||!e.method)return;if("manifest"===e.method||"plugin"===e.method){var t=e.params[0];v.disconnect(r),r=null,n.resolve(t)}else"timeout"===e.method&&(v.disconnect(r),r=null,n.reject(e.error))});return n.promise},getState:function(){return l},handleServiceError:function(e,t){if(t&&t.status===401){var n=e.getHeaders(),i=e.getName()||e.getLocation(),s=document.createElement("span");s.appendChild(document.createTextNode("Authentication required for: "+i+"."));if(n.login){s.appendChild(document.createTextNode(" "));var o=document.createElement("a");o.target="_blank",o.textContent="Login",o.href=n.login,r.test(o.href)?(s.appendChild(o),s.appendChild(document.createTextNode(" and re-try the request."))):console.log("Illegal Login URL: "+n.login)}var u=new XMLSerializer;return{Severity:"Error",HTML:!0,Message:u.serializeToString(s)}}if(t.__isError){var a=t;t=new Error(a.message),Object.keys(a).forEach(function(e){t[e]=a[e]}),delete t.__isError}return t}};this.getLocation=function(){return"System"},this.getHeaders=function(){return{}},this.getName=function(){return"System"},this.getVersion=function(){return"0.0.0"},this.getLastModified=function(){return 0},this.getState=v.getState,this.init=function(){if(l==="starting"||l==="active"||l==="stopping")return;addEventListener("message",m,!1);var e=[];for(var t=0,n=f.length;t<n;t++)e.push(f.key(t));e.forEach(function(e){if(e.indexOf("plugin.")===0){var t=e.substring("plugin.".length),n=JSON.parse(f.getItem(e));n.created&&c.push(new u(t,n,v))}}),c.sort(function(e,t){return e._getCreated()<t._getCreated()?-1:1}),a.plugins&&Object.keys(a.plugins).forEach(function(e){e=i(e);var t=this.getPlugin(e);if(!t){var n=a.plugins[e];n=typeof n=="object"||{},n.autostart=n.autostart||a.defaultAutostart||"lazy",c.push(new u(e,n,v))}}.bind(this)),l="starting"},this.start=function(){l!=="starting"&&this.init();if(l!=="starting")return(new e).reject("Cannot start framework. Framework is already "+l+".");var t=[],n=(new Date).getTime();return c.forEach(function(e){var r=e._getAutostart();if(e.getLastModified()===0){t.push(e.update().then(function(){if("started"===r)return e.start({"transient":!0});if("lazy"===r)return e.start({lazy:!0,"transient":!0});e._resolve()}));return}"started"===r?t.push(e.start({"transient":!0})):"lazy"===r?(t.push(e.start({lazy:!0,"transient":!0})),n>e.getLastModified()+864e5&&e.update()):e._resolve()}),e.all(t,function(e){console.log("PluginRegistry.stop "+e)}).then(function(){l="active"})},this.stop=function(){if(l!=="starting"&&l!=="active")return(new e).reject("Cannot stop registry. Registry is already "+l+".");l="stopping";var t=[];return c.forEach(function(e){t.push(e.stop({"transient":!0}))}),e.all(t,function(e){console.log("PluginRegistry.stop "+e)}).then(function(){removeEventListener("message",m),l="resolved"})},this.update=function(){this.stop().then(this.start.bind(this))},this.uninstall=function(){return(new e).reject("Cannot uninstall registry")},this.installPlugin=function(t,n){t=i(t);var r=this.getPlugin(t);if(r)return(new e).resolve(r);if(d[t])return d[t];if(n)return r=new u(t,n,v),c.push(r),r._persist(),v.dispatchEvent(new o("installed",r)),(new e).resolve(r);var s=v.loadManifest(t).then(function(e){return r=new u(t,e,v),c.push(r),r._persist(),delete d[t],v.dispatchEvent(new o("installed",r)),r},function(e){throw delete d[t],e});return d[t]=s,s},this.getPlugins=function(){return c.slice()},this.getPlugin=function(e){var t=null;return e=i(e),c.some(function(n){if(e===n.getLocation())return t=n,!0}),t},this.addEventListener=p.addEventListener.bind(p),this.removeEventListener=p.removeEventListener.bind(p),this.resolvePlugins=function(){var e=!0;return c.forEach(function(t){e=e&&t._resolve()}),e}}var r=new RegExp("^http[s]?","i");return{Plugin:u,PluginRegistry:a}}),define("orion/serviceTracker",[],function(){function n(n,r){function f(e){var t=e.getProperty("service.id"),n=this.addingService(e);n&&(i[t]=e,s[t]=n)}function l(e){var t=e.getProperty("service.id"),n=s[t];delete i[t],delete s[t],this.removedService(e,n)}function c(e){return e.getProperty("objectClass").indexOf(r)!==-1}this.serviceRegistry=n;var i={},s={},o=e,u,a;this.close=function(){if(o!==t)throw"Already closed";o=e,n.removeEventListener("registered",u),n.removeEventListener("unregistering",a),u=null,a=null;var r=this;this.getServiceReferences().forEach(function(e){l.call(r,e)}),typeof this.onClose=="function"&&this.onClose()},this.getServiceReferences=function(){return i.length?Object.keys(i).map(function(e){return i[e]}):null},this.open=function(){if(o!==e)throw"Already open";o=t;var i=this;u=function(e){if(c(e.serviceReference)){f.call(i,e.serviceReference);if(typeof i.onServiceAdded=="function")return i.onServiceAdded(e.serviceReference,i.serviceRegistry.getService(e.serviceReference))}},a=function(e){c(e.serviceReference)&&l.call(i,e.serviceReference)},n.addEventListener("registered",u),n.addEventListener("unregistering",a),n.getServiceReferences(r).forEach(function(e){f.call(i,e)}),typeof this.onOpen=="function"&&this.onOpen()}}var e=0,t=1;return n.prototype={addingService:function(e){return this.serviceRegistry.getService(e)},onOpen:null,onClose:null,onServiceAdded:null,removedService:function(e,t){}},n}),define("orion/config",["orion/Deferred","orion/serviceTracker"],function(e,t){var n,r,i,s,o,u="pid",a="orion.cm.managedservice";n=function(n,r,i){function l(e,t,n){s[e]||(s[e]=[]),o[e]||(o[e]=[]),s[e].push(t),o[e].push(n)}function c(e,t,n){var r=s[e],i=o[e];r.length>1?r.splice(r.indexOf(t),1):delete s[e],i.length>1?i.splice(i.indexOf(n),1):delete o[e]}function h(e){return s[e]||[]}function p(e){return o[e]||[]}function d(e,t,n){t.forEach(function(i,s){try{var o=e[s].getProperty("__plugin__"),u=o&&r.getPlugin(o);(!o||u&&u.getState()==="active")&&t[s].updated(n)}catch(a){typeof console!="undefined"&&console.log(a)}})}t.call(this,n,a);var s={},o={},f=function(t){var r=[];return t.plugin.getServiceReferences().forEach(function(e){if(e.getProperty("objectClass").indexOf(a)!==-1){var t=e.getProperty(u),s=n.getService(e);if(t&&s){var o=i._find(t),f=o&&o.getProperties();r.push(s.updated(f))}}}),e.all(r)};this.addingService=function(e){var t=e.getProperty(u),r=n.getService(e);return!t||!r?null:(l(t,e,r),r)},this.onServiceAdded=function(e,t){var n=e.getProperty(u),r=i._find(n);d([e],[t],r&&r.getProperties())},this.onOpen=function(){r.addEventListener("started",f)},this.onClose=function(){r.removeEventListener("started",f)},this.notifyUpdated=function(e){var t=e.getPid();d(h(t),p(t),e.getProperties())},this.notifyDeleted=function(e){var t=e.getPid();d(h(t),p(t),null)},this.removedService=function(e,t){var n=e.getProperty(u);c(n,e,t)}},r=function(){function e(e,t,r){this.store=new i(this,r),this.configAdmin=new s(this,this.store),this.tracker=new n(e,t,this.store)}return e.prototype={getConfigurationAdmin:function(){var e=this;return this.configAdmin._init().then(function(t){return e.tracker.open(),t})},notifyDeleted:function(e){this.tracker.notifyDeleted(e)},notifyUpdated:function(e){this.tracker.notifyUpdated(e)}},e}(),s=function(){function e(e,t){this.factory=e,this.store=t}return e.prototype={_init:function(){var e=this;return this.store._init().then(function(){return e})},getConfiguration:function(e){return this.store.get(e)},listConfigurations:function(){return this.store.list()}},e}();var f="/cm/configurations";return i=function(){function e(e,t){this.factory=e,this.prefsService=t,this.configs=Object.create(null),this.pref=null;var n=this;this.initPromise=this.prefsService.getPreferences(f).then(function(e){n.pref=e,e.keys().forEach(function(t){if(!n.configs[t]){var r=e.get(t);typeof r=="object"&&r!==null&&Object.keys(r).length>0&&(r[u]=t,n.configs[t]=new o(n.factory,n,r))}})})}return e.prototype={_init:function(){return this.initPromise},_find:function(e){return this.configs[e]||null},get:function(e){var t=this._find(e);return t||(t=new o(this.factory,this,e),this.configs[e]=t),t},list:function(){var e=this,t=[];return this.pref.keys().forEach(function(n){var r=e._find(n);r&&r.getProperties()!==null&&t.push(r)}),t},remove:function(e){this.pref.remove(e),delete this.configs[e]},save:function(e,t){this.pref.put(e,t.getProperties(!0)||{})}},e}(),o=function(){function e(e){var t={},n=Object.keys(e);for(var r=0;r<n.length;r++){var i=n[r],s=e[i];t[i]=s instanceof Array?s.slice():s}return t}function t(t,n){n=e(n),delete n[u],t.properties=n}function n(e,n,r){this.factory=e,this.store=n;if(r!==null&&typeof r=="object")this.pid=r[u],t(this,r);else{if(typeof r!="string")throw new Error("Invalid pid/properties "+r);this.pid=r,this.properties=null}}return n.prototype={_checkRemoved:function(){if(this._removed)throw new Error("Configuration was removed")},getPid:function(){return this._checkRemoved(),this.pid},getProperties:function(t){this._checkRemoved();var n=null;return this.properties&&(n=e(this.properties),t||(n[u]=this.pid)),n},remove:function(){this._checkRemoved(),this.factory.notifyDeleted(this),this.store.remove(this.pid),this._removed=!0},update:function(e){this._checkRemoved(),t(this,e),this.store.save(this.pid,this),this.factory.notifyUpdated(this)},toString:function(){return"[ConfigImpl pid: "+this.pid+", properties: "+JSON.stringify(this.properties)+"]"}},n}(),{ConfigurationAdminFactory:r}}),define("orion/bootstrap",["require","orion/Deferred","orion/serviceregistry","orion/preferences","orion/pluginregistry","orion/config"],function(e,t,n,r,i,s){function u(){if(o)return o;o=new t;var u=window.serviceRegistry=new n.ServiceRegistry,a=new r.PreferencesService(u);return a.getPreferences("/plugins").then(function(n){var r={plugins:{}};n.keys().forEach(function(t){var i=e.toUrl(t);r.plugins[i]=n[t]});var f=window.pluginRegistry=new i.PluginRegistry(u,r);return f.start().then(function(){if(u.getServiceReferences("orion.core.preference.provider").length>0)return a.getPreferences("/plugins",a.USER_SCOPE).then(function(n){var r=[];return n.keys().forEach(function(t){var n=e.toUrl(t);f.getPlugin(n)||r.push(f.installPlugin(n,{autostart:"lazy"}).then(function(e){return e.update().then(function(){return e.start({lazy:!0})})}))}),t.all(r,function(e){console.log(e)})})}).then(function(){return(new s.ConfigurationAdminFactory(u,f,a)).getConfigurationAdmin().then(u.registerService.bind(u,"orion.cm.configadmin"))}).then(function(){var e=u.getService("orion.core.auth");if(e){var t=e.getUser().then(function(t){if(!t)return e.getAuthForm(window.location.href).then(function(e){window.location=e});localStorage.setItem("lastLogin",(new Date).getTime())}),n=localStorage.getItem("lastLogin");if(!n||n<(new Date).getTime()-9e5)return t}}).then(function(){var e={serviceRegistry:u,preferences:a,pluginRegistry:f};return o.resolve(e),e})})}var o;return{startup:u}}),define("examples/editor/textStylerOptions",["orion/bootstrap","orion/editor/util"],function(e,t){function s(t){this._styler=t,this._view=this._styler.view,this._view.stylerOptions=this;var n=this;this._listener={onStorage:function(e){n._onStorage(e)}};var r=this;this._view&&e.startup().then(function(e){i=e.preferences,r.preferences=i,r._updateStylesheet(i),r.storageKey=i.listenForChangedSettings(r._listener.onStorage)})}var n="JavaScript Editor",r="userTheme",i;return s.prototype={_getSetting:function(e,t,n){var r;for(var i=0;i<e.length;i++)if(e[i].label===t)for(var s=0;s<e[i].data.length;s++)if(e[i].data[s].label===n){r=e[i].data[s].value;break}return r},_styleSheet:function(e,t){function a(e,r){var s=u.getClassNameForToken(e);if(s){var o=n[r];i.push("."+t+" ."+s+" {"),i.push("	color: "+o+";"),i.push("}")}}var n=[];for(var r=0;r<e.length;r++)n[e[r].element]=e[r].value;var i=[];i.push("");var s=n.fontFamily;s==="sans serif"?s='"Menlo", "Consolas", "Vera Mono", "monospace"':s="monospace",i.push("."+t+" {"),i.push("	font-family: "+s+";"),i.push("	font-size: "+n.fontSize+";"),i.push("	color: "+n.text+";"),i.push("}"),i.push("."+t+" .textview {"),i.push("	background-color: "+n.background+";"),i.push("}"),i.push("."+t+".ruler.annotations{"),i.push("	background-color: red;"),i.push("}"),i.push("."+t+" .ruler {"),i.push("	background-color: "+n.annotationRuler+";"),i.push("}"),i.push("."+t+" .rulerLines {"),i.push("	color: "+n.lineNumber+";"),i.push("	background-color: "+n.annotationRuler+";"),i.push("}"),i.push("."+t+" .rulerLines.even {"),i.push("	color: "+n.lineNumber+";"),i.push("	background-color: "+n.annotationRuler+";"),i.push("}"),i.push("."+t+" .rulerLines.odd {"),i.push("	color: "+n.lineNumber+";"),i.push("	background-color: "+n.annotationRuler+";"),i.push("}"),i.push("."+t+" .annotationLine.currentLine {"),i.push("	background-color: "+n.currentLine+";"),i.push("}");var o=this,u=this._styler;return u.getClassNameForToken&&(a("keyword","keyword"),a("string","string"),a("singleLineComment","comment"),a("multiLineComment","comment"),a("docComment","comment"),a("docHtmlComment","comment")),i.join("\n")},_onStorage:function(e){e.key===this.storageKey&&this._updateStylesheet(this.preferences)},_update:function(e,n,i){if(e){n._stylesheet&&(n._stylesheet.parentNode.removeChild(n._stylesheet),n._stylesheet=null);var s=n._view,o=s.getOptions("parent"),u=o.ownerDocument,a=n._stylesheet=t.createElement(u,"style");a.appendChild(u.createTextNode(n._styleSheet(e,r,i)));var f=u.getElementsByTagName("head")[0]||u.documentElement;f.appendChild(a);var l={themeClass:null};s.getOptions(l);var c=l.themeClass;c?(c=c.replace(r,""),c&&(c+=" "),c+=r):c=r,l.themeClass=c,s.setOptions(l),s.update(!0)}},_updateStylesheet:function(e,t){var r,i=this;e.getPreferences("/settings",2).then(function(e){var s=e.get(n);s!==undefined&&(r=JSON.parse(e.get(n)),i._update(r,i,t))})}},{TextStylerOptions:s}}),define("orion/highlight",["examples/editor/textStyler","orion/editor/textMateStyler","orion/editor/AsyncStyler","examples/editor/textStylerOptions","orion/bootstrap","orion/editor/util","orion/Deferred"],function(e,t,n,r,i,s,o){function u(u,a,f,l,c,h,p){function d(e,t){var n=e.getProperty("contentType"),r=e.getProperty("fileTypes");if(n)return a.isSomeExtensionOf(f,n).then(function(t){return t?e:null});if(t&&r&&r.indexOf(t)!==-1){var i=new o;return i.resolve(e),i}return null}function v(e){return p||e.getProperty("type")!=="highlighter"}function m(t){var n=null;switch(t&&t.id){case"application/javascript":case"application/json":n=new e.TextStyler(l,"js",c);break;case"text/x-java-source":n=new e.TextStyler(l,"java",c);break;case"text/css":n=new e.TextStyler(l,"css",c)}return n&&new r.TextStylerOptions(n),n}var g=m(f);if(g){var y=new o;return y.resolve(g),y}var b=h&&h.split(".").pop().toLowerCase(),w=u.getServiceReferences("orion.edit.highlighter"),E=[],S=[];for(var x=0;x<w.length;x++){var T=w[x];T.getProperty("type")==="grammar"&&E.push(T.getProperty("grammar"));var N=d(T,b);N&&S.push(N)}return o.all(S,function(e){return{_error:e}}).then(function(e){var r;for(var o=e.length-1;o>=0;o--){var a=e[o];if(a&&!a._error&&v(a)){r=a;break}}var h;if(r){var p=r.getProperty("type");if(p==="highlighter")h=new n(l,u,c),h.setContentType(f);else if(p==="grammar"||typeof p=="undefined"){var d=r.getProperty("grammar");h=new t.TextMateStyler(l,d,E,i,s)}}return h})}function a(e){this.serviceRegistry=e,this.styler=null}return a.prototype={setup:function(e,t,n,r,i){i=typeof i=="undefined"?!0:i,this.styler&&(this.styler.destroy&&this.styler.destroy(),this.styler=null);var s=this;return u(this.serviceRegistry,this.serviceRegistry.getService("orion.core.contenttypes"),e,t,n,r,i).then(function(e){return s.styler=e,e})},getStyler:function(){return this.styler}},{createStyler:u,SyntaxHighlighter:a}}),define("orion/search/nls/root/messages",{"Find:":"Find:","Find With":"Find With","ReplaceWith:":"ReplaceWith:","Replace With":"Replace With","Show all":"Show all","Case sensitive":"Case sensitive","Wrap search":"Wrap search","Incremental search":"Incremental search","Whole Word":"Whole Word","Regular expression":"Regular expression","Find after replace":"Find after replace",Options:"Options","Find next match":"Find next match","Find previous match":"Find previous match",Replace:"Replace","Replace All":"Replace All","Not found":"Not found","Replacing all...":"Replacing all..."," matches":" matches","Replaced ":"Replaced ","Nothing replaced":"Nothing replaced","Search ${0}":"Search ${0}","Type a keyword or wild card to search in ":"Type a keyword or wild card to search in ","Search failed.":"Search failed.","No matches found for ${0}":"No matches found for ${0}","Searching...":"Searching...","Resource has been changed by others.":"Resource has been changed by others.","Failed to write file.":"Failed to write file.",Results:"Results","Files ${0} of ${1} matching ${2}":"Files ${0} of ${1} matching ${2}","Replace ${0} with ${1} for files ${2} of ${3}":"Replace ${0} with ${1} for files ${2} of ${3}",Location:"Location","Click to compare":"Click to compare",'Search again in this folder with "${0}"':'Search again in this folder with "${0}"',"Files replaced":"Files replaced",Status:"Status","${0} out of ${1}  matches replaced.":"${0} out of ${1}  matches replaced.","Save Search":"Save Search","Save search query":"Save search query","Replace all matches with...":"Replace all matches with...","Apply Changes":"Apply Changes","Replace all selected matches":"Replace all selected matches","Hide Compare":"Hide Compare","Hide compare view of changes":"Hide compare view of changes","Show Compare":"Show Compare","Show compare view of changes":"Show compare view of changes","Search Again":"Search Again","Search again":"Search again","< Previous Page":"< Previous Page","Show previous page of search result":"Show previous page of search result","Next Page >":"Next Page >","Show next page of search result":"Show next page of search result","Next result":"Next result","Previous result":"Previous result","Expand all results":"Expand all results","Collapse all results":"Collapse all results","Writing files...":"Writing files...","Preparing preview...":"Preparing preview...","Replaced File (${0})":"Replaced File (${0})","Original File (${0})":"Original File (${0})","Sort by Name":"Sort by Name","Compare changes":"Compare changes","Search Results":"Search Results","Replace All Matches":"Replace All Matches","No matches":"No matches",Rename:"Rename",Searches:"Searches","You can save frequently used by searches by choosing ${0} in the search toolbar.":"You can save frequently used by searches by choosing ${0} in the search toolbar."}),define("orion/search/nls/messages",["orion/i18n!orion/search/nls/messages","orion/search/nls/root/messages"],function(e,t){var n={root:t};return Object.keys(e).forEach(function(t){typeof n[t]=="undefined"&&(n[t]=e[t])}),n}),define("orion/searchAndReplace/textSearcher",["i18n!orion/search/nls/messages","require","orion/webui/littlelib","orion/editor/annotations","orion/commands","orion/searchUtils"],function(e,t,n,r,i,s){var o=o||{};return o.TextSearcher=function(){function t(e,t,n,r){this._editor=e,this._commandService=t,this._undoStack=n,this._showAllOccurrence=!0,this._ignoreCase=!0,this._wrapSearch=!0,this._wholeWord=!1,this._incremental=!0,this._useRegExp=!1,this._findAfterReplace=!0,this._reverse=!1,this.isMac=navigator.platform.indexOf("Mac")!==-1,this._searchRange=null,this._timer=null,this._searchOnRange=!1,this._lastSearchString="";var i=this;this._listeners={onEditorFocus:function(e){i.removeCurrentAnnotation(e)}},this.setOptions(r)}return t.prototype={_createActionTable:function(){var t=this;this._commandService.openParameterCollector("pageNavigationActions",function(n){var i=document.createElement("input");i.type="text",i.name=e["Find:"],i.id="localSearchFindWith",i.placeholder=e["Find With"],i.onkeyup=function(e){return t._handleKeyUp(e)},i.onkeydown=function(e){return t._handleKeyDown(e,!0)},n.appendChild(i),t.createButton("Next",n,function(){t.findNext(!0)}),t.createButton("Previous",n,function(){t.findNext(!1)});var s=document.createElement("input");s.type="text",s.name=e["ReplaceWith:"],s.id="localSearchReplaceWith",s.placeholder=e["Replace With"],s.classList.add("searchCmdGroupMargin"),s.onkeydown=function(e){return t._handleKeyDown(e,!1)},n.appendChild(s),t.createButton(e.Replace,n,function(){t.replace()}),t.createButton(e["Replace All"],n,function(){t.replaceAll()});var o=document.createElement("div");n.appendChild(o),o.classList.add("findOptionsDiv");var u=t._commandService._createDropdownMenu(o,e.Options);return u.menuButton.classList.add("findSlideoutMenu"),t._commandService._generateCheckedMenuItem(u.menu,e["Show all"],t._showAllOccurrence,function(e){var n=e.target.checked;t.setOptions({showAllOccurrence:n});if(n)t.markAllOccurrences(!0);else{var i=t._editor.getAnnotationModel();i&&i.removeAnnotations(r.AnnotationType.ANNOTATION_MATCHING_SEARCH)}u.dropdown.close(!0)}),t._commandService._generateCheckedMenuItem(u.menu,e["Case sensitive"],!t._ignoreCase,function(e){t.setOptions({ignoreCase:!e.target.checked}),u.dropdown.close(!0),t.findNext(!0,null,!0)}),t._commandService._generateCheckedMenuItem(u.menu,e["Wrap search"],t._wrapSearch,function(e){t.setOptions({wrapSearch:e.target.checked}),u.dropdown.close(!0)}),t._commandService._generateCheckedMenuItem(u.menu,e["Incremental search"],t._incremental,function(e){t.setOptions({incremental:e.target.checked}),u.dropdown.close(!0)}),t._commandService._generateCheckedMenuItem(u.menu,e["Whole Word"],t._wholeWord,function(e){t.setOptions({wholeWord:e.target.checked}),u.dropdown.close(!0),t.findNext(!0,null,!0)}),t._commandService._generateCheckedMenuItem(u.menu,e["Regular expression"],t._useRegExp,function(e){t.setOptions({useRegExp:e.target.checked}),u.dropdown.close(!0),t.findNext(!0,null,!0)}),t._commandService._generateCheckedMenuItem(u.menu,e["Find after replace"],t._findAfterReplace,function(e){t.setOptions({findAfterReplace:e.target.checked}),u.dropdown.close(!0)}),i},function(){t.closeUI()})},visible:function(){return document.getElementById("localSearchFindWith")?!0:!1},_handleKeyUp:function(e){return this._incremental&&!this._keyUpHandled&&(this._noSelection?this._noSelection=!1:this.findNext(!0,null,!0)),this._keyUpHandled=!1,!0},_handleKeyDown:function(e,t){var n=(this.isMac?e.metaKey:e.ctrlKey)&&!e.altKey&&!e.shiftKey;return n&&e.keyCode===70?(this._keyUpHandled=t,e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0,!1):(this.isMac?e.metaKey:e.ctrlKey)&&!e.altKey&&e.keyCode===75||e.keyCode===13?(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0,this.findNext(!e.shiftKey),this._keyUpHandled=t,!1):n&&e.keyCode===82?(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0,t||this.replace(),this._keyUpHandled=t,!1):e.keyCode===27?(this.closeUI(),this._keyUpHandled=t,!1):!0},closeUI:function(){this.visible()&&this._commandService.closeParameterCollector(),this._editor.getTextView().removeEventListener("Focus",this._listeners.onEditorFocus),this._editor.getTextView().focus();var e=this._editor.getAnnotationModel();e&&(e.removeAnnotations(r.AnnotationType.ANNOTATION_CURRENT_SEARCH),e.removeAnnotations(r.AnnotationType.ANNOTATION_MATCHING_SEARCH))},removeCurrentAnnotation:function(e){var t=this._editor.getAnnotationModel();t&&t.removeAnnotations(r.AnnotationType.ANNOTATION_CURRENT_SEARCH)},createButton:function(e,t,r){var i=document.createElement("span");i.tabIndex=0,i.role="button",i.addEventListener("click",r.bind(this),!1);var s=this;i.addEventListener("keydown",function(e){e.keyCode===n.KEY.ENTER||e.keyCode===n.KEY.SPACE?r.bind(s)():e.keyCode===n.KEY.ESCAPE&&s.closeUI()}),i.appendChild(document.createTextNode(e)),i.classList.add("findSlideoutButton"),t.appendChild(i)},buildToolBar:function(e,t){this._keyUpHandled=!0,this._editor.getTextView().addEventListener("Focus",this._listeners.onEditorFocus);var n=document.getElementById("localSearchFindWith");if(this.visible()){e.length>0?n.value=e:this._noSelection=!0,window.setTimeout(function(){n.select(),n.focus()},10);return}this._createActionTable();if(typeof t=="string"){var r=document.getElementById("localSearchReplaceWith");r.value=t}n=document.getElementById("localSearchFindWith"),n.value=e,window.setTimeout(function(){n.select(),n.focus()},10)},setOptions:function(e){if(e){if(e.showAllOccurrence===!0||e.showAllOccurrence===!1)this._showAllOccurrence=e.showAllOccurrence;if(e.ignoreCase===!0||e.ignoreCase===!1)this._ignoreCase=e.ignoreCase;if(e.wrapSearch===!0||e.wrapSearch===!1)this._wrapSearch=e.wrapSearch;if(e.wholeWord===!0||e.wholeWord===!1)this._wholeWord=e.wholeWord;if(e.incremental===!0||e.incremental===!1)this._incremental=e.incremental;if(e.useRegExp===!0||e.useRegExp===!1)this._useRegExp=e.useRegExp;if(e.findAfterReplace===!0||e.findAfterReplace===!1)this._findAfterReplace=e.findAfterReplace;if(e.reverse===!0||e.reverse===!1)this._reverse=e.reverse;e.toolBarId&&(this._toolBarId=e.toolBarId),e.searchRange&&(this._searchRange=e.searchRange);if(e.searchOnRange===!0||e.searchOnRange===!1)this._searchOnRange=e.searchOnRange}},getSearchStartIndex:function(e,t){var n=this._editor.getCaretOffset();if(e){var r=this._editor.getSelection(),i=r.end>r.start?r.end-r.start:0;return t?r.end>0?r.end:0:n-i-1>0?n-i-1:0}return n>0?n:0},findNext:function(e,t,n){this.setOptions({reverse:!e});var r=document.getElementById("localSearchFindWith"),i=this.getSearchStartIndex(n?!0:!e);return t||(t=r?r.value:this._lastSearchString),this._doFind(t,i,!e,this._wrapSearch)},startUndo:function(){this._undoStack&&this._undoStack.startCompoundChange()},endUndo:function(){this._undoStack&&this._undoStack.endCompoundChange()},_doReplace:function(e,t,n,r){var i=this._editor;if(this._useRegExp){var s=i.getText().substring(e,t).replace(new RegExp(n,this._ignoreCase?"i":""),r);s&&(i.setText(s,e,t),i.setSelection(e,e+s.length,!0))}else i.setText(r,e,t),i.setSelection(e,e+r.length,!0)},replace:function(){this.startUndo();var e=document.getElementById("localSearchReplaceWith").value,t=this._editor,n=t.getSelection(),r=document.getElementById("localSearchFindWith").value,i=n?n.start:0;if(r){var s=t.getModel().find({string:r,start:i,reverse:!1,wrap:this._wrapSearch,regex:this._useRegExp,wholeWord:this._wholeWord,caseInsensitive:this._ignoreCase}).next();s&&this._doReplace(s.start,s.end,r,e)}this.endUndo(),this._findAfterReplace&&r&&this._doFind(r,this.getSearchStartIndex(!1),!1,this._wrapSearch)},_doFind:function(t,n,i,s){var o=this._editor,u=o.getAnnotationModel();if(!t)return u&&(u.removeAnnotations(r.AnnotationType.ANNOTATION_CURRENT_SEARCH),u.removeAnnotations(r.AnnotationType.ANNOTATION_MATCHING_SEARCH)),null;this._lastSearchString=t;var a=o.getModel().find({string:t,start:n,reverse:i,wrap:s,regex:this._useRegExp,wholeWord:this._wholeWord,caseInsensitive:this._ignoreCase}).next();if(!this._replacingAll){a?this._editor.reportStatus(""):this._editor.reportStatus(e["Not found"],"error");var f=this.visible();if(f){var l=r.AnnotationType.ANNOTATION_CURRENT_SEARCH;u&&(u.removeAnnotations(l),a&&u.addAnnotation(r.AnnotationType.createAnnotation(l,a.start,a.end)));if(this._showAllOccurrence){this._timer&&window.clearTimeout(this._timer);var c=this;this._timer=window.setTimeout(function(){c.markAllOccurrences(a),c._timer=null},500)}}}return a&&o.moveSelection(a.start,a.end,null,!1),a},replaceAll:function(){var t=document.getElementById("localSearchFindWith").value;if(t){this._replacingAll=!0;var n=this._editor;n.reportStatus(""),n.reportStatus(e["Replacing all..."],"progress");var r=document.getElementById("localSearchReplaceWith").value,i=this;window.setTimeout(function(){var s=0,o=0,u;for(;;){var a=i._doFind(t,s);if(!a)break;u=a,o++,o===1&&i.startUndo();var f=n.getSelection();i._doReplace(f.start,f.end,t,r),s=i.getSearchStartIndex(!0,!0)}o>0&&i.endUndo(),n.reportStatus("","progress"),s>0?n.reportStatus(e["Replaced "]+o+e[" matches"]):n.reportStatus(e["Nothing replaced"],"error"),i._replacingAll=!1},100)}},markAllOccurrences:function(e){var t=this._editor.getAnnotationModel();if(!t)return;var n=r.AnnotationType.ANNOTATION_MATCHING_SEARCH,i=t.getAnnotations(0,t.getTextModel().getCharCount()),s=[],o;while(i.hasNext()){var u=i.next();u.type===n&&s.push(u)}var a=document.getElementById("localSearchFindWith").value;if(e&&a){i=this._editor.getModel().find({string:a,regex:this._useRegExp,wholeWord:this._wholeWord,caseInsensitive:this._ignoreCase}),o=[];while(i.hasNext()){var f=i.next();o.push(r.AnnotationType.createAnnotation(n,f.start,f.end))}}t.replaceAnnotations(s,o)}},t}(),o}),define("orion/compare/compare-container",["i18n!orion/compare/nls/messages","require","orion/Deferred","orion/webui/littlelib","orion/compare/diff-parser","orion/compare/compare-rulers","orion/editor/contentAssist","orion/editorCommands","orion/editor/editor","orion/editor/editorFeatures","orion/globalCommands","orion/commands","orion/editor/textModel","orion/editor/textView","orion/compare/compare-features","orion/compare/compareUtils","orion/compare/diff-provider","orion/compare/jsdiffAdapter","orion/highlight","orion/compare/diffTreeNavigator","orion/searchAndReplace/textSearcher","orion/fileClient"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E){var S={};return S.DefaultDiffProvider=function(){function e(e){this.serviceRegistry=e,this._diffProvider=new m.DiffProvider(e)}return e.prototype={_resolveTwoFiles:function(e,t,r){var i=this,s=function(n){if(Array.isArray(n)&&n.length===2&&n[0]&&n[1]){n[0]._error&&r&&r(n[0]._error),n[1]._error&&r&&r(n[1]._error);var s=n[0],o=n[1];i.callBack({baseFile:{URL:e,Name:i._resolveFileName(e),Type:s},newFile:{URL:t,Name:i._resolveFileName(t),Type:o},diff:i._diffContent})}else{var u=e?i._resolveFileName(e):"",a=t?i._resolveFileName(t):"";i.callBack({baseFile:{URL:e,Name:u,Type:null},newFile:{URL:t,Name:a,Type:null},diff:i._diffContent})}};n.all([i._getContentType(e),i._getContentType(t)],function(e){return{_error:e}}).then(s)},_resolveDiff:function(e,t,n,r){if(t)this._resolveTwoFiles(t,e,r);else{if(!this._diffProvider){console.log("A diff provider is needed for compound diff URL");return}var i=this;i._diffProvider.getDiffContent(e).then(function(t,r){i._hasConflicts?i._diffContent=t.split("diff --git")[1]:i._diffContent=t,n?i.callBack({diff:i._diffContent}):i._resolveComplexFileURL(e)},r)}},_resolveFileName:function(e){var t=e.split("?")[0];return t},_getContentType:function(e){var t=this._resolveFileName(e);return this.serviceRegistry.getService("orion.core.contenttypes").getFilenameContentType(t)},_resolveComplexFileURL:function(e,t){var n=this;this._diffProvider.getDiffFileURI(e).then(function(e,r){n._resolveTwoFiles(e.Old,e.New,t)},t)},provide:function(e,t,n,r,i,s){this.callBack=i,this._hasConflicts=r,this._resolveDiff(e,t,n,s)}},e}(),S.CompareStyler=function(){function e(e){this._syntaxHighlither=new y.SyntaxHighlighter(e)}return e.prototype={highlight:function(e,t,n,r,i){this._syntaxHighlither.setup(t,n.getTextView(),null,e,!1).then(function(){r&&i&&(n.setAnnotationRulerVisible(!1),r._highlighterLoaded++,r._highlighterLoaded===i&&(r._diffNavigator.renderAnnotations(),r._diffNavigator.gotoBlock(r.options.blockNumber-1,r.options.changeNumber-1)))})}},e}(),S.CompareContainer=function(){function t(){this._diffParser=new i.DiffParser}return t.prototype={_clearOptions:function(){this.options={},this.options.baseFile={URL:"",Name:"",Type:""},this.options.newFile={URL:"",Name:"",Type:""},this.options.blockNumber=1,this.options.changeNumber=0},setOptions:function(e,t){t&&this._clearOptions(),e&&(this.options.mapper=e.mapper?e.mapper:this.options.mapper,this.options.commandSpanId=typeof e.commandSpanId=="string"?e.commandSpanId:this.options.commandSpanId,this.options.generateLink=e.generateLink!==undefined&&e.generateLink!==null?e.generateLink:this.options.generateLink,this.options.editableInComparePage=e.editableInComparePage!==undefined&&e.editableInComparePage!==null?e.editableInComparePage:this.options.editableInComparePage,this.options.gridRenderer=e.gridRenderer||this.options.gridRenderer,this.options.readonly=e.readonly!==undefined&&e.readonly!==null?e.readonly:this.options.readonly,this.options.onPage=e.onPage!==undefined&&e.onPage!==null?e.onPage:this.options.onPage,this.options.wordLevelNav=e.wordLevelNav!==undefined&&e.wordLevelNav!==null?e.wordLevelNav:this.options.wordLevelNav,this.options.charDiff=e.charDiff!==undefined&&e.charDiff!==null?e.charDiff:this.options.charDiff,this.options.hasConflicts=e.hasConflicts!==undefined&&e.hasConflicts!==null?e.hasConflicts:this.options.hasConflicts,this.options.diffProvider=e.diffProvider?e.diffProvider:this.options.diffProvider,this.options.resource=e.resource?e.resource:this.options.resource,this.options.compareTo=e.compareTo?e.compareTo:this.options.compareTo,this.options.baseFile.URL=e.baseFile&&e.baseFile.URL?e.baseFile.URL:this.options.baseFile.URL,this.options.baseFile.Name=e.baseFile&&typeof e.baseFile.Name=="string"?e.baseFile.Name:this.options.baseFile.Name,this.options.baseFile.Type=e.baseFile&&e.baseFile.Type?e.baseFile.Type:this.options.baseFile.Type,this.options.baseFile.Content=e.baseFile&&typeof e.baseFile.Content=="string"?e.baseFile.Content:this.options.baseFile.Content,this.options.newFile.URL=e.newFile&&e.newFile.URL?e.newFile.URL:this.options.newFile.URL,this.options.newFile.Name=e.newFile&&typeof e.newFile.Name=="string"?e.newFile.Name:this.options.newFile.Name,this.options.newFile.Type=e.newFile&&e.newFile.Type?e.newFile.Type:this.options.newFile.Type,this.options.newFile.Content=e.newFile&&typeof e.newFile.Content=="string"?e.newFile.Content:this.options.newFile.Content,this.options.diffURL=e.diffURL?e.diffURL:this.options.diffURL,this.options.diffContent=e.diffContent?e.diffContent:this.options.diffContent,this.options.diffArray=e.diffArray?e.diffArray:this.options.diffArray,this.options.blockNumber=e.blockNumber?e.blockNumber:this.options.blockNumber,this.options.changeNumber=e.changeNumber?e.changeNumber:this.options.changeNumber,this.options.onSave=e.onSave?e.onSave:this.options.onSave,this.options.callback=e.callback?e.callback:this.options.callback,this._errorCallback=e.errorCallback?e.errorCallback:this._errorCallback,this.options.onSetTitle=e.onSetTitle?e.onSetTitle:this.options.onSetTitle,this.options.toggler=e.toggler?e.toggler:this.options.toggler,this.options.highlighter=e.highlighter?e.highlighter:this.options.highlighter)},initCommands:function(){var t=this.getCommandSpanId();if(!t)return;var n=new c.Command({name:e["Copy current change from right to left"],tooltip:e["Copy current change from right to left"],imageClass:"core-sprite-leftarrow",id:"orion.compare.copyToLeft",groupId:"orion.compareGroup",callback:function(e){e.items.copyToLeft()}}),r=new c.Command({tooltip:e["Switch to unified diff"],name:e.Unified,id:"orion.compare.toggle2Inline",groupId:"orion.compareGroup",visibleWhen:function(e){return e.options.toggler&&e.options.toggler.widgetType==="twoWay"},callback:function(e){e.items.options.toggler.toggle()}}),i=new c.Command({tooltip:e["Switch to side by side diff"],name:e["Side by side"],id:"orion.compare.toggle2TwoWay",groupId:"orion.compareGroup",visibleWhen:function(e){return e.options.toggler&&e.options.toggler.widgetType==="inline"},callback:function(e){e.items.options.toggler.toggle()}}),s=new c.Command({tooltip:e["Generate link of the current diff"],name:e["Generate Link"],id:"orion.compare.generateLink",groupId:"orion.compareGroup",visibleWhen:function(e){return e.options.resource&&e.options.generateLink},callback:function(e){e.items.generateLink()}}),o=new c.Command({tooltip:e["Open the compare page"],name:e.Compare,id:"orion.compare.openComparePage",groupId:"orion.compareGroup",visibleWhen:function(e){return e.options.resource&&!e.options.generateLink},hrefCallback:function(e){return e.items.openComparePage()}}),u=new c.Command({name:e["Next diff block"],tooltip:e["Next diff block"],imageClass:"core-sprite-move_down",id:"orion.compare.nextDiff",groupId:"orion.compareGroup",callback:function(e){e.items.nextDiff()}}),a=new c.Command({name:e["Previous diff block"],tooltip:e["Previous diff block"],imageClass:"core-sprite-move_up",id:"orion.compare.prevDiff",groupId:"orion.compareGroup",callback:function(e){e.items.prevDiff()}}),f=new c.Command({name:e["Next diff change"],tooltip:e["Next diff change"],imageClass:"core-sprite-move_down",id:"orion.compare.nextChange",groupId:"orion.compareGroup",callback:function(e){e.items.nextChange()}}),l=new c.Command({name:e["Previous diff change"],tooltip:e["Previous diff change"],imageClass:"core-sprite-move_up",id:"orion.compare.prevChange",groupId:"orion.compareGroup",callback:function(e){e.items.prevChange(e)}});this._commandService.addCommand(n),this._commandService.addCommand(i),this._commandService.addCommand(r),this._commandService.addCommand(s),this._commandService.addCommand(o),this._commandService.addCommand(u),this._commandService.addCommand(a),this._commandService.addCommand(f),this._commandService.addCommand(l),this._commandService.registerCommandContribution(t,"orion.compare.openComparePage",107),this._commandService.registerCommandContribution(t,"orion.compare.generateLink",108,null,!1,new c.CommandKeyBinding("l",!0,!0)),this.options.readonly||this._commandService.registerCommandContribution(t,"orion.compare.copyToLeft",109,null,!1,new c.CommandKeyBinding(37,!0,!1,!0)),this._commandService.registerCommandContribution(t,"orion.compare.toggle2Inline",110),this._commandService.registerCommandContribution(t,"orion.compare.toggle2TwoWay",111),this._commandService.registerCommandContribution(t,"orion.compare.nextDiff",112,null,!1,new c.CommandKeyBinding(40,!0)),this._commandService.registerCommandContribution(t,"orion.compare.prevDiff",113,null,!1,new c.CommandKeyBinding(38,!0)),this.options.wordLevelNav?(this._commandService.registerCommandContribution(t,"orion.compare.nextChange",114,null,!1,new c.CommandKeyBinding(40,!0,!0)),this._commandService.registerCommandContribution(t,"orion.compare.prevChange",115,null,!1,new c.CommandKeyBinding(38,!0,!0))):(this._commandService.registerCommandContribution(t,"orion.compare.nextChange",114,null,!0,new c.CommandKeyBinding(40,!0,!0)),this._commandService.registerCommandContribution(t,"orion.compare.prevChange",115,null,!0,new c.CommandKeyBinding(38,!0,!0)))},getCommandSpanId:function(){var e=this.options.commandSpanId;return!e&&this.getDefaultCommandSpanId&&(e=this.getDefaultCommandSpanId()),e},renderCommands:function(){var e=this.getCommandSpanId();if(!e)return;r.empty(r.node(e)),this.options.gridRenderer&&this.options.gridRenderer.navGridHolder?(this.options.gridRenderer.navGridHolder.splice(0,this.options.gridRenderer.navGridHolder.length),this.options.gridRenderer.additionalCmdRender?this.options.gridRenderer.before?(this.options.gridRenderer.additionalCmdRender(this.options.gridRenderer.navGridHolder),this._commandService.renderCommands(e,e,this,this,"tool",null,this.options.gridRenderer.navGridHolder)):(this._commandService.renderCommands(e,e,this,this,"tool",null,this.options.gridRenderer.navGridHolder),this.options.gridRenderer.additionalCmdRender(this.options.gridRenderer.navGridHolder)):this._commandService.renderCommands(e,e,this,this,"tool",null,this.options.gridRenderer.navGridHolder)):this._commandService.renderCommands(e,e,this,this,"tool",null)},generateLink:function(){var t=this.getCurrentDiffPos(),n=v.generateCompareHref(this.options.resource,{compareTo:this.options.compareTo,readonly:this.options.readonly,conflict:this.options.hasConflicts,block:t.block?t.block:1,change:t.change?t.change:0});prompt(e["Copy the link URL:"],n)},openComparePage:function(){var e=this.getCurrentDiffPos(),t=v.generateCompareHref(this.options.resource,{compareTo:this.options.compareTo,readonly:!this.options.editableInComparePage,conflict:this.options.hasConflicts,block:e.block?e.block:1,change:e.change?e.change:0});return t},getCurrentDiffPos:function(){return this._diffNavigator.getCurrentPosition()},nextDiff:function(){this._diffNavigator.nextDiff()},prevDiff:function(){this._diffNavigator.prevDiff()},nextChange:function(){this._diffNavigator.nextChange()},prevChange:function(){this._diffNavigator.prevChange()},clearContent:function(){this.options.baseFile&&(this.options.baseFile.Content=null),this.options.newFile&&(this.options.newFile.Content=null)},_getLineDelim:function(e,t){var n="\n";return n},resolveDiffByProvider:function(e){if(!this.options.diffProvider){console.log("A diff provider is needed for Complex diff URL");return}var t=this;t.options.diffProvider.provide(t.options.resource,t.options.compareTo,e,t.options.hasConflicts,function(n){t.options.baseFile.URL=n.baseFile&&typeof n.baseFile.URL=="string"?n.baseFile.URL:t.options.baseFile.URL,t.options.baseFile.Name=n.baseFile&&typeof n.baseFile.Name=="string"?n.baseFile.Name:t.options.baseFile.Name,t.options.baseFile.Type=n.baseFile&&typeof n.baseFile.Type=="object"?n.baseFile.Type:t.options.baseFile.Type,t.options.baseFile.Content=n.baseFile&&typeof n.baseFile.Content=="string"?n.baseFile.Content:t.options.baseFile.Content,t.options.newFile.URL=n.newFile&&typeof n.newFile.URL=="string"?n.newFile.URL:t.options.newFile.URL,t.options.newFile.Name=n.newFile&&typeof n.newFile.Name=="string"?n.newFile.Name:t.options.newFile.Name,t.options.newFile.Type=n.newFile&&typeof n.newFile.Type=="object"?n.newFile.Type:t.options.newFile.Type,t.options.newFile.Content=n.newFile&&typeof n.newFile.Content=="string"?n.newFile.Content:t.options.newFile.Content,t.options.diffContent=typeof n.diff=="string"?n.diff:t.options.diffContent;if(e||typeof t.options.baseFile.Content=="string")t.setEditor(e);else{t.options.callback&&t.options.callback(t.options.baseFile.Name,t.options.newFile.Name);var r=t.options.diffContent?[t.options.baseFile]:[t.options.baseFile,t.options.newFile];t.getFilesContents(r).then(function(){var e=this.setEditor();this._onLoadContents&&this._onLoadContents(e)}.bind(t))}},t.options.errorCallback)},resolveDiffByContents:function(e){return typeof this.options.baseFile.Content=="string"&&typeof this.options.newFile.Content=="string"?(!this.options.diffContent&&!this._mapper&&(this.options.diffContent=""),this._onLoadContents&&this._onLoadContents(),this.setEditor(e),!0):!1},getFilesContents:function(e){var t=[];return e.forEach(function(e){t.push(this._loadSingleFile(e))}.bind(this)),n.all(t,function(e){return{_error:e}})},_loadSingleFile:function(e){return this._registry.getService("orion.page.progress").progress(this._fileClient.read(e.URL),"Getting contents of "+e.URL).then(function(t){return e.Content=t,e}.bind(this),function(t,n){return t.status===404?e.Content="":this.errorCallback&&this.errorCallback(t,n),e}.bind(this))},parseMapper:function(e,t,n,r,i){var s=this._getLineDelim(e,n);this._diffParser.setLineDelim(s);if(this.options.mapper&&this.options.toggler)return{delim:s,mapper:this.options.mapper,output:this.options.newFile.Content,diffArray:this.options.diffArray};if(t){var o=new g.JSDiffAdapter,u=o.adapt(e,t,s);return this.options.toggler&&(this.options.mapper=u.mapper,this.options.newFile.Content=t,this.options.diffArray=u.changContents),{delim:s,mapper:u.mapper,output:t,diffArray:u.changContents}}var a=this._diffParser.parse(e,n,r,i),f=this._diffParser.getDiffArray();return this.options.toggler&&(this.options.mapper=a.mapper,this.options.newFile.Content=a.outPutFile,this.options.diffArray=f),{delim:s,mapper:a.mapper,output:a.outPutFile,diffArray:f}},startup:function(e,t){this._onLoadContents=t,this.options.resource?this.resolveDiffByProvider(e):this.resolveDiffByContents(e)}},t}(),S.TwoWayCompareContainer=function(){function t(t,n,i,o){this._diffNavigator=new b.DiffTreeNavigator("word"),this._registry=t,this._commandService=this._registry.getService("orion.page.command"),this._fileClient=new E.FileClient(t),this._searchService=this._registry.getService("orion.core.search"),this._progress=this._registry.getService("orion.page.progress"),this._uiFactory=i,this._uiFactory||(this._uiFactory=new d.TwoWayCompareUIFactory({parentDivID:n,showTitle:!1,showLineStatus:!1}),this._uiFactory.buildUI()),this._viewLoadedCounter=0,this.setOptions(o,!0);var u=this,a=this._uiFactory.getTitleDiv(!0);a&&r.empty(a);var f=this._uiFactory.getTitleDiv(!1);f&&r.empty(f),this.options.callback||(this.options.callback=function(e,t){a&&f&&(a.appendChild(document.createTextNode(t)),f.appendChild(document.createTextNode(e)))}),this._errorCallback||(this._errorCallback=function(e,t){if(a&&f){var n=typeof e.message=="string"?e.message:t.xhr.statusText;a.appendChild(document.createTextNode(n)),f.appendChild(document.createTextNode(n)),a.style.color="red",f.style.color="red"}}),this._leftEditorDiv=this._uiFactory.getEditorParentDiv(!0),this._rightEditorDiv=this._uiFactory.getEditorParentDiv(!1),this.initCommands(),this._inputManager={filePath:"",getInput:function(){return this.filePath},setDirty:function(e){l.setDirtyIndicator(e)},getFileMetadata:function(){return this._fileMetadata},setInput:function(e,t){this.onSetTitle?this.onSetTitle(e,function(e){this.setTitle(e)}.bind(this),function(t){console.error("Error loading file metadata: "+t.message),this.setTitle(e)}.bind(this)):u._progress.progress(u._fileClient.read(e,!0),"Getting file metadata "+e).then(function(e){this._fileMetadata=e,this.setTitle(e.Location,e)}.bind(this),function(t){console.error("Error loading file metadata: "+t.message),this.setTitle(e)}.bind(this)),this.lastFilePath=e},setTitle:function(n,r){var i;r&&(i=r.Name),l.setPageTarget({task:e.Compare,name:i,target:r,serviceRegistry:t,commandService:this._commandService,searchService:this._searchService,fileService:this._fileClient}),n.charAt(0)==="*"?(l.setDirtyIndicator(!0),i=n.substring(1)):l.setDirtyIndicator(!1)},afterSave:function(){u.startup(!0)}},this.options.onSave&&(this._inputManager.onSave=this.options.onSave),this.options.onSetTitle&&(this._inputManager.onSetTitle=this.options.onSetTitle),this._curveRuler=new s.CompareCurveRuler(this._uiFactory.getDiffCanvasDiv()),this._highlighter=[],this.options.highlighter&&typeof this.options.highlighter=="function"?(this._highlighter.push(new this.options.highlighter),this._highlighter.push(new this.options.highlighter)):(this._highlighter.push(new S.CompareStyler(this._registry)),this._highlighter.push(new S.CompareStyler(this._registry))),this.initEditorContainers("\n",e["fetching..."],e["fetching..."],[])}return t.prototype=new S.CompareContainer,t.prototype.initEditorContainers=function(t,n,i,o,u){this._leftEditor=this.createEditorContainer(n,t,o,0,this._leftEditorDiv,this._uiFactory.getStatusDiv(!0),this.options.readonly,u,this.options.newFile);if(this.options.onPage){var a=r.node("pageActions");a&&(this._commandService.destroy(a),this._commandService.renderCommands(a.id,a,this._leftEditor,this._leftEditor,"button"))}this._leftTextView=this._leftEditor.getTextView(),this._rightEditor=this.createEditorContainer(i,t,o,1,this._rightEditorDiv,this._uiFactory.getStatusDiv(!1),!0,u,this.options.baseFile),this._rightTextView=this._rightEditor.getTextView();var f=this;this._overviewRuler=new s.CompareOverviewRuler("right",{styleClass:"ruler overview"},null,function(e,t){f._diffNavigator.matchPositionFromOverview(e)}),window.onbeforeunload=function(){if(f._leftEditor.isDirty())return e["There are unsaved changes."]}},t.prototype.getDefaultCommandSpanId=function(){return this._uiFactory.getCommandSpanId()},t.prototype.gotoDiff=function(e,t,n){var r=n?this._leftTextView:this._rightTextView,i=r.getModel().getLineStart(e)+t;this._diffNavigator.gotoDiff(i,r)},t.prototype.gotoMatch=function(e,t,n,r,i,s){this.onScroll||(this.onScroll=i),this.onLoad||(this.onLoad=s);var o=this._leftTextView.getModel().getLineStart(e)+n.startIndex;this._leftEditor.moveSelection(o,o)},t.prototype.copyToLeft=function(){this._curveRuler.copyToLeft()},t.prototype.resizeEditors=function(){this._leftTextView&&this._leftTextView.resize(),this._rightTextView&&this._rightTextView.resize()},t.prototype.getSplitter=function(){return this._uiFactory.getSplitter()},t.prototype.createEditorContainer=function(t,n,r,i,s,o,l,c,d){var v=this,m=new h.TextModel(t,n),g=function(){var e=new p.TextView({parent:s,model:m,readonly:l,tabSize:4});v._viewLoadedCounter++,v._viewLoadedCounter===2&&v._diffNavigator.matchPositionFromOverview(-1),v.onLoad&&v.onLoad();var t=v.getSplitter();if(t){var n=i===0;t.addResizeListener(function(t){if(t){var r=!1;v._uiFactory.isLeftPane(t)?r=n:r=!n,r&&e.resize()}})}return e},y=function(e,t,n,r){if(l){v._commandService.addCommandGroup("pageActions","orion.editorActions.unlabeled",200);return}var i=new w.TextSearcher(e,v._commandService,n),s=new u.EditorCommandFactory(v._registry,v._commandService,v._fileClient,v._inputManager,"pageActions",l,"pageNavigationActions",i);s.generateEditorCommands(e);var o=new f.TextActions(e,n);t.push(o);var a=new f.SourceCodeActions(e,n,r);t.push(a)},b="",E="",S=function(t,n){if(!o)return;n?E=e["ERROR: "]+t:E=t,o.textContent=b+E},x=l?new f.UndoFactory:new u.UndoCommandFactory(v._registry,v._commandService,"pageActions"),T=new f.AnnotationFactory,N=new a.Editor({textViewFactory:g,undoStackFactory:x,annotationFactory:T,keyBindingFactory:y,statusReporter:S,domNode:s});N.installTextView(),N.setOverviewRulerVisible(!1);if(!l){var C=this._inputManager;N.addEventListener("DirtyChanged",function(e){C.setDirty(N.isDirty())})}var k=N.getTextView();return c&&d&&typeof d.Name=="string"&&typeof d.Type=="string"&&(N.setInput(d.Name),this._highlighter[i].highlight(d.Name,d.Type,N)),k.addEventListener("Selection",function(e){if(e.newValue&&e.newValue.start!==e.newValue.end)return;if(v._diffNavigator.autoSelecting||!v._diffNavigator.editorWrapper[0].diffFeeder)return;var t=k.getCaretOffset();v._diffNavigator.gotoDiff(t,k)}),i===0?(k.getModel().addEventListener("Changed",function(e){v._curveRuler.onChanged(e)}),k.addEventListener("Scroll",function(e){v._curveRuler&&(v._curveRuler.matchPositionFrom(!0),v._curveRuler.render()),v.onScroll&&v.onScroll()})):k.addEventListener("Scroll",function(e){v._curveRuler&&v._curveRuler.render()}),N},t.prototype.destroy=function(){this._leftTextView&&(this._diffNavigator.destroy(),this._leftEditor.destroy(),this._rightEditor.destroy(),this._uiFactory.destroy())},t.prototype.addRulers=function(){this._rightTextView&&this._leftTextView&&!this._hasRuler&&(this._leftTextViewRuler=new s.LineNumberCompareRuler(this._diffNavigator,0,"left",{styleClass:"ruler lines"},{styleClass:"rulerLines odd"},{styleClass:"rulerLines even"}),this._rightTextViewRuler=new s.LineNumberCompareRuler(this._diffNavigator,0,"left",{styleClass:"ruler lines"},{styleClass:"rulerLines odd"},{styleClass:"rulerLines even"}),this._leftTextView.addRuler(this._leftTextViewRuler),this._rightTextView.addRuler(this._rightTextViewRuler),this._rightTextView.addRuler(this._overviewRuler),this._hasRuler=!0)},t.prototype.setEditor=function(e){var t=this.options.baseFile.Content,n=this.options.newFile.Content,r=this.options.diffContent,i;n?i=this.parseMapper(t,n,r,this.options.hasConflicts,!0):(i=this.parseMapper(t,n,r,this.options.hasConflicts,e),n=i.output),this._highlighterLoaded=0;if(!this._leftEditor)this.initEditorContainers(i.delim,n,t,i.mapper,!0);else if(e)this._diffNavigator.initMapper(i.mapper),this._curveRuler.init(i.mapper,this._leftEditor,this._rightEditor,this._diffNavigator),this.renderCommands(),this._leftTextView.redrawRange(),this._rightTextView.redrawRange();else{var s=new b.TwoWayDiffBlockFeeder(this._rightTextView.getModel(),i.mapper,1),o=new b.TwoWayDiffBlockFeeder(this._leftTextView.getModel(),i.mapper,0);this._diffNavigator.initAll(this.options.charDiff?"char":"word",this._rightEditor,this._leftEditor,s,o,this._overviewRuler,this._curveRuler),this._curveRuler.init(i.mapper,this._leftEditor,this._rightEditor,this._diffNavigator),this._inputManager.filePath=this.options.newFile.URL,this._rightEditor.setInput(this.options.baseFile.Name,null,t),this._leftEditor.setInput(this.options.newFile.Name,null,n),this._highlighter[0].highlight(this.options.newFile.Name,this.options.newFile.Type,this._leftEditor,this,2),this._highlighter[1].highlight(this.options.baseFile.Name,this.options.baseFile.Type,this._rightEditor,this,2),this.renderCommands(),this.addRulers(),this.options.readonly||this._inputManager.setInput(this.options.newFile.URL,this._leftEditor)}this._viewLoadedCounter>1&&this._diffNavigator.gotoBlock(this.options.blockNumber-1,this.options.changeNumber-1);var u=this._leftTextView.getModel().getLineCount()*this._leftTextView.getLineHeight()+5,a=this._rightTextView.getModel().getLineCount()*this._rightTextView.getLineHeight()+5;return u>a?u:a},t}(),S.InlineCompareContainer=function(){function e(e,t,n){this._diffNavigator=new b.DiffTreeNavigator("word"),this._registry=e,this._commandService=this._registry.getService("orion.page.command"),this._fileClient=new E.FileClient(e),this._statusService=this._registry.getService("orion.page.message"),this._progress=this._registry.getService("orion.page.progress"),this.setOptions(n,!0),this.setOptions({readonly:!0});var i=this;this.options.callback||(this.options.callback=function(e,t){var n=r.node("fileNameInViewer");n&&(r.empty(n),n.appendChild(document.createTextNode(i._diffTitle)),n.style.color="#6d6d6d"),i._statusService.setProgressMessage("")}),this._errorCallback||(this._errorCallback=function(e,t){var n=[];n.Severity="Error",n.HTML=!1;try{var r=JSON.parse(e.responseText);n.Message=r.DetailedMessage?r.DetailedMessage:r.Message}catch(i){n.Message=typeof e.message=="string"?e.message:t.xhr.statusText}this._statusService.setProgressResult(n)}),this.initCommands(),this._highlighter=[],this.options.highlighter&&typeof this.options.highlighter=="function"?this._highlighter.push(new this.options.highlighter):this._highlighter.push(new S.CompareStyler(this._registry)),this._editorDivId=t,this.initEditorContainers("","\n",[],[]),this.hasContent=!1}return e.prototype=new S.CompareContainer,e.prototype.addRulers=function(){this._textView&&!this._hasRuler&&(this._textView.addRuler(this._rulerOrigin),this._textView.addRuler(this._rulerNew),this._textView.addRuler(this._overviewRuler),this._hasRuler=!0)},e.prototype.removeRulers=function(){this._textView&&this._hasRuler&&(this._textView.removeRuler(this._rulerOrigin),this._textView.removeRuler(this._rulerNew),this._textView.removeRuler(this._overviewRuler),this._hasRuler=!1)},e.prototype.destroyEditor=function(){this._textView&&(this._diffNavigator.destroy(),this._textView.setText(""),this.removeRulers()),this.hasContent=!1},e.prototype.destroy=function(){this._textView&&(this._diffNavigator.destroy(),this._textView.destroy())},e.prototype.createEditorContainer=function(e,t,n,i,o,u){var l=r.node(this._editorDivId),c=this,d=new h.TextModel(e,t),v=function(){var e=new p.TextView({parent:l,model:d,readonly:!0,tabSize:4});return e},m=function(e,t,n,r){return},g=function(e,t){return},y=new f.UndoFactory,b=new f.AnnotationFactory,w=new a.Editor({textViewFactory:v,undoStackFactory:y,annotationFactory:b,keyBindingFactory:m,statusReporter:g,domNode:l});w.installTextView(),w.setOverviewRulerVisible(!1),w.setAnnotationRulerVisible(!1),o&&u&&w.setInput(u.Name);var E=w.getTextView();return this._rulerOrigin=new s.LineNumberCompareRuler(this._diffNavigator,1,"left",{styleClass:"ruler lines"},{styleClass:"rulerLines odd"},{styleClass:"rulerLines even"}),this._rulerNew=new s.LineNumberCompareRuler(this._diffNavigator,0,"left",{styleClass:"ruler lines"},{styleClass:"rulerLines odd"},{styleClass:"rulerLines even"}),this._overviewRuler=new s.CompareOverviewRuler("right",{styleClass:"ruler overview"},null,function(e,t){c._diffNavigator.matchPositionFromOverview(e)}),E.addEventListener("Selection",function(e){if(e.newValue&&e.newValue.start!==e.newValue.end)return;if(c._diffNavigator.autoSelecting||!c._diffNavigator.editorWrapper[0].diffFeeder)return;var t=E.getCaretOffset();c._diffNavigator.gotoDiff(t,E)}),w},e.prototype.initEditorContainers=function(e,t,n,r){this._editor=this.createEditorContainer(t,e,n,r,this.options.newFile),this._textView=this._editor.getTextView()},e.prototype._initDiffPosition=function(e){var t=e.getModel();if(t&&t.getAnnotations){var n=t.getAnnotations();if(n.length>0){var r=n[0][0],i=e.getLineHeight(),s=e.getClientArea(),o=Math.floor(s.height/i/3);e.setTopIndex(r-o>0?r-o:0)}}},e.prototype.setDiffTitle=function(e){this._diffTitle=e},e.prototype.setEditor=function(){var e=this.options.baseFile.Content,t=this.options.newFile.Content,n=this.options.diffContent;this.hasContent=!0;var r=this.parseMapper(e,t,n,this.options.hasConflicts,!this.options.toggler);t||(t=r.output),this._highlighterLoaded=0;if(!this._textView)this.initEditorContainers(r.delim,e,r.mapper,r.diffArray,!0);else{this._textView.getModel().setText(e);var i=new b.inlineDiffBlockFeeder(r.mapper,1),s=new b.inlineDiffBlockFeeder(r.mapper,0);v.mergeDiffBlocks(this._textView.getModel(),s.getDiffBlocks(),r.mapper,r.diffArray.array,r.diffArray.index,this._diffParser._lineDelimiter),i.setModel(this._textView.getModel()),s.setModel(this._textView.getModel()),this._diffNavigator.initAll(this.options.charDiff?"char":"word",this._editor,this._editor,i,s,this._overviewRuler),this._highlighter[0].highlight(this.options.baseFile.Name,this.options.baseFile.Type,this._editor,this,1),this.renderCommands(),this.addRulers();var o=this._textView.getTopIndex();this._textView.redrawLines(o,o+1,this._overviewRuler),this._textView.redrawLines(o,o+1,this._rulerOrigin),this._textView.redrawLines(o,o+1,this._rulerNew),this._diffNavigator.gotoBlock(this.options.blockNumber-1,this.options.changeNumber-1)}return this._textView.getLineHeight()*this._textView.getModel().getLineCount()+5},e.prototype.setConflicting=function(e){this._conflcit=e},e}(),S.toggleableCompareContainer=function(){function e(e,t,n,r){r&&(r.toggler=this),n==="inline"?(this.widgetType="inline",this._widget=new S.InlineCompareContainer(e,t,r)):(this.widgetType="twoWay",this._widget=new S.TwoWayCompareContainer(e,t,null,r)),this._parentDivId=t,this._serviceRegistry=e}return e.prototype={startup:function(e){this._widget.startup(!1,e)},toggle:function(){var e=this._widget.options,t=this._widget.getCurrentDiffPos();e.blockNumber=t.block,e.changeNumber=t.change,this._widget.destroy(),r.empty(r.node(this._parentDivId)),this.widgetType==="inline"?(this.widgetType="twoWay",this._widget=new S.TwoWayCompareContainer(this._serviceRegistry,this._parentDivId,null,e)):(this.widgetType="inline",this._widget=new S.InlineCompareContainer(this._serviceRegistry,this._parentDivId,e)),this._widget.setEditor()}},e}(),S}),define("orion/editor/htmlGrammar",[],function(){function e(){return{scopeName:"source.html",uuid:"3B5C76FB-EBB5-D930-F40C-047D082CE99B",patterns:[{begin:"<!(doctype|DOCTYPE)",end:">",contentName:"entity.name.tag.doctype.html",beginCaptures:{0:{name:"entity.name.tag.doctype.html"}},endCaptures:{0:{name:"entity.name.tag.doctype.html"}}},{begin:"<!--",end:"-->",beginCaptures:{0:{name:"punctuation.definition.comment.html"}},endCaptures:{0:{name:"punctuation.definition.comment.html"}},patterns:[{match:"--",name:"invalid.illegal.badcomment.html"}],contentName:"comment.block.html"},{match:"<[A-Za-z0-9_\\-:]+(?= ?)",name:"entity.name.tag.html"},{include:"#attrName"},{include:"#qString"},{include:"#qqString"},{include:"#entity"},{match:"</[A-Za-z0-9_\\-:]+>",name:"entity.name.tag.html"},{match:">",name:"entity.name.tag.html"}],repository:{attrName:{match:"[A-Za-z\\-:]+(?=\\s*=\\s*['\"])",name:"entity.other.attribute.name.html"},qqString:{match:'(")[^"]+(")',name:"token.string"},qString:{match:"(')[^']+(')",name:"token.string"},entity:{match:"&[A-Za-z0-9]+;",name:"constant.character.entity.html"}}}}return{HtmlGrammar:e}}),define("orion/compare/compareView",["orion/serviceregistry","orion/status","orion/progress","orion/operationsClient","orion/commands","orion/fileClient","orion/compare/compare-features","orion/compare/compare-container","orion/compare/compareUtils","orion/contentTypes","orion/editor/textMateStyler","orion/editor/htmlGrammar","examples/editor/textStyler"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){function b(){this.styler=null}function w(e,t,n,r,i,s){n||(n="left.js"),r||(r="Sample Orion compare contents on left side\nvar left = 1\n"),i||(i="right.js"),s||(s="Sample Orion compare contents on right side\nvar right = 2\n");var o={readonly:!0,hasConflicts:!1,commandSpanId:t,highlighter:b,newFile:{Name:n,Type:"js",Content:r},baseFile:{Name:i,Type:"js",Content:s}},a=new u.toggleableCompareContainer(p,e,"inline",o);a.startup()}var p=window.serviceRegistry=new e.ServiceRegistry,d=new i.CommandService({serviceRegistry:p}),v=new f.ContentTypeService(p),m=new r.OperationsClient(p),g=new t.StatusReportingService(p,m,"statusPane","notifications","notificationArea"),y=new n.ProgressService(p,m);return b.prototype={highlight:function(e,t,n,r,i){this.styler&&(this.styler.destroy(),this.styler=null);var s=e.split("."),o="js";s.length>1&&(o=s[s.length-1]);if(o){var u=n.getTextView(),a=n.getAnnotationModel();switch(o){case"js":case"java":case"css":this.styler=new h.TextStyler(u,o,a);break;case"html":this.styler=new l.TextMateStyler(u,new c.HtmlGrammar)}r&&i&&(n.setAnnotationRulerVisible(!1),r._highlighterLoaded++,r._highlighterLoaded===i&&(r._diffNavigator.renderAnnotations(),r._diffNavigator.gotoBlock(r.options.blockNumber-1,r.options.changeNumber-1)))}}},w}),define(["orion/compare/compareView"],function(e){return e});